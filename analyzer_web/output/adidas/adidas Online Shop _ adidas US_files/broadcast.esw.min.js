window.esw.defineFeature("Broadcast",function(t){function e(){this.esw=t,this.callbacks={},this.storage=window.localStorage,this.prefix="__broadcastAPI:",this.queue={},this.on(),this.off(),this.send(),window.addEventListener("storage",function(t){var e,i=t.newValue,s="";0===t.key.indexOf(this.prefix)&&null===t.oldValue&&(e=t.key.replace(this.prefix,""),"undefined"!==i&&(s=JSON.parse(i)),this.broadcast(e,s))}.bind(this)),window.addEventListener("storage",function(t){var e;0===t.key.indexOf(this.prefix)&&null===t.newValue&&(e=t.key.replace(this.prefix,""))in this.queue&&(this.send(e,this.queue[e].shift()),0===this.queue[e].length&&delete this.queue[e])}.bind(this))}e.prototype.on=function(t,e){t in this.callbacks||(this.callbacks[t]=[]),this.callbacks[t].push(e)},e.prototype.off=function(t,e){var i;t in this.callbacks&&("function"==typeof e&&(i=this.callbacks[t].indexOf(e),this.callbacks[t].splice(i,1)),"function"==typeof e&&0!==this.callbacks[t].length||delete this.callbacks[t])},e.prototype.send=function(t,e){var i=this.prefix+t;null===this.storage.getItem(i)?(this.storage.setItem(i,JSON.stringify(e,function(t,e){return void 0===e?null:e})),this.storage.removeItem(i)):(i in this.queue||(this.queue[i]=[]),this.queue[i].push(e))},e.prototype.broadcast=function(t,e){t in this.callbacks&&this.callbacks[t].forEach(function(t){t(e)})},t.broadcastAPI=new e});