(function(f){try{if(!window[f.ns]){if(!window.am){am={c:{}};var k=am.c[f.id]={};k.d=[];k.d.push("lazy:"+Date.now())}f.ns="am"}var b=window[f.ns].c[f.id];b?(b.v=b.v||{},b.v.version="1.5.0.2",b.v.debugLevel=f.debug?f.debug:0,b.v.auditLevel=f.audit?f.audit:0,b.v.tto=f.tto?f.tto:0,b.v.sessionId=Math.random().toString().slice(2,10),b.v.href=location.href,b.v.ref=document.referrer,b.v.tagsFired=[],b.v.context="",b.v.cid=f.id,b.v.auditTag="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+b.v.cid,am.c.cb={tto:function(a){a=parseInt(a.uid)||0;var b=Object.keys(am.c)[0],c="ats-cid-"+b+"-sid",f=Math.random().toString().slice(2,10);if(0===a)for(am.c[b].f.logit("employ 3to1 redirect"),am.c[b].f.setCookie(c,f+"s",!1,"/"),a=0;a<document.links.length;a+=1){if(b=document.links[a],"http"===b.href.substr(0,4)||"//"===b.href.substr(0,2))b.href="//ib.adnxs.com/getuid?"+encodeURIComponent(b.href)}else am.c[b].f.logit("3to1 redirect not needed, id is "+a),am.c[b].f.setCookie(c,f+"x",!1,"/")}},b.f={logit:function(a){b.d.push(a+":"+new Date);0<b.v.debugLevel&&console.log(b.v.cid+"-DEBUG:"+a)},safeEval:function(a,e){var c="";try{b.v.context=e,"undefined"!==typeof e&&null!==e&&(a="var el=am.c['"+b.v.cid+"'].v.context;"+a),c=eval(a)}catch(l){b.f.logit("could not eval ("+a+"), "+l.message)}return c},getCookie:function(b){var a=document.cookie.indexOf(b+"="),c=a+b.length+1;if(!a&&b!==document.cookie.substring(0,b.length)||-1===a)return null;b=document.cookie.indexOf(";",c);-1===b&&(b=document.cookie.length);return unescape(document.cookie.substring(c,b))},setCookie:function(b,e,c,f,g,h){var a=new Date;a.setTime(a.getTime());c&&(c*=864E5);a=new Date(a.getTime()+c);document.cookie=b+"="+escape(e)+(c?";expires="+a.toGMTString():"")+(f?";path="+f:"")+(g?";domain="+g:"")+(h?";secure":"")},getSessionId:function(){var a="ats-cid-"+b.v.cid+"-sid",e=b.f.getCookie(a);e||(e=Math.random().toString().slice(2,10),b.f.setCookie(a,e,!1,"/"));return e},getParentReferrer:function(a){if(a.parent===a)try{var e=a.document.referrer}catch(c){e="(iframed)"+document.referrer,b.f.logit("could not escape iframe: "+c.message)}else e=a.parent?b.f.getParentReferrer(a.parent):window.document.referrer;return e},getParentHref:function(a){if(a.parent===a)try{var e=a.location.href}catch(c){e="(iframed)"+location.href,b.f.logit("could not escape iframe: "+c.message)}else e=a.parent?b.f.getParentHref(a.parent):window.location.href;return e},evalTrigger:function(a,e){b.f.logit("processing tag id "+a.id+" ("+a.name+")");var c=a.trigger.result=b.f.safeEval(a.trigger.code,e);b.f.logit('trigger "'+a.trigger.name+'" is '+c);c?b.f.logit('"'+a.trigger.name+'" causes tag id '+a.id+" ("+a.name+") to fire"):b.f.logit("tag id "+a.id+" ("+a.name+") will _NOT_ fire");return c},evalVars:function(a,e,c){b.f.logit('processing variable "'+a.name+'"');a.result=b.f.safeEval(a.value,c);b.f.logit('variable "'+a.name+'" = '+a.result);return e.text.replace(new RegExp(a.name,"g"),a.result)},fireTag:function(a){function e(a){(new Image).src=a.text;b.f.logit("tag id "+a.id+" ("+a.name+") fired as hidden img")}function c(a){var e=document.getElementsByTagName("script")[0],c=document.createElement("script");c.async=!0;c.id=b.v.cid+"-tid-"+a.id;c.src=a.text;e.parentNode.insertBefore(c,e);b.f.logit("tag id "+a.id+" ("+a.name+") fired in script "+c.id)}function f(){var c=document.createElement("div");c.style="width:0px;height:0px;display:none;visibility:hidden";c.id=b.v.cid+"-tid-"+a.id;c.innerHTML=a.text;document.body.appendChild(c);b.f.logit("tag id "+a.id+" ("+a.name+") fired in div "+c.id)}function g(a){var c=document.createElement("iframe");c.id=b.v.cid+"-tid-"+a.id;c.style="width:0px;height:0px;display:none;visibility:hidden";c.width=0;c.height=0;c.src=a.text;document.body.appendChild(c);b.f.logit("tag id "+a.id+" ("+a.name+") fired in iframe "+c.id)}function h(a){var c=document.createElement("iframe");c.id=b.v.cid+"-tid-"+a.id;c.style="width:0px;height:0px;display:none;visibility:hidden";c.width=0;c.height=0;document.body.appendChild(c);c.contentWindow.document.open().write("<html><body>"+a.text+"</body></html>");c.contentWindow.document.close();b.f.logit("tag id "+a.id+" ("+a.name+") fired in protected iframe "+c.id)}b.f.logit("tag id "+a.id+" ("+a.name+") processed: "+a.text);switch(a.obj){case "img":e(a);break;case "script":c(a);break;case "div":f(a);break;case "null":b.f.logit("tag id "+a.id+" ("+a.name+") fired as null");break;case "iframe":g(a);break;default:h(a)}},firePreAudit:function(){b.f.fireTag({id:-1,name:"pre-audit",trigger:{name:"always",code:"true"},vars:[],obj:"img",text:b.v.auditTag})},firePostAudit:function(){b.f.fireTag({id:1,name:"post-audit",trigger:{name:"audit",code:"true"},vars:[],obj:"img",text:b.v.auditTag+"&px="+b.v.tagsFired.join()})},fireDefaultTag:function(a){var e;if(b.f.evalTrigger(a)){for(e=0;e<a.vars.length;e+=1){var c=a.vars[e];a.text=b.f.evalVars(c,a)}b.v.tagsFired.push(a.id);b.f.fireTag(a)}},prepareDelayTag:function(a,e){setTimeout(function(){b.f.fireDefaultTag(a)},1E3*e)},prepareEventTag:function(a){window.addEventListener(a.trigger.event,function(e){try{var c;if(b.f.evalTrigger(a,e.target)){for(c=0;c<a.vars.length;c+=1){var f=a.vars[c];a.text=b.f.evalVars(f,a,e.target)}b.v.tagsFired.push(a.id);b.f.fireTag(a)}}catch(g){console.log(b.v.cid+"-ERR: trapped event error: "+g.message),document.createElement("img").src="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+b.v.cid+"&err=event&msg="+escape(g.message)}},!1);b.f.logit("tag id "+a.id+" ("+a.name+") added as window."+a.trigger.event)},registerEventListener:function(){document.body.addEventListener("am.custom",function(a){b.d.push("am.custom:"+JSON.stringify(a.detail));b.f.fireTag({id:"am.custom",name:"am.custom",text:b.v.auditTag+"&vars="+escape(encodeURIComponent(JSON.stringify(a.detail.message))),obj:"img"})})},main:function(a){var e;b.v.sessionId=b.f.getSessionId();b.v.href=b.f.getParentHref(window);b.v.ref=b.f.getParentReferrer(window);b.v.debugLevel=/amdebug=1/i.test(b.v.href)?1:b.v.debugLevel;b.v.auditTag=b.v.auditTag+"&sid="+b.v.sessionId+"&url="+escape(b.v.ref);b.v.atsCookie=b.f.getCookie("ats-cid-"+b.v.cid+"-sid");1<b.v.auditLevel&&b.f.firePreAudit();b.f.registerEventListener();for(e=0;e<a.length;e+=1){var c=a[e];c.trigger.event&&""!==c.trigger.event?b.f.prepareEventTag(c):(d="undefined"===typeof c.trigger.delay?0:c.trigger.delay,b.f.prepareDelayTag(c,d))}b.v.atsCookie&&9>b.v.atsCookie.length&&b.v.tto?setTimeout(function(){var a=Object.keys(am.c)[0];am.c[a].f.fireTag({id:"321",name:"3to1",obj:"script",text:"//ib.adnxs.com/getuidp?callback=am.c.cb.tto",trigger:{name:"321all",code:"true"},vars:[]})},Math.random().toString().slice(2,6)):b.f.logit("3to1 check is redundant, cookie is "+b.v.atsCookie);0<b.v.auditLevel&&b.f.firePostAudit();b.d.push("finish:"+Date.now())}},b.t=[{"id":0,"obj":"img","name":"audit","text":"{auditUrl}&vars=","vars":[{"name":"{auditUrl}","value":"am.c['AM-141529'].v.auditTag"}],"trigger":{"code":"true","name":"all","event":""}},{"id":"974212","obj":null,"name":"captureEvent","text":"console.log('am.custom event listener loaded');","vars":[],"trigger":{"code":"document.body.addEventListener('am.custom',function(e){console.log('am.custom listener:'+JSON.stringify(e.detail));setTimeout(function(){am.c['AM-141529'].f.fireTag({id:'am.custom',name:'am.custom',text:'https://ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid=AM-141529&sid='+am.c['AM-141529'].v.sessionId+'&url=&vars=data:'+escape(encodeURIComponent(JSON.stringify(e.detail.message))),obj:'img',trigger:{name:'true',code:true,event:'',result:true},vars:[]});am.c['AM-141529'].f.fireTag({id:'974212',name:'conversion',text:'https://secure.adnxs.com/px?id=974212&t=2',obj:'img',trigger:{name:'true',code:true,event:'',result:true},vars:[]});console.log('am.custom resolved.');},150);});true;","name":"addEventListener","event":""}}],b.f.main(b.t)):(console.log(f.id+"-ERR: namespace _NOT_ found"),document.createElement("img").src="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+f.id+"&err=no-namespace")}catch(a){console.log(f.id+"-ERR: trapped error: "+a.message),document.createElement("img").src="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+f.id+"&err=unknown&msg="+escape(a.message)}})({ns:"am",id:"AM-141529",audit:undefined,debug:undefined,tto:0});