window.setTimeout(function(){window.fbAsyncInit&&window.fbAsyncInit.hasRun&&window.cnvAsyncInit&&!window.cnvAsyncInit.hasRun?(window.cnvAsyncInit.hasRun=!0,window.cnvAsyncInit()):window.fbAsyncInit||!window.cnvAsyncInit||window.cnvAsyncInit.hasRun||(window.cnvAsyncInit.hasRun=!0,window.cnvAsyncInit())},0),window.Cnv=window.Cnv||{},function($,JSON){if(void 0===$){var rbracket=/\[\]$/,r20=/%20/g;function buildParams(e,t,n){var a;if("[object Array]"===Object.prototype.toString.call(t))for(var o=0,r=t.length;o<r;o++)rbracket.test(e)?n(e,t[o]):buildParams(e+"["+("object"==typeof t[o]?o:"")+"]",t[o],n);else if("object"==typeof t)for(a in t)buildParams(e+"["+a+"]",t[a],n);else n(e,t)}$={param:function(e){var t,n=[],a=function(e,t){t=null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if("[object Array]"===Object.prototype.toString.call(e))for(var o=0,r=e.length;o<r;o++)a(e[o].name,e[o].value);else for(t in e)buildParams(t,e[t],a);return n.join("&").replace(r20,"+")}}}JSON||(JSON={},function(){function f(e){return e<10?"0"+e:e}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,a,o,r,i,s=gap,c=t[e];switch(c&&"object"==typeof c&&"[object Date]"===Object.prototype.toString.apply(c)&&(c=this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,n=0;n<r;n+=1)i[n]=str(n,c)||"null";return o=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+s+"]":"["+i.join(",")+"]",gap=s,o}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;n<r;n+=1)"string"==typeof(a=rep[n])&&(o=str(a,c))&&i.push(quote(a)+(gap?": ":":")+o);else for(a in c)Object.hasOwnProperty.call(c,a)&&(o=str(a,c))&&i.push(quote(a)+(gap?": ":":")+o);return o=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+s+"}":"{"+i.join(",")+"}",gap=s,o}}JSON.stringify=function(e,t,n){var a;if(gap="",indent="","number"==typeof n)for(a=0;a<n;a+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){var j;function walk(e,t){var n,a,o=e[t];if(o&&"object"==typeof o)for(n in o)Object.hasOwnProperty.call(o,n)&&(void 0!==(a=walk(o,n))?o[n]=a:delete o[n]);return reviver.call(e,t,o)}if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}());var pm={poll:200,send:function(e){var t={target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1};for(k in e)t[k]=e[k];var n=t.target;if(t.target&&t.type){var a={data:t.data,type:t.type};t.success&&(a.callback=pm._callback(t.success)),t.error&&(a.errback=pm._callback(t.error)),"postMessage"in n&&!t.hash?(pm._bind(),n.postMessage(JSON.stringify(a),t.origin||"*")):(pm.hash._bind(),pm.hash.send(t,a))}},bind:function(e,t,n,a){pm._replyBind(e,t,n,a,!0)},_replyBind:function(e,t,n,a,o){"postMessage"in window&&!a?pm._bind():pm.hash._bind();var r=pm.data("listeners.postmessage");r||(r={},pm.data("listeners.postmessage",r));var i=r[e];i||(i=[],r[e]=i),i.push({fn:t,callback:o,origin:n||"*"})},unbind:function(e,t){var n=pm.data("listeners.postmessage");if(n)if(e)if(t){var a=n[e];if(a){for(var o=[],r=0,i=a.length;r<i;r++){var s=a[r];s.fn!==t&&o.push(s)}n[e]=o}}else delete n[e];else for(var r in n)delete n[r]},data:function(e,t){return void 0===t?pm._data[e]:(pm._data[e]=t,t)},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var e=[],t=0;t<32;t++)e[t]=pm._CHARS[0|32*Math.random()];return e.join("")},_callback:function(e){var t=pm.data("callbacks.postmessage");t||(t={},pm.data("callbacks.postmessage",t));var n=pm._random();return t[n]=e,n},_bind:function(){pm.data("listening.postmessage")||(window.addEventListener?window.addEventListener("message",pm._dispatch,!1):window.attachEvent&&window.attachEvent("onmessage",pm._dispatch),pm.data("listening.postmessage",1))},_dispatch:function(e){try{if(-1!=e.origin.indexOf("fbcdn.net"))return;var t=JSON.parse(e.data)}catch(e){}if(t.type){var n=(pm.data("callbacks.postmessage")||{})[t.type];if(n)n(t.data);else for(var a=(pm.data("listeners.postmessage")||{})[t.type]||[],o=0,r=a.length;o<r;o++){var i=a[o];if(i.origin&&"*"!==i.origin&&e.origin!==i.origin){if(t.errback){var s={message:"postmessage origin mismatch",origin:[e.origin,i.origin]};pm.send({target:e.source,data:s,type:t.errback})}}else try{i.callback?i.fn(t.data,c,e):c(i.fn(t.data,e))}catch(n){if(!t.errback)throw n;pm.send({target:e.source,data:n,type:t.errback})}function c(n){t.callback&&pm.send({target:e.source,data:n,type:t.callback})}}}},hash:{send:function(e,t){var n=e.target,a=e.url;if(a){a=pm.hash._url(a);var o,r=pm.hash._url(window.location.href);if(window==n.parent)o="parent";else try{for(var i=0,s=parent.frames.length;i<s;i++){if(parent.frames[i]==window){o=i;break}}}catch(e){o=window.name}if(null!=o){var c={"x-requested-with":"postmessage",source:{name:o,url:r},postmessage:t},u="#x-postmessage-id="+pm._random();n.location=a+u+encodeURIComponent(JSON.stringify(c))}}},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:"#x-postmessage-id=".length+32,_bind:function(){pm.data("polling.postmessage")||(setInterval(function(){var e=""+window.location.hash,t=pm.hash._regex.exec(e);if(t){var n=t[1];pm.hash._last!==n&&(pm.hash._last=n,pm.hash._dispatch(e.substring(pm.hash._regex_len)))}},$.pm.poll||200),pm.data("polling.postmessage",1))},_dispatch:function(e){if(e){try{if(!("postmessage"===(e=JSON.parse(decodeURIComponent(e)))["x-requested-with"]&&e.source&&null!=e.source.name&&e.source.url&&e.postmessage))return}catch(e){return}var t=e.postmessage,n=(pm.data("callbacks.postmessage")||{})[t.type];if(n)n(t.data);else{var a;a="parent"===e.source.name?window.parent:window.frames[e.source.name];for(var o=(pm.data("listeners.postmessage")||{})[t.type]||[],r=0,i=o.length;r<i;r++){var s=o[r];if(s.origin){var c=/https?\:\/\/[^\/]*/.exec(e.source.url)[0];if("*"!==s.origin&&c!==s.origin){if(t.errback){var u={message:"postmessage origin mismatch",origin:[c,s.origin]};pm.send({target:a,data:u,type:t.errback,hash:!0,url:e.source.url})}continue}}function d(n){t.callback&&pm.send({target:a,data:n,type:t.callback,hash:!0,url:e.source.url})}try{s.callback?s.fn(t.data,d):d(s.fn(t.data))}catch(n){if(!t.errback)throw n;pm.send({target:a,data:n,type:t.errback,hash:!0,url:e.source.url})}}}}},_url:function(e){return(""+e).replace(/#.*$/,"")}}},restLink,debug,eventPageLoaded=!1,reservedParams=["cr","cn","ct","mg","et","pk","tp","sn","ap","ak_guid"],renderContentSuccessCallbacks=[],renderContentErrorCallbacks=[],preLoadEventQueue=[],protocol=document.location.protocol,cookie={data:{},load:function(e){for(var t=document.cookie.split(";"),n=!1,a=0;a<t.length;a++){var o=t[a].substr(0,t[a].indexOf("=")),r=t[a].substr(t[a].indexOf("=")+1);o=o.replace(" ",""),r=r.replace(" ",""),o===e&&(data=QueryStringToJSON(r),n=!0)}return!!n&&data},save:function(e,t,n){var a=new Date;a.setDate(a.getDate()+3650);var o=void 0===t?a:t,r=n||"/",i=decodeURIComponent($.param(this.data)),s=getSecondLevelDomain(window.location.host);document.cookie=e+"="+i+";path="+r+";expires="+o.toGMTString()+";domain=."+s}};Cnv.PostWebEvent=function(e,t,n){var a={};a.pm=e,a.rp=cookie.data,a.rp.we=t,postToConversen(a,"wts/WebEvent",n)},Cnv.RenderContent=function(e){if(e.data=e.data||null,e.success=e.success||function(){},e.error=e.error||function(){},eventPageLoaded){var t=guidGenerator();e.data.GuidId=t,e.data.CustId=cookie.data.cr,pm.send({target:window.frames.cnvIframe,type:"SdkEventListener",data:e.data,error:function(t){e.error("error communicating with cnv, please try again or contact support")},success:function(n){renderContentSuccessCallbacks[t]=e.success,renderContentErrorCallbacks[t]=e.error}})}else preLoadEventQueue.push(e)},Cnv.Log=function(e,t){if(!0===debug){var n=document.getElementById("cnv-log"),a=n.text();a+=e.toString(),n.html(a)}var o={};o.Log=e,url=void 0===t?"sts/Log":t+"/Log",postToConversen(o,url,null)},Cnv.init=function(e){try{conversenInit(restLink=protocol+"//"+e.restLink+"/",e),e.success&&e.success()}catch(t){e.error(t)}};var previousCookie,cookieDomain="";function conversenInit(e,t){var n=new Date,a=new Date(n.getTime()+GetCookieExpiry(e,t.custId)),o="xyz_cr_"+t.custId+"_et_"+t.entityId,r=null;void 0!==window.FB&&(r=window.FB._apiKey),cookieDomain=t.cookieDomain,(previousCookie=cookie.load(o))||(cookie.save(o,a,"/"),previousCookie=cookie.load(o)),updateCnvCookie(previousCookie),cookie.data.cr=void 0===t.custId?cookie.data.cr:t.custId,cookie.data.et=void 0===t.entityId?cookie.data.et:t.entityId,cookie.data.ap=r,cookie.save(o,a,"/"),debug=t.debug;t.params;if(void 0===t.enableSocialEvents||t.enableSocialEvents){var i=document.createElement("iframe");i.name="cnvIframe",i.id="cnvIframe",i.src=e+"sts/SocialEvent/Event",i.style="display:none;",document.body.appendChild(i),pm.bind("CnvEventListener",function(e){if(e.errorData){var t=renderContentErrorCallbacks[e.GuidId];t&&t(e.errorData)}else if(e.successData){(0,renderContentSuccessCallbacks[e.GuidId])(e.successData)}renderContentSuccessCallbacks[e.GuidId]=null,renderContentErrorCallbacks[e.GuidId]=null}),pm.bind("FinishedLoading",function(e){if(e){eventPageLoaded=e;for(var t=0,n=preLoadEventQueue;t<n;t++){var a=preLoadEventQueue[t];Cnv.RenderContent(a)}preLoadEventQueue=null}})}t.enableFacebook&&(isNaN(cookie.data.ap)||isNaN(cookie.data.cr)||isNaN(cookie.data.et)?Cnv.Log("Failed to initialize Conversen.FB.init","sts"):(window.FB.Event.subscribe("auth.login",conversenAuthLogin),window.FB.Event.subscribe("auth.logout",conversenAuthLogout),window.FB.Event.subscribe("edge.create",conversenEdgeCreate),window.FB.Event.subscribe("comment.create",conversenCommentCreate),window.FB.Event.subscribe("message.send",conversenMessageSend),window.FB.Event.subscribe("fb.log",Cnv.Log)))}function conversenAuthLogin(e){var t={};t.au=e,t.rp=cookie.data,postJsonToConversen(t,"sts/AuthLogin",null),window.FB.api("/me",function(e){window.FB.api("/me/likes",function(t){var n={},a={};a.me=e,a.likes=t,n.pf=a,n.rp=cookie.data;var o="sts-profile-"+a.me.id;0==cookie.load(o)&&(cookie.data={postedProfile:"true"},cookie.save(o),postJsonToConversen(n,"sts/Profile",null)),cookie.data=n.rp})})}function conversenMessageSend(e){var t={};t.rp=cookie.data,t.href=e,postJsonToConversen(t,"sts/MessageSend",null)}function conversenEdgeCreate(e){var t={};t.rp=cookie.data,t.href=e,postJsonToConversen(t,"sts/EdgeCreate",null)}function conversenCommentCreate(e){var t=e.commentID,n=e.href;window.FB.Data.query('SELECT comments_fbid FROM link_stat WHERE url="{0}"',e.href).wait(function(e){window.FB.Data.query("SELECT xid,object_id,post_id,fromid,time,text,id,username,reply_xid,post_fbid,likes,user_likes FROM comment WHERE object_id={0} AND post_fbid={1}",e[0].comments_fbid,t).wait(function(e){var t={};t.cc=e[0],t.cc.href=n,t.rp=cookie.data,postJsonToConversen(t,"sts/CommentCreate",null);var a="/"+e[0].fromid;window.FB.api(a,function(e){var t={},n={};n.me=e,t.pf=n,t.rp=cookie.data,postJsonToConversen(t,"sts/Profile",null)})},function(e){Cnv.Log(e)})},function(e){Cnv.Log(e)})}function postToConversen(e,t,n){!0===debug&&(document.getElementById("cnv-log").innerHTML+="<br />"+o);var a=guidGenerator(),o=decodeURIComponent($.param(e)),r=restLink+t+"/image.gif?";r.length+o.length>=1900?splitPostRequest(r,t,o,a):imagePost(r=r+"isSplit=false&guid="+a+"&segmentNumber=1&",o)}function postJsonToConversen(e,t,n){e.mt=t,pm.send({target:window.frames.cnvIframe,type:"CnvEvent",data:e,error:function(a){postToConversen(e,t,n)}})}function imagePost(e,t){var n=document.createElement("img");n.style.display="none",n.src=e+t,document.body.appendChild(n),document.body.removeChild(n)}function splitPostRequest(e,t,n,a){for(var o,r,i=e.length,s=[],c=1;i+n.length>1900;)o=n.lastIndexOf("&",1600),r=n.substring(0,o),n=n.substring(o+1),s.push("isSplit=true&guid="+a+"&segmentNumber="+c+"&"+r+"&"),c++;for(s.push("isSplit=true&guid="+a+"&segmentNumber="+c+"&"+n+"&"),imagePost(restLink+t+"/header.gif?","guid="+a+"&numberOfSegments="+c);s.length>0;)imagePost(e,s.pop())}function guidGenerator(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function updateCnvCookie(e){var t=fetchCnvParams();!1!==t?void 0===t.tp?cookie.data=t:(cookie.data={},cookie.data.tp=t.tp):cookie.data=e}function fetchCnvParams(){for(var e,t={},n={},a=!1,o=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(o," "))},s=window.location.search.substring(1);e=r.exec(s);)t[i(e[1])]=i(e[2]);for(var c=0;c<reservedParams.length;c++){var u=reservedParams[c];void 0!==t[u]&&(n[u]=t[u],a=!0)}return!!a&&n}function loadScript(e,t){var n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.src=e;var o=!1;a.onload=a.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,t(),a.onload=a.onreadystatechange=null,n.removeChild(a))},n.appendChild(a)}function QueryStringToJSON(e){var t=e.replace(/(.*?\?)/,"").split("&");stack={};for(var n=0,a=t.length;n<a;n++){var o=t[n].split("="),r=o[0],i=isNaN(o[1])?o[1]:parseFloat(o[1]);if(r.match(/(.*?)\[(.*?)]/)){r=RegExp.$1;var s=RegExp.$2;"tp"===r&&isNaN(i)||(s?(r in stack||(stack[r]={}),stack[r][s]=i):(r in stack||(stack[r]=[]),stack[r].push(i)))}else stack[r]=i}return stack}function getSecondLevelDomain(e){if(cookieDomain)return cookieDomain;var t=e.split("."),n=t.length,a=0;return 2!==t[n-1].length||"co"!==t[n-2]&&"com"!==t[n-2]||a++,t.slice(n-a-2,n).join(".")}function GetCookieExpiry(e,t){try{var n=new XMLHttpRequest;return n.open("GET",e+"wts/WebEvent/GetCookieExpiry/"+t,!1),n.send(),1e3*n.responseXML.getElementsByTagName("cookieExpiry")[0].firstChild.nodeValue}catch(e){return 6048e5}}}(window.jQuery,window.JSON);