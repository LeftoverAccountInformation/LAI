(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{6:function(e,t){},"P/cB":function(e,t,n){"use strict";n.r(t);var r=function(){return{scope:{model:"="},replace:!0,restrict:"E",templateUrl:n("sfyz")}},a=n("o0o1"),o=n.n(a),i=n("yXPU"),c=n.n(i),s=n("cnVF");function u(e,t,r){var a,i=function(){var e=c()(o.a.mark((function e(){var t,n,a,i,c,u,l,d,p=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},n=t.Page,a=void 0===n?0:n,i=t.Owner,c=void 0===i?s.fb.USER:i,e.next=3,r.load({Page:a,Owner:c});case 3:return u=e.sent,l=u.Invoices,d=u.Total,e.abrupt("return",{owner:c,loaded:!0,list:l,total:d,page:a+1,perPage:s.eb});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(t){return{subscribed:e.user.Subscribed,delinquent:e.user.Delinquent>=s.oc.DELINQUENT,role:e.user.Role}[t]};return{scope:{},replace:!0,restrict:"E",templateUrl:n("lp3o"),link:(a=c()(o.a.mark((function e(n,a){var l,d,p,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=t(["paginatorScope"]),d=l.dispatcher,p={},f=function(){var e=c()(o.a.mark((function e(t,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({Page:t,Owner:r});case 2:a=e.sent,Object.assign(p,a),n.$applyAsync((function(){n.model=p}));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.getUserInfo=u,n.changePage=function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t-1,p.owner);case 2:d.paginatorScope("invoices",{page:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(e){var t=e.target,n=t.getAttribute("data-action");if(n){"download"===n&&r.download(t.getAttribute("data-action-arg")),"customize"===n&&r.customize();var a=n.toUpperCase();void 0!==s.fb[a]&&f(0,s.fb[a])}},f(),a.on("click",v),n.$on("$destroy",(function(){a.off("click",v)}));case 9:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})}}u.$inject=["authentication","dispatchers","invoiceModel"];var l=u;function d(e){var t=e("currency"),n=function(e,t,n){return(e===s.gb.UNPAID?n:t)/100};return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.State,a=e.AmountCharged,o=void 0===a?0:a,i=e.AmountDue,c=void 0===i?0:i,s=e.Currency,u=n(r,o,c);return t(u,s)}}d.$inject=["$filter"];var p=d,f=n("lSNA"),v=n.n(f);function m(e){var t,n,r={type:(t={},v()(t,s.hb.OTHER,e.getString("Other",null,"Invoice type display as badge")),v()(t,s.hb.SUBSCRIPTION,e.getString("Subscription",null,"Invoice type display as badge")),v()(t,s.hb.CANCELLATION,e.getString("Cancellation",null,"Invoice type display as badge")),v()(t,s.hb.CREDIT,e.getString("Credit",null,"Invoice type display as badge")),v()(t,s.hb.DONATION,e.getString("Donation",null,"Invoice type display as badge")),t),state:(n={},v()(n,s.gb.UNPAID,e.getString("Unpaid",null,"Invoice status display as badge")),v()(n,s.gb.PAID,e.getString("Paid",null,"Invoice status display as badge")),v()(n,s.gb.VOID,e.getString("Void",null,"Invoice status display as badge")),v()(n,s.gb.BILLED,e.getString("Billed",null,"Invoice status display as badge")),n)};return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n="type"===t?"Type":"State";return(r[t]||{})[e[n]]||""}}m.$inject=["gettextCatalog"];var g=m;function h(e,t,n,r,a,i){var u=i((function(){return{title:a.getString("Invoice",null,"Title invoice PDF")}}));return{load:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.Page,a=void 0===r?0:r,o=n.Owner,i=void 0===o?s.fb.USER:o;return e.track(t.invoices({Owner:i,Page:a,PageSize:s.eb}))},customize:function(){return r.activate()},download:function(){var r=c()(o.a.mark((function r(a){var i,c,s;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.track(t.invoice(a));case 2:i=r.sent,c="ProtonMail ".concat(u.title," ").concat(a,".pdf"),s=new Blob([i],{type:"application/pdf"}),n(s,c);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}}h.$inject=["networkActivityTracker","Payment","downloadFile","customizeInvoiceModal","gettextCatalog","translator"];var b=h;angular.module("proton.invoices",[]).directive("invoiceList",r).directive("invoiceSection",l).filter("invoicePrice",p).filter("invoiceInfo",g).factory("invoiceModel",b);var y=angular.module("proton.invoices").name;function E(e,t,n){var r=n((function(){return{makeDefault:t.getString("Make default",null,"Action"),editSignature:t.getString("Edit signature",null,"Action"),disable:t.getString("Disable",null,"Action"),enable:t.getString("Enable",null,"Action"),remove:t.getString("Delete",null,"Action"),generate:t.getString("Generate missing keys",null,"Action"),add:t.getString("Add address",null,"Action")}}));return{replace:!0,scope:{model:"=?",model2:"=?"},template:'<button type="button" class="addressBtnActions-container">'.concat(r.editSignature,"</button>"),link:function(t,n,a){var o=a.action,i=void 0===o?"editSignature":o;"editSignature"!==i&&n.text(r[i]);var c=function(){return e[i](t.model,t.model2)};n.on("click",c),t.$on("$destroy",(function(){n.off("click",c)}))}}}E.$inject=["addressModel","gettextCatalog","translator"];var S=E,D=n("3WF5"),k=n.n(D),A=n("QbOs"),I=n("gMlX");function C(e,t,r,a,i,u,l,d,p,f,v,m,g,h,b,y,E,S,D,C,w){var O=w((function(){return{SELECT_ADDRESS_TO_ADD_KEY:a.getString("Select an address to which the new key will be attached",null,"Info"),SELECT_ADDRESS_TO_IMPORT_KEY:a.getString("Select an address to which the imported key will be attached",null,"Info"),IMPORT_MESSAGE:a.getString("Are you sure you want to import a private key? Importing an insecurely generated or leaked private key can harm the security of your emails.",null,"Confirm message"),IMPORT_TITLE:a.getString("Import private key",null,"Confirm modal title"),DOWNLOAD_PUBLIC:a.getString("Download Public Key",null,"Confirm modal title"),DOWNLOAD_PUBLIC_MESSAGE:a.getString("This key has not been activated. It is only possible to export the public key. Do you want to export the public key?",null,"Confirm message"),INVALID_PRIVATE_KEY:a.getString("Cannot read private key",null,"Error"),GENERATE_KEY_MESSAGE:a.getString("You can generate a new encryption key if you think your previous key has been compromised.",null,"Title"),PRIVATE_KEY_PRIMARY:a.getString("Primary key changed",null,"Success"),PRIVATE_KEY_ENCRYPTION_DISABLED:a.getString("Encryption disabled",null,"Success"),PRIVATE_KEY_SIGNATURE_ENABLED:a.getString("Signature verification enabled",null,"Success"),PRIVATE_KEY_COMPROMISED:a.getString("Encryption and signature verification disabled",null,"Success"),PRIVATE_KEY_VALID:a.getString("Encryption enabled",null,"Success"),ERROR:a.getString("Error reactivating key. Please try again",null,"Error"),generateKeyTitle:function(e){return a.getString("New Address Key ({{ email }})",{email:e},"Title")},privateKeyImported:function(e){return a.getPlural(e,"Private key imported","{{$count}} Private keys imported",{},"Success")},PRIVATE_KEY_REACTIVATED:a.getString("Private key reactivated",null,"Success")}})),M=function(e,t,n){return e.addEventListener(t,n),function(){return e.removeEventListener(t,n)}},P=function(e,t,n){var a=new Blob([e],{type:"data:text/plain;charset=utf-8;"}),o=n+"key."+t+s.ib;r(a,o)},x=function(e,t){var n=e.email,r=t.PublicKey;return P(r,n,"public")},T=function(e,t){var n=e.email,r=t.PublicKey,a=t.PrivateKey;if(!t.decrypted)return m.activate({params:{title:O.DOWNLOAD_PUBLIC,message:O.DOWNLOAD_PUBLIC_MESSAGE,confirm:function(){P(r,n,"public"),m.deactivate()},cancel:m.deactivate}});p.activate({params:{exportPublic:function(){P(r,n,"public"),p.deactivate()},exportPrivate:function(){!function(e,t){g().then((function(){return f.activate({params:{privateKey:e,export:function(e){P(e,t,"private"),f.deactivate()},cancel:function(){f.deactivate()}}})}))}(a,n),p.deactivate()},cancel:p.deactivate}})},L=function(){var e=c()(o.a.mark((function e(t,n){var r,a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.addressID,a=n.ID,i=n.PrivateKey,e.t0=d,e.t1=r,e.next=6,Object(A.a)(i,S.getPassword());case 6:return e.t2=e.sent,e.t3=i,e.t4={mode:"set-primary",decryptedPrivateKey:e.t2,encryptedPrivateKey:e.t3},e.next=11,e.t0.signedKeyList.call(e.t0,e.t1,e.t4);case 11:c=e.sent,s=l.primary(a,{SignedKeyList:c}).then(y.call).then((function(){return u.success(O.PRIVATE_KEY_PRIMARY)})),h.track(s);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(e,t,n){return function(){var r=c()(o.a.mark((function r(a,i){var c,s,p,f,v,m;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=a.addressID,s=i.ID,p=i.Flags,f=i.PrivateKey,r.next=4,d.signedKeyList(c,{mode:"mark",newFlags:e,encryptedPrivateKey:f});case 4:v=r.sent,m=l.flags(s,{Flags:e,SignedKeyList:v}).then(y.call).then((function(){return u.success(p<e?t:n)})),h.track(m);case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()},N=j(s.kb.ENABLE_VERIFICATION,O.PRIVATE_KEY_SIGNATURE_ENABLED,O.PRIVATE_KEY_ENCRYPTION_DISABLED),$=j(s.kb.DISABLED,O.PRIVATE_KEY_COMPROMISED,O.PRIVATE_KEY_COMPROMISED),R=j(s.kb.ENABLE_VERIFICATION|s.kb.ENABLE_ENCRYPTION,O.PRIVATE_KEY_VALID,O.PRIVATE_KEY_VALID),_=function(){var e=c()(o.a.mark((function e(t,n){var r,a,c,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.type,a=n.address,c=n.key,e.next=3,Promise.all(k()(t,I.d));case 3:return s=e.sent,e.next=6,i.importKey(s.join("\n"),a,c);case 6:return l=e.sent,e.next=9,y.call();case 9:if(0!==l){e.next=11;break}return e.abrupt("return");case 11:if("import"!==r){e.next=13;break}return e.abrupt("return",u.success(O.privateKeyImported(l)));case 13:u.success(O.PRIVATE_KEY_REACTIVATED);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return{replace:!0,restrict:"E",scope:{displayMode:"@",isSubUser:"<",addresses:"<"},templateUrl:n("muNk"),link:function(n,r){var a=[],s=t(["dropdown"]).dispatcher,l=r[0].querySelector(".import-private-key-file"),d={},p=function(){d={},l.value=""};S.isPrivate()&&r[0].classList.add("addressKeysView-is-private");var f=function(t){var n=e.get().map((function(e){return{email:e.Email,addressID:e.ID}}));return new Promise((function(e){var r;C.activate({params:{info:t,addresses:n,hookClose:function(t){return t&&e({})},submit:(r=c()(o.a.mark((function t(n){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C.deactivate();case 2:e(n);case 3:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})}})}))},g=function(){var e=c()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(O.SELECT_ADDRESS_TO_IMPORT_KEY);case 2:if(t=e.sent,n=t.email){e.next=6;break}return e.abrupt("return");case 6:m.activate({params:{title:O.IMPORT_TITLE,message:O.IMPORT_MESSAGE,icon:"fa fa-warning",confirm:function(){d={type:"import",address:n},l.click(),m.deactivate()}}});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y={downloadPublic:x,newKey:function(){var e=c()(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(O.SELECT_ADDRESS_TO_ADD_KEY);case 2:if(t=e.sent,n=t.email,r=t.addressID,n){e.next=7;break}return e.abrupt("return");case 7:E.activate({params:{addresses:[{Email:n,ID:r}],title:O.generateKeyTitle(n),message:O.GENERATE_KEY_MESSAGE,class:"generateNewKey small",password:S.getPassword(),primary:!1,onSuccess:function(){E.deactivate()},close:function(){E.deactivate()}}});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),importKey:g,reactivateKey:function(e,t){var n=e.addressID,r=e.email;v.activate({params:{submit:function(e){v.deactivate();var r=[{addressID:n,keys:[t]}],a=b.process(r,e).then((function(e){var t=e.success,n=e.failed;t&&u.success(t),n&&u.error(n)}));h.track(a)},import:function(){d={type:"reactivate",address:r,key:t},l.click()},cancel:function(){v.deactivate()}}})},exportKey:T,makePrimaryKey:L,deleteKey:D.start,markObsolete:N,markCompromised:$,markValid:R};a.push(M(l,"change",(function(){0!==l.files.length?(v.deactivate(),h.track(_(l.files,d)).then(p).catch(p)):l.value=""}))),a.push(M(r[0],"click",(function(e){var t=e.target,r=t.nodeName,a=t.dataset,o=a.action,i=void 0!==o&&o,c=a.addressId,u=void 0===c?null:c,l=a.keyIndex,d=void 0===l?null:l;if("BUTTON"===r&&i){var p=u&&n.addresses.find((function(e){return e.addressID===u})),f=p&&p.keys.length>d&&p.keys[d],v=y[i];v&&v(p,f),s.dropdown("close")}}))),n.$on("$destroy",(function(){a.forEach((function(e){return e()})),a.length=0,l.removeEventListener("change",i)}))}}}C.$inject=["addressesModel","dispatchers","downloadFile","gettextCatalog","importPrivateKey","notification","Key","keysModel","exportKeyModal","exportPrivateKeyModal","reactivateKeyModal","confirmModal","unlockUser","networkActivityTracker","reactivateKeys","eventManager","generateModal","authentication","deleteKeyProcess","selectAddressModal","translator"];var w=C,O=n("MIlz");function M(e,t,n,r,a){var o=a((function(){return{getTitle:function(){return n.getString("This will add the {{email}} address to your account",{email:t.email()},"Info")}}}));return{restrict:"A",link:function(t,n){var a=r(),i=a.on,c=a.unsubscribe,s=!e.is("mobile")&&Object(O.a)(n,{title:o.getTitle()});i("tooltip",(function(e,t){"hideAll"===t.type&&s&&s.hide()})),t.$on("$destroy",(function(){s&&s.dispose(),c()}))}}}M.$inject=["AppModel","premiumDomainModel","gettextCatalog","dispatchers","translator"];var P=M;function x(e,t,n,r,a,i,s){var u=s((function(){return{success:n.getString("Keys reactivated",null,"Success"),reactivateKeys:n.getString("Reactivate keys",null,"Action")}})),l=e(["keys"]).dispatcher;return{replace:!0,scope:{contact:"<"},template:'<button class="reactivateKeysBtn-container pm_button">'.concat(u.reactivateKeys,"</button>"),restrict:"E",link:function(e,n){var s=function(){var n;t.activate({params:{submit:(n=c()(o.a.mark((function n(c){var s,u;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.get();case 2:s=n.sent,t.deactivate(),u=r.process(s,c).then((function(t){var n=t.success,r=t.failed;l.keys("reactivate",{contact:e.contact}),n&&i.success(n),r&&i.error(r)})),a.track(u);case 6:case"end":return n.stop()}}),n)}))),function(e){return n.apply(this,arguments)}),cancel:function(){t.deactivate()}}})};n.on("click",s),e.$on("$destroy",(function(){n.off("click",s)}))}}}x.$inject=["dispatchers","oldPasswordModal","gettextCatalog","reactivateKeys","networkActivityTracker","notification","translator"];var T=x,L=n("QILm"),j=n.n(L),N=n("9sRk"),R=n("7UbS");function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e,t,n,r,a,i,u,l){var d=1,p=2,f=l((function(){var e;return{success:{one:u.getString("Key reactivated",null,"Info"),many:function(e){return u.getString("{{n}} keys reactivated",{n:e},"Info")}},errors:(e={},v()(e,d,{one:u.getString("Incorrect decryption password",null,"Error"),many:function(e){return u.getString("{{n}} keys failed to decrypt due to an incorrect password",{n:e},"Error")}}),v()(e,p,{one:u.getString("Failed to reactivate key",null,"Error"),many:function(e){return u.getString("{{n}} keys failed to reactivate",{n:e},"Error")}}),e)}})),m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(0!==t.length)return t.length===n.length&&1===n.length?e.one:e.many(t.length)},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[d,p].map((function(t){var n=e.filter((function(e){return e.error===t}));return m(f.errors[t],n,n)})).filter(Boolean).join(", ")},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.error?e.failed.push(t):e.success.push(t),e}),{success:[],failed:[]})},b=function(){var e=c()(o.a.mark((function e(t){var n,i,c,s,u,l,f,v,m,g,h,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.addressID,i=t.salt,c=t.key,s=t.password,u=t.oldPassword,e.prev=1,l=c.ID,f=c.PrivateKey,e.next=5,Object(R.a)(u,i);case 5:return v=e.sent,e.next=8,Object(A.a)(f,v);case 8:return m=e.sent,e.next=11,Object(N.a)(m,s);case 11:return g=e.sent,e.next=14,a.signedKeyList(n,{mode:"create",decryptedPrivateKey:m,encryptedPrivateKey:g});case 14:return h=e.sent,e.next=17,r.reactivate(l,{PrivateKey:g,SignedKeyList:h});case 17:if(e.t0=e.sent,e.t0){e.next=20;break}e.t0={};case 20:return b=e.t0,c.decrypted=!0,e.abrupt("return",b);case 25:if(e.prev=25,e.t1=e.catch(1),!(e.t1 instanceof Error)){e.next=29;break}return e.abrupt("return",{error:d,key:c});case 29:return e.abrupt("return",{error:p,key:c});case 30:case"end":return e.stop()}}),e,null,[[1,25]])})));return function(t){return e.apply(this,arguments)}}();return{process:function(){var e=c()(o.a.mark((function e(){var t,a,c,s,u,l,d,p,v,y,E=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.length>0&&void 0!==E[0]?E[0]:[],a=E.length>1?E[1]:void 0,e.next=4,r.salts();case 4:c=e.sent,s=c.KeySalts,u=(void 0===s?[]:s).reduce((function(e,t){var n=t.ID,r=t.KeySalt;return e[n]=r,e}),{}),l=n.getPassword(),d=t.reduce((function(e,t){var n=t.addressID,r=t.keys.map((function(e){return{addressID:n,salt:u[e.ID],key:e,password:l,oldPassword:a}}));return e.concat(r)}),[]),p=[],v=0;case 12:if(!(v<d.length)){e.next=23;break}return e.t0=p,e.next=16,b(d[v]);case 16:return e.t1=e.sent,e.t0.push.call(e.t0,e.t1),e.next=20,i.call();case 20:++v,e.next=12;break;case 23:return y=h(p),e.abrupt("return",{success:m(f.success,y.success,d),failed:g(y.failed)});case 25:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),get:function(){var r=c()(o.a.mark((function r(){var a,i,c,u,l,d;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=n.user.Keys,i=void 0===a?[]:a,c=e.get(),r.next=4,t.getAddressKeys(c);case 4:return u=r.sent,l={addressID:s.sb,keys:i},d=function(e){return!e.decrypted},r.abrupt("return",u.concat(l).reduce((function(e,t){var n=t.keys,r=void 0===n?[]:n,a=j()(t,["keys"]),o=r.filter(d);return o.length?e.concat(U({keys:o},a)):e}),[]));case 8:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}()}}F.$inject=["addressesModel","addressKeysViewModel","authentication","Key","keysModel","eventManager","gettextCatalog","translator"];var B=F,K=n("J4zp"),G=n.n(K),V=n("vN+2"),q=n.n(V),H=n("UfWW"),z=n.n(H);function Y(e,t,n,r,a,i,u,l,d,p,f,v,m,g,h,b,y,E,S,D,A){var I=A(["addressModel","memberActions"]).dispatcher,C=D((function(){return{ERROR_DO_UPGRADE:t.getString("You have used all addresses in your plan. Please upgrade your plan to add a new address",null,"Error"),ERROR_MUST_BE_ADMIN:t.getString("Administrator privileges must be activated",null,"Error"),SUCCESS_DISABLED:t.getString("Address disabled",null,"Info"),SUCCESS_ENABLE:t.getString("Address enabled",null,"Info"),SUCCESS_REMOVE:t.getString("Address deleted",null,"Info"),SUCCESS_EDIT:t.getString("Address updated",null,"Info"),SUCCESS_ORDER:t.getString("Order saved",null,"Info"),DISABLE_MODAL:{title:t.getString("Disable address",null,"Title"),message:t.getString("Are you sure you want to disable this address?",null,"Info")},DELETE_MODAL:{title:t.getString("Delete address",null,"Title"),message:t.getString("Are you sure you want to delete this address?",null,"Info")},EDIT_MODAL:{title:t.getString("Name / Signature",null,"Title")},FREE_ADD_ERROR:t.getString('Please <a href="/dashboard">upgrade</a> to a paid account to use this feature',null,"Error")}})),w=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=i.get()||{},o=r.MaxAddresses,c=r.UsedAddresses,s=r.HasKeys;return o-c<1?(a.error(C.ERROR_DO_UPGRADE),!1):!(1===s&&u.get("keyStatus")>0&&!t.Private)||(a.error(C.ERROR_MUST_BE_ADMIN),n&&e.go("secured.members"),!1)},O=function(e,t){var n={pmDomains:[],domains:[e],members:[t]};return 0===t.Type&&(n.pmDomains=d.get().map((function(e){return{DomainName:e}}))),!e.ID&&(n.domains=n.pmDomains.concat(p.query())),!t.ID&&(n.members=f.getAll()),n},M=function(){var e=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.ID,0!==t.Status){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,y.disable(n);case 5:a.success(C.SUCCESS_DISABLED);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.getSelf();if(w(t,!1))return S.manageOne(e,t).then((function(t){var n=G()(t,1)[0],a=void 0===n?{}:n,o=r.getByUser(E.user),i=z()(o,(function(e){return e.ID===a.ID}));a.Receive=+(1===a.Status),-1!==i&&o.splice(i,1,a),I.addressModel("generateKey.success",{address:e})})).catch(q.a)}var x=function(e){var t=y.order({AddressIDs:e}).then(h.call).then((function(){return a.success(C.SUCCESS_ORDER)}));n.track(t)};return{add:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(E.user.Role===s.Z)return a.error(C.FREE_ADD_ERROR);var r=O(t,n),o=r.domains,c=r.members;if(!o||0===o.length)return e.go("secured.domains");if(w(n)){var l=u.get("organizationKey");v.activate({params:{domains:o,members:c,organizationKey:l,cancel:v.deactivate,addMember:function(){m.canAdd(u.get("keyStatus"))&&(v.deactivate(),g.activate({params:{organization:i.get(),organizationKey:l,domains:o,submit:function(e){I.memberActions("edit.success",{member:e,domains:o}),g.deactivate()},cancel:g.deactivate}}))},submit:function(e,n){v.deactivate();var r=function(){return I.addressModel("address.new",{address:e,member:n,domain:t})};if(!n.Private)return r(),P(e,n).then(h.call);h.call(),r()}}})}},disable:function(e){var t=e.ID;b.activate({params:{title:C.DISABLE_MODAL.title,message:C.DISABLE_MODAL.message,cancel:b.deactivate,confirm:function(){b.deactivate();var e=y.disable(t).then(h.call).then((function(){a.success(C.SUCCESS_DISABLED)}));n.track(e)}}})},enable:function(e){var t=e.ID,r=y.enable(t).then((function(){return h.call()})).then((function(){return a.success(C.SUCCESS_ENABLE)}));n.track(r)},generate:P,setup:function(e){var t=e.Domain,n=e.DisplayName,r=e.Signature,a=s.J,o=E.getPassword();return y.setup({Domain:t,DisplayName:n,Signature:r}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?{}:t;return l.generate({encryptionConfigName:a,passphrase:o,address:n.Address})})).then((function(){var e=[h.call(),d.fetch()];return E.user.Role===s.Mb&&e.push(f.fetch()),Promise.all(e)}))},makeDefault:function(e){var t=r.get(),n=z()(t,{ID:e.ID});t.splice(n,1),t.unshift(e);var a=k()(t,"ID");x(a)},remove:function(e){b.activate({params:{title:C.DELETE_MODAL.title,message:C.DELETE_MODAL.message,confirm:function(){b.deactivate();var t=M(e).then((function(){return Promise.all([h.call(),y.remove(e.ID)])})).then((function(){a.success(C.SUCCESS_REMOVE)})).then(h.call);n.track(t)},cancel:function(){b.deactivate()}}})},saveOrder:x}}Y.$inject=["$state","gettextCatalog","networkActivityTracker","addressesModel","notification","organizationModel","organizationKeysModel","generateKeyModel","pmDomainModel","domainModel","memberModel","addressModal","membersValidator","memberModal","eventManager","confirmModal","Address","authentication","addressWithoutKeysManager","translator","dispatchers"];var W=Y,X=n("k4Da"),J=n.n(X);function Q(e,t,n,r){var a=function(e){var t=e.Keys,n=e.Status;return!t.length&&1===n},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return J()(t,(function(t){return a(t)&&1===e.Private}))},i=function(e,n){var r=G()(e,1)[0];if(!r.Private)return r.Addresses;var a=t.getByUser(n).reduce((function(e,t){return e[t.ID]=!0,e}),{});return t.getByUser(n).concat(r.Addresses.filter((function(e){var t=e.ID;return!a[t]})))};return{get:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getAll(),a=arguments.length>2?arguments[2]:void 0;if(1===r.length&&!a){var c=i(r,n);return{addresses:o(n,c)}}return{addresses:o(n,t.getByUser(n))}},fromUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.user,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.get();return o(e,r)},allDirty:function(e){var n=t.getByUser(e);if(!1===r.get("allDirtyAddresses"))return!1;var o=n.filter((function(e){return e.Status})).every(a);return r.set("allDirtyAddresses",o),o}}}Q.$inject=["memberModel","addressesModel","authentication","AppModel"];var Z=Q,ee=n("pdRq"),te=n("63Ao"),ne=n("Ln+c");function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(e){var t=function(t){var n="contact-keys"===t?s.sb:t;return e.hasKey(t)?e.getPrivateKeys(n).filter((function(e){return e.isDecrypted()})):[]},n=function(){var e=c()(o.a.mark((function e(){var n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>0&&void 0!==a[0]?a[0]:[],e.next=3,Promise.all(n.map(function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.Keys,(r=void 0===n?[]:n).length){e.next=3;break}return e.abrupt("return",t);case 3:return a=G()(r,1),i=a[0],c=(i=void 0===i?{}:i).PrivateKey,e.t0=ae,e.t1={},e.t2=t,e.next=11,Object(ee.f)(c);case 11:return e.t3=e.sent,e.t4={keys:e.t3},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t4));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return r=e.sent,e.abrupt("return",r.reduce((function(e,n){var r=n.Keys,a=void 0===r?[]:r,o=n.keys,i=void 0===o?[]:o,c=n.ID,s=void 0===c?"":c,u=n.Email,l=void 0===u?"":u,d=n.Order,p=n.Status;if(!a.length)return e;var f=G()(a,1)[0],v=(f=void 0===f?{}:f).fingerprint,m=f.created,g=f.bitSize,h=G()(i,1)[0];if(!h)return e;var b=t(s).map(ee.e),y={order:d,addressID:s,email:l,status:p,fingerprint:v,algType:Object(ne.a)(a[0]),created:m,bitSize:g,publicKey:h.toPublic().armor(),keys:a.map((function(e){return ae({decrypted:b.some((function(t){return t===e.fingerprint})),algType:Object(ne.a)(e)},e)}))};return e.push(y),e}),[]));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{getUserKeys:function(){var e=c()(o.a.mark((function e(t){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.Keys.map(te.c));case 2:return r=e.sent,a={ID:"contact-keys",Email:t.Name,Order:1,Keys:r},e.abrupt("return",n([a]));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getAddressKeys:n}}oe.$inject=["keysModel"];var ie=oe;function ce(e,t,r,a,o,i,c,u,l,d,p,f,v){var m=f((function(){return{ERROR_DECRYPT_ORG_KEY:l.getString("Cannot decrypt organization key",null,"Error"),errorPmMeSetup:function(){return l.getString("{{username}} is your username. To create {{email}}, please go to Settings -> pm.me",{username:t.user.Name,email:p.email()},"Error")},SUCCESS_ADD:l.getString("Address added",null,"Info")}})),g=a(["domainModal"]).dispatcher;return r({controllerAs:"ctrl",templateUrl:n("/WHQ"),controller:["params",function(t){var n=this,r=t.domains,a=void 0===r?[]:r,l=t.organizationKey,f=void 0===l?null:l,h=t.members,b=void 0===h?[]:h,y=d.get(),E=e.get()||[],S=G()(E,1)[0],D=(S=void 0===S?{}:S).DisplayName,k=S.Signature;this.model={DisplayName:D||"",Signature:v.replaceLineBreaks(k||"")},this.domain=a[0],this.domains=a,this.address="",this.size=s.J,this.members=b,this.member=b[0],this.showAddMember=1===y.HasKeys&&o.is("secured.domains"),this.addMember=t.addMember,this.cancel=t.cancel,this.open=function(e){return g.domainModal(e,{domain:t.domain})},this.submit=function(){if(0===n.member.Private&&!f)return c.error(m.ERROR_DECRYPT_ORG_KEY);if(!e.hasPmMe()&&p.email()==="".concat(n.address,"@").concat(n.domain.DomainName))return c.error(m.errorPmMeSetup());var r=n.model,a={DisplayName:r.DisplayName,Signature:r.Signature,Local:n.address,Domain:n.domain.DomainName,MemberID:n.member.ID},o=u.create(a).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c.success(m.SUCCESS_ADD),t.submit(e.Address,n.member)}));i.track(o)}}]})}ce.$inject=["addressesModel","authentication","pmModal","dispatchers","$state","networkActivityTracker","notification","Address","gettextCatalog","organizationModel","premiumDomainModel","translator","tools"];var se=ce,ue=n("J2m7"),le=n.n(ue);function de(e,t,r,a,o){return e({controllerAs:"ctrl",templateUrl:n("XSdg"),controller:["params",function(e){var n=e.domain,i=e.members,c=e.step,s=e.showMember,u=void 0===s||s,l=r.get(),d=t(["domainModal"]).dispatcher;this.domain=n,this.step=c,this.showMember=u&&1===l.HasKeys,this.next=e.next,this.close=e.cancel,this.open=function(t){return d.domainModal(t,{domain:e.domain})},this.getMember=function(e){return le()(i,{ID:e})||{}},this.addAddress=function(){e.cancel(),a.add(n)},this.addMember=function(){e.cancel(),o.addFromDomain(n)}}]})}de.$inject=["pmModal","dispatchers","organizationModel","addressModel","memberActions"];var pe=de;function fe(e){return e({controllerAs:"ctrl",templateUrl:n("qKoh"),controller:["params",function(e){var t=this,n=e.submit,r=e.cancel,a=e.info;this.info=a,this.model={DisplayName:"",Signature:""},this.submit=function(){return n(t.model)},this.cancel=r}]})}fe.$inject=["pmModal"];var ve=fe;function me(e){return e({controllerAs:"ctrl",templateUrl:n("JDTy"),controller:["params",function(e){var t=this,n=e.submit,r=e.info,a=e.addresses;this.info=r,this.model={addresses:a,address:a[0]},this.submit=function(){return n(t.model.address)}}]})}me.$inject=["pmModal"];var ge=me;function he(e,t,n,r){var a=function(){var e=c()(o.a.mark((function e(t){var a,i,c,s,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.addresses,i=t.password,c=t.memberMap,s=void 0===c?{}:c,!a.length||n.active()){e.next=7;break}return u=r.get("organizationModel"),l=r.get("organizationKeysModel"),e.next=6,l.manage(u.get());case 6:return e.abrupt("return",new Promise((function(e,t){n.activate({params:{memberMap:s,password:i,addresses:a,organizationKey:l.get("organizationKey"),onSuccess:function(){r.get("eventManager").call(),e(a),n.deactivate()},close:function(){t(new Error("generateModal:close")),n.deactivate()}}})})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{manage:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.user,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2?arguments[2]:void 0,i=e.get(n,r,o),c=i.addresses,s=i.memberMap,u=t.getPassword();return a({addresses:c,memberMap:s,password:u})},manageOne:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getPassword(),o=[e],i=v()({},e.ID,n);return n.Private?a({addresses:o,password:r}):a({addresses:o,memberMap:i,password:r})}}}he.$inject=["addressWithoutKeys","authentication","generateModal","$injector"];var be=he;function ye(e,t,n,r,a,i,u,l,d,p,f){var v=p((function(){return{WARNING_TITLE:t.getString("Warning",null,"Title"),WARNING_MESSAGE:t.getString("This feature is intended for advanced users only!\n        After deleting this key, you will not be able to decrypt any message that is encrypted with this key.\n        It may lead to data loss. Are you sure you want to continue?",null,"Confirm message"),EXPORT_TITLE:t.getString("Key backup",null,"Title"),EXPORT_MESSAGE:t.getString("Deleting your keys is irreversible.\n        To be able to access any message encrypted with this key, you might want to make a back up of this key for later use.\n        Do you want to export this key?",null,"Confirm message"),EXPORT_ACTION:t.getString("Export",null,"Action"),SUCCES_NOTIFICATION:t.getString("Key deleted",null,"Success")}})),m=function(t,o){var i=o.PrivateKey;return new Promise((function(o,c){e.activate({params:{title:v.EXPORT_TITLE,message:v.EXPORT_MESSAGE,confirmText:v.EXPORT_ACTION,confirm:function(){e.deactivate(),function(e,t){return n().then((function(){return new Promise((function(n,o){return r.activate({params:{privateKey:t,export:function(t){var o=new Blob([t],{type:"data:text/plain;charset=utf-8;"}),i="privatekey."+e+s.ib;a(o,i),r.deactivate().then(n)},cancel:function(){r.deactivate().then(o)}}})}))}))}(t,i).then(o).catch(c)},cancel:function(){e.deactivate(),o()}}})}))},g=function(){var e=c()(o.a.mark((function e(t,n){var r,a,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.ID,a=t.PrivateKey,e.next=3,l.signedKeyList(n,{mode:"remove",encryptedPrivateKey:a});case 3:return c=e.sent,s=u.remove(r,{SignedKeyList:c}).then(i.call).then((function(){return d.success(v.SUCCES_NOTIFICATION)})),e.abrupt("return",f.track(s));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return{start:function(){var t=c()(o.a.mark((function t(n,r){var a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.email,i=n.addressID,t.next=3,new Promise((function(t){e.activate({params:{title:v.WARNING_TITLE,message:v.WARNING_MESSAGE,hookClose:function(e){return t("confirm"===e)},confirm:function(){e.deactivate("confirm")}}})}));case 3:if(!t.sent){t.next=10;break}if(t.t0=r.decrypted,!t.t0){t.next=9;break}return t.next=9,m(a,r);case 9:return t.abrupt("return",g(r,i));case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}}ye.$inject=["confirmModal","gettextCatalog","unlockUser","exportPrivateKeyModal","downloadFile","eventManager","Key","keysModel","notification","translator","networkActivityTracker"];var Ee=ye,Se=angular.module("proton.address",[]).directive("addressBtnActions",S).directive("addressKeysView",w).directive("pmMeTooltip",P).directive("reactivateKeysBtn",T).factory("reactivateKeys",B).factory("addressModel",W).factory("addressWithoutKeys",Z).factory("addressKeysViewModel",ie).factory("addressModal",se).factory("addressesModal",pe).factory("setupAddressModal",ve).factory("selectAddressModal",ge).factory("addressWithoutKeysManager",be).factory("deleteKeyProcess",Ee).name,De=n("gLAU"),ke=n.n(De);function Ae(e,t,r,a,o){return{scope:{model:"="},replace:!0,templateUrl:n("OtD5"),link:function(n,i){var c=a(["message.open"]),s=c.on,u=c.unsubscribe;n.dateFormat=t.dateFormat;var l=function(t){var r=t.target;if("BUTTON"===r.nodeName){var a=r.getAttribute("data-event-uid"),i=n.model.events.find((function(e){return e.uid===a}));if(i){if(e.isNotSupported(t))return!1;var c=i.attachment,s=c.filename,u=c.data;o(new Blob([void 0===u?"":u],{type:s}),s)}}};s("message.open",(function(e,a){var o=a.type,c=void 0===o?"":o,s=a.data;if("render"===c){var l=(void 0===s?{}:s).message;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=t.filterAttachmentsForEvents(e);if(a.length){i.removeClass("eventsAttachments-hidden"),n.model.events=a.map((function(e,t){return{uid:t}})),i.addClass("eventsAttachments-load");var o=t.load(a,n.model).then((function(e){i.remove("eventsAttachments-load"),n.$applyAsync((function(){n.model.events=e.filter(Boolean).filter((function(e,t,n){return n.findIndex((function(t){return t.uid===e.uid}))===t})),1===n.model.events.length&&ke()((function(){i[0].querySelector(".eventsAttachments-details").setAttribute("open","open")}))}))}));r.track(o)}}((void 0===l?{}:l).Attachments),u()}})),i.on("click",l),n.$on("$destroy",(function(){u(),i.off("click",l)}))}}}Ae.$inject=["attachmentDownloader","AttachmentEvent","networkActivityTracker","dispatchers","downloadFile"];var Ie=Ae,Ce=n("RIqP"),we=n.n(Ce),Oe=n("ijCd"),Me=n.n(Oe),Pe=n("btMZ"),xe=s.Gb.DEFAULT,Te=s.Gb.PLAINTEXT;var Le=function(){var e=["image/gif","image/jpeg","image/png","image/bmp"],t=function(e){return Object(Pe.i)()?"Text"!==e:e!==xe&&e!==Te&&"text/uri-list"!==e};return{isEmbedded:function(t){return Me()(e,t)},getEmbedded:function(){return e},isUploadAbleType:function(e){var n=e.dataTransfer,r=we()(n.types||[]);return!(Object(Pe.i)()&&!r.length)&&(Object(Pe.l)()?r.some((function(e){return"Files"===e})):r.every(t))},receivedUnencrypted:function(e){var t=e.Headers;return"on-delivery"===(void 0===t?{}:t)["x-pm-content-encryption"]},isUploadMIMEType:t}},je=n("628V"),Ne=n.n(je),$e=n("uS8r"),Re=n.n($e),_e=n("DwX5"),Ue=n.n(_e),Fe=n("tCnl"),Be=n.n(Fe),Ke=n("zdiy"),Ge=n.n(Ke),Ve=n("ID4j");He.$inject=["attachmentApi","AttachmentLoader","dispatchers","embedded","keysModel","networkActivityTracker","composerRequestModel","attachmentDownloader","gettextCatalog","SignatureVerifier","translator"];var qe=s.Gb.PLAINTEXT;function He(e,t,n,r,a,i,s,u,l,d,p){var f={},v={},m=p((function(){return{ERROR_UPLOAD:l.getString("Error during file upload",null,"Compose message"),ERROR_ENCRYPT:l.getString("Error encrypting attachment",null,"Compose message"),IMAGE:l.getString("Image",null,"Title")}})),g=n(["attachment.upload","actionMessage"]),h=g.on,b=g.dispatcher,y=function(e,t){return b["attachment.upload"](e,t)},E=function(e){return b.actionMessage("update",e)},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];v=e.reduce((function(e,t){return e[t.REQUEST_ID]=t,e}),v)},D=function(e,t){return v[t]?v[t].attachment:le()(e.Attachments,{ID:t})};h("attachment.upload",(function(t,n){var r,a,o=n.type,i=n.data;switch(o){case"close":e.killUpload(i);break;case"uploading":i.message.encryptingAttachment=!1,E(i.message);break;case"cancel":E(i.message);break;case"remove":M(i);break;case"remove.all":a=(r=i).message,r.list.map((function(e){return M({id:e.ID,attachment:e,message:a,packet:{Inline:+O(e)}})}));break;case"drop":!function(e){C.apply(this,arguments)}(i);break;case"upload":!function(e){var t=e.messageID,n=e.message,r=e.action;if("cancel"===r)return void delete f[t];w(f[t].files,n,r).then((function(){n.uploading=0,delete f[t]}))}(i);break;case"download.composer":!function(e){var t=e.id,n=e.message,r=v[t]||{attachment:n.getAttachment(t)};r.attachment&&u.download(r.attachment,n)}(i)}}));var A=function(){var e=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.file.name.match(/\.asc$/i)&&t.file.size<51200&&"application/pgp-keys"!==t.file.type)){e.next=12;break}return e.prev=1,e.next=4,Object(I.d)(t.file);case 4:return n=e.sent,e.next=7,Object(ee.f)(n);case 7:t.file=Ge()(new Blob([n],{type:"application/pgp-keys"}),t.file),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(1);case 12:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}();function C(){return(C=c()(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.messageID,r=t.message,(a=t.queue).files.length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Promise.all(a.files.map(A));case 5:f[n]=a,a.hasEmbedded||y("upload",{messageID:n,message:r,action:"attachment"});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"attachment",u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=k()(n,(function(n,i,s){var u=n.file,d=n.isEmbedded;return u.inline=+(d&&"inline"===c),function(n,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s={filename:n.name||"".concat(m.IMAGE," ").concat(o.Attachments.length+1),uploading:!0,Size:n.size,ContentID:c};n.inline&&(o.NumEmbedded++,s.ContentID=c||r.generateCid(n.upload.uuid,o.From.Email),s.Inline=1);var u=a.getPrivateKeys(o.AddressID);o.attachmentsToggle=!0;return t.load(n,o.From.Keys[0].PublicKey,u).then((function(t){return e.upload(t,o,s,i).then((function(e){var n=e.attachment,r=e.sessionKey,a=e.REQUEST_ID;if(!e.isAborted){var o="".concat((n.Headers||{})["content-id"]||"").replace(/[<>]+/g,"");return{attachment:n,sessionKey:r,packets:t,cid:o,REQUEST_ID:a}}}))}))}(u,o,s.length,l)}));o.uploading=d.length,o.encryptingAttachment=!0,E(o);var p=s.add(o,(function(){return Promise.all(d).then((function(e){return e.filter(Boolean)})).then((function(e){o.uploading=0,o.encryptingAttachment=!1,E(o);var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Be()(Ue()((function(e){var t=e.attachment;return O(void 0===t?{}:t)})),Ue()((function(e){return e.cid})),Re()((function(e){var n=e.packets,a=e.attachment,o=e.sessionKey,i=e.cid,c=e.REQUEST_ID;return{packets:n,sessionKey:o,attachment:a,cid:i,url:r.addEmbedded(t,i,n.Preview,a.MIMEType).url,REQUEST_ID:c}})),Ne()((function(e,t){return e[t.attachment.ID]=t,e}),{}))(e)}(e,o);return k()(e,(function(e){return t[e.attachment.ID]||e}))})).then((function(e){return o.addAttachments(e.map((function(e){return e.attachment}))),S(e),u&&e.length&&y("upload.success",{upload:e,message:o,messageID:o.ID}),e})).catch((function(e){throw E(o),e}))}));return i.track(p),p}function O(e){var t=e.Headers;return"inline"===(void 0===t?{}:t)["content-disposition"]}function M(t){var n=t.id,r=t.message,a=t.packet,o=t.messageID,i=r||{ID:o},c=t.attachment||D(i,n);return e.remove(i,c).then((function(){var e,o=function(e,t){return v[e]?v[e]:J()(v,(function(e){return e.attachment.ID===t.ID}))[0]}(n,c),i=Ge()({},o||t,{message:r,attachment:c,id:n});1===a.Inline&&r.MIMEType!==qe&&y("remove.embedded",i),r.removeAttachment(c),y("remove.success",i),e=i.REQUEST_ID,delete v[e]})).catch((function(e){y("remove.error",{message:r,exception:e,attachment:c,id:n})}))}function P(){return(P=c()(o.a.mark((function n(r,i){var c,s,u,l;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c=a.getPrivateKeys(i.AddressID),n.next=3,t.get(r,i);case 3:return s=n.sent,n.next=6,Object(Ve.h)({data:s,privateKeys:c,armor:!0,detached:!0});case 6:return u=n.sent,l=u.signature,r.Signature=l,n.next=11,e.updateSignature(r);case 11:return n.next=13,d.verify(r,s,i);case 13:return n.abrupt("return",r);case 14:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return{create:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return w([{file:e,isEmbedded:n}],t,n&&"inline",!1,r).then((function(e){var n=G()(e,1)[0];return t.uploading=0,n})).catch((function(e){throw console.error(e),e}))},getCurrentQueue:function(e){var t=e.ID;return f[t]},sign:function(e,t){return P.apply(this,arguments)}}}var ze=He,Ye=n("xkGU"),We=n.n(Ye);function Xe(e,t){var n={},r={},a={},o=e(["embeddedStore"]),i=o.on,c=o.dispatcher,s="draft_",u=function(){return window.URL||window.webkitURL};function l(e){var t=!!e.isDraft&&e.isDraft();return"".concat(t?s:"").concat(e.ConversationID||e.ID).trim()}function d(e){var t=r[e]||[];We()(t,(function(e){n[e]&&(u().revokeObjectURL(n[e].url),delete n[e])})),delete r[e]}i("composer.update",(function(e,t){var n=t.type,o=t.data;if("close"===n){var i=(void 0===o?{}:o).message,c=i.ID,u=i.ConversationID,l="".concat(s).concat(u||c);a[c]&&delete a[c],r[l]&&d(l)}}));var p=function(e){return n[e]||{}},f=function(e){var t=e.ID;return a[t]||{}};return{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isDraft:angular.noop},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=a[e.ID]||{},i=o[t]||{},s=i.Headers,d=void 0===s?{}:s,p=l(e);return r[p]=r[p]||[],function(e,a){if(r[p]){var o=new Blob([e],{type:a}),i=u().createObjectURL(o);n[t]={url:i,isContentLocation:void 0!==d["content-location"]&&void 0===d["content-id"]},o=null,i=null,r[p].push(t),c.embeddedStore("store",{cid:t})}}},deallocate:function(){var e=l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});Object.keys(r).filter((function(t){return t!==e&&0!==t.indexOf(s)})).forEach(d)},getBlob:p,hasBlob:function(e){return!!n[e]},getBlobValue:function(e){var n=p(e).url;return t.getBlobFromURL(n)},cid:{contains:function(e){var t=e.ID;return Object.keys(a[t]||{}).length>0},exist:function(e,t){return!!f(e)[t]},add:function(e,n){var r=n.Headers,o=void 0===r?{}:r,i=n.Name,c=void 0===i?"":i;!a[e.ID]&&(a[e.ID]={}),!e.NumEmbedded&&(e.NumEmbedded=0);var s=t.readCID(o);o.embedded=1,e.NumEmbedded++,a[e.ID][s]={Headers:o,Name:c}},get:f}}}Xe.$inject=["dispatchers","embeddedUtils"];var Je=Xe,Qe=n("P/G1"),Ze=n.n(Qe);function et(e,t,r,a){var o,i=(o={},v()(o,s.uc.SIGNED_AND_VALID,"listAttachments-signed-ok"),v()(o,s.uc.SIGNED_AND_INVALID,"listAttachments-signed-fail"),o);return{scope:{message:"=",attachment:"="},replace:!0,templateUrl:n("TEKn"),link:function(n,o){var c=r(),s=c.on,u=c.unsubscribe,l=o[0],d=t.readCID(n.attachment.Headers),p=function(){var t=e.getVerificationStatus(n.attachment);n.$applyAsync((function(){var e=i[t];Ze()(i).filter((function(t){return t!==e})).forEach((function(e){return l.classList.remove(e)})),e&&l.classList.add(e)}))};s("attachmentVerified",(function(e,t){var r=t.type,a=t.data.message;"verified"===r&&(void 0===a?{}:a).ID===n.message.ID&&p()})),s("attachmentLoader",(function(e,n){var r=n.type,a=n.data.attachment,o=void 0===a?{}:a;"download"===r&&d&&(t.readCID(o.Headers)===d&&p())})),s("embeddedStore",(function(e,t){var n=t.type,r=t.data.cid;"store"===n&&d&&(void 0===r?null:r)===d&&p()})),n.message.isPGPInline()&&a.receivedUnencrypted(n.attachment)&&l.classList.add("listAttachments-unencrypted"),p(),n.$on("$destroy",u)}}}et.$inject=["SignatureVerifier","embeddedUtils","dispatchers","attachmentFileFormat"];var tt=et;function nt(e){return{scope:{model:"="},replace:!0,templateUrl:n("Pbhj"),link:function(t,n){var r=function(){return n[0].classList.remove("btnDownloadAttachments-load")},a=function(a){if(e.isNotSupported(a))return!1;n[0].classList.add("btnDownloadAttachments-load"),e.all(t.model,n[0]).then(r)};n.on("click",a),t.$on("$destroy",(function(){n.off("click",a)}))}}}nt.$inject=["attachmentDownloader"];var rt=nt;function at(e){var t={zip:"fa-archive-o",mp3:"fa-audio-o",javascript:"fa-code-o",xls:"fa-excel-o",mov:"fa-movie-o",pdf:"fa-pdf-o",power:"fa-powerpoint-o",word:"fa-word-o"},r={"pgp-keys":"fa-key"};return{replace:!0,templateUrl:n("ZyxI"),link:function(n,a){var o,i,c=[].concat(function(t){if(e.isEmbedded(t))return["fa-picture-o","embedded"];var n=["fa-file-o"];return t.MIMEType.includes("image")&&n.push("fa-image-o"),n}(n.attachment)).concat((o=n.attachment,i=o.MIMEType,Object.keys(t).filter((function(e){return i.includes(e)})).reduce((function(e,n){return e.push(t[n]),e}),[]))),s=function(e){var t=e.MIMEType;return Object.keys(r).filter((function(e){return t.includes(e)})).reduce((function(e,t){return e.push(r[t]),e}),[])}(n.attachment),u=a[0].querySelector(".file-outer-icon"),l=a[0].querySelector(".file-inner-icon");_rAF((function(){c.forEach((function(e){return u.classList.add(e)})),s.forEach((function(e){return l.classList.add(e)}))}))}}}at.$inject=["embedded"];var ot=at;function it(e,t,r){return{scope:{model:"="},replace:!0,templateUrl:n("S9Fb"),link:function(n,a){var o=a[0].querySelector(".listAttachments-list"),i=function(){return!n.model.Attachments.length&&a[0].classList.add("hidden")},c=t(["attachment.upload.outside"]),s=c.on,u=c.dispatcher,l=c.unsubscribe;s("attachmentAdded",(function(){return n.model.Attachments.length&&a[0].classList.remove("hidden")})),i(),e.is("eo.reply")&&a[0].classList.add("state-eoReply");var d=function(t){var a=t.target,o=["A","BUTTON"].includes(a.parentNode.nodeName)?a.parentNode:a;if("A"===o.nodeName){var c=o.getAttribute("data-attachment-id"),s=le()(n.model.Attachments,{ID:c});o.classList.add("listAttachments-item-decrypt"),r.isNotSupported(t),r.download(s,n.model,o).then((function(){o.classList.add("listAttachments-item-download")})).catch((function(){o.classList.remove("listAttachments-item-decrypt")}))}if("BUTTON"===o.nodeName){var l=o.getAttribute("data-attachment-id");e.is("eo.reply")&&u["attachment.upload.outside"]("remove",{id:o.getAttribute("data-attachment-id"),message:n.model}),n.$applyAsync((function(){1===(le()(n.model.Attachments,{ID:l}).Headers||{}).embedded&&n.model.NumEmbedded--,n.model.Attachments=n.model.Attachments.filter((function(e){return e.ID!==l})),i()}))}};o.addEventListener("click",d,!1),n.$on("$destroy",(function(){o.removeEventListener("click",d,!1),l()}))}}}it.$inject=["$state","dispatchers","attachmentDownloader"];var ct=it,st=n("FaOd"),ut=n("Kv4S"),lt=n("dG5C");function dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dt(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ft(e,t,n,r,a,i,s,u,l,d,p){var f=p((function(){return{encrypt:d.getString("Failed to encrypt attachment. Please try again.",null,"Error"),missing:d.getString("You did not provide a file.",null,"Error")}})),v=e(["attachmentLoader"]).dispatcher,m=t("attachments"),g=function(e){var t=e.ID;return"attachment.".concat(t)},h=function(){return r.is("eo.message")||r.is("eo.reply")},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ID;if(h()){var n=s.getToken(),r=a.tag;return i.attachment(n,r,t)}return u.get(t)},y=function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,c,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},r=new Uint8Array(t),e.prev=2,e.t0=st.b,e.next=6,Object(Ve.e)(r);case 6:return e.t1=e.sent,e.t2=[n],e.t3={message:e.t1,sessionKeys:e.t2,format:"binary"},e.next=11,(0,e.t0)(e.t3);case 11:return a=e.sent,i=a.data,c=a.signatures,e.abrupt("return",{data:i,signatures:c,fromCache:!1});case 17:throw e.prev=17,e.t4=e.catch(2),console.error(e.t4),e.t4;case 21:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,c,s,u,l,d,p,f,v,m,g=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:{},i=a.name,c=a.type,s=a.size,u=a.inline,e.t0=ut.a,e.t1=i,e.t2=t,e.next=6,Object(ee.f)(n);case 6:return e.t3=e.sent,e.t4=r,e.t5={filename:e.t1,armor:!1,detached:!0,data:e.t2,publicKeys:e.t3,privateKeys:e.t4},e.next=11,(0,e.t0)(e.t5);case 11:return l=e.sent,d=l.message,p=l.signature,e.next=16,Object(Ve.i)(d);case 16:return f=e.sent,v=f.asymmetric,m=f.encrypted,e.abrupt("return",{Filename:i,MIMEType:c,FileSize:s,Inline:u,signature:p?p.packets.write():void 0,Preview:t,keys:v[0],data:m[0]});case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function S(){return(S=c()(o.a.mark((function e(t,n,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new TypeError(f.missing);case 2:return e.prev=2,e.next=5,Object(I.c)(t);case 5:return a=e.sent,e.abrupt("return",E(new Uint8Array(a),n,r,t));case 9:throw e.prev=9,e.t0=e.catch(2),new Error(f.encrypt);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}var D=function(){var e=c()(o.a.mark((function e(t,r){var a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.sessionKey){e.next=2;break}return e.abrupt("return",r);case 2:return a=Object(lt.d)(Object(lt.g)(r.KeyPackets)),e.next=5,Object(Ve.e)(a);case 5:return e.t0=e.sent,i={message:e.t0},h()?i.passwords=[s.getPassword()]:i.privateKeys=n.getPrivateKeys(t.AddressID),e.next=10,Object(A.b)(i);case 10:return c=e.sent,e.abrupt("return",pt({},r,{sessionKey:c}));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=c()(o.a.mark((function e(t,n){var r,a,i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(n);case 2:return r=e.sent,a=r.data,e.prev=4,e.next=7,D(t,n);case 7:return i=e.sent,c=i.sessionKey,e.next=11,y(a,c);case 11:return s=e.sent,m.put(g(n),s),e.abrupt("return",s);case 16:return e.prev=16,e.t0=e.catch(4),u=Object(lt.e)([Object(lt.d)(Object(lt.g)(n.KeyPackets)),new Uint8Array(a)]),e.abrupt("return",Promise.reject({data:u,error:e.t0}));case 20:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t,n){return e.apply(this,arguments)}}(),C=function(){var e=c()(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=m.get(g(n)))){e.next=3;break}return e.abrupt("return",pt({},r,{fromCache:!0}));case 3:return e.abrupt("return",k(t,n));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=c()(o.a.mark((function e(){var t,n,r,a,i,c,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2&&void 0!==s[2]&&s[2],!t.Preview){e.next=5;break}return e.abrupt("return",t.Preview);case 5:return e.next=7,C(n,t);case 7:if(a=e.sent,i=a.data,c=a.signatures,!a.fromCache||r){e.next=13;break}return e.abrupt("return",i);case 13:return e.next=15,l.verify(t,i,n,c);case 15:return v.attachmentLoader("download",{message:n,attachment:t}),e.abrupt("return",i);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{put:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n&&l.put(e.ID,n),m.put(g(e),{data:t})},get:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(e,t,!1)},reverify:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(e,t,!0)},load:function(e,t,n){return S.apply(this,arguments)},has:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!m.get(g(e))},flushCache:function(){return m.removeAll()},getSessionKey:D}}ft.$inject=["dispatchers","$cacheFactory","keysModel","$state","$stateParams","Eo","eoStore","attachmentApi","SignatureVerifier","gettextCatalog","translator"];var vt=ft,mt=n("RT6a"),gt=n.n(mt),ht=n("xaJk"),bt=n.n(ht),yt=n("OFL0"),Et=n.n(yt);function St(e,t,n){var r=s.uc.NOT_VERIFIED,a=s.uc.NOT_SIGNED,i=s.uc.SIGNED_AND_INVALID,u=s.uc.SIGNED_NO_PUB_KEY,l=s.uc.SIGNED_AND_VALID,d=e(["attachmentVerified"]).dispatcher,p={},f=function(e,t){return p[e]=t},v=function(e){var r,a=e.Sender.Address||(r=e.AddressID,Be()(Ue()({Status:1,Receive:1}),gt()({ID:r}))(t.get()).Email);return n.get([a],!0).then((function(e){return e[a]}))},m=function(e,t,n){var r=Object(Ve.c)(e),a=t.map((function(e){return Object(Ve.j)({message:r,publicKeys:n,signature:e}).then((function(e){return e.verified}))}));return Promise.all(a)};return{verify:function(){var e=c()(o.a.mark((function e(t,n,r){var c,s,g,h,b,y,E,S,D,k=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=k.length>3&&void 0!==k[3]?k[3]:[],s=t.ID,!(g=t.Signature)){e.next=9;break}return e.next=5,Object(Ve.f)(g);case 5:e.t1=e.sent,e.t0=[e.t1],e.next=10;break;case 9:e.t0=c;case 10:if((h=e.t0).length){e.next=14;break}return f(s,a),e.abrupt("return",p[s]);case 14:return e.next=16,v(r);case 16:return b=e.sent,y=b.reduce((function(e,t){var n=t.key;return!t.compromised&&e.push(n),e}),[]),e.next=20,m(n,h,y);case 20:return E=e.sent,S=bt()(E,(function(e,t){return e===l?l:t}),a),D=b&&b.length||S!==i?S:u,f(s,D),d.attachmentVerified("verified",{message:r,attachment:t,status:D}),e.abrupt("return",D);case 26:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),getVerificationStatus:function(e){var t=e.ID,n=void 0===t?"":t;return Et()(p,n)?p[n]:r},put:f}}St.$inject=["dispatchers","addressesModel","publicKeyStore"];var Dt=St,kt=n("UeCU"),At=n.n(kt);function It(e,t,n){var r=n((function(){return{ICS_PARSING_ERROR:t.getString("ICS parsing error:",null,"Error")}})),a=/\.(?:ics|icalendar|ical|vcard|vcf)$/i,o=function(t,n){return e.downloadString(t,n).then((a=t,o=a.Name,function(e){try{var t=At.a.parse(e),n=new At.a.Component(t).getFirstSubcomponent("vevent"),a=new At.a.Event(n);if(!n)return!1;var i=a.attendees,c=void 0===i?[]:i;return a.startDate&&a.endDate&&(a.startDateMoment=moment(a.startDate.toJSDate()),a.endDateMoment=moment(a.endDate.toJSDate())),c.length&&(a.attendeesList=c.reduce((function(e,t){return e.concat(t.getValues())}),[])),!a.summary&&a.location&&(a.summary=a.location),a.attachment={filename:o,data:e},a}catch(s){throw new Error("".concat(r.ICS_PARSING_ERROR," ").concat(s.message))}})).catch((function(e){return console.error(e),!1}));var a,o};return{dateFormat:function(e){var t=e.startDateMoment,n=e.endDateMoment,r=e.startDate,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!moment.isMoment(t)||!moment.isMoment(n))return"";var o=a&&r.timezone?"(".concat(r.timezone,")"):"";return n.diff(t,"days")<1?"".concat(t.format("ll")," ").concat(t.format("LT")," – ").concat(n.format("LT")," ").concat(o):"".concat(t.format("ll")," ").concat(t.format("LT")," – ").concat(n.format("ll")," ").concat(n.format("LT")," ").concat(o)},filterAttachmentsForEvents:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(e){var t=e.Name;return a.test(t)}))},load:function(e,t){return Promise.all(e.map((function(e){return o(e,t)})))}}}It.$inject=["attachmentDownloader","gettextCatalog","translator"];var Ct=It,wt=n("LMli"),Ot=n("tutT");function Mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mt(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xt(e,t,n,r,a,i,s){var u={message:{},request:{}},l=t.build("attachments"),d=r(["attachment.upload"]).dispatcher,p=function(e,t){return d["attachment.upload"](e,t)},f=function(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{json:e,isInvalid:t}};try{return t(JSON.parse(e.responseText))}catch(n){return t({Error:"JSON parsing error: ".concat(e.responseText)},!0)}};return{get:function(t){return e.get(l(t),{responseType:"arraybuffer"})},upload:function(e,t,d,m){var g=Object(Ot.k)(),h=function(e,t,n){return function(r,a){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];p("uploading",{id:e,messageID:t.ID,message:t,status:a,progress:r,packet:n,isStart:o})}}(g,t,d),b=n.defer(),y=new XMLHttpRequest,E=a.getPrivateKeys(t.AddressID),S=r(),D=S.on,k=S.unsubscribe;D("AppModel",(function(e,t){var n=t.type,r=t.data;"onLine"!==n||(void 0===r?{}:r).value||y.abort()}));var I={id:g,messageID:t.ID,packet:d,request:y};function C(e){delete u.message[t.ID][g],delete u.request[g],t.uploading=Object.keys(u.message[t.ID]).length,p("error",{id:g,messageID:t.ID,message:t}),b.reject(e),k()}return u.message[t.ID]=Pt({},u.message[t.ID]||{},v()({},g,I)),u.request[g]=u.message[t.ID][g],h(1,!0,!0),y.upload.onprogress=function(e){var t=e.loaded/e.total*99;h(t,!0)},y.onerror=C,y.onabort=function(){delete u.message[t.ID][g],delete u.request[g],t.uploading=Object.keys(u.message[t.ID]).length,p("cancel",{id:g,messageID:t.ID,message:t}),b.resolve({id:g,isAborted:!0}),k()},y.onload=function(){var n=c()(o.a.mark((function n(){var r,a,i,c,l,v,S;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=f(y),a=r.json,i=r.isInvalid,c=this.status,k(),200===c&&!a.Error){n.next=6;break}return l=i?s.getString("Unable to upload file. Please try again",null,"Error"):a.Error,n.abrupt("return",C(Pt({},a,{Error:l})));case 6:return h(100,!1),p("uploaded.success",{id:g,messageID:t.ID,packet:d,total:m,message:t}),delete u.message[t.ID][g],delete u.request[g],n.prev=10,n.next=13,Object(Ve.e)(e.keys);case 13:return v=n.sent,n.next=16,Object(A.b)({message:v,privateKeys:E});case 16:S=n.sent,b.resolve({REQUEST_ID:g,sessionKey:S,attachment:Pt({},a.Attachment||{},{sessionKey:S})}),n.next=23;break;case 20:n.prev=20,n.t0=n.catch(10),b.reject(n.t0);case 23:case"end":return n.stop()}}),n,this,[[10,20]])})));return function(){return n.apply(this,arguments)}}(),y.open("post",l(),!0),y.withCredentials=!0,y.setRequestHeader("X-Requested-With","XMLHttpRequest"),y.setRequestHeader("Accept","application/vnd.protonmail.v1+json"),y.setRequestHeader("x-pm-appversion","Web_"+wt.a.app_version),y.setRequestHeader("x-pm-apiversion",wt.a.api_version),y.setRequestHeader("x-pm-uid",i.getUID()),y.send(function(e,t,n){var r=new FormData;return r.append("Filename",e.Filename||n.filename),r.append("MessageID",t.ID),r.append("ContentID",n.ContentID),r.append("MIMEType",e.MIMEType),r.append("KeyPackets",new Blob([e.keys])),r.append("DataPacket",new Blob([e.data])),e.signature&&r.append("Signature",new Blob([e.signature])),r}(e,t,d)),b.promise},updateSignature:function(t){var n=t.ID,r=t.Signature;return e.put(l(n,"signature"),{Signature:r})},killUpload:function(e){var t=e.id,n=e.messageID;u.request[t].request.abort(),delete u.message[n][t],delete u.request[t]},remove:function(){var t=c()(o.a.mark((function t(){var n,r,a,i,c,s,u=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=u.length>0&&void 0!==u[0]?u[0]:{},r=n.ID,a=u.length>1&&void 0!==u[1]?u[1]:{},t.next=4,e.delete(l(a.ID),{MessageID:r});case 4:return i=t.sent,c=i.data,s=void 0===c?{}:c,t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}}xt.$inject=["$http","url","$q","dispatchers","keysModel","authenticationStore","gettextCatalog"];var Tt=xt;function Lt(e,t){var n=function(e,t,n){return"".concat("PGPAttachment","_").concat(e.ID,"_").concat(t.checksum,"_").concat(n)};return function(r,a,o){return k()(a,(function(a,i){return function(r,a,o,i){var c,u,l,d,p,f,v,m,g,h,b,y,E,S={ID:n(r,a,o),Headers:(c=a,u=c.generatedFileName,l=void 0===u?"":u,d=c.contentDisposition,p=void 0===d?"":d,f=c.contentId,v=void 0===f?"":f,m=c.transferEncoding,g=void 0!==m&&m,h=c.contentType,b=void 0===h?"":h,y={},E="; filename="+JSON.stringify(l),y["content-disposition"]=p+E,/^.*@mailparser$/.test(v)||(y["content-id"]=/^<.*>$/.test(v)?v:"<".concat(v,">")),"inline"===p.toLowerCase()&&(y.embedded=1),g&&(y["content-transfer-encoding"]=g),y["content-type"]=b+E,y),Name:a.generatedFileName,KeyPackets:null,MIMEType:a.contentType,Signature:null,Size:a.length,Encrypted:s.Q.PGP_MIME};return e.put(S,a.content,i),t.askAgain(r,S,!1),S}(r,a,i,o)}))}}Lt.$inject=["AttachmentLoader","invalidSignature"];var jt=Lt,Nt=n("Iab2"),$t=n.n(Nt),Rt=n("fDnD"),_t=n.n(Rt);function Ut(e,t,n,r,a,i,u,l){var d=Object(Pe.g)(),p=l((function(){return{OPEN_ATTACHMENT_ON_MOBILE:e.getString("Please tap and hold on the attachment and select Open in New Tab.",null,"Info"),OPEN_ATTACHMENT_ON_DESKTOP:e.getString("Please right-click on the attachment and select Save/Download As.",null,"Info"),NOT_SUPPORTED:e.getString("Your browser lacks features needed to download encrypted attachments directly.",null,"Error"),BROKEN_ATT:{title:e.getString("Error decrypting attachment",null,"Title"),message:(t=e.getString("The attachment will be downloaded but it will still be encrypted.",null,"Error"),n=e.getString("You can decrypt the file with a program such as {{link}} if you have the corresponding private key.",{link:'<a href="https://www.gnupg.org/" target="_blank" title="GnuPG is a free implementation of OpenPGP">GPG</a>'},"Info"),"".concat(t,"<br><br>").concat(n)),confirmText:e.getString("Download",null,"Action")},ERROR_ZIP:e.getString("Cannot generate a zip of your attachments.",null,"Error")};var t,n})),f=function(e,t,n){try{if(d)return $t()(e,t);var r=new FileReader;r.onloadend=function(){n.href=r.result},r.readAsDataURL(e)}catch(a){console.error(a)}},v=function(e){return"Attachments-".concat(e.Subject,".zip")},m=function(){var e=c()(o.a.mark((function e(t,n){var r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e){return 1===e.length?e[0]:{Name:v(t),MIMEType:"application/zip",ID:"ZIP_"+t.ID}},Pe.g){e.next=3;break}return e.abrupt("return");case 3:if(k()(n,(function(e){return i.getVerificationStatus(e)})).some((function(e){return e===s.uc.SIGNED_AND_INVALID}))){e.next=6;break}return e.abrupt("return");case 6:return c=r(n),e.next=9,a.confirm(t,c);case 9:n.forEach((function(e){return a.askAgain(t,e,!1)}));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=c()(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(t,[n]);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return");case 8:f(new Blob([n.data],{type:n.MIMEType}),n.Name,n.el);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),h=function(){return new Promise((function(e){var t=Ge()({isWarning:!0,confirm:function(){e(!0),u.deactivate()},cancel:function(){e(!1),u.deactivate()}},p.BROKEN_ATT);u.activate({params:t})}))},b=function(){var e=c()(o.a.mark((function e(n,r,a){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.get(n,r);case 3:return i=e.sent,e.abrupt("return",{el:a,data:i,Name:n.Name,MIMEType:n.MIMEType,ID:n.ID});case 7:if(e.prev=7,e.t0=e.catch(0),!e.t0.data){e.next=11;break}return e.abrupt("return",{el:a,data:e.t0.data,Name:"".concat(n.Name,".pgp"),MIMEType:"application/pgp",isError:!0,ID:n.ID});case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),y=function(e){var t=e.Attachments;return(void 0===t?[]:t).reduce((function(e,t){if(e.map[t.Name]){e.map[t.Name].index++;var n=t.Name.split("."),r=n.pop(),a="".concat(n.join(".")," (").concat(e.map[t.Name].index,").").concat(r);t.Name=a}else e.map[t.Name]={index:0};return e.list.push(t),e}),{list:[],map:{}}).list.map((function(t){return b(t,e)}))};return{isNotSupported:function(e){return!((!e.target.href||-1===e.target.href.search(/^data.*/))&&d)&&(alert("".concat(p.NOT_SUPPORTED," ").concat(Object(Pe.k)()?p.OPEN_ATTACHMENT_ON_MOBILE:p.OPEN_ATTACHMENT_ON_DESKTOP)),e.preventDefault(),e.stopPropagation(),!0)},download:function(){var e=c()(o.a.mark((function e(t,n,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(t,n,r);case 2:if(!(a=e.sent).isError){e.next=8;break}return e.next=6,h();case 6:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:return e.abrupt("return",g(n,a));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),all:function(){var e=c()(o.a.mark((function e(){var t,n,a,i,c,s,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=u.length>1?u[1]:void 0,e.prev=2,a=y(t),e.next=6,Promise.all(a);case 6:return i=e.sent,e.prev=7,e.next=10,m(t,i);case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(7),e.abrupt("return");case 15:if(!i.some((function(e){return e.isError}))){e.next=20;break}return e.next=18,h();case 18:if(e.sent){e.next=20;break}return e.abrupt("return");case 20:return c=new _t.a,i.forEach((function(e){var t=e.Name,n=e.data;return c.file(t,n)})),e.next=24,c.generateAsync({type:"blob"});case 24:s=e.sent,f(s,v(t),n),e.next=32;break;case 28:e.prev=28,e.t1=e.catch(2),console.error(e.t1),r.error(p.ERROR_ZIP);case 32:case"end":return e.stop()}}),e,null,[[2,28],[7,12]])})));return function(){return e.apply(this,arguments)}}(),downloadString:function(e,n){return t.get(e,n).then((function(e){return Object(lt.h)(Object(lt.b)(e))}))}}}Ut.$inject=["gettextCatalog","AttachmentLoader","embeddedUtils","notification","invalidSignature","SignatureVerifier","confirmModal","translator"];var Ft=Ut,Bt=n("rbCz"),Kt=n("YrcJ");function Gt(e,t,n,r){var a=/^cid:/g,i=document.createElement("DIV");return{parser:function(){var t=c()(o.a.mark((function t(r){var a,c,s,u,l,d,p,f,v=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=v.length>1&&void 0!==v[1]?v[1]:{},c=a.direction,s=void 0===c?"blob":c,u=a.text,l=void 0===u?"":u,d=a.isOutside,p=void 0!==d&&d,f=l||r.getDecryptedBody(),i.innerHTML=Object(Kt.a)(f),e.find(r,i)){t.next=8;break}if(!p){t.next=7;break}return n.mutateHTML(r,s,i),t.abrupt("return",Object(Kt.k)(i.innerHTML));case 7:return t.abrupt("return",f);case 8:return t.next=10,n.decrypt(r);case 10:return n.mutateHTML(r,s,i),t.abrupt("return",Object(Kt.k)(i.innerHTML));case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),addEmbedded:function(e,n,r,a){return t.store(e,n)(r,a),t.getBlob(n)},getUrl:function(e){var n=e.getAttribute("data-embedded-img")||"";if(Object(Bt.d)(n))return n;var a=r.srcToCID(e),o=t.getBlob(a).url;return void 0===o?"":o},getAttachment:function(n,r){return function(o){var i=o.replace(a,"");if(e.find(n,r))return t.cid.get(n)[i]||{}}},isEmbedded:r.isEmbedded,getCid:r.readCID,getBlob:t.getBlobValue,deallocator:t.deallocate,clean:t.cleanMemory,removeEmbedded:n.removeEmbeddedHTML,exist:t.cid.exist,generateCid:r.generateCid}}Gt.$inject=["embeddedFinder","embeddedStore","embeddedParser","embeddedUtils"];var Vt=Gt;function qt(e,t){return{find:function(n,r){var a=n.getAttachments();return n.NumEmbedded=0,!!a.length&&(t.extractEmbedded(a,r).forEach((function(t){e.cid.add(n,t)})),e.cid.contains(n))},listInlineAttachments:function(n){var r=n.getAttachments(),a=e.cid.get(n);return Object.keys(a).reduce((function(e,n){var o=a[n].Headers["content-id"],i=t.getAttachementName(a[n].Headers),c=r.find((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Headers,n=void 0===t?{}:t,r=e.Name,a=void 0===r?"":r;return n["content-id"]?n["content-id"]===o:!!n["content-location"]&&a===i}));return c&&e.push({cid:n,attachment:c}),e}),[])}}}qt.$inject=["embeddedStore","embeddedUtils"];var Ht=qt;function zt(e,t,n,r,a,o,i){var c={blob:function(e,t,n){We()(e,(function(e){e.removeAttribute("data-src"),e.getAttribute("proton-src")||(e.setAttribute("data-src",n),e.setAttribute("data-embedded-img",t),e.classList.add("proton-embedded"))}))},cid:function(e,t){We()(e,(function(e){e.removeAttribute("data-embedded-img"),e.removeAttribute("src"),e.setAttribute("data-src","cid:".concat(t))}))}},u=function(e,t){Promise.all(k()(t,(function(t){var n=t.attachment;return r.get(n,e).then((function(){return o(angular.noop,1e3,!1)})).then((function(){return a.askAgain(e,n,!1)}))})))};return{mutateHTML:function(t,r,a){Object.keys(e.cid.get(t)).forEach((function(t){var o=n.findEmbedded(t,a);if(o.length){var i=e.getBlob(t).url,s=void 0===i?"":i;(c[r]||angular.noop)(o,t,s)}}))},removeEmbeddedHTML:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=n.readCID(t),o=$("<div>".concat(r,"</div>")),i=o.find('img[src="cid:'.concat(a,'"], img[data-embedded-img="cid:').concat(a,'"], img[data-embedded-img="').concat(a,'"]'));return i.length&&i.remove(),o.html()},decrypt:function(n){var a=t.listInlineAttachments(n),o=!0===n.showEmbedded||i.get("ShowImages")&s.P,c=o?a:J()(a,(function(e){var t=e.attachment;return r.has(t)})),l=Be()(Ue()((function(e){var t=e.attachment;return t.KeyPackets||t.Encrypted===s.Q.PGP_MIME})),Ue()((function(t){var n=t.cid;return!e.hasBlob(n)&&o})),Re()((function(t){var a=t.cid,o=t.attachment,i=e.store(n,a);return r.get(o,n).then((function(e){return i(e,o.MIMEType)}))})))(a);return l.length?Promise.all(l).then((function(){return u(n,c),a.reduce((function(t,n){var r=n.cid;return t[r]=e.getBlob(r),t}),Object.create(null))})):(u(n,c),Promise.resolve({}))}}}zt.$inject=["embeddedStore","embeddedFinder","embeddedUtils","AttachmentLoader","invalidSignature","$timeout","mailSettingsModel"];var Yt=zt,Wt=n("O4yn"),Xt=n.n(Wt),Jt=[{selector:'a:not([href^="http"])',attribute:"href"},{selector:'img:not([src^="http"]):not([proton-src^="cid"])',attribute:"proton-src"}],Qt=function(e){var t=e.getAttribute("href");return"/"!==t.substr(-1,1)?"".concat(t,"/"):t};var Zt=function(e){var t=e.querySelector("base");if(!t||!t.getAttribute("href"))return e;var n=Qt(t),r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r.startsWith("http")||e.setAttribute(t,n+r)};return Jt.forEach((function(t){var n=t.selector,a=t.attribute;[].slice.call(e.querySelectorAll(n)).forEach((function(e){var t="proton-".concat(a),n=e.getAttribute(a)||"",o=e.getAttribute(t)||"",i="/"===n.charAt(0)?n.slice(1):n;!o&&r(e,a,i),o&&r(e,t,o)}))})),e},en=n("Te9D"),tn=n.n(en),nn=n("lFrY"),rn=function(e){var t=e.querySelectorAll(".pre, pre, code");return We()(t,(function(e){"PRE"!==e.nodeName&&"CODE"!==e.nodeName||e.childElementCount?function e(t){We()(t.children,(function(t){if(t.childElementCount)return e(t);/proton-/g.test(t.textContent)&&(t.textContent=t.textContent.replace(/proton-/g,""))}))}(e):e.textContent=e.textContent.replace(/proton-/g,"")})),e},an="(".concat(["svg","xlink:href","srcset=","src=","data-src=","background=","poster="].join("|"),")"),on='("'.concat('(\\\\.|[^"\\\\])','*")'),cn="(?=(".concat('([^"><\\\\]|\\\\[^><])',"|").concat(on,")*>)"),sn=new RegExp("([^-])"+an+cn,"gi"),un=new RegExp('(style\\s*=\\s*")((?:(?:[^"\\\\]|\\\\.)*))(")'+cn,"gi"),ln=new RegExp("((url)(\\(|&(#40|#x00028|lpar);))","gi"),dn=function(e,t){return"user.inject"===t?e:e.replace(un,(function(e,t,n,r){return"".concat(t).concat((a=n,o=Object(Ot.i)(a),i=o!==a,c=o.replace(/\\r/g,"r").replace(ln,"proton-url("),c===o?a:i?tn()(c):c)).concat(r);var a,o,i,c}))};function pn(e,t,n){return e.replace(/src="data:image\/([a-zA-Z]*);base64,([^\"]*)\"/g,(function(e){var r=Object(Ot.k)();return n&&t.put(r,e),'data-proton-replace-base="'.concat(r,'"')}))}var fn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.action,r=t.cache,a=t.activeCache,o=void 0===a||a,i=pn(e,r,o),c=i.replace(sn,"$1proton-$2"),s=Object(nn.html)(dn(c,n));return rn(Zt(s))},vn="(".concat(["svg"].join("|"),")"),mn='("'.concat('(\\\\.|[^"\\\\])','*")'),gn="(?=(".concat('([^"><\\\\]|\\\\[^><])',"|").concat(mn,")*>)"),hn=new RegExp("([^-])"+vn+gn,"gi");function bn(e,t,n){return e.replace(/src="data:image\/([a-zA-Z]*);base64,([^\"]*)\"/g,(function(e){var r=Object(Ot.k)();return n&&t.put(r,e),'data-proton-replace-base="'.concat(r,'"')}))}function yn(e,t){return We()(e.querySelectorAll("[data-proton-replace-base]"),(function(e){var n=e.getAttribute("data-proton-replace-base"),r=(t.get(n)||"").replace(/^src="/,"").replace(/"$/,"").replace(/\n/,"");r&&e.setAttribute("src",r),e.removeAttribute("data-proton-replace-base")})),e.innerHTML}function En(e,t){var n=$.parseHTML("<div>".concat(e,"</div>"));return yn(G()(n,1)[0],t)}function Sn(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(hn,"$1proton-$2")}var Dn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.action,r=t.cache,a=t.activeCache,o=void 0===a||a;if(Object(Pe.i)())return fn(e,{action:n,cache:r,activeCache:o});var i=bn(e,r,o),c="user.inject"!==n;return Zt(Object(nn.protonizer)(Sn(i),c))};function kn(e,t,n){var r=/^cid:/g,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).filter((function(e){return e.startsWith("content")})).reduce((function(t,n){var r=n.split("-"),a=G()(r,2)[1];return t["content".concat(Object(Ot.h)(a))]=e[n],t}),Object.create(null));return{formatted:Xt.a.factory(t),headers:t}},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Dn(e,{action:"",activeCache:t,isDocument:!1,cache:n})};function i(e){var t="".concat(e||"").trim();return['"',"'","<"].indexOf(t.charAt(0))>-1&&['"',"'",">"].indexOf(t.charAt(t.length-1))>-1?t.substr(1,t.length-2):t}var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e["content-id"]?i(e["content-id"]):e["content-location"]?i(e["content-location"]):""},s=function(e,t){if(!e)return[];var n=['img[src="'.concat(e,'"]'),'img[src="cid:'.concat(e,'"]'),'img[data-embedded-img="'.concat(e,'"]'),'img[data-embedded-img="cid:'.concat(e,'"]'),'img[data-src="cid:'.concat(e,'"]'),'img[proton-src="cid:'.concat(e,'"]')];return[].slice.call(t.querySelectorAll(n.join(", ")))};return{findEmbedded:s,isEmbedded:function(t){var n=t.Headers,r=void 0===n?{}:n,a=t.MIMEType,i=void 0===a?"":a,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=u?o(u):document.createElement("DIV"),d=c(r),p=s(d,l);return p.length&&e.isEmbedded(i)},extractEmbedded:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e.filter((function(e){var n=e.Headers,r=c(void 0===n?{}:n);return s(r,t).length}))},getAttachementName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("inline"!==e["content-disposition"]){var t=a(e),n=t.formatted,r=void 0===n?{}:n,o=r.contentDisposition()||{},i=o.params,c=(i=void 0===i?{}:i).filename;if(c)return c.replace(/"/g,"")}return""},generateCid:function(e,n){var r=Object(Ot.g)(t.hash(e),4),a=n.split("@")[1];return"".concat(r,"@").concat(a)},srcToCID:function(e){return(e.getAttribute("data-embedded-img")||"").replace(r,"")},readCID:c,trimQuotes:i,getBodyParser:o,getBlobFromURL:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=new XMLHttpRequest;return new Promise((function(n,r){t.open("GET",e,!0),t.responseType="blob",t.onload=function(){if(200===t.status)return n(t.response);r(t.response)},t.send()}))}}}kn.$inject=["attachmentFileFormat","tools","cacheBase64"];var An=kn;function In(e,t,n){var r=function(e){return e.Encrypted===s.Q.PGP_MIME},a=function(){var r=c()(o.a.mark((function r(a,i,c){var s,u,l;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.get(a);case 2:return s=r.sent,u=new Blob([s]),l=t.readCID(a.Headers),u.name=a.Name,l&&(u.inline=Number(t.isEmbedded(a,c))),r.abrupt("return",n.create(u,i,1===u.inline,l));case 8:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}(),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.length){var n=e.getDecryptedBody(),r=t.map((function(t){return a(t,e,n)}));return Promise.all(r)}};return{handle:function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t,t.pgpMimeAttachments);case 2:delete t.pgpMimeAttachments;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),clean:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(e){return!r(e)}))},filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(r)}}}In.$inject=["AttachmentLoader","embeddedUtils","attachmentModel"];var Cn=In;function wn(e,t){var n={},r=function(e,t,r){var a=e.ID,o=t.ID;return n[a+o]=!r};return{confirm:function(a,o){return new Promise((function(i,c){n[a.ID+o.ID]?i():t.activate({params:{icon:"fa fa-warning confirm-warning-icon",learnMore:s.mb.DIGITAL_SIGNATURE,title:e.getString("Invalid attachment signature",null,"Title"),message:e.getString("Do you still want to download <strong>{{name}}</strong>?",{name:o.Name},"Info"),confirm:function(){t.deactivate(),r(a,o,!1),i()},cancel:function(){t.deactivate(),r(a,o,!0),c()}}})}))},askAgain:r}}wn.$inject=["gettextCatalog","confirmModal"];var On=wn;var Mn=function(){return{scope:{},replace:!0,restrict:"E",templateUrl:n("JTJO"),link:function(e,t,n){var r=n.attendee,a=void 0===r?"":r;a.toLowerCase().startsWith("mailto:")?t[0].appendChild(function(e){var t=e.substr(7),n=t.indexOf("?"),r=n<0?t:t.substr(0,n),a=document.createElement("a");return a.href=e,a.textContent=r,a.classList.add("attendeeItem-mailto-link"),a}(a)):t[0].textContent=a}}},Pn=angular.module("proton.attachments",["proton.authentication","proton.utils"]).directive("attendeeItem",Mn).directive("btnDownloadAttachments",rt).directive("iconAttachment",ot).directive("eventsAttachments",Ie).directive("listAttachments",ct).factory("attachmentFileFormat",Le).factory("attachmentModel",ze).factory("embeddedStore",Je).directive("attachmentElement",tt).directive("btnDownloadAttachments",rt).factory("AttachmentLoader",vt).factory("SignatureVerifier",Dt).factory("AttachmentEvent",Ct).factory("attachmentApi",Tt).factory("attachmentConverter",jt).factory("attachmentDownloader",Ft).factory("pgpMimeAttachments",Cn).factory("embedded",Vt).factory("embeddedFinder",Ht).factory("embeddedParser",Yt).factory("embeddedUtils",An).factory("invalidSignature",On).name;function xn(e,t,r,a,o){var i=[{label:r.DURATION_FOREVER,value:e.constants.FOREVER},{label:r.DURATION_FIXED,value:e.constants.FIXED_INTERVAL},{label:r.DURATION_DAILY,value:e.constants.DAILY},{label:r.DURATION_WEEKLY,value:e.constants.WEEKLY},{label:r.DURATION_MONTHLY,value:e.constants.MONTHLY}];return{replace:!0,restrict:"E",templateUrl:n("RtZx"),scope:{},link:function(t,n,r){var c=r.mock,s=a(["autoresponder"]),u=s.dispatcher,l=s.unsubscribe,d=s.on;t.mock="true"===c,t.frequencies=i,t.datetimepickerStartTime="startTimePickerKey",t.datetimepickerEndTime="endTimePickerKey",t.submitting=!1,t.model={IsEnabled:!1,Message:null,Repeat:0,Subject:null,StartTime:null,EndTime:null,DaysSelected:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0}};t.isValid=function(){return!t.model.IsEnabled||!(null!==(n=t.model.Message)&&0===$(n).text().trim().length)&&t.model.Message.length<e.constants.MAX_MESSAGE_LENGTH&&(t.model.Repeat===e.constants.FOREVER||null!==t.model.StartTime&&null!==t.model.EndTime);var n};var p=function(){t.mock||t.$applyAsync((function(){t.submitting=!0,u.autoresponder("save",{autoresponder:t.model})}))};t.timezones=e.timezones,t.mock?(d("autoresponder",(function(e,n){var r=n.type,a=n.data,o=void 0===a?{}:a;"update"===r&&t.$applyAsync((function(){t.model=o.autoresponder}))})),e.mock()):(d("autoresponder",(function(e,n){var r=n.type,a=n.data,i=void 0===a?{}:a;switch(r){case"update":t.$applyAsync((function(){t.model=i.autoresponder}));break;case"saved_success":t.$applyAsync((function(){t.submitting=!1}));break;case"saved_error":var c=(o.get("AutoResponder")||{}).IsEnabled;t.$applyAsync((function(){t.model.IsEnabled=c,t.submitting=!1}))}})),d("mailSettings",(function(t,n){var r=n.type;"updated"===(void 0===r?"":r)&&e.load()})),d("autoresponder.toggle",(function(t,n){var r=n.data.status;e.willUpdate(r)&&(e.set({IsEnabled:r}),r||p())})),e.load());var f=n.find("form");f.on("submit",p),t.$on("$destroy",(function(){l(),f.off("submit",p)}))}}}xn.$inject=["autoresponderModel","timepickerModel","autoresponderLanguage","dispatchers","mailSettingsModel"];var Tn=xn;function Ln(e,t){return{replace:!0,restrict:"E",templateUrl:n("1yF2"),scope:{message:"="},link:function(n,r,a){var o=a.disabled,i=t(),c=i.on,s=i.unsubscribe;n.disabled="true"===o,n.halfMessageLength=e.constants.HALF_MESSAGE_LENGTH,n.maxMessageLength=e.constants.MAX_MESSAGE_LENGTH,n.isEmpty=function(e){return null!==e&&0===$(e).text().trim().length},c("autoresponder",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"update"===r&&(n.message=o.autoresponder.Message)})),n.$on("$destroy",s)}}}Ln.$inject=["autoresponderModel","dispatchers"];var jn=Ln;function Nn(e,t,r){return{replace:!0,restrict:"E",templateUrl:n("3B0g"),scope:{form:"="},link:function(n,a,o){var i=o.datePickerKey,c=o.labelId,s=o.repeat,u=o.zone,l=o.timestamp,d=o.disableInput,p=t(),f=p.on,m=p.unsubscribe;n.repeat=Number(s),n.timestamp=String(Number(l))===l?Number(l):null,n.disableInput="true"===d,n.zone=u,n.constants=e.constants,n.labelId=c,n.datePickerKey=i,Number(s)===e.constants.DAILY&&r.initTimePicker(i,{disableInput:d,labelId:c}),f("timepicker",(function(t,r){var a=r.type,o=r.data;"update"===a&&o.eventKey===i&&(n.timestamp=o.timestamp,e.set(v()({},c,o.timestamp)))})),f("autoresponder",(function(t,a){var o=a.type,s=a.data,u=void 0===s?{}:s;if("update"===o){var l=u.autoresponder.Repeat!==n.repeat||n.timestamp!==u.autoresponder[c];n.repeat=u.autoresponder.Repeat,n.timestamp=u.autoresponder[c],n.zone=u.autoresponder.Zone,u.autoresponder.Repeat===e.constants.DAILY&&r.initTimePicker(i,{disableInput:d,labelId:c}),l&&r.refresh(n.datePickerKey,n.timestamp,n.zone)}})),n.$on("$destroy",m)}}}Nn.$inject=["autoresponderModel","dispatchers","timepickerModel"];var $n=Nn;function Rn(e,t,r){return{replace:!0,restrict:"E",templateUrl:n("/AKp"),scope:{form:"="},link:function(n,a,o){var i=o.mock,c=r(),s=c.on,u=c.unsubscribe;n.days=t.getDays("short"),n.constants=e.constants,n.timezones=e.timezones,n.mock="true"===i,n.model=e.get(),s("autoresponder",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"update"===r&&(n.model=o.autoresponder)})),s("multiselect",(function(t,n){var r=n.type,a=n.data,o=a.name,i=a.value;"update"===r&&"autoresponder.DaysSelected"===o&&e.set({DaysSelected:i})})),n.$on("$destroy",u)}}}Rn.$inject=["autoresponderModel","dateUtils","dispatchers"];var _n=Rn;function Un(e){return{replace:!0,restrict:"E",templateUrl:n("CC6w"),scope:{},link:function(t){t.isFree=e().isFree}}}Un.$inject=["userType"];var Fn=Un;function Bn(e,t,r){var a=[{label:t.DURATION_FIXED,value:e.constants.FIXED_INTERVAL},{label:t.DURATION_DAILY,value:e.constants.DAILY},{label:t.DURATION_WEEKLY,value:e.constants.WEEKLY},{label:t.DURATION_MONTHLY,value:e.constants.MONTHLY},{label:t.DURATION_FOREVER,value:e.constants.FOREVER}];return{replace:!0,restrict:"E",templateUrl:n("ETDH"),scope:{},link:function(t,n,o){var i=o.disableInput,c=o.repeat,s=r(),u=s.on,l=s.unsubscribe;function d(){t.$applyAsync((function(){e.set({Repeat:t.repeat.value})}))}t.frequencies=a,t.repeat=le()(t.frequencies,{value:Number(c)}),"true"===i&&n.attr("disabled","disabled"),u("autoresponder",(function(e,n){var r=n.type,a=n.data,o=void 0===a?{}:a;"update"===r&&(t.repeat=le()(t.frequencies,{value:o.autoresponder.Repeat}))})),n.on("change",d),t.$on("$destroy",(function(){n.off("change",d),l()}))}}}Bn.$inject=["autoresponderModel","autoresponderLanguage","dispatchers"];var Kn=Bn;function Gn(e,t){return{replace:!0,restrict:"E",template:'<select id="time-zone" name="time-zone" ng-options="zone.label for zone in timezones track by zone.value" ng-model="zone"></select>',scope:{},link:function(n,r,a){var o=a.zone,i=a.disableInput,c=t(),s=c.on,u=c.unsubscribe;n.timezones=e.timezones,"true"===i&&r.attr("disabled","disabled"),n.zone=le()(n.timezones,{value:o});var l=function(){n.$applyAsync((function(){return e.set({Zone:n.zone.value})}))};s("autoresponder",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"update"===r&&(n.zone=le()(n.timezones,{value:o.autoresponder.Zone}))})),r.on("change",l),n.$on("$destroy",(function(){r.off("change",l),u()}))}}}Gn.$inject=["autoresponderModel","dispatchers"];var Vn=Gn,qn=n("d8FT"),Hn=n.n(qn);function zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e,t,n,r,a,o,i,c){var s=n(["autoresponder"]),u=s.dispatcher,l=s.on,d=new Date,p=moment(d),f=k()(moment.tz.names(),(function(e){var t=p.tz(e).format("Z");return{label:"".concat(e,": UTC ").concat(t),value:e}})),m={FIXED_INTERVAL:0,DAILY:1,WEEKLY:2,MONTHLY:3,FOREVER:4,HALF_MESSAGE_LENGTH:2048,MAX_MESSAGE_LENGTH:4096,HOUR:3600,DAY:86400},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){return e[t]=!0,e}),Ge()({},we()(new Array(7)).map((function(){return!1}))))},h={},b=function(e){return h=Ge()({},h,e)},y=function(){return h={}},E=function(){var e=Ge()({},r.get("AutoResponder")),t=e.IsEnabled,n=e.StartTime,a=e.EndTime,o=e.DaysSelected,i=e.Repeat,c=e.Subject,s=e.Message,u=e.Zone;return t?{IsEnabled:t,StartTime:n,EndTime:a,DaysSelected:g(o),Repeat:i,Subject:c,Message:s,Zone:u}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zn(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},A())},S=function(){return Ge()({},E(),h)},D=function(e,t){return u.autoresponder(e,t)};function A(){var t={IsEnabled:!1,StartTime:Math.floor(Date.now()/1e3)+m.HOUR,EndTime:null,DaysSelected:g([0,1,2,3,4,5,6]),Repeat:m.FIXED_INTERVAL,Subject:e.DEFAULT_SUBJECT_PREFIX,Message:null,Zone:moment.tz.guess()},n=e.DEFAULT_BODY,r=c.insert({getDecryptedBody:function(){return n}},{action:"new",isAfter:!0}).replace(/<img[^>]*>/g,"");return r.length>m.MAX_MESSAGE_LENGTH?t.Message=n:t.Message=r,t}function I(e){var t=Ge()({},e),n=S(),r=Ge()({},n,t);if(r.Zone!==n.Zone&&r.Repeat===m.FIXED_INTERVAL){var a=r.StartTime,o=r.EndTime,i=n.Zone,c=t.Zone;null!==a&&(t.StartTime=Number(moment.tz(moment.tz(1e3*a,i).format("YYYY-MM-DDTHH:mm:ss"),c).format("X"))),null!==o&&(t.EndTime=Number(moment.tz(moment.tz(1e3*o,i).format("YYYY-MM-DDTHH:mm:ss"),c).format("X")))}if(void 0!==t.Repeat&&n.Repeat!==t.Repeat){var s=t.Repeat===m.FOREVER;t.StartTime=s?0:null,t.EndTime=s?0:null,t.Repeat===m.FIXED_INTERVAL&&(t.StartTime=Math.floor(Date.now()/1e3)+m.HOUR),void 0===t.DaysSelected&&(t.DaysSelected={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0})}b(t);var u=S();D("update",{autoresponder:u})}function C(){var n,r,c=function(){var e=S();return e.DaysSelected=Object.keys(Hn()(e.DaysSelected,Boolean)).map(Number),e.Repeat===m.FOREVER&&(e.StartTime=0,e.EndTime=0),e}(),s=E(),u=(n=s.IsEnabled,r=c.IsEnabled,n===r?e.AUTORESPONDER_UPDATED_MESSAGE:r?e.AUTORESPONDER_INSTALLED_MESSAGE:e.AUTORESPONDER_REMOVED_MESSAGE),l=i.updateAutoresponder({Parameters:c}).then((function(e){return t.call().then((function(){return e}))})).then((function(e){D("saved_success",e),o.success(u)})).catch((function(e){return D("saved_error",{Error:e})}));a.track(l)}return l("autoresponder",(function(e,t){var n=t.type,r=t.data;"save"===n&&(I((void 0===r?{}:r).autoresponder),C())})),l("autoresponder.isEnabled",(function(e,t){I({IsEnabled:t.data.status})})),{init:angular.noop,constants:m,load:function(){y(),D("update",{autoresponder:S()})},mock:function(){var e=A();e.IsEnabled=!0,e.Repeat=0,e.StartTime=Math.floor(Date.now()/1e3),e.EndTime=e.StartTime+7*m.DAY+8*m.HOUR,b(e);var t=S();D("update",{autoresponder:t})},get:S,set:I,timezones:f,willUpdate:function(e){return(r.get("AutoResponder")||{}).IsEnabled!==e}}}Yn.$inject=["autoresponderLanguage","eventManager","dispatchers","mailSettingsModel","networkActivityTracker","notification","settingsMailApi","signatureBuilder"];var Wn=Yn;function Xn(e,t){var n=t((function(){return{AUTORESPONDER_UPDATED_MESSAGE:e.getString("Autoresponder updated",null,"Success"),AUTORESPONDER_INSTALLED_MESSAGE:e.getString("Autoresponder installed",null,"Success"),AUTORESPONDER_REMOVED_MESSAGE:e.getString("Autoresponder removed",null,"Success"),DEFAULT_BODY:e.getString("<div>I'm out of the office with limited access to my email.</div>",null,"Default autoresponder message without signature (no regards, etcetera)"),DURATION_FOREVER:e.getString("Permanent",null,"Duration/repetition of autoresponder"),DURATION_FIXED:e.getString("Fixed duration",null,"Duration/repetition of autoresponder"),DURATION_DAILY:e.getString("Repeat daily",null,"Duration/repetition of autoresponder"),DURATION_WEEKLY:e.getString("Repeat weekly",null,"Duration/repetition of autoresponder"),DURATION_MONTHLY:e.getString("Repeat monthly",null,"Duration/repetition of autoresponder")}}));return n.DEFAULT_SUBJECT_PREFIX="Auto",n}Xn.$inject=["gettextCatalog","translator"];var Jn=Xn,Qn=angular.module("proton.autoresponder",[]).directive("autoresponder",Tn).directive("autoresponderMessage",jn).directive("autoresponderTimePicker",$n).directive("autoresponderTimeSection",_n).directive("autoresponderView",Fn).directive("durationselect",Kn).directive("zoneselect",Vn).factory("autoresponderModel",Wn).factory("autoresponderLanguage",Jn).name,Zn=n("sEfC"),er=n.n(Zn),tr=n("yDfg");rr.$inject=["$scope","$state","$stateParams","$timeout","addressesModel","AppModel","cache","composerFromModel","composerRequestModel","confirmModal","dispatchers","embedded","eventManager","extractDataURI","attachPublicKey","gettextCatalog","hotkeys","mailSettingsModel","messageBuilder","messageModel","networkActivityTracker","notification","outsidersMap","postMessage","prepareDraft","pgpMimeAttachments","sendMessage","validateMessage","recipientsFormator","dynamicStates"];var nr=s.Gb.PLAINTEXT;function rr(e,t,n,r,a,i,u,l,d,p,f,v,m,g,h,b,y,E,S,D,k,A,I,C,w,O,M,P,x,T){var L=f(["composer.update","messageActions","actionMessage","editorListener","elements","tooltip"]),j=L.dispatcher,N=L.on,R=L.unsubscribe;e.messages=[],e.uid=1;var _=function(){var e=c()(o.a.mark((function e(t){var n,r,a,i=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],r=i.length>2&&void 0!==i[2]&&i[2],a=D(t),e.next=5,v.parser(a,{direction:"cid"});case 5:return a.Body=e.sent,e.abrupt("return",C(a,{notification:n,autosaving:r}).then((function(){t.AddressID=a.AddressID})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,c,s,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=D(t),r=function(e){return n.sending=e,t.sending=e},n.Password=n.Password||"",n.PasswordHint=n.PasswordHint||"",e.prev=4,e.next=7,P.checkSubject(n);case 7:return e.next=9,x.format(n);case 9:return a=e.sent,i=a.ToList,c=a.CCList,s=a.BCCList,u=Object(tr.t)({ToList:i,CCList:c,BCCList:s}),e.next=16,P.checkExpiration(n,u);case 16:n.ToList=i,n.CCList=c,n.BCCList=s,e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(4),j.editorListener("send.failed",{message:n}),e.abrupt("return",console.error(e.t0));case 25:r(!0),z(n),l=P.validate(n).then(m.stop).then((function(){return g(n)})).then((function(){return h.attach(n)})).then((function(){return M(n)})).then(m.start).catch((function(e){return h.remove(n).then((function(){throw r(!1),n.encrypting=!1,z(n),j.editorListener("send.failed",{message:n}),m.start(),e}))})),k.track(l).then(m.call);case 29:case"end":return e.stop()}}),e,null,[[4,21]])})));return function(t){return e.apply(this,arguments)}}(),F=function(e,t){var n=e.ID,r=e.ConversationID,a=i.get("composerList")||[];if(!t)return i.store("composerList",(a.push({ID:n,ConversationID:r}),a));i.store("composerList",a.filter((function(e){return e.ID!==n})))},B=e.$watch("messages.length",(function(){e.messages.length>0?(i.set("activeComposer",!0),window.onbeforeunload=function(){return b.getString("By leaving now, you will lose what you have written in this email. You can save a draft if you want to come back to it later on.",null,"Info")},y.pause()):(i.set("activeComposer",!1),window.onbeforeunload=void 0,1===E.get("Hotkeys")?y.unpause():y.pause())}));N("updateUser",(function(){e.addresses=a.get()})),N("onDrag",(function(){We()(e.messages,(function(t){e.togglePanel(t,"attachments")}))})),N("deleteConversation",(function(t,n){var r=n.data;We()(e.messages,(function(e){r===e.ID&&Y(e)}))})),N("app.event",(function(t,n){var r=n.type,a=n.data;switch(r){case"activeMessages":var o=e.messages.filter((function(e){var t=e.ID,n=void 0===t?"":t,r=le()(a.messages,{ID:n});return r&&Object(tr.q)(r)}));o.length&&o.forEach((function(e){Y(e),!Object(tr.q)(e)&&A.info(b.getString("Email was already sent",null,"Info"))}))}})),N("message.refresh",(function(t,n){var r=n.data;e.messages.forEach((function(e){var t=e.ID;if(r.indexOf(t)>-1){var n=u.getMessageCached(t);n&&(e.Time=n.Time,e.ConversationID=n.ConversationID)}}))})),N("composer.new",function(){var e=c()(o.a.mark((function e(t,n){var r,a,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.type,a=n.data,c=void 0===a?{}:a,G()||!i.is("onLine")||!P.canWrite()){e.next=11;break}return e.next=5,w.getMessage(c.message);case 5:return s=e.sent,e.t0=q,e.next=9,S.create(r,s,c.isAfter);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),N("composer.load",function(){var t=c()(o.a.mark((function t(n,r){var a,i,c,s,l,d;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.data.ID,i=le()(e.messages,{ID:a}),c=G(),!i&&!c){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,u.queryMessage(a);case 7:return s=t.sent,t.next=10,s.clearTextBody();case 10:return l=s.isPlainText()&&s.isDraft(),d=l?s:S.prepare(s,"reply"),t.next=14,q(d);case 14:return t.next=16,F(d);case 16:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),N("hotkeys",(function(t,n){"save"===n.type&&e.$applyAsync((function(){var t=le()(e.messages,{focussed:!0});t&&j.editorListener("pre.save.message",{message:t})}))})),N("composer.update",(function(t,n){var r=n.type,a=n.data;switch(r){case"loaded":F(a.message);break;case"editor.focus":var o=a.message;a.isMessage&&e.$applyAsync((function(){o.autocompletesFocussed=!1,o.attachmentsToggle=!1,o.ccbcc=!1}));break;case"autosave.message":e.saveLater(a.message);break;case"save.message":_(a.message,!0,!1);break;case"send.message":U(a.message);break;case"send.success":Y(a.message);break;case"close.message":var i=a.save,c=a.message;if(!i)return Y(c);_(c,!0,!1).then((function(){Y(c)}));break;case"close.panel":e.closePanel(a.message)}})),N("message",(function(e,t){var n=t.type,r=t.data.message;"updated"===n&&C(r,{autosaving:!0})})),N("attachment.upload",(function(e,t){var n=t.type,r=t.data;"remove.success"===n&&r.message.MIMEType!==nr&&C(r.message,{autosaving:!0})}));var K=er()((function(){j["composer.update"]("refresh",{size:e.messages.length})}),1e3);function G(){var t=e.messages.length>=s.vb||1===e.messages.length&&i.is("mobile");return t&&A.error(b.getString("Maximum composer reached",null,"Notify the user when he try to open more than ".concat(s.vb," composer"))),t}function V(e){var t=l.get(e).address;return{From:t,AddressID:t.ID}}function q(e){return H.apply(this,arguments)}function H(){return(H=c()(o.a.mark((function t(n){var r,a,c,s,u,l;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return 1===E.get("ComposerMode")&&(n.maximized=!0,i.set("maximizedComposer",!0)),n.attachmentsToggle=n.Attachments.length-n.NumEmbedded>0&&n.Attachments.length>n.NumEmbedded,n.ccbcc=!1,n.autocompletesFocussed=!1,n.uid=e.uid++,n.pendingAttachements=[],n.askEmbedding=!1,delete n.asEmbedded,n.uploading=0,n.sending=!1,r=x.list(n),a=r.ToList,c=r.CCList,s=r.BCCList,n.ToList=a,n.CCList=c,n.BCCList=s,u=V(n),l=u.From,n.From=l,t.next=18,C(n,{encrypt:!1});case 18:return t.next=20,O.handle(n);case 20:e.$applyAsync((function(){var t=e.messages.unshift(n);j["composer.update"]("loaded",{size:t,message:n})}));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(e){j.actionMessage("update",e)}function Y(r){var a=D(r);e.messages=function(e,t){return e.filter((function(e){return t.ID!==e.ID}))}(e.messages,a),d.clear(a),I.remove(a.ID),F(a,!0),j.tooltip("hideAll"),j["composer.update"]("close",{size:e.messages.length,message:a}),j.elements("refresh");var o=T.getDraftsState();a.ConversationID!==n.id&&a.ID!==n.id||!t.includes(o)||t.go(o)}$(window).on("resize",K),e.$on("$destroy",(function(){$(window).off("resize",K),window.onbeforeunload=void 0,B(),R()})),e.slideDown=function(e){e.attachmentsToggle=!e.attachmentsToggle},e.isEmbedded=function(e){return v.isEmbedded(e)},e.togglePanel=function(t,n){!0===t.displayPanel?e.closePanel(t):e.openPanel(t,n)},e.openPanel=function(e,t){e.displayPanel=!0,e.panelName=t,"encrypt"===t&&r((function(){angular.element("#uid"+e.uid+' input[name="outsidePw"]').focus()}),100,!1)},e.closePanel=function(e){e.displayPanel=!1,e.panelName=""},e.saveLater=function(e){e.sending||e.discardDontAutoSave||C(e,{autosaving:!0,loader:!1})},e.subject=function(e){return e.Subject||b.getString("New message",null,"Title")},e.focusFirstComposer=function(e){j["composer.update"]("focus.first",{message:e})},e.minimize=function(t){t.minimized=!0,t.previousMaximized=t.maximized,t.maximized=!1,t.ccbcc=!1,i.set("maximizedComposer",!1),j.tooltip("hideAll"),e.focusFirstComposer(t)},e.unminimize=function(e){e.minimized=!1,e.maximized=e.previousMaximized,j.tooltip("hideAll")},e.maximize=function(e){e.maximized=!0,i.set("maximizedComposer",!0)},e.normalize=function(e){var t=window.innerWidth,n=window.innerHeight,r=t<=640||n<=500;e.minimized=!1,e.maximized=r,i.set("maximizedComposer",r)},e.saveAndClose=function(e){var t=D(e);j.editorListener("pre.close.message",{message:t})},e.discard=function(e){var t=b.getString("Delete",null,"Title"),n=b.getString("Permanently delete this draft?",null,"Info");e.discardDontAutoSave=!0,p.activate({params:{title:t,message:n,confirm:function(){j.messageActions("delete",{ids:[e.ID]}),Y(e),delete e.discardDontAutoSave,A.success(b.getString("Message discarded",null,"Info")),p.deactivate()},cancel:function(){delete e.discardDontAutoSave,p.deactivate()}}})}}var ar=rr;function or(e){return{scope:{model:"=actionCompose"},link:function(t,n,r){var a=r.actionComposeType,o=e(["addFile","composer.new"]).dispatcher;function i(e){return e.preventDefault(),/addFile|addEmbedded/.test(a)?o.addFile("",{asEmbedded:"addEmbedded"===a,message:t.model}):o["composer.new"](a,{message:t.model})}n[0].addEventListener("click",i),t.$on("$destroy",(function(){n[0].removeEventListener("click",i)}))}}}or.$inject=["dispatchers"];var ir=or;function cr(e,t){var n=function(e){var n;switch(!!e){case!0===e.encryptingAttachment:n=t.getString("Encrypting attachments",null,"Action");break;case e.uploading>0:n=t.getString("Uploading",null,"Action");break;case!0===e.encrypting:n=t.getString("Encrypting",null,"Action");break;case!0===e.saving&&!1===e.autosaving:n=t.getString("Saving",null,"Action");break;case!0===e.sending:n=t.getString("Sending",null,"Action");break;case e.disableSend&&e.disableSend():default:n=t.getString("Send",null,"Action")}return n};return{replace:!0,scope:{model:"=message"},template:'<button class="btnSendMessage-btn-action"></button>',link:function(t,r){var a=e(),o=a.on,i=a.unsubscribe;r[0].textContent=n(t.model),o("actionMessage",(function(e,a){var o=a.data;o.ID===t.model.ID&&(r[0].textContent=n(o),o.disableSend&&(r[0].disabled=o.disableSend()))})),t.$on("$destroy",(function(){i()}))}}}cr.$inject=["dispatchers","gettextCatalog"];var sr=cr;function ur(e,t,r,a){var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"composer-draggable";return e.classList.add(t)},i=function(e){e.classList.remove("composer-draggable"),e.classList.remove("composer-draggable-editor")};return{replace:!0,templateUrl:n("NeGb"),link:function(n,c){var s=r(["composer.update","editorListener"]),u=s.dispatcher,l=s.on,d=s.unsubscribe,p=function(e){return n.mini=e},f=function(e){return n.small=e},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u["composer.update"]("focus.".concat(e),t)},m=function(e){n.message.minimized||t.isUploadAbleType(e)&&(o(c[0]),v("dragenter",{message:n.message,composer:c,index:+c[0].getAttribute("data-index")}))},g=function(e,t){return function(n,r){var a,c,s,u,l,d=r.type,p=r.data;if(a=e.message,c=p,s=a.ID,u=c.message,l=void 0===u?{}:u,s===c.messageID||s===l.ID)switch(d){case"dragenter":m(p.event);break;case"drop":if("attachment.upload"===n.name&&p.queue.files.length&&p.queue.hasEmbedded)return o(t,"composer-draggable-editor");i(t);break;case"upload":i(t);break;case"upload.success":_rAF((function(){return i(t)}))}}},h=function(e){var t=e.target.className;/composerHeader-btn/.test(t)||v("click",{message:n.message,composer:c,index:+c[0].getAttribute("data-index")}),/squireToolbar/.test(t)&&n.$applyAsync((function(){n.message.ccbcc=!1})),/composer-btn-save/.test(t)?u.editorListener("pre.save.message",{message:n.message}):/composer-btn-send/.test(t)?u.editorListener("pre.send.message",{message:n.message}):/composer-btn-discard/.test(t)?n.$applyAsync((function(){return n.discard(n.message)})):/composer-btn-encryption/.test(t)?n.$applyAsync((function(){return n.togglePanel(n.message,"encrypt")})):/composer-btn-expiration/.test(t)&&n.$applyAsync((function(){return n.togglePanel(n.message,"expiration")}))},b=er()((function(e){var t=e.target;(t.classList.contains("composer-dropzone")||t.classList.contains("composer-dropzone-wrapper")||t.dataset.composerId===n.message.ID)&&i(c[0])}),500),y=function(e){if(27===e.keyCode){if(document.activeElement&&document.activeElement.classList.contains("autocompleteEmails-input"))return;1===a.get("Hotkeys")&&u.editorListener("pre.close.message",{message:n.message})}};c[0].addEventListener("dragenter",m),c[0].addEventListener("dragleave",b),c[0].addEventListener("click",h),c[0].addEventListener("keydown",y),l("editor.draggable",g(n,c[0])),l("attachment.upload",g(n,c[0])),l("AppModel",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"mini"===r&&n.$applyAsync((function(){p(o.value)})),"small"===r&&n.$applyAsync((function(){f(o.value)}))})),p(e.get("mini")),f(e.get("small")),n.$on("$destroy",(function(){c[0].removeEventListener("dragenter",m),c[0].removeEventListener("dragleave",b),c[0].removeEventListener("click",h),c[0].removeEventListener("keydown",y),d(),e.set("activeComposer",!1),e.set("maximizedComposer",!1),n.selected=void 0}))}}}ur.$inject=["AppModel","attachmentFileFormat","dispatchers","mailSettingsModel"];var lr=ur;function dr(e,t){return{replace:!0,templateUrl:n("Np7I"),link:function(n,r,a){var o=a.action,i=["attachment.upload",void 0===o?"":o].filter(Boolean).join("."),c=e([i]),s=c.dispatcher,u=c.on,l=c.unsubscribe,d=r[0].querySelector(".composerAskEmbdded-title");u(i,(function(e,n){var r,a,o=n.type,i=n.data;"drop"===o&&(r=d,a=i.queue.files.filter((function(e){return e.isEmbedded})).length,r.textContent=t.getPlural(a,"{{$count}} image detected","{{$count}} images detected",{},"Composer, message drag and drop images"))}));var p=function(e){var t,r=e.target;"BUTTON"===r.nodeName&&(t={messageID:n.message.ID,message:n.message,action:r.getAttribute("data-action")},s[i]("upload",t))};r.on("click",p),n.$on("$destroy",(function(){r.off("click",p),l()}))}}}dr.$inject=["dispatchers","gettextCatalog"];var pr=dr;function fr(e,t,r,a){var o="composerAttachments-hidden",i=a((function(){return{show:t.getString("Show",null,"Action"),hide:t.getString("Hide",null,"Action")}}));return{replace:!0,scope:{message:"=model"},templateUrl:n("jt1s"),link:function(t,n){var a=r(),c=a.on,u=a.unsubscribe;t.list=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=t.message.getDecryptedBody(),a=e.getBodyParser(r),o=e.extractEmbedded(n,a);return n.filter((function(e){return e.Encrypted!==s.Q.PGP_MIME})).map((function(e){return{id:e.ID,packet:{filename:e.Name,uploading:!1,Size:e.Size,Inline:o.indexOf(e)>-1},messageID:t.message.ID,message:t.message}}))}(t,t.message.Attachments),t.labelHeader=i.show;var l=function(e,t){var n=function(n,r){return function(){"remove"===n&&t.classList.remove(o),t.classList[n]("composerAttachments-close"),e.$applyAsync((function(){return e.labelHeader=i[r]}))}},r=n("remove","hide"),a=n("add","show"),c=function(){return!t.classList.contains("composerAttachments-close")};return{open:r,close:a,isOpened:c,hide:function(){return t.classList.add(o)},show:function(){return t.classList.remove(o)},toggle:function(){return c()?a():r()}}}(t,n[0]),d=angular.element(n[0].querySelector(".composerAttachments-header"));!t.list.length&&l.hide();var p=function(){return l.toggle()};d.on("click",p),c("attachment.upload",function(e,t,n,r){return function(t,a){var o,i,c,s,u,l=a.type,d=a.data,p=d.status,f=d.packet,v=d.id,m=d.messageID,g=d.REQUEST_ID;if(o=e.message,i=d,c=o.ID,s=i.message,u=void 0===s?{}:s,c===i.messageID||c===u.ID)switch(l){case"upload":if("cancel"!==d.action)return;if(e.message.Attachments.length)return n.close();n.hide();break;case"cancel":case"remove.success":e.$applyAsync((function(){e.list=e.list.filter((function(e){return e.id!==v})).filter((function(e){return e.id!==g})),!e.list.length&&n.hide()}));break;case"uploading":p&&!Et()(r,v)&&(n.open(),r[v]=!0,e.$applyAsync((function(){e.list.push({id:v,packet:f,messageID:m,message:e.message})})));break;case"error":e.$applyAsync((function(){e.list=e.list.filter((function(e){return e.id!==v})),n.close(),!e.list.length&&n.hide()}));break;case"upload.success":p&&!Et()(r,v)&&(r[v]=!0,e.$applyAsync((function(){e.list.push({id:v,packet:f,messageID:m,message:e.message})}))),n.close()}}}(t,0,l,{})),t.$on("$destroy",(function(){d.off("click",p),u()}))}}}fr.$inject=["embeddedUtils","gettextCatalog","dispatchers","translator"];var vr=fr;function mr(e,t,n){var r=e(["attachment.upload","attachment.upload.outside"]).dispatcher;return{replace:!0,template:'<span class="composerAttachmentsItem-container"><progress-upload data-model="attachment"></progress-upload></span>',link:function(e,a,o){var i,c=o.isOutside,s=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="attachment.upload".concat(e?".outside":"");r[a](t,n)}}(void 0!==c&&c);a[0].title=(i=e.attachment.packet.filename,t.getString("Download the attachment {{name}}",{name:i},"Info"));var u=function(t){n.isNotSupported(t)||s("download.composer",e.attachment)};a.on("click",u),e.$on("$destroy",(function(){a.off("click",u)}))}}}mr.$inject=["dispatchers","gettextCatalog","attachmentDownloader"];var gr=mr,hr=function(e,t){return{replace:!0,templateUrl:n("ifJH"),link:function(n,r){var a=e("humanSize"),o=t(),i=o.on,c=o.unsubscribe,s=0,u=function(e){r[0].textContent=a(e)};i("attachment.upload",(function(e,t){var r=t.type,a=t.data;"uploaded.success"===r&&(s+=a.packet.Size,u(s)),["remove.success","upload.success"].includes(r)&&(s=n.message.attachmentsSize(),u(s))})),n.$on("$destroy",(function(){c()}))}}};hr.$inject=["$filter","dispatchers"];var br=hr;function yr(e,t,n,r){return{link:function(a,o){var i=r(),c=i.on,s=i.unsubscribe,u=n(a),l=function(e){var n=[].slice.call(o[0].querySelectorAll(".composer-container"));_rAF((function(){return t.render(n,e)}))},d=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.$applyAsync((function(){if(a.messages.length){var r="close"===e?a.messages[0]:n.message;r.focussed=!1;var i=t.findComposer(o[0],r),c=i.index,s=i.composer,d=c-1>=0?c-1:c,p=angular.extend({},n,{message:r,composer:s,index:d,size:a.messages.length,keepState:!1});u(p);var f=setTimeout((function(){return l(p),clearTimeout(f)}),160)}}))},p=function(){return d("close")};window.addEventListener("orientationchange",p,!1),c("composer.update",(function(n,r){var i=r.type,c=r.data;switch(i){case"focus.dragenter":case"focus.click":a.$applyAsync((function(){return u(c)}));break;case"focus.first":var s=le()(a.messages,{minimized:!1});s&&d(i,{message:s});break;case"escape.autocomplete":var p=1===e.user.Hotkeys,f=le()(a.messages,{focussed:!0});p&&f&&a.saveAndClose(f);break;case"close":d(i,c);break;case"refresh":l(c);break;case"editor.loaded":case"editor.focus":var v=c.message,m=c.editor;if(!c.isMessage)break;if(v.focussed){a.$applyAsync((function(){return v.autocompletesFocussed=!1}));break}a.$applyAsync((function(){var e=t.findComposer(o[0],v),n=e.index,r=e.composer,s=angular.extend({},c,{composer:r,index:n,keepState:!1,focusEditor:"editor.focus"===i,size:a.messages.length});u(s,m),"editor.loaded"===i&&l(s)}))}})),a.$on("$destroy",(function(){window.removeEventListener("orientationchange",p,!1),s()}))}}}yr.$inject=["authentication","composerRender","composerLoader","dispatchers"];var Er=yr,Sr=n("bNQv"),Dr=n.n(Sr),kr=n("eeMe"),Ar=n.n(kr);wr.$inject=["attachmentFileFormat","tools","attachmentModel","dispatchers","notification","gettextCatalog","$state","translator"];var Ir=s.Gb.PLAINTEXT,Cr=s.d*s.g*s.g;function wr(e,t,n,r,a,o,i,c){Ar.a.autoDiscover=!1;var u=i.includes("eo.*"),l={number:s.d},d={number:s.d},p=c((function(){var e;return e={0:o.getString("Empty attachment",null,"Composer")},v()(e,s.c,o.getString("Messages are limited to {{number}} attachments",l,"Composer")),v()(e,s.d,o.getString("Attachments are limited to {{number}} MB.",d,"Composer")),v()(e,Cr,(function(e){var t=Math.round(10*e/s.g/s.g)/10;return o.getString("Attachments are limited to {{number}} MB. Total attached would be: {{total}} MB.",Ge()({total:t},l),"Composer")})),v()(e,"ERROR_EO_NUMBER_ATT",o.getString("Maximum number of attachments (10) exceeded.",null,"Composer")),v()(e,"dictDefaultMessage",o.getString("Drop a file here to upload",null,"Info")),e}));var f=function(t,r){return{addRemoveLinks:!1,dictDefaultMessage:p.dictDefaultMessage,url:"/file/post",autoProcessQueue:!1,paramName:"file",previewTemplate:'<div style="display:none"></div>',init:function(){var o=this;Dr()(t.Attachments,(function(e){var t={name:e.Name,size:e.Size,type:e.MIMEType,ID:e.ID};o.options.addedfile.call(o,t)}),this),this.on("addedfiles",(function(i){var c;if(!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.size,a=void 0===r?0:r,o=[].slice.call(t).reduce((function(e,t){return e+t.size}),0);return e.attachmentsSize()+a+o<=Cr}(t,i,n.getCurrentQueue(t)))return o.removeAllFiles(),c=setTimeout((function(){a.error(p[s.d]),r(t,{size:0,files:[]}),clearTimeout(c)}),100);var l=[].slice.call(i).reduce(function(t,n){return function(r,o){var i=function(e,t){return{currentSize:e.attachmentsSize()+(e.queuedFilesSize||0)+t.size,numberFiles:(e.Attachments||[]).length+(e.queuedFiles||0)}}(t,o),c=i.currentSize;if(i.numberFiles===s.c){var u=p[s.c];return n.removeFile(o),a.error(u),r}if(c>=Cr){var l=p[Cr](c);return n.removeFile(o),a.error(l),r}if(0===c){var d=p[0];return n.removeFile(o),a.error(d),r}return r.files.push({file:o,isEmbedded:e.isEmbedded(o.type)}),r.size+=o.size,r}}(t,o),{files:[],size:0});if(o.removeAllFiles(),l.hasEmbedded=l.files.every((function(e){return e.isEmbedded&&t.MIMEType!==Ir})),u&&l.files.length+t.Attachments.length>10)return r(t,l,"attachments.limit.error"),a.error(p.ERROR_EO_NUMBER_ATT);r(t,l)}))}}};return{link:function(e,t,n){var a=n.action,o=["attachment.upload",void 0===a?"":a].filter(Boolean).join("."),i=r([o]),c=i.dispatcher,s=i.on,u=i.unsubscribe,l=new Ar.a(t[0],f(e.message,(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"drop";c[o](n,{messageID:e.ID,message:e,queue:t})})));s("addFile",(function(t,n){var r=n.data,a=r.asEmbedded;r.message.ID===e.message.ID&&(e.message.asEmbedded=a,l.element.click())})),e.$on("$destroy",(function(){l.off("dragover"),l.off("addedfiles"),l.destroy(),u()}))}}}var Or=wr;Pr.$inject=["dispatchers","notification","gettextCatalog","translator"];var Mr=s.Db.FLAG_INTERNAL;function Pr(e,t,r,a){var o=e(["composer.update"]).dispatcher,i=function(e,t){return o["composer.update"](e,{message:t,type:"encryption"})},c=a((function(){return{noPassword:r.getString("Please enter a password for this email.",null,"Error"),noMatchPassword:r.getString("Message passwords do not match.",null,"Error")}}));return{replace:!0,scope:{message:"="},templateUrl:n("t0K9"),link:function(e,n){var r=n.find(".composerEncrypt-btn-cancel");e.model={password:"",confirm:"",hint:""};var a=function(n){return n.stopPropagation(),e.model.password.length?e.model.password!==e.model.confirm?t.error(c.noMatchPassword):void e.$applyAsync((function(){e.message.addFlag(Mr),e.message.Password=e.model.password,e.message.PasswordHint=e.model.hint,i("close.panel",e.message)})):t.error(c.noPassword)},o=function(){e.$applyAsync((function(){e.model.password="",e.model.confirm="",e.model.hint="",e.encryptForm.$setUntouched(),delete e.message.Password,delete e.message.PasswordHint,e.message.removeFlag(Mr),i("close.panel",e.message)}))};n.on("submit",a),r.on("click",o),e.$on("$destroy",(function(){n.off("submit",a),r.off("click",o)}))}}}var xr=Pr,Tr=n("WjpJ"),Lr=n.n(Tr);function jr(e,t,r,a){var o=e(["composer.update"]).dispatcher,i=a((function(){return{maxEpiration:r.getString("The maximum expiration is 4 weeks.",null,"Error"),invalid:r.getString("Invalid expiration time.",null,"Error")}})),c=function(e,t){return o["composer.update"](e,{message:t,type:"expiration"})},u=function(e){return Lr()(e).map((function(e){return{label:"".concat(e),value:e}}))},l={week:u(5),day:u(7),hour:u(24)};return{replace:!0,scope:{message:"="},templateUrl:n("9uzX"),link:function(e,n){var r,a,o,u,d=n.find(".composerExpiration-btn-cancel");e.model=(r=e.message,a=r.ExpiresIn,o=(void 0===a?0:a)/3600,u=Math.floor(o/24),{weeks:angular.copy(le()(l.week,{value:Math.floor(u/7)})),days:angular.copy(le()(l.day,{value:u%7})),hours:angular.copy(le()(l.hour,{value:o%24}))}),e.options=l;var p=function(n){n.stopPropagation();var r=function(e){var t=e.days,n=e.hours,r=e.weeks;return n.value+24*(t.value+7*r.value)}(e.model);return parseInt(r,10)>s.tb?t.error(i.maxEpiration):isNaN(r)?t.error(i.invalid):void e.$applyAsync((function(){e.message.ExpiresIn=3600*r,c("close.panel",e.message)}))},f=function(){e.$applyAsync((function(){delete e.message.ExpiresIn,e.expirationForm.$setUntouched(),c("close.panel",e.message)}))};n.on("submit",p),d.on("click",f),e.$on("$destroy",(function(){n.off("submit",p),d.off("click",f)}))}}}jr.$inject=["dispatchers","notification","gettextCatalog","translator"];var Nr=jr,$r=function(){return{replace:!0,templateUrl:n("fFX0")}},Rr=n("MJIl"),_r=n.n(Rr);function Ur(e,t){var r=function(e){var t=e.ToList,n=void 0===t?[]:t,r=e.CCList,a=void 0===r?[]:r,o=e.BCCList,i=void 0===o?[]:o;return _r()([].concat(we()(n),we()(a),we()(i)),{invalid:!0})};return{replace:!0,templateUrl:n("sUT6"),compile:function(n,a){var o=a.label,i=a.key,c=n[0].querySelector(".composerInputMeta-label"),s=n[0].querySelector(".composerInputMeta-autocomplete"),u=n.find(".composer-input-recipient");return c&&(c.textContent=o),s&&(s.setAttribute("data-name",function(e){return"composerAutocomplete".concat(e).concat(Object(Ot.k)())}(o)),s.setAttribute("data-emails","message.".concat(i)),s.setAttribute("data-key",i)),"ToList"!==i&&u.remove(),function(n,a){var o=t(["autocompleteEmails"]),c=o.dispatcher,u=o.on,l=o.unsubscribe,d=function(){return s.getAttribute("data-name")},p=a[0].querySelector(".composerInputMeta-overlay-button");n.containsRecipient=function(e){return function(){var t=e.message,n=t.ToList,a=void 0===n?[]:n,o=t.CCList,i=void 0===o?[]:o,c=t.BCCList,s=void 0===c?[]:c;return!r(e.message)&&(a.length||i.length||s.length)}}(n),n.containsInvalid=r;var f=function(t){var r=t.target;r.classList.contains("autocompleteEmails-label")||("openModal"!==r.getAttribute("data-action")?n.$applyAsync((function(){var e,t,r,o,i;n.selected.autocompletesFocussed=!0,e=n.selected,t=e.CCList,r=void 0===t?[]:t,o=e.BCCList,i=void 0===o?[]:o,(r.length||i.length)&&(n.message.ccbcc=!0,n.message.attachmentsToggle=!0),_rAF((function(){return a.find("input").focus()}))})):e.openModal(n.message,{key:i,name:d()}))},v=function(e){e.stopPropagation(),n.message.ID===n.selected.ID&&n.$applyAsync((function(){n.message.ccbcc=!n.message.ccbcc,n.message.autocompletesFocussed=!0,n.message.attachmentsToggle=!1}))};p.addEventListener("click",v,!1),a.on("click",f),u("composer.update",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;if("add.recipients"===r&&o.name===d()&&o.messageID===n.message.ID){var i=k()(o.recipients,(function(e){return{Name:e.Name,Address:e.Email}}));c.autocompleteEmails("refresh",{list:i,name:o.name,messageID:o.messageID})}})),n.$on("$destroy",(function(){p.removeEventListener("click",v,!1),a.off("click",f),l()}))}}}}Ur.$inject=["contactSelectorModel","dispatchers"];var Fr=Ur;var Br=function(){return{replace:!0,templateUrl:n("5B4X"),scope:{email:"<",message:"<"}}},Kr=function(){return{replace:!0,scope:{},templateUrl:n("GU1j"),controller:"ComposeMessageController"}};function Gr(e,t,r,a,o,i){var c=i((function(){return{upgradeRequired:function(){return r.getString("Upgrade to a paid plan to send from your {{email}} address",{email:o.email()},"Error")}}}));return{scope:{message:"=model"},replace:!0,templateUrl:n("0GlB"),link:function(n,r){var o=r.find("select"),i=a.get(n.message).addresses,s=n.message.From;n.addresses=i;var u=function(){if(0===n.message.From.Send)return n.$applyAsync((function(){n.message.From=s})),e.error(c.upgradeRequired());n.$applyAsync((function(){s=n.message.From,t.find(n.message).editor.fireEvent("refresh",{action:"message.changeFrom"})}))},l=function(){return o.focus()};Object(Pe.i)()&&o.on("mousedown",l),o.on("change",u),n.$on("$destroy",(function(){Object(Pe.i)()&&o.off("mousedown",l),o.off("change",u)}))}}}Gr.$inject=["notification","editorModel","gettextCatalog","composerFromModel","premiumDomainModel","translator"];var Vr=Gr,qr=n("DzJC"),Hr=n.n(qr),zr=s.Gb.PLAINTEXT,Yr=function(e){return{replace:!0,templateUrl:n("17cw"),link:function(t,n){var r=n[0].querySelector("input"),a=function(){t.$applyAsync((function(){t.message.autocompletesFocussed=!1,t.message.ccbcc=!1,t.message.attachmentsToggle=!1}))},o=Hr()((function(r){if(9===r.which){if(t.message.MIMEType===zr)return r.preventDefault(),n.parents(".composer").find("textarea").focus();var a=e.find(t.message).editor;a&&t.message.MIMEType!==zr&&(r.preventDefault(),a.focus())}}),150),i=function(e){var n=e.relatedTarget;n&&n.classList.contains("composer-btn-discard")||t.$applyAsync((function(){t.$$destroyed||t.saveLater(t.message)}))};r.addEventListener("focus",a,!0),r.addEventListener("keydown",o,!1),r.addEventListener("blur",i,!1),t.$on("$destroy",(function(){r.removeEventListener("focus",a,!0),r.removeEventListener("keydown",o,!1),r.removeEventListener("blur",i,!1)}))}}};Yr.$inject=["editorModel"];var Wr=Yr;function Xr(e,t,n){var r=n((function(){return{saveAt:t.getString("Saved at",null,"Info display in the composer footer"),saving:t.getString("Saving",null,"Info display in the composer footer")}}));return{restrict:"E",replace:!0,template:'<time class="composerTime-container" aria-live="polite" aria-atomic="true"></time>',link:function(t,n){var a=e(),o=a.on,i=a.unsubscribe,c=function(e){var t;e.saving?n[0].textContent=r.saving:e.Time&&(n[0].textContent="".concat(r.saveAt," ").concat((t=e.Time,moment.unix(t).format("LT"))))};o("actionMessage",(function(e,n){var r=n.data;t.message.ID===r.ID&&c(r)})),c(t.message),t.$on("$destroy",i)}}}Xr.$inject=["dispatchers","gettextCatalog","translator"];var Jr=Xr;function Qr(e,t){return{restrict:"A",link:function(n){var r=function(n){var r={};return function(){var a=window.innerWidth,o=window.innerHeight,i=a<=640||o<=600;n.message.maximized&&!r.isSmall||n.message.minimized||(r.isSmall=i,n.$applyAsync((function(){e.set("small",o<700&&o>=600),e.set("mini",o<600),i&&n.maximize(n.message),!i&&0===t.get("ComposerMode")&&n.normalize(n.message)})))}}(n),a=er()(r,100),o=setTimeout((function(){r(),clearTimeout(o)}),100);window.addEventListener("resize",a),n.$on("$destroy",(function(){window.removeEventListener("resize",a)}))}}}Qr.$inject=["AppModel","mailSettingsModel"];var Zr=Qr,ea=n("Snkc"),ta=n.n(ea),na=n("MDsB");function ra(e,t,n,r,a,o,i){var c="protonmail_pm_address",s=o((function(){return{OK:r.getString("OK",null,"Action"),DONT_SHOW_AGAIN:r.getString("Don't show this again",null,"Action"),TITLE:r.getString("Sending notice",null,"Title"),error:function(e){return r.getString("Sending messages from @pm.me address is a paid feature. Your message will be sent from your default address {{email}}",{email:e},"Error")}}}));var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Email,n=void 0===t?"":t;return n.endsWith("@".concat(i.first()))},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return le()(e,{ID:t})||le()(e,{Send:1})};function d(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0,o=l(r,a);if(!t.hasPaidMail()&&u(o)){var i=le()(r,{Send:1});return Object(na.a)(c)||(e=i.Email,n.activate({params:{title:s.TITLE,message:s.error(e),cancelText:s.OK,confirmText:s.DONT_SHOW_AGAIN,confirm:function(){n.deactivate(),Object(na.b)(c,"dontShowAgain")},cancel:function(){n.deactivate()}}})),i}return o}return{get:function(t){var n=t.xOriginalTo,r=t.AddressID,o=a.getAddress(n),i=Be()(Ue()({Status:1,Receive:1}),ta()("Order"))(e.get());return o&&i.unshift(o),{addresses:i,address:d(i,r)}}}}ra.$inject=["addressesModel","authentication","confirmModal","gettextCatalog","plusAliasModel","translator","premiumDomainModel"];var aa=ra,oa=function(e,t){e.value=t},ia=function(e){e.selectionStart=0,e.selectionEnd=0,e.scrollTop=0},ca=function(e,t,n){t.setHTML(n),e.RightToLeft&&t.setTextDirectionWithoutFocus("rtl")},sa=function(e){e.focus();var t=e.getSelection();"BODY"!==t.startContainer.tagName&&"BODY"!==t.endContainer.tagName||e.moveCursorToStart()};la.$inject=["dispatchers","editorModel"];var ua=s.Gb.PLAINTEXT;function la(e,t){return function(n){return function(r){var a=r.composer,o=r.index,i=r.message,c=r.focusEditor,s=r.keepState,u=void 0===s||s;if(!i.focussed){var l=n.messages.length;if(We()(n.messages,(function(e,t){e.focussed=!1,e.zIndex=t>o?100*(l-(t-o)):100*l})),i.focussed=!0,n.selected=i,!u&&(n.selected.autocompletesFocussed=!1),c)return t.find(i).editor.focus();!u&&function(n,r,a){if(n[0]&&(!n[0].contains(document.activeElement)||n[0]===document.activeElement))var o=setTimeout((function(){var i=t.find(a).editor;if(i&&Object(Pe.l)()){var c=i._doc.body;Object(Kt.c)(c)}clearTimeout(o);var s=n.find(".plaintext-editor")[0];ia(s);var u=r.selected,l=u.ToList,d=void 0===l?[]:l,p=u.CCList,f=void 0===p?[]:p,v=u.BCCList,m=void 0===v?[]:v;if(!d.concat(f,m).length){var g=n.find(".toRow").find("input").eq(0);if(g.get(0))return r.$applyAsync((function(){r.selected.autocompletesFocussed=!0,_rAF((function(){return g.focus()}))}))}if(!r.selected.Subject.length)return n.find(".subject").focus();if(a.MIMEType!==ua){if(i)return i.focus();var h=e(),b=h.on,y=h.unsubscribe;b("composer.update",(function(e,t){var n=t.type,r=t.data;"editor.loaded"===n&&a.ID===r.message.ID&&(r.editor.focus(),y())}))}else s.focus()}),300)}(a,n,i)}}}}var da=la;var pa=function(){return{render:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).size,n=void 0===t?1:t;e.forEach((function(e,t){var r,a,o,i,c,s=(r=n,a=e.offsetWidth,o=document.documentElement.classList.contains("ua-windows_nt")?40:20,i=document.body.offsetWidth,c=0,i/r<a&&(c=(i-a-o)/(r-1)),{width:a,margin:o,windowWidth:i,overlap:c}),u={visibility:"visible"};u.transform="translateX(-".concat(function(e,t){var n=e.width,r=e.margin,a=e.overlap;return parseInt(a?t*a:t*(n+r)+r,10)||r}(s,t),"px)"),function(e,t){Object.keys(t).forEach((function(n){return e.style[n]=t[n]}))}(e,u)}))},findComposer:function(e,t){var n=t.ID,r=e.querySelector('[data-composer-id="'.concat(n,'"]'));return r?{composer:angular.element(r),index:+r.getAttribute("data-index")}:{composer:angular.element(e.querySelector(".composer")),index:0}}}};var fa=function(){var e=Object.create(null),t=function(e){var t=e.uid;return"key.".concat(t)},n=function(n){return delete e[t(n)]};return{add:function(r,a){var o=t(r);return e[o]=e[o]||Promise.resolve(),e[o]=e[o].then(a).catch((function(e){throw n(r),e}))},clear:n,chain:function(n){var r=t(n);return e[r]||Promise.resolve()}}};var va=function(){var e={};return{set:function(t,n){return e[t]=n},get:function(t){return e[t]},clear:function(){return e={}},remove:function(t){return delete e[t]}}},ma=n("7tbW"),ga=n.n(ma),ha=n("Jlc5"),ba=n.n(ha),ya=n("BJ98"),Ea=n.n(ya),Sa=n("J4u2"),Da=n("k2fX"),ka=n("i639"),Aa=n("xweI"),Ia=n.n(Aa),Ca=n("bLiC"),wa=n.n(Ca),Oa=n("0XPj"),Ma=n.n(Oa),Pa=n("zqxM"),xa=n.n(Pa),Ta=["x-pm-encrypt","x-pm-sign"],La={AVOID:["version","n","prodid","abuid"],FN:["fn"],EMAIL:["email"],TEL:["tel"],ADR:["adr"],NOTE:["note"],KEY:["key"],"X-PM-ENCRYPT":["x-pm-encrypt"],"X-PM-SIGN":["x-pm-sign"],"X-PM-SCHEME":["x-pm-scheme"],"X-PM-MIMETYPE":["x-pm-mimetype"],"X-PM-TLS":["x-pm-tls"],PHOTO:["photo"],PERSONALS:["kind","source","xml","nickname","bday","anniversary","gender","impp","lang","tz","geo","title","role","logo","org","member","related","rev","sound","uid","clientpidmap","url","fburl","caladruri","caluri"]},ja=[].concat(La.AVOID,La.FN,La.EMAIL,La.TEL,La.ADR,La.NOTE,La.PHOTO,La.PERSONALS,La.KEY),Na=[].concat(La.FN,La.EMAIL,La.TEL,La.ADR,La.NOTE,La.PHOTO,La.PERSONALS),$a={FN:"Name",PERSONALS:"Personals"},Ra=[].concat(La.KEY,La["X-PM-ENCRYPT"],La["X-PM-SCHEME"],La["X-PM-MIMETYPE"],La["X-PM-SIGN"],La["X-PM-TLS"]),_a=[].concat(La.EMAIL,La.TEL,La.ADR),Ua="categories",Fa=["version","prodid","x-pm-label","x-pm-group",Ua],Ba=["version","prodid","fn","uid","email"].concat(s.rc),Ka=["uid"],Ga=["email",Ua].concat(s.rc),Va=function(e){return $a[e]||"".concat(Object(Ot.h)(e.toLowerCase()),"s")};function qa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return"CUSTOMS"===e?xa()(Object.keys(t.data),ja.concat(Ra)):n&&Ha(e)?[e.toLowerCase()]:La[e]}function Ha(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return La.PERSONALS.includes(e.toLowerCase())}function za(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!/^(email|fn)$/.test(e)}function Ya(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ma()(Object.keys(e.data),Na)}var Wa=/\\|,|;/gi,Xa=/\\\\|\\,|\\;/gi,Ja=/\\\\|\\:|\\,|\\;/gi,Qa=/\\;/gi,Za="🐶 🐱 🐭 🐹 🐰 🦊 🐻 🐼",eo=/🐶 🐱 🐭 🐹 🐰 🦊 🐻 🐼/gi,to=s.w.CLEAR_TEXT,no=s.w.SIGNED,ro=s.w.ENCRYPTED_AND_SIGNED,ao=["key","photo","geo","impp","logo","member","related","sound","uid","url","caluri","caladruri","fburl"],oo=function(e,t){var n=Object(Ot.e)(t),r=le()(e,(function(e){return Object(Ot.e)(e.valueOf())===n}));if(r)return r.getGroup()},io=function(e){return function(t){return void 0===t.getGroup()||t.getGroup().toLowerCase()===e.toLowerCase()}};function co(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Ia()(e,(function(e){var t=(e.getParams()||{}).pref;return~~(void 0===t?9999:t)}))}var so=function(e){return bt()(e,(function(e,t){var n=t.getGroup();return-1===e.indexOf(n)&&e.push(n),e}),[])},uo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=!0!==t?Xa:Ja;return e.replace(n,(function(e){return e.substr(1)}))},lo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(Wa,(function(e){return"\\".concat(e)}))},po=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Array.isArray(e)?e.map(lo):lo(String(e))},fo=function(e,t){return"adr"===t||"n"===t||"categories"===t?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(Qa,Za).split(";").map((function(e){return e.replace(eo,"\\;")})).map(uo)}(e):Ta.includes(t)?"false"!==e.toLowerCase().trim():uo(e,ao.includes(t))},vo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=function(e){var t=e.Type,n=e.Data;return t===to&&n.includes("CATEGORIES")},n=function(e){return e.Type!==ro},r=function(e){return e.reduce((function(e,t){var n=t.Type,r=t.Data;return e[n]=(new wa.a).parse(r),e}),{})},a=function(e){return Array.isArray(e)?e.map((function(e){return e.valueOf()})).join(","):e.valueOf()},o=function(e,t){var n=t[to];return e[t[no].get("uid").valueOf()]=a(n.get("categories")),e};return e.filter((function(e){return e.Cards.some(t)})).map((function(e){return e.Cards.filter(n)})).map(r).reduce(o,Object.create(null))},mo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e&&!e.Receive&&t.length},go=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e&&!mo(e,t)};function ho(e,t,n,r,a,i,u){var l={},d=e().on,p=function(e){return!e||e.Defaults},f=function(){var e=c()(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(Ot.e)(t),e.next=3,i.get([n]);case 3:return r=e.sent,a=r[n].RecipientType,e.abrupt("return",a===s.Wb.TYPE_INTERNAL);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(e){switch(e){case"pgp-mime":return s.Lb.SEND_PGP_MIME;case"pgp-inline":return s.Lb.SEND_PGP_INLINE;default:return null}},g=function(e){return e.Flags&s.kb.ENABLE_ENCRYPTION},h=function(e,t,n){return n.scheme===s.Lb.SEND_PGP_MIME&&(n.sign||n.encrypt)?"multipart/mixed":n.scheme===s.Lb.SEND_PGP_INLINE&&(n.sign||n.encrypt)?"text/plain":n.scheme===s.Lb.SEND_EO?t:"text/plain"===t||null===e?t:e},b=function(){var e=c()(o.a.mark((function e(n,r,a,i,c){var l,d,p,v,m,g,h,b,y,E;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=r.Keys,d=void 0===l?{}:l,p=r.Warnings,v=void 0===p?[]:p,e.next=3,f(n);case 3:if(m=e.sent,g=u.get("PGPScheme"),h=g===s.Lb.SEND_PGP_MIME?"multipart/mixed":"text/plain",b=t.getByEmail(n),y=go(b,d),!m||!d.length){e.next=20;break}return E=mo(b,d),e.t0=v,e.t1=a,e.next=14,Object(ee.f)(d[0].PublicKey);case 14:return e.t2=e.sent,e.t3=!E,e.t4=s.Lb.SEND_PM,e.t5=y,e.t6=y,e.abrupt("return",{warnings:e.t0,encrypt:!0,sign:!0,mimetype:e.t1,publickeys:e.t2,primaryPinned:e.t3,scheme:e.t4,pinned:e.t5,ownAddress:e.t6,isVerified:!0});case 20:if(!i){e.next=22;break}return e.abrupt("return",{warnings:v,encrypt:!0,sign:!1,mimetype:a,publickeys:[],primaryPinned:!0,scheme:s.Lb.SEND_EO,pinned:!1,ownAddress:y,isVerified:!0});case 22:return e.abrupt("return",{warnings:v,encrypt:!1,sign:c,mimetype:c?h:a,publickeys:[],primaryPinned:!0,scheme:c?g:s.Lb.SEND_CLEAR,pinned:!1,ownAddress:y,isVerified:!0});case 23:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}(),y=Ea()(lt.d,lt.g),E=Ea()(Sa.a,y),S=function(){var e=c()(o.a.mark((function e(n,r,a){var i,c,s,u,l,d,p,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.Keys,0!==n.length){e.next=4;break}return c=t.getByEmail(a),e.abrupt("return",!mo(c,i));case 4:return s=k()(i.filter(g),"PublicKey"),e.next=7,Promise.all(s.map(ee.f));case 7:return u=e.sent,l=u.filter((function(e){var t=G()(e,1)[0];return!!(void 0!==t&&t)})),e.next=11,Object(ee.f)(y(n[0]));case 11:return d=e.sent,p=G()(d,1),f=p[0],v=Object(ee.e)(f),e.abrupt("return",0===l.length||l.map((function(e){var t=G()(e,1)[0];return Object(ee.e)(t)})).includes(v));case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),D=function(){var e=c()(o.a.mark((function e(t,n,r,a,i,c){var l,d,p,f,v,m,g,b,y,E,D,k,A,I,C;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t.encryptFlag,d=t.signFlag,p=t.mimetype,f=t.emailKeys,v=t.scheme,m=t.isVerified,g={},b=n.RecipientType,y=n.Warnings,E=void 0===y?[]:y,!(D=b===s.Wb.TYPE_INTERNAL)){e.next=10;break}return e.next=7,S(f,n,c);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=!0;case 11:if(k=e.t0,!D){e.next=18;break}return e.next=15,Object(ee.f)(n.Keys[0].PublicKey);case 15:e.t1=e.sent,e.next=19;break;case 18:e.t1=[];case 19:return A=e.t1,e.next=22,Promise.all(f.map(lt.g).map(lt.d).map((function(e){return Object(ee.f)(e).then((function(e){var t=G()(e,1)[0];return Object(ee.h)(t).then((function(e){return e?null:[t]}))}))})));case 22:return I=e.sent,C=I.filter((function(e){return null!==e})),g.publickeys=C.length&&k?C[0]:A,g.warnings=E,g.encrypt=D||l&&!!C.length,g.sign=D||(null===d?!!i:d),g.sign=g.sign||l,g.scheme=D?s.Lb.SEND_PM:g.sign||g.encrypt?v:s.Lb.SEND_CLEAR,g.scheme=null===g.scheme?u.get("PGPScheme"):g.scheme,a&&!g.encrypt&&(g.sign=!1,g.encrypt=!0,g.scheme=s.Lb.SEND_EO),g.mimetype=h(p,r,g),g.primaryPinned=k,g.isVerified=m,g.pinned=C.length>0,g.ownAddress=!1,e.abrupt("return",g);case 38:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o,i){return e.apply(this,arguments)}}(),A=function(){var e=c()(o.a.mark((function e(t,n){var r,a,i,c,s,u,l,d,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=k()(t.Keys.filter(g),"PublicKey"),a=Promise.all(r.map(Sa.a)),i=Promise.all(n.map(E)),e.next=5,Promise.all([i,a]);case 5:return c=e.sent,s=G()(c,2),u=s[0],l=s[1],d=function(e){var t=e.fingerprint;return k()(l,"fingerprint").includes(t)},p=n.filter((function(e,t){return d(u[t])})),f=n.filter((function(e,t){return!d(u[t])})),e.abrupt("return",p.concat(f));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=c()(o.a.mark((function e(t,i,c,u,d){var f,g,h,y,E,S,I,C,w,O,M,P,x,T,L,j,N,$,R,_,U,F,B;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=Object(Ot.e)(t),g=i.RecipientType===s.Wb.TYPE_INTERNAL,h=n.findEmail(f,Ot.e),!p(h)){e.next=11;break}return e.t0=v.a,e.t1={},e.t2=t,e.next=9,b(t,i,c,u,d);case 9:return e.t3=e.sent,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 11:return e.next=13,r.get(h.ContactID);case 13:if(y=e.sent,E=y.vCard,S=y.errors,I=Object(ka.e)(E.get("key")),C=Object(ka.e)(E.get("x-pm-encrypt")),w=Object(ka.e)(E.get("x-pm-sign")),O=Object(ka.e)(E.get("x-pm-scheme")),M=Object(ka.e)(E.get("x-pm-mimetype")),P=Object(ka.e)(E.get("email")),x=oo(P,f)){e.next=31;break}return e.t4=v.a,e.t5={},e.t6=t,e.next=29,b(t,i,c,u,d);case 29:return e.t7=e.sent,e.abrupt("return",(0,e.t4)(e.t5,e.t6,e.t7));case 31:return T=io(x.toLowerCase()),L=J()(I,T),j=le()(C,T),N=le()(w,T),$=le()(M,T),R=$?$.valueOf():null,_=le()(O,T),U=_?m(_.valueOf()):null,e.t8=A,e.t9=i,e.next=43,Promise.all(k()(L,(function(e){return a.getBase64Value(e)})));case 43:return e.t10=Boolean,e.t11=e.sent.filter(e.t10),e.next=47,(0,e.t8)(e.t9,e.t11);case 47:return F=e.sent,(B={encryptFlag:g||!!j&&"false"!==j.valueOf().toLowerCase()&&L.length>0,signFlag:g||(N?"false"!==N.valueOf().toLowerCase():null),emailKeys:F,mimetype:"text/plain"!==R&&"text/html"!==R?null:R,scheme:g?s.Lb.SEND_PM:U,isVerified:!S.includes(Da.b.TYPE2_CONTACT_VERIFICATION)}).signFlag=B.signFlag||B.encryptFlag,l.EXTRACTED_INFO[h.ContactID]=l[h.ContactID]||{},l.EXTRACTED_INFO[h.ContactID][f]=B,e.t12=v.a,e.t13={},e.t14=t,e.next=57,D(B,i,c,u,d,t);case 57:return e.t15=e.sent,e.abrupt("return",(0,e.t12)(e.t13,e.t14,e.t15));case 59:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}(),C=function(){var e=c()(o.a.mark((function e(t,r,a,i,c){var s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=Object(Ot.e)(t),u=n.findEmail(s,Ot.e),!p(u)){e.next=10;break}return e.t0=v.a,e.t1={},e.t2=t,e.next=8,b(t,r,a,i,c);case 8:return e.t3=e.sent,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 10:if(Et()(l.EXTRACTED_INFO,u.ContactID)&&Et()(l.EXTRACTED_INFO[u.ContactID],t)){e.next=12;break}return e.abrupt("return",v()({},t,null));case 12:return e.t4=v.a,e.t5={},e.t6=t,e.next=17,D(l.EXTRACTED_INFO[u.ContactID][t],r,a,i,c,t);case 17:return e.t7=e.sent,e.abrupt("return",(0,e.t4)(e.t5,e.t6,e.t7));case 19:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}(),w=function(e){return ba()(e,(function(e){return p(e)||(t=e,Et()(l.EXTRACTED_INFO,t.ContactID)&&Et()(l.EXTRACTED_INFO[t.ContactID],Object(Ot.e)(t.Email)));var t}))},O=function(e,r,a,o,i){var c,s,u,l=t.getByEmail(e);return go(l,r.Keys)?b(e,r,a,o,i).then((function(t){return v()({},e,t)})):(c=[e],s=k()(c,Ot.e),u=k()(s,(function(e){return n.findEmail(e,Ot.e)})),w(u)?C(e,r,a,o,i):I(e,r,a,o,i))},M=function(){var e=c()(o.a.mark((function e(){var t,n,r,a,s,l,d,p,f,v=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:[],n=v.length>1?v[1]:void 0,r=v.length>2&&void 0!==v[2]&&v[2],a=n?n.MIMEType:null,s=n&&n.isEO(),l=n?n.isSign():u.get("Sign"),d=ga()(k()(t,Ot.e)),e.next=9,Promise.all(d.map(function(){var e=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.getKeysPerEmail(t);case 3:return n=e.sent,e.abrupt("return",O(t,n,a,s,l));case 7:if(e.prev=7,e.t0=e.catch(0),r){e.next=11;break}throw e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()));case 9:return p=e.sent,f=Ge.a.apply(void 0,we()(p)),e.abrupt("return",t.reduce((function(e,t){var n=f[Object(Ot.e)(t)];return n?(e[t]=n,e):e}),{}));case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();d("contacts",(function(e,t){var n,r=t.type,a=t.data,o=(a=void 0===a?{}:a).events,i=void 0===o?[]:o,c=a.contact,s=void 0===c?{}:c;"contactEvents"===r&&function(e){e.forEach((function(e){var t=e.ID;return delete l.EXTRACTED_INFO[t]}))}(i),"contactUpdated"===r&&(n=s.ID,delete l.EXTRACTED_INFO[n])}));var P=function(){l.EXTRACTED_INFO={}};return P(),d("logout",(function(){P()})),{get:M,clearCache:P}}ho.$inject=["dispatchers","addressesModel","contactEmails","Contact","contactKey","keyCache","mailSettingsModel"];var bo=ho,yo=n("VkAN"),Eo=n.n(yo),So=n("/Bn5");function Do(){var e=Eo()(['<a\n        target="_blank"\n        href="','">',"</a>"]);return Do=function(){return e},e}Ao.$inject=["Contact","keyCache","contactEmails","confirmModal","gettextCatalog","translator"];var ko="item1";function Ao(e,t,n,r,a,i){var u=function(e){return Object(So.a)(Do(),s.mb.ADDRESS_VERIFICATION,e)},l=i((function(){return{LEARN_MORE:a.getString("Learn more",null,"Link"),PROMPT_TITLE:a.getString("Do you want to trust the primary key?",null,"Title"),promptMessage:function(e){return a.getString("You have enabled Address Verification with Trusted Keys for {{ emails }}, but no active encryption keys have been Trusted.\n                 You must Trust the primary key in order to send a message to this address.",{emails:"<b>".concat(e.join(", "),"</b>")},"Error")+u(this.LEARN_MORE)},PROMPT_TITLE_RESIGN:a.getString("Do you want to re-sign the contact?",null,"Title"),promptResignMessage:function(e){return a.getString("The verification of {{ emails }} has failed: the contact is not signed correctly.\n                    You must re-sign the contact in order to send a message to this address or edit the contact. This can also happen when\n                    you have recovered your password and reset your keys.",{emails:"<b>".concat(e.join(", "),"</b>")},"Warning")+u(this.LEARN_MORE)}}})),d=function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(Ot.e)(n),i=Object(ka.e)(t.get("email")),c=oo(i,a),e.next=5,Object(te.e)(r[n].Keys[0].PublicKey);case 5:s=e.sent,t.add("key",s,{group:c});case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),p=function(t,r){return Promise.all(t.map(function(){var t=c()(o.a.mark((function t(a){var i,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=Object(Ot.e)(a),n.findEmail(i,Ot.e)){t.next=9;break}return(c=new wa.a).set("fn",i),c.set("email",i,{group:ko}),t.next=8,d(c,a,r);case 8:return t.abrupt("return",e.add([{vCard:c}]).then((function(){return!1})));case 9:return t.abrupt("return",Promise.resolve(a));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())).then((function(e){return e.filter((function(e){return e}))}))},f=function(){var t=c()(o.a.mark((function t(r,a){var i,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p(r,a);case 2:return i=t.sent,s=i.reduce((function(e,t){var r=Object(Ot.e)(t),a=n.findEmail(r,Ot.e);return Et()(e,a.ContactID)||(e[a.ContactID]=[]),e[a.ContactID].push(t),e}),{}),t.abrupt("return",Promise.all(Object.keys(s).map(function(){var t=c()(o.a.mark((function t(n){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(n);case 2:return r=t.sent,t.next=5,Promise.all(s[n].map((function(e){return d(r.vCard,e,a)})));case 5:return t.abrupt("return",e.update(r));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())));case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),v=function(e,t){return new Promise((function(n){return r.activate({params:{title:t?l.PROMPT_TITLE_RESIGN:l.PROMPT_TITLE,message:t?l.promptResignMessage(e):l.promptMessage(e),cancel:function(){return n(!1)},confirm:function(){r.deactivate().then((function(){return n(!0)}))}}})}))};return{confirm:function(e){return v(e,!1).then((function(n){return n?t.get(e.map(Ot.e)).then((function(t){return f(e,t)})).then(r.deactivate).then((function(){return!0})):(r.deactivate(),!1)}))},resign:function(t){return v(t,!0).then((function(a){return a?function(t){return Promise.all(t.map((function(t){var r=Object(Ot.e)(t),a=n.findEmail(r,Ot.e);return e.get(a.ContactID).then((function(t){return e.updateUnencrypted(t)}))})))}(t).then(r.deactivate).then((function(){return!0})):(r.deactivate(),!1)}))}}}var Io=Ao;function Co(e,t){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.indexOf(";");return-1===t?e:e.substr(0,t)},r=function(e){return k()(e,(function(e){var t=e.attachment,r=e.data,a=JSON.stringify(t.Name),o=n(t.Headers["content-type"])||t.MIMEType||"application/octet-stream",i=n(t.Headers["content-disposition"])||"attachment",c=Xt.a.factory({contentType:"".concat(o,"; filename=").concat(a,"; name=").concat(a),contentTransferEncoding:"base64",body:Object(lt.b)(r)});return c.header("content-disposition","".concat(i,"; filename=").concat(a,"; name=").concat(a)),t.Headers["content-id"]&&c.header("content-id",t.Headers["content-id"]),c}))},a=function(t,n){var a=Xt.a.factory({contentType:"text/html;charset=utf-8",contentTransferEncoding:"base64",body:t}),o=e.getBodyParser(t),i=e.extractEmbedded(n,o),c=r(i),s=[a].concat(c);return Xt.a.factory({contentType:"multipart/related",body:s})},i=function(e){return Xt.a.factory({body:e,contentTransferEncoding:"quoted-printable"})},s=function(e,t,n){return!1!==t&&!1!==e?function(e,t,n){return Xt.a.factory({contentType:"multipart/alternative",body:[i(e),a(t,n)]})}(e,t,n):!1!==t?a(t,n):i(e)},u=function(t,n,a){var o=s(t,n,a),i=function(t,n){if(!1===t)return n;var r=e.getBodyParser(t),a=e.extractEmbedded(n,r);return xa()(n,a)}(n,a),c=r(i),u=[o].concat(c);return Xt.a.factory({contentType:"multipart/mixed",body:u}).toString()+"\r\n"},l=function(e,t){return!(!e.isPlainText()&&!t)&&e.exportPlainText()},d=function(e,n){return Promise.all(k()(e.getAttachments(),function(){var n=c()(o.a.mark((function n(r){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=r,n.next=3,t.get(r,e);case 3:return n.t1=n.sent,n.abrupt("return",{attachment:n.t0,data:n.t1});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())).then((function(t){return[t,l(e,n)]}))};return{construct:function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,c,s,l=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(l.length>1&&void 0!==l[1])||l[1],!t.isMIME()||!t.decryptedMIME){e.next=3;break}return e.abrupt("return",t.decryptedMIME);case 3:return e.next=5,d(t,n);case 5:return r=e.sent,a=G()(r,2),i=a[0],c=a[1],s="text/html"===t.MIMEType&&t.getDecryptedBody(),e.abrupt("return",u(c,s,i));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),build:u}}Co.$inject=["embeddedUtils","AttachmentLoader"];var wo=Co;function Oo(e,t,n,r,a,i){var s=e(["actionMessage"]).dispatcher,u=function(e){return s.actionMessage("update",e)},l=function(e,t,n){return i(e,n).then((function(r){return a(r,e,t,n)})).then((function(t){return r(e,t)}))};return function(){var e=c()(o.a.mark((function e(r,a){var i,c,s,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=ga()(a),e.next=4,n.get(i,r);case 4:return c=e.sent,e.next=7,l(r,a,c);case 7:return s=e.sent,d=!s.map((function(e){return e.MIMEType})).includes(r.MIMEType),e.next=11,t(r,{loader:!1,encrypt:d});case 11:return e.abrupt("return",s);case 14:throw e.prev=14,e.t0=e.catch(0),console.error("Cannot encrypt message",e.t0),r.encrypting=!1,u(r),e.t0;case 20:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}()}Oo.$inject=["dispatchers","postMessage","sendPreferences","encryptPackages","attachSubPackages","generateTopPackages"];var Mo=Oo,Po=n("7GkX"),xo=n.n(Po),To=n("TYy9"),Lo=n.n(To),jo=n("VJLA"),No=n.n(jo);function $o(e,t){var n=Ea()(lt.j,lt.b),r=function(e){var t=e.data,r=e.algorithm,a=void 0===r?s.b:r;return{Key:n(t),Algorithm:a}},a=function(e){var t=e.sessionKeys,r=void 0===t?[]:t,a=e.publicKeys,o=void 0===a?[]:a,i=e.passwords,c=void 0===i?[]:i,s=k()(r,(function(e){return Object(N.b)({data:e.data,algorithm:e.algorithm,publicKeys:o.length>0?o:void 0,passwords:c}).then((function(e){return e.message.packets.write()})).then(n)}));return Promise.all(s)},i=function(e,t,n){if("multipart/mixed"!==e.MIMEType){var o=k()(e.Addresses,(function(e){return e.Type&s.gc.SEND_EO||e.PublicKey?(e.AttachmentKeyPackets=[],a({sessionKeys:k()(n,(function(e){return e.sessionKey})),passwords:e.Type&s.gc.SEND_EO?[t.Password]:void 0,publicKeys:e.Type&s.gc.SEND_EO?void 0:[e.PublicKey]}).then((function(e){return No()(k()(n,(function(e){var t=e.AttachmentID,n=e.ID;return t||n})),e)})).then((function(t){e.AttachmentKeyPackets=t}))):Promise.resolve()}));return e.Type&s.gc.SEND_CLEAR&&(e.AttachmentKeys=Ge.a.apply(void 0,we()(k()(n,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sessionKey,n=void 0===t?{}:t,a=e.AttachmentID,o=e.ID;return v()({},a||o,r(n))}))))),Promise.all(o)}return Promise.resolve()},u=function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s.b,e.next=3,Object(ee.d)(s.b);case 3:return e.t1=e.sent,e.abrupt("return",{algorithm:e.t0,data:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,c,s,l,d,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=J()(r),e.t0=ut.a,e.t1=t.Body,e.t2=a,!a.length){e.next=8;break}e.t3=void 0,e.next=11;break;case 8:return e.next=10,u();case 10:e.t3=e.sent;case 11:return e.t4=e.t3,e.t5=n,e.t6={data:e.t1,publicKeys:e.t2,sessionKey:e.t4,privateKeys:e.t5,returnSessionKey:!0,compression:!0},e.next=16,(0,e.t0)(e.t6);case 16:return i=e.sent,c=i.data,s=i.sessionKey,e.next=21,Object(Ve.i)(c);case 21:return l=e.sent,d=l.asymmetric,p=l.encrypted,e.abrupt("return",{keys:d,encrypted:p,sessionKey:s});case 25:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),d=function(){var e=c()(o.a.mark((function e(t,n,r,a){var i,c,s,u,l,d,p,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ee.f)(a.From.Keys[0].PublicKey);case 2:return i=e.sent,c=i.concat(J()(r)),e.next=6,Object(ut.a)({data:t.Body,publicKeys:c,privateKeys:n,returnSessionKey:!0,compression:!0});case 6:return s=e.sent,u=s.data,l=s.sessionKey,e.next=11,Object(Ve.i)(u);case 11:return d=e.sent,p=d.asymmetric,f=d.encrypted,d.asymmetric=d.asymmetric.slice(0,i.length),v=Ea()(lt.e,Lo.a,Ze.a)(d),e.next=17,Object(Ve.a)(v);case 17:return a.Body=e.sent,e.abrupt("return",{keys:p.slice(i.length),encrypted:f,sessionKey:l});case 19:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),p=function(){var e=c()(o.a.mark((function e(t,i,c){var u,p,f,v,m,g,h,b,y;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=xo()(t.Addresses),p=k()(t.Addresses,(function(e){return e.PublicKey})),f=c.MIMEType===t.MIMEType?d:l,e.next=5,f(t,i,p,c);case 5:return v=e.sent,m=v.keys,g=v.encrypted,h=v.sessionKey,b=0,We()(p,(function(e,r){if(e){var a=m[b++];t.Addresses[u[r]].BodyKeyPacket=n(a)}})),y=k()(t.Addresses,(function(e){return e.Type!==s.gc.SEND_EO?Promise.resolve():a({sessionKeys:[h],passwords:[c.Password]}).then((function(t){var n=G()(t,1)[0];e.BodyKeyPacket=n}))})),e.next=14,Promise.all(y);case 14:t.Type&(s.gc.SEND_CLEAR|s.gc.SEND_MIME)&&(t.BodyKey=r(h)),t.Body=n(g[0]);case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),f=function(e,t,n,r){return Promise.all([p(e,n,t),i(e,t,r)]).then((function(){return We()(e.Addresses,(function(e){return delete e.PublicKey}))})).then((function(){return e}))},m=function(e){var n=e.Attachments.map((function(n){return t.getSessionKey(e,n)}));return Promise.all(n)};return function(){var t=c()(o.a.mark((function t(n,r){var a,i,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(n);case 2:return a=t.sent,i=e.getPrivateKeys(n.From.ID)[0],c=k()(r,(function(e){return f(e,n,[i],a)})),t.next=7,Promise.all(c);case 7:return t.abrupt("return",Ze()(r));case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}$o.$inject=["keysModel","AttachmentLoader"];var Ro=$o,_o=n("X/lc"),Uo=s.Db.FLAG_RECEIVED;function Fo(e){var t=function(e){return"text/html"===e.MIMEType&&e.getDecryptedBody()},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(_o.c)(e,Uo)},r=function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{Flags:n(t.Flags),Addresses:{},MIMEType:"text/plain",Body:t.exportPlainText()});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a=function(){var e=c()(o.a.mark((function e(r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{Flags:n(r.Flags),Addresses:{},MIMEType:"text/html",Body:t(r)});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=function(){var t=c()(o.a.mark((function t(r){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n(r.Flags),t.t1={},t.next=4,e.construct(r);case 4:return t.t2=t.sent,t.abrupt("return",{Flags:t.t0,Addresses:t.t1,MIMEType:"multipart/mixed",Body:t.t2});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return function(){var e=c()(o.a.mark((function e(t,n){var c,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=bt()(n,(function(e,t){return{plaintext:e.plaintext||"text/plain"===t.mimetype,html:e.html||"text/html"===t.mimetype||t.scheme===s.gc.SEND_PGP_MIME&&!t.encrypt&&!t.sign,mime:e.mime||t.scheme===s.gc.SEND_PGP_MIME&&(t.encrypt||t.sign)}}),{plaintext:!1,html:!1,mime:!1}),u=J()(xo()(c),(function(e){return c[e]})),l={},e.next=5,Promise.all(u.map((function(e){switch(e){case"mime":return i(t).then((function(e){return l.mime=e}));case"plaintext":return r(t).then((function(e){return l.plaintext=e}));case"html":return a(t).then((function(e){return l.html=e}));default:return Promise.reject()}})));case 5:return e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}Fo.$inject=["mimeMessageBuilder"];var Bo=Fo;function Ko(e,t){var n=e(["actionMessage"]).dispatcher,r=function(e){return n.actionMessage("update",e)},a=function(){var e=c()(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.publickeys,e.abrupt("return",{Type:s.gc.SEND_PM,PublicKey:r.length?r[0]:void 0,Signature:+n.Attachments.every((function(e){return e.Signature}))});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),i=function(){var e=c()(o.a.mark((function e(n){var a,i,c,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.generateReplyToken();case 3:return a=e.sent,e.next=6,Promise.all([Object(ut.a)({data:a,publicKeys:[],passwords:[n.Password]}),t.getVerify({Password:n.Password})]);case 6:return i=e.sent,c=G()(i,2),u=c[0].data,l=c[1].Auth,e.abrupt("return",{Auth:l,Type:s.gc.SEND_EO,PasswordHint:n.PasswordHint,Token:a,EncToken:u,Signature:+n.Attachments.every((function(e){return e.Signature}))});case 13:throw e.prev=13,e.t0=e.catch(0),n.encrypting=!1,r(n),console.error(e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=c()(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.publickeys,r=t.sign,!t.encrypt){e.next=3;break}return e.abrupt("return",{Type:s.gc.SEND_PGP_MIME,PublicKey:n.length?n[0]:void 0});case 3:return e.abrupt("return",{Type:s.gc.SEND_MIME,Signature:+r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=c()(o.a.mark((function e(t,n){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.publickeys,a=t.sign,!t.encrypt){e.next=3;break}return e.abrupt("return",{Type:s.gc.SEND_PGP_INLINE,PublicKey:r.length?r[0]:void 0,Signature:+n.Attachments.every((function(e){return e.Signature}))});case 3:return e.abrupt("return",{Type:s.gc.SEND_CLEAR,Signature:+a});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),d=function(){return Promise.resolve({Type:s.gc.SEND_CLEAR,Signature:0})};return function(e,t,n,r){var o=function(t,n,r){return t.then((function(t){e[r].Addresses[n]=t,e[r].Type|=t.Type}))},c=k()(n,(function(e){var n=r[e],c="text/html"===(null===n.mimetype?t.MIMEType:n.mimetype)?"html":"plaintext";switch(n.scheme){case s.gc.SEND_PM:return o(a(n,t),e,c);case s.gc.SEND_PGP_MIME:return n.sign||n.encrypt?o(u(n),e,"mime"):o(d(),e,"html");case s.gc.SEND_PGP_INLINE:return o(l(n,t),e,"plaintext");case s.gc.SEND_EO:case s.gc.SEND_CLEAR:return t.isEO()?o(i(t),e,c):o(d(),e,c)}}));return Promise.all(c).then((function(){return e}))}}Ko.$inject=["dispatchers","srp"];var Go=Ko;qo.$inject=["attachmentModel","embedded"];var Vo=s.Gb.PLAINTEXT;function qo(e,t){function n(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(","),t=G()(e,2),n=t[0],r=void 0===n?"":n,a=t[1],o=void 0===a?"":a,i=r.split(":")[1].split(";")[0],c=openpgp.util.b64_to_Uint8Array(o);return new Blob([c],{type:i})}function r(){return(r=c()(o.a.mark((function r(a){var i,c,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a.MIMEType!==Vo){r.next=2;break}return r.abrupt("return",a);case 2:return i=a.getDecryptedBody(),(c=document.createElement("DIV")).innerHTML=Object(Kt.a)(i),s=c.querySelectorAll("img"),u=Be()(Re()((function(e){return{image:e,src:e.dataset.src}})),Ue()((function(e){var t=e.src;return/data:image/.test(t)})),Ue()((function(e){return e.src.includes(",")})),Re()((function(r){var o=r.src,i=r.image,c=t.generateCid(o,a.From.Email),s=function(){return i.setAttribute("data-embedded-img",c),Promise.resolve()};if(t.exist(a,c))return s();var u=n(o);return u.name=i.alt||"image"+Date.now(),u.inline=1,e.create(u,a,!0,c).then(s)})))([].slice.call(s)),r.next=9,Promise.all(u);case 9:return a.setDecryptedBody(Object(Kt.k)(c.innerHTML)),r.abrupt("return",a);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return function(e){return r.apply(this,arguments)}}var Ho=qo,zo=function(e,t){var n=e.name,r=e.type,a=e.size,o=t.Name,i=t.MIMEType,c=t.Size;return o===n&&i===r&&a>.8*c&&a<1.2*c};function Yo(e,t,n){var r=n(["attachment.upload"]).dispatcher,a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.publicKeyArmored,r=t.fingerprint,a=new Blob([n],{type:"application/pgp-keys"});return a.name="publickey - ".concat(e.From.Email," - 0x").concat(r.slice(0,8).toUpperCase(),".asc"),a.inline=0,a};return{attach:function(){var n=c()(o.a.mark((function n(){var r,i,c,s,u,l=arguments;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=l.length>0&&void 0!==l[0]?l[0]:{}).isAttachPublicKey()){n.next=3;break}return n.abrupt("return");case 3:return i=e.getPrivateKeys(r.From.ID)[0],n.next=6,Object(Sa.a)(i.armor());case 6:if(c=n.sent,s=a(r,c),!r.Attachments.some((function(e){return zo(s,e)}))){n.next=11;break}return n.abrupt("return");case 11:return n.next=13,t.create(s,r,!1);case 13:u=n.sent,u.attachment.isPublicKey=!0;case 16:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),remove:function(){var e=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.Attachments.filter((function(e){var t=e.isPublicKey;return void 0!==t&&t})),r["attachment.upload"]("remove.all",{message:t,list:n});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}Yo.$inject=["keysModel","attachmentModel","dispatchers"];var Wo=Yo;function Xo(e,t){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.kc.CREATE,n=arguments.length>1?arguments[1]:void 0;return e===s.kc.UPDATE?t.updateDraft(n):t.createDraft(n)};function r(){return(r=c()(o.a.mark((function e(r,a,i){var c,s,u,l,d,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n(i,r);case 3:return c=e.sent,s=c.data,u=void 0===s?{}:s,e.abrupt("return",u);case 9:if(e.prev=9,e.t0=e.catch(0),l=e.t0.data,(void 0===l?{}:l).Code!==Da.a.MESSAGE_UPDATE_DRAFT_NOT_EXIST){e.next=20;break}return delete r.id,e.next=16,t.createDraft(r);case 16:return d=e.sent,p=d.data,f=void 0===p?{}:p,e.abrupt("return",f);case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function a(){return(a=c()(o.a.mark((function e(n){var r,a,i,c,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:[],e.next=3,t.send(n,{suppress:r});case 3:return a=e.sent,i=a.data,c=void 0===i?{}:i,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{draft:function(e,t,n){return r.apply(this,arguments)},send:function(e){return a.apply(this,arguments)}}}Xo.$inject=["dispatchers","messageApi"];var Jo=Xo;function Qo(e){return function(t,n,r){var a=e(),o=a.on,i=a.unsubscribe;return o(t,function(e,t){return function(n,r){var a=r.type,o=r.data,i=void 0===o?{}:o;(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.ID||"editor",r=t.ID||"editor";return r===n})(e.message,i.message)&&t(a,i)}}(n,r)),i}}Qo.$inject=["dispatchers"];var Zo=Qo,ei=n("JZM8"),ti=n.n(ei),ni=n("qPyV"),ri=n.n(ni),ai=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Labels,n=void 0===t?[]:t,r=e.ContextNumUnread,a=void 0===r?0:r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.toAdd,c=void 0===i?[]:i,s=o.toRemove,u=void 0===s?[]:s,l=n.filter((function(e){return-1===u.indexOf(e.ID)})),d=c.map((function(e){return{ID:e,ContextNumUnread:a}}));return ri()(l.concat(d),(function(e){return e.ID}))};function oi(e,t,n,r,a,i,u,l,d,p,f,v,m,g){var h=g((function(){return{SAVE_MESSAGE_SUCCESS:a.getString("Message saved",null,"Record message")}})),b=e(["actionMessage","composer.update"]).dispatcher,y=r,E=function(e){return b.actionMessage("update",e)},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b["composer.update"](e,t)},D=function(e){var t=J()(e.Attachments,(function(e){return!e.Signature})),n=J()(t,p.has),r=k()(n,(function(t){return f.sign(t,e)}));return Promise.all(r)};function A(e,t){var n=e.Attachments.reduce((function(e,t){return e[t.ID]=t,t.AttachmentID&&(e[t.AttachmentID]=t),e}),{});return t.Attachments.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.push(Ge()({},n[t.ID],t)),e}),[])}var I=function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,c,s,u,l,d,p,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n={Message:ti()(t,"ToList","CCList","BCCList","Subject","Unread","MIMEType","Flags")}).Message.Subject=n.Message.Subject||"",E(t),angular.isString(n.Message.ToList)&&(n.Message.ToList=[]),angular.isString(n.Message.CCList)&&(n.Message.CCList=[]),angular.isString(n.Message.BCCList)&&(n.Message.BCCList=[]),angular.isDefined(t.ParentID)&&(n.ParentID=t.ParentID,n.Action=t.Action),angular.isDefined(t.ID)?n.id=t.ID:n.Message.Unread=0,!1==!t.autosaving&&(n.Message.Unread=0),r=t.From||{},a=r.DisplayName,i=r.Email,n.Message.Sender={Name:a||"",Address:i},e.next=13,m.format(n.Message,t);case 13:return c=e.sent,s=c.ToList,u=c.CCList,l=c.BCCList,n.Message.ToList=s,n.Message.CCList=u,n.Message.BCCList=l,d=t.From.Keys||[],p=G()(d,1),f=p[0],v=(f=void 0===f?{}:f).PublicKey,e.next=25,t.encryptAttachmentKeyPackets(v);case 25:return n.AttachmentKeyPackets=e.sent,t.AddressID=t.From.ID,n.Message.AddressID=t.From.ID,e.abrupt("return",n);case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=c()(o.a.mark((function e(r,a){var i,c,u,l,d,p,f,v,g,b,k,I,C,w;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.actionType,c=a.parameters,u=a.notification,e.prev=1,e.next=4,t.draft(c,r,i);case 4:return l=e.sent,d=l.Message,p=n.getConversationCached(d.ConversationID)||{},f=p.Labels,v=void 0===f?[]:f,g=p.ContextNumUnread,b=void 0===g?0:g,i===s.kc.CREATE?(k=(p.NumMessages||0)+1,r.ID=d.ID):i===s.kc.UPDATE&&(k=p.NumMessages||0),r.Unread=d.Unread,r.Time=d.Time,r.Type=d.Type,r.LabelIDs=d.LabelIDs,d.Attachments.length>0&&(r.Attachments=A(r,d)),e.next=16,D(r);case 16:return r.NumAttachments=r.Attachments.length,r.NumEmbedded=r.countEmbedded(),r.AddressID=d.AddressID,d.Senders=[d.Sender],d.Recipients=m.toList(d),I={Recipients:d.Recipients,Senders:d.Senders,Subject:d.Subject},(C=[{Action:i,ID:d.ID,Message:d}]).push({Action:s.kc.UPDATE_FLAGS,ID:d.ConversationID,Conversation:angular.extend({NumAttachments:r.Attachments.length,NumMessages:k,ContextNumUnread:b,ID:d.ConversationID,Labels:ai({ContextNumUnread:b,Labels:v},{toAdd:[s.rb.allDrafts,s.rb.drafts]})},1===k?I:{})}),n.events(C),!0===u&&y.success(h.SAVE_MESSAGE_SUCCESS),r.saving=!1,r.autosaving=!1,E(r),e.abrupt("return",r);case 32:if(e.prev=32,e.t0=e.catch(1),w=e.t0.data,(void 0===w?{}:w).Code!==Da.a.MESSAGE_UPDATE_DRAFT_NOT_DRAFT){e.next=37;break}return e.abrupt("return",S("close.message",{message:r}));case 37:throw e.t0;case 38:case"end":return e.stop()}}),e,null,[[1,32]])})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isPlainText()){e.next=5;break}return e.next=3,u.parser(t,{direction:"cid",isOutside:l.get(t.ID)});case 3:n=e.sent,t.setDecryptedBody(n);case 5:return e.abrupt("return",t.encryptBody(t.From.Keys[0].PublicKey));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=c()(o.a.mark((function e(t,n){var r,a,c,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.notification,a=n.autosaving,c=n.encrypt,e.prev=1,t.saving=!0,t.autosaving=a,e.next=6,I(t,a);case 6:if(u=e.sent,t.ID&&(u.id=t.ID),l=t.ID?s.kc.UPDATE:s.kc.CREATE,!c){e.next=15;break}return e.next=12,w(t);case 12:e.t0=e.sent,e.next=16;break;case 15:e.t0=t.Body;case 16:return u.Message.Body=e.t0,e.next=19,C(t,{actionType:l,parameters:u,notification:r});case 19:return e.abrupt("return",e.sent);case 22:throw e.prev=22,e.t1=e.catch(1),t.saving=!1,t.autosaving=!1,E(t),i.clear(t),e.t1;case 29:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,n){return e.apply(this,arguments)}}();return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.notification,r=void 0!==n&&n,a=t.autosaving,o=void 0!==a&&a,c=t.loader,s=void 0===c||c,u=t.encrypt,l=void 0===u||u,p=function(){var t=O(e,{notification:r,autosaving:o,encrypt:l});return o&&!s||d.track(t),t};return i.add(e,p)}}oi.$inject=["dispatchers","messageRequest","cache","notification","gettextCatalog","composerRequestModel","embedded","outsidersMap","networkActivityTracker","AttachmentLoader","attachmentModel","embeddedUtils","recipientsFormator","translator"];var ii=oi,ci=n("6vz9"),si=n.n(ci);function ui(e,t,n,r,a,i,u,l,d,p,f,v,m,g,h,b){var y=b((function(){return{SEND_SUCCESS:i.getString("Message sent",null,"Send message"),EXPIRE_ERROR:i.getString("Expiring emails to non-ProtonMail recipients require a message password to be set. For more information, {{link}}click here",{link:'<a href="https://protonmail.com/support/knowledge-base/expiration/" target="_blank">'},"Send message")}})),E=r(["actionMessage","composer.update","message.open"]).dispatcher,S=function(e){return E.actionMessage("update",e)},D=function(){var e=c()(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.encrypting=!0,S(t),n.id=t.ID,t.ExpiresIn&&(n.ExpiresIn=t.ExpiresIn),t.isPlainText()){e.next=9;break}return e.next=7,u.parser(t,{direction:"cid",isOutside:l.get(t.ID)});case 7:r=e.sent,t.setDecryptedBody(r);case 9:return e.abrupt("return",t.emailsToString());case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=c()(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.Attachments.every((function(e){return e.Signature}))){e.next=2;break}return e.abrupt("return",!1);case 2:return n=J()(t.Attachments,(function(e){return e.Signature})),r=k()(n,function(){var e=c()(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.Signature=null,e.next=3,m.updateSignature(n);case 3:return e.abrupt("return",g.verify(n,null,t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(r).then((function(){return!0})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var r=c()(o.a.mark((function r(a,i){var c,s,u,l,f,v=arguments;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=!(v.length>2&&void 0!==v[2])||v[2],r.next=3,D(a,i);case 3:return s=r.sent,u=A(a),r.next=7,d(a,s);case 7:return l=r.sent,i.Packages=l,r.next=11,u;case 11:return a.encrypting=!1,S(a),r.next=15,n.chain(a);case 15:return f=c?[Da.a.MESSAGE_VALIDATE_KEY_ID_NOT_ASSOCIATED]:[],r.prev=16,r.next=19,p.send(i,f);case 19:return r.abrupt("return",r.sent);case 22:if(r.prev=22,r.t0=r.catch(16),!c||r.t0.data.Code!==Da.a.MESSAGE_VALIDATE_KEY_ID_NOT_ASSOCIATED){r.next=28;break}return e.clearCache(),t.clearCache(),r.abrupt("return",I(a,i,!1));case 28:throw r.t0;case 29:case"end":return r.stop()}}),r,null,[[16,22]])})));return function(e,t){return r.apply(this,arguments)}}();return function(){var e=c()(o.a.mark((function e(t){var n,r,i,c,u,l,d,p,m,g,b,S,D,k=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=k.length>1&&void 0!==k[1]?k[1]:{},e.next=3,I(t,n);case 3:r=e.sent,i=r.Parent,c=r.Sent,u=void 0===c?{}:c,E["composer.update"]("send.success",{message:t,discard:!1,save:!1}),l=v.getConversationCached(u.ConversationID)||{},d=l.NumMessages,p=void 0===d?1:d,m=l.ContextNumUnread,g=void 0===m?0:m,b=l.Labels,S=void 0===b?[]:b,u.Senders=[u.Sender],u.Recipients=h.toList(t),D=[{Action:s.kc.UPDATE_FLAGS,ID:u.ID,Message:u}],i&&D.push({Action:s.kc.UPDATE_FLAGS,ID:i.ID,Message:i}),D.push({Action:s.kc.UPDATE_FLAGS,ID:u.ConversationID,Conversation:{NumMessages:p,ContextNumUnread:g,Recipients:u.Recipients,Senders:u.Senders,Subject:u.Subject,ID:u.ConversationID,Labels:ai({ContextNumUnread:g,Labels:S},{toAdd:[s.rb.allSent,s.rb.sent],toRemove:[s.rb.allDrafts,s.rb.drafts]})}}),f.success(y.SEND_SUCCESS),v.events(D,!1,!0),si()((function(){E["message.open"]("save.success",{message:a(u)})}),500);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}ui.$inject=["sendPreferences","keyCache","composerRequestModel","dispatchers","messageModel","gettextCatalog","embedded","outsidersMap","encryptMessage","messageRequest","notification","cache","attachmentApi","SignatureVerifier","recipientsFormator","translator"];var li=ui;fi.$inject=["gettextCatalog","tools","confirmModal","expirationModal","keyCache","authentication","notification","addressWithoutKeys","sendPreferences","storageWarning","translator"];var di=s.Gb.PLAINTEXT,pi=[s.Lb.SEND_CLEAR,s.Lb.SEND_PGP_INLINE,s.Lb.SEND_PGP_MIME];function fi(e,t,n,r,a,i,u,l,d,p,f){var v=f((function(){return{SEND_ANYWAY:e.getString("Send anyway",null,"Action"),STILL_UPLOADING:e.getString("Wait for attachment to finish uploading or cancel upload.",null,"Error"),invalidEmails:function(t){return e.getString("The following addresses are not valid: {{emails}}",{emails:t},"Error")},EMAIL_ADDRESS_INVALID:e.getString("Some email addresses are invalid",null,"Error"),MAX_BODY_LENGTH:e.getString("The maximum length of the message body is 16,000,000 characters.",null,"Error"),NO_RECIPIENT:e.getString("Please enter at least one recipient.",null,"Error"),MAX_SUBJECT_LENGTH:e.getString("The maximum length of the subject is {{size}}.",{size:s.Bb},"Error"),NO_SUBJECT_TITLE:e.getString("No subject",null,"Title"),NO_SUBJECT_MESSAGE:e.getString("No subject, send anyway?",null,"Info"),ERROR_ADDRESSES_INFO_PRIVATE:e.getString("You can generate your keys here",null,"Error"),ERROR_ADDRESSES:e.getString("No address with keys available to compose a message.",null,"Error"),KEYS:e.getString("Keys",null,"Title"),ERROR_ADDRESSES_INFO:e.getString("Contact your organization’s administrator to resolve this.",null,"Error"),ERROR_DELINQUENT:e.getString("Your account currently has an overdue invoice. Please pay all unpaid invoices.",null,"Info")}})),m=function(e){e.ToList.concat(e.CCList,e.BCCList).forEach((function(e){e.Address=e.Address.trim()}))};function g(){return(g=c()(o.a.mark((function e(n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.MIMEType!==di&&n.setDecryptedBody(t.fixImages(n.getDecryptedBody())),!(n.uploading>0)){e.next=3;break}throw new Error(v.STILL_UPLOADING);case 3:return m(n),e.next=6,S(n);case 6:if(!(r=Object(tr.e)(n).reduce((function(e,t){var n=t.Address,r=void 0===n?"":n;return e.all.push(r),!s.Xb.test(r)&&e.invalid.push(r),e.total++,e}),{all:[],invalid:[],total:0})).invalid.length){e.next=9;break}throw new Error(v.invalidEmails(r.invalid.join(",")));case 9:if(r.total){e.next=11;break}throw new Error(v.NO_RECIPIENT);case 11:if(!(n.Subject&&n.Subject.length>s.Bb)){e.next=13;break}throw new Error(v.MAX_SUBJECT_LENGTH);case 13:if(!(n.getDecryptedBody().length>16e6)){e.next=15;break}throw new Error(v.MAX_BODY_LENGTH);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.Subject){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",new Promise((function(e,t){n.activate({params:{title:v.NO_SUBJECT_TITLE,message:v.NO_SUBJECT_MESSAGE,confirm:function(){n.deactivate().then(e)},cancel:function(){n.deactivate().then(t)}}})})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(t,n){r.activate({params:{recipients:e,confirm:function(){r.deactivate(),t()},cancel:function(){r.deactivate(),n()}}})}))}function y(){return(y=c()(o.a.mark((function e(t){var n,r,a,i,c,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:[],e.next=3,d.get(n,t);case 3:if(r=e.sent,i=(a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.filter((function(n){var a=r[n],o=a.scheme,i=a.encrypt;return t===i&&e.includes(o)}))})(pi,!1),c=a(pi,!0),!t.ExpiresIn||!c.length&&!i.length){e.next=9;break}return e.abrupt("return",b({pgp:c,clear:i}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(){return i.user.Private?"".concat(v.ERROR_ADDRESSES_INFO_PRIVATE,' <a href="/keys">').concat(v.KEYS,"</a>"):v.ERROR_ADDRESSES_INFO};function S(e){return D.apply(this,arguments)}function D(){return(D=c()(o.a.mark((function e(t){var n,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(tr.t)(t),e.next=3,Promise.all(n.map(a.isInvalid));case 3:if(r=e.sent,!(i=r.reduce((function(e,t,r){return t&&e.push(n[r]),e}),[])).length){e.next=7;break}throw new Error(v.invalidEmails(i.join(", ")));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{checkSubject:function(e){return h.apply(this,arguments)},validate:function(e){return g.apply(this,arguments)},canWrite:function(){return p.isLimitReached()?p.showModal():i.user.Delinquent>=s.oc.DELINQUENT?u.error(v.ERROR_DELINQUENT):!l.allDirty()||u.error("".concat(v.ERROR_ADDRESSES,"<br>").concat(E()))},checkExpiration:function(e){return y.apply(this,arguments)},checkKeys:S}}var vi=fi;function mi(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length<=3};return e({controllerAs:"ctrl",templateUrl:n("ondU"),controller:["params",function(e){this.recipients=e.recipients,this.toggles={pgp:{toggle:t(this.recipients.pgp)},clear:{toggle:t(this.recipients.clear)}},this.confirm=e.confirm,this.cancel=e.cancel}]})}mi.$inject=["pmModal"];var gi=mi;function hi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bi(e){return e({controllerAs:"ctrl",templateUrl:n("CCtG"),controller:["params","contactGroupModel","composerContactGroupSelection",function(e,t,n){var r=this,a=e.model.ID,o=n(e.message.ID);this.memberNumber=t.getNumberString(a),this.model=e.model,this.message=e.message;var i=o.getDraftConfigGroup(e.type,a);this.group=e.group.map((function(e){var t=o.getEmail(a,e)||i[e.Email||e.Address];return t||o.isEmpty(a)?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hi(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hi(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{},e,{isSelected:!0}):(e.isSelected=!1,e)})),this.getColor=function(){return{color:r.model.Color}},this.submit=function(){var t=r.group.filter((function(e){return e.isSelected}));o.save(r.model,t),e.close()}}]})}bi.$inject=["pmModal"];var yi=bi;function Ei(e){var t=Object.create(null),n=e().on,r=function(){return{userSelection:Object.create(null),userSelectionEmails:Object.create(null),mapDraft:Object.create(null),mapDraftEmails:Object.create(null),draftConfig:Object.create(null),exist:!1}};return n("AppModel",(function(e,n){var r=n.type,a=n.data;"loggedIn"===r&&!(void 0===a?{}:a).value&&(t=Object.create(null))})),function(e){!t[e]&&(t[e]=r());var n=t[e],a=function(e){return n.userSelection[e]};return{save:function(e){var t=e.ID,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n.userSelection[t]=r,n.userSelectionEmails[t]=r.reduce((function(e,t){return e[t.Email||t.Address]=t,e}),Object.create(null))},all:function(){return n},get:a,getEmail:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.Email,a=t.Address;return(n.userSelectionEmails[e]||{})[r||a]},isEmpty:function(e){return!(n.userSelection[e]||[]).length},clear:function(){return delete t[e]},remove:function(e){a(e)&&(delete n.userSelection[e],delete n.mapEmail[e],n.exist=!!Object.keys(n.userSelection).length)},storeDraftConfig:function(e,t){n.draftConfig[e]=!0,n.mapDraft[e]=t,n.mapDraftEmails[e]=Object.keys(t||{}).reduce((function(e,n){return e[n]=t[n].reduce((function(e,t){return e[t.Email||t.Address]=t,e}),Object.create(null)),e}),Object.create(null))},getDraftConfig:function(e){return n.mapDraft[e]},getDraftConfigGroup:function(e,t){return(n.mapDraftEmails[e]||{})[t]||{}},removeDraftConfig:function(e){n.draftConfig[e]=!1,delete n.mapDraft[e]}}}}Ei.$inject=["dispatchers"];var Si=Ei,Di=angular.module("proton.composer",["proton.labels"]).factory("composerContactGroupSelection",Si).factory("editComposerContactGroupModal",yi).controller("ComposeMessageController",ar).directive("actionCompose",ir).directive("btnSendMessage",sr).directive("composer",lr).directive("composerAskEmbedded",pr).directive("composerAttachments",vr).directive("composerAttachmentsSize",br).directive("composerAttachmentsItem",gr).directive("composerContainer",Er).directive("composerDropzone",Or).directive("composerEncrypt",xr).directive("composerExpiration",Nr).directive("composerHeader",$r).directive("composerInputMeta",Fr).directive("composerInputRecipient",Br).directive("composerMessage",Kr).directive("composerSelectFrom",Vr).directive("composerSubject",Wr).directive("composerTime",Jr).directive("responsiveComposer",Zr).factory("composerFromModel",aa).factory("composerLoader",da).factory("composerRender",pa).factory("composerRequestModel",fa).factory("outsidersMap",va).factory("autoPinPrimaryKeys",Io).factory("postMessage",ii).factory("encryptMessage",Mo).factory("encryptPackages",Ro).factory("generateTopPackages",Bo).factory("attachSubPackages",Go).factory("mimeMessageBuilder",wo).factory("extractDataURI",Ho).factory("attachPublicKey",Wo).factory("messageRequest",Jo).factory("onCurrentMessage",Zo).factory("sendMessage",li).factory("sendPreferences",bo).factory("expirationModal",gi).factory("validateMessage",vi).name,ki=n("RBan"),Ai=n.n(ki);function Ii(e,t,r,a,o,i,c,u,l,d,p,f,v,m,g){return{restrict:"E",replace:!0,scope:{conversation:"="},templateUrl:n("x8od"),link:function(n){var h,b,y=[],E=g(["message.open","elements","composer.load","messageActions"]),S=E.on,D=E.unsubscribe,A=E.dispatcher,I=(h=document.getElementById("pm_thread"),b=function(e,t){return"UP"===t?e.previousElementSibling?e.previousElementSibling.classList.contains("open")?e.previousElementSibling.offsetHeight+42:42:0:e.nextElementSibling&&e.nextElementSibling.classList.contains("open")?e.nextElementSibling.offsetHeight+42:42},function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"UP",r=h.querySelector(".message.marked");if(r){var a=b(r,n);if(0===e)return h.scrollTop=0;"UP"===n&&(h.scrollTop-=a),"DOWN"===n&&(h.scrollTop=r.offsetTop+a-h.offsetHeight/2)}}),C=angular.noop;n.messages=[],n.mailbox=d.currentMailbox(),n.labels=f.get(),n.showTrashed=!1,n.showNonTrashed=!1,o.set("numberElementSelected",1),o.set("showWelcome",!1),n.inTrash=r.includes("secured.trash.**"),n.inSpam=r.includes("secured.spam.**"),n.getElements=function(){return[n.conversation]};var w=function(e){return function(){var t=e||n.markedMessage;if(t)return t.isDraft()?A["composer.load"]("",t):void A["message.open"]("toggle",{action:"openMarked",message:t})}};S("refreshConversation",(function(e,t){t.data.indexOf(n.conversation.ID)>-1&&P()})),S("message.expiration",(function(){n.$applyAsync((function(){return P()}))})),S("message.open",(function(e,t){var r=t.type,a=t.data;if("toggle"===r&&(C(),C=c(a.message),p.unbind(["down","up"]),n.markedMessage=void 0),"render"===r)return u.to(a)})),S("unmarkMessages",(function(){n.markedMessage=void 0,C()})),S("hotkeys",(function(e,t){var r=t.type,a=t.data.to;if("move"===r){C();var c=s.rb[a];if(o.get("numberElementChecked"))return;if(n.markedMessage)return A.messageActions("move",{ids:[n.markedMessage.ID],labelID:c});i.move([n.conversation.ID],c)}}));var O=function(e){return function(){var t=z()(n.messages,{expand:!0}),r="DOWN"===e?t+1:t-1,a=n.messages[r];"DOWN"===e&&r===n.messages.length||("UP"!==e||t)&&n.$applyAsync((function(){n.messages[t].expand=!1,I(r,n.messages.length,e),C=c(a),w(a)()}))}};function M(){var e=r.$current.name.replace(".element","");r.go(e,{id:null})}function P(){var t=l.getConversationCached(a.id),o=l.queryMessagesCached(a.id),i=d.currentLocation();return y=o,n.trashed=y.some((function(e){var t=e.LabelIDs,n=void 0===t?[]:t;return Me()(n,s.rb.trash)})),n.nonTrashed=y.some((function(e){var t=e.LabelIDs,n=void 0===t?[]:t;return!Me()(n,s.rb.trash)})),t&&(le()(t.Labels,{ID:i})||r.includes("secured.search.**"))?(Ge()(n.conversation,t),void(Array.isArray(o)&&o.length>0?function(){for(var t=[],r=[],a=l.orderMessage(e("filterMessages")(o,n.showTrashed,n.showNonTrashed),!1),i=function(e){n.messages.some((function(t){return t.ID===a[e].ID}))||t.push({index:e,message:a[e]})},c=0;c<a.length;c++)i(c);for(c=0;c<t.length;c++){var s=t[c];n.messages.splice(s.index,0,s.message)}for(var u=function(e){a.some((function(t){return t.ID===n.messages[e].ID}))||r.push({index:e})},d=0;d<n.messages.length;d++)u(d);for(var p=r.length-1;p>=0;p--)n.messages.splice(r[p].index,1);n.messages.length||M()}():M())):M()}S("newElement",O("UP")),S("oldElement",O("DOWN")),S("markPrevious",(function(){if(C(),n.markedMessage){var e=n.messages.indexOf(n.markedMessage);if(e>0){var t=e-1;n.$applyAsync((function(){n.markedMessage=n.messages[t],I(t,n.messages.length,"UP"),C=c(n.markedMessage)}))}}})),S("markNext",(function(){if(C(),n.markedMessage){var e=n.messages.indexOf(n.markedMessage);if(e<n.messages.length-1){var t=e+1;n.$applyAsync((function(){n.markedMessage=n.messages[t],I(t,n.messages.length,"DOWN"),C=c(n.markedMessage)}))}}})),S("toggleStar",(function(){var e={model:n.conversation,type:"conversation"};n.markedMessage&&(e.model=n.markedMessage,e.type="message"),A.elements("toggleStar",e)})),p.unbind(["down","up"]),S("left",(function(){return p.bind(["down","up"])})),S("openMarked",w()),S("right",(function(){C(),!n.markedMessage&&n.$applyAsync((function(){n.markedMessage=Ai()(n.messages),C=c(n.markedMessage),u.toID(n.markedMessage.ID,n.messages),p.bind(["down","up"])}))})),n.toggleOption=function(e){n[e]=!n[e],P()},n.showNotifier=function(e){var t=J()(y,(function(t){return Me()(t.LabelIDs,s.rb[e])}));return t.length<y.length&&t.length>0},n.getMessages=function(){return n.messages},n.read=function(){return i.read([n.conversation.ID])},n.unread=function(){i.unread([n.conversation.ID]),M()},n.delete=function(){return i.remove([n.conversation.ID])},n.saveLabels=function(e,t){i.label([n.conversation.ID],e,t)},function(){y=l.queryMessagesCached(a.id),n.trashed=_r()(y,(function(e){var t=e.LabelIDs;return Me()(t,s.rb.trash)})),n.nonTrashed=_r()(y,(function(e){var t=e.LabelIDs;return!Me()(t,s.rb.trash)}));var r=e("filterMessages")(y,n.showTrashed,n.showNonTrashed);if(r.length>0){var o=k()(l.orderMessage(r,!1),(function(e){return delete e.expand,delete e.openMe,e}));n.messages=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=m.find(e);return e.length&&(t.openMe=!0),e}(o),C=c(Ai()(n.messages)),v.get("ViewLayout")===s.dc&&(n.markedMessage=t.expandMessage),A.elements("mark",{id:a.id}),A.elements("opened",{id:a.id})}else M()}(),n.$on("$destroy",(function(){D(),C(),p.unbind(["down","up"]),p.bind(["down","up"]),A.elements("close",{element:n.conversation})}))}}}Ii.$inject=["$filter","$rootScope","$state","$stateParams","AppModel","actionConversation","conversationListeners","messageScroll","cache","tools","hotkeys","labelsModel","mailSettingsModel","findExpandableMessage","dispatchers"];var Ci=Ii,wi=function(e,t,r){return{replace:!0,templateUrl:n("P7f5"),link:function(n){var a=r(),o=a.on,i=a.unsubscribe,c=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return n.showWelcome=e},s=function(){return n.user=angular.copy(t.user)};o("AppModel",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"showWelcome"===r&&n.$applyAsync((function(){c(o.value)}))})),o("updateUser",(function(){n.$applyAsync((function(){s()}))})),c(e.get("showWelcome")),s(),n.$on("$destroy",(function(){i()}))}}};wi.$inject=["AppModel","authentication","dispatchers"];var Oi=wi,Mi=function(e,t,n,r){return{restrict:"E",replace:!0,template:'<div class="conversationView-container"><conversation ng-if="conversation" data-conversation="conversation"></conversation></div>',link:function(a){var o=t.id,i=r.currentLocation();i||e.go("secured.inbox"),n.getConversation(o).then((function(t){var n;return le()(t.Labels,{ID:i})||e.includes("secured.search.**")?a.conversation=t:(n=e.$current.name.replace(".element",""),void e.go(n,{id:null}))}))}}};Mi.$inject=["$state","$stateParams","cache","tools"];var Pi=Mi,xi=function(){return{replace:!0,templateUrl:n("LcNq")}},Ti=function(){return{replace:!0,templateUrl:n("cd3K")}},Li=function(){return{replace:!0,templateUrl:n("MLA5")}};var ji=function(){return{scope:{},replace:!0,restrict:"E",templateUrl:n("LxFK")}},Ni=n("lOx9"),$i=n.n(Ni),Ri=n("2HOu"),_i=n.n(Ri);function Ui(e,t,n,r,a,o,i,c,u,l,d){var p=a(["deleteConversation"]).dispatcher,f=[s.rb.inbox,s.rb.trash,s.rb.spam,s.rb.archive,s.rb.sent,s.rb.drafts];var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:angular.noop;return Be()(Ue()(t),Re()((function(e){return e.ID})))(e)||[]},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=e.ConversationID,a=r?e.LabelIDs:e.Labels.map((function(e){return e.ID})),o=l.currentLocation(),i=Me()(f,o)||d.contains(o,"folders"),c=m(t,(function(e){var t=e.ID;return!(!0!==e.Selected||r&&a.includes(t))})),u=m(t,(function(e){var t=e.ID;return!1===e.Selected&&(!r||a.includes(t))}));return n&&(c.push(s.rb.archive),i&&u.push(o)),{LabelIDsAdded:c,LabelIDsRemoved:u}};return{remove:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,a=r.delete(t,n);if(e.addToDispatcher(a),!l.cacheContext())return a.then((function(){return o.call()})),c.track(a);var i=t.reduce((function(t,n){var r=e.queryMessagesCached(n);return p.deleteConversation("delete",n),We()(r,(function(e){var n=e.ID;return t.push({Action:0,ID:n})})),t.push({Action:0,ID:n}),t}),[]);return e.events(i),a},unread:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=l.currentLocation(),a=r.unread(t,n);e.addToDispatcher(a),l.cacheContext()||(a.then((function(){return o.call()})),c.track(a));var i=t.reduce((function(t,r){var a=e.queryMessagesCached(r),o=(e.getConversationCached(r)||{}).Labels,i=void 0===o?[]:o;if(a.length){var c=(Be()(Ue()((function(e){var t=e.LabelIDs,r=void 0===t?[]:t;return Me()(r,n)})),ta()((function(e){return e.Time})),$i.a)(a)||{}).ID;c&&t.push({ID:c,Action:3,Message:{ID:c,Unread:1}})}return t.push({Action:3,ID:r,Conversation:{ID:r,Labels:k()(i,(function(e){return e.ID!==n&&e.ID!==s.rb.allmail||e.ContextNumUnread++,e}))}}),t}),[]);e.events(i)},read:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=l.currentLocation(),a=r.read(t);e.addToDispatcher(a),l.cacheContext()||(a.then((function(){return o.call()})),c.track(a));var i=t.reduce((function(t,r){var a=(e.getConversationCached(r)||{}).Labels,o=void 0===a?[]:a,i=e.queryMessagesCached(r);return i.length&&Be()(Ue()((function(e){var t=e.LabelIDs,r=void 0===t?[]:t;return Me()(r,n)})),_i()((function(e){var n=e.ID;t.push({ID:n,Action:3,Message:{ID:n,Unread:0}})})))(i),t.push({Action:3,ID:r,Conversation:{ID:r,Labels:k()(o,(function(e){return e.ID!==n&&e.ID!==s.rb.allmail||(e.ContextNumUnread=0),e}))}}),t}),[]);e.events(i)},unstar:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=r.unstar(t),a=[s.rb.starred];if(e.addToDispatcher(n),!l.cacheContext())return n.then((function(){return o.call()})),c.track(n);var i=Be()(Re()((function(t){return e.getConversationCached(t)})),Ue()(Boolean),Ne()((function(t,n){var r=n.ID,o=n.ContextNumUnread,i=n.Labels,c=e.queryMessagesCached(r);return We()(c,(function(e){t.push({Action:3,ID:e.ID,Message:{ID:e.ID,Unread:e.Unread,LabelIDsRemoved:a}})})),t.push({Action:3,ID:r,Conversation:{ID:r,ContextNumUnread:o,Labels:ai({Labels:i,ContextNumUnread:o},{toRemove:a})}}),t}),[]))(t);e.events(i)},star:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=r.star(t),a=[s.rb.starred];if(e.addToDispatcher(n),!l.cacheContext())return n.then((function(){return o.call()})),c.track(n);var i=Be()(Re()((function(t){return e.getConversationCached(t)})),Ue()(Boolean),Ne()((function(t,n){var r=n.ID,o=n.ContextNumUnread,i=n.Labels,c=e.queryMessagesCached(r);return We()(c,(function(e){t.push({Action:3,ID:e.ID,Message:{ID:e.ID,Unread:e.Unread,LabelIDsAdded:a}})})),t.push({Action:3,ID:r,Conversation:{ID:r,ContextNumUnread:o,Labels:ai({Labels:i,ContextNumUnread:o},{toAdd:a})}}),t}),[]))(t);e.events(i)},label:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=function(n){e.events(n),a&&r.archive(t)},i=Be()(Re()((function(t){return e.getConversationCached(t)})),Ue()(Boolean),Ne()((function(t,r){var o=r.ID,i=r.ContextNumUnread,c=r.Labels,s=e.queryMessagesCached(o);We()(s,(function(e){var r=g(e,n,a),o=r.LabelIDsAdded,i=r.LabelIDsRemoved;t.push({Action:3,ID:e.ID,Message:{ID:e.ID,Unread:e.Unread,LabelIDsAdded:o,LabelIDsRemoved:i}})}));var u=g(r,n,a),l=u.LabelIDsAdded,d=u.LabelIDsRemoved;return t.push({Action:3,ID:o,Conversation:{ID:o,ContextNumUnread:i,toAdd:l,toRemove:d,Labels:ai({Labels:c,ContextNumUnread:i},{toAdd:l,toRemove:d})}}),t}),[]))(t),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e.filter((function(e){return e.Conversation})).reduce((function(e,n){var r=n.Conversation;return r[1===t?"toAdd":"toRemove"].forEach((function(t){e[t]=e[t]||[],e[t].push(r.ID)})),e}),{});return Object.keys(n).map((function(e){return r[1===t?"label":"unlabel"](e,n[e])}))},u=Promise.all(s(i),s(i,0));return e.addToDispatcher(u),l.cacheContext()?o(i):(u.then((function(){return o(i)})),c.track(u),u)},move:function a(){var p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=l.currentLocation(),b=d.ids("folders"),y=d.ids("labels"),E=m===s.rb.trash,S=m===s.rb.spam,D=r.label(m,p),k=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=(d.read(t,"folders")||{}).Name;return(e={},v()(e,s.rb.inbox,i.getString("Inbox",null,"App folder")),v()(e,s.rb.spam,i.getString("Spam",null,"App folder")),v()(e,s.rb.drafts,i.getString("Drafts",null,"App folder")),v()(e,s.rb.allDrafts,i.getString("Drafts",null,"App folder")),v()(e,s.rb.sent,i.getString("Sent",null,"App folder")),v()(e,s.rb.allSent,i.getString("Sent",null,"App folder")),v()(e,s.rb.trash,i.getString("Trash",null,"App folder")),v()(e,s.rb.archive,i.getString("Archive",null,"App folder")),e)[t]||n}(m),A={},I=i.getPlural(p.length,"1 conversation moved to {{folder}}","{{number}} conversations moved to {{folder}}",{folder:Object(Ot.j)(k),number:p.length},"Info");g&&t()&&(A.undo=function(){a(p,h,!1)});var C=function(){u.success(I,A)},w=f.concat(b).concat(S||E?y:[]);if(e.addToDispatcher(D),!l.cacheContext())return D.then((function(){return o.call()})).then((function(){return C()})),c.track(D);var O=bt()(p,(function(t,n){var r=e.queryMessagesCached(n);We()(r,(function(e){var n=e.LabelIDs,r=void 0===n?[]:n,a=e.ID,o=e.Unread,i=Object(tr.d)(e,m),c=J()(r,(function(e){return Me()(w,e)}));t.events.push({ID:a,Action:3,Message:{ID:a,Unread:E?0:o,LabelIDsRemoved:c,LabelIDsAdded:i}})}));var a=e.getConversationCached(n);if(a){if(S){var o,i=a.Senders,c=void 0===i?[]:i;(o=t.toSpamList).push.apply(o,we()(c))}var s=a.Labels.reduce((function(e,t){return Me()(w,t.ID)?e:(t.ContextNumUnread=E?0:t.ContextNumUnread,e.push(t),e)}),[{ID:m,ContextNumUnread:E?0:a.ContextNumUnread}]);t.events.push({Action:3,ID:n,Conversation:{ID:n,Selected:!1,Labels:s}})}return t}),{events:[],toSpamList:[]}),M=O.events,P=O.toSpamList.reduce((function(e,t){var n=t.Address,r=void 0===n?"":n;return r&&!e.map[r]&&(e.list.push(r),e.map[r]=!0),e}),{list:[],map:Object.create(null)}).list;P.length&&n(P),e.events(M),C()}}}Ui.$inject=["cache","canUndo","contactSpam","conversationApi","dispatchers","eventManager","gettextCatalog","networkActivityTracker","notification","tools","labelsModel"];var Fi=Ui;function Bi(e,t,n){var r=s.rb.archive,a=s.rb.trash,i=s.rb.inbox,u=s.rb.spam,l=s.rb.starred,d=n.build("conversations");function p(){return f.apply(this,arguments)}function f(){return(f=c()(o.a.mark((function n(){var r,a,i,c,u,l=arguments;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=l.length>0&&void 0!==l[0]?l[0]:"",a=l.length>1&&void 0!==l[1]?l[1]:"",i=l.length>2&&void 0!==l[2]?l[2]:{},c=bt()(t(i.IDs,s.B),(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.concat(e({url:r,method:a,data:Ge()({},i,{IDs:n})}))}),[]),n.next=6,Promise.all(c);case 6:return u=n.sent,n.abrupt("return",u.reduce((function(e,t){return e.concat(t)}),[]));case 8:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return{query:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e({url:d(),method:"GET",params:t})},get:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.get(d(t),{params:n})},count:function(){return e.get(d("count"))},star:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.label(l,e)},unstar:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.unlabel(l,e)},read:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return p(d("read"),"PUT",{IDs:e})},unread:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return p(d("unread"),"PUT",{IDs:e,LabelID:t})},trash:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.label(a,e)},inbox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.label(i,e)},spam:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.label(u,e)},archive:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.label(r,e)},delete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return p(d("delete"),"PUT",{IDs:e,LabelID:t})},label:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return p(d("label"),"PUT",{IDs:t,LabelID:e})},unlabel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return p(d("unlabel"),"PUT",{IDs:t,LabelID:e})}}}Bi.$inject=["$http","chunk","url"];var Ki=Bi;function Gi(e){var t=e(["composer.new"]),n=t.dispatcher,r=t.on,a=t.unsubscribe,o={replyConversation:"reply",replyAllConversation:"replyall",forwardConversation:"forward"},i=function(e){return!e.failedDecryption},c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(){if(!Object(tr.h)(t)&&i(t)){var r=o[e];n["composer.new"](r,{message:t})}}};return function(e){return Object.keys(o).map((function(t){return r(t,c(t,e))})),function(){a()}}}Gi.$inject=["dispatchers"];var Vi=Gi;function qi(e){var t=document.createElement("div"),n=function(e){return t.innerText=e||"",t.innerHTML},r=function(e,t){return'<i class="'.concat(e,'" translate>').concat(t,"</i>")},a=function(e,t){var r=e.className,a=void 0===r?"":r,o=e.tooltip,i=void 0===o?"":o,c=e.color,s=void 0===c?"":c;return a&&i?t?t(a,i,s):function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=n(t).replace(/"|'/g,"");return r?'<i class="fa '.concat(e,'" pt-tooltip="').concat(a,'" style="color: ').concat(r,'"></i>'):'<i class="fa '.concat(e,'" pt-tooltip="').concat(a,'"></i>')}(a,i,s):""},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/^{{/g,"{​{")};return function(t){var n=t.MAP_LABELS,i=t.MAP_TYPES;return{getTemplateLabels:function(t){return Object.keys(n).reduce((function(r,i){if("folder"===i){var c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=le()(t,(function(t){return e.contains(t,"folders")}));return e.read(n,"folders")||{}}(t),u=c.Color,l=c.Name;return r+a(Ge()({},n[i],{tooltip:o(l),color:u}))}return function(e,t){return Me()(t,s.rb[e])}(i,t)?r+a(n[i]):r}),"")},getTemplateType:function(e){return 2===e||3===e?a(i.sent,r):1===e?a(i.drafts,r):""}}}}qi.$inject=["labelsModel"];var Hi=qi;function zi(e,t){return{responseError:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(/\/conversations\//.test((n.config||{}).url)){var r=t.get("cache"),a=t.get("cacheCounters"),o=t.get("eventManager");r.reset(),a.reset(),o.call()}return e.reject(n)}}}zi.$inject=["$q","$injector"];var Yi=zi,Wi=n("LIN1"),Xi=n.n(Wi),Ji=n("YhUW"),Qi=n.n(Ji),Zi=n("KtqP"),ec=n.n(Zi),tc=n("rvP+"),nc=n.n(tc);function rc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ac(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rc(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rc(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}uc.$inject=["$interval","$stateParams","conversationApi","dispatchers","firstLoadState","messageModel","messageApi","cacheCounters","networkActivityTracker","tools","labelsModel","cachePages","recipientsFormator"];var oc=s.kc.DELETE,ic=s.kc.CREATE,cc=s.kc.UPDATE_DRAFT,sc=s.kc.UPDATE_FLAGS;function uc(e,t,n,r,a,i,u,l,d,p,f,v,m){var g={},h=[],b=[],y=[],E={},S=[],D=s.rb.inbox,A=s.rb.allDrafts,I=s.rb.drafts,C=s.rb.allSent,w=s.rb.sent,O=s.rb.trash,M=s.rb.spam,P=s.rb.allmail,x=s.rb.archive,T=s.rb.starred,L=r(["elements","message.expiration","updatePageName","refreshConversation","message.refresh","foldersElement","foldersMessage","labelsElement"]),j=L.dispatcher,N=L.on,$=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return j.elements(e,t)};function R(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){return V(e)}))}function _(e){var t=e.Page,n=void 0===t?0:t,r=e.Limit,a=void 0===r?s.A:r;return Lr()(n,n+a/s.N,1)}function U(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){return B(e)}))}function F(e,t,n){E[e]=E[e]||{},E[e][t]=n}function B(e,t){var n=le()(h,{ID:e.ID}),r=e.ConversationID,a=p.getTypeList();return n?h=k()(h,(function(n){if(t&&n.ID===e.ID)return e;if(n.ID===e.ID){var r=ac({},n,{},e);return r.Type=e.Type,r}return n})):h.push(e),H(r),j.labelsElement("",e),j.foldersMessage("",e),j.foldersElement("",e),(le()(b,{ID:r})||{}).loaded||"conversation"!==a||S.push(r),Promise.resolve()}g.addToDispatcher=function(e){return y.push(e)},g.clearDispatcher=function(){return y.length=0},g.getDispatcher=function(){return Promise.all(y)},e((function(){var e=~~(Date.now()/1e3),t=bt()(h,(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.ExpirationTime,a=!(0!==r&&r<e),o=a?"list":"removeList";return t[o].push(n),t}),{list:[],removeList:[]}),n=t.list,r=t.removeList;h=n,r.length&&j["message.expiration"]()}),1e3,0,!1);var K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=bt()(t.concat(e),(function(e,t){var n=Object(Ot.e)(t.Address);return e.map[n]||(e.list.push(t),e.map[n]=!0),e}),{list:[],map:{}}),r=n.list;return r};function G(e,t){var n=t.Labels,r=void 0===n?[]:n,a=p.currentLocation(),o=r.length?le()(r,{ID:a})||{}:t,i=o.ContextNumUnread,c=void 0===i?e.ContextNumUnread:i,s=o.ContextNumAttachments,u=void 0===s?e.ContextNumAttachments:s,l=o.ContextSize,d=void 0===l?e.ContextSize:l,f=o.ContextTime;return{ContextNumUnread:c,ContextNumAttachments:u,ContextSize:d,ContextTime:void 0===f?e.ContextTime:f}}function V(e){var t=le()(b,{ID:e.ID});if(t)return Ge()(t,e,{Labels:re(t,e),Senders:K(t.Senders,e.Senders)},G(t,e)),delete t.LabelIDsAdded,delete t.LabelIDsRemoved,H(t.ID),j.labelsElement("",t),void j.foldersElement("",t);Ge()(e,G(e,e)),b.push(e),H(e.ID),j.labelsElement("",e),j.foldersElement("",e)}function q(e,t,n){var r=e.LabelIDs,a=void 0===r?[]:r,o=e.Labels,i=void 0===o?[]:o,c=e.Unread,s=function(e){return+!!e},u=[D,A,I,C,w,O,M,P,x,T].concat(f.ids());return bt()(u,(function(e,r){if("message"===n){var o=Me()(a,r);e[r]=s(t?o&&1===c:o)}if("conversation"===n){var u=le()(i,{ID:r});e[r]=s(t?u&&u.ContextNumUnread>0:u)}return e}),{})}function H(e){if(e){var t=(g.getConversationCached(e)||{}).Labels,n=void 0===t?[]:t,r=g.queryMessagesCached(e,!1);r.length&&n.forEach((function(t){var n=t.ID,a=(Be()(Ue()((function(e){var t=e.LabelIDs,r=void 0===t?[]:t;return Me()(r,n)})),ec.a)(r)||{}).Time;a&&F(e,n,a)}))}}function Y(e,t,n){var r=q(e,!0,n),a=q(t,!0,n),o=q(t,!1,n),i=q(e,!1,n),c=[D,A,I,C,w,O,M,P,x,T].concat(f.ids());We()(c,(function(e){var t,c,s=a[e]-r[e],u=o[e]-i[e];"message"===n?(t=l.unreadMessage(e),c=l.totalMessage(e),l.updateMessage(e,c+u,t+s)):"conversation"===n&&(t=l.unreadConversation(e),c=l.totalConversation(e),l.updateConversation(e,c+u,t+s))}))}var W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.LabelID;return t};function X(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=W(e),a=p.cacheContext();e.Limit=e.Limit||s.A;var o=g.getDispatcher().then((function(){return n.query(e)})).then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.data,i=void 0===o?{}:o;if(Q(i),We()(i.Conversations,(function(e){e.loaded=!0,F(e.ID,r,e.ContextTime)})),a){if(!t){var c=i.Limit,u=0===c?0:i.Unread,d=_(e);d.forEach((function(e){return!v.inside(e)&&v.add(e)})),l.updateConversation(r,c,u)}return R(i.Conversations),g.clearDispatcher(),g.orderConversation(i.Conversations.slice(0,s.N),r)}return g.clearDispatcher(),i.Conversations.slice(0,s.N)})).catch((function(e){var t=e.data,n=void 0===t?{}:t;if(g.clearDispatcher(),$("error",{code:n.Code,error:n.Error}),n.Code===Da.a.MESSAGE_SEARCH_QUERY_SYNTAX)return[];throw e}));return d.track(o),o}function Q(e){var t=e.Limit,n=e.Total;l.currentState(t),$("setLimit",{Limit:t,Total:n})}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=W(e),r=p.cacheContext();e.Limit=e.Limit||s.Eb;var a=g.getDispatcher().then((function(){return u.query(e)})).then((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=a.data,i=void 0===o?{}:o,c=i.Messages,u=void 0===c?[]:c,d=i.Limit,p=void 0===d?0:d;if(Q(i),We()(u,(function(e){e.loaded=!0,e.Senders=[e.Sender],e.Recipients=m.toList(e)})),U(u),r){var f=_(e);return t||l.updateMessage(n,p),f.forEach((function(e){return!v.inside(e)&&v.add(e)})),g.clearDispatcher(),g.orderMessage(u.slice(0,s.N))}return g.clearDispatcher(),u.slice(0,s.N)})).catch((function(e){var t=e.data,n=void 0===t?{}:t;if(g.clearDispatcher(),$("error",{code:n.Code,error:n.Error}),n.Code===Da.a.MESSAGE_SEARCH_QUERY_SYNTAX)return[];throw e}));return d.track(a),a}function ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.currentLocation(),r=n.get(e).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.data,r=void 0===n?{}:n,a=r.Conversation,o=void 0===a?{}:a,i=r.Messages,c=void 0===i?[]:i,s=Be()(Ue()((function(e){var n=e.LabelIDs,r=void 0===n?[]:n;return Me()(r,t)})),Qi()("Time"))(c)||{};return c.forEach((function(e){return e.loaded=!0})),o.loaded=!0,o.Time=s.Time,R([o]),U(c),angular.copy(o)}));return d.track(r),r}function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return bt()(e,(function(e,t){return e.unshift(t),e}),[])}function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.LabelIDs||e.LabelIDs||[];return Array.isArray(t.LabelIDsRemoved)&&(n=xa()(n,t.LabelIDsRemoved)),Array.isArray(t.LabelIDsAdded)&&(n=ga()(n.concat(t.LabelIDsAdded))),n}function re(e,t){var n=t.Labels,r=void 0===n?[]:n,a=t.LabelIDsRemoved,o=void 0===a?[]:a,i=t.LabelIDsAdded,c=void 0===i?[]:i,s=t.ContextNumUnread,u=void 0===s?0:s;if(c.length||o.length){var l=k()(c,(function(e){return{ID:e,ContextNumUnread:u}})),d=J()(e.Labels,(function(e){var t=e.ID;return!Me()(o,t)}));return ri()(d.concat(l),(function(e){return e.ID}))}return r.length?k()(r,(function(t){var n=le()(e.Labels||[],{ID:t.ID});return n?ac({},n,{},t):t})):e.Labels||[]}function ae(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Be()(Ue()((function(e){return e.Message})),Re()((function(e){return angular.copy(e.Message)})),nc()((function(e){var t=le()(h,{ID:e.ID});t&&(e.LabelIDs=ne(t,e),Y(t,e,"message"))})))(e),Be()(Ue()((function(e){return e.Conversation})),Re()((function(e){return angular.copy(e.Conversation)})),nc()((function(e){var t=le()(b,{ID:e.ID});t&&(e.Labels=re(t,e),Y(t,e,"conversation"))})))(e),l.status()}g.empty=function(e){h=J()(h,(function(t){var n=t.LabelIDs;return-1===(void 0===n?[]:n).indexOf(e)})),l.updateMessage(e,0),We()(b,(function(t){t.Labels=J()(t.Labels,(function(t){return t.ID!==e}))})),l.updateConversation(e,0),$("refresh")},g.orderConversation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return te(e.sort((function(e,n){return g.getTime(e.ID,t)<g.getTime(n.ID,t)?-1:g.getTime(e.ID,t)>g.getTime(n.ID,t)?1:e.Order<n.Order?-1:e.Order>n.Order?1:0})))},g.orderMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.sort((function(e,t){return e.Time<t.Time?-1:e.Time>t.Time?1:e.Order<t.Order?-1:e.Order>t.Order?1:0}));return t?te(n):n},g.orderElements=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"message",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=e.sort((function(e,n){var a="message"===t?e.Time:g.getTime(e.ID,r),o="message"===t?n.Time:g.getTime(n.ID,r);return a<o?-1:a>o?1:e.Order<n.Order?-1:e.Order>n.Order?1:0}));return n?te(a):a},g.getTime=function(e,t){return E[e]&&angular.isNumber(E[e][t])?E[e][t]:(g.getConversationCached(e)||{}).ContextTime||""},g.queryMessages=function(e){var n=W(e),r=p.cacheContext(),o=e.Page||0;if(r&&!a.get()&&v.consecutive(o)){var c,u,d=o*s.N,f=d+s.N,m=p.currentMailbox(),b=Be()(Ue()((function(e){var t=e.LabelIDs;return-1!==(void 0===t?[]:t).indexOf(n)})),Re()((function(e){return i(e)})))(h);switch(b=g.orderMessage(b),m){case"label":c=l.totalMessage(t.label);break;default:c=l.totalMessage(s.rb[m])}if(angular.isDefined(c)&&(u=0===c?0:c%s.N==0?s.N:Math.ceil(c/s.N)-1===o?c%s.N:s.N,(b=b.slice(d,f)).length===u))return l.currentState(c),Promise.resolve(b)}return Z(e)},g.queryConversations=function(e){var n=W(e),r=p.cacheContext(),o=e.Page||0;if(r&&!a.get()&&v.consecutive(o)){var i,c,u=o*s.N,d=u+s.N,f=p.currentMailbox(),m=J()(b,(function(e){var t=e.Labels,r=void 0===t?[]:t,a=e.ID;return le()(r,{ID:n})&&g.getTime(a,n)}));switch(m=g.orderConversation(m,n),f){case"label":i=l.totalConversation(t.label);break;default:i=l.totalConversation(s.rb[f])}if(angular.isDefined(i)&&(c=0===i?0:i%s.N==0?s.N:Math.ceil(i/s.N)-1===o?i%s.N:s.N,(m=m.slice(u,d)).length===c))return l.currentState(i),Promise.resolve(m)}return X(e)},g.queryMessagesCached=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=t?{ConversationID:e,loaded:t}:{ConversationID:e},r=g.orderMessage(J()(h,n));return r.map(i)},g.getConversationCached=function(e){return angular.copy(le()(b,{ID:e}))},g.getMessageCached=function(e){return i(le()(h,{ID:e}))},g.getConversation=function(e){var t=le()(b,{ID:e})||{},n=g.queryMessagesCached(e,!0);return!0===t.loaded&&n.length===t.NumMessages?Promise.resolve(angular.copy(t)):ee(e)},g.getMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=le()(h,{ID:e})||{};return new Promise((function(n){t.Body?n(i(t)):n(g.queryMessage(e))}))},g.queryMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=u.get(e).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?{}:t,r=n.Message;return r.loaded=!0,U([r]),i(r)}));return d.track(t),t},g.delete=function(e){return h=h.filter((function(t){return t.ID!==e.ID})),b=b.filter((function(t){return t.ID!==e.ID})),Promise.resolve()},g.createMessage=function(e){return B(e.Message)},g.updateMessage=B,g.createConversation=function(e){var t=e.Conversation;return t.loaded=!0,V(t),Promise.resolve()},g.updateDraftConversation=function(e){return V(e.Conversation),Promise.resolve()},g.updateFlagMessage=function(e,t){var n=le()(h,{ID:e.ID});if(!n)return g.createMessage(e);var r=ac({},n,{},e.Message);return r.LabelIDs=ne(n,e.Message),delete r.LabelIDsRemoved,delete r.LabelIDsAdded,B(r,t)},g.updateDraftMessage=function(){var e=c()(o.a.mark((function e(t,n){var r,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(tr.h)(t.Message)){e.next=2;break}return e.abrupt("return",g.updateFlagMessage(t,n));case 2:return e.next=4,u.get(t.ID);case 4:return r=e.sent,a=r.data,(c=(void 0===a?{}:a).Message).loaded=!0,U([c]),e.abrupt("return",i(c));case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),g.updateFlagConversation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=le()(b,{ID:e.ID})||{},n=t.loaded;return n&&V(e.Conversation),Promise.resolve()};var oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map((function(e){var t=e.event,n=e.type;return g["create".concat(n)](t)})))},ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e){var t=e.event,n=e.type,r=e.isSend,a=e.item,o="update".concat(a).concat(n);return g[o](t,r)}));return Promise.all(t)},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map(g.delete))},se=function(){var e=c()(o.a.mark((function e(){var t,n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:[],n=t.map((function(e){return e.ID})),r=Be()(Ue()((function(e){return!Me()(n,e)})),Xi.a,Re()(ee))(S),S.length=0,e.next=6,Promise.all(r);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return g.events=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;console.log("[events] from the ".concat(t?"back":"front","-end"),e),!t&&ae(e);var r=bt()(e,(function(e,r){var a=r.Message||r.Conversation,o=r.Message?"Message":"Conversation";return a&&(r[o].ID=r.ID,t&&r.Action===cc&&(r[o].loaded=!1),t&&"Conversation"===o&&r.Action===sc&&(delete r.Conversation.LabelIDsAdded,delete r.Conversation.LabelIDsRemoved),e["".concat(o,"IDs")].push(r.ID),r.Action===ic&&e.Flow[o].create.push({event:r,type:o}),r.Action===cc&&e.Flow[o].update.push({event:r,type:o,isSend:n,item:"Draft"}),r.Action===sc&&e.Flow[o].update.push({event:r,type:o,isSend:n,item:"Flag"})),r.Action===oc&&e.Flow.delete.push(r),e}),{Flow:{Message:{create:[],update:[]},Conversation:{create:[],update:[]},delete:[]},MessageIDs:[],ConversationIDs:[]}),a=r.Flow,o=r.MessageIDs,i=r.ConversationIDs;return oe(a.Message.create).then((function(){return ie(a.Message.update)})).then((function(){return se(a.delete)})).then((function(){return oe(a.Conversation.create)})).then((function(){return ie(a.Conversation.update)})).then((function(){return ce(a.delete)})).then((function(){return g.callRefresh(o,i)}))},g.callRefresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];$("refresh"),j.updatePageName(),j.refreshConversation("refresh",t),j["message.refresh"]("refresh",e),$("refresh.time")},g.reset=function(){b.length=0,h.length=0},g.more=function(e,t,n){var r,a=p.getTypeList(),o="conversation"===a?b:h,i=p.currentLocation(),c=o.filter((function(e){var t=e.LabelIDs;return(void 0===t?[]:t).indexOf(i)>-1})),s=g.orderElements(c,a,!0,i);if(le()(s,{ID:e})){var u=z()(s,{ID:e});if("previous"===n&&s[u+1])return Promise.resolve(s[u+1]);if("next"===n&&s[u-1])return Promise.resolve(s[u-1])}return r={LabelID:i},"next"===n?(r.BeginID=e,r.Begin=t,r.Desc=0):"previous"===n&&(r.EndID=e,r.End=t),("conversation"===a?X(r,!0):Z(r,!0)).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){var t="next"===n?e.length-1:0;return e[t]}throw new Error("No elements found")}))},N("$stateChangeStart",(function(e,t,n,r){var a=p.filteredState(r.name),o=p.filteredState(t.name);"label"!==o&&o===a||g.reset()})),N("logout",(function(){g.reset(),l.reset()})),g}var lc=uc;Sc.$inject=["messageApi","conversationApi","$q","dispatchers","authentication","labelsModel"];var dc=s.rb.inbox,pc=s.rb.allDrafts,fc=s.rb.drafts,vc=s.rb.allSent,mc=s.rb.sent,gc=s.rb.trash,hc=s.rb.spam,bc=s.rb.allmail,yc=s.rb.archive,Ec=s.rb.starred;function Sc(e,t,n,r,a,o){var i={},c={},s=r(["app.cacheCounters"]),u=s.dispatcher,l=s.on,d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u["app.cacheCounters"](e,t)},p=function(e){angular.isUndefined(c[e])&&(c[e]={message:{total:0,unread:0},conversation:{total:0,unread:0}})};return l("labelsModel",(function(e,t){var n=t.type,r=t.data;if("cache.update"===n){var a=r.create,o=void 0===a?[]:a,i=r.remove,s=void 0===i?{}:i;o.forEach((function(e){var t=e.ID;return p(t)})),Object.keys(s).forEach((function(e){delete c[e]}))}})),i.query=function(){var r=[dc,pc,fc,vc,mc,gc,hc,bc,yc,Ec].concat(o.ids());return n.all({message:e.count(),conversation:t.count()}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,n=void 0===t?{}:t,a=e.conversation,o=void 0===a?{}:a;r.forEach(p),Be()(Ue()((function(e){var t=e.LabelID;return c[t]})),nc()((function(e){var t=e.LabelID,n=e.Total,r=void 0===n?0:n,a=e.Unread,o=void 0===a?0:a;c[t].message.total=r,c[t].message.unread=o})))(n.data.Counts),Be()(Ue()((function(e){var t=e.LabelID;return c[t]})),nc()((function(e){var t=e.LabelID,n=e.Total,r=void 0===n?0:n,a=e.Unread,o=void 0===a?0:a;c[t].conversation.total=r,c[t].conversation.unread=o})))(o.data.Counts),d("load")}))},i.add=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return p(e)},i.status=function(){return d("update.counters",{counters:c})},i.updateMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;p(e),angular.isDefined(t)&&(c[e].message.total=t),angular.isDefined(n)&&(c[e].message.unread=n)},i.updateConversation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;p(e),angular.isDefined(t)&&(c[e].conversation.total=t),angular.isDefined(n)&&(c[e].conversation.unread=n)},i.totalMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c[e]&&c[e].message&&c[e].message.total},i.totalConversation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c[e]&&c[e].conversation&&c[e].conversation.total},i.unreadMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c[e]&&c[e].message&&c[e].message.unread},i.unreadConversation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c[e]&&c[e].conversation&&c[e].conversation.unread},i.reset=function(){c={}},i.currentState=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;c.CURRENT_STATE_VALUE=e,d("refresh.currentState",{value:e})},i.getCurrentState=function(){return c.CURRENT_STATE_VALUE||0},i.getCounter=function(e){return c[e]},i}var Dc=Sc;var kc=function(){var e={};return{follow:function(){e.wrapper&&e.wrapper.offsetHeight||(e.wrapper=document.body.querySelector(".conversation-wrapper")),ke()((function(){var t=e.wrapper.querySelector(".conversation.marked");t.querySelector(".customCheckbox-input").focus(),e.wrapper.scrollTop=t.offsetTop-e.wrapper.offsetHeight/2}))},clear:function(){return e.wrapper=null}}};var Ac=function(){function e(e,t){var n=document.getElementById("conversationHeader"),r=document.getElementById("pm_thread");if(0===e)return $(r).animate({scrollTop:0},200);var a=t||document.getElementById("message".concat(e)),o=document.getElementById("message".concat(e-1)),i=n?n.getBoundingClientRect().top+n.offsetHeight:0,c=r?r.scrollTop:0,s=~~r.style.paddingTop.replace("px",""),u=document.getElementsByClassName("summary")[0].getBoundingClientRect().height,l=a?a.getBoundingClientRect().top+c-i-s:0;l-=1===e||o.classList.contains("open")?u/2+10:1.5*u+20,$(r).animate({scrollTop:l},200)}return{to:function(t){e(t.index,t.node)},toID:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e(z()(n,{ID:t}))}}},Ic=angular.module("proton.conversation",["proton.message"]).config(["$httpProvider",function(e){e.interceptors.push("conversationsInterceptor")}]).directive("conversation",Ci).directive("conversationPlaceholder",Oi).directive("conversationView",Pi).directive("listColumns",xi).directive("listMobile",Ti).directive("listRows",Li).directive("stickyMessages",ji).factory("cache",lc).factory("cacheCounters",Dc).factory("actionConversation",Fi).factory("conversationApi",Ki).factory("conversationListeners",Vi).factory("mailboxIdentifersTemplate",Hi).factory("conversationsInterceptor",Yi).factory("markedScroll",kc).factory("messageScroll",Ac).name;Pc.$inject=["dispatchers","subscriptionModel"];var Cc=s.Rb.PLAN,wc=Cc.PLUS,Oc=Cc.PROFESSIONAL,Mc=Cc.VISIONARY;function Pc(e,t){var n=bt()(["free",wc,Oc,Mc],(function(e,t){return"".concat(e," ").concat(t,"-active")}),"");return{restrict:"A",link:function(r,a){var o=function(){return a.removeClass(n).addClass(t.name()+"-active")},i=e(),c=i.on,s=i.unsubscribe;c("subscription",(function(e,t){"update"===t.type&&o()})),o(),r.$on("$destroy",s)}}}var xc=Pc;function Tc(e,t,n){var r=n((function(){return{ADD_PROTONVPN:t.getString("+ Add ProtonVPN",null,"Button")}}));return{restrict:"E",replace:!0,scope:{},template:'<button class="addVpn-button" type="button">\n            <div class="addVpn-button-wrapper">\n                <i class="addVpn-button-sign"></i>\n                <span class="addVpn-button-txt">'.concat(r.ADD_PROTONVPN,"</span>\n            </div>\n        </button>"),link:function(t,n,r){var a=r.plan,o=e(["dashboard"]).dispatcher,i="free"===a?"vpnbasic":"vpnplus",c=function(){o.dashboard("change.addon",{addon:"vpn",plan:"free",value:i}),o.dashboard("change.addon",{addon:"vpn",plan:"plus",value:i}),o.dashboard("change.addon",{addon:"vpn",plan:"professional",value:i})};n.on("click",c),t.$on("$destroy",(function(){return n.off("click",c)}))}}}Tc.$inject=["dispatchers","gettextCatalog","translator"];var Lc=Tc;$c.$inject=["$filter","customProPlanModal","dashboardConfiguration","dashboardModel","dashboardOptions","dispatchers","subscriptionModel","customProPlanModel"];var jc=s.Rb.ADDON,Nc={member:jc.MEMBER,address:jc.ADDRESS,domain:jc.DOMAIN,space:jc.SPACE};function $c(e,t,r,a,o,i,c,s){s.init();var u=function(t){var n=t.addon,o=t.value;if(!o||"none"===o)return"";var i,c=a.amounts();return"+ ".concat((i=c[Nc[n]]*o,e("currency")(i/100/r.cycle(),r.currency())),"/mo")},l=function(){t.activate({params:{close:function(){t.deactivate()}}})};return{restrict:"E",replace:!0,scope:{},templateUrl:n("eBTs"),compile:function(e,t){var n=t.addon,r=t.plan,a=i(["dashboard"]),s=a.dispatcher,d=a.on,p=a.unsubscribe,f=c.count(n),v=function(e){return s.dashboard("change.addon",{addon:n,plan:r,value:e})},m=e.find(".".concat("addonRow-select")),g=e.find(".".concat("addonRow-placeholder")),h=e.find(".".concat("addonRow-edit")),b=function(t){if(e.find(".".concat("addonRow-select"," option[value='").concat(t,"']")).length)return e[0].classList.remove("addonRow-limit-reached"),m.val("".concat(t));e[0].classList.add("addonRow-limit-reached"),g[0].setAttribute("data-value",t),g[0].textContent="".concat(o.translate(n,t+1)," ").concat(u({addon:n,value:t}))};function y(){var e=bt()(o.get(r,n),(function(e,t){var r=t.label,a=t.value;return"openModal"===a?e+'<option value="'.concat(a,'">').concat(r,"</option>"):e+'<option value="'.concat(a,'">').concat(r," ").concat(u({addon:n,value:a}),"</option>")}),"");m.html(e)}return y(),function(t){var a=function(){var e=m.val();if("member"===n&&"professional"===r&&"openModal"===e)return v(99),l();v(+e)};d("dashboard",(function(t,a){var o=a.type,i=a.data,c=void 0===i?{}:i;if("addon.updated"===o&&c.addon===n&&c.plan===r&&(y(),b(c.value)),"currency.updated"===o||"cycle.updated"===o){var s=e[0].classList.contains("addonRow-limit-reached")?~~g[0].getAttribute("data-value"):m.val();y(),b(s)}})),d("app.event",(function(e,t){if("subscription.event"===t.type){var r=c.count(n);b(r),v(r)}})),m.on("change",a),h.on("click",l),b(f),v(f),t.$on("$destroy",(function(){p(),h.off("click",l),m.off("change",a)}))}}}}var Rc=$c;function _c(e,t){return{restrict:"E",template:'<currency-selector data-currency="{{ ::currency }}" data-name="dashboardCurrency">',scope:{},link:function(n){var r=t(["dashboardCurrency","dashboard"]),a=r.on,o=r.dispatcher,i=r.unsubscribe;n.currency=e.currency(),a("subscription",(function(e,t){var n=t.type,r=t.data;"update"===n&&o.dashboardCurrency("set",r.subscription.Currency)})),a("dashboardCurrency",(function(e,t){var n=t.type,r=t.data;"change"===n&&o.dashboard("change.currency",{currency:r})})),n.$on("$destroy",i)}}}_c.$inject=["dashboardConfiguration","dispatchers"];var Uc=_c;function Fc(e,t){return{restrict:"E",replace:!0,scope:{},templateUrl:n("znre"),link:function(n,r){var a=t(),o=a.on,i=a.unsubscribe,c=function(){var t=e.get().free,n=t.vpnplus||t.vpnbasic?"add":"remove";r[0].classList[n]("freeColumn-show-vpn")};o("dashboard",(function(e,t){"vpn.updated"===t.type&&c()})),c(),n.$on("$destroy",i)}}}Fc.$inject=["dashboardConfiguration","dispatchers"];var Bc=Fc;function Kc(e,t,r,a){return{replace:!0,restrict:"E",scope:{},templateUrl:n("dBVP"),link:function(n,o){var i=t(["progressBar"]),c=i.dispatcher,s=i.on,u=i.unsubscribe,l=o.find(".scroll");function d(){var t=r.get(),n="free"===t.PlanName?e.user:t,a=n.UsedSpace/n.MaxSpace*100;c.progressBar("storageBar",{progress:a})}function p(){n.$applyAsync((function(){n.user=angular.copy(e.user)}))}function f(e){n.$applyAsync((function(){n.organization=angular.copy(e)}))}function v(e){n.$applyAsync((function(){n.subscription=angular.copy(e)}))}function m(){$(".settings").animate({scrollTop:$("#plans").offset().top},1e3)}l.on("click",m);s("updateUser",(function(){p(),d()})),s("app.event",(function(e,t){return"usedSpace"===t.type&&d()})),s("organizationChange",(function(e,t){f(t.data),d()})),s("subscription",(function(e,t){var n=t.type,r=t.data;"update"===n&&v((void 0===r?{}:r).subscription)})),s("payments",(function(t,r){"topUp.request.success"===r.type&&e.fetchUserInfo().then((function(e){return n.user=e}))})),p(),f(r.get()),v(a.get()),d(),n.$on("$destroy",(function(){l.off("click",m),u()}))}}}Kc.$inject=["authentication","dispatchers","organizationModel","subscriptionModel"];var Gc=Kc;function Vc(e,t,n,r,a,o){var i=["cycle.updated","currency.updated"],c=o((function(){return{user:a.getString("user",null,"Label"),month:a.getString("month",null,"Delay")}})),s=function(t,r,a){var o=n.amounts(r),i="/".concat(c.month),s="professional"===t?"/".concat(c.user):"";return"".concat(e("currency")(o[t]/100/r,a)).concat(i).concat(s)};return{restrict:"E",replace:!0,scope:{},template:'<strong class="planPrice"></strong>',link:function(e,n,a){var o=a.plan,c=r(),u=c.on,l=c.unsubscribe;function d(){e.$applyAsync((function(){n.text(s(o,t.cycle(),t.currency()))}))}u("dashboard",(function(e,t){var n=t.type;i.indexOf(n)>-1&&d()})),d(),e.$on("$destroy",l)}}}Vc.$inject=["$filter","dashboardConfiguration","dashboardModel","dispatchers","gettextCatalog","translator"];var qc=Vc;var Hc=function(){return{restrict:"E",replace:!0,scope:{},templateUrl:n("+Y4x")}};function zc(e){return{restrict:"E",replace:!0,scope:{},templateUrl:n("Aat8"),link:function(t,n){var r=n.find(".professionalColumn-customize");function a(){e.activate({params:{close:function(){e.deactivate()}}})}r.on("click",a),t.$on("$destroy",(function(){r.off("click",a)}))}}}zc.$inject=["customProPlanModal"];var Yc=zc;function Wc(e,t,n,r){var a="primary",o=r((function(){return{downgradeToFree:t.getString("Switch to Free",null,"Button to select plan on the dashboard"),downgradeToPlus:t.getString("Switch to Plus",null,"Button to select plan on the dashboard"),downgradeToProfessional:t.getString("Switch to Professional",null,"Button to select plan on the dashboard"),updateFree:t.getString("Update Free",null,"Button to select plan on the dashboard"),updatePlus:t.getString("Update Plus",null,"Button to select plan on the dashboard"),updateProfessional:t.getString("Update Professional",null,"Button to select plan on the dashboard"),updateVisionary:t.getString("Update Visionary",null,"Button to select plan on the dashboard"),upgradeToPlus:t.getString("Upgrade to Plus",null,"Button to select plan on the dashboard"),upgradeToProfessional:t.getString("Upgrade to Professional",null,"Button to select plan on the dashboard"),upgradeToVisionary:t.getString("Upgrade to Visionary",null,"Button to select plan on the dashboard")}})),i={free:{free:o.updateFree,plus:o.upgradeToPlus,professional:o.upgradeToProfessional,visionary:o.upgradeToVisionary},plus:{free:o.downgradeToFree,plus:o.updatePlus,professional:o.upgradeToProfessional,visionary:o.upgradeToVisionary},professional:{free:o.downgradeToFree,plus:o.downgradeToPlus,professional:o.updateProfessional,visionary:o.upgradeToVisionary},visionary:{free:o.downgradeToFree,plus:o.downgradeToPlus,professional:o.downgradeToProfessional,visionary:o.updateVisionary}};return{restrict:"E",replace:!0,scope:{},template:'<button class="selectPlan-button pm_button large" type="button"></button>',link:function(t,r,o){var c=o.plan,s=e(["dashboard"]),u=s.dispatcher,l=s.on,d=s.unsubscribe,p=function(){return u.dashboard("select.plan",{plan:c})};function f(){var e=n.name();r.text(i[e][c]),r.addClass(a),e===c&&r.removeClass(a)}l("subscription",(function(e,t){"update"===t.type&&f()})),r.on("click",p),f(),t.$on("$destroy",(function(){r.off("click",p),d()}))}}}Wc.$inject=["dispatchers","gettextCatalog","subscriptionModel","translator"];var Xc=Wc;es.$inject=["dispatchers","subscriptionModel","gettextCatalog","translator"];var Jc=s.G.MONTHLY,Qc=s.G.YEARLY,Zc=s.G.TWO_YEARS;function es(e,t,r,a){var o=a((function(){var e;return{vpn:r.getString("VPN connections",null,"Label"),addresses:r.getString("addresses",null,"Label"),domain:r.getString("domain",null,"Label"),domains:r.getString("domains",null,"Label"),member:r.getString("user",null,"Label"),members:r.getString("users",null,"Label"),cycles:(e={},v()(e,Jc,r.getString("Monthly",null,"Label")),v()(e,Qc,r.getString("Annually",null,"Label")),v()(e,Zc,r.getString("2-years",null,"Label")),e),methods:{card:r.getString("Credit card",null,"Label"),paypal:"Paypal"}}})),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.cycle=o.cycles[e.Cycle],e.plans=bt()(e.Plans,(function(t,n){return n.Type===s.Sb.PLAN&&(n.addons=u(e.Plans,n.Name.indexOf("vpn")>-1),t.push(n)),t}),[]),e},c=function(e){return e/Math.pow(s.g,3)};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Be()(Ue()({Type:0}),Ne()((function(e,n){return t===n.Name.indexOf("vpn")>-1&&(e[n.Name]?e[n.Name].Amount+=n.Amount:e[n.Name]=n),e}),{}),nc()((function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(e.Name){case"1vpn":e.Title="+ ".concat(e.Quantity*e.MaxVPN," ").concat(o.vpn);break;case"1gb":e.Title="+ ".concat(e.Quantity*c(e.MaxSpace)," GB");break;case"5address":e.Title="+ ".concat(e.Quantity*e.MaxAddresses," ").concat(o.addresses);break;case"1domain":e.Title="+ ".concat(e.Quantity*e.MaxDomains," ").concat(e.Quantity>1?o.domains:o.domain);break;case"1member":e.Title="+ ".concat(e.Quantity*e.MaxMembers," ").concat(e.Quantity>1?o.members:o.member)}}(e)})))(e)}return{scope:{methods:"="},restrict:"E",replace:!0,templateUrl:n("KYAH"),link:function(n){var r=e(),a=r.on,c=r.unsubscribe,s=t.get();a("subscription",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"update"===r&&n.$applyAsync((function(){n.subscription=i(o.subscription)}))})),n.subscription=i(s),n.method=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length?o.methods[e[0].Type]:"None"}(n.methods),n.$on("$destroy",c)}}}var ts=es;function ns(e,t,n,r,a){var o=function(t,r,a){return e("currency")(n.total(t,r)/100/r,a)},i=["addon.updated","cycle.updated","currency.updated","vpn.updated"];return{restrict:"E",replace:!0,scope:{},template:'<strong class="totalPlan"></strong>',link:function(e,n,c){var s=c.plan,u=r(),l=u.on,d=u.unsubscribe,p=a.getString("month",null,"Info");function f(){e.$applyAsync((function(){n.text("".concat(o(s,t.cycle(),t.currency()),"/").concat(p))}))}l("dashboard",(function(e,t){var n=t.type;i.indexOf(n)>-1&&f()})),f(),e.$on("$destroy",d)}}}ns.$inject=["$filter","dashboardConfiguration","dashboardModel","dispatchers","gettextCatalog"];var rs=ns,as=n("o+/T");ss.$inject=["$filter","blackFridayModel","dashboardConfiguration","dashboardModel","dispatchers","gettextCatalog","translator","subscriptionModel"];var os=s.G.MONTHLY,is=s.G.YEARLY,cs=s.G.TWO_YEARS;function ss(e,t,r,a,o,i,c,s){var u=c((function(){return{billedAs:function(e,t){return t===is?i.getString("Billed as {{amount}} /yr",{amount:e},"Info"):t===cs?i.getString("Billed as {{amount}} /2-yr",{amount:e},"Info"):""}}})),l=["addon.updated","cycle.updated","currency.updated","vpn.updated"],d=function(t,n,r,o){return e("currency")(a.total(t,n)/100/o,r)},p="totalRows-has-2-years";return{restrict:"E",replace:!0,scope:{},templateUrl:n("llV/"),link:function(e,t,n){var a=n.plan,i=o(["dashboard"]),c=i.dispatcher,f=i.on,v=i.unsubscribe,m=t.find(".totalRows-monthly-price"),g=t.find(".totalRows-yearly-price"),h=t.find(".totalRows-yearly-billed-price"),b=t.find(".totalRows-2-years-price"),y=t.find(".totalRows-2-years-billed-price");function E(){var e=s.cycle()===cs||Object(as.c)()?"add":"remove";t[0].classList[e](p)}function S(){e.$applyAsync((function(){m.text(d(a,os,r.currency(),os)),g.text(d(a,is,r.currency(),is)),b.text(d(a,cs,r.currency(),cs)),h.text(u.billedAs(d(a,is,r.currency(),os),is)),y.text(u.billedAs(d(a,cs,r.currency(),os),cs)),e.cycle=r.cycle()}))}e.onChange=function(){return c.dashboard("change.cycle",{cycle:e.cycle})},f("dashboard",(function(e,t){var n=t.type,r=void 0===n?"":n;l.indexOf(r)>-1&&S()})),f("blackFriday",(function(e,t){var n=t.type;"tictac"===(void 0===n?"":n)&&E()})),S(),E(),e.$on("$destroy",v)}}}var us=ss;var ls=function(){return{restrict:"E",replace:!0,scope:{},templateUrl:n("lYWG")}};vs.$inject=["dashboardConfiguration","dashboardModel","dispatchers","customVpnModel"];var ds=s.Rb.PLAN,ps=ds.VPN_BASIC,fs=ds.VPN_PLUS;function vs(e,t,r,a){function o(e){switch(e.target.getAttribute("data-action")){case"vpnbasic":a.set("vpnbasic",1),a.set("vpnplus",0),a.set("vpn",0);break;case"vpnplus":a.set("vpnbasic",0),a.set("vpnplus",1)}}return{restrict:"E",replace:!0,scope:{},templateUrl:n("0muV"),link:function(e,n){var i=t.amounts(),c=r(),s=c.on,u=c.unsubscribe;s("dashboard",(function(e,t){"vpn.modal.updated"===t.type&&(n.removeClass("".concat("vpnColumns-vpnbasic-selected"," ").concat("vpnColumns-vpnplus-selected")),a.get("vpnbasic")&&n.addClass("vpnColumns-vpnbasic-selected"),a.get("vpnplus")&&n.addClass("vpnColumns-vpnplus-selected"))})),e.vpnbasicAmount="".concat(t.filter(i[ps]),"/mo"),e.vpnplusAmount="".concat(t.filter(i[fs]),"/mo"),n.on("click",o),e.$on("$destroy",(function(){n.off("click",o),u()}))}}}var ms=vs;var gs=function(){return{restrict:"E",replace:!0,scope:{},templateUrl:n("LsJ6")}};Ss.$inject=["dashboardConfiguration","dashboardModel","dispatchers","gettextCatalog","subscriptionModel","translator","customVpnModal"];var hs=s.Rb.PLAN,bs=hs.VPN_BASIC,ys=hs.VPN_PLUS,Es=s.Rb.ADDON.VPN;function Ss(e,t,r,a,o,i,c){var s=i((function(){return{with:a.getString("with",null,"ProtonVPN with X connections"),connections:a.getString("connections",null,"ProtonVPN with X connections")}}));return{restrict:"E",replace:!0,scope:{},templateUrl:n("pZaB"),link:function(n,a,o){var i=o.plan,u=r(["dashboard"]),l=u.dispatcher,d=u.on,p=u.unsubscribe,f=a.find(".vpnRow-info"),v=function(n){return f.html('\n                    <div class="vpnRow-left">\n                        <b class="'.concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.vpnplus?"vpnRow-vpnplus":"vpnRow-vpnbasic"}(n),'">').concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.vpnplus?"ProtonVPN Plus":"ProtonVPN Basic"}(n),"</b> ").concat(s.with,' <button type="button" class="vpnRow-edit" data-action="open-vpn-modal">').concat(function(n){var r=t.get(e.cycle()).addons,a=function(e){return r[e].MaxVPN},o=n.vpnbasic*a(bs),c=n.vpnplus*a(ys),u=n.vpn*a(Es);return"".concat(o+c+("professional"===i?u:0)," ").concat(s.connections)}(n),'</button>\n                    </div>\n                    <div class="vpnRow-right">\n                        <strong>').concat((r=t.amount({plan:i,addon:"vpnbasic"}),a=t.amount({plan:i,addon:"vpnplus"}),o=t.amount({plan:i,addon:"vpn"}),c=r+a+("professional"===i?o:0),"+ ".concat(t.filter(c),"/mo")),"</strong>\n                    </div>\n                "));var r,a,o,c},m=function(){var t=e.get()[i];t.vpnplus||t.vpnbasic?(a.addClass("vpnRow-has-vpn"),v(t)):a.removeClass("vpnRow-has-vpn")},g=function(e){"open-vpn-modal"===e.target.getAttribute("data-action")&&function(e){c.activate({params:{plan:e,close:function(){c.deactivate()}}})}(i)};d("dashboard",(function(e,t){var n=t.type;"currency.updated"!==n&&"cycle.updated"!==n||m(),"vpn.updated"===n&&m()})),a.on("click",g),function(e){l.dashboard("init.vpn",{plan:e})}(i),n.$on("$destroy",(function(){p(),a.off("click",g)}))}}}var Ds=Ss;Cs.$inject=["customVpnModel","dashboardConfiguration","dashboardModel","dispatchers"];var ks=s.Rb.PLAN,As=ks.VPN_PLUS,Is=ks.VPN_BASIC;function Cs(e,t,r,a){var o=function(t){switch(t.target.getAttribute("data-action")){case"vpnplus":e.set("vpnbasic",0),e.set("vpnplus",1)}};return{replace:!0,restrict:"E",scope:{},templateUrl:n("mqTZ"),link:function(n,i){var c=a(),s=c.on,u=c.unsubscribe,l=i.find(".vpnSlider-count"),d=r.get(t.cycle()).addons,p=d[Is],f=d[As],v=e.parameters(),m=v.value,g=v.options;s("dashboard",(function(t,r){var a=r.type;"vpn.modal.updated"===(void 0===a?"":a)&&(e.get("vpnbasic")&&l.text("".concat(p.MaxVPN)),e.get("vpnplus")&&l.text("".concat(f.MaxVPN+e.get("vpn"))),e.get("vpnplus")&&n.$applyAsync((function(){return n.value=e.get("vpnplus")*f.MaxVPN+e.get("vpn")})),i[0].classList.toggle("vpnSlider-vpnplus-selected",e.get("vpnplus")),i[0].classList.toggle("vpnSlider-vpnbasic-selected",e.get("vpnbasic")))})),n.value=m,n.options=g,i.on("click",o),n.$on("$destroy",(function(){i.off("click",o),u()}))}}}var ws=Cs;function Os(e,t,r,a){return{replace:!0,restrict:"E",scope:{},templateUrl:n("KURL"),link:function(t,n){var o=a(),i=o.on,c=o.unsubscribe,s=n.find(".vpnTotal-amount");i("dashboard",(function(t,n){var a,o=n.type;"vpn.modal.updated"===(void 0===o?"":o)&&(a=e.amount(),s.text("".concat(r.filter(a),"/mo")))})),t.$on("$destroy",c)}}}Os.$inject=["customVpnModel","dashboardConfiguration","dashboardModel","dispatchers"];var Ms=Os,Ps=n("pZt1"),xs=n.n(Ps);$s.$inject=["dashboardConfiguration","dashboardModel","dispatchers"];var Ts=s.Rb.PLAN,Ls=s.Rb.ADDON.MEMBER,js=Ts.PROFESSIONAL,Ns=["members","storage","addresses"];function $s(e,t,n){var r=n(["refresh.slider","dashboard","update.slider.options"]),a=r.dispatcher,o=r.on,i=function(e){return e/Math.pow(s.g,3)},c={},u=function(e){return a["refresh.slider"](e,{value:c[e]})};function l(){var n=t.get(e.cycle()).plan[js],r=e.get().professional;return Number(r.member)+n.MaxMembers>=s.ub}function d(){var n=t.get(e.cycle()),r=n.plan,a=n.addons,o=r[js],s=a[Ls];return Lr()(0,c.maxMembers).map((function(e){return{members:e*s.MaxMembers+o.MaxMembers,storage:e*i(s.MaxSpace)+i(o.MaxSpace),addresses:e*s.MaxAddresses+o.MaxAddresses}}))}return o("slider.updated",(function(e,t){var n=t.type,r=t.data,a=void 0===r?{}:r;Me()(["members","storage","addresses"],n)&&function(e,t){var n=d(),r=le()(n,v()({},e,t)),a=r.members,o=r.storage,i=r.addresses;c.members=a,c.storage=o,c.addresses=i,u("members"),u("storage"),u("addresses")}(n,a.value)})),{init:angular.noop,getSliders:function(){return c.maxMembers=l()?s.bb:s.ub,bt()(["members","storage","addresses"],(function(n,r){return n[r]=function(n){var r,a,o,c,s=t.get(e.cycle()),u=s.addons,l=s.plan,p=u[Ls],f=l[js],v=e.get().professional,m=d(),g=le()(m,{members:Number(v.member)+f.MaxMembers});switch(n){case"members":r=p.MaxMembers,a=g.members,o=xs()(m).members,c=Ai()(m).members;break;case"storage":r=i(p.MaxSpace),a=g.storage,o=xs()(m).storage,c=Ai()(m).storage;break;case"addresses":r=p.MaxAddresses,a=g.addresses,o=xs()(m).addresses,c=Ai()(m).addresses}return{value:a,options:{type:n,animate:!1,tooltips:!0,connect:[!0,!1],start:a,step:r,range:{min:o,max:c},pips:{mode:"positions",values:[0,100],density:4,stepped:!0},format:{to:function(e){return"".concat(Number(e).toFixed())},from:function(e){return e}}}}}(r),n}),{})},send:function(){var n=t.get(e.cycle()).plan[js];a.dashboard("change.addon",{plan:"professional",addon:"member",value:c.members-n.MaxMembers})},increaseRanges:function(){c.maxMembers=s.bb;var e=d(),t=xs()(e),n=Ai()(e);Ns.forEach((function(e){a["update.slider.options"](e,{options:{range:{min:t[e],max:n[e]}}})}))},needMoreMember:l}}var Rs=$s;Ks.$inject=["dashboardConfiguration","dashboardModel","dispatchers"];var _s=s.Rb.PLAN,Us=s.Rb.ADDON.VPN,Fs=_s.VPN_BASIC,Bs=_s.VPN_PLUS;function Ks(e,t,n){var r={},a=n(["dashboard"]),o=a.dispatcher,i=a.on,c=function(){return o.dashboard("vpn.modal.updated")};return i("slider.updated",(function(n,a){var o=a.type,i=void 0===o?"":o,s=a.data,u=void 0===s?{}:s;if("vpn"===i){var l=t.get(e.cycle()).addons[Bs];r.vpn=u.value-l.MaxVPN,c()}})),{init:function(t){var n=e.get()[t],a=n.vpnbasic,o=void 0===a?0:a,i=n.vpnplus,s=void 0===i?0:i,u=n.vpn,l=void 0===u?0:u;r.vpnbasic=o,r.vpnplus=o||s?s:1,r.vpn=l,c()},set:function(e,t){r[e]=t,c()},get:function(e){return e?r[e]:angular.copy(r)},parameters:function(){var n=t.get(e.cycle()).addons,a=n[Us],o=n[Bs],i=a.MaxVPN,c=o.MaxVPN,u=r.vpn+o.MaxVPN;return{value:u,options:{type:"vpn",animate:!1,tooltips:!0,connect:[!0,!1],start:u,step:i,range:{min:c,max:s.Cb},pips:{mode:"positions",values:[0,100],density:4,stepped:!0},format:{to:function(e){return"".concat(Number(e).toFixed())},from:function(e){return e}}}}},amount:function(){var e=t.amounts(),n=0;return r.vpnbasic&&(n+=e[Fs]),r.vpnplus&&(n+=e[Bs]),r.vpn&&(n+=r.vpn*e[Us]),n}}}var Gs=Ks;var Vs=function(){var e={free:{},plus:{},professional:{}};return{cycle:function(){return e.cycle},currency:function(){return e.currency},get:function(){return angular.copy(e)},set:function(t,n){return e[t]=n},addon:function(t,n,r){return e[t][n]=r}}};cu.$inject=["$filter","confirmModal","dashboardConfiguration","dispatchers","downgrade","gettextCatalog","PaymentCache","paymentModal","subscriptionModel","networkActivityTracker","paymentModel","planListGenerator"];var qs=s.Rb.PLAN,Hs=qs.PLUS,zs=qs.PROFESSIONAL,Ys=qs.VISIONARY,Ws=qs.VPN_BASIC,Xs=qs.VPN_PLUS,Js=["free",Hs,zs,Ys],Qs=s.Rb.ADDON,Zs=Qs.ADDRESS,eu=Qs.MEMBER,tu=Qs.DOMAIN,nu=Qs.SPACE,ru=Qs.VPN,au=s.G.MONTHLY,ou=s.G.YEARLY,iu=s.G.TWO_YEARS;function cu(e,t,n,r,a,o,i,c,s,u,l,d){var p=r(["dashboard"]),f=p.dispatcher,v=p.on,m={},g=function(e,t){var r=function(e){var t=m[n.cycle()];return d[e](t)}(e);if("free"===e&&!r.length)return a();var o=n.cycle(),l=n.currency(),p=r.reduce((function(e,t){var n=t.ID;return e[n]=(e[n]||0)+1,e}),{}),f=s.coupon(),v=i.valid({PlanIDs:p,Currency:l,Cycle:o,CouponCode:f}).then((function(e){return f&&!e.Coupon?i.valid({PlanIDs:p,Currency:l,Cycle:o}):e})),g=Promise.all([i.plans(),v]).then((function(n){var r=G()(n,2),a=r[0],o=r[1];c.activate({params:{planIDs:p,valid:o,choice:t,plans:a,plan:e,cancel:function(){c.deactivate()}}})}));u.track(g)},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ou;return i.plans({Currency:e,Cycle:t}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.reduce((function(e,t){return e.amounts[t.Name]=t.Amount,Me()(Js,t.Name)?(e.plan[t.Name]=t,e.list.push(t),e):(e.addons[t.Name]=t,e)}),{addons:{},plan:{},list:[],amounts:{}}),n=t.list,r=t.addons,a=t.plan,o=t.amounts;return{list:n,addons:r,plan:a,amounts:o}}))},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.currency(),t=Promise.all([h(e),h(e,au),h(e,iu)]).then((function(e){var t=G()(e,3),n=t[0],r=t[1],a=t[2];return m[ou]=angular.copy(n),m[au]=angular.copy(r),m[iu]=angular.copy(a),angular.copy(m)}));return u.track(t),t},y=function(e){b(e).then((function(t){n.set("currency",e),f.dashboard("currency.updated",Ge()(t,{currency:e}))}))},E=function(e){var t=e.config,r=void 0===t?n.get():t,a=e.plan,o=e.addon,i=e.cycle,c=void 0===i?n.cycle():i;switch(o){case"vpn":return m[c].amounts[ru]*r[a].vpn;case"address":return m[c].amounts[Zs]*r[a].address;case"space":return m[c].amounts[nu]*r[a].space;case"domain":return m[c].amounts[tu]*r[a].domain;case"member":return m[c].amounts[eu]*r[a].member;case"vpnbasic":return m[c].amounts[Ws]*r[a].vpnbasic;case"vpnplus":return m[c].amounts[Xs]*r[a].vpnplus}switch(a){case"plus":case"professional":case"visionary":return m[c].amounts[a];default:return 0}},S=function(e){n.set("cycle",e),f.dashboard("cycle.updated",{cycle:e})};return v("subscription",(function(e,t){var r,a,o,i=t.type;"update"===(void 0===i?"":i)&&(r=+s.hasPaid("vpnbasic"),a=+s.hasPaid("vpnplus"),o=s.count("vpn"),n.addon("free","vpnbasic",r),n.addon("free","vpnplus",a),n.addon("plus","vpnbasic",r),n.addon("plus","vpnplus",a),n.addon("professional","vpnbasic",r),n.addon("professional","vpnplus",a),n.addon("professional","vpn",o),f.dashboard("vpn.updated"),S(s.cycle()),y(s.currency()))})),v("dashboard",(function(e,t){var r,a,o,i=t.type,c=t.data,u=void 0===c?{}:c;"change.cycle"===i&&S(u.cycle),"change.currency"===i&&y(u.currency),"change.addon"===i&&(r=u.plan,a=u.addon,o=u.value,n.addon(r,a,o),f.dashboard("addon.updated",{plan:r,addon:a,value:o})),"select.plan"===i&&g(u.plan),"select.vpn"===i&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n.addon("free","vpnbasic",+("vpnbasic"===e)),n.addon("free","vpnplus",+("vpnplus"===e)),n.addon("plus","vpnbasic",+("vpnbasic"===e)),n.addon("plus","vpnplus",+("vpnplus"===e)),n.addon("professional","vpnbasic",+("vpnbasic"===e)),n.addon("professional","vpnplus",+("vpnplus"===e)),n.addon("professional","vpn",t),f.dashboard("vpn.updated")}(u.plan,u.vpn),"remove.vpn"===i&&(n.addon("free","vpnbasic",0),n.addon("free","vpnplus",0),n.addon("plus","vpnbasic",0),n.addon("plus","vpnplus",0),n.addon("professional","vpnbasic",0),n.addon("professional","vpnplus",0),n.addon("professional","vpn",0),f.dashboard("vpn.updated")),"init.vpn"===i&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n.addon(e,"vpnbasic",+s.hasPaid("vpnbasic")),n.addon(e,"vpnplus",+s.hasPaid("vpnplus")),"professional"===e&&n.addon(e,"vpn",s.count("vpn")),f.dashboard("vpn.updated",{plan:e})}(u.plan)})),v("modal.payment",(function(e,t){var r=t.type,a=t.data;if("process.success"===r){var o=Promise.all([s.fetch(),l.getMethods(!0)]);u.track(o)}if("switch"===r){var i=a.Cycle,d=a.Currency,p=a.plan;c.deactivate(),n.set("currency",d),n.set("cycle",i),h(d,i).then((function(){g(p)}))}})),{init:angular.noop,loadPlans:b,get:function(e){var t=angular.copy(m);return e?t[e]:t},amount:E,amounts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.cycle();return angular.copy(m[e].amounts)},total:function(e,t){var r=n.get(),a=0;switch(e){case"free":a+=E({config:r,plan:e,cycle:t,addon:Ws}),a+=E({config:r,plan:e,cycle:t,addon:Xs});break;case"plus":a+=E({config:r,plan:e,cycle:t}),a+=E({config:r,plan:e,cycle:t,addon:"address"}),a+=E({config:r,plan:e,cycle:t,addon:"space"}),a+=E({config:r,plan:e,cycle:t,addon:"domain"}),a+=E({config:r,plan:e,cycle:t,addon:Ws}),a+=E({config:r,plan:e,cycle:t,addon:Xs}),a*=r[e].vpnbasic||r[e].vpnplus?.8:1;break;case"professional":a+=E({config:r,plan:e,cycle:t}),a+=E({config:r,plan:e,cycle:t,addon:"member"}),a+=E({config:r,plan:e,cycle:t,addon:"domain"}),a+=E({config:r,plan:e,cycle:t,addon:Ws}),a+=E({config:r,plan:e,cycle:t,addon:Xs}),a+=E({config:r,plan:e,cycle:t,addon:"vpn"}),a*=r[e].vpnbasic||r[e].vpnplus?.8:1;break;case"visionary":a+=E({config:r,plan:e,cycle:t})}return a},filter:function(t){return e("currency")(t/100/n.cycle(),n.currency())}}}var su=cu;function uu(e,t){var n=t((function(){return{address:function(t){return e.getString("{{value}} Addresses",{value:t},"dashboard options select")},space:function(t){return e.getPlural(t,"1 GB Storage","{{$count}} GB Storage",{},"dashboard options select")},member:function(t){return e.getPlural(t,"1 User","{{$count}} Users",{},"dashboard options select")},domain:function(t){return e.getPlural(t,"1 Custom Domain","{{$count}} Custom Domains",{},"dashboard options select")}}})),r=Lr()(5,51,5).map((function(e,t){return{label:n.address(e),value:t}})),a=Lr()(5,21).map((function(e,t){return{label:n.space(e),value:t}})),o=Lr()(1,s.ub+1).map((function(e,t){return{label:n.member(e),value:t}}));o.push({label:"> 100",value:"openModal"});var i=function(e,t){return Lr()(e,t).map((function(e,t){return{label:n.domain(e),value:t}}))},c={plus:{address:r,space:a,domain:i(1,11)},professional:{member:o,domain:i(2,101)}};return{get:function(e,t){return angular.copy(c[e][t])},translate:function(e,t){return n[e](t)}}}uu.$inject=["gettextCatalog","translator"];var lu=uu;function du(e,t,n,r,a,o,i,c){var s={Type:1,Name:"free"},u=i((function(){return{downgradeTitle:n.getString("Confirm downgrade",null,"Title"),downgradeMessage:n.getString("This will downgrade your account to a free account. ProtonMail is free software that is supported by donations and paid accounts. Please consider making a donation so we can continue to offer the service for free.<br /><br />Note: Additional addresses, custom domains, and users must be removed/disabled before performing this action.",null,"Info"),successMessage:n.getString("You have successfully unsubscribed",null,"Downgrade account")}}));return function(){e.activate({params:{title:u.downgradeTitle,message:u.downgradeMessage,confirm:function(){var n=o.delete().then((function(){return t.call()})).then((function(){return c.set(s)})).then((function(){e.deactivate(),a.success(u.successMessage)}));r.track(n)},cancel:function(){e.deactivate()}}})}}du.$inject=["confirmModal","eventManager","gettextCatalog","networkActivityTracker","notification","Payment","translator","subscriptionModel"];var pu=du;function fu(e,t,r,a){var o=r((function(){return{members:function(e){return t.getPlural(e,"1 user","{{$count}} users",{},"Custom pro plan dashboard")},storage:function(e){return t.getString("{{value}} GB storage",{value:e},"Custom pro plan dashboard")},addresses:function(e){return t.getString("{{value}} addresses",{value:e},"Custom pro plan dashboard")}}}));return a({controllerAs:"ctrl",templateUrl:n("XYMp"),controller:["params",function(t){var n=this;e.init(),this.sliders=e.getSliders(),this.format=function(e){return o[e](n.sliders[e].value)},this.close=function(){return t.close()},this.needMore=function(){e.increaseRanges(),n.needMoreMember=!0},this.submit=function(){e.send(),t.close()},e.needMoreMember()&&this.needMore()}]})}fu.$inject=["customProPlanModel","gettextCatalog","translator","pmModal"];var vu=fu;function mu(e,t,r,a){return r({controllerAs:"ctrl",templateUrl:n("6OED"),controller:["params",function(n){var r=t(["dashboard"]).dispatcher,o=e.get(),i=n.plan;a.init(i),this.fromPlan="customVpnModal-from-".concat(i),this.hasVpn=o[i].vpnbasic||o[i].vpnplus,this.close=function(){return n.close()},this.remove=function(){return r.dashboard("remove.vpn"),n.close()},this.submit=function(){var e=a.get("vpnplus"),t=a.get("vpn");r.dashboard("select.vpn",{plan:e?"vpnplus":"vpnbasic",vpn:t}),n.close()}}]})}mu.$inject=["dashboardConfiguration","dispatchers","pmModal","customVpnModel"];var gu=mu,hu=n("2xqg"),bu=n.n(hu);Su.$inject=["dashboardConfiguration"];var yu=s.Rb.PLAN,Eu=s.Rb.ADDON;function Su(e){var t=function(e,t){return function(n){var r=Eu[n.toUpperCase()];return bu()(e[n],(function(){return t[r]}))}};return{free:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.addons,r=void 0===n?{}:n,a=[],o=e.get(),i=o.free,c=void 0===i?{}:i;return c.vpnbasic&&a.push(r[yu.VPN_BASIC]),c.vpnplus&&a.push(r[yu.VPN_PLUS]),a},plus:function(n){var r=n.addons,a=void 0===r?{}:r,o=n.plan,i=[(void 0===o?{}:o)[yu.PLUS]],c=e.get().plus,s=void 0===c?{}:c,u=t(s,a);s.vpnbasic&&i.push(a[yu.VPN_BASIC]),s.vpnplus&&i.push(a[yu.VPN_PLUS]);var l=u("space").concat(u("address"),u("domain"));return i.push.apply(i,we()(l)),i},professional:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.addons,a=void 0===r?{}:r,o=n.plan,i=void 0===o?{}:o,c=[i[yu.PROFESSIONAL]],s=e.get(),u=s.professional,l=void 0===u?{}:u,d=t(l,a);l.vpnbasic&&c.push(a[yu.VPN_BASIC]),l.vpnplus&&c.push(a[yu.VPN_PLUS]);var p=d("member").concat(d("domain"),d("vpn"));return c.push.apply(c,we()(p)),c},visionary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.plan,n=void 0===t?{}:t;return[n[yu.VISIONARY]]}}}var Du=Su,ku=angular.module("proton.dashboard",[]).factory("planListGenerator",Du).directive("activePlan",xc).directive("addVpn",Lc).directive("addonRow",Rc).directive("dashboardCurrencySelector",Uc).directive("freeColumn",Bc).directive("overviewSection",Gc).directive("planPrice",qc).directive("plusColumn",Hc).directive("professionalColumn",Yc).directive("selectPlan",Xc).directive("subscriptionSection",ts).directive("totalPlan",rs).directive("totalRows",us).directive("visionaryColumn",ls).directive("vpnColumns",ms).directive("vpnDiscountPanel",gs).directive("vpnRow",Ds).directive("vpnSlider",ws).directive("vpnTotal",Ms).factory("customProPlanModel",Rs).factory("customVpnModel",Gs).factory("dashboardConfiguration",Vs).factory("dashboardModel",su).factory("dashboardOptions",lu).factory("downgrade",pu).factory("customProPlanModal",vu).factory("customVpnModal",gu).name;function Au(e,t,n,r){var a=r.CLASSNAME,o=r.DROPZONE_ATTR_ID;return document.addEventListener("dragenter",(function(e){var t=e.target;1===t.nodeType&&t.hasAttribute(o)&&(angular.element(document.querySelectorAll(".".concat(a.DROPZONE_HOVER))).removeClass(a.DROPZONE_HOVER),t.classList.add(a.DROPZONE_HOVER))})),document.addEventListener("dragover",(function(e){if(e.preventDefault(),e.target.hasAttribute(o)){var t=e.target.getAttribute(o);return n.dropzone.get(t).onDragOver(e.target,e),(e.dataTransfer||e.originalEvent.dataTransfer).dropEffect="move",!1}})),document.addEventListener("drop",(function(e){if(e.preventDefault(),document.body.classList.remove(a.BODY),e.target.hasAttribute(o)&&n.draggable.has("currentId")){var t=e.target.getAttribute(o),r=JSON.parse((e.dataTransfer||e.originalEvent.dataTransfer).getData("Text")).id;n.dropzone.get(t).onDropSuccess(e,r),n.draggable.get(r).onDropItem(e),angular.element(document.querySelectorAll(".".concat(a.DROPZONE_HOVER))).removeClass(a.DROPZONE_HOVER),angular.element(document.querySelectorAll(".".concat(a.DRAG_HOVER))).removeClass(a.DRAG_HOVER)}})),{type:"A",link:function(r,a){var i=e(),c=i.on,s=i.unsubscribe,u=function(){return _rAF((function(){n.dropzone.reset(),[].slice.call(a[0].querySelectorAll("[data-pt-dropzone-item]")).forEach((function(e){var r=t.generateUniqId("drop");e.classList.add("ptDnd-dropzone-container"),e.setAttribute(o,r),n.dropzone.set(r,{value:e.dataset.ptDropzoneItem,type:e.dataset.ptDropzoneItemType})}))}))},l=setTimeout((function(){return u(),clearTimeout(l)}),1e3);c("labelsModel",(function(e,t){var n=t.type;"cache.refresh"!==n&&"cache.update"!==n||u()})),c("contactGroupModel",(function(e,t){var n=t.type;"cache.refresh"!==n&&"cache.update"!==n||u()})),c("$stateChangeSuccess",(function(){_rAF(u)})),r.$on("$destroy",s)}}}Au.$inject=["dispatchers","ptDndUtils","ptDndModel","PTDNDCONSTANTS"];var Iu=Au;function Cu(e){var t={},n=function(e){return function(){return t[e]={}}},r=e(["ptDnd"]),a=r.dispatcher,o=r.on,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.ptDnd(e,t)};o("$stateChangeStart",(function(){n("draggable")}));var c=function(e){return{has:function(n){return!!(t[e]||{})[n]},set:function(n,r){t[e]=t[e]||{},"draggable"===e&&"currentId"!==n&&(t[e][n]=Ge()({selectedList:[],onDragStart:function(r,a){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t[e][n].selectedList=o,i("dragstart",{id:n,target:r,event:a,selectedList:o,model:t[e][n].model,type:t[e][n].type})},onDropItem:function(r){i("drop",{event:r,selectedList:t[e][n].selectedList,model:t[e][n].model,type:t[e][n].type})}},r)),"draggable"===e&&"currentId"===n&&(t[e][n]=r),"dropzone"===e&&(t[e][n]=Ge()({onDragOver:function(r,a){i("dragover",{id:n,target:r,event:a,value:t[e][n].value,type:t[e][n].type})},onDropSuccess:function(r,a){_rAF((function(){i("dropsuccess",{itemId:a,event:r,value:t[e][n].value,type:t[e][n].type})}))}},r))},get:function(n){return(t[e]||{})[n]},reset:n(e)}};return{draggable:c("draggable"),dropzone:c("dropzone")}}Cu.$inject=["dispatchers"];var wu=Cu;function Ou(e,t,n){var r=t.CLASSNAME,a=Object(Pe.i)(),o=Object(Pe.f)(),i=Object(Pe.h)(),c=o?"!important":"",s=function(){var e=document.createElement("SPAN");return e.className=r.NOTIF,document.body.appendChild(e),e}();i&&s.classList.add(r.NOTIF_FIREFOX);var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return e.classList.add(r.NOTIF_ACTIVE)},l=function(){return s.classList.remove(r.NOTIF_ACTIVE)};!i&&document.addEventListener("drag",(function(e){_rAF((function(){s.style.transform="translate(".concat(e.clientX,"px, ").concat(e.clientY,"px) ").concat(c).trim()}))})),document.addEventListener("dragend",(function(){l()}));return{init:angular.noop,show:u,hide:l,onDragStart:function(t,r,c){if(s.textContent=function(e,t){var r,a=n.getPlural(e,"message","messages",{},"Type of item"),o=n.getPlural(e,"conversation","conversations",{},"Type of item"),i=n.getPlural(e,"contact","contacts",{},"Type of item");return n.getString("Move {{total}} {{type}}",{type:(r=t,"contact"===r?i:"conversation"===r?o:a),total:e},"notification drag and drop")}(e.get("numberElementChecked")||1,c),!a&&!o&&!i){var l=new Image;l.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.setDragImage(l,0,0)}i&&r.setDragImage(s,0,0),!a&&!o&&u()}}}Ou.$inject=["AppModel","PTDNDCONSTANTS","gettextCatalog"];var Mu=Ou;function Pu(e,t,n,r,a,o,i,c,u,l,d){var p=d((function(){return{APPLY_LABEL:o.getString("Apply label",null,"notification drag and drop"),star:function(e,t){var n=o.getPlural(e,"message","messages",{},"Type of item"),r=o.getPlural(e,"conversation","conversations",{},"Type of item");return o.getString("Star {{total}} {{type}}",{type:"conversation"===t?r:n,total:e},"notification drag and drop")}}})),f=t(["elements","messageActions"]),v=f.dispatcher,m=f.on;c.init();var g,h=function(e,t,n){if("conversation"===t)return r.move(e,n);v.messageActions("move",{ids:e,labelID:n})};return m("ptDnd",(function(t,o){var c=o.type,d=o.data;if("drop"===c&&(g=d.selectedList),"dropsuccess"===c){var f=n.draggable.get(d.itemId),m=f.model,b=f.type,y=e.get("numberElementChecked")&&g?g:[m],E=k()(y,"ID");if(g=void 0,"label"===d.type)return function(e,t,n){var o=k()(e,"ID"),c=a.read(n),l=[(c.Selected=!0,c)];if(a.read(n,"folders"))return h(o,t,n);u.get("AlsoArchive")&&h(o,t,s.rb.archive),"conversation"===t?r.label(o,l):v.messageActions("label",{messages:e,labels:l}),i.success("".concat(p.APPLY_LABEL," ").concat(c.Name))}(y,b,d.value);if("group"===d.type)return function(e,t,n){l.manage("addToContact","contact")([{ID:n,Selected:!0}],e)}(y,0,d.value);if("starred"===d.value)return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;e.forEach((function(e){v.elements("toggleStar",{model:e,type:t})})),i.success(p.star(e.length,t))}(y,b);h(E,b,s.rb[d.value])}})),{init:angular.noop}}Pu.$inject=["AppModel","dispatchers","ptDndModel","actionConversation","labelsModel","gettextCatalog","notification","ptDndNotification","mailSettingsModel","moveContactGroupHandler","translator"];var xu=Pu;var Tu=function(){return{generateUniqId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drag-";return"".concat(e).concat(Object(Ot.k)())},getDragInitiatorNode:function(e){for(var t=e;t.parentNode;){if(Object(Kt.f)(t)&&"true"===t.getAttribute("draggable"))return t;t=t.parentNode}return null}}};function Lu(e,t,n,r,a,o){var i=a.CLASSNAME,c=a.DROPZONE_ATTR_ID,s=function(e,t){angular.element(document.querySelectorAll(".".concat(e))).removeClass(t||e)};return document.addEventListener("dragstart",(function(e){var t=r.getDragInitiatorNode(e.target);if(!t)return n.draggable.set("currentId",null);var a=e.dataTransfer||e.originalEvent.dataTransfer;if(t.classList.add(i.DRAG_START),document.body.classList.add(i.BODY),a.effectAllowed="move",a.setData("Text",JSON.stringify({id:t.dataset.ptId})),n.draggable.set("currentId",t.dataset.ptId),n.draggable.has(t.dataset.ptId)){var c=n.draggable.get(t.dataset.ptId);c.hookDragStart(t,e),o.onDragStart(e,a,c.type)}return!1})),document.addEventListener("dragenter",(function(e){var t=e.target;Object(Kt.f)(t)&&!t.classList.contains(i.DRAG_HOVER)&&t.hasAttribute(c)&&(s(i.DRAG_HOVER),t.classList.add(i.DRAG_HOVER))})),document.addEventListener("dragleave",(function(e){var t=e.target;Object(Kt.f)(t)&&t.classList.contains(i.DRAG_HOVER)&&t.classList.remove(i.DRAG_HOVER)})),document.addEventListener("dragend",(function(e){Object(Kt.f)(e.target)&&e.target.classList.remove(i.DRAG_START),document.body.classList.remove(i.BODY),s(i.DROPZONE_HOVER),s(i.DRAG_HOVER),n.draggable.set("currentId",null)})),function(e){return{link:function(n,a,o){var i=t(["dnd"]).dispatcher,c=r.generateUniqId();a[0].setAttribute("draggable",!0),a[0].setAttribute("data-pt-id",c),e({scope:n,el:a,attr:o},{dispatcher:i,id:c})}}}}Lu.$inject=["AppModel","dispatchers","ptDndModel","ptDndUtils","PTDNDCONSTANTS","ptDndNotification"];var ju=Lu;function Nu(e,t,n){return e((function(e,r){var a=e.scope,o=r.dispatcher,i=r.id,c=a.getElements;t.draggable.set(i,{model:a.conversation,type:a.conversation.ConversationID?"message":"conversation",hookDragStart:function(e,t){var r=this,i=n.get("numberElementChecked");if(a.conversation.Selected)return a.$applyAsync((function(){a.conversation.Selected=!0,n.set("numberElementChecked",i),r.onDragStart(e,t,c())}));o.dnd("hook.dragstart",{before:{number:i,ids:k()(c(),"ID")}}),a.$applyAsync((function(){a.conversation.Selected=!0,n.set("numberElementChecked",1),r.onDragStart(e,t,[a.conversation])}))}})}))}Nu.$inject=["ptDraggleCreator","ptDndModel","AppModel"];var $u=Nu;function Ru(e,t,n){return e((function(e,r){var a=e.scope,o=r.dispatcher,i=r.id,c=function(){return J()(a.contacts,{selected:!0})};t.draggable.set(i,{model:a.contact,type:"contact",hookDragStart:function(e,t){var r=this,i=n.get("numberElementChecked");if(a.contact.selected)return a.$applyAsync((function(){a.contact.selected=!0,n.set("numberElementChecked",i),r.onDragStart(e,t,c())}));o.dnd("hook.dragstart",{before:{number:i,ids:k()(c(),"ID")}}),a.$applyAsync((function(){a.contact.selected=!0,n.set("numberElementChecked",1),r.onDragStart(e,t,[a.contact])}))}})}))}Ru.$inject=["ptDraggleCreator","ptDndModel","AppModel"];var _u=Ru,Uu=angular.module("proton.dnd",["proton.message","proton.labels","proton.conversation"]).directive("ptDraggableContact",_u).directive("ptDraggableElement",$u).factory("ptDraggleCreator",ju).run(["actionDnd",function(e){return e.init()}]).constant("PTDNDCONSTANTS",{CLASSNAME:{BODY:"ptdnd-dragstart",DRAG_START:"ptdnd-drag-start",DRAG_HOVER:"ptdnd-drag-hover",DROPZONE:"ptDnd-dropzone-container",DROPZONE_HOVER:"ptdnd-dropzone-hover",NOTIF:"ptdnd-notification",NOTIF_ACTIVE:"ptdnd-notification-active",NOTIF_FIREFOX:"ptdnd-notification-firefox",DRAG_IMAGE:"ptdnd-dragimage"},DROPZONE_ATTR_ID:"data-pt-drop-id"}).directive("ptDropzone",Iu).factory("ptDndModel",wu).factory("ptDndNotification",Mu).factory("actionDnd",xu).factory("ptDndUtils",Tu).name;function Fu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fu(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fu(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ku(e,t,n,r,a,o,i,c,u,l,d,p,f,v,m,g,h,b,y,E){var S,D=t(["elements","messageActions","message.open"]),A=D.on,I=D.unsubscribe,C=D.dispatcher,w=f.get(),O=w.NumMessagePerPage,M=w.MessageButtons,P=setInterval((function(){C.elements("refresh.time")}),6e4),x=function(e){return n.numberElementChecked=e},T=E.getTypeList();function L(e){var t=e.LabelIDs,n=void 0===t?[]:t,r=e.Labels,a=void 0===r?[]:r;return n.length||a.length}n.elementsLoaded=!1,n.limitReached=!1,n.conversations=[],n.hasLabels=L;var j=function(e){if("message"===T)return{"element-is-replied":Object(tr.o)(e),"element-is-repliedall":Object(tr.p)(e),"element-is-forwarded":Object(tr.j)(e)}};n.getClassNames=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Bu({selected:e.Selected,active:R(e),marked:e.ID===t.ID,hasLabels:L(e),read:U(e),hasAttachments:_(e),expiring:e.ExpirationTime>0},j(e))},n.$on("$stateChangeSuccess",(function(){n.elementsLoaded=!1,n.limitReached=!1}));function N(e){var t=e.LabelIDs,n=void 0===t?[]:t,r=e.Labels,a=void 0===r?[]:r;return a.length?_r()(a,{ID:s.rb.starred}):n.some((function(e){return e===s.rb.starred}))}function R(e){return!(0!==m.get("numberElementChecked")||!angular.isDefined(r.params.id))&&(r.params.id===e.ConversationID||r.params.id===e.ID)}function _(e){return e.ConversationID?e.NumAttachments>0:e.ContextNumAttachments>0}function U(e){return e.ConversationID?0===e.Unread:0===e.ContextNumUnread}function F(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(r.params.id&&f.get("ViewLayout")===s.dc){var t=r.params.id;return["message"===E.typeView()?l.getMessageCached(t):l.getConversationCached(t)]}var a=n.conversations,o=void 0===a?[]:a,i=J()(o,{Selected:!0});return!i.length&&n.markedElement&&e?J()(o,(function(e){var t=e.ID,r=e.ConversationID;return t===n.markedElement.ID||r===n.markedElement.ID})):i}function B(){return k()(F(),"ID")}function K(){var e=F(),t=G()(e,1)[0];return t?t.ConversationID?"message":"conversation":E.getTypeList()}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"to";a.page&&n.selectElements("all",!1),n.page=~~a.page||1,v[e]()}function q(e){if(e){var t={},a=r.params.id&&r.params.id===e.ConversationID;if("conversation"===E.typeView()&&"message"===E.getTypeList()?(t.id=e.ConversationID,t.messageID=e.ID):(t.id=e.ID,t.messageID=null),n.selectElements("all",!1),d.deallocator(e),i.flushCache(),n.markedElement=e,a)return C["message.open"]("toggle",{message:e,action:"openElement"});var o=r.$current.name.replace(".element","");r.go(o+".element",t),y.removeAll()}}n.displayType=function(e){var t=!1,r=f.get().ViewLayout,a=r===s.o,o=r===s.dc;switch(e){case"rows":t=!m.is("mobile")&&o&&!n.idDefined();break;case"columns":t=a&&!m.is("mobile");break;case"placeholder":var i=n.idDefined();t=a&&(!i||i&&m.get("numberElementChecked")>0)&&!m.is("mobile");break;case"mobile":t=!n.idDefined()&&m.is("mobile")}return t},n.startWatchingEvent=function(){var e=!!r.params.id,t=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(){e||(t.apply(void 0,arguments),"conversation"===E.typeView()&&(e=n))}};A("elements",(function(t,r){var a=r.type,o=r.data,i=void 0===o?{}:o;switch(a){case"mark":var s=le()(n.conversations,{ID:i.id});s&&n.markedElement!==s&&n.$applyAsync((function(){n.markedElement=s}));break;case"open":n.$applyAsync((function(){return q(i.element)}));break;case"opened":le()(n.conversations,{ID:i.id})&&(e=!0);break;case"close":e=!1;break;case"refresh":n.refreshElements();break;case"switchTo.next":c();break;case"switchTo.previous":u()}})),A("openMarked",t((function(){q(n.markedElement)}))),A("left",(function(){var t;t=r.$current.name.replace(".element",""),r.go(t,{id:""}),e=!1})),A("right",t((function(){q(n.markedElement)}))),A("selectMark",(function(){n.markedElement&&n.$applyAsync((function(){n.markedElement.Selected=!n.markedElement.Selected,m.set("numberElementChecked",J()(n.conversations,{Selected:!0}).length)}))})),A("selectElements",(function(e,t){var r=t.type,a=t.data.isChecked;n.$applyAsync((function(){n.selectElements(r,a)}))})),A("app.commands",(function(e,t){var r=t.type,a=t.data,o=r.match(/(add|remove)\.(folders|labels)$/)||[],i=G()(o,3),c=i[1],s=i[2];n.$applyAsync((function(){"labels"===s&&n.saveLabels(a.list),"folders"===s&&n.move(null,a.ID,c)}))})),A("AppModel",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"numberElementChecked"===r&&n.$applyAsync((function(){x(o.value)}))})),A("applyLabels",(function(e,t){n.applyLabels(t)})),A("hotkeys",(function(t,r){var a=r.type,o=r.data.to;if("move"===a){var i=n.idDefined(),c=!i||i&&m.get("numberElementChecked")>0;!e&&c&&(t.preventDefault(),ke()((function(){return n.move(o)})))}"escape"===a&&n.back()})),A("read",(function(){n.read()})),A("unread",(function(){n.unread()})),A("toggleStar",(function(){var e=K(),t=F().reduce((function(e,t){return e[N(t)?"unstar":"star"].push(t.ID),e}),{unstar:[],star:[]}),n=t.unstar,r=t.star;"conversation"===e&&(n.length&&o.unstar(n),r.length&&o.star(r));"message"===e&&(n.length&&C.messageActions("unstar",{ids:n}),r.length&&C.messageActions("star",{ids:r}))}));var a=t((function(){if(n.conversations){var e=n.conversations.indexOf(n.markedElement);if(e>0)return n.$applyAsync((function(){n.markedElement=n.conversations[e-1]})),g.follow(!0);V("previous")}}),!1),i=t((function(){if(n.conversations){var e=n.conversations.indexOf(n.markedElement);if(e<n.conversations.length-1)return n.$applyAsync((function(){n.markedElement=n.conversations[e+1]})),g.follow();V("next")}}),!1);function c(){var e=r.params.id;if(!e)return a();var t=f.get(),o=t.ViewLayout,i=t.ViewMode,c=o===s.dc,u=r.$current.name,d=n.markedElement.Time,p=i===s.C;l.more(e,d,"next").then((function(e){var t=p&&e.ConversationID||e.ID;r.go(u,{id:t}),n.markedElement=e,C.elements("switchTo.next.success",e),!c&&g.follow()})).catch((function(e){C.elements("switchTo.next.error",e)}))}function u(){var e=r.params.id;if(!e)return i();var t=f.get(),a=t.ViewLayout,o=t.ViewMode,c=a===s.dc,u=r.$current.name,d=n.markedElement.Time,p=o===s.C;l.more(e,d,"previous").then((function(e){var t=p&&e.ConversationID||e.ID;r.go(u,{id:t}),n.markedElement=e,C.elements("switchTo.previous.success",e),!c&&g.follow()})).catch((function(e){C.elements("switchTo.previous.error",e)}))}A("markPrevious",a),A("markNext",i),A("newElement",(function(){c()})),A("oldElement",(function(){u()})),n.$on("$destroy",(function(){I(),clearInterval(P),g.clear()}))},n.refreshElements=function(){var e=h(n.mailbox);return("message"===E.getTypeList()?l.queryMessages(e):l.queryConversations(e)).then((function(e){p.set(!1);var t=~~a.page||0,o=n.conversations.reduce((function(e,t){return t.Selected&&(e[t.ID]=t),e}),{});return n.$applyAsync((function(){var a=angular.copy(n.conversations);if(n.elementsLoaded=!0,n.conversations=e.map((function(e){return e.Selected=void 0!==o[e.ID],e})),angular.isDefined(S)&&S(),S=n.$watch("conversations",(function(){m.set("numberElementSelected",F().length)}),!0),n.limitReached=u.isReached()&&v.isMax(),!n.conversations.length&&t>0&&!n.idDefined())return n.back(!1,t-1);if(n.conversations.length>0){var i;if(n.markedElement){var c=le()(n.conversations,{ID:n.markedElement.ID});if(c)i=c;else{var s=z()(a,{ID:n.markedElement.ID})||0;i=n.conversations[s]||xs()(n.conversations)}}else i=r.params.id?le()(n.conversations,(function(e){var t=e.ID,n=e.ConversationID;return r.params.id===n||r.params.id===t})):xs()(n.conversations);n.markedElement=i}})),e}),(function(){n.elementsLoaded=!0,n.conversations=[]}))},n.size=function(e){return e.ConversationID?e.Size:e.ContextSize},n.isDisabled=function(){return!n.markedElement&&(0===m.get("numberElementChecked")&&!angular.isDefined(r.params.id))},n.isCacheContext=function(){return E.cacheContext()},n.selectElements=function(e,t){var r={all:function(e){e.Selected=t},read:function(e){e.Selected=(0===e.ContextNumUnread||0===e.Unread)&&t},unread:function(e){e.Selected=(e.ContextNumUnread>0||1===e.Unread)&&t},starred:function(e){e.Selected=N(e)&&t},unstarred:function(e){e.Selected=!N(e)&&t}};We()(n.conversations,(function(t){return r[e](t)})),m.set("numberElementChecked",J()(n.conversations,{Selected:!0}).length)},n.read=function(){var e=K(),t=B();"conversation"===e?o.read(t):"message"===e&&C.messageActions("read",{ids:t})},n.unread=function(){var e=K(),t=B();"conversation"===e?o.unread(t):"message"===e&&C.messageActions("unread",{ids:t}),angular.isDefined(r.params.id)&&n.back(!0)},n.delete=function(){b({getElementsSelected:F,idsSelected:B,getTypeSelected:K})},n.move=function(e,t){var n=K(),r=B(),a=t||s.rb[e];0!==r.length&&(m.set("numberElementChecked",0),"conversation"===n?o.move(r,a):"message"===n&&C.messageActions("move",{ids:r,labelID:a}))},n.getElements=function(){return F()},n.saveLabels=function(e,t){var n=K(),r=B();if("conversation"===n)o.label(r,e,t);else if("message"===n){var a=F();C.messageActions("label",{messages:a,labels:e,alsoArchive:t})}},n.back=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=r.$current.name.replace(".element","");if(e){var o=Ge()({},a,{id:null});return r.go(n,o)}var i={id:null,label:a.label};~~a.page&&void 0!==t&&(i.page=t||~~a.page||1),r.go(n,i)},n.closeLabels=function(){$(".pm_dropdown").removeClass("active")},n.displayPaginator=function(){return!r.params.id||f.get("ViewLayout")===s.o},n.applyLabels=function(e){var t=[];We()(n.labels,(function(n){n.ID===e&&(n.Selected=!0),t.push(n)})),n.saveLabels(t,!0)},n.goToLabel=function(e){var t={page:void 0,filter:void 0,sort:void 0,label:e};r.go("secured.label",t)},x(m.get("numberElementChecked")),n.markedElement=void 0,n.mailbox=E.currentMailbox(),n.conversationsPerPage=O,n.labels=c.get(),n.messageButtons=M,n.selectedFilter=a.filter,n.selectedOrder=a.sort||"-date",n.page=~~a.page||1,n.startWatchingEvent(),n.refreshElements().then((function(){n.$applyAsync((function(){n.selectElements("all",!1)}))}),e.error)}Ku.$inject=["$log","dispatchers","$scope","$state","$stateParams","actionConversation","AttachmentLoader","labelsModel","limitElementsModel","cache","embedded","firstLoadState","mailSettingsModel","paginationModel","AppModel","markedScroll","forgeRequestParameters","removeElement","cacheBase64","tools"];var Gu=Ku;function Vu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vu(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vu(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Hu(e,t,r,a,i,u,l,d,p,f,m){var g,h=function(e){return"advancedFilterElement-".concat(e)},b=(g={},v()(g,h("btn-small-to-large"),(function(){return"size"===e.sort})),v()(g,h("btn-large-to-small"),(function(){return"-size"===e.sort})),v()(g,h("btn-old-to-new"),(function(){return"date"===e.sort})),v()(g,h("btn-new-to-old"),(function(){return!e.sort||"-date"===e.sort})),v()(g,h("btn-show-all"),(function(){return!(e.sort&&"-date"!==e.sort||e.filter)})),v()(g,h("btn-unread"),(function(){return"unread"===e.filter})),v()(g,h("btn-read"),(function(){return"read"===e.filter})),g),y=function(e){return e.replace(".element","")},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.go(y(m.$current.name),qu({},m.params,{page:void 0,id:void 0},e))},S={empty:function(t){var n=r.getString("Delete all",null,"Title"),u=r.getString("Are you sure? This cannot be undone.",null,"Info");if(["drafts","allDrafts","spam","trash","folder","label"].includes(t)){var v,g=e.label||s.rb[t],h={drafts:"emptyDraft",allDrafts:"emptyAllDraft",spam:"emptySpam",trash:"emptyTrash",folder:"emptyLabel",label:"emptyLabel"};i.activate({params:{title:n,message:u,confirm:(v=c()(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a[h[t]](g).then(f.call),e.next=3,l.track(n);case 3:d.empty(g),i.deactivate(),p.success(r.getString("Folder emptied",null,"Success")),m.includes("**.element")&&m.go(m.$current.name.replace(".element",""));case 7:case"end":return e.stop()}}),e)}))),function(){return v.apply(this,arguments)})}})}},orderBy:function(e){return E({sort:"-date"===e?void 0:e})},filterBy:function(e){return E({filter:e})},clearFilter:function(){return E({filter:void 0,sort:void 0})},toggleTrashSpam:function(){return E({trashspam:angular.isDefined(m.params.trashspam)?void 0:0})}};return{replace:!0,templateUrl:n("1ect"),link:function(n,r){var a=t(),o=a.on,i=a.unsubscribe,c=r.find("button"),s=function(e){e.preventDefault();var t=e.target.getAttribute("data-action");t&&S[t](e.target.getAttribute("data-action-arg"))};We()(c,(function(e){var t=e.classList.item(0);b[t]&&b[t]()&&e.classList.add("active")}));var l=function(){var t=e.label,n=t&&u.read(t,"folders")?"add":"remove",a=t&&u.read(t,"labels")?"add":"remove";r[0].classList[n]("advancedFilterElement-state-folder"),r[0].classList[a]("advancedFilterElement-state-label")};o("$stateChangeSuccess",l),l(),c.on("click",s),n.$on("$destroy",(function(){c.off("click",s),i()}))}}}Hu.$inject=["$stateParams","dispatchers","gettextCatalog","messageApi","confirmModal","labelsModel","networkActivityTracker","cache","notification","eventManager","$state"];var zu=Hu;function Yu(e){return{replace:!0,templateUrl:n("TRod"),link:function(t,n){var r=e(["selectElements"]).dispatcher,a=n.find(".countElementsSelected-btn-unselect"),o=function(){return r.selectElements("all",{isChecked:!1})};a.on("click",o),t.$on("$destroy",(function(){a.off("click",o)}))}}}Yu.$inject=["dispatchers"];var Wu=Yu,Xu=function(e){return{restrict:"E",template:"\n    <conversation-view ng-if=\"type === 'conversation'\"></conversation-view>\n    <message-view ng-if=\"type === 'message'\"></message-view>\n    ",link:function(t){t.type=e.typeView()}}};Xu.$inject=["tools"];var Ju=Xu;function Qu(e){return{restrict:"A",link:function(t,n){var r=e(["elements"]).dispatcher,a=er()((function(e){var n=e.target;n&&!/ptSelectConversation|customMaskInput/.test(n.className)&&r.elements("open",{element:t.conversation})}),300);n.on("click",a),t.$on("$destroy",(function(){n.off("click",a)}))}}}Qu.$inject=["dispatchers"];var Zu=Qu;function el(e,t,r){var a=["all","read","unread","star","unstar"],o=["all","unread","read","unstar","star"],i={all:{label:r.getString("Select All",null,"Action"),icon:"fa-check-square-o",action:"all"},unread:{label:r.getString("All Unread",null,"Action"),icon:"fa-eye-slash",action:"unread"},read:{label:r.getString("All Read",null,"Action"),icon:"fa-eye",action:"read"},unstar:{label:r.getString("All Unstarred",null,"Action"),icon:"fa-star-o",action:"unstarred"},star:{label:r.getString("All Starred",null,"Action"),icon:"fa-star",action:"starred"}},c=function(e){return e.map((function(e){return i[e]}))},s=function(){return(e=+t.get("MessageButtons"),c(e?o:a)).reduce((function(e,t){var n=t.label,r=t.icon,a=t.action;return e+Object(So.a)('\n                    <button data-action="'.concat(a,'" class="elementsSelector-btn-action">\n                        <i class="fa ').concat(r,'"></i>\n                        <span>').concat(n,"</span>\n                    </button>\n                "))}),"");var e};return{replace:!0,templateUrl:n("eKlv"),compile:function(n){return n[0].querySelector(".pm_dropdown").insertAdjacentHTML("beforeEnd",s()),function(n,r){var a=e(["dropdown","selectElements"]),o=a.dispatcher,i=a.on,c=a.unsubscribe,s=r.find(".elementsSelector-btn-action"),u=function(){n.$applyAsync((function(){n.viewLayout=t.get("ViewLayout")}))};function l(e){var t=e.currentTarget.getAttribute("data-action");o.selectElements(t,{isChecked:!0}),o.dropdown("close")}i("mailSettings",(function(e,t){var n=t.type;"updated"===(void 0===n?"":n)&&u()})),s.on("click",l),n.checkedSelectorState=function(){return ba()(n.conversations,{Selected:!0})},u(),n.$on("$destroy",(function(){c(),s.off("click",l)}))}}}}el.$inject=["dispatchers","mailSettingsModel","gettextCatalog"];var tl=el;function nl(e,t,r,a,o){var i=["secured.allSent.**","secured.sent.**","secured.allDrafts.**","secured.drafts.**","secured.search.**","secured.starred.**","secured.allmail.**","secured.label.**"],c=o({MAP_LABELS:{inbox:{className:"fa-inbox",tooltip:r.getString("In inbox",null,"Type of label for a message/conversation")},sent:{className:"fa-send",tooltip:r.getString("In sent",null,"Type of label for a message/conversation")},drafts:{className:"fa-file-text-o",tooltip:r.getString("In drafts",null,"Type of label for a message/conversation")},archive:{className:"fa-archive",tooltip:r.getString("In archive",null,"Type of label for a message/conversation")},trash:{className:"fa-trash-o",tooltip:r.getString("In trash",null,"Type of label for a message/conversation")},spam:{className:"fa-ban",tooltip:r.getString("In spam",null,"Type of label for a message/conversation")},folder:{className:"fa-folder"}}}).getTemplateLabels;return{templateUrl:n("McTc"),replace:!0,scope:{conversation:"="},link:function(n,r){var o=t(),s=o.on,u=o.unsubscribe,l=function(t){var o=t.LabelIDs,s=void 0===o?[]:o,u=t.Labels,l=void 0===u?[]:u;if((s.length||l.length)&&i.some((function(t){return e.includes(t)}))){var d=l.length?k()(l,(function(e){return e.ID})):s,p=a(c(d))(n);r.empty().append(p)}};s("foldersElement",(function(e,t){var r=t.data;r.ID===n.conversation.ID&&l(r)})),l(n.conversation),n.$on("$destroy",u)}}}nl.$inject=["$state","dispatchers","gettextCatalog","$compile","mailboxIdentifersTemplate"];var rl=nl;function al(e,t,r,a,o){return{restrict:"E",templateUrl:n("KZ5K"),replace:!0,scope:{element:"="},link:function(n,r,i){var c,s=i.limit,u=void 0===s?4:s,l=i.type,d=e(["messageActions"]),p=d.dispatcher,f=d.on,v=d.unsubscribe,m=(c=r[0].querySelector(".labelsElement-more"),{hide:function(){c.classList.add("labelsElement-hidden")},show:function(){_rAF((function(){return c.classList.remove("labelsElement-hidden")}))}}),g=function(e){var r=e.LabelIDs,a=void 0===r?[]:r,i=e.Labels,c=void 0===i?[]:i;if(m.hide(),a.length||c.length){var s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=function(e){return(n?o:t).read(e,"labels")};return e.reduce((function(e,t){var n=r(t);return n&&e.push(n),e}),[])}(c.length?k()(c,(function(e){return e.ID})):a,l);if("none"!==u)return n.labels=s.length?angular.copy(s.slice(0,u)):[],void(s.length>u&&m.show());n.labels=angular.copy(s)}},h=function(e){if(e.stopPropagation(),e.target.classList.contains("labelsElement-label")){var t=e.target.getAttribute("data-label-id");a.go("secured.label",{label:t})}e.target.classList.contains("labelsElement-btn-remove")&&p.messageActions("unlabel",{messageID:n.element.ID,conversationID:n.element.ConversationID,labelID:e.target.getAttribute("data-label-id")})};f("labelsElement",(function(e,t){var r=t.data;r.ID===n.element.ID&&g(r)})),g(n.element),n.color=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Color,n=void 0===t?"inherit":t;return{color:n}},r.on("click",h),n.$on("$destroy",(function(){r.off("click",h),v()}))}}}al.$inject=["dispatchers","labelsModel","authentication","$state","contactGroupModel"];var ol=al,il=function(){return{replace:!0,templateUrl:n("GXeG"),link:function(e,t){function n(t){if("BUTTON"===t.target.tagName){var n=t.target.getAttribute("data-action");if("delete"===n)return e.delete();e.move(n)}}t.on("click",n),e.$on("$destroy",(function(){t.off("click",n)}))}}};function cl(e,t,n,r){var a=r((function(){return{INCLUDE_MOVED_MESSAGES:t.getString("Include moved messages",null,"Link")}})),o={sent:"secured.allSent",allSent:"secured.sent",drafts:"secured.allDrafts",allDrafts:"secured.drafts"};return{restrict:"E",replace:!0,scope:{},template:'\n            <button class="movedButton-container">\n                <div>\n                    <i class="movedButton-icon fa fa-share-square-o"></i>\n                    <span class="movedButton-text">'.concat(a.INCLUDE_MOVED_MESSAGES,"</span>\n                </div>\n            </button>\n            "),link:function(t,r){var a=n.filteredState(),i=function(){return e.go(o[a],Ge()({},e.params,{page:void 0,id:void 0}))};"allSent"!==a&&"allDrafts"!==a||r.addClass("active"),r.on("click",i),t.$on("$destroy",(function(){return r.off("click",i)}))}}}cl.$inject=["$state","gettextCatalog","tools","translator"];var sl=cl;function ul(e,t,n,r,a,o,i,c){var s=i((function(){return{includeMoved:n.getString("Include Moved",null,"Option"),hideMoved:n.getString("Hide Moved",null,"Option"),success:n.getString("Setting updated",null,"Success"),labelSelect:n.getString("Sent / Drafts folders appearance",null,"Label")}}));return{restrict:"E",replace:!0,scope:{},template:'\n            <span class="movedSelect-container pm_select inline">\n                <label>\n                    <span class="sr-only">'.concat(s.labelSelect,'</span>\n                    <select class="movedSelect-select">\n                        <option value="3">').concat(s.includeMoved,'</option>\n                        <option value="0">').concat(s.hideMoved,'</option>\n                    </select>\n                    <i class="fa fa-angle-down"></i>\n                </label>\n            </span>\n            '),link:function(e,n){var i=t(),u=i.on,l=i.unsubscribe,d=n.find("select"),p=function(e){return d.val(+e)},f=function(){return~~d.val()};function v(){var e=f(),t=o.updateShowMoved({ShowMoved:e}).then((function(){c.success(s.success)}));r.track(t)}u("mailSettings",(function(){p(a.get("ShowMoved"))})),p(a.get("ShowMoved")),d.on("change",v),e.$on("$destroy",(function(){l(),d.off("change",v)}))}}}ul.$inject=["authentication","dispatchers","gettextCatalog","networkActivityTracker","mailSettingsModel","settingsMailApi","translator","notification"];var ll=ul;function dl(e,t,r,a){var o=["drafts","search","sent","allDrafts","allSent"];return{replace:!0,templateUrl:n("oil3"),link:function(n,i){var c=t(["elements"]),u=c.dispatcher,l=c.on,d=c.unsubscribe,p=function(){var t,n,c,u,l=(t=a.currentMailbox(),n=r.get("ViewLayout")===s.dc,c=a.cacheContext(),u=-1===o.indexOf(t),e.params.id&&n&&c&&u?"add":"remove");i[0].classList[l]("navElements-displayed")};p(),l("$stateChangeSuccess",p),l("settings",(function(e,t){"viewLayout.updated"===t.type&&p()})),l("elements",(function(e,t){var n=t.type;if(/(previous|next)\.(error|success)$/.test(n)){var r=n.split("."),a=G()(r,3);!function(e,t){"success"===t&&(i[0].classList.remove("navElements-no-previous"),i[0].classList.remove("navElements-no-next")),"error"===t&&i[0].classList.add("navElements-no-"+e)}(a[1],a[2])}}));var f=function(e){var t=e.target;!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u.elements(e,t)}("switchTo.".concat(t.getAttribute("data-dest")),{conversation:n.conversation,from:"button"})};i.on("click",f),n.$on("$destroy",(function(){i.off("click",f),d()}))}}}dl.$inject=["$state","dispatchers","mailSettingsModel","tools"];var pl=dl,fl=function(){return{replace:!0,templateUrl:n("xJxz")}},vl=function(e){return{link:function(t,n){var r=e(["selectElements"]).dispatcher;function a(e){var t=e.target,n=t.checked,a=t.value;r.selectElements(a,{isChecked:n}),_rAF((function(){return t.blur()}))}n.on("change",a),t.$watch("value",(function(){return n.change()})),t.$on("$destroy",(function(){n.off("change",a)}))}}};vl.$inject=["dispatchers"];var ml=vl;function gl(e,t){var n={},r=function(e,t){return J()(e,v()({},t,!0)).length};return{link:function(a,o,i){var c=i.ptSelectMultipleElements,s=null,u=c||"elements",l=t(),d=l.on,p=l.unsubscribe,f={elements:{list:"conversations",item:"conversation",selected:"Selected"},contact:{list:"contacts",item:"contact",selected:"selected"}}[u],m=function(t,n){var a=n.list,o=n.item,i=n.selected;return function(n,c,s){for(var u=c;u<s;u++)t[a][u][i]=n[o][i];e.set("numberElementChecked",r(t[a],i))}}(a,f);function g(t){var n=t.target,o=t.shiftKey,i=+n.getAttribute("data-index");if("INPUT"===n.nodeName&&/ptSelectConversation/.test(n.className)){var c=n.checked;a.$applyAsync((function(){var t=f.list,u=f.item,l=f.selected;if(a[t][i][l]=c,e.set("numberElementChecked",r(a[t],l)),o&&s){var d=Math.min(i,s.index),p=Math.max(i,s.index);m(s,d,p),n.checked=s[u][l]}e.set("showWelcome",!1),s=v()({index:i},u,a[t][i])}))}}d("dnd",(function(t,r){var o=r.type,i=r.data;"hook.dragstart"===o&&(n.number=i.before.number,n.ids=i.before.ids,e.set("numberElementChecked",1),We()(a[f.list],(function(e){e[f.selected]=!1})))}));var h=function(){_rAF((function(){a.$applyAsync((function(){var t=f.list,o=f.selected;We()(a[t],(function(t){n.ids&&(t[o]=n.ids.includes(t.ID)),1!==e.get("numberElementChecked")||n.number||(t[o]=!1)})),e.set("numberElementChecked",n.number||r(a[t],o)),delete n.number,delete n.ids}))}))};o.on("click",g),document.addEventListener("dragend",h),a.$on("$destroy",(function(){o.off("click",g),document.removeEventListener("dragend",h),p(),delete n.number,delete n.ids}))}}}gl.$inject=["AppModel","dispatchers"];var hl=gl;function bl(e,t,r){function a(e){var t=e.LabelIDs,n=void 0===t?[]:t,r=e.Labels,a=void 0===r?[]:r;return a.length?le()(a,{ID:s.rb.starred}):n.some((function(e){return e===s.rb.starred}))}return{scope:{model:"="},replace:!0,templateUrl:n("GZVi"),link:function(n,o,i){var c=e(["messageActions"]).dispatcher,s=i.ptStarType||t.getTypeList();function u(e){"A"===e.target.nodeName&&(e.preventDefault(),e.stopPropagation(),function(e){var t=e.model,n=e.type,o=a(t)?"unstar":"star";"conversation"===n&&r[o]([t.ID]),"message"===n&&c.messageActions(o,{ids:[t.ID]})}({model:n.model,type:s}))}n.isStarred=function(){return a(n.model)},o.on("click",u),n.$on("$destroy",(function(){o.off("click",u)}))}}}bl.$inject=["dispatchers","tools","actionConversation"];var yl=bl;function El(e){return{replace:!0,restrict:"E",template:'<div class="searchLimit-container"></div>',link:function(t,n){n[0].textContent=e.getString("Your search matched too many results. Please limit your search and try again.",null,"Inform the user that he reach the search limit")}}}El.$inject=["gettextCatalog"];var Sl=El;function Dl(e,t,n){return{restrict:"E",replace:!0,template:'<time class="time"></time>',link:function(r,a){var o=t(),i=o.on,c=o.unsubscribe;function s(){var t,o,i,c,s,u,l,d;a[0].textContent=(t=r.conversation,o=t.ID,i=t.Time,c=n.getTypeList(),s=n.currentLocation(),u="conversation"===c?e.getTime(o,s):i,l=moment.unix(u),d=l.isSame(moment(),"day")?"LT":"ll",l.format(d))}i("elements",(function(e,t){"refresh.time"===t.type&&s()})),s(),r.$on("$destroy",c)}}}Dl.$inject=["cache","dispatchers","tools"];var kl=Dl;function Al(e){var t=[],n=e().on;return n("elements",(function(e,n){var r=n.type,a=n.data,o=void 0===a?{}:a;"error"===r&&t.push(o)})),n("$stateChangeSuccess",(function(){t.length=0})),{init:angular.noop,last:function(){return t.length?Ai()(t):{}}}}Al.$inject=["dispatchers"];var Il=Al;function Cl(e,t){return function(){var n=e.currentMailbox(),r=e.currentLocation();return"search"!==n&&("label"!==n||t.contains(r,"folders"))}}Cl.$inject=["tools","labelsModel"];var wl=Cl;function Ol(e){var t={};return(0,e().on)("elements",(function(e,n){var r,a,o,i,c,s=n.type,u=n.data;"setLimit"===s&&(a=(r=void 0===u?{}:u).Limit,o=void 0===a?0:a,i=r.Total,c=void 0===i?0:i,t.limit=o,t.total=c)})),{init:angular.noop,isReached:function(){return t.total!==t.limit}}}Ol.$inject=["dispatchers"];var Ml=Ol;function Pl(e,t,n,r,a,i,s,u,l,d){var p=r(["composer.update"]).dispatcher,f=d((function(){return{TITLE:e.getString("Delete",null,"Title"),MESSAGE:e.getString("Are you sure? This cannot be undone.",null,"Info"),DRAFT_INFO:e.getString("The draft(s) selected is open in a composer, this action will close the composer and delete the message.",null,"Info"),TYPES:{message:function(t){return e.getPlural(t,"message","messages",{},"Type element")},conversation:function(t){return e.getPlural(t,"conversation","conversations",{},"Type element")}},success:function(t,n){return e.getString("{{total}} {{item}} removed",{total:t,item:n},"Remove element")}}}));function v(){var e=s.$current.name.replace(".element","");s.go(e,{id:""})}var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=(t.get("composerList")||[]).reduce((function(e,t){return e[t.ID]="ID",e[t.ConversationID]="ConversationID",e}),{}),a=e.reduce((function(e,t){return r[t]&&e.push({id:t,key:r[t]}),e}),[]);if((s.includes("secured.drafts.**")||s.includes("secured.allDrafts.**"))&&a.length){var o=n().reduce((function(e,t){return e.ConversationID[t.ConversationID]=t,e.ID[t.ID]=t,e}),{ConversationID:{},ID:{}});return{isDraftOpen:!0,drafts:a.map((function(e){var t=e.id,n=e.key;return o[n][t]})),message:"".concat(f.MESSAGE," <br><p><i>").concat(f.DRAFT_INFO,"</i></p>")}}return{message:f.MESSAGE}},g=function(){var e=c()(o.a.mark((function e(t,r,i){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("conversation"!==r){e.next=2;break}return e.abrupt("return",n.remove(t,i));case 2:return e.abrupt("return",a.destroy(t));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();return function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.getElementsSelected,a=n.idsSelected,s=n.getTypeSelected,d=a(),h=s(),b=m(d,r),y=b.message,E=b.isDraftOpen,S=b.drafts,D=void 0===S?[]:S,k=l.currentLocation();i.activate({params:{message:y,title:f.TITLE,cancel:i.deactivate,confirm:(e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.deactivate(),e.next=3,g(d,h,k);case 3:E&&D.forEach((function(e){p["composer.update"]("close.message",{message:e})})),u.success(f.success(d.length,f.TYPES[h](d.length))),t.set("showWelcome",!1),t.set("numberElementChecked",0),v();case 8:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})}})}}Pl.$inject=["gettextCatalog","AppModel","actionConversation","dispatchers","messageActions","confirmModal","$state","notification","tools","translator"];var xl=Pl;function Tl(e,t,n){var r=function(){return/^['"]$/.test(e.keyword)?"":e.keyword};return function(a){var o={Page:(~~e.page||1)-1};if(angular.isDefined(e.filter)&&(o.Unread=+("unread"===e.filter)),angular.isDefined(e.sort)){var i=e.sort,c="-"===i.charAt(0);!0===c&&(i=i.slice(1)),o.Sort=t("capitalize")(i),o.Desc=+c}return"search"===a?(o.AddressID=e.address,o.LabelID=e.label,o.Keyword=r(),o.Recipients=e.to,o.From=e.from,o.Subject=e.subject,o.Begin=e.begin,o.End=e.end,o.Attachments=e.attachments,o.AutoWildcard=angular.isDefined(e.wildcard)?e.wildcard:n.get().AutoWildcardSearch,o):"label"===a?(o.LabelID=e.label,o):(o.LabelID=s.rb[a],o)}}Tl.$inject=["$stateParams","$filter","mailSettingsModel"];var Ll=Tl,jl=n("/w9J"),Nl=n.n(jl);function $l(e,t,n,r){var a=e("contact"),o=["secured.sent","secured.allSent","secured.drafts","secured.allDrafts"];return{replace:!0,restrict:"E",template:'<span class="senders-name"></span>',link:function(e,i){var c=n(),s=c.on,u=c.unsubscribe,l=e.conversation,d=l.ID,p=!!l.ConversationID,f=p?"message.refresh":"refreshConversation",v=t.$current.name.replace(".element",""),m=p?Object(tr.n)(e.conversation):!o.includes(v),g=function(){var t=e.conversation,n=t.Sender,o=t.Senders,c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){return e.title.push(t.Address),e.content.push(Nl()(a(t,"Name"))),e}),{title:[],content:[]})}(m?p?[n]:void 0===o?[]:o:function(e,t){return t?e.Recipients:r.toList(e)}(e.conversation,p)),s=c.title,u=c.content;i[0].title=s.join(", "),i[0].textContent=u.join(", ")};s(f,(function(e,t){var n=t.type,r=t.data;"refresh"===n&&r.includes(d)&&g()})),g(),e.$on("$destroy",(function(){u()}))}}}$l.$inject=["$filter","$state","dispatchers","recipientsFormator"];var Rl=$l;var _l=function(){return{replace:!0,restrict:"E",templateUrl:n("oYf/")}},Ul=angular.module("proton.elements",[]).directive("statesElements",_l).directive("sendersName",Rl).factory("forgeRequestParameters",Ll).controller("ElementsController",Gu).directive("advancedFilterElement",zu).directive("countElementsSelected",Wu).directive("elementView",Ju).directive("elementsContainer",Zu).directive("elementsSelector",tl).directive("foldersElement",rl).directive("labelsElement",ol).directive("moveElement",il).directive("movedButton",sl).directive("movedSelect",ll).directive("navElements",pl).directive("ptSelectElement",fl).directive("ptSelectElements",ml).directive("ptSelectMultipleElements",hl).directive("ptStar",yl).directive("searchLimitReached",Sl).directive("timeElement",kl).factory("elementsError",Il).factory("canUndo",wl).factory("limitElementsModel",Ml).factory("removeElement",xl).name,Fl=n("MzkN");function Bl(e,t,r,a,o,i,c,s,u){return{replace:!0,restrict:"E",templateUrl:n("N0YN"),scope:{},link:function(n){var l=t(),d=l.on,p=l.unsubscribe;n.customFilters=null;var f=a.query().then((function(e){n.$applyAsync((function(){n.customFilters=e}))}));r.track(f),d("changeCustomFilterStatus",(function(e,t){var r=t.data,a=r.id,o=r.status,i=le()(n.customFilters,{ID:a});i&&function(e,t){if(t)return void n.enableCustomFilter(e);n.disableCustomFilter(e)}(i,o)}));var v=Object(Fl.a)({scrollableSelector:"#pm_settings .settings"}),m=v.dragStart,g=v.dragMove,h=v.dragEnd;n.filterDragControlListeners={containment:".pm_sort",accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id},dragStart:function(e){m(e),n.itemMoved=!0},dragMove:g,dragEnd:function(){h(),n.itemMoved=!1},orderChanged:function(){var e=k()(n.customFilters,"ID");We()(n.customFilters,(function(e,t){e.Priority=t+1})),r.track(a.order({FilterIDs:e}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?{}:t;return i.success(o.getString("Order saved",null,"Info")),n})))}},n.$on("$destroy",p),d("filter",(function(e,t){var r=t.type,a=t.data,o=a.ID,i=a.Filter;if(!n.itemMoved){if("delete"===r){var c=z()(n.customFilters,{ID:o});-1!==c&&n.customFilters.splice(c,1)}if("create"===r||"update"===r){var s=z()(n.customFilters,{ID:o});-1===s?n.customFilters.push(i):n.customFilters[s]=i}}})),n.addCustomFilter=function(){var t=J()(n.customFilters,{Status:1});if(!e.hasPaidMail()&&1===t.length)return i.info(o.getString('Free ProtonMail accounts are limited to 1 custom filter. Please <a href="/dashboard">upgrade</a> to get unlimited filters.',null,"Info"));c.activate({params:{mode:"simple",close:function(){c.deactivate()}}})},n.addSieveFilter=function(){var t=J()(n.customFilters,{Status:1});if(!e.hasPaidMail()&&1===t.length)return i.info(o.getString('Free ProtonMail accounts are limited to 1 custom filter. Please <a href="/dashboard">upgrade</a> to get unlimited filters.',null,"Info"));c.activate({params:{mode:"complex",close:function(){c.deactivate()}}})},n.isSimple=function(e){return e.Simple&&Object.keys(e.Simple).length},n.editCustomFilter=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c.activate({params:{mode:!t&&n.isSimple(e)?"simple":"complex",filter:e,close:function(){c.deactivate()}}})},n.deleteCustomFilter=function(e){var t=o.getString("Delete Filter",null,"Title"),n=o.getString("Are you sure you want to delete this filter?",null,"Info");s.activate({params:{title:t,message:n,confirm:function(){var t=a.delete(e).then(u.call).then((function(){i.success(o.getString("Custom filter deleted",null,"Info"))}));r.track(t),s.deactivate()},cancel:function(){s.deactivate()}}})};var b=function(e,t){return function(n){var a=e(n).then((function(){i.success(o.getString("Status updated",null,"Info"))})).catch((function(e){throw n.Status=t,e}));return r.track(a)}};n.enableCustomFilter=b(a.enable,!1),n.disableCustomFilter=b(a.disable,!0)}}}Bl.$inject=["authentication","dispatchers","networkActivityTracker","Filter","gettextCatalog","notification","filterModal","confirmModal","eventManager"];var Kl=Bl;function Gl(e){return{replace:!0,restrict:"E",templateUrl:n("s7Pn"),scope:{},link:function(t,n,r){var a=r.targetList,o=function(){e.activate({params:{type:a,close:function(){e.deactivate()}}})};n.on("click",o),t.$on("$destroy",(function(){n.off("click",o)}))}}}Gl.$inject=["filterAddressModal"];var Vl=Gl;function ql(e,t,r,a){var o=a((function(){return{whitelist:t.getString("Whitelist",null,"Info"),blacklist:t.getString("Blacklist",null,"Info"),add:t.getString("Add",null,"Action")}})),i="emailBlockList-list",c="emailBlockList-btn-switch",s="emailBlockList-btn-delete";return{replace:!0,restrict:"E",templateUrl:n("JJx9"),scope:{listType:"@"},link:function(n,a,u){var l=u.switchTo,d=e(["tooltip"]),p=d.dispatcher,f=d.on,v=d.unsubscribe,m=r.list(r.getType(n.listType)),g=a[0].querySelector(".".concat(i)),h=a[0].querySelector(".alert-info"),b=o[n.listType];h.innerHTML=function(e){var n="<b>".concat(o.add,"</b>");return t.getString("No emails in the {{ filterName }}, click {{ add }} to add addresses to the {{ filterName }}",{filterName:e,add:n},"Info")}(b),n.entries=[],n.filterName=b,m.get().then((function(e){n.$applyAsync((function(){return n.entries=e}))})),f("filters",(function(){m.get().then((function(e){n.$applyAsync((function(){n.entries=ri()(e,"ID"),p.tooltip("hideAll")}))}))}));var y=Hr()((function(){if(!m.isLoading()&&!m.isEnding()){var e=n.entries.length,t=e-50;(g.scrollTop+g.clientHeight)/g.scrollHeight>t/e&&m.get().then((function(e){n.$applyAsync((function(){n.entries=ri()(n.entries.concat(e),"ID")}))}))}}),100),E=function(e){var t=e.target;"BUTTON"===t.nodeName&&(t.classList.contains(c)&&r.move(t.dataset.entryId,r.getType(l)),t.classList.contains(s)&&r.destroy(t.dataset.entryId))};g.addEventListener("scroll",y),a[0].addEventListener("click",E),n.$on("$destroy",(function(){g.removeEventListener("scroll",y),a[0].removeEventListener("click",E),v(),r.clear()}))}}}ql.$inject=["dispatchers","gettextCatalog","spamListModel","translator"];var Hl=ql;var zl=function(){return{replace:!0,restrict:"E",templateUrl:n("I+z7"),scope:{}}},Yl=n("noZS"),Wl=n.n(Yl);var Xl=function(){return{replace:!0,restrict:"E",templateUrl:n("9r/h"),scope:{sieve:"="},link:{pre:function(e,t){var n=[];e.codeMirrorOptions={lineWrapping:!0,lineNumbers:!0,readOnly:!1,fixedGutter:!1,lint:{delay:800},gutters:["CodeMirror-lint-markers"],autoRefresh:!0,mode:"sieve"};var r=null,a=Wl()({"'":["‹","›","‚","‘","‛","’","❛","❜","❮","❯"],'"':["«","»","„","“","‟","”","❝","❞","〝","〞","〟","＂"]},(function(e){return new RegExp("["+e.join("")+"]","g")}));e.codeMirrorLoaded=function(e){(r=e).on("change",(function(){var e=r.getValue();if(Ze()(a).some((function(t){return t.exec(e)}))){var t=bt()(xo()(a),(function(e,t){return e.replace(a[t],t)}),e),n=r.getCursor();r.setValue(t),r.setCursor(n)}}))};var o=t.find("label");o.on("click.focusSieve",(function(){null!==r&&r.focus()})),n.push((function(){return o.off("click.focusSieve")})),e.$on("$destroy",(function(){We()(n,(function(e){return e()})),n.length=0}))}}}};function Jl(e){return{replace:!0,restrict:"E",templateUrl:n("0L42"),scope:{},link:function(t,n){var r=n.find("input"),a=er()((function(t){var n=t.target;e.search(n.value.trim())}),500);r.on("input",a),t.$on("$destroy",(function(){r.off("input",a)}))}}}Jl.$inject=["spamListModel"];var Ql=Jl;var Zl=function(){return{replace:!0,restrict:"E",templateUrl:n("+hKR")}},ed={2:'require ["include", "environment", "variables", "relational", "comparator-i;ascii-numeric", "spamtest"];\n\n# Generated: Do not run this script on spam messages\nif allof (environment :matches "vnd.proton.spam-threshold" "*", \nspamtest :value "ge" :comparator "i;ascii-numeric" "${1}")\n{\n    return;\n}\n\n\n'};function td(e,t,r,a,i,u,l,d,p,f,v,m,g,h){var b=h((function(){return{TYPES:[{label:r.getString("Select",null,"Filter modal type"),value:"select"},{label:r.getString("the subject",null,"Filter modal type"),value:"subject"},{label:r.getString("the sender",null,"Filter modal type"),value:"sender"},{label:r.getString("the recipient",null,"Filter modal type"),value:"recipient"},{label:r.getString("the attachments",null,"Filter modal type"),value:"attachments"}],COMPARATORS:[{label:r.getString("contains",null,"Condition for custom filter"),value:"contains"},{label:r.getString("is exactly",null,"Condition for custom filter"),value:"is"},{label:r.getString("begins with",null,"Condition for custom filter"),value:"starts"},{label:r.getString("ends with",null,"Condition for custom filter"),value:"ends"},{label:r.getString("matches",null,"Condition for custom filter"),value:"matches"},{label:r.getString("does not contain",null,"Condition for custom filter"),value:"!contains"},{label:r.getString("is not",null,"Condition for custom filter"),value:"!is"},{label:r.getString("does not begin with",null,"Condition for custom filter"),value:"!starts"},{label:r.getString("does not end with",null,"Condition for custom filter"),value:"!ends"},{label:r.getString("does not match",null,"Condition for custom filter"),value:"!matches"}],OPERATORS:[{label:r.getString("AND",null,"Filter modal operators"),value:"all"},{label:r.getString("OR",null,"Filter modal operators"),value:"any"}],ERROR_PATTERN:r.getString("Text or pattern already included",null,"Error"),FILTER_UPDATED_SUCCESS:r.getString("Filter updated",null,"Notification"),FILTER_CREATED_SUCCESS:r.getString("Filter created",null,"Notification")}})),y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.create,n=void 0===t?[]:t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.IS_LABEL;return angular.copy(n).filter((function(e){return e.Exclusive===r}))};return t({controllerAs:"ctrl",templateUrl:n("OLJ3"),controller:["params","$scope",function(t,n){var r=this;v.init();var h=f.get("labels"),E=f.get("folders"),S=this,D=angular.copy(t.filter);function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;p.activate({params:{label:{Exclusive:e},close:function(){p.deactivate()}}})}function A(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).Simple,t=(void 0===e?{}:e).Conditions,n=(void 0===t?[]:t).map((function(e){var t=e.Type,n=void 0===t?{}:t,r=e.Comparator,a=void 0===r?{}:r,o=e.Values,i=void 0===o?[]:o,c=e.value,s=void 0===c?"":c;return{Values:s?i.concat([s]):i,value:s?"":s,Type:le()(S.types,{value:n.value}),Comparator:le()(S.comparators,{value:a.value})}}));return 0===n.length&&n.push({Values:[],value:"",Type:S.types[0],Comparator:S.comparators[0]}),n}S.isPaid=g().isPaid,S.hasLabels=!1,S.hasMove=!1,S.hasMark=!1,S.hasVacation=!1,S.folders=E,S.types=angular.copy(b.TYPES),S.comparators=angular.copy(b.COMPARATORS),S.operators=angular.copy(b.OPERATORS);var I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=f.get("folders").reduce((function(e,t){return e[t.Name]=t,e[t.Path]=t,e}),{}),n=le()(e,(function(e){return s.rb[e]||t[e]}));return n||""};function C(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).Simple,t=(void 0===e?{}:e).Actions||{},n=t.FileInto,r=void 0===n?[]:n,a=t.Mark,o=void 0===a?{Read:!1,Starred:!1}:a,i=t.Vacation,c=void 0===i?"":i,s=I(r),u={Labels:h.map((function(e){return e.Selected=-1!==r.indexOf(e.Path)||-1!==r.indexOf(e.Name),e})),Move:s||"inbox",Vacation:c,Mark:o};return S.hasMove=!!s,S.hasVacation=!!c,S.hasMark=o.Read||o.Starred,S.hasLabels=!!J()(u.Labels,{Selected:!0}).length,u}function w(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).Simple,t=((void 0===e?{}:e).Operator||{}).value,n=void 0===t?"all":t;return le()(S.operators,{value:n})}function O(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).ID;return void 0===e?"":e}function M(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).Name;return void 0===e?"":e}function P(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).Status;return void 0===e?1:e}var x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Version,n=void 0===t?s.W:t;return n};S.addLabel=function(){return k(0)},S.addFolder=function(){return k(1)},S.initialization=function(){var r=l(),a=r.on,o=r.unsubscribe;if(S.filter={ID:O(D),Name:M(D),Status:P(D),Version:x(D)},"simple"===t.mode&&(S.mode="simple",S.filter.Simple={Operator:w(D),Conditions:A(D),Actions:C(D)}),"complex"===t.mode){S.mode="complex";var i=ed[S.filter.Version]||"";S.filter.Sieve=D?D.Sieve:i}angular.isObject(S.filter.Simple)&&(a("labelsModel",(function(e,t){var r=t.type,a=t.data;"cache.update"===r&&n.$applyAsync((function(){var e=y(a),t=y(a,f.IS_FOLDER);S.filter.Simple.Actions.Labels=S.filter.Simple.Actions.Labels.concat(e),S.folders=S.folders.concat(t),t.length&&(S.filter.Simple.Actions.Move=Ai()(S.folders).Name)}))})),a("autocompleteEmail",(function(e,t){var n=t.type,r=t.data;"input.blur"===n&&"filter-modal-add-condition-input"===r.type&&S.addValue(S.filter.Simple.Conditions[Number(r.eventData)])})));var c=function(){return angular.element("#filterName").blur()};n.$on("$destroy",(function(){angular.element('[ng-click="ctrl.cancel()"]').off("mouseover",c),o()})),e((function(){angular.element("#filterName").focus(),angular.element('[ng-click="ctrl.cancel()"]').on("mouseover",c)}),100,!1)},S.onChangeAttachements=function(e,t){e.Comparator=le()(S.comparators,{value:t})},S.displaySeparator=function(){if(S.filter.Simple){var e=S.filter.Simple.Conditions;return e.length>0&&"select"!==e[0].Type.value}return!1},S.addCondition=function(){S.filter.Simple.Conditions.push({Type:xs()(S.types),Comparator:xs()(S.comparators),Values:[],value:""})},S.addValue=function(e,t){t&&t.preventDefault(),-1===e.Values.indexOf(e.value)?e.value&&(e.Values.push(e.value),e.value=""):u.error(b.ERROR_PATTERN)},S.removeCondition=function(e){var t=S.filter.Simple.Conditions.indexOf(e);S.filter.Simple.Conditions.splice(t,1)};var T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.FileInto,n=void 0===t?[]:t,r=e.Move,a=void 0===r?"":r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return ga()([a].filter(Boolean).concat(n,o))},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(){u.success(e),d.call(),t.close()}},r=function(e){var n=e.data;throw(void 0===n?{}:n).Code===Da.a.FILTER_CREATE_TOO_MANY_ACTIVE&&(d.call(),t.close()),e};return e.ID?a.update(e).then(n(b.FILTER_UPDATED_SUCCESS)).catch(r):a.create(e).then(n(b.FILTER_CREATED_SUCCESS)).catch(r)};S.resetValidity=function(){r.validator=[]},S.save=c()(o.a.mark((function a(){var c,s,u,l,d,p;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,m(r);case 2:if(c=a.sent,s=c.valid,u=c.errors,n.$applyAsync((function(){r.validator=u})),s){a.next=8;break}return a.abrupt("return",console.log(u));case 8:if("complex"!==t.mode){a.next=11;break}return e((function(){var e=angular.copy(S.filter);delete e.Simple,delete e.Tree,i.track(L(e))}),100,!1),a.abrupt("return");case 11:l=angular.copy(S.filter),Object.keys(S.filter.Simple||{}).length>0&&(!1===S.hasMove&&(l.Simple.Actions.Move=""),!1===S.hasMark&&(l.Simple.Actions.Mark={Read:!1,Starred:!1}),!1===S.hasVacation&&(l.Simple.Actions.Vacation=""),!0===S.hasLabels?(d=J()(l.Simple.Actions.Labels,(function(e){return!0===e.Selected})).map((function(e){return e.Path})),p=T(l.Simple.Actions,d),l.Simple.Actions.FileInto=p,delete l.Simple.Actions.Labels):delete l.Simple.Actions.Labels,l.Simple.Actions.FileInto=T(l.Simple.Actions),delete l.Simple.Actions.Move),i.track(L(l));case 14:case"end":return a.stop()}}),a)}))),S.initialization()}]})}td.$inject=["$timeout","pmModal","gettextCatalog","Filter","networkActivityTracker","notification","dispatchers","eventManager","labelModal","labelsModel","sieveLint","filterValidator","userType","translator"];var nd=td;function rd(e,t,n,r,a){var o=a((function(){return{ADD_SUCCESS:t.getString("Spam Filter Added",null,"Filters"),UPDATE_SUCCESS:t.getString("Spam Filter Updated",null,"Filters"),DELETE_SUCCESS:t.getString("Spam Filter Deleted",null,"Filters")}}));return{get:function(e){var t=n.get(e).then((function(e){var t=e.data;return(void 0===t?{}:t).IncomingDefaults}));return r.track(t),t},update:function(t,a){var i=n.update({ID:t,Location:a}).then((function(t){var n=t.data,r=void 0===n?{}:n;return e.success(o.UPDATE_SUCCESS),r.IncomingDefault}));return r.track(i),i},remove:function(t){var a=n.delete({IDs:[t]}).then((function(t){var n=t.data,r=void 0===n?{}:n;return e.success(o.DELETE_SUCCESS),r.IncomingDefault}));return r.track(a),a},create:function(t){var a=n.add(t).then((function(t){var n=t.data,r=void 0===n?{}:n;return e.success(o.ADD_SUCCESS),r.IncomingDefault}));return r.track(a),a}}}rd.$inject=["notification","gettextCatalog","IncomingDefault","networkActivityTracker","translator"];var ad=rd;sd.$inject=["dispatchers","incomingModel","notification","gettextCatalog","translator"];var od=+s.rb.spam,id=+s.rb.inbox,cd=100;function sd(e,t,n,r,a){var i=a((function(){return{ADD_SUCCESS:r.getString("Email added",null,"Success notification"),REMOVE_SUCCESS:r.getString("Email removed",null,"Success notification")}})),s=f(),u=e(["filters"]),l=u.dispatcher,d=u.on,p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l.filters(e,t)};function f(){var e;return e={MAP:Object.create(null)},v()(e,od,{list:[],page:0}),v()(e,id,{list:[],page:0}),e}var m=function(e){if(e)return s[id].ending&&(s[id].page=0,s[id].ending=!1),s[od].ending&&(s[od].page=0,s[od].ending=!1),s[e].page=0;s[id].page=0,s[od].page=0,s[id].ending=!1,s[od].ending=!1},g=function(e){var r=s[e],a=function(e){return r.page+=e},u=function(e){return r.loading=e},l=function(){var n=c()(o.a.mark((function n(a){var i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.get(Ge()({Location:e},a));case 2:return i=n.sent,!r.ending&&(r.list=i),n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),d=function(){var t=c()(o.a.mark((function t(){var n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.page,!(r.list.length&&r.list.length>=(n+2)*cd)){t.next=5;break}return r.ending=r.list.length<cd&&!r.invalidate,delete r.invalidate,t.abrupt("return",angular.copy(r.list));case 5:return a(1),u(!0),t.next=9,l({Location:e,Page:n,Keyword:s.query,PageSize:cd});case 9:return i=t.sent,h(),u(!1),r.ending=i.length<cd&&!r.invalidate,delete r.invalidate,t.abrupt("return",i);case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return{extendPage:a,setLoader:u,loadList:l,get:d,add:function(){var a=c()(o.a.mark((function a(c){var u;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.create({Email:c,Location:e});case 2:u=a.sent,r.list.unshift(u),s.MAP[u.ID]=u,m(u.Location),n.success(i.ADD_SUCCESS),A();case 8:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),isLoading:function(){return!!r.loading},isEnding:function(){return!!r.ending}}};function h(e){e&&(s.MAP=Object.create(null));var t=s[od].list.concat(s[id].list).reduce((function(e,t){return e[t.ID]=t,e}),Object.create(null));Ge()(s.MAP,t)}function b(){return y.apply(this,arguments)}function y(){return(y=c()(o.a.mark((function e(){var t,n,r,a,i,c=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},n=c.length>1?c[1]:void 0,r={Page:0,PageSize:cd},a=g(id),i=g(od),a.setLoader(!0),i.setLoader(!0),e.next=9,Promise.all([a.loadList(Ge()({},r,t)),i.loadList(Ge()({},r,t))]);case 9:a.setLoader(!1),i.setLoader(!1),h(),!n&&m(),!n&&p("change",{type:"load"});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(){var e=c()(o.a.mark((function e(n,r){var a,i,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.update(n,r);case 3:a=e.sent,i=s.MAP[n],c=z()(s[i.Location].list,(function(e){return e.ID===i.ID})),s[i.Location].list.splice(c,1),s[r].list.unshift(a),s.MAP[i.ID]=a,s[i.Location].invalidate=!s[i.Location].ending,m(),A(),e.next=19;break;case 14:throw e.prev=14,e.t0=e.catch(0),u=e.t0.data,(void 0===u?{}:u).Code===Da.a.INCOMING_DEFAULT_UPDATE_NOT_EXIST&&(delete s.MAP[n],b({Search:s.query})),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=c()(o.a.mark((function e(r){var a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.remove(r);case 2:a=s.MAP[r],c=z()(s[a.Location].list,(function(e){return e.ID===a.ID})),s[a.Location].list.splice(c,1),s[a.Location].invalidate=!s[a.Location].ending,delete s.MAP[r],m(a.Location),n.success(i.REMOVE_SUCCESS),A();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function D(e){return k.apply(this,arguments)}function k(){return(k=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.query=t,m(),e.next=4,b({Keyword:t},!0);case 4:p("search");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){if(s.query)return D(s.query);p("change",{type:"refresh"})}var I=function(){return s=f()};return d("logout",(function(){I()})),{list:g,load:b,move:E,destroy:S,search:D,refresh:A,clear:I,getType:function(e){return"whitelist"===e?id:od}}}var ud=sd;function ld(e,t){return e({controllerAs:"ctrl",templateUrl:n("MV75"),controller:["params",function(e){var n=this;this.filter={Email:""},this.cancel=e.close,this.type=e.type,this.create=function(){t.list(t.getType(e.type)).add(n.filter.Email),e.close()},setTimeout((function(){angular.element("#emailAddress").focus()}),100)}]})}ld.$inject=["pmModal","spamListModel"];var dd=ld;function pd(e){var t=function(){var t=c()(o.a.mark((function t(n){var r,a,i,c,u=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:s.W,t.next=3,e.check({Version:r,Sieve:n});case 3:return a=t.sent,i=a.data,c=void 0===i?{}:i,t.abrupt("return",c.Issues||[]);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{init:function(){window.CodeMirror.registerHelper("lint","sieve",(function(e){if(""===e.trim()){var n=e.split("\n")[0];return[{message:"A sieve script cannot be empty",severity:"error",from:window.CodeMirror.Pos(0,0),to:window.CodeMirror.Pos(0,n.length)}]}return t(e)}))},run:t}}pd.$inject=["Filter"];var fd=pd,vd=n("Y+p1"),md=n.n(vd),gd=n("jsI+");var hd=function(){return{computeFromTree:function(e){var t=gd.a.fromTree(e.Tree),n=gd.a.toTree(t,e.Version).filter((function(e){return"Comment"!==e.Type})),r=e.Tree.filter((function(e){return"Comment"!==e.Type}));return md()(n,r)&&t},computeTree:function(e){var t=e.Simple,n=e.Version;return t&&gd.a.toTree(t,n)}}};function bd(e){function t(){return(t=c()(o.a.mark((function t(n){var r,a,i,c,s,u,l,d,p,f,v,m,g;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.filter,a=void 0===r?{}:r,i=n.hasLabels,c=n.hasMove,s=n.hasMark,u=n.hasVacation,l=[],d=a.Name,(void 0===d?"":d).length||l.push("name"),Object.keys(a.Simple||{}).length&&(p=bt()(a.Simple.Conditions,(function(e,t){var n=t.Type.value;return["subject","sender","recipient"].includes(n)&&(e.pass=e.pass&&!!t.Values.length),"attachments"===n&&e.attachmentsCondition++,e}),{attachmentsCondition:0,pass:!0}),f=p.attachmentsCondition,v=p.pass,!(v&&f<=1)&&l.push("conditions"),!(i||c||s||u)&&l.push("noactions"),m=a.Simple.Actions,i&&!_r()(m.Labels,{Selected:!0})&&l.push("actions:labels"),s&&!!(!m.Mark.Starred&&!m.Mark.Read)&&l.push("actions:mark"),c&&!!!m.Move&&l.push("actions:move"),u&&!!!m.Vacation&&l.push("actions:vacation")),!(g=a.Sieve||"")){t.next=11;break}return t.next=9,e.run(g);case 9:t.sent.length&&l.push("sieve");case 11:return t.abrupt("return",{valid:!l.length,errors:l});case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return function(e){return t.apply(this,arguments)}}bd.$inject=["sieveLint"];var yd=bd,Ed=angular.module("proton.filter",["proton.utils"]).factory("simpleFilter",hd).factory("filterValidator",yd).directive("customFilterList",Kl).directive("emailBlockButton",Vl).directive("emailBlockList",Hl).directive("filterView",zl).directive("sieveLabelInput",Xl).directive("spamListSearch",Ql).directive("spamLists",Zl).factory("filterModal",nd).factory("incomingModel",ad).factory("spamListModel",ud).factory("filterAddressModal",dd).factory("sieveLint",fd).name;function Sd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sd(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sd(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kd(e,t){var r=e(["dropdown","createLabel","messageActions"]).dispatcher;return{replace:!0,restrict:"E",templateUrl:n("wr/6"),scope:{name:"=labelName",message:"="},link:function(e,n){var a=function(){t.activate({params:{label:{Name:e.name,Exclusive:0},close:function(n){t.deactivate(),n&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e)return r.messageActions("label",{messages:[e],labels:[Dd({},t,{Selected:!0})]}),void r.dropdown("close");r.createLabel("new.label",{label:t})}(e.message,n)}}})};n.on("click",a),e.$on("$destroy",(function(){n.off("click",a)}))}}}kd.$inject=["dispatchers","labelModal"];var Ad=kd;function Id(e,t,r,a,o,i){var c=r(["dropdown","messageActions"]).dispatcher,u=[{Name:i.getString("Inbox",null,"Label"),ID:s.rb.inbox,className:"fa-inbox"},{Name:i.getString("Archive",null,"Label"),ID:s.rb.archive,className:"fa-archive"},{Name:i.getString("Spam",null,"Label"),ID:s.rb.spam,className:"fa-ban"},{Name:i.getString("Trash",null,"Label"),ID:s.rb.trash,className:"fa-trash-o"}],l=function(){return c.dropdown("close")};return{restrict:"E",templateUrl:n("8Fsi"),replace:!0,scope:{getElements:"=elements"},link:function(n,r){var i=angular.element(r).closest(".pm_buttons").find(".open-folder"),s=r[0].querySelector(".dropdown-folder-search-input");function d(){var e=t.get("folders").map((function(e){return e.className="fa-folder",e}));n.$applyAsync((function(){n.labels=e.concat(u)}));var r=setTimeout((function(){return s.focus(),clearTimeout(r)}),100)}function p(t){"BUTTON"===t.target.tagName&&(t.target.classList.contains("dropdown-folder-scrollbox-group-item-button")&&n.$applyAsync((function(){var r=t.target.getAttribute("data-folder-id"),o=n.getElements(),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return!!e.length&&(void 0!==e[0].ConversationID?"message":"conversation")}(o);e.set("numberElementChecked",0),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=e.map((function(e){return e.ID}));"conversation"===t?a.move(r,n):"message"===t&&c.messageActions("move",{ids:r,labelID:n})}(o,i,r),l()})),t.target.classList.contains("dropdown-folder-create-button")&&o.activate({params:{label:{Name:n.searchValue,Exclusive:1},close:function(e){o.deactivate(),e&&d()}}}))}i.on("click",d),r.on("click",p),n.color=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Color,n=void 0===t?"inherit":t;return{color:n}},n.$on("$destroy",(function(){i.off("click",d),r.off("click",p)}))}}}Id.$inject=["AppModel","labelsModel","dispatchers","actionConversation","labelModal","gettextCatalog"];var Cd=Id;function wd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Od(e,t,r,a,o,i,c){var s=c((function(){return{LABELS_SAVED:i.getString("Labels Saved",null,"dropdown label"),LABEL_SAVED:i.getString("Label Saved",null,"dropdown label")}}));return{restrict:"E",templateUrl:n("uwQ0"),replace:!0,scope:{getMessages:"=messages",saveLabels:"=save",message:"="},link:function(n,i){var c=r(["dropdown"]),u=c.dispatcher,l=c.on,d=c.unsubscribe,p=function(){return u.dropdown("close")},f=angular.element(i).closest(".pm_buttons").find(".open-label"),m=angular.element(i[0].querySelector(".dropdown-label-search-input")),g=function(){n.$applyAsync((function(){if(angular.isFunction(n.getMessages)||angular.isFunction(n.saveLabels)){var t=n.getMessages(),r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return bt()(e,(function(e,t){var n=t.LabelIDs,r=void 0===n?[]:n,a=t.Labels,o=void 0===a?[]:a;return o.length?(o.forEach((function(t){var n=t.ID;return e[n]?e[n]++:e[n]=1})),e):(r.forEach((function(t){return e[t]?e[t]++:e[t]=1})),e)}),{})}(t);n.labelName="",n.labels=a.get("labels"),n.alsoArchive=!1,n.labels.forEach((function(e){var n=r[e.ID]||0;n>0&&n<t.length?e.Selected=null:e.Selected=n>0})),e((function(){return m.focus()}),100,!1)}}))},h=function(e){e.stopPropagation(),n.$applyAsync((function(){t.set("numberElementChecked",0),n.saveLabels(n.labels,n.alsoArchive),p(),o.success(s.LABELS_SAVED)}))},b=function(e){if("I"===e.target.nodeName){var t=e.target.getAttribute("data-label-id");t&&n.$applyAsync((function(){le()(n.labels,{ID:t}).Selected=!0,n.saveLabels(n.labels,n.alsoArchive),p(),o.success(s.LABEL_SAVED)}))}};l("createLabel",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"new.label"===r&&n.labels&&n.labels.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wd(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wd(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o.label,{Selected:!0}))})),i.on("submit",h),i.on("click",b),f.on("click",g),n.color=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Color,n=void 0===t?"inherit":t;return{color:n}},n.$on("$destroy",(function(){f.off("click",g),i.off("submit",h),i.off("click",b),d()}))}}}Od.$inject=["$timeout","AppModel","dispatchers","labelsModel","notification","gettextCatalog","translator"];var Md=Od;function Pd(e,t){var n=e(["labelsModel"]),r=n.dispatcher,a=n.on,o=t((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.labelsModel(e,t)}));return a("AppModel",(function(e,t){var n=t.type,r=t.data;"loggedIn"===n&&!(void 0===r?{}:r).value&&o.set()})),o}Pd.$inject=["dispatchers","labelCache"];var xd=Pd;function Td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ld(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Td(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Td(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jd(e,t,r,a,o,i,c,s){var u=s((function(){return{EDIT_FOLDER:t.getString("Edit folder",null,"Title"),EDIT_LABEL:t.getString("Edit label",null,"Title"),CREATE_NEW_FOLDER:t.getString("Create new folder",null,"Title"),CREATE_NEW_LABEL:t.getString("Create new label",null,"Title"),FOLDER_UPDATED:t.getString("Folder updated",null,"Label modal"),LABEL_UPDATED:t.getString("Label updated",null,"Label modal"),FOLDER_CREATED:t.getString("Folder created",null,"Label modal"),LABEL_CREATED:t.getString("Label created",null,"Label modal"),ERROR_FOLDER_NAME:t.getString("Invalid folder name",null,"Error label modal"),ERROR_LABEL_NAME:t.getString("Invalid label name",null,"Error label modal")}}));return e({controllerAs:"ctrl",templateUrl:n("Sms+"),controller:["params",function(e){var t=this,n=e.label,s=n.ID,l=n.Name,d=void 0===l?"":l,p=n.Color,f=void 0===p?"":p,v=n.Exclusive,m=void 0===v?0:v,g=function(e){var t=e.ID,n=e.Exclusive,r=void 0===n?0:n;return t?r?u.FOLDER_UPDATED:u.LABEL_UPDATED:r?u.FOLDER_CREATED:u.LABEL_CREATED}(e.label);this.ID=s,this.exclusive=m,this.title=function(e){var t=e.ID,n=e.Exclusive,r=void 0===n?0:n;return t?r?u.EDIT_FOLDER:u.EDIT_LABEL:r?u.CREATE_NEW_FOLDER:u.CREATE_NEW_LABEL}(e.label),this.name=d||"",this.notify=function(e){var t=e.Exclusive,n=void 0===t?0:t,r=e.Notify;return angular.isDefined(r)?!!r:!!n}(e.label),this.color=f,this.create=function(n){if(!n.$invalid){var l,d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ld({},e,{Name:c.input(e.Name),Color:c.input(e.Color)})}({ID:s,Exclusive:m,Name:t.name,Color:t.color,Notify:+!!t.notify});if(!d.Name)return t.name=d.Name,i.error(void 0!==(l=d.Exclusive)&&l?u.ERROR_FOLDER_NAME:u.ERROR_LABEL_NAME);var p=function(e){var t=e.ID,n=e.Name,r=void 0===n?"":n,i=e.Color,c=void 0===i?"":i,s=e.Display,u=void 0===s?1:s,l=e.Exclusive,d=void 0===l?0:l,p=e.Notify,f=void 0===p?0:p;return o[t?"update":"create"]({ID:t,Name:r,Color:c,Display:u,Exclusive:d,Notify:f}).then((function(e){return a.call().then((function(){return e}))}))}(d).then((function(t){i.success(g),(e.onSuccess||angular.noop)(t),e.close(t)}));r.track(p)}},setTimeout((function(){angular.element("#labelName").focus()}),100,!1)}]})}jd.$inject=["pmModal","gettextCatalog","networkActivityTracker","eventManager","Label","notification","sanitize","translator"];var Nd=jd;var $d=function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,r){r.$validators.validLabel=function(e){return function(t){return e.$error.validLabel=!/<|>/.test(t||""),e.$error.validLabel}}(r)}}},Rd=n("D0BC"),_d=n.n(Rd);var Ud=function(){return{scope:{color:"="},replace:!0,restrict:"E",templateUrl:n("XvzN"),link:function(e,t){var n=_d()(0,s.nb.length-1);e.color=e.color||s.nb[n],e.colors=s.nb;var r=function(t){var n=t.target;"INPUT"===n.nodeName&&e.$applyAsync((function(){return e.color=n.value}))};t.on("click",r),e.$applyAsync((function(){t[0].querySelector('[value="'.concat(e.color,'"]')).checked=!0})),e.$on("$destroy",(function(){t.off("click",r)}))}}},Fd=n("pEW7");function Bd(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.ob.MESSAGE,a=function(){return{all:Object.create(null),labels:Object.create(null),folders:Object.create(null),names:Object.create(null)}},i=0,u=1,l={labels:[],folders:[],all:[],map:a()};function d(t){return t.Name=e.input(t.Name),t.Color=e.input(t.Color),t.notify=!!t.Notify,t}var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Be()(Re()(d),ta()("Order"))(e)},f=function(){l.map=bt()(l.all,(function(e,t){var n=0===t.Exclusive?"labels":"folders";return e.all[t.ID]=t,e[n][t.ID]=t,e.names[t.Name]=t,e}),a())},v=function(e){return Be()(Ue()({Exclusive:e}),ta()("Order"))(l.all)},m=function(){l.labels=v(i)},g=function(){l.folders=v(u)},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];l.all=p(e),f(),m(),g()},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return angular.copy(l[e])},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";return l.map[t][e]},E=function(e){return l.map.names[e]},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";return!!y(e,t)},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return Object.keys(l.map[e]||{})},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Object(Fd.a)(l.all,e,"Label"),r=t.collection,a=t.todo;l.all=p(r),f(),m(),g(),n("cache.update",a)},A=function(){f(),m(),g(),n("cache.refresh")},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Name";return l.all=Ia()(l.all,(function(t){var n=t[e];return"number"==typeof n?n:(n||"").toLowerCase()})),n("cache.update"),l.all},C=function(){var e=c()(o.a.mark((function e(){var a,i,c=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>0&&void 0!==c[0]&&c[0],e.next=3,t.query({Type:r});case 3:return i=e.sent,h(i),a&&n("cache.refresh"),n("cache.load"),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];l.all=l.all.filter((function(t){var n=t.ID;return!e.includes(n)})),n("cache.remove",e),A()};return{load:C,get:b,set:h,contains:S,sort:I,sync:k,read:y,readName:E,ids:D,refresh:A,remove:w,IS_LABEL:i,IS_FOLDER:u}}}Bd.$inject=["sanitize","Label"];var Kd=Bd;function Gd(e,t,n,r,a,i,u,l){var d=l((function(){return{FOLDER:e.getString("folder",null,"Title"),LABEL:e.getString("label",null,"Title"),GROUP:e.getString("contact group",null,"Title"),order:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.ob.MESSAGE;return t===s.ob.CONTACT_GROUP?e.getString("Contact group order saved",null,"Success"):e.getString("Label order saved",null,"Success")},remove:function(t){var n,r=this,a=t.Exclusive,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.ob.MESSAGE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=o===s.ob.CONTACT_GROUP,u=(n=a?r.FOLDER:r.LABEL,c?r.GROUP:n),l=function(){return c?i>1?e.getString("Are you sure you want to delete these contact groups ? Contacts in the group aren’t deleted if the contact group is deleted.",null,"Info"):e.getString("Are you sure you want to delete this contact group ? Contacts in the group aren’t deleted if the contact group is deleted.",null,"Info"):a?e.getString("Are you sure you want to delete this folder? Messages in the folders aren’t deleted if the folder is deleted, they can still be found in all mail. If you want to delete all messages in a folder, move them to trash.",null,"Info"):e.getString("Are you sure you want to delete this label? Removing a label will not remove the messages with that label.",null,"Info")},d=e.getPlural(i,"{{type}} deleted.","{{$count}} {{type}} deleted.",{type:u},"Success"),p=e.getString("Delete {{type}}",{type:u},"Title"),f=l();return{NOTIF:d,message:f,title:p}}}}));return{remove:function(e,a){var o=e.IDs?e.IDs.length:1,c=d.remove(e,a,o),s=c.message,l=c.title,p=c.NOTIF;return new Promise((function(a){t.activate({params:{title:l,message:s,confirm:function(){var c,s,l,d,f=Promise.all((c=e,s=c.ID,l=c.IDs,d=void 0===l?[]:l,1!==o||(e.IDs||[]).length?d:[s]).map(r.remove)).then(n.call).then(t.deactivate).then((function(){return u.success(p)})).then((function(){return a(!0)}));i.track(f)},cancel:function(){a(!1),t.deactivate()}}})}))},saveOrder:function(){var e=c()(o.a.mark((function e(t){var a,c,l,p=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>1&&void 0!==p[1]?p[1]:s.ob.MESSAGE,c=d.order(a),l=r.order({LabelIDs:t,Type:a}).then(n.call).then((function(){return u.success(c)})),e.next=5,i.track(l);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}Gd.$inject=["gettextCatalog","confirmModal","eventManager","Label","labelsModel","networkActivityTracker","notification","translator"];var Vd=Gd;function qd(e,t,r,a,i,u,l,d,p){var f=d((function(){return{edit:t.getString("Edit",null,"Action"),remove:t.getString("Delete",null,"Action")}})),v=function(){var t=c()(o.a.mark((function t(n,i){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.remove(n,i);case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:if(i!==s.ob.MESSAGE){t.next=7;break}return t.abrupt("return",a.remove([n.ID]));case 7:return t.abrupt("return",r.remove([n.ID]));case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),m=function(){var e=c()(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==s.ob.MESSAGE){e.next=2;break}return e.abrupt("return",a.load(!0));case 2:l().isFree||p.edit(t,null,u);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return{scope:{model:"="},replace:!0,restrict:"E",templateUrl:n("39ph"),link:function(e,t,n){var r=n.action,a=void 0===r?"edit":r,o=function(e){return"group"===e?s.ob.CONTACT_GROUP:s.ob.MESSAGE}(n.key);t[0].textContent=f[a];var i=function(t){t.preventDefault(),e.$applyAsync((function(){"remove"===a&&v(e.model,o),"edit"===a&&m(e.model,o)}))};t.on("click",i),e.$on("$destroy",(function(){t.off("click",i)}))}}}qd.$inject=["manageLabels","gettextCatalog","contactGroupModel","labelsModel","networkActivityTracker","manageContactGroupModal","userType","translator","manageContactGroup"];var Hd=qd;var zd=function(){return{scope:{form:"=",model:"=",mode:"@"},replace:!0,restrict:"E",templateUrl:n("ZJBe")}},Yd=angular.module("proton.labels",[]).directive("labelNameInput",zd).directive("actionLabelBtn",Hd).factory("manageLabels",Vd).factory("labelCache",Kd).directive("labelColorSelector",Ud).directive("validLabel",$d).directive("createLabel",Ad).directive("dropdownFolders",Cd).directive("dropdownLabels",Md).factory("labelsModel",xd).factory("labelModal",Nd).name,Wd=n("Fob7"),Xd=n.n(Wd),Jd=n("1aMj"),Qd=function(e){return new Promise((function(t){var n=new Jd.a({defaultCharset:"UTF-8"});n.on("end",t),n.write(e),n.end()}))},Zd=function(){var e=c()(o.a.mark((function e(t,n){var r,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qd(n);case 2:return r=e.sent,a=r.headers,i=Object.keys(a),e.abrupt("return",i.reduce((function(e,t){var n=t.replace(/(^|-)./g,(function(e){return e.toUpperCase()})),r=Object(ka.e)(a[t]).map((function(e){return"".concat(n,": ").concat(e)})).join("\r\n"),o=e.replace(new RegExp("^"+t+":.*(?=$[^ ])","im"),r);return-1===o.indexOf(n)?e+r+"\r\n":o}),t));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ep=function(e){var t=e.search(/\r?\n\r?\n/);return-1===t?{headers:e,body:""}:{headers:e.substring(0,t),body:Xd()(e.substring(t))}};function tp(e,t,n,r,a,o){var i=e(["messageActions"]).dispatcher,c=function(e){var t=e.message;!0===t.showEmbedded&&(t.showEmbedded=!1),!0===t.showImages&&(t.showImages=!1)},u=function(e){var a=e.message,o=a.Header,i=void 0===o?"":o,c=a.Subject,s=void 0===c?"":c,u=a.Time,l=n.construct(e.message,!1).then((function(e){var t=ep(e),n=t.body,r=t.headers;return Zd(i,r).then((function(e){return[e,n]}))})).then((function(e){var n=G()(e,2),r=n[0],a=n[1],o=new Blob(["".concat(r,"\r\n").concat(a)],{type:"data:text/plain;charset=utf-8;"}),i="".concat(s," ").concat(moment.unix(u).format(),".eml");t(o,i)}));r.track(l)},l=function(e,t){var n=e.MIMEType,r=void 0===n?"text/html":n,a=e.DecryptedBody;return"text/plain"===r?a:t.parents(".message").get(0).querySelector(".message-body-container").innerHTML};return{link:function(e,t,n){var r=n.actionMessage,d=n.actionMessageType,p=void 0===d?"":d,f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";i.messageActions(t,{ids:[e.ID],labelID:s.rb[n]})}}(e.message);function v(){switch(r){case"unread":e.$applyAsync((function(){e.message.expand=!1,e.message.Unread=1})),f(r,p);break;case"togglePlainHtml":e.$applyAsync((function(){c(e),e.message.viewMode="plain"===e.message.viewMode?"html":"plain"})),f(r,p);break;case"toggleDetails":e.$applyAsync((function(){e.message.toggleDetails=!e.message.toggleDetails}));break;case"print":o.activate({params:{type:"message",config:{message:e.message,content:l(e.message,t)},cancel:function(){o.deactivate()}}});break;case"viewPgp":a.activate({params:{message:e.message,cancel:function(){a.deactivate()}}});break;case"downloadEml":u(e);break;default:f(r,p)}}t.on("click",v),e.$on("$destroy",(function(){t.off("click",v)}))}}}tp.$inject=["dispatchers","downloadFile","mimeMessageBuilder","networkActivityTracker","pgpModal","printModal"];var np=tp;var rp=function(){return{replace:!0,templateUrl:n("6LyF")}};function ap(e,t,r){var a=r((function(){return{embedded:t.getString("This message contains embedded images",null,"Action"),remote:t.getString("This message contains remote content",null,"Action")}}));return{replace:!0,templateUrl:n("8orU"),link:function(t,n,r){var o=r.action,i=void 0===o?"remote":o,c=e(["message.open"]).dispatcher,s=n[0].querySelector(".displayContentBtn-notice-text"),u=n.find(".displayContentBtn-button");s.textContent=a[i];var l=function(){c["message.open"]("injectContent",{message:t.message,action:i}),n[0].classList.remove("displayContentBtn-type-".concat(i))};u.on("click",l),t.$on("$destroy",(function(){u.off("click",l)}))}}}ap.$inject=["dispatchers","gettextCatalog","translator"];var op=ap;function ip(e,t,n){var r=t(["message.open"]),a=r.dispatcher,o=r.on,i=r.unsubscribe,c=function(e){var t=e.body,r=e.message,o=e.action,i=t?t.querySelectorAll("[data-embedded-img]"):[],c=[].slice.call(i).filter((function(e){return-1===e.src.indexOf("cid:")})).filter((function(e){return-1===e.src.indexOf("data:")})).reduce((function(e,t){var r=n.getUrl(t);return r&&(!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;e[t.getAttribute("data-embedded-img")]=n}(e.map,t,r),e.list.push(function(e,t){var n=new Image;return new Promise((function(r){n.src=t,n.onload=function(){return r({img:e,src:t})},n.onerror=function(){return r({img:e,src:"assets/img/icons/broken-img.png"})}}))}(t,r))),e}),{map:{},list:[]}),s=c.map,u=c.list;Promise.all(u).then((function(e){_rAF((function(){e.forEach((function(e){var t=e.img,n=e.src;t.src=n,t.classList.add("proton-embedded")}));var n=t?t.querySelectorAll(".loading"):[];n.length&&$(n).contents().unwrap(),e.length&&a["message.open"]("embedded.injected",{action:o,map:s,message:r,body:t.innerHTML})}))}))};return{link:function(e){o("message.embedded",(function(t,n){var r=n.type,a=n.data;"loaded"===r&&e.$applyAsync((function(){return c(a)}))})),e.$on("$destroy",i)}}}ip.$inject=["$log","dispatchers","embedded"];var cp=ip;function sp(e){return{restrict:"E",replace:!0,templateUrl:n("+2F5"),link:function(t,n){var r=e(),a=r.on,o=r.unsubscribe,i=Object(O.a)(n,{title:t.message.encryptionType()});a("tooltip",(function(e,n){var r=n.type,a=void 0===r?"":r,o=n.data,c=void 0===o?{}:o;"reloadEncryptionTooltip"===a&&Object(tr.u)([t.message,c.message])&&i.updateTitleContent(t.message.encryptionType()),"hideAll"===a&&i.hide()})),t.$on("$destroy",(function(){i.dispose(),o()}))}}}sp.$inject=["dispatchers"];var up=sp;function lp(e,t,r){return{restrict:"E",replace:!0,scope:{message:"="},templateUrl:n("D+O1"),link:function(n,a){n.model={};var o=a[0].querySelector(".filterButton-btn-next"),i=e(["dropdown"]).dispatcher;function c(){n.model.subject=!1,n.model.sender=!1,n.model.recipient=!1,n.model.attachments=!1}c();var s=function(){n.$applyAsync((function(){var e,a,o,s,u,l,d,p,f,v=[];n.model.subject&&v.push({Type:{value:"subject"},Comparator:{value:"contains"},Values:[],value:n.message.Subject}),n.model.sender&&v.push({Type:{value:"sender"},Comparator:{value:"contains"},Values:[n.message.Sender.Address]}),n.model.recipient&&v.push({Type:{value:"recipient"},Comparator:{value:"contains"},Values:(e=n.message,a=e.ToList,o=void 0===a?[]:a,s=e.CCList,u=void 0===s?[]:s,l=e.BCCList,d=void 0===l?[]:l,Be()(Re()((function(e){return e.Address})),Xi.a)(o.concat(u,d)))}),n.model.attachments&&v.push({Type:{value:"attachments"},Comparator:{value:(p=n.message,f=p.Attachments,(void 0===f?[]:f).length?"contains":"!contains")}});var m={Simple:{Operator:{value:"all"},Actions:[],Conditions:v}};r.extraVendor().then((function(){t.activate({params:{mode:"simple",filter:m,close:function(){t.deactivate()}}})})),c(),i.dropdown("close")}))};o.addEventListener("click",s),n.$on("$destroy",(function(){o.removeEventListener("click",s)}))}}}lp.$inject=["dispatchers","filterModal","lazyLoader"];var dp=lp;function pp(e,t,r,a){var o=a({MAP_LABELS:{archive:{className:"fa-archive",tooltip:t.getString("In archive",null,"Tooltip")},trash:{className:"fa-trash-o",tooltip:t.getString("In trash",null,"Tooltip")},spam:{className:"fa-ban",tooltip:t.getString("In spam",null,"Tooltip")},folder:{className:"fa-folder"}},MAP_TYPES:{drafts:{className:"pm_tag",tooltip:t.getString("Draft",null,"Label")},sent:{className:"pm_tag",tooltip:t.getString("Sent",null,"Label")}}}),i=o.getTemplateLabels,c=o.getTemplateType;return{templateUrl:n("nm6W"),replace:!0,link:function(t,n){var a=e(),o=a.on,s=a.unsubscribe,u=function(e){var a=e.LabelIDs,o=void 0===a?[]:a,s=e.Type,u="";o.length&&(u+=i(o)),angular.isNumber(s)&&(u+=c(s)),n.empty().append(r(u)(t))};o("foldersMessage",(function(e,n){var r=n.data;r.ID===t.message.ID&&u(r)})),u(t.message),t.$on("$destroy",s)}}}pp.$inject=["dispatchers","gettextCatalog","$compile","mailboxIdentifersTemplate"];var fp=pp;function vp(e,t,n,r){var a=function(e){if(!(t=e.parentNode)||!t.classList.contains("proton-loading")){var t,n=Object(Ot.k)();e.setAttribute("data-hash",n),angular.element(e).wrap('<div class="image loading '.concat("proton-loading",'" data-hash="').concat(n,'"></div>'))}},o=function(e){return e.forEach(a)},i=function(e,t){ke()((function(){var n=e.querySelector('.loading[data-hash="'.concat(t,'"]'));n&&$(n).contents().unwrap()}),100)};function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.attribute,r=t.selector,o=t.setLoader,c=void 0===o||o,s=t.container;e.forEach((function(e){c&&a(e),e.removeAttribute(n),"IMG"!==e.nodeName&&(e.setAttribute(n,t.getValue(e)),i(s,e.dataset.hash)),"IMG"===e.nodeName&&(e.onload=function(){return i(s,e.dataset.hash)},e.onerror=function(){console.error("Could not load ".concat(e.getAttribute(r))),i(s,e.dataset.hash)},e.setAttribute(n,t.getValue(e)))}))}function s(e,t){var n=t.map,r=t.action,a=e[0],i=Object.keys(n).map((function(e){return'[proton-src="'.concat(e,'"]')})).join(","),s=[].slice.call(a.querySelectorAll(i||'[proton-src^="cid:"]'));if("user.inject.load"===r)return o(s);c(s,{selector:"proton-src",attribute:"src",setLoader:!1,container:a,map:n,getValue:function(e){return this.map[e.getAttribute("proton-src")]}})}return{link:function(a,o){var i=e([]),u=i.on,l=i.unsubscribe;u("message.open",(function(e,i){var u,l=i.type,d=i.data;if(d.message.ID===a.message.ID)switch(l){case"injectContent":var p=a.body||a.message.getDecryptedBody(!0);a.$applyAsync((function(){"remote"===d.action&&t(a.message,p,"user.inject"),"embedded"===d.action&&n(a.message,p,"user.inject")}));break;case"remote.injected":if("user.inject"===d.action)return u=o,We()(u[0].querySelectorAll("[style]"),(function(e){e.setAttribute("style",e.getAttribute("style").replace(/proton-(url)/g,"$1"))})),function(e,t){var n=t.list,r=t.hasSVG,a=e[0],o=n.reduce((function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=(e[n]||[]).concat("[".concat(n,'="').concat(t[n],'"]')),e}),e)}),{});Object.keys(o).forEach((function(e){var t=e.substring(7);c([].slice.call(a.querySelectorAll("[".concat(e,"]:not([").concat(e,'^="cid:"]):not([').concat(e,'^="data:"])'))),{selector:e,attribute:t,container:a,getValue:function(e){return e.getAttribute(this.selector)}})})),r&&(a.innerHTML=a.innerHTML.replace(/proton-svg/g,"svg"))}(o,d);break;case"embedded.injected":if("user.inject.load"===d.action)return s(o,d);if("user.inject"===d.action)return s(o,d);break;case"render":!function(e){yn(e[0],r)}(o)}})),a.$on("$destroy",l)}}}vp.$inject=["dispatchers","displayImages","displayEmbedded","cacheBase64"];var mp=vp,gp=n("O7iK"),hp=n.n(gp),bp=s.uc.SIGNED_AND_INVALID,yp=s.uc.SIGNED_AND_VALID,Ep=s.uc.NOT_SIGNED,Sp=function(e){return e.isSentByMe()?function(){var t=Object(tr.k)(e),n=Object(tr.g)(e),r=Object(tr.f)(e.Time);return!!(n||t||r)&&(e.verified!==yp&&(!(e.verified!==Ep||n||t||!r)||e.verified===bp))}:function(){return e.verified===bp||e.verified===yp}};function Dp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dp(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dp(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Ip.$inject=["$state","dispatchers","mailSettingsModel","cache","displayContent","messageScroll","tools","unsubscribeModel","sendPreferences","$exceptionHandler","recipientsFormator"];var Ap={UNDISCLOSED:"message-undisclosed"};function Ip(e,t,r,a,i,u,l,d,p,f,v){var m=function(e){return!v.toList(e).length};function g(t){var n=t.LabelIDs,r=void 0===n?[]:n,a=l.currentLocation(),o=-1!==r.indexOf(a),i=l.typeView(),c=e.includes("secured.search.**");return"conversation"===i||c||o}return{restrict:"E",replace:!0,templateUrl:n("Jhbc"),scope:{message:"=model",marked:"=",last:"=",index:"="},link:function(n,h){var b=t(["messageActions","composer.load","tooltip"]),y=b.on,E=b.dispatcher,S=b.unsubscribe;n.getClassNames=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.Sender||{},r=n.Address,a=void 0===r?[]:r,o=a.length;return{hasSender:o,open:e.expand,marked:e.ID===t.ID,unread:1===e.Unread,details:!0===e.toggleDetails,draft:Object(tr.h)(e),sent:Object(tr.q)(e),"message-is-replied":Object(tr.o)(e),"message-is-repliedall":Object(tr.p)(e),"message-is-forwarded":Object(tr.j)(e),"message-mode-plain":"plain"===e.viewMode}};var D=function(e){h[0].classList[m(e)?"add":"remove"](Ap.UNDISCLOSED)};D(n.message);var A=function(){return a.getMessage(n.message.ID).then((function(e){return Ge()(n.message,e)}))},I=function(){E.tooltip("reloadEncryptionTooltip",{message:n.message})},C=function(){var e=c()(o.a.mark((function e(t){var a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.get([n.message.SenderAddress]).then((function(e){var t=e[n.message.SenderAddress],a=t.pinned,o=t.scheme,i=t.isVerified;return n.$applyAsync((function(){var e=o===s.gc.SEND_PM;n.message.promptKeyPinning=!a&&r.get("PromptPin")&&e,n.message.askResign=a&&!i}))})),e.prev=1,e.next=4,t;case 4:a=e.sent,i=a.type,c=a.body,n.$applyAsync((function(){n.message.expand=!0,n.message.isPlain="plain"===i,i&&c&&(n.message.viewMode="html",n.body=c),I();var e=["none","pgp-mime","pgp-mime-pinned","pgp-inline","pgp-inline-pinned","pgp-eo","pgp-pm","pgp-pm-pinned"],t=function(t,n){var r=t.split(";").map((function(e){return decodeURIComponent(e).trim().split("=")})),a=hp()(r),o=No()(n,Array(n.length).fill("none"));return Ge()(o,Wl()(a,(function(t){return e.includes(t)?t:"none"})))},r=n.message.getParsedHeaders(),a=k()(v.toList(n.message),"Address"),o=t(r["X-Pm-Recipient-Encryption"]||"",a),s=t(r["X-Pm-Recipient-Authentication"]||"",a),u=function(e){return kp({},e,{},!e.isContactGroup&&{Authentication:s[e.Address],Encryption:o[e.Address]})};n.toList=n.message.ToList.map(u),n.ccList=n.message.CCList.map(u),n.bccList=n.message.BCCList.map(u)})),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0),f(e.t0),n.$applyAsync((function(){n.message.expand=!0,n.message.viewMode="plain",n.message.hasError=!0,n.message.errorInfo=e.t0}));case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),w=function(){return C(i(n.message,n.body,n.index))};n.body="",n.unsubscribed=d.already(n.message.getListUnsubscribe()),(n.message.openMe||n.message.expand)&&M();var O=function(e){return kp({},e,{Authentication:"none",Encryption:"none"})};function M(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).expand;if(n.message.isDraft())(e.includes("secured.drafts.**")||e.includes("secured.allDrafts.**"))&&E["composer.load"]("",n.message);else{if(!1===t)return Et()(n.message,"showEmbedded")&&(n.message.showEmbedded=!1),void(Et()(n.message,"showImages")&&(n.message.showImages=!1));(void 0===n.message.Body?A():Promise.resolve()).then(w).then((function(){n.$applyAsync((function(){$(document.getElementById("pm_thread")).focus()}))}))}}n.toList=n.message.ToList.map(O),n.ccList=n.message.CCList.map(O),n.bccList=n.message.BCCList.map(O),n.displaySignatureStatus=Sp(n.message),n.message.promptKeyPinning=!1,y("message.open",(function(t,r){var a=r.type,o=r.data;if(o.message.ID===n.message.ID)switch(a){case"toggle":if(M(o),o.action)return u.to({index:n.index,message:n.message,node:h[0]});break;case"embedded.injected":o.action||n.$applyAsync((function(){return n.body=o.body}));break;case"save.success":if(e.includes("secured.allDrafts.**"))return e.go("secured.allDrafts");if(e.includes("secured.drafts.**"))return e.go("secured.drafts");M()}})),y("message",(function(e,t){var r=t.type,a=void 0===r?"":r,o=t.data,i=void 0===o?{}:o;"unsubscribed"===a&&i.message.ID===n.message.ID&&n.$applyAsync((function(){n.unsubscribed=d.already(n.message.getListUnsubscribe())})),"decrypted"===a&&i.message.ID===n.message.ID&&I(),"reload"===a&&n.message.Body&&i.conversationID===n.message.ConversationID&&n.message.clearTextBody(!0).then((function(){return n.$applyAsync()}))})),y("message.refresh",function(){var t=c()(o.a.mark((function t(r,i){var c,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i.data.indexOf(n.message.ID)>-1)){t.next=13;break}if(c=a.getMessageCached(n.message.ID),s=l.typeView(),!c||!g(c)){t.next=12;break}if(!c.isMIME()){t.next=8;break}return t.next=8,c.loadPGPAttachments();case 8:n.message=Ge()(n.message,c),D(n.message),t.next=13;break;case 12:"message"===s&&(r=void 0,r=e.$current.name.replace(".element",""),e.go(r,{id:null}));case 13:case"end":return t.stop()}var r}),t)})));return function(e,n){return t.apply(this,arguments)}}()),n.getElements=function(){return[n.message]},n.recipients=function(){return n.message.ToList.concat(n.message.CCList,n.message.BCCList)},n.noRecipients=function(){return m(n.message)},n.getMessage=function(){return[n.message]},n.saveLabels=function(e,t){var r=[n.message];E.messageActions("label",{messages:r,labels:e,alsoArchive:t})},n.$on("$destroy",S)}}}var Cp=Ip;function wp(e,t,r,a,o,i){var c=function(e){return le()(a.get(),{Email:e})};return{restrict:"E",templateUrl:n("bWJJ"),replace:!0,link:function(n,a){var s={},u=a.find(".message-address-trigger"),l=a.find(".pm_dropdown"),d=a.find(".messageAddressActionMenu-btn-copy-address"),p=e(["contacts","composer.new","dropdown"]),f=p.dispatcher,v=p.unsubscribe,m=p.on,g=i(d[0],(function(){return s.address.address})).destroy,h=function(e,t,n){return a[0].classList.contains(t)===n||e.classList.toggle(t)},b={"compose-to":function(){var e=s.address,n=e.address,r=e.name,a=e.isContactGroup,o=t({ToList:[{Address:n,Name:r,Group:a?r:""}]});f["composer.new"]("new",{message:o})},"add-contact":function(){var e=s.address,t=e.address,n=e.name;f.contacts("addContact",{email:t,name:n})},"contact-details":function(){var e=(c(s.address.address)||{}).ContactID;e&&r.go("secured.contacts.details",{id:e})},"advanced-settings":function(){return o.showSettings(n)}};l.on("click",(function(e){var t=e.target;"BUTTON"===t.nodeName&&((b[t.dataset.action]||q.a)(),f.dropdown("close"))})),m("messageAddressActions",(function(e,t){var r=t.type,o=t.data,i=o.messageID,d=o.address,p=o.element;if("show"===r&&n.message.ID===i){s.address=d;var v=!!c(d.address);h(a[0],"address-is-contact",v),h(a[0],"show-advanced-settings",n.message.Sender.Address===d.address),h(a[0],"messageAddressActionMenu-isGroup",d.isContactGroup),function(e){f.dropdown("close"),u.click();var t=e.offset(),n=t.top,r=t.left;l.offset({top:n+5,left:r+15})}(p)}"hide"===r&&n.message.ID===i&&f.dropdown("close")})),n.$on("$destroy",(function(){g(),v()}))}}}wp.$inject=["dispatchers","messageModel","$state","contactEmails","messageSenderSettings","ptClipboard"];var Op=wp;function Mp(e,t){var r=t("contact"),a=function(e,t,n){var r=[];return t.forEach((function(t){e.on(t,n),r.push((function(){return e.off(t,n)}))})),r};return{restrict:"E",templateUrl:n("LPM9"),replace:!0,scope:{messageId:"=",email:"="},link:function(t,n){var o=e(["messageAddressActions"]),i=o.on,c=o.unsubscribe,s=o.dispatcher,u=function(){return n[0].classList.remove("messageAddressActions-open")};i("dropdown",u);var l=[c].concat(we()(a(n,["click","mouseup","touchend"],(function(e){return e.stopPropagation()}))),we()(a(n,["click"],(function(){if(n[0].classList.contains("messageAddressActions-open"))return s.messageAddressActions("hide",{messageID:t.messageId}),u();s.messageAddressActions("show",{messageID:t.messageId,address:{address:t.email.Address,name:r(t.email,"Name"),isContactGroup:!!t.email.isContactGroup},element:n}),n[0].classList.add("messageAddressActions-open")}))));t.$on("$destroy",(function(){l.forEach((function(e){return e()}))}))}}}Mp.$inject=["dispatchers","$filter"];var Pp=Mp;var xp=function(){return{replace:!0,restrict:"E",templateUrl:n("FPTb")}};var Tp=function(){return{replace:!0,restrict:"E",templateUrl:n("rtqA")}};var Lp=function(){return{replace:!0,restrict:"E",templateUrl:n("csM4")}};function jp(e,t,r,a,o,i,c,s){var u=s((function(){return{SUCCES_MESSAGE:o.getString("Public Key trusted",null,"Success"),ERROR_MESSAGE:o.getString("Error while adding the public key to the contacts",null,"Error")}}));return{replace:!0,restrict:"E",templateUrl:n("Acgf"),link:function(n,o){var s=e(["message"]).dispatcher,l=o[0],d=function(){var e=Object(Sa.a)(n.message.attachedPublicKey),o=e.then((function(e){return a.extractAddresses(n.message,e)})),l=Promise.all([e,o]).then((function(e){var o=G()(e,2),l=o[0],d=o[1];0!==d.length&&(l.algType=Object(ne.a)(l),t.activate({params:{addresses:d,isInternal:Object(tr.l)(n.message),keyInfo:l,submit:function(e){a.attachPublicKey(n.message.attachedPublicKey,e).then((function(e){if(e){var t=c.call().then((function(){return s.message("reload",{conversationID:n.message.ConversationID})})).then((function(){return i.success(u.SUCCES_MESSAGE)}));return r.track(t),t}})).catch((function(){return i.error(u.ERROR_MESSAGE)})),t.deactivate()},cancel:function(){t.deactivate()}}}))}));r.track(l)},p=l.querySelector(".public-key-found-button");p.addEventListener("click",d),n.$on("$destroy",(function(){p.removeEventListener("click",d)}))}}}jp.$inject=["dispatchers","trustPublicKeyModal","networkActivityTracker","attachedPublicKey","gettextCatalog","notification","eventManager","translator"];var Np=jp;function $p(e,t,r,a,o,i){var c=o((function(){return{SUCCES_MESSAGE_HIDE:e.getString("Banner permanently hidden",null,"Success")}}));return{replace:!0,restrict:"E",templateUrl:n("V/dF"),link:function(e,n){var o=function(){var n=t.updatePromptPin({PromptPin:0}).then((function(){return e.$applyAsync((function(){return e.message.promptKeyPinning=!1}))})).then((function(){return r.success(c.SUCCES_MESSAGE_HIDE)}));a.track(n)},s=function(){return i.showSettings(e)},u=function(t){var n=t.target.dataset.action,r=void 0===n?"":n;"settings"===r&&e.$applyAsync(s),"never-show"===r&&e.$applyAsync(o)};n[0].addEventListener("click",u),e.$on("$destroy",(function(){n[0].removeEventListener("click",u)}))}}}$p.$inject=["gettextCatalog","settingsMailApi","notification","networkActivityTracker","translator","messageSenderSettings"];var Rp=$p;function _p(e,t,r,a,o,i,c){var s=c((function(){return{SUCCES_MESSAGE:a.getString("Contact re-signed",null,"Success")}}));return{replace:!0,restrict:"E",templateUrl:n("SaIr"),link:function(n,a){var c=i(["contacts"]).dispatcher;a[0].querySelector(".message-resign-button").addEventListener("click",(function(){var a=Object(Ot.e)(n.message.SenderAddress),i=e.findEmail(a,Ot.e),u=t.get(i.ContactID).then((function(e){return t.updateUnencrypted(e)})).then((function(e){var t=e.Contact,n=e.cards;return c.contacts("contactUpdated",{contact:t,cards:n})})).then((function(){return n.message.clearTextBody(!0)})).then((function(){return o.success(s.SUCCES_MESSAGE)})).then((function(){return n.$applyAsync((function(){return n.message.askResign=!1}))}));r.track(u)}))}}}_p.$inject=["contactEmails","Contact","networkActivityTracker","gettextCatalog","notification","dispatchers","translator"];var Up=_p,Fp=function(e,t){return{replace:!0,template:'<button class="fa fa-pencil messageComposeTo-container" pt-tooltip-translate="Compose to"></button>',link:function(n,r,a){var o=a.key,i=e(["composer.new"]).dispatcher,c=function(){var e=t(),r=o?n.message[o]:n.email;e.ToList=[r],i["composer.new"]("new",{message:e})};r.on("click",c),n.$on("$destroy",(function(){r.off("click",c)}))}}};Fp.$inject=["dispatchers","messageModel"];var Bp=Fp;function Kp(e,t){var r=t((function(){return{BCC:e.getString("BCC",null,"Title"),CC:e.getString("CC",null,"Title"),To:e.getString("To",null,"Title")}}));return{templateUrl:n("kdWj"),replace:!0,scope:{model:"=",messageId:"="},link:function(e,t,n){var a=n.list,o=void 0===a?"To":a;t[0].querySelector(".messageContacts-where").textContent=r[o]}}}Kp.$inject=["gettextCatalog","translator"];var Gp=Kp;function Vp(e,t){var r=1,a=2,o=4,i=8,c=16,s=t((function(){var t;return t={},v()(t,i|!r|a,e.getString("PGP-signed",null,"Info")),v()(t,i|r|!a,e.getString("PGP-encrypted",null,"Info")),v()(t,i|r|a,e.getString("PGP-encrypted",null,"Info")),v()(t,c|!r|a,e.getString("PGP-signed",null,"Info")),v()(t,c|r|!a,e.getString("PGP-encrypted",null,"Info")),v()(t,c|r|a,e.getString("PGP-encrypted",null,"Info")),v()(t,o|!r|a,e.getString("End-to-end encrypted to verified recipient",null,"Info")),v()(t,o|r|!a,e.getString("End-to-end encrypted to verified recipient",null,"Info")),v()(t,o|r|a,e.getString("End-to-end encrypted to verified recipient",null,"Info")),v()(t,!r|a,e.getString("End-to-end encrypted",null,"Info")),v()(t,r|!a,e.getString("End-to-end encrypted",null,"Info")),v()(t,r|a,e.getString("End-to-end encrypted",null,"Info")),t}));return{templateUrl:n("YdBq"),replace:!0,link:function(e){e.email.tooltip=function(){if(e.email.isContactGroup)return"";var t,n,u,l,d,p=(t=e.email.Encryption.startsWith("pgp-mime")||e.email.Authentication.startsWith("pgp-mime"),n=e.email.Encryption.startsWith("pgp-inline")||e.email.Authentication.startsWith("pgp-inline"),u="pgp-pm-pinned"===e.email.Encryption||"pgp-pm-pinned"===e.email.Authentication,l="none"!==e.email.Encryption,d="none"!==e.email.Authentication,l*r+d*a+t*i+n*c+u*o);return s[p]||""}()}}}Vp.$inject=["gettextCatalog","translator"];var qp=Vp;var Hp=function(){return{restrict:"E",templateUrl:n("rAeD"),replace:!0}},zp=function(){return{replace:!0,templateUrl:n("vCH9"),link:function(e,t){var n=function(e){e.stopPropagation()};t.on("click",n),t.on("mouseup",n),t.on("touchend",n),e.$on("$destroy",(function(){t.off("click",n),t.off("mouseup",n),t.off("touchend",n)}))}}};Jp.$inject=["gettextCatalog","translator"];var Yp=s.jc.PHISHING,Wp=s.jc.DMARC_FAILED,Xp=s.jc.PM_SPOOFED;function Jp(e,t){var n=t((function(){var t;return t={},v()(t,Xp,e.getString("This email seems to be from a ProtonMail address but came from outside our system and failed our authentication requirements. It may be spoofed or improperly forwarded!",null,"Info")),v()(t,Wp,e.getString("This email has failed its domain's authentication requirements. It may be spoofed or improperly forwarded! {{startLink}}Learn more{{endLink}}.",{startLink:'<a href="https://protonmail.com/support/knowledge-base/email-has-failed-its-domains-authentication-requirements-warning/" target="_blank">',endLink:"</a>"},"Info")),v()(t,Yp,e.getString("This message may be a phishing attempt. Please check the sender and contents to make sure they are legitimate. {{startLink}}Learn more{{endLink}}.",{startLink:'<a href="https://protonmail.com/blog/prevent-phishing-attacks/" target="_blank">',endLink:"</a>"},"Info")),t}));return{replace:!0,template:'\n            <div class="messageSpamScore-container">\n                <span class="messageSpamScore-notice"></span>\n            </div>\n        ',link:function(e,t,r){var a=r.score;t[0].querySelector(".messageSpamScore-notice").innerHTML=n[a]}}}var Qp=Jp;function Zp(e,t,r,a,o,i,c,u){function l(){var e=t.$current.name.replace(".element","");t.go(e,{id:""},{reload:!0})}return{restrict:"E",replace:!0,templateUrl:n("Lud0"),link:function(t){var n=r(["messageActions","elements"]),d=n.dispatcher,p=n.on,f=n.unsubscribe,v=e.id,m=angular.noop;i.getMessage(v).then((function(e){d.elements("mark",{id:v}),d.elements("opened",{id:v});var n=u.list(e),r=n.ToList,i=n.CCList,s=n.BCCList;t.$applyAsync((function(){e.openMe=!0,e.ToList=r,e.CCList=i,e.BCCList=s,t.message=e,a.set("numberElementSelected",1),m=o(t.message),p("message.expiration",l)})),c.unbind(["down","up"])})),p("hotkeys",(function(e,n){var r=n.type,o=n.data.to;if("move"===r){var i=s.rb[o];if(a.get("numberElementChecked"))return;d.messageActions("move",{ids:[t.message.ID],labelID:i})}})),t.$on("$destroy",(function(){c.bind(["down","up"]),m(),f(),d.elements("close",{element:t.message})}))}}}Zp.$inject=["$stateParams","$state","dispatchers","AppModel","conversationListeners","cache","hotkeys","recipientsFormator"];var ef=Zp;function tf(e){return{replace:!0,restrict:"E",templateUrl:n("6gV8"),link:function(t,n){var r=function(){var r=c()(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.reportPhishing(t.message);case 2:n[0].classList.add("phishingBtn-reported");case 3:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();n.on("click",r),t.$on("$destroy",(function(){n.off("click",r)}))}}}tf.$inject=["bugReportModel"];var nf=tf;function rf(e,t,n){var r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"load";switch(n){case"load":(t.length>1e4||!t)&&e.set("networkActivity",!0);break;default:e.set("networkActivity",!1)}};return{link:function(a,o){var i=t(["message.open"]).dispatcher;r(a.body);var c=function(e){"nodeInserted"===e.animationName&&r(a.body,"close")},s=function(e){"nodeInserted"===e.animationName&&a.$applyAsync((function(){i["message.open"]("render",{message:a.message,index:a.index})}))};o[0].addEventListener("animationstart",c,!1),o[0].addEventListener("animationend",s,!1);var u=a.$watch("body",(function(){a.$applyAsync((function(){o[0].innerHTML=n.getTrustedHtml(n.trustAsHtml(a.body))}))}));a.$on("$destroy",(function(){o[0].removeEventListener("animationstart",c,!1),o[0].removeEventListener("animationend",s,!1),u(),e.set("networkActivity",!1)}))}}}rf.$inject=["AppModel","dispatchers","$sce"];var af=rf,of=function(){return{restrict:"A",link:function(e,t){var n=function(e){"BUTTON"===e.target.tagName&&e.target.classList.contains("more")&&(e.preventDefault(),e.target.classList.toggle("proton-message-blockquote-toggle"))};t.on("click",n),e.$on("$destroy",(function(){t.off("click",n)}))}}};function cf(e){return{restrict:"A",link:function(t,n){var r=e(["composer.load","message.open"]).dispatcher;function a(e){window.getSelection&&0!==window.getSelection().toString().length||"A"===e.target.nodeName||e.target.classList.contains("labelsElement-btn-remove")||e.target.classList.contains("messageAddressActionMenu-btn-compose-to")||e.target.classList.contains("messageAddressActionMenu-btn-add-contact")||e.target.classList.contains("messageAddressActionMenu-btn-copy-address")||e.target.classList.contains("messageAddressActionMenu-btn-show-contact")||e.target.classList.contains("messageAddressActionMenu-btn-pin-public")||t.$applyAsync((function(){if(Object(tr.h)(t.message))return r["composer.load"]("",t.message);t.message.expand=!t.message.expand,t.message.toggleDetails&&(t.message.toggleDetails=!1),r["message.open"]("toggle",{message:t.message,expand:t.message.expand})}))}n.on("click",a),t.$on("$destroy",(function(){n.off("click",a)}))}}}cf.$inject=["dispatchers"];var sf=cf;function uf(e,t,n,r,a,o,i){var c=i((function(){return{cannotSend:function(e){return r.getString("Cannot unsubscribe with {{email}}, please upgrade to a paid plan or enable the address",{email:e},"Error message when unsubscribing to mail list")},notice:r.getString("This message is from a mailing list",null,"Info"),kb:r.getString("Learn more",null,"Info"),button:r.getString("Unsubscribe",null,"Action"),title:r.getString("Unsubscribe from mailing list?",null,"Title"),message:function(e){return r.getString("We will send a message from {{email}} to unsubscribe from this mailing list.",{email:"<b>".concat(e,"</b>")},"Info")}}})),s=n(["message"]).dispatcher;return{replace:!0,restrict:"E",template:'\n                <div class="unsubscribePanel-container">\n                    <div class="unsubscribePanel-notice">\n                        <span class="unsubscribePanel-notice-text">'.concat(c.notice,'</span>\n                        <a class="unsubscribePanel-notice-link" href="https://protonmail.com/support/knowledge-base/auto-unsubscribe" target="_blank">').concat(c.kb,'</a>\n                    </div>\n                    <button type="button" class="unsubscribePanel-button pm_button">').concat(c.button,"</button>\n                </div>\n            "),link:function(n,r){var i=r.find(".unsubscribePanel-button"),u=function(){o.beginsWith(n.message,"mailto:")?function(n){if(!e.getByEmail(n.xOriginalTo).Send)return a.error(c.cannotSend(n.xOriginalTo));t.activate({params:{title:c.title,message:c.message(n.xOriginalTo),confirm:function(){t.deactivate(),s.message("unsubscribe",{message:n})},cancel:function(){t.deactivate()}}})}(n.message):s.message("unsubscribe",{message:n.message})};i.on("click",u),n.$on("$destroy",(function(){return i.off("click",u)}))}}}uf.$inject=["addressesModel","confirmModal","dispatchers","gettextCatalog","notification","unsubscribeModel","translator"];var lf=uf;var df=function(){return{replace:!0,restrict:"E",templateUrl:n("hvI2"),scope:{addresses:"="},link:function(e,t){var n={addAddress:function(){return e.$applyAsync((function(){e.addresses.push({adr:"",name:"",infoText:""})}))},deleteAddress:function(t){return e.$applyAsync((function(){e.addresses.splice(t,1),0===e.addresses.length&&e.addresses.push({adr:"",name:"",infoText:""})}))}},r=function(e){var t=e.target;if("BUTTON"===t.nodeName){var r=t.dataset,a=r.action,o=void 0===a?"":a,i=r.index,c=void 0===i?0:i;Et()(n,o)&&n[o](parseInt(c,10))}};t[0].addEventListener("click",r),e.$on("$destroy",(function(){t[0].removeEventListener("click",r)}))}}};var pf=function(){return{replace:!0,restrict:"E",templateUrl:n("cxSZ"),scope:{keyInfo:"="}}};function ff(e,t,n,r,a,i,u,l,d,p,f,v,m){var g=m(["message"]).dispatcher,h=function(e){var t=e.ContactID,n=e.Email;return r.get(t).then((function(e){return e.errors.includes(Da.b.TYPE2_CONTACT_VERIFICATION)?u.resign([n]).then((function(t){return!!t&&e})):e}))},b=function(e){var t=e.Address,r=e.Name,a=angular.copy(n.contactAPI);return a.vCard.add("email",t,{group:"item1"}),a.vCard.set("fn",r||t,{type:"x-fn"}),a},y=function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,c,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.ID?p.updateUnencrypted({contact:n}):p.createSingular({contact:n}),e.next=3,a;case 3:return e.next=5,d.get([r]);case 5:i=e.sent,c=i[r],u=c.pinned,l=c.scheme,t.message.promptKeyPinning=!u&&f.get("PromptPin")&&l===s.gc.SEND_PM,g.message("reload",{conversationID:t.message.ConversationID});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();return{showSettings:function(){var n=c()(o.a.mark((function n(r){var s,u,d,p,f,m,g,E,S;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=Object(Ot.e)(r.message.SenderAddress),u=t.findEmail(s,Ot.e),d=u?h(u):b(r.message.Sender),p=Promise.all([a.get([s]),d]),i.track(p),n.next=7,p;case 7:if(f=n.sent,m=G()(f,2),g=m[0][s],!1!==(E=m[1])){n.next=13;break}return n.abrupt("return");case 13:S=e.prepare(E.vCard,s),l.activate({params:{email:s,model:S,internalKeys:g,save:function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E.vCard=v.build(E,s,t),l.deactivate(),i.track(y(r,E,s));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),close:l.deactivate}});case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}}ff.$inject=["contactEncryptionModel","contactEmails","contactSchema","Contact","keyCache","networkActivityTracker","autoPinPrimaryKeys","contactEncryptionModal","sendPreferences","contactEditor","mailSettingsModel","contactEncryptionSaver","dispatchers"];var vf=ff,mf=n("+80P"),gf=new(n.n(mf).a),hf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=gf.match(e);if(!t)return tn()(e);var n=0,r=t.reduce((function(t,r){return n<r.index&&t.push(tn()(e.slice(n,r.index))),t.push('<a target="_blank" rel="noreferrer nofollow noopener" href="'),t.push(tn()(r.url)),t.push('">'),t.push(tn()(r.text)),t.push("</a>"),n=r.lastIndex,t}),[]);return n<e.length&&r.push(tn()(e.slice(n))),r.join("")};yf.$inject=["dispatchers","prepareContent"];var bf=s.Gb.PLAINTEXT;function yf(e,t){var n=e(["messageActions"]).dispatcher;function r(e){return a.apply(this,arguments)}function a(){return(a=c()(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.decrypting=!0,e.next=3,t.clearTextBody(!1,!1);case 3:return n=e.sent,t.decrypting=!1,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function i(e,t){return{body:e,type:t.MIMEType===bf?"plain":"html"}}function s(e,n){return"html"===e.type?e.body=t(e.body,n,{countEmbedded:!0}):(e.body=hf(e.body),n.NumEmbedded=n.countEmbedded()),e}return function(){var e=c()(o.a.mark((function e(t,a){var c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=void 0,o=t.ID,n.messageActions("read",{ids:[o]}),!a){e.next=3;break}return e.abrupt("return",i(a,t));case 3:return e.next=5,r(t);case 5:return c=e.sent,u=i(c,t),e.abrupt("return",s(u,t));case 8:case"end":return e.stop()}var o}),e)})));return function(t,n){return e.apply(this,arguments)}}()}var Ef=yf;function Sf(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;return t.showEmbedded=!0,e(n,t,{blacklist:["transformLinks","transformRemote","transformWelcome","transformBlockquotes"],action:r})}}Sf.$inject=["prepareContent"];var Df=Sf;function kf(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;return t.showImages=!0,e(n,t,{blacklist:["transformLinks","transformEmbedded","transformWelcome","transformBlockquotes","transformAttachements"],action:r})}}kf.$inject=["prepareContent"];var Af=kf;wf.$inject=["$q","tools","cache","canUndo","contactSpam","eventManager","messageApi","dispatchers","networkActivityTracker","notification","gettextCatalog","labelsModel"];var If=0,Cf=1;function wf(e,t,n,r,a,o,i,c,u,l,d,p){var f=c().on,m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l.success(Object(Ot.j)(e),t)},g=[s.rb.inbox,s.rb.trash,s.rb.spam,s.rb.archive,s.rb.sent,s.rb.drafts];function h(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=(p.read(t,"folders")||{}).Name;return(e={},v()(e,s.rb.inbox,d.getString("Inbox",null,"App folder")),v()(e,s.rb.spam,d.getString("Spam",null,"App folder")),v()(e,s.rb.drafts,d.getString("Drafts",null,"App folder")),v()(e,s.rb.allDrafts,d.getString("Drafts",null,"App folder")),v()(e,s.rb.sent,d.getString("Sent",null,"App folder")),v()(e,s.rb.allSent,d.getString("Sent",null,"App folder")),v()(e,s.rb.trash,d.getString("Trash",null,"App folder")),v()(e,s.rb.archive,d.getString("Archive",null,"App folder")),e)[t]||n}function b(e){var o=e.ids,c=e.labelID,l=e.undo,f=void 0===l||l,v=t.currentLocation(),y=p.ids("folders"),E=p.ids("labels"),S=c===s.rb.trash,D=c===s.rb.spam,k=D||S?g.concat(y,E):g.concat(y),A={},I=bt()(o,(function(e,t){var r=n.getMessageCached(t)||{},a=r.LabelIDs||[],o=Object(tr.d)(r,c),i=a.filter((function(e){return k.includes(e)}));if(Array.isArray(i)&&(a=xa()(a,i)),Array.isArray(o)&&(a=ga()(a.concat(o))),D){var s=r.Sender,u=void 0===s?{}:s;e.toSpamList.push(u.Address)}return e.eventList[t]={ID:t,Action:3,Message:{ID:t,ConversationID:r.ConversationID,Selected:!1,LabelIDs:a,Unread:S?0:r.Unread}},e}),{eventList:Object.create(null),toSpamList:[]}),C=I.eventList,w=I.toSpamList,O=bt()(C,(function(e,t){var r=n.getConversationCached(t.Message.ConversationID),a=n.queryMessagesCached(t.Message.ConversationID);if(e.push(t),r&&Array.isArray(a)){var o=Be()(Ne()((function(e,t){var n=t.ID,r=t.LabelIDs,a=void 0===r?[]:r,o=C[n]?C[n].Message.LabelIDs:a;return e.concat(o)}),[]),Xi.a,Re()((function(e){return{ID:e}})))(a);e.push({Action:3,ID:r.ID,Conversation:{ID:r.ID,Labels:o}})}return e}),[]),M=i.label({LabelID:c,IDs:o});n.addToDispatcher(M);var P=d.getPlural(o.length,"1 message moved to {{folder}}","{{number}} messages moved to {{folder}}",{folder:h(c),number:o.length},"Action");if(w.length&&a(ga()(w)),f&&r()&&(A.undo=function(){b({ids:o,labelID:v,undo:!1})}),t.cacheContext())return n.events(O),m(P,A);M.then((function(){return n.events(O),m(P,A)})),u.track(M)}function y(r,a,o){var c=t.cacheContext(),l=t.currentLocation(),d=Me()(g,l)||p.contains(l,"folders"),f=k()(r,"ID"),v=function(e){n.events(e).then((function(){var e=bt()(r,(function(e,t){var r,a=t.ConversationID,o=n.getConversationCached(a);return o&&(o.Labels=(r=o.ID,Be()(Ne()((function(e,t){var n=t.LabelIDs,r=void 0===n?[]:n;return e.concat(r)}),[]),Xi.a,Re()((function(e){return{ID:e}})))(n.queryMessagesCached(r)||[])),e.push({Action:3,ID:o.ID,Conversation:o})),e}),[]);n.events(e),!0===o&&i.archive({IDs:f})}))},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:angular.noop;return Be()(Ue()(t),Re()((function(e){return e.ID})))(e)},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return k()(e,(function(e){return i[t===Cf?"label":"unlabel"]({LabelID:e,IDs:f})}))},b=bt()(r,(function(e,t){var n=(t.LabelIDs||[]).filter((function(e){return isNaN(+e)})),r=m(a,(function(e){var t=e.ID;return!0===e.Selected&&!Me()(n,t)})),i=m(a,(function(e){var t=e.ID;return!1===e.Selected&&Me()(n,t)}));return!0===o&&(r.push(s.rb.archive),d&&i.push(l)),e.events.push({Action:3,ID:t.ID,Message:{ID:t.ID,Unread:t.Unread,ConversationID:t.ConversationID,LabelIDsAdded:r,LabelIDsRemoved:i}}),e.promises=e.promises.concat(h(r,Cf)).concat(h(i,If)),e}),{events:[],promises:[]}),y=b.events,E=b.promises,S=e.all(E);if(n.addToDispatcher(S),!0===c)return v(y);S.then((function(){return v(y)})),u.track(S)}function E(e){var r=i.star({IDs:e}),a=[s.rb.starred];if(n.addToDispatcher(r),!t.cacheContext())return r.then((function(){return o.call()})),u.track(r);var c=Be()(Re()((function(e){return n.getMessageCached(e)})),Ue()(Boolean),Ne()((function(e,t){var r=t.ID,o=t.ConversationID,i=t.Unread,c=n.getConversationCached(o)||{},s=c.ContextNumUnread;return e.push({Action:3,ID:r,Message:{ID:r,Unread:i,LabelIDsAdded:a}}),c&&e.push({Action:3,ID:o,Conversation:{ID:o,ContextNumUnread:s,Labels:ai(c,{toAdd:a})}}),e}),[]))(e);n.events(c)}function S(e){var r=i.unstar({IDs:e}),a=[s.rb.starred];if(n.addToDispatcher(r),!t.cacheContext())return r.then((function(){return o.call()})),u.track(r);var c=Be()(Re()((function(e){return n.getMessageCached(e)})),Ue()(Boolean),Ne()((function(e,t){var r=t.ID,o=t.ConversationID,i=t.Unread,c=n.getConversationCached(o)||{},u=c.ContextNumUnread,l=n.queryMessagesCached(o),d=J()(l,(function(e){var t=e.LabelIDs,n=void 0===t?[]:t;return Me()(n,s.rb.starred)}));return e.push({Action:3,ID:r,Message:{ID:r,Unread:i,LabelIDsRemoved:a}}),1===d.length&&c&&e.push({Action:3,ID:o,Conversation:{ID:o,ContextNumUnread:u,Labels:ai(c,{toRemove:a})}}),e}),[]))(e);n.events(c)}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=bt()(e,(function(e,t){var r=n.getMessageCached(t)||{},a=r.Unread,o=r.ConversationID,i=r.LabelIDs;return 1===a&&(e.conversationIDs.push(o),e.events.push({Action:3,ID:t,Message:{ID:t,ConversationID:o,Unread:0}}),e.messages.push({LabelIDs:i,ConversationID:o})),e}),{messages:[],conversationIDs:[],events:[]}),a=r.messages,o=r.conversationIDs,c=r.events;if(a.length){Be()(Xi.a,Re()((function(e){return n.getConversationCached(e)})),Ue()(Boolean),nc()((function(e){var t=e.ID,n=e.Labels,r=void 0===n?[]:n;c.push({Action:3,ID:t,Conversation:{ID:t,Labels:k()(r,(function(e){return e.ContextNumUnread-=J()(a,(function(n){var r=n.ConversationID,a=void 0===r?"":r,o=n.LabelIDs,i=void 0===o?[]:o;return t===a&&Me()(i,e.ID)})).length,e}))}})})))(o);var s=i.read({IDs:e});if(n.addToDispatcher(s),!0===t.cacheContext())return n.events(c);s.then((function(){return n.events(c)})),u.track(s)}}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=t.cacheContext(),a=i.unread({IDs:e});if(n.addToDispatcher(a),!r)return a.then(o.call),u.track(a);var c=bt()(e,(function(e,t){var r=n.getMessageCached(t)||{},a=r.Unread,o=r.ConversationID,i=r.LabelIDs;return 0===a&&(e.conversationIDs.push(o),e.events.push({Action:3,ID:t,Message:{ID:t,ConversationID:o,Unread:1}}),e.messages.push({LabelIDs:i,ConversationID:o})),e}),{messages:[],conversationIDs:[],events:[]}),s=c.messages,l=c.conversationIDs,d=c.events;s.length&&Be()(Xi.a,Re()((function(e){return n.getConversationCached(e)})),Ue()(Boolean),nc()((function(e){var t=e.ID,n=e.Labels,r=void 0===n?[]:n;d.push({Action:3,ID:t,Conversation:{ID:t,Labels:k()(r,(function(e){return e.ContextNumUnread+=J()(s,(function(n){var r=n.ConversationID,a=void 0===r?"":r,o=n.LabelIDs,i=void 0===o?[]:o;return t===a&&Me()(i,e.ID)})).length,e}))}})})))(l),n.events(d)}function I(e){var r=bt()(e,(function(e,t){var r=n.getMessageCached(t),a=n.getConversationCached(r.ConversationID);if(a&&(1===a.NumMessages&&e.push({Action:s.kc.DELETE,ID:a.ID,Conversation:{ID:a.ID,Labels:a.Labels,NumMessages:0}}),a.NumMessages>1)){var o=n.queryMessagesCached(a.ID),i=Be()(Ue()((function(e){return e.ID!==t})),Ne()((function(e,t){var n=t.LabelIDs,r=void 0===n?[]:n;return e.concat(r)}),[]),Xi.a,Re()((function(e){return{ID:e}})))(o);e.push({Action:s.kc.UPDATE_FLAGS,ID:a.ID,Conversation:{ID:a.ID,Labels:i,NumMessages:a.NumMessages-1}})}return e.push({Action:s.kc.DELETE,ID:r.ID}),e}),[]),a=i.delete({IDs:e});return n.addToDispatcher(a),!0===t.cacheContext()?(n.events(r),a):(a.then((function(){return n.events(r)})),u.track(a),a)}return f("messageActions",(function(e,t){var r=t.type,a=void 0===r?"":r,o=t.data,c=void 0===o?{}:o;switch(a){case"move":b(c);break;case"star":E(c.ids);break;case"unstar":S(c.ids);break;case"read":D(c.ids);break;case"unread":A(c.ids);break;case"delete":I(c.ids);break;case"unlabel":!function(e,t,r){var a=[],o=n.queryMessagesCached(t);a.push({Action:3,ID:e,Message:{ID:e,LabelIDsRemoved:[r]}});var c=Be()(Ne()((function(t,n){var a=n.ID,o=n.LabelIDs,i=void 0===o?[]:o;return a===e?t.concat(i.filter((function(e){return e!==r}))):t.concat(i)}),[]),Xi.a,Re()((function(e){return{ID:e}})))(o);a.push({Action:3,ID:t,Conversation:{ID:t,Labels:c}}),n.events(a),i.unlabel({LabelID:r,IDs:[e]})}(c.messageID,c.conversationID,c.labelID);break;case"label":y(c.messages,c.labels,c.alsoArchive);break;case"folder":b(c)}})),{move:b,addLabel:y,star:E,unstar:S,read:D,unread:A,destroy:I,discardMessage:function(e){I([e.ID])}}}var Of=wf;function Mf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mf(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mf(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xf(e,t){var n=t.build("messages"),r=function(t){return e.put(n("label"),t)},a=function(t){return e.put(n("unlabel"),t)},o=function(t,r){return e.delete(n("empty"),{params:{LabelID:t,AddressID:r}})};return{send:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.post(n(t.id),t,r)},createDraft:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.post(n(),t)},get:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.get(n(t))},query:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.get(n(),{params:t})},count:function(){return e.get(n("count"))},updateDraft:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.ID||t.id;return e.put(n(r),t)},star:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(Pf({LabelID:s.rb.starred},e))},unstar:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(Pf({LabelID:s.rb.starred},e))},read:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.put(n("read"),t)},unread:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.put(n("unread"),t)},trash:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(Pf({LabelID:s.rb.trash},e))},inbox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(Pf({LabelID:s.rb.inbox},e))},spam:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(Pf({LabelID:s.rb.spam},e))},receipt:function(t){return e.post(n(t,"receipt"))},archive:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(Pf({LabelID:s.rb.archive},e))},delete:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.put(n("delete"),t)},undelete:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.put(n("undelete"),t)},label:r,emptyDraft:function(){return o(s.rb.drafts)},emptyAllDraft:function(){return o(s.rb.allDrafts)},emptySpam:function(){return o(s.rb.spam)},emptyTrash:function(){return o(s.rb.trash)},emptyLabel:o,unlabel:a}}xf.$inject=["$http","url"];var Tf=xf,Lf=n("lwsE"),jf=n.n(Lf),Nf=n("W8MJ"),$f=n.n(Nf),Rf=n("zZ0H"),_f=n.n(Rf),Uf=n("i69e");function Ff(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new Uf.a({bulletListMarker:"-",strongDelimiter:"",emDelimiter:"",hr:""}),a={filter:function(e){return e.classList.contains("protonmail_signature_block")},replacement:function(e){return"​".concat(e.trim(),"​")}},o={filter:"br",replacement:function(e,t){return"DIV"===t.parentElement.nodeName&&1===t.parentElement.childElementCount?t.parentElement.textContent?"\n":"\n\n":"BR"===t.parentElement.lastElementChild.nodeName&&t.parentElement.textContent?"LI"!==t.parentElement.nodeName?"\n":"":"\n\n"}},i={filter:"img",replacement:function(e,t){if(!n)return"";var r=t.alt||t.src;return r?"[".concat(r,"]"):""}},c={filter:"a",replacement:function(e,t){return t.textContent}},s={filter:["div"],replacement:function(e){return e}};r.use([function(){return r.addRule("replaceAnchor",c)},function(){return r.addRule("replaceDiv",s)},function(){return r.addRule("replaceImg",i)},function(){return r.addRule("replaceBreakLine",o)},function(){return r.addRule("protonSignature",a)}]),r.escape=_f.a;var u=r.turndown(e);return u.startsWith("​")&&t?"\n\n\n".concat(u,"\n\n"):u}function Bf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bf(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bf(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Vf.$inject=["$timeout","dispatchers","embeddedUtils","gettextCatalog","AttachmentLoader","sanitize","getEncryptionType","attachmentConverter","publicKeyStore","attachedPublicKey","addressesModel","readReceiptModel","keysModel","translator"];var Gf=s.Gb.PLAINTEXT;function Vf(e,t,n,r,a,i,u,l,d,p,f,v,m,g){var h=g((function(){return{ENCRYPTION_ERROR:r.getString("Error encrypting message",null,"Error"),ENCRYPTED_HEADERS_FILENAME:r.getString("Encrypted Headers",null,"Encrypted Headers filename"),EMPTY:r.getString("Message empty",null,"Message content if empty")}})),b={ID:"",Order:0,Subject:"",PasswordHint:"",Unread:0,Flags:0,Sender:{},ToList:[],Time:0,Size:0,Attachments:[],NumAttachments:0,ExpirationTime:0,AddressID:"",CCList:[],BCCList:[],LabelIDs:[],ExternalID:null},y=["X-Autoreply","X-Autorespond","X-Autoreply-From","X-Mail-Autoreply"],E=t(["message"]).dispatcher,S=function(){function t(e){jf()(this,t),Ge()(this,angular.copy(e));var n=e.ParsedHeaders,r=void 0===n?{}:n,a=e.xOriginalTo;return this.isAutoReply=y.some((function(e){return e in r})),this.xOriginalTo=a||r["X-Original-To"],this}var r,g,b,S;return $f()(t,[{key:"addFlag",value:function(e){this.Flags=Object(_o.c)(this.Flags,e)}},{key:"toggleFlag",value:function(e){this.Flags=Object(_o.d)(this.Flags,e)}},{key:"removeFlag",value:function(e){this.Flags=Object(_o.a)(this.Flags,e)}},{key:"toggleReadReceipt",value:function(){this.toggleFlag(s.Db.FLAG_RECEIPT_REQUEST)}},{key:"toggleAttachPublicKey",value:function(){this.toggleFlag(s.Db.FLAG_PUBLIC_KEY),this.isAttachPublicKey()&&this.addFlag(s.Db.FLAG_SIGN)}},{key:"toggleSign",value:function(){this.toggleFlag(s.Db.FLAG_SIGN)}},{key:"isEO",value:function(){return!!this.Password}},{key:"getVerificationStatus",value:function(){return this.verified}},{key:"generateReplyToken",value:function(){return Object(ee.d)(s.b).then((function(e){return Object(lt.j)(Object(lt.b)(e))}))}},{key:"encryptionType",value:function(){var e=u(this);return e.length>this.verified&&(Object(tr.f)(this)||!Object(tr.s)(this)||Object(tr.k)(this))?e[this.verified]:e[0]}},{key:"isPlainText",value:function(){return this.MIMEType===Gf}},{key:"isSentByMe",value:function(){var e=this.Sender.Address;return f.getByEmail(e)}},{key:"plainText",value:function(){return this.getDecryptedBody()}},{key:"disableOthers",value:function(){return this.saving&&!this.autosaving||this.sending||this.encrypting||this.askEmbedding}},{key:"disableSend",value:function(){return this.uploading>0||this.disableOthers()}},{key:"disableSave",value:function(){return this.disableSend()}},{key:"disableDiscard",value:function(){return this.disableSend()}},{key:"getAttachment",value:function(e){return le()(this.Attachments||[],{ID:e})}},{key:"getAttachments",value:function(){return this.Attachments||[]}},{key:"attachmentsSize",value:function(){return(this.Attachments||[]).reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.Size,r=void 0===n?0:n;return e+ +r}),0)}},{key:"countEmbedded",value:function(e){if(this.isPlainText())return 0;var t=e||n.getBodyParser(this.getDecryptedBody());return n.extractEmbedded(this.Attachments,t).length}},{key:"addAttachments",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.Attachments=[].concat(this.Attachments,e),this.NumEmbedded=this.countEmbedded()}},{key:"removeAttachment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ID;this.Attachments=(this.Attachments||[]).filter((function(e){return e.ID!==t})),this.NumEmbedded=this.countEmbedded()}},{key:"setDecryptedBody",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.DecryptedBody=t?Object(Kt.e)(i.message(e)):e}},{key:"getDecryptedBody",value:function(){return this.DecryptedBody||""}},{key:"exportPlainText",value:function(){return"text/html"!==this.MIMEType?this.getDecryptedBody().replace(/\u200B/g,""):Ff(this.getDecryptedBody(),!0,!0).replace(/\u200B/g,"")}},{key:"getParsedHeaders",value:function(e){var t=this.ParsedHeaders,n=void 0===t?{}:t;return e?n[e]:n}},{key:"getListUnsubscribe",value:function(){return this.getParsedHeaders("List-Unsubscribe")||""}},{key:"getListUnsubscribePost",value:function(){return this.getParsedHeaders("List-Unsubscribe-Post")||""}},{key:"requireReadReceiptConfirmation",value:function(){return v.requireConfirmation(this)}},{key:"close",value:function(){angular.isDefined(this.timeoutSaving)&&e.cancel(this.timeoutSaving)}},{key:"encryptBody",value:(S=c()(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=m.getPrivateKeys(this.From.ID)[0],e.t0=ut.a,e.t1=this.getDecryptedBody(),e.next=6,Object(ee.f)(t);case 6:return e.t2=e.sent,e.t3=n,e.t4={data:e.t1,publicKeys:e.t2,privateKeys:e.t3,format:"utf8",compression:!0},e.next=11,(0,e.t0)(e.t4);case 11:return r=e.sent,a=r.data,this.Body=a,e.abrupt("return",a);case 17:throw e.prev=17,e.t5=e.catch(0),new Error(h.ENCRYPTION_ERROR);case 20:case"end":return e.stop()}}),e,this,[[0,17]])}))),function(e){return S.apply(this,arguments)})},{key:"decryptMIME",value:(b=c()(o.a.mark((function e(t){var n,r,a,i,c,u,d,p,f,v,m,g,b,y,E,S;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.message,r=t.messageDate,a=t.privateKeys,i=t.publicKeys,c=h.ENCRYPTED_HEADERS_FILENAME,u=this.Sender.Address,e.next=5,Object(st.a)({message:n,messageDate:r,privateKeys:a,publicKeys:i,headerFilename:c,sender:u});case 5:return d=e.sent,e.prev=6,e.next=9,d.getBody();case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0={};case 12:return p=e.t0,f=p.body,v=void 0===f?h.EMPTY:f,m=p.mimetype,g=void 0===m?Gf:m,this.MIMEType=g,e.next=20,d.verify();case 20:return b=e.sent,y=i.length||b!==s.uc.SIGNED_AND_INVALID?b:s.uc.SIGNED_NO_PUB_KEY,e.t1=l,e.t2=this,e.next=26,d.getAttachments();case 26:return e.t3=e.sent,e.t4=y,E=(0,e.t1)(e.t2,e.t3,e.t4),e.next=31,d.getEncryptedSubject();case 31:return S=e.sent,e.abrupt("return",{message:v,attachments:E,verified:y,encryptedSubject:S});case 35:return e.prev=35,e.t5=e.catch(6),this.MIMEParsingFailed=!0,e.abrupt("return",{message:n,attachments:[],verified:0});case 39:case"end":return e.stop()}}),e,this,[[6,35]])}))),function(e){return b.apply(this,arguments)})},{key:"decryptBody",value:function(){var e=this,t=m.getPrivateKeys(this.AddressID),n=this.Body;this.decrypting=!0;return function(e){return e?d.get([e]).then((function(t){return t[e]})):Promise.resolve(null)}((this.Sender||{}).Address).then((function(r){var a=r.reduce((function(e,t){var n=t.key;return!t.compromised&&e.push(n),e}),[]);return e.isMIME()?e.decryptMIME({message:n,messageDate:Object(tr.c)(e),privateKeys:t,publicKeys:a}).then((function(t){return e.decrypting=!1,t})):Object(st.c)({message:n,messageDate:Object(tr.c)(e),privateKeys:t,publicKeys:a}).then((function(t){var n=t.data,a=t.verified,o=void 0===a?s.uc.NOT_SIGNED:a;e.decryptedMIME=n,e.decrypting=!1,e.hasError=!1;var i=s.uc.SIGNED_AND_INVALID,c=s.uc.SIGNED_NO_PUB_KEY;return{message:n,attachments:[],verified:r.length||o!==i?o:c}}))})).catch((function(t){throw e.networkError=-1===t.status,e.hasError=!0,e.decrypting=!1,t}))}},{key:"encryptAttachmentKeyPackets",value:(g=c()(o.a.mark((function e(){var t,n,r,i,c=this,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:"",n=s.length>1&&void 0!==s[1]?s[1]:[],r={},!t.length){e.next=9;break}return e.next=6,Object(ee.f)(t);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=[];case 10:return i=e.t0,e.abrupt("return",Promise.all(this.Attachments.filter((function(e){return e.ID.indexOf("PGPAttachment")})).map((function(e){return a.getSessionKey(c,e).then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.sessionKey,o=void 0===a?{}:a,c=t.AttachmentID,s=t.ID;return e.sessionKey=o,Object(N.b)({data:o.data,algorithm:o.algorithm,publicKeys:i,passwords:n}).then((function(e){var t=e.message;r[c||s]=Object(lt.j)(Object(lt.b)(t.packets.write()))}))}))}))).then((function(){return r})));case 12:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"emailsToString",value:function(){return k()(this.ToList.concat(this.CCList,this.BCCList),"Address")}},{key:"getAttachedPublicKey",value:function(){return p.extractFromEmail(this)}},{key:"clearTextBody",value:(r=c()(o.a.mark((function e(){var t,n,r,i=this,c=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]&&c[0],n=!(c.length>1&&void 0!==c[1])||c[1],!this.getDecryptedBody()||t){e.next=4;break}return e.abrupt("return",this.getDecryptedBody());case 4:return e.prev=4,e.next=7,this.decryptBody();case 7:if(r=e.sent,this.Attachments=r.attachments.length?r.attachments:this.Attachments,this.isMIME()){e.next=12;break}return e.next=12,Promise.all(this.Attachments.filter(a.has).map((function(e){return a.reverify(e,i)})));case 12:return this.setDecryptedBody(r.message,!this.isPlainText()),this.verified=r.verified,this.failedDecryption=!1,r.encryptedSubject&&this.Subject!==r.encryptedSubject&&(this.encryptedSubject=r.encryptedSubject),this.NumAttachments=this.Attachments.length,n&&(this.NumEmbedded=this.countEmbedded()),e.next=20,this.getAttachedPublicKey();case 20:return this.attachedPublicKey=e.sent,this.hasError=!1,E.message("decrypted",{message:this}),e.abrupt("return",this.getDecryptedBody());case 26:throw e.prev=26,e.t0=e.catch(4),this.setDecryptedBody(this.Body,!1),this.MIMEType=Gf,this.failedDecryption=!0,this.hasError=!0,e.t0;case 33:case"end":return e.stop()}}),e,this,[[4,26]])}))),function(){return r.apply(this,arguments)})},{key:"loadPGPAttachments",value:function(){var e=this;return this.decryptBody().then((function(t){e.Attachments=ga()(e.Attachments.concat(t.attachments),!1,(function(e){return e.ID})),e.NumAttachments=e.Attachments.length,e.NumEmbedded=e.countEmbedded()})).then((function(){return e.getAttachedPublicKey()})).then((function(t){return e.attachedPublicKey=t}))}}]),t}();return Object(tr.a)(S.prototype),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new S(Kf({},b,{},e))}}var qf=Vf;function Hf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hf(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hf(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Yf(e){return{getAddress:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=t.indexOf("+"),r=t.indexOf("@");if(-1!==n&&-1!==r){var a=e.getByEmail(Object(Ot.f)(t)),o=a||{},i=o.Status,c=o.Receive,s=o.Send;if(i&&c&&s){var u=t.substring(n+1,r);return zf({},a,{Email:Object(Ot.a)(a.Email,u)})}}}}}Yf.$inject=["addressesModel"];var Wf=Yf;function Xf(){var e=Eo()(['<div class="'," ",'">\n                <div class="'," ",'">',"</div>",'\n                <div class="'," ",'">',"</div>\n            </div>"]);return Xf=function(){return e},e}av.$inject=["authentication","tools","sanitize","AppModel","dispatchers","mailSettingsModel"];var Jf="protonmail_signature_block",Qf="protonmail_signature_block-user",Zf="protonmail_signature_block-proton",ev="protonmail_signature_block-empty";function tv(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e?'<div class="'.concat(e,'">'):"<div>";return"".concat(t,"<br /></div>")}var nv=function(e){return!e||"<div><br /></div>"===e||"<div><br></div>"===e},rv=function(e){return e.firstElementChild&&"DIV"===e.firstElementChild.nodeName?Ff(e.innerHTML,!1):e.textContent};function av(e,t,n,r,a,o){var i=a().on,c=o.get("PMSignature"),u=l(c);function l(e){if(!e)return{HTML:"",PLAIN:""};var t=document.createElement("DIV");return t.innerHTML=s.Tb,{HTML:s.Tb,PLAIN:t.textContent}}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=$.parseHTML("<div>".concat(p(e,!1,!0),"</div>"))||[],n=G()(t,1)[0];return rv(n)}function p(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).From,r=void 0===e?{}:e,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=function(e){var t=nv(e),n=!u.HTML;return{userClass:t?ev:"",protonClass:n?ev:"",containerClass:t&&n?ev:""}}(e),i=o.userClass,c=o.protonClass,s=o.containerClass,l=f(e,r),d=Object(So.a)(Xf(),Jf,s,Qf,i,t.replaceLineBreaks(e),l.between,Zf,c,t.replaceLineBreaks(u.HTML));if(!a)return"".concat(l.start).concat(n.message(d)).concat(l.end);return n.message(d)}(r.Signature||"",a,o)}i("mailSettings",(function(e,t){if("updated"===t.type){var n=o.get("PMSignature");if(c===n)return;u=l(c=n)}}));var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=nv(e),r=n&&!u.HTML;return{start:r?tv():tv()+tv(),end:t?tv():"",between:!n&&u.HTML?tv():""}};function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{getDecryptedBody:angular.noop},t=arguments.length>1?arguments[1]:void 0,n=t.action,r=void 0===n?"new":n,a=t.isAfter,o=void 0!==a&&a?"beforeEnd":"afterBegin",i=p(e,"new"!==r),c=$.parseHTML("<div>".concat(e.getDecryptedBody(),"</div>")),s=G()(c,1)[0];return s.insertAdjacentHTML(o,i),s.innerHTML}return{insert:v,update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{getDecryptedBody:q.a,isPlainText:q.a},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e.isPlainText())return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return e.replace(/\u200B(\s*?.*?)*?\u200B/,t)}(e.getDecryptedBody(),d(e));var r=e.From,a=(void 0===r?{}:r).Signature||"",i=$.parseHTML("<div>".concat(n.message(t||e.getDecryptedBody()),"</div>"))||[],c=G()(i,1)[0],s=$.parseHTML("<div>".concat(n.message(a),"</div>"))||[],u=G()(s,1)[0];if(c&&u){var l=c.querySelector("."+Qf),p=nv(u.innerHTML),f=!o.get("PMSignature");if(!l)return v(e,{isAfter:!0});l.classList[p?"add":"remove"](ev),l.parentElement.classList[p&&f?"add":"remove"](ev),l.innerHTML=u.innerHTML}return c.innerHTML},getHTML:p,getTXT:d}}var ov=av;function iv(e,t,n,r){var a=function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,c,s,u,l,d,p,f,v,m,g,h,b,y,E,S;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.Subject,r=void 0===n?"":n,a=t.ToList,i=void 0===a?[]:a,c=t.CCList,s=void 0===c?[]:c,u=t.BCCList,l=void 0===u?[]:u,d=t.AddressID,p=t.From,v=(f=void 0===p?{}:p).DisplayName,m=f.Email,g=f.Keys,h=g||{},b=G()(h,1),y=b[0],E=(y=void 0===y?{}:y).PublicKey,e.next=7,t.encryptBody(E);case 7:return S=e.sent,e.abrupt("return",{Message:{AddressID:d,Body:S,Subject:r,ToList:i,CCList:s,BCCList:l,Unread:0,Sender:{Name:v||"",Address:m}}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function i(e){return s.apply(this,arguments)}function s(){return(s=c()(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.AutoSaveContacts,e.next=3,r(t,t.emailsToString());case 3:return a=e.sent,e.abrupt("return",{id:t.ID,AutoSaveContacts:n,ExpiresIn:t.ExpiresIn,Packages:a});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var u=function(){var t=c()(o.a.mark((function t(n){var r,i,c,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a(n);case 2:return r=t.sent,t.next=5,e.createDraft(r);case 5:return i=t.sent,c=i.data,s=void 0===c?{}:c,t.abrupt("return",s.Message);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),l=function(){var t=c()(o.a.mark((function t(n){var r,a,c,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i(n);case 2:return r=t.sent,t.next=5,e.send(r);case 5:return a=t.sent,c=a.data,s=void 0===c?{}:c,t.abrupt("return",s.Message);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return function(){var e=c()(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t);case 2:return n=e.sent,r=n.ID,a=n.MIMEType,t.ID=r,t.MIMEType=a,e.abrupt("return",l(t));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}iv.$inject=["messageApi","User","srp","encryptMessage"];var cv=iv;function sv(e){return e({controllerAs:"ctrl",templateUrl:n("1haq"),controller:["params",function(e){var t=this;this.keyInfo=e.keyInfo,this.addresses=e.addresses,this.isInternal=e.isInternal,this.cancel=e.cancel,this.submit=function(){e.submit(t.addresses)}}]})}sv.$inject=["pmModal"];var uv=sv;function lv(e,t,n,r,a,o,i,c){var s=[],u=/<(.*?)>/g,l="List-Unsubscribe=One-Click",d=e(["message"]),p=d.dispatcher,f=d.on,v=c((function(){return{SUCCESS:n.getString("Unsubscribed",null,"Success notification")}}));function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=r(),o=e.replace("mailto:",""),c=o.indexOf("?");c<0&&(c=o.length);var s=o.substring(0,c),u=Object(Pe.o)(o).searchObject,l=void 0===u?{}:u;return n.AddressID=t.ID,n.From=t,n.Password="",n.AutoSaveContacts=0,s&&(n.ToList=s.split(",").map((function(e){return{Address:e,Name:e}}))),n.Subject=l.subject||"Unsubscribe me",n.setDecryptedBody(l.body||"Unsubscribe me please"),i(n).then((function(){return a.success(v.SUCCESS)}))}var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=new FormData;return t.append("List-Unsubscribe","One-Click"),o({method:"POST",url:e,data:t,noOfflineNotify:!0})};return f("message",(function(e,n){var r=n.type,a=n.data;"unsubscribe"===r&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.getListUnsubscribe(),r=e.getListUnsubscribePost()===l,a=(n.match(u)||[]).map((function(e){return e.replace("<","").replace(">","")})),o=t.get(e).address;We()(a,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.startsWith("http");e.startsWith("mailto:")&&m(e,o),t&&!r&&Object(Pe.n)(e),t&&r&&g(e)})),s.push(n),p.message("unsubscribed",{message:e})}((void 0===a?{}:a).message)})),{init:angular.noop,already:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e.length&&Me()(s,e)},beginsWith:function(e,t){var n=(e.getListUnsubscribe().match(u)||[]).map((function(e){return e.replace("<","").replace(">","")}));return le()(n,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith(t)}))}}}lv.$inject=["dispatchers","composerFromModel","gettextCatalog","messageModel","notification","requestFormData","simpleSend","translator"];var dv=lv;function pv(e,t){var n=t((function(){return{pm:[e.getString("End-to-end encrypted message",null,"Message encryption status"),e.getString("End-to-end encrypted message from verified address",null,"Message encryption status"),e.getString("Sender verification failed",null,"Message encryption status")],pgp:[e.getString("PGP-encrypted message",null,"Message encryption status"),e.getString("PGP-encrypted message from verified address",null,"Message encryption status"),e.getString("Sender verification failed",null,"Message encryption status")],clear:[e.getString("Stored with zero access encryption",null,"Message encryption status"),e.getString("PGP-signed message from verified address",null,"Message encryption status"),e.getString("Sender verification failed",null,"Message encryption status")],sentEncrypted:[e.getString("Sent by you with end-to-end encryption",null,"Message encryption status"),e.getString("Sent by you with end-to-end encryption",null,"Message encryption status"),e.getString("Sender verification failed",null,"Message encryption status")],auto:[e.getString("Sent by ProtonMail with zero access encryption",null,"Message encryption status")],sentClear:[e.getString("Stored with zero access encryption",null,"Message encryption status"),e.getString("Stored with zero access encryption",null,"Message encryption status"),e.getString("Sender verification failed",null,"Message encryption status")],draft:[e.getString("Encrypted message",null,"Message encryption status")]}}));return function(e){return Object(tr.s)(e)?n.sentEncrypted:Object(tr.g)(e)?n.auto:Object(tr.q)(e)?n.sentClear:Object(tr.h)(e)?n.draft:Object(tr.m)(e)?n.pm:Object(tr.i)(e)?n.pgp:n.clear}}pv.$inject=["gettextCatalog","translator"];var fv=pv;Ev.$inject=["Key","addressesModel","mailSettingsModel"];var vv=Da.a.KEY_GET_ADDRESS_MISSING,mv=Da.a.KEY_GET_DOMAIN_MISSING_MX,gv=Da.a.KEY_GET_INPUT_INVALID,hv=s.Wb.TYPE_NO_RECEIVE,bv=s.Wb.TYPE_INTERNAL,yv=10*s.nc.MINUTE;function Ev(e,t,n){var r={},a=[vv,mv,gv],i=function(t){return e.keys({params:{Email:t},suppress:a}).then((function(e){e.Code;return j()(e,["Code"])})).catch((function(e){var t=e.data,n=void 0===t?{}:t;if(a.includes(n.Code))return{RecipientType:hv,MIMEType:null,Keys:[]};throw e}))},s=function(e){if(e){var t=e.Receive,r=e.Keys,a=(void 0===r?[]:r).map((function(e){var t=e.PublicKey;return{Flags:e.Flags,PublicKey:t}}));return{RecipientType:t?bv:hv,MIMEType:n.get("ReceiveMIMEType"),Keys:a}}},u=function(){var e=c()(o.a.mark((function e(n){var a,c,u,l,d,p,f,v,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.getByEmail(n)||{},c=s(a),!a.Receive||!c){e.next=4;break}return e.abrupt("return",c);case 4:if(u=r[n]||{},l=u.data,d=u.time,p=void 0===d?0:d,f=u.promise,!(l&&p+yv>Date.now())){e.next=7;break}return e.abrupt("return",l);case 7:if(!f){e.next=9;break}return e.abrupt("return",f);case 9:return v=i(n),r[n]={promise:v},e.prev=11,e.next=14,v;case 14:return m=e.sent,r[n]={time:Date.now(),data:m},e.abrupt("return",m);case 19:throw e.prev=19,e.t0=e.catch(11),delete r[n],e.t0;case 23:case"end":return e.stop()}}),e,null,[[11,19]])})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=c()(o.a.mark((function e(){var t,n,r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",e.next=3,u(t);case 3:return n=e.sent,e.abrupt("return",n.RecipientType===hv);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{get:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map((function(e){return u(e)}))).then((function(t){return No()(e,t)}))},getKeysPerEmail:u,isInvalid:l,getUserAddressesKeys:s,clearCache:function(){Object.keys(r).forEach((function(e){delete r[e]}))}}}var Sv=Ev;function Dv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dv(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dv(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Av(e,t,n,r,a,i){var u={},l=s.nc.HOUR,d=function(e){return!e||e.Defaults},p=t().on,f=function(e){var t=Object(Ot.e)(e);if(!Et()(u.EMAIL_PUBLIC_KEY,t))return null;var n=u.EMAIL_PUBLIC_KEY[t],r=n.timestamp,a=n.pubKeys;return r+l<Date.now()?(delete u.EMAIL_PUBLIC_KEY[t],null):v()({},e,a)},m=function(){var e=c()(o.a.mark((function e(t){var u,l,p,f,v,m,g,h,b,y,E,S,D,k;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=Object(Ot.e)(t),l=r.findEmail(u,Ot.e),!d(l)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,a.get(l.ContactID);case 6:if(p=e.sent,f=Object(ka.e)(p.vCard.get("key")),v=Object(ka.e)(p.vCard.get("email")),m=oo(v,u)){e.next=12;break}return e.abrupt("return");case 12:if(g=function(e){return e.getGroup()===m},(h=J()(f,g)).length){e.next=16;break}return e.abrupt("return");case 16:if(!p.errors.includes(Da.b.TYPE2_CONTACT_VERIFICATION)){e.next=18;break}return e.abrupt("return",[l.ContactID,[]]);case 18:return e.next=20,n.get([t]);case 20:return b=e.sent,y=b[t].Keys,e.next=24,Object(te.a)(y,"PublicKey");case 24:return E=e.sent,S=E.reduce((function(e,t){var n=t.Flags,r=t.keys;return n&s.kb.ENABLE_VERIFICATION||(e[Object(ee.e)(r[0])]=!0),e}),{}),e.next=28,Promise.all(h.map(function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=kv,e.t1={},e.t2=t,e.next=5,i.parseKey(t);case 5:return e.t3=e.sent,e.t4={keys:e.t3},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t4));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 28:return D=e.sent,k=D.reduce((function(e,t){var n=t.keys;return n.length&&e.push({key:n[0],compromised:!!S[n[0].primaryKey.getFingerprint()]}),e}),[]),e.abrupt("return",[l.ContactID,k]);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var t=c()(o.a.mark((function t(n){var r,a,i,c,l,d,p,f,g;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object(Ot.e)(n),a=e.getByEmail(n)){t.next=11;break}return t.next=5,m(r);case 5:if(!(i=t.sent)){t.next=10;break}return c=G()(i,2),l=c[0],d=c[1],u.EMAIL_PUBLIC_KEY[r]={timestamp:Date.now(),pubKeys:d,contactID:l},t.abrupt("return",v()({},n,d));case 10:return t.abrupt("return",v()({},n,[]));case 11:return p=a.Keys,t.next=14,Object(te.a)(p,"PrivateKey");case 14:return f=t.sent,g=f.reduce((function(e,t){var n=t.Flags,r=t.keys;return e.push({key:r[0].toPublic(),compromised:!(n&s.kb.ENABLE_VERIFICATION)}),e}),[]),u.EMAIL_PUBLIC_KEY[r]={timestamp:Date.now(),pubKeys:g},t.abrupt("return",v()({},n,g));case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=function(){var e=c()(o.a.mark((function e(){var t,n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:[],n=t.reduce((function(e,t){var n=f(t);return n&&(e[t]=n[t]),e}),{}),r=J()(t,(function(e){return!Et()(n,e)})),e.abrupt("return",Promise.all(k()(r,(function(e){return g(e)}))).then((function(e){return Ge.a.apply(void 0,[{}].concat(we()(J()(e))))})).then((function(e){return Ge()({},n,e)})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();p("contacts",(function(e,t){var n=t.type,r=t.data,a=(r=void 0===r?{}:r).events,o=void 0===a?[]:a,i=r.contact,c=void 0===i?{}:i;"contactEvents"===n&&function(e){e.filter((function(e){return e.Contact})).forEach((function(e){return e.Contact.ContactEmails.forEach((function(e){var t=e.Email;return delete u.EMAIL_PUBLIC_KEY[t]}))})),e.forEach((function(e){var t=e.ID;xo()(u.EMAIL_PUBLIC_KEY).filter((function(e){return u.EMAIL_PUBLIC_KEY[e].contactID===t})).forEach((function(e){return delete u.EMAIL_PUBLIC_KEY[e]}))}))}(o),"contactUpdated"===n&&c.ContactEmails.forEach((function(e){var t=e.Email;return delete u.EMAIL_PUBLIC_KEY[t]}))}));var b=function(){u.EMAIL_PUBLIC_KEY={}};return b(),p("logout",(function(){b()})),{get:h}}Av.$inject=["addressesModel","dispatchers","keyCache","contactEmails","Contact","contactKey"];var Iv=Av;function Cv(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(!e.includes("secured.search.**")){var a=t.filter((function(e){return!Me()(e.LabelIDs,s.rb.trash)}));if(!0===e.includes("secured.trash.**")){var o=t.filter((function(e){return Me()(e.LabelIDs,s.rb.trash)}));if(!1===r)return o}else if(a.length>0&&!1===n)return a}return t}}Cv.$inject=["$state"];var wv=Cv;var Ov=function(){return function(e){var t=moment.unix(e);return t.isSame(moment(),"day")?t.format("LT")+" ("+t.fromNow()+")":t.format("L")+" ("+t.fromNow()+")"}};var Mv=function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.includes(",")?'"'.concat(e,'"'):e}};function Pv(e,t){var n=e("contact"),r=function(e){return function(t,r){var a=t.Name||n(t,"Name");return 0===r?"".concat(e,": ").concat(a):a}};return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.ToList,a=void 0===n?[]:n,o=e.CCList,i=void 0===o?[]:o,c=e.BCCList,s=void 0===c?[]:c;return[].concat(a.map(r(t.getString("To",null,"Title")))).concat(i.map(r(t.getString("CC",null,"Title")))).concat(s.map(r(t.getString("BCC",null,"Title")))).join(", ")}}Pv.$inject=["$filter","gettextCatalog"];var xv=Pv,Tv=n("cDf5"),Lv=n.n(Tv),jv=n("9UKM"),Nv=n.n(jv);Fv.$inject=["contactDetailsModel","keyCache","keysModel","autoPinPrimaryKeys","sendPreferences","publicKeyStore","AttachmentLoader","contactEmails","Contact","networkActivityTracker"];var $v=s.O.OPEN_TAG_AUTOCOMPLETE_RAW,Rv=s.O.CLOSE_TAG_AUTOCOMPLETE_RAW,_v=s.uc.SIGNED_AND_INVALID,Uv=5;function Fv(e,t,n,r,a,i,u,l,d,p){var f=function(e){var t=e.replace(Rv,"").split($v),n=G()(t,2),r=n[0],a=void 0===r?"":r,o=n[1],i=void 0===o?"":o;return{name:a.trim(),adr:i.trim()}},v=function(e,t){var n=a.get(k()(t,"adr")),r=i.get(k()(t,"adr"));return Promise.all([n,r]).then((function(n){var r=G()(n,2),a=r[0],o=r[1];return t.filter((function(t){var n=t.adr;return o[n].every((function(t){var n=t.key;return Object(ee.e)(n)!==e.fingerprint}))})).map((function(t){return null!==e.expires&&e.expires<Date.now()?Ge()({},t,{encrypt:!1,expired:!0}):a[t.adr].scheme===s.gc.SEND_PM?Ge()({},t,{encrypt:!1}):0===a[t.adr].publickeys.length?Ge()({},t,{encrypt:!0}):a[t.adr].publickeys[0].getCreationTime()>e.created?Ge()({},t,{encrypt:!1}):Ge()({},t,{encrypt:a[t.adr].encrypt})}))}))},m=function(e,t){var n,r,a,o=t.userIds.map(f).filter((function(e){return e.adr}));return o.length?v(t,o):v(t,[(n=e,r=n.Sender,a=r.Address,{name:r.Name,adr:a})])},g=function(){var e=c()(o.a.mark((function e(r){var a,i,c,u,l,d,p,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getPrivateKeys(r.AddressID),e.next=3,t.get([r.SenderAddress]);case 3:return i=e.sent,c=i[r.SenderAddress].Keys,e.next=7,Object(te.a)(c,"PublicKey");case 7:if(e.t0=function(e,t){var n=t.Flags,r=t.keys;return n&s.kb.ENABLE_VERIFICATION&&e.push(r[0]),e},e.t1=[],0!==(u=e.sent.reduce(e.t0,e.t1)).length){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,Object(st.c)({message:r.Body,messageDate:Object(tr.c)(r),privateKeys:a,publicKeys:u});case 14:if(l=e.sent,d=G()(l.signatures,1),p=d[0],f=void 0!==p&&p){e.next=20;break}return e.abrupt("return",!1);case 20:return e.next=22,Object(ee.g)(f,u);case 22:return v=e.sent,e.abrupt("return",v.armor());case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(e){if(!Et()(e.ParsedHeaders,"Autocrypt"))return[];var t=Object(ka.e)(e.ParsedHeaders.Autocrypt);return J()(t.map((function(e){if(!e.match(/^(\s*(_[^;\s]*|addr|prefer-encrypt)\s*=\s*[^;\s]*\s*;)*\s*keydata\s*=([^;]*)$/))return null;if(!e.match(/^(\s*(_[^;\s]*|addr)\s*=\s*[^;\s]*\s*;)*\s*prefer-encrypt\s*=\s*mutual\s*;/))return null;var t=e.match(/^(?:\s*(?:[^;\s]*)\s*=\s*[^;\s]*\s*;)*\s*keydata\s*=([^;]*)$/);try{return Object(lt.d)(Object(lt.g)(t[1]))}catch(n){return null}})))},b=function(){var e=c()(o.a.mark((function e(t,r){var a,i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getPrivateKeys(t.AddressID),e.prev=1,e.next=4,Object(st.c)({message:t.Body,messageDate:Object(tr.c)(t),privateKeys:a});case 4:return i=e.sent,c=i.signatures,s=Lo()(c.map((function(e){var t=e.packets;return Object.values(t).filter((function(e){return"object"===Lv()(e)}))}))),u=s.map((function(e){return e.issuerKeyId.bytes})),e.next=10,Object(te.a)(r,"publicKeyArmored");case 10:return e.t0=function(e){var t=e.keys,n=Lo()(t.map((function(e){return e.getKeyIds().map((function(e){return e.bytes}))})));return 0!==Ma()(n,u).length},e.abrupt("return",e.sent.filter(e.t0));case 14:return e.prev=14,e.t1=e.catch(1),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=c()(o.a.mark((function e(t,n){var r,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==(r=ri()(t,"publicKeyArmored")).length){e.next=3;break}return e.abrupt("return",r[0]);case 3:if(1!==(a=r.filter((function(e){return e.userIds.some((function(e){return-1!==e.search("<".concat(n.Sender.Address,">"))}))}))).length){e.next=6;break}return e.abrupt("return",a[0]);case 6:if(0!==a.length){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,b(n,a);case 10:if(1!==(i=e.sent).length){e.next=13;break}return e.abrupt("return",i[0]);case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=c()(o.a.mark((function e(t){var n,r,a,i,c,l,d,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(tr.l)(t)){e.next=2;break}return e.abrupt("return",t.verified===_v&&g(t));case 2:if(!((n=t.Attachments.filter((function(e){var t=e.Name,n=e.Size;return".asc"===t.toLowerCase().substring(t.length-4)&&n<s.pb}))).length>Uv)){e.next=5;break}return e.abrupt("return",!1);case 5:return r=function(e){return Object(Sa.a)(e).catch((function(){return!1}))},e.next=8,Promise.all(n.map((function(e){return u.get(e,t)})));case 8:return a=e.sent,i=a.map(lt.b),e.t0=J.a,e.next=13,Promise.all(i.map(r));case 13:if(e.t1=e.sent,0!==(c=(0,e.t0)(e.t1)).length){e.next=27;break}return l=h(t),e.t2=c.push,e.t3=c,e.t4=we.a,e.t5=J.a,e.next=23,Promise.all(l.map(r));case 23:e.t6=e.sent,e.t7=(0,e.t5)(e.t6),e.t8=(0,e.t4)(e.t7),e.t2.apply.call(e.t2,e.t3,e.t8);case 27:return e.next=29,y(c,t);case 29:if(d=e.sent){e.next=32;break}return e.abrupt("return",!1);case 32:return e.next=34,m(t,d);case 34:return p=e.sent,f=d.publicKeyArmored,e.abrupt("return",!!p.length&&f);case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=c()(o.a.mark((function e(t,n){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="item1",(a=new wa.a).set("fn",n.name||n.adr),a.set("email",n.adr,{group:r}),e.t0=a,e.next=7,Object(te.e)(t);case 7:return e.t1=e.sent,e.t2={group:r},e.t0.set.call(e.t0,"key",e.t1,e.t2),n.encrypt&&(a.set("x-pm-encrypt","true",{group:r}),a.set("x-pm-sign","true",{group:r})),e.abrupt("return",d.add([{vCard:a}]));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var t=c()(o.a.mark((function t(n,r){var a,i,c,s,u,p;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object(Ot.e)(r.adr),i=l.findEmail(a,Ot.e)){t.next=4;break}return t.abrupt("return",S(n,r));case 4:return t.next=6,d.get(i.ContactID);case 6:return c=t.sent,s=Object(ka.e)(c.vCard.get("email")),u=oo(s,a),p=Object(ka.e)(c.vCard.data.key||[]),r.encrypt&&(c.vCard.add("x-pm-encrypt","true",{group:u}),c.vCard.add("x-pm-sign","true",{group:u})),bt()(p,(function(e,t){return t.pref=e,e+1}),2),t.t0=c.vCard,t.t1=e,t.next=16,Object(te.e)(n);case 16:return t.t2=t.sent,t.t3=t.t1.escapeValue.call(t.t1,t.t2),t.t4={group:u,pref:r.encrypt?1:p.length+1},t.t0.add.call(t.t0,"key",t.t3,t.t4),t.abrupt("return",d.updateUnencrypted(c));case 21:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),A=function(e,t){var n=Promise.all(t.map((function(t){return D(e,t)}))).then((function(){return!0}));return p.track(n),n},I=function(e){var t=a.get(k()(e,"adr"));return p.track(t),t};return{extractAddresses:m,extractFromEmail:E,attachPublicKey:function(){var e=c()(o.a.mark((function e(t,n){var a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(n);case 2:if(a=e.sent,!ba()(k()(a,"isVerified"))){e.next=5;break}return e.abrupt("return",A(t,n));case 5:return i=Nv()(a),c=i.filter((function(e){return!G()(e,2)[1].isVerified})),e.next=9,r.resign(c.map((function(e){return G()(e,1)[0]})));case 9:if(e.sent){e.next=12;break}return e.abrupt("return",!1);case 12:return e.abrupt("return",A(t,n));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}}var Bv=Fv;function Kv(e,t,n){var r=function(e){var t=e.Flags,n=e.ParsedHeaders,r=void 0===n?{}:n;if(!Object(tr.q)({Flags:t}))return!1;if(Object(tr.g)({Flags:t}))return!0;return["X-Autoreply","X-Autorespond","X-Autoreply-From","X-Mail-Autoreply"].some((function(e){return e in r}))||[["Auto-Submitted","auto-replied"],["Precedence","auto_reply"],["X-Precedence","auto_reply"],["Delivered-To","autoresponder"]].some((function(e){var t=G()(e,2),n=t[0],a=t[1];return n in r&&r[n].toLowerCase()===a}))},a=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.length,n=!1;--t>0;)if(0===e[t-1].Unread){n=!0;break}var r=n?t:0;return e.length?e[r]:e[0]};return{find:function(){var o,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],c=function(e){return Be()(Ue()(e),$i.a)(i)},s=e.currentLocation();switch(!0){case"message"===e.typeView():o=Ai()(i);break;case!!n.messageID:o=le()(i,{ID:n.messageID});break;case t.includes("secured.starred.**"):case t.includes("secured.label.**"):o=a(J()(i,(function(e){return e.LabelIDs.indexOf(s)>-1&&!Object(tr.h)(e)})));break;case t.includes("secured.allDrafts.**"):case t.includes("secured.drafts.**"):o=c(tr.h);break;default:var u=c((function(e){return!Object(tr.h)(e)&&!r(e)}));if(u&&0===u.Unread){o=u;break}o=a(J()(i,(function(e){return!Object(tr.h)(e)&&!r(e)})))}return o||{}}}}Kv.$inject=["tools","$state","$stateParams"];var Gv=Kv,Vv=n("la6v"),qv=n.n(Vv),Hv=n("v8eK"),zv=n.n(Hv);Zv.$inject=["$filter","addressesModel","composerFromModel","confirmModal","gettextCatalog","mailSettingsModel","messageModel","pgpMimeAttachments","prepareContent","signatureBuilder","translator","textToHtmlMail"];var Yv=s.Gb.PLAINTEXT;function Wv(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new RegExp("^".concat(t),"i").test(e)?e:"".concat(t," ").concat(e)}var Xv=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return J()(e,(function(e){var n=e.Address;return-1===t.indexOf(n.toLowerCase())}))};function Jv(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"new";return e.failedDecryption?[]:/^(reply|replyall)$/.test(t)?function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).Attachments;return(void 0===e?[]:e).filter((function(e){var t=e.Headers["content-disposition"];return void 0!==t&&/^inline/i.test(t)}))}(e):"forward"===t&&e.Attachments||[]}var Qv=function(e,t){return e.MIMEType||t};function Zv(e,t,n,r,a,i,u,l,d,p,f,v){var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.RE_PREFIX,r=t.FW_PREFIX;return{reply:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.Action=s.bc,e.Subject=Wv(r?t.encryptedSubject:t.Subject,n),Object(tr.q)(t)||Object(tr.r)(t)?e.ToList=t.ToList:e.ToList=t.ReplyTos},replyAll:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=r.Subject,i=r.ToList,c=r.ReplyTos,u=r.CCList,l=r.BCCList,d=r.encryptedSubject,p=void 0===d?"":d;if(t.Action=s.cc,t.Subject=Wv(a?p:o,n),Object(tr.q)(r)||Object(tr.r)(r))t.ToList=i,t.CCList=u,t.BCCList=l;else{t.ToList=c,t.CCList=zv()(i,u);var f=k()(e,(function(e){var t=e.Email;return(void 0===t?"":t).toLowerCase()}));t.CCList=Xv(t.CCList,f)}},forward:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.Subject,a=t.encryptedSubject,o=void 0===a?"":a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.Action=s.Y,e.ToList=[],e.Subject=Wv(i?o:n,r)},newCopy:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.Subject,r=void 0===n?"":n,a=t.ToList,o=void 0===a?[]:a,i=t.CCList,c=void 0===i?[]:i,s=t.BCCList,u=void 0===s?[]:s,l=t.DecryptedBody,d=void 0===l?"":l,p=t.encryptedSubject,f=void 0===p?"":p,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.Subject=v?f:r,e.ToList=o,e.CCList=c,e.BCCList=u,d&&e.setDecryptedBody(d)}}}(t.get(),f((function(){return{RE_PREFIX:a.getString("Re:",null,"Message"),FW_PREFIX:a.getString("Fw:",null,"Message")}}))),g=m.reply,h=m.replyAll,b=m.forward,y=m.newCopy,E=f((function(){return{TITLE_ENCRYPTED_SUBJECT:a.getString("Encrypted Subject",null,"Subject"),YES_CONFIRM:a.getString("Yes",null,"Use encrypted subject as subject"),NO_CONFIRM:a.getString("No",null,"Use unencrypted subject as subject"),encryptedSubjectMessage:function(e){return a.getString('The selected message has an encrypted subject.\n                ProtonMail does not support sending an encrypted subject.\n                Do you want to use "{{ encryptedSubject }}" instead of the original unencrypted subject\n                 "{{ Subject }}"?',e,"Ask user to use encrypted subject")}}}));function S(e,t,n){var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).MIMEType;return(void 0===t?"":t)===Yv?v.parse(e):e}(e,t);return d(r,t,{blacklist:["*"],action:n})}function D(e){return new Promise((function(t){r.activate({params:{title:E.TITLE_ENCRYPTED_SUBJECT,message:E.encryptedSubjectMessage(e),confirmText:E.YES_CONFIRM,cancelText:E.NO_CONFIRM,hideClose:!0,confirm:function(){r.deactivate(),t(!0)},cancel:function(){r.deactivate(),t(!1)}}})}))}function A(e){return I.apply(this,arguments)}function I(){return(I=c()(o.a.mark((function e(t){var n,r,a,i=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:{},e.t0=!!n.encryptedSubject,!e.t0){e.next=7;break}return e.next=6,D(n);case 6:e.t0=e.sent;case 7:a=e.t0,"new"===t&&y(r,n,a),"reply"===t&&g(r,n,a),"replyall"===t&&h(r,n,a),"forward"===t&&b(r,n,a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return w.apply(this,arguments)}function w(){return(w=c()(o.a.mark((function t(r){var c,u,d,p,f,v,m=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=m.length>1&&void 0!==m[1]?m[1]:{},(u=m.length>2&&void 0!==m[2]?m[2]:{}).MIMEType=Qv(c,i.get("DraftMIMEType")),u.RightToLeft=i.get("RightToLeft"),i.get("AttachPublicKey")&&u.addFlag(s.Db.FLAG_PUBLIC_KEY),i.get("Sign")&&u.addFlag(s.Db.FLAG_SIGN),t.next=8,A(r,c,u);case 8:return u.xOriginalTo=c.xOriginalTo,d=n.get(c),p=d.address,u.AddressID=c.AddressID,u.From=p,u.Body=c.Body,f=Jv(c,r),u.NumEmbedded=0,u.Attachments=l.clean(f),u.pgpMimeAttachments=l.filter(f),"new"!==r&&(v=function(){return a.getString("On {{date}}, {{name}} {{address}} wrote:",{date:e("localReadableTime")(c.Time),name:c.Sender.Name,address:"&lt;".concat(c.Sender.Address,"&gt;")},"Message")},u.ParentID=c.ID,u.setDecryptedBody("‐‐‐‐‐‐‐ Original Message ‐‐‐‐‐‐‐<br>\n                ".concat(v(),'<br>\n                <blockquote class="protonmail_quote" type="cite">\n                    ').concat(S(c.getDecryptedBody(),c,r),"\n                </blockquote><br>"))),t.abrupt("return",u);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(e){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).AddressID,n=void 0===t?"":t,r=Be()(Ue()({Status:1}),ta()("Order"))(e),a=r[0];if(n){var o=le()(r,{ID:n});o&&(a=o)}return a||{}}(t.get(),e);qv()(e,{Flags:0,ToList:[],CCList:[],BCCList:[],Attachments:[],numTags:[],recipientFields:[],Subject:"",PasswordHint:"",ExpirationTime:0,ExpiresIn:0,From:n,uploading:0,toFocussed:!1,autocompletesFocussed:!1,ccbcc:!1,new:!0})}function M(){return(M=c()(o.a.mark((function e(){var t,n,r,a,i=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"",n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2?i[2]:void 0,O(a=u()),e.next=7,C(t,n,a);case 7:return(a=e.sent).setDecryptedBody(p.insert(a,{action:t,isAfter:r})),e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{create:function(){return M.apply(this,arguments)},prepare:function(e,t){return e.setDecryptedBody(S(e.getDecryptedBody(),e,t)),e},updateSignature:p.update}}var em=Zv,tm=["ftp://","http://","https://","xmpp:","tel:","callto:"],nm=tm.concat(["mailto:"]),rm=tm.reduce((function(e,t){return e[t]=!0,e}),{}),am=function(e){return e.getAttribute("href").trim().toLowerCase()},om=function(e){e.setAttribute("rel","noreferrer nofollow noopener")},im=function(e){if(Object(Kt.h)(e,':not([href=""]):not([href^="#"])')){var t=e.getAttribute("href")||"",n=0===t.indexOf("http"),r=0===t.indexOf("/");(n||r)&&e.setAttribute("target","_blank")}},cm=function(e){if(Object(Kt.h)(e,':not([href=""]):not([href^="#"])')&&!function(e){return nm.some((function(t){return am(e).startsWith(t)}))}(e)&&"A"===e.nodeName){var t=e.getAttribute("href");e.setAttribute("href","http://".concat(t))}},sm=function(e){(function(e){var t=am(e);return""===t||rm[t]})(e)&&(e.style.pointerEvents="none")};var um=function(e){var t=[].slice.call(e.querySelectorAll("[href]"));return We()(t,(function(e){im(e),om(e),cm(e),sm(e)})),e};function lm(e,t,n,r,a){var o=["transformEmbedded","transformWelcome","transformBlockquotes","transformStylesheet"].map((function(t){return{name:t,action:e.get(t)}}));o.unshift({name:"transformLinks",action:um});var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.length?o.filter((function(e){var n=e.name;return t.includes(n)})):e.includes("*")?[]:o.filter((function(t){var n=t.name;return!e.includes(n)}))};function c(e,t){var n=t.isBlacklisted,r=void 0!==n&&n,o=t.action,i=document.createElement("div");return r?(i.innerHTML=function(e){if("string"==typeof e)return e;return e.querySelector("body").innerHTML}(e),i):Dn(e,{action:o,cache:a,isDocument:"string"!=typeof e})}return function(e,a){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=o.blacklist,u=void 0===s?[]:s,l=o.whitelist,d=void 0===l?[]:l,p=o.action,f=o.countEmbedded,v=i(u,d),m=c(e,{action:p,isBlacklisted:Me()(u,"transformRemote")});f&&(a.NumEmbedded=a.countEmbedded(m));var g=v.reduceRight((function(e,t){return t.action(e,a,{action:p})}),m);return u.includes("*")||Me()(u,"transformAttachements")||t(g,a,{action:p}),/^reply|forward/.test(p)&&r(g,a,{action:p}),n(g,a,{action:p}).innerHTML}}lm.$inject=["$injector","transformAttachements","transformRemote","transformEmbedded","cacheBase64"];var dm=lm;function pm(e,t,n){var r=e(["embedded.injected","message.embedded","message.open"]).dispatcher;return function(e,a,o){var i=o.action;return i&&r["message.open"]("embedded.injected",{action:"user.inject.load",map:{},message:a,body:e.innerHTML}),n.$applyAsync((function(){return t.parser(a,{direction:"blob",text:e.innerHTML}).then((function(){return r["message.embedded"]("loaded",{message:a,body:e,action:i})}))})),e}}pm.$inject=["dispatchers","embedded","$rootScope"];var fm=pm;function vm(e){var t=s.j.map((function(e){return"".concat(e,":not(:empty)")})).join(",");return function(n){var r=[].slice.call(n.querySelectorAll(t)),a=n.textContent,o=!1;return r.forEach((function(t){if(!o){var n=t.textContent,r=a.split(n),i=G()(r,2),c=i[0],s=void 0===c?"":c,u=i[1],l=void 0===u?"":u;if(n.length<a.length&&s.length&&!l.length){var d=document.createElement("button"),p=e.getString("Show previous message",null,"Title");d.className="fa fa-ellipsis-h pm_button more proton-message-blockquote-toggle",d.setAttribute("title",p),t.parentNode.insertBefore(d,t),o=!0}}})),n}}vm.$inject=["gettextCatalog"];var mm=vm;function gm(e,t,n){return function(r,a,o){var i=o.action,c=[].slice.call(r.querySelectorAll("img[proton-src]")),u=n.get().ShowImages,l=void 0===u?0:u,d=/^reply|forward/.test(i),p=!0===a.showEmbedded||l&s.P,f=t.is("eo.reply"),v=e.getAttachment(a,r);return c.forEach((function(t){var n=t.getAttribute("proton-src");t.setAttribute("referrerPolicy","no-referrer");var r=v(n);if(t.classList.contains("proton-embedded")||t.classList.add("proton-embedded"),r&&Object.keys(r).length>0||(Object(Bt.c)(n)&&t.parentElement.removeChild(t),Object(Bt.d)(n)))if(p){if(t.setAttribute("data-embedded-img",n),t.removeAttribute("proton-src"),d){var o=e.getUrl(t);return void(o&&t.setAttribute("src",o))}f||(!t.parentElement.classList.contains("loading")&&(i=t,angular.element(i).wrap('<div class="image loading"></div>')),t.removeAttribute("src"))}else{var i;a.showEmbedded=!1,r&&t.setAttribute("alt",r.Name)}})),r}}gm.$inject=["embedded","$state","mailSettingsModel"];var hm=gm;function bm(e,t){var n,r=e(["message.open"]).dispatcher,a=["url","xlink:href","srcset","src","svg","background","poster"].map((function(e){return"proton-".concat(e)})),o=(n=a.map((function(e){return"proton-src"===e?"".concat(e,'=(?!"(cid|data):)'):e})).join("|"),"(".concat(n,")"));function i(e){var t=a.map((function(e){var t=e.split(":"),n=G()(t,1)[0];return"[".concat(n,"]")})).concat("[style]").join(", ");return[].slice.call(e.querySelectorAll(t)).reduce((function(e,t){if(t.hasAttribute("proton-src")){var n=t.getAttribute("proton-src");if(-1!==n.indexOf("cid:"))return e;if(-1!==n.indexOf("data:"))return e}return e.push(function(e){return Be()(Ue()((function(e){return-1!==a.indexOf(e.name)})),Ne()((function(e,t){return e["".concat(t.name)]=t.value,e}),{}))(e.attributes)}(t)),e}),[])}return function(e,n,a){var c=a.action,u=n.showImages||t.get("ShowImages")&s.ac||s.wc.includes(n.Sender.Address),l=e.innerHTML;if(new RegExp(o,"g").test(l)&&(n.showImages=u),u)if("user.inject"===c){var d=i(e),p=/svg/.test(e.innerHTML);(d.length||p)&&r["message.open"]("remote.injected",{action:c,list:d,message:n,hasSVG:p})}else e.innerHTML=l.replace(new RegExp(o,"g"),(function(e,t){return t.substring(7)}));return e}}bm.$inject=["dispatchers","mailSettingsModel"];var ym=bm;var Em=function(){return function(e){var t=e.firstElementChild;return t&&/absolute/.test(t.style.position)&&(t.style.position="inherit"),e}};var Sm=function(){return function(e){var t=[].slice.call(e.querySelectorAll('img[src="/img/app/welcome_lock.gif"]'));return t.length>0&&t.forEach((function(e){e.src="/assets/img/emails/welcome_lock.gif"})),e}};function Dm(){var e=Eo()(["\n\n\n\n                            === Debug stacktrace for the support ===\n                            ","\n                            ","\n                        "]);return Dm=function(){return e},e}function km(e){var t="messageDisplayError-btn-report";return{replace:!0,restrict:"E",templateUrl:n("53yO"),link:function(n,r){var a=e(["bugReport"]).dispatcher,o=function(e){e.target.classList.contains(t)&&(e.preventDefault(),a.bugReport("new",{content:Object(So.a)(Dm(),n.message.errorInfo.message,n.message.errorInfo.stack)}))};r.on("click",o),n.$on("$destroy",(function(){r.off("click",o)}))}}}km.$inject=["dispatchers"];var Am=km;function Im(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Im(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Im(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wm(e,t,n,r,a){var i=n().on,s={},u=function(){return delete s.messagePrepared},l=function(){var e=c()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.messagePrepared;case 2:return t=e.sent,n=t.Body,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){var n=e.getActive(void 0,{Send:1}).active,a=void 0===n?[]:n;if(!a.length)return Promise.resolve();var o=G()(a,1)[0].ID,i=t.getPublicKeys(o),c=G()(i,1)[0],l=r.create("new",{AddressID:o}).then((function(e){return e.encryptBody(c.armor()).then((function(){return e}))})).catch((function(e){throw u(),e}));return function(e){s.messagePrepared=e}(l),l},p=function(){var e=c()(o.a.mark((function e(){var t,n=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=n.length>0&&void 0!==n[0]?n[0]:a()).isMIME()){e.next=3;break}return e.abrupt("return",t);case 3:if(!s.messagePrepared){e.next=14;break}return e.t0=a,e.t1=Cm,e.t2={},e.t3=t,e.next=10,l();case 10:return e.t4=e.sent,e.t5={Body:e.t4},e.t6=(0,e.t1)(e.t2,e.t3,e.t5),e.abrupt("return",(0,e.t0)(e.t6));case 14:return e.abrupt("return",d());case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i("logout",(function(){u()})),i("keysModel",(function(e,t){"updated"===t.type&&d()})),{init:d,getMessage:p}}wm.$inject=["addressesModel","keysModel","dispatchers","messageBuilder","messageModel"];var Om=wm;function Mm(e,t){return t({controllerAs:"ctrl",templateUrl:n("4JMp"),controller:["params",function(t){var n=this,r=t.message,a=r.Header,o=r.Body;this.content="".concat(a,"\n\r").concat(o),this.cancel=t.cancel,this.download=function(){var t=new Blob([n.content],{type:"data:text/plain;charset=utf-8;"});e(t,"pgp.txt")}}]})}Mm.$inject=["downloadFile","pmModal"];var Pm=Mm;function xm(e,t,r,a){return{replace:!0,restrict:"E",templateUrl:n("3HTr"),link:function(n,i){var s={success:e.getString("Read receipt sent",null,"Success notification")},u=i.find(".readReceiptPanel-button"),l=function(){var e=c()(o.a.mark((function e(){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.sendConfirmation(n.message),e.next=3,t.track(i);case 3:r.success(s.success);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();u.on("click",l),n.$on("$destroy",(function(){u.off("click",l)}))}}}xm.$inject=["gettextCatalog","networkActivityTracker","notification","readReceiptModel"];var Tm=xm;Nm.$inject=["eventManager","messageApi"];var Lm=s.Db.FLAG_RECEIPT_SENT,jm=s.Db.FLAG_SENT;function Nm(e,t){return{sendConfirmation:function(){var n=c()(o.a.mark((function n(r){var a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.ID,n.next=3,t.receipt(a);case 3:return n.next=5,e.call();case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),requireConfirmation:function(e){var t=e.Flags,n=e.ParsedHeaders;return!!(void 0===n?{}:n)["Disposition-Notification-To"]&&!(t&(Lm|jm))}}}var $m=Nm,Rm=n("Puqe"),_m=n.n(Rm),Um=n("bt/X"),Fm=n.n(Um);function Bm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Km(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bm(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bm(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gm(e,t,n){var r=function(){var n=c()(o.a.mark((function n(r,a){var i,c;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=r.Address,c=a&&t(a).get(i),n.abrupt("return",c||e.getExport(i));case 3:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),a=function(e,t){Object.entries(Fm()(e,"GroupID")).forEach((function(e){var n=G()(e,2),r=n[0],a=n[1];t.save({ID:r},ri()(a,"Address"))}))},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,r){var a=k()(e[r],"Address");return t[r]=n.findEmails(a),t}),Object.create(null))},s=function(){var n=c()(o.a.mark((function n(){var c,s,u,l,d,p,f,v,m,g,h,b,y,E,S,D,k,A,I,C=arguments;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=C.length>0&&void 0!==C[0]?C[0]:[],s=C.length>1?C[1]:void 0,u=C.length>2?C[2]:void 0,c.length){n.next=5;break}return n.abrupt("return",[]);case 5:return l=c.reduce((function(e,t){return t.isContactGroup?(e.groups.push(r(t,s)),e.map[t.Address]=t,e.mapEmails[t.Address]=t.list,e):(e.emails.push(t),e)}),{groups:[],emails:[],map:Object.create(null),mapEmails:Object.create(null)}),d=l.emails,p=l.groups,f=l.map,v=l.mapEmails,n.next=8,Promise.all(p);case 8:return m=n.sent,g=t(s),h=i(v),b=Lo()(m),y=Lo()(Ze()(v)).filter(Boolean),E=Lo()(Ze()(h)).filter((function(e){var t=e.Email;return!b.some((function(e){return(e.Email||e.Address)===t}))})).map((function(e){var t=e.Email,n=e.Address;return{Name:e.Name,Group:"",isContactGroup:!1,Address:t||n}})),S=g.getDraftConfig(u),D=Be()(Ue()((function(e){var t=e.LabelIDs,n=e.Email,r=e.Address;if(!S||!t)return!0;var a=t.find((function(e){return S[e]})),o=S[a];return!o||o.some((function(e){return e.Address===(n||r)}))})),Ne()((function(e,t){var n=t.Email,r=t.Address,a=t.ContactID,o=t.Name,i=t.LabelIDs,c=void 0===i?[]:i,s=t.ID;if(e.map[s])return e;var u=le()(f,(function(e,t){return c.includes(t)}))||{},l=u.Name,d=void 0===l?"":l,p=u.Address,v=n||r;return e.store.push({Address:v,ContactID:a,Name:o,Group:d,GroupID:p,ID:s,LabelIDs:c}),e.list.push({Address:v,ContactID:a,Name:o,Group:d}),e.map[s]=!0,e}),{list:[],store:[],map:Object.create(null)}))(b),k=D.list,A=D.store,g.removeDraftConfig(u),a(A,g),(I=!k.length&&!E.length&&y.length)&&e.extend(v),n.abrupt("return",k.concat(d,I?y:E));case 21:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),u=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(!n.length)return[];var o=n.reduce((function(t,n){if(!n.Group)return t.col.push(Km({},n,{isContactGroup:!1})),t;var r=e.readName(n.Group);if(!r)return t.nogroup.push(Km({},_m()(n,"Group"),{isContactGroup:!1})),t;if(!t.groupStore[r.ID]&&(t.groupStore[r.ID]=[]),t.groupStore[r.ID].push(n),!t.groupMap[r.ID]){var a={Name:n.Group,Address:r.ID,isContactGroup:!0,list:[]};t.groupMap[r.ID]=a,t.groups.push(a)}return t.groupMap[r.ID].list.push(n),t}),{col:[],nogroup:[],groups:[],groupMap:{},groupStore:{}}),i=o.col,c=o.groups,s=o.nogroup,u=o.groupStore;return t(r).storeDraftConfig(a,u),c.concat(s,i)};return{format:function(){var e=c()(o.a.mark((function e(){var t,n,r,a,i,c,u,l,d,p,f=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:{},n=t.ID,r=t.ToList,a=void 0===r?[]:r,i=t.CCList,c=void 0===i?[]:i,u=t.BCCList,l=void 0===u?[]:u,d=f.length>1&&void 0!==f[1]?f[1]:{},p=d.ID,e.next=4,s(a,n||p,"ToList");case 4:return e.t0=e.sent,e.next=7,s(c,n||p,"CCList");case 7:return e.t1=e.sent,e.next=10,s(l,n||p,"BCCList");case 10:return e.t2=e.sent,e.abrupt("return",{ToList:e.t0,CCList:e.t1,BCCList:e.t2});case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),list:function(e){var t=e.ID,n=e.ToList,r=void 0===n?[]:n,a=e.CCList,o=void 0===a?[]:a,i=e.BCCList,c=void 0===i?[]:i;return{ToList:u(r,t,"ToList"),CCList:u(o,t,"CCList"),BCCList:u(c,t,"BCCList")}},toList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.ID,r=e.ToList,a=void 0===r?[]:r,o=e.CCList,i=void 0===o?[]:o,c=e.BCCList,s=void 0===c?[]:c,l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=l?ri.a:_f.a,p=u(a,n,"ToList").concat(u(i,n,"CCList"),u(s,n,"BCCList"));return t(n).clear(),d(p,"Address")},listInput:u}}Gm.$inject=["contactGroupModel","composerContactGroupSelection","contactEmails"];var Vm=Gm;function qm(e,t){var n=e("base64");return(0,t().on)("logout",n.removeAll),n}qm.$inject=["$cacheFactory","dispatchers"];var Hm=qm,zm=angular.module("proton.message",["ngSanitize","proton.contact","proton.squire"]).factory("cacheBase64",Hm).factory("readReceiptModel",$m).directive("readReceiptPanel",Tm).factory("pgpModal",Pm).factory("prepareDraft",Om).factory("recipientsFormator",Vm).directive("messageDisplayError",Am).run(["unsubscribeModel",function(e){return e.init()}]).directive("actionMessage",np).directive("allMessageLabels",rp).directive("displayContentBtn",op).directive("embeddedImgLoader",cp).directive("encryptionStatus",up).directive("filterButton",dp).directive("foldersMessage",fp).directive("injectMessageMedia",mp).directive("message",Cp).directive("messageAddressActionMenu",Op).directive("messageAddressActions",Pp).directive("messageAutoGenerated",xp).directive("messageMimeParsing",Tp).directive("messageExpiration",Lp).directive("messagePublicKeyFound",Np).directive("messagePublicKeyPinning",Rp).directive("messageResign",Up).directive("messageComposeTo",Bp).directive("messageContacts",Gp).directive("messageContactsIcon",qp).directive("messageExtra",Hp).directive("messageSignatureStatus",zp).directive("messageSpamScore",Qp).directive("messageView",ef).directive("phishingBtn",nf).directive("renderMessageBody",af).directive("toggleBlockquote",of).directive("toggleMessage",sf).directive("unsubscribePanel",lf).directive("trustPublicKeyTable",df).directive("trustPublicKeyInfo",pf).factory("displayContent",Ef).factory("displayEmbedded",Df).factory("displayImages",Af).factory("messageActions",Of).factory("messageApi",Tf).factory("messageModel",qf).factory("messageSenderSettings",vf).factory("plusAliasModel",Wf).factory("signatureBuilder",ov).factory("simpleSend",cv).factory("trustPublicKeyModal",uv).factory("publicKeyStore",Iv).factory("getEncryptionType",fv).factory("keyCache",Sv).factory("unsubscribeModel",dv).filter("filterMessages",wv).filter("messageTime",Ov).filter("nameRecipient",Mv).filter("recipients",xv).factory("attachedPublicKey",Bv).factory("findExpandableMessage",Gv).factory("messageBuilder",em).factory("prepareContent",dm).factory("transformAttachements",fm).factory("transformBlockquotes",mm).factory("transformEmbedded",hm).factory("transformRemote",ym).factory("transformStylesheet",Em).factory("transformWelcome",Sm).name;function Ym(e){var t={show:"fa-bars",hide:"fa-times"};return{replace:!0,template:'<button class="btnDisplayMobileSidebar-container"><i class="fa"></i></button>',compile:function(n,r){var a=r.type,o=void 0===a?"show":a;return n[0].querySelector("i").classList.add(t[o]),function(t,n,r){var a=r.type,o=void 0===a?"show":a,i=function(){return e.set("showSidebar","show"===o)};n.on("click",i),t.$on("$destroy",(function(){n.off("click",i)}))}}}}Ym.$inject=["AppModel"];var Wm=Ym;function Xm(e,t,n,r,a){var o=a((function(){return{donation:e.getString("Donate",null,"Title"),topUp:e.getString("Add credits",null,"Title"),notAvailable:e.getString("Donations are currently not available, please try again later",null,"Info")}}));return{replace:!0,template:'<button class="sidebarApp-link donateBtn-container"><div>\n                <i class="fa fa-heart-o sidebarApp-icon donateBtn-icon"></i>\n                <span class="donateBtn-title">Donate</span></div>\n            </button>',link:function(e,a,i){var c=i.item,s=void 0===c?"donation":c;a[0].querySelector(".donateBtn-title").textContent=o[s];var u=function(){if(!r.canPay())return t.info(o.notAvailable);n.activate({params:{type:s,close:n.deactivate}})};a.on("click",u),e.$on("$destroy",(function(){a.off("click",u)}))}}}Xm.$inject=["gettextCatalog","notification","donateModal","paymentModel","translator"];var Jm=Xm;function Qm(e,t,n,r,a,o){var i=document.createElement("div"),c=function(e,t){var a,o=e.ID,c=e.Color,s=e.Name,u=e.Exclusive,l=function(e){return["menuLabel-item",n.label===e&&"active"].filter(Boolean).join(" ")}(o),d=r.href("secured.label",{label:o,sort:null,filter:null,page:null}),p=(a=s,i.textContent=a||"",i.innerHTML),f=p.replace(/"|'/g,""),v=t?"fa-users":1===u?"fa-folder":"fa-tag",m=t?"group":"label";return Object(So.a)('<li class="'.concat(l,'">\n            <a href="').concat(d,'" title="').concat(f,'" data-label="').concat(f,'" class="btn menuLabel-link" data-pt-dropzone-item="').concat(o,'" data-pt-dropzone-item-type="').concat(m,'">\n                <i class="fa ').concat(v,' menuLabel-icon" style="color: ').concat(c||"#CCC",'"></i>\n                <span class="menuLabel-title">').concat(p,'</span>\n                <em class="menuLabel-counter" data-label-id="').concat(o,'"></em>\n            </a>\n        </li>'))};return{replace:!0,template:'<ul class="menuLabel-container"></ul>',link:function(n,i){var s=e(),u=s.on,l=s.unsubscribe,d=function(){var e,n;i[0].innerHTML=(e=r.includes("secured.contacts"),n=e?o.get():t.get(),Ia()(n,"Order").map((function(t){return c(t,e)})).join(""))},p=function(){var e=r.includes("secured.contacts");We()(i[0].querySelectorAll(".menuLabel-counter"),(function(t){var n=t.getAttribute("data-label-id"),r=t.parentElement,o=e?a.totalMember(n):a.unread("label",n);t.textContent=o,r.title="".concat(r.getAttribute("data-label")," ").concat(o).trim()}))},f=function(){return d(),p()};u("app.cacheCounters",(function(e,t){"load"===t.type&&p()})),u("elements",(function(e,t){"refresh"===t.type&&p()})),u(r.includes("secured.contacts")?"contactGroupModel":"labelsModel",(function(e,t){var n=t.type;(/^cache\.(refresh|update)$/.test(n)||"reorder.success"===n)&&f(),"counter.update"===n&&p()})),u("$stateChangeSuccess",(function(){_rAF(f)})),d(),p(),n.$on("$destroy",l)}}}Qm.$inject=["dispatchers","labelsModel","$stateParams","$state","sidebarModel","contactGroupModel"];var Zm=Qm;function eg(e,t,n,r,a,o,i){return{replace:!0,template:'<li class="navigationItem-container"></li>',link:function(c,s,u){var l,d=u.key,p=n(),f=p.on,v=p.unsubscribe,m=r.getStateConfig()[d],g=function(){var e=s[0].querySelector(".navigationItem-item"),t=e.querySelector(".navigationItem-counter"),n=r.unread(d);e.title="".concat(e.getAttribute("data-label")," ").concat(n).trim(),t.textContent=n},h=function(){var t=m.states,n=void 0===t?[]:t,r=m.state,a=void 0===r?"":r,o=function(){return s[0].classList.add("active")};return n.length&&le()(n,(function(t){return e.includes(t)}))?o():e.includes(a)?o():void s[0].classList.remove("active")};h(),s[0].innerHTML=function(t,n){var r=n.state,a=n.label,o=n.icon,i="sidebarApp-icon navigationItem-icon fa ".concat(void 0===o?"":o).trim(),c="allmail"!==t?'data-pt-dropzone-item="'.concat(t,'"'):"";return Object(So.a)('<a href="'.concat(e.href(r,{sort:null,filter:null,page:null}),'" title="').concat(a,'" data-label="').concat(a,'" data-state="').concat(t,'" class="navigationItem-item" ').concat(c,'>\n                <i class="').concat(i,'"></i>\n                <span class="navigationItem-title">').concat(a,'</span>\n                <div class="navigationItem-aside">\n                    <em class="navigationItem-counter"></em>\n                    <button class="fa fa-repeat refresh navigationItem-btn-refresh"></button>\n                </div>\n            </a>'))}(d,m),g(),f("app.cacheCounters",(function(e,t){"load"===t.type&&g()})),f("elements",(function(e,t){"refresh"===t.type&&g()})),f("$stateChangeSuccess",(function(){h()}));var b=function(){var n,r,c=e.$current.name===m.state&&!t.filter,u=1==~~t.page||angular.isUndefined(t.page);if(o.set("requestTimeout",!1),c&&u)return i.isLimitReached()&&i.showModal(),o.set("showSidebar",!1),n=s[0].querySelector(".refresh"),r=l,n.classList.add("spinMe"),clearTimeout(r),l=setTimeout((function(){a.call().then((function(){return n.classList.remove("spinMe")})).catch((function(e){console.error(e),n.classList.remove("spinMe")}))}),500)};s.on("click",b),c.$on("$destroy",(function(){s.off("click",b),v()}))}}}eg.$inject=["$state","$stateParams","dispatchers","sidebarModel","eventManager","AppModel","storageWarning"];var tg=eg;function ng(e,t,n){return{replace:!0,template:'<li class="navigationSettings-container"></li>',link:function(r,a,o){var i=o.key,c=e(),s=c.on,u=c.unsubscribe,l=n.getStateConfig()[i];a[0].innerHTML=function(e,n){var r=n.label,a=n.icon,o=void 0===a?"":a,i=n.state,c="sidebarApp-icon navigationSettings-icon fa ".concat(o).trim(),s=t.href(i);return Object(So.a)('<a class="navigationSettings-link sidebarApp-link" href="'.concat(s,'" data-state="').concat(e,'">\n                    <i class="').concat(c,'"></i>\n                    <span>').concat(r,"</span>\n                </a>"))}(i,l),a[0].classList.add("navigationSettings-is-".concat(i)),t.includes(l.state)&&a[0].classList.add("active"),s("$stateChangeSuccess",(function(e,t){if(t.name===l.state)return a[0].classList.add("active");a[0].classList.remove("active")})),r.$on("$destroy",u)}}}ng.$inject=["dispatchers","$state","sidebarSettingsModel"];var rg=ng,ag=function(e){return{scope:{},replace:!0,templateUrl:n("J0VT"),link:function(t){t.listStates=Object.keys(e.getStateConfig())}}};ag.$inject=["sidebarModel"];var og=ag,ig=function(e){var t=e.margin,n=e.scrollBy,r={scroll:0};return{setScrollPosition:function(e){r.scroll=-e},scroll:function(e,a){var o=e-r.scroll;return o-t/2<=0&&r.scroll>0?Math.max(r.scroll-n,0):o-a+t>0?r.scroll+n:void 0}}},cg=function(e,t,r){return{replace:!0,templateUrl:n("WfVW"),link:function(n,a,o){var i=o.type,c=e(),s=c.on,u=c.unsubscribe,l=ig({margin:40,scrollBy:30}),d=[u];n.scrollbarConfig={advanced:{updateOnContentResize:!0},scrollInertia:0,scrollButtons:{enable:!1},callbacks:{whileScrolling:function(){l.setScrollPosition(this.mcs.top)}}};var p=function(){_rAF((function(){return n.$applyAsync((function(){return n.updateScrollbar("update")}))}))};_rAF((function(){p(),n.$applyAsync((function(){n.updateScrollbar("scrollTo",0)}))}));var f=p;s("labelsModel",(function(e,t){"cache.update"===t.type&&p()}));var v=er()((function(e){if("label"===e.target.dataset.ptDropzoneItemType){var t=a[0].getBoundingClientRect().height,r=l.scroll(e.target.offsetTop,t);void 0!==r&&n.$applyAsync((function(){return n.updateScrollbar("scrollTo",r)}))}}),250);if("contact"===i){var m=function(e){"A"!==e.target.nodeName&&"A"!==e.currentTarget.nodeName||(e.preventDefault(),e.stopPropagation(),r()||t.edit(null,e.target.getAttribute("data-pt-dropzone-item")))};a.on("click",m),d.push((function(){return a.off("click",m)}))}a[0].addEventListener("dragenter",v),window.addEventListener("resize",p),document.addEventListener("visibilitychange",f),d.push((function(){a[0].removeEventListener("dragenter",v),window.removeEventListener("resize",p),document.removeEventListener("visibilitychange",f)})),n.$on("$destroy",(function(){d.forEach((function(e){return e()})),d.length=0}))}}};cg.$inject=["dispatchers","manageContactGroup","needUpgrade"];var sg=cg;function ug(e,t,r,a,o,i){var c="sidebarContact-show-delete-contacts",s="sidebarContact-show-merge-button",u=i((function(){return{merge:o.getString("Merge",null,"Merge contacts")}}));return{restrict:"E",replace:!0,scope:{},templateUrl:n("9kt2"),link:function(n,o){var i=e(["contacts"]),l=i.on,d=i.unsubscribe,p=i.dispatcher,f=o.find(".".concat("sidebarContact-merge-text"));function v(){var e=r.get();if(!e.length)return o[0].classList.remove(s),void o[0].classList.remove(c);o[0].classList.add(c);var t=a.extractDuplicates(e),n=Object.keys(t).reduce((function(e,n){return e+t[n].length}),0);n>0?(o[0].classList.add(s),f.text("".concat(u.merge," (").concat(n,")"))):o[0].classList.remove(s)}function m(e){var n=e.target.getAttribute("data-action");"back"===n&&t.back(),"deleteContacts"===n&&p.contacts(n,{contactIDs:"all"}),/^(merge|export|import)Contacts$/.test(n)&&p.contacts(n)}l("contacts",(function(e,t){var n=t.type;"contactsUpdated"===(void 0===n?"":n)&&setTimeout(v,300)})),o.on("click",m),v(),n.$on("$destroy",(function(){d(),o.off("click",m)}))}}}ug.$inject=["dispatchers","backState","contactCache","contactMerger","gettextCatalog","translator"];var lg=ug,dg=function(e,t,r,a,o){return{replace:!0,scope:{},templateUrl:n("GbEV"),link:function(n){var r=t(),i=r.on,c=r.unsubscribe,s=function(){var e=o(),t=e.isAdmin,r=e.isFree;n.isAdmin=t,n.isFree=r};s(),n.listStates=Object.keys(e.getStateConfig()),n.hideMobileSidebar=function(){var e=setTimeout((function(){a.set("showSidebar",!1),clearTimeout(e)}),1e3)},i("$stateChangeStart",(function(){a.set("showSidebar",!1)})),i("updateUser",s),n.$on("$destroy",c)}}};dg.$inject=["sidebarModel","dispatchers","authentication","AppModel","userType"];var pg=dg,fg=function(e,t,r){return{scope:{},replace:!0,templateUrl:n("ykBR"),link:function(n){var a=e(),o=a.on,i=a.unsubscribe,c=function(){var e=r.user.Name,a=void 0===e?"":e,o=t.get()||[],i=G()(o,1)[0],c=(i=void 0===i?{}:i).DisplayName,s=void 0===c?"":c,u=i.Email,l=void 0===u?"":u;n.$applyAsync((function(){n.displayName=s||a,n.email=l}))};o("updateUser",(function(){return c()})),c(),n.$on("$destroy",i)}}};fg.$inject=["dispatchers","addressesModel","authentication"];var vg=fg;function mg(e,t,r){var a=r("humanSize"),o=r("percentage");return{templateUrl:n("63Hn"),replace:!0,link:function(t){t.storageStyle=function(){return{width:"".concat(o(e.user.UsedSpace,e.user.MaxSpace),"%")}},t.storageValue=function(){return"".concat(a(e.user.UsedSpace)," / ").concat(a(e.user.MaxSpace))}}}}mg.$inject=["authentication","organizationModel","$filter"];var gg=mg;function hg(e,t,n,r,a){return{unread:function(n,a){var o=function(e){return"sent"===e?r.getSentState(""):"drafts"===e?r.getDraftsState(""):e}(n),i=function(n,r){var a=e.getTypeList(n);return t["unread".concat("conversation"===a?"Conversation":"Message")](r)}(o,function(e,t){return"label"===e?t:s.rb[e]}(o,a));return void 0===i||i<=0?"":"(".concat(i,")")},getStateConfig:function(){var e=r.getDraftsState(),t=r.getSentState();return{inbox:{state:"secured.inbox",label:n.getString("Inbox",null,"Title"),icon:"fa-inbox"},drafts:{state:e,states:["secured.allDrafts","secured.drafts"],label:n.getString("Drafts",null,"Title"),icon:"fa-file-text-o"},sent:{state:t,states:["secured.allSent","secured.sent"],label:n.getString("Sent",null,"Title"),icon:"fa-send"},starred:{state:"secured.starred",label:n.getString("Starred",null,"Title"),icon:"fa-star-o"},archive:{state:"secured.archive",label:n.getString("Archive",null,"Title"),icon:"fa-archive"},spam:{state:"secured.spam",label:n.getString("Spam",null,"Title"),icon:"fa-ban"},trash:{state:"secured.trash",label:n.getString("Trash",null,"Title"),icon:"fa-trash-o"},allmail:{state:"secured.allmail",label:n.getString("All Mail",null,"Title")}}},totalMember:function(e){var t=a.getNumber(e);return t<=0?"":"(".concat(t,")")}}}hg.$inject=["tools","cacheCounters","gettextCatalog","dynamicStates","contactGroupModel"];var bg=hg;function yg(e,t){var n={dashboard:{state:"secured.dashboard",label:e.getString("Dashboard",null,"Title"),icon:"fa-tachometer"},account:{state:"secured.account",label:e.getString("Account",null,"Title"),icon:"fa-user"},labels:{state:"secured.labels",label:e.getString("Folders / Labels",null,"Title"),icon:"fa-tags"},filters:{state:"secured.filters",label:e.getString("Filters",null,"Title"),icon:"fa-filter"},autoresponder:{state:"secured.autoresponder",label:e.getString("Auto-Reply",null,"Title"),icon:"fa-envelope-open"},security:{state:"secured.security",label:e.getString("Security",null,"Title"),icon:"fa-lock"},appearance:{state:"secured.appearance",label:e.getString("Appearance",null,"Title"),icon:"fa-paint-brush"},members:{state:"secured.members",label:e.getString("Addresses / Users",null,"Title"),icon:"fa-users"},domains:{state:"secured.domains",label:e.getString("Domains",null,"Title"),icon:"fa-globe"},bridge:{state:"secured.bridge",label:"IMAP/SMTP",icon:"fa-desktop"},pmme:{state:"secured.pmme",label:"pm.me",icon:"fa-envelope"},payments:{state:"secured.payments",label:e.getString("Payments",null,"Title"),icon:"fa-credit-card"},keys:{state:"secured.keys",label:e.getString("Keys",null,"Title"),icon:"fa-key"},vpn:{state:"secured.vpn",label:"ProtonVPN",icon:"ico-protonvpn"}};return{getStateConfig:function(){return t.isMember()?_m()(n,"pmme"):n}}}yg.$inject=["gettextCatalog","memberModel"];var Eg=yg,Sg=angular.module("proton.sidebar",[]).directive("btnDisplayMobileSidebar",Wm).directive("donateBtn",Jm).directive("menuLabel",Zm).directive("navigationItem",tg).directive("navigationSettings",rg).directive("sidebar",og).directive("sidebarLabels",sg).directive("sidebarContact",lg).directive("sidebarMobile",pg).directive("sidebarMobileHeader",vg).directive("sidebarProgress",gg).factory("sidebarModel",bg).factory("sidebarSettingsModel",Eg).name;var Dg=function(){return{replace:!0,scope:{form:"=",image:"="},restrict:"E",templateUrl:n("nhBJ"),link:function(e,t){var n=t[0],r=n.querySelector(".addFile-addressInput"),a=n.querySelector(".addFile-preview"),o=function(t){e.$applyAsync((function(){var n=(e||{}).form,r=void 0===n?{}:n;r.addressInput&&r.addressInput.$setValidity("valid",t)}))};a.onload=function(){n.classList.remove("addFile-image-loading","addFile-image-empty"),n.classList.add("addFile-image-loaded"),o(!0)},a.onerror=function(){n.classList.remove("addFile-image-loading","addFile-image-empty"),n.classList.add("addFile-image-error"),o(!1)};var i=function(e){a.removeAttribute("src"),n.classList.remove("addFile-image-loaded","addFile-image-error"),e?(o(!1),n.classList.add("addFile-image-loading"),a.setAttribute("src",e)):n.classList.add("addFile-image-empty")},c=er()((function(e){i(e.target.value)}),300);i(e.image.src),n.querySelector("input").focus(),r.addEventListener("input",c),r.addEventListener("change",c),e.$on("$destroy",(function(){r.removeEventListener("input",c),r.removeEventListener("change",c)}))}}},kg=n("XydG");function Ag(e,t){var r=t((function(){var t,n;return{description:(t={},v()(t,s.qb.WEB,e.getString("To what URL should this link go?",null,"Composer, add Link")),v()(t,s.qb.EMAIL,e.getString("To what email address should this link?",null,"Composer, add Link")),v()(t,s.qb.PHONE,e.getString("To what phone number should this link?",null,"Composer, add Link")),t),placeholder:(n={},v()(n,s.qb.WEB,e.getString("Add a web address",null,"Composer, add Link")),v()(n,s.qb.EMAIL,e.getString("Add an email address",null,"Composer, add Link")),v()(n,s.qb.PHONE,e.getString("Add a phone number",null,"Composer, add Link")),n)}}));return{replace:!0,scope:{form:"=",link:"="},restrict:"E",templateUrl:n("pcmo"),link:function(e,t){var n=t[0],a={linkLabelDirty:""!==e.link.label};e.linkTypes=s.qb;var o=n.querySelector(".addLink-urlLinkDescription"),i=n.querySelector(".addLink-urlLinkInput"),c=n.querySelector(".addLink-labelLinkInput"),u=n.querySelector(".addLink-linkTest"),l=n.querySelector(".addLink-linkTypes"),d=function(t){e.$applyAsync((function(){e.link.label=t}))},p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.qb.WEB;if(""!==e.link.label&&a.linkLabelDirty||d(t),n===s.qb.WEB){Object(Kt.i)(u,0===t.length);var r=Object(kg.b)(t,n);if(!r)return u.removeAttribute("href");u.setAttribute("href",r)}else Object(Kt.i)(u,!0)},f=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.qb.WEB;o.textContent=r.description[t],i.placeholder=r.placeholder[t],p(e.link.url,t)},v=function(t){p(t.target.value,e.link.type)},m=function(t){var n=t.target;e.$applyAsync((function(){e.link.url="",f(n.value)}))},g=function(e){var t=e.target;a.linkLabelDirty=""!==t.value};f(e.link.type),i.focus(),l.addEventListener("change",m),i.addEventListener("input",v),i.addEventListener("change",v),c.addEventListener("input",g),e.$on("$destroy",(function(){l.removeEventListener("change",m),i.removeEventListener("input",v),i.removeEventListener("change",v),c.removeEventListener("input",g)}))}}}Ag.$inject=["gettextCatalog","translator"];var Ig=Ag,Cg=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:void 0},wg=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Cg(e.toLowerCase())||{},n=t.r,r=t.g,a=t.b;return void 0===n?"":"rgb(".concat(n,", ").concat(r,", ").concat(a,")")};Lg.$inject=["editorState"];var Og=s.X.white,Mg=s.X.magenta,Pg=s.X.blue,xg=s.X.green,Tg=s.X.yellow;function Lg(e){var t=function(e){return function(t,n){return t+function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"color",n=wg(e);return'<li class="colorList-item" style="color:'.concat(n,'" data-mode="').concat(t,'"><button class="colorList-btn-choose" data-mode="').concat(t,'" type="button" data-color="').concat(n,'"><i class="fa fa-check" aria-hidden="true"></i></button></li>')}(n,e)}},n=function(e){return function(n,r){return n+function(e,n){return'<ul class="colorList-list">'.concat(e.reduce(t(n),""),"</ul>")}(r,e)}};return{replace:!0,template:'<div class="colorList-container"></div>',compile:function(t,r){var a=r.mode;t[0].innerHTML=[Og,Mg,Pg,xg,Tg].reduce(n(a),"");var o="highlight"===a?"backgroundColor":"color";return function(t,n){var r=t.message.ID,a=function(e,t){var r=e[o],a=t[o];if(r!==a){var i;(i=n[0].querySelector(".".concat("active")))&&i.classList.remove("active");var c=n[0].querySelector('[data-color="'.concat(a,'"]'));c&&c.classList.add("active")}};a({},e.get(r)),e.on(r,a,[o]),t.$on("$destroy",(function(){e.off(r,a)}))}}}}var jg=Lg;function Ng(e){return{replace:!0,templateUrl:n("GFSM"),compile:function(t,n){var r=n.mode,a=void 0===r?"color":r;return t.find("[data-hash]").attr("data-mode",a),function(t,n,r){var a=r.mode,o=void 0===a?"color":a,i=function(n){n.preventDefault(),n.stopPropagation(),e.changeColor(t.message,n.target.dataset.color,o)};n.on("mousedown",i),t.$on("$destroy",(function(){n.off("mousedown",i)}))}}}}Ng.$inject=["squireExecAction"];var $g=Ng;Ug.$inject=["gettextCatalog","onCurrentMessage","editorState","translator"];var Rg=s.Gb.DEFAULT,_g=s.Gb.PLAINTEXT;function Ug(e,t,r,a){var o="squireDropdown-is-open",i=a((function(){var t;return t={},v()(t,_g,e.getString("Plain Text",null,"Composer Mode")),v()(t,Rg,e.getString("Normal",null,"Composer Mode")),t}));return{replace:!0,templateUrl:n("4GI9"),link:function(e,n){var a=e.message.ID,c=n[0],s=c.querySelector(".squireToolbar-action-modeEditor"),u=function(e,t){var n=e.popover,r=e.editorMode,a=t.popover,u=t.editorMode;r!==u&&(s.textContent=i[u]),"moreToggle"===a?c.classList.add(o):"moreToggle"===n&&c.classList.remove(o)},l=t("squire.toggleMode",e,(function(e){"enableToggle"!==e&&"disableToggle"!==e||(s.disabled="disableToggle"===e)}));u({},r.get(a)),r.on(a,u,["popover","editorMode"]),e.$on("$destroy",(function(){r.off(a,u),l()}))}}}var Fg=Ug;Kg.$inject=["dispatchers","mailSettingsModel","hotkeys"];var Bg={ENTER:13,S:83};function Kg(e,t,r){var a=function(e,t){return!e.altKey&&(e.ctrlKey||e.metaKey)&&e.keyCode===t};return{replace:!0,templateUrl:n("4OmW"),link:function(n,o){if(n.message){var i=e(["composer.update"]).dispatcher;o[0].value=n.message.DecryptedBody,n.message.ccbcc=!1;var c=er()((function(e){a(e,Bg.S)&&(e.preventDefault(),r.trigger("mod+s")),a(e,Bg.ENTER)&&1===t.get("Hotkeys")&&i["composer.update"]("send.message",{message:n.message})}),300),u=!1,l=function(){return u=!0},d=function(){return u=!1},p=er()((function(){u&&i["composer.update"]("autosave.message",{message:n.message})}),s.ec),f=function(){n.message.ccbcc&&n.$applyAsync((function(){return n.message.ccbcc=!1}))};o.on("click",f),o.on("input",p),o.on("blur",d),o.on("focus",l),o.on("keydown",c),n.$on("$destroy",(function(){o.off("click",f),o.off("input",p),o.off("keydown",c),o.off("blur",d),o.off("focus",l)}))}}}}var Gg=Kg;Yg.$inject=["squireEditor","embedded","editorListener","dispatchers","sanitize","toggleModeEditor","onCurrentMessage","cacheBase64"];var Vg=s.Gb.PLAINTEXT,qg=s.Gb.DEFAULT,Hg=function(e){return"message"===e},zg=function(e){return function(t){t&&e.setAttribute("tabindex","-1"),!t&&e.removeAttribute("tabindex")}};function Yg(e,t,r,a,i,s,u,l){var d="squireEditor-loaded";return{scope:{message:"=?",value:"=?",allowEmbedded:"=",allowDataUri:"="},replace:!0,templateUrl:n("4tPE"),link:function(n,p,f){var v=f.typeContent,m=void 0===v?"message":v,g=f.action,h=void 0===g?"":g,b=f.id,y=void 0===b?"composer":b,E=a(["message","composer.update"]).dispatcher;n.data={};var S=p.find("iframe.squireIframe");S[0].id="".concat(y).concat(Date.now());var D=function(){p[0].classList.add(d),n.$applyAsync((function(){return n.isLoaded=!0}))},k=function(e){return p[0].dataset.editorMode=e};Hg(m)||(n.message={ID:y,isPlainText:q.a});var A=r(n,p,{typeContent:m,action:h});function I(e){return C.apply(this,arguments)}function C(){return(C=c()(o.a.mark((function e(r){var a,c,s,u,l=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>1&&void 0!==l[1]&&l[1],c=l.length>2&&void 0!==l[2]&&l[2],n.message.MIMEType!==Vg){e.next=5;break}return c&&n.$applyAsync((function(){n.message.setDecryptedBody(r,!1),a&&E.message("updated",{message:n.message})})),e.abrupt("return");case 5:return s=i.message(r||""),e.next=8,t.parser(n.message,{direction:"cid",text:s});case 8:u=e.sent,n.message.setDecryptedBody(u),a&&E.message("updated",{message:n.message});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){var t=i.message(e||"");n.$applyAsync((function(){return n.value=t}))}function O(){return(O=c()(o.a.mark((function r(a){var i,c,d,f,v,g,h,b;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=[],c=zg(S[0]),d=p[0].querySelector(".plaintext-editor"),!Hg(m)){r.next=18;break}return r.t0=En,r.next=7,t.parser(n.message);case 7:r.t1=r.sent,r.t2=l,f=(0,r.t0)(r.t1,r.t2),v=n.message.isPlainText(),c(v),k(n.message.MIMEType),v?n.message.isDraft()&&!n.message.new?oa(d,f):(ca(n.message,a,f),g=s.toPlainText(n.message,a.getHTML()),oa(d,g)):ca(n.message,a,f),D(),i.push(A(I,a)),r.next=20;break;case 18:a.setHTML(n.value||""),h=setTimeout((function(){i.push(A(w,a)),D(),clearTimeout(h)}),100);case 20:b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.action,o=t.argument;if("squireActions"===e&&"setEditorMode"===r&&r){var i=o.value;if(s.canToggle(n.message)&&i!==n.message.MIMEType){var u=i===Vg;c(u);var l=u?a.getHTML():d.value;if(k(i),u){var p=s.toPlainText(n.message,l);d.focus(),oa(d,p),ia(d)}else{var f=s.toHtml(n.message,l);ca(n.message,a,f),sa(a)}}}},i.push(u("squire.editor",n,b)),E["composer.update"]("editor.loaded",{element:p,editor:a,message:n.message,isMessage:Hg(m)}),n.$on("$destroy",(function(){i.forEach((function(e){return e()})),i.length=0,e.clean(n.message),s.clear(n.message),a.destroy()}));case 24:case"end":return r.stop()}}),r)})))).apply(this,arguments)}e.create(S,n.message,m).then((function(e){return O.apply(this,arguments)})),k(qg)}}}var Wg=Yg,Xg=function(e){return{link:function(t,n,r){var a=r.squireActions,o=r.squireActionsType,i=void 0===o?"mousedown":o,c=e(["squire.editor"]).dispatcher,s=function(e){var n=e.target;if(!n.dataset.squireIgnore){e.preventDefault(),e.stopPropagation();var r={type:"squireActions",data:{action:a,message:t.message}};Et()(n.dataset,"value")&&(r.data.argument={value:n.dataset.value,label:n.textContent.trim()}),c["squire.editor"](r.type,r.data)}},u=Pe.e?"click":i;n.on(u,s),t.$on("$destroy",(function(){n.off(u,s)}))}}};Xg.$inject=["dispatchers"];var Jg=Xg;function Qg(e){return{restrict:"E",replace:!0,templateUrl:n("UvyT"),link:function(t,n){var r=t.message.ID,a=n[0].querySelector("mark"),o=n[0].querySelector(".squireSelectColor-popover"),i=function(e,t){var r=e.popover,i=e.color,c=t.color,s=t.popover;i!==c&&(a.style.color=c),"changeColor"===s?(o.classList.remove("changeColor-hidden"),n[0].classList.add("squireSelectColor-is-open")):"changeColor"===r&&(o.classList.add("changeColor-hidden"),n[0].classList.remove("squireSelectColor-is-open"))};e.on(r,i,["color","popover"]),t.$on("$destroy",(function(){e.off(r,i)}))}}}Qg.$inject=["editorState"];var Zg=Qg;function eh(e){var t="squireDropdown-is-open",r={georgia:"Georgia",arial:"Arial",verdana:"Verdana",tahoma:"Tahoma","trebuchet ms":"Trebuchet MS",helvetica:"Helvetica","times new roman":"Times New Roman",menlo:"Monospace",consolas:"Monospace","courier new":"Monospace",monospace:"Monospace"},a=Object.keys(r);return{replace:!0,templateUrl:n("inGH"),link:function(n,o){var i=n.message.ID,c=o[0],s=c.querySelector(".value"),u=function(e,n){var o=e.popover,i=e.font,u=n.popover,l=n.font,d=void 0===l?"":l;if(i!==d&&(s.textContent=function(e){var t=le()(a,(function(t){return new RegExp(t).test(e)}));return r[t]}(d),c.setAttribute("data-font-family",d)),"changeFontFamily"===u){c.classList.add(t);var p=d.split(" "),f=G()(p,1)[0],v=c.querySelector('[data-value^="'.concat(f,'"]'));v&&(v.parentNode.scrollTop=v.offsetTop)}else"changeFontFamily"===o&&c.classList.remove(t)};u({},e.get(i)),e.on(i,u,["popover","font"]),n.$on("$destroy",(function(){e.off(i,u)}))}}}eh.$inject=["editorState"];var th=eh;function nh(e){var t="squireDropdown-is-open";return{replace:!0,templateUrl:n("c0RO"),link:function(n,r){var a=n.message.ID,o=r[0],i=o.querySelector(".value"),c=function(e,n){var r=e.popover,a=e.size,c=n.popover,s=n.size;if(a!==s&&(i.textContent=s,o.setAttribute("data-font-size",s)),"changeFontSize"===c){o.classList.add(t);var u=o.querySelector('[data-value^="'.concat(s,'"]'));u&&(u.parentNode.scrollTop=u.offsetTop)}else"changeFontSize"===r&&o.classList.remove(t)},s=function(e){e.preventDefault(),e.stopPropagation()};o.addEventListener("mousedown",s),c({},e.get(a)),e.on(a,c,["popover","size"]),n.$on("$destroy",(function(){e.off(a,c),o.removeEventListener("mousedown",s)}))}}}nh.$inject=["editorState"];var rh=nh;function ah(e,t,r){var a=s.K.HEADER_CLASS,o={CONTAINER:"squireToolbar-container squire-toolbar",SUB_ROW:"squireToolbar-show-subrow",insertImage:"open-image",makeLink:"open-link"},i=function(e,t){return e.classList.contains(o[t])?o[t]:""},c=/\[(dir=(rtl|ltr))]/g,u=function(e,t){return er()((function(){var n=t.getPath(),r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(c,"")}(n);if("(selection)"!==r){var s=i(e,"SUB_ROW"),u=i(e,"POPOVER_IMAGE"),l=i(e,"POPOVER_LINK"),d=Be()(Ue()((function(e){return e&&/^blockquote$|^i$|^u$|^b$|^ul$|^ol$|^li$|.align-(center|left|right)$/i.test(e)})),Ne()((function(e,t){return e.concat(t.split("."))}),[]),Ue()((function(e){return e&&!/div|html|body|span/i.test(e)})),Ne()((function(e,t){return a===t?"".concat(e," size"):"".concat(e," ").concat(t.trim())}),""))(r.split(">")).toLowerCase().trim();e.className=[o.CONTAINER,d,s,u,l].filter(Boolean).join(" "),e.setAttribute("data-text-direction",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=c.exec(e)||[],n=G()(t,3),r=n[2],a=void 0===r?"ltr":r;return a}(n))}}),100)};return{replace:!0,templateUrl:n("rvPS"),link:function(n,a){var i=n.message.ID,c=a[0],s=r(),l=s.on,d=s.unsubscribe,p=function(){return e.set(i,{popover:void 0})},f=function(e){e.preventDefault(),e.stopPropagation(),c.classList.toggle(o.SUB_ROW),p()},v=function(e){var t,n=e.target;"BODY"!==n.tagName&&(n.dataset.squireActions||(t=n,Object(Kt.b)(t,(function(e){return e.dataset&&(void 0!==e.dataset.squirePopover||void 0!==e.dataset.squireDropdown||void 0!==e.dataset.squirePreventClose)})))||p())},m=function(e,t){var n=e.popover,r=t.popover;"makeLink"!==n&&"insertImage"!==n||c.classList.remove(o[n]),"makeLink"!==r&&"insertImage"!==r||(c.classList.remove(o.SUB_ROW),c.classList.add(o[r]))};l("squire.editor",(function(e,t){var n=t.type,r=t.data;if("squire.native.action"===n){var a=(void 0===r?{}:r).action,o=(void 0===a?"":a).match(/setTextDirection(.+){1,3}/)||[],i=G()(o,2),s=i[0],u=void 0===s?"":s,l=i[1];u.startsWith("setTextDirection")&&c.setAttribute("data-text-direction",l.toLowerCase())}}));var g=t.find(n.message).editor,h=u(c,g),b=c.querySelector(".squireToolbar-action-options");m({},e.get(i)),e.on(i,m,["popover"]),h(),g.addEventListener("pathChange",h),b.addEventListener("mousedown",f),document.addEventListener("click",v),n.$on("$destroy",(function(){d(),e.off(i,m),g.removeEventListener("pathChange",h),b.removeEventListener("mousedown",f),document.removeEventListener("click",v)}))}}}ah.$inject=["editorState","editorModel","dispatchers"];var oh=ah;function ih(e,t,n,r){var a=[38,39,40,37,33,34,36,35],o=function(e,t){var r=t.getFontInfo()||{},a=r.size,o=void 0===a?"14px":a,i=r.color,c=void 0===i?"rgb(34, 34, 34)":i,s=r.family,u=void 0===s?"arial":s,l=r.backgroundColor,d=void 0===l?"rgb(255, 255, 255)":l;n.set(e,{size:parseInt(o,10),font:u.replace(/["\\]/g,""),color:c,backgroundColor:d,popover:void 0})},i=function(e,t){n.set(e,{editorMode:t,popover:void 0})},c=function(e,t){n.get(e).popover!==t?n.set(e,{popover:t}):n.set(e,{popover:void 0})};return{link:function(n){var s=r(["squire.messageSign"]).dispatcher,u=n.message.ID,l=t.find(n.message).editor;o(u,l),i(u,n.message.MIMEType);var d=function(){return o(u,l)},p=function(e){return a.includes(e.keyCode)&&o(u,l)},f=e("squire.editor",n,(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("squire.native.action"===e)switch(t.action){case"setTextColour":case"setFontFace":case"setFontSize":case"setHighlightColour":o(u,l);break;case"setTextDirectionLTR":case"setTextDirectionRTL":case"makeLink":case"removeLink":c(u,void 0);break;case"setEditorMode":i(u,t.argument.value)}if("squireActions"===e)switch(t.action){case"changeFontFamily":case"changeFontSize":case"makeLink":case"insertImage":case"changeColor":case"moreToggle":c(u,t.action);break;case"addKey":n.message.toggleAttachPublicKey(),s["squire.messageSign"]("signed",{messageID:n.message.ID});break;case"sign":n.message.toggleSign(),s["squire.messageSign"]("signed",{messageID:n.message.ID});break;case"requestReadReceipt":n.message.toggleReadReceipt();break;default:c(u,void 0)}}));l.addEventListener("click",d),l.addEventListener("keyup",p),n.$on("$destroy",(function(){f(),l.removeEventListener("click",d),l.removeEventListener("keyup",p)}))}}}ih.$inject=["onCurrentMessage","editorModel","editorState","dispatchers"];var ch=ih;function sh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}lh.$inject=["editorModel","editorState","squireExecAction","addLinkModal","addFileModal","dispatchers"];var uh=s.K.LINK;function lh(e,t,r,a,o,i){var c=function(t){var n=e.find(t).editor;return{editor:n,selection:n&&n.getSelection()}},s=function(e){var t=c(e),n=t.selection,r=t.editor;if(r)return angular.element(n.commonAncestorContainer).find("img").filter((function(){var e=r._win.getSelection().getRangeAt(0);return!(!e||!e.commonAncestorContainer)&&e.commonAncestorContainer.contains(this)}))[0]};function u(e){var t=c(e),n=t.selection,r=t.editor,a={href:uh,textContent:uh};return r?angular.element(n.commonAncestorContainer).closest("a")[0]||function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sh(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sh(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},a,{textContent:n.toString()}):a}return{replace:!0,restrict:"E",templateUrl:n("+O85"),scope:{message:"<",allowEmbedded:"<",allowDataUri:"<"},link:function(e,n){var c=e.message,l=e.allowEmbedded,d=e.allowDataUri,p=c.ID,f=n[0].querySelector(".addFile-fileInput"),v=i(["addFile"]).dispatcher,m=function(){t.set(p,{popover:void 0})},g=function(e,t){var n=e.popover,i=t.popover;"makeLink"===i&&function(){var e=u(c),t=e.href,n=e.textContent,o=Object(kg.c)(t),i=Object(kg.d)(t);a.activate({params:{isUpdate:!!t,link:{url:i,label:n,type:o},submit:function(e){var t=e.url,n=e.label,a=e.type;m(),r.makeLink(c,{link:Object(kg.b)(t,a),title:n,wrap:s(c)})},delete:function(){m(),r.removeLink(c)},cancel:function(){m()}}})}(),"makeLink"===n&&a.deactivate(),"insertImage"===i&&o.activate({params:{canAddFile:l||d,image:{src:""},submit:function(e){var t=e.src;m(),r.insertImage(c,{url:t})},addFile:function(){m(),d?f.click():l&&v.addFile("",{asEmbedded:!0,message:c})},cancel:function(){m()}}}),"insertImage"===n&&o.deactivate()},h=function(e){var t=e.target,n=t.files||[];if(0!==n.length){var a=G()(n,1)[0];r.insertImage(c,{url:"",file:a}),t.value=null}};t.on(p,g,["popover"]),f.addEventListener("change",h),e.$on("$destroy",(function(){t.off(p,g),f.removeEventListener("change",h)}))}}}var dh=lh;var ph=function(){var e={};return{load:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.ID,r=void 0===n?"editor":n,a=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;return e[r]={editor:a,iframe:o},a},find:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.ID,r=void 0===n?"editor":n;return e[r]||{}},remove:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.ID,r=void 0===n?"editor":n;return delete e[r]}}};function fh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var vh=function(){var e={},t=function(t){return e[t]||(e[t]={state:{},callbacks:[],keys:[]}),e[t]};return{set:function(e,n){var r=t(e),a=Object.keys(n),o=r.state;r.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fh(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fh(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.state,{},n),r.callbacks.forEach((function(e,t){!(r.keys[t]?r.keys[t]:a).every((function(e){return!(e in n)||n[e]===o[e]}))&&e(o,r.state)}))},get:function(e){return t(e).state},on:function(e,n,r){var a=t(e);a.callbacks.push(n),a.keys.push(r)},off:function(e,n){var r=t(e),a=r.callbacks.indexOf(n);-1!==a&&(r.callbacks.splice(a,1),r.keys.splice(a,1))}}},mh=n("uB4Z"),gh=n.n(mh);bh.$inject=["dispatchers","editorModel","sanitize"];var hh=s.K.IFRAME_CLASS;function bh(e,t,n){var r={},a=e(["squire.editor"]).dispatcher,i={sanitizeToDOMFragment:function(e,t,r){var a=r._doc,o=e?n.content(e):null;return o?a.importNode(o,!0):a.createDocumentFragment()}};gh.a.prototype.testPresenceinSelection=function(e,t,n,r){return e===t&&!!(r.test(this.getPath())|this.hasFormat(n))};var s=function(e,t){var n=e[0],r=(n.contentDocument||n.contentWindow)&&n.contentWindow.document;if(r&&"complete"===r.readyState)return t(e);e.one("load",(function(){return t(e)}))},u=function(e){var t=e.head||e.getElementsByTagName("head")[0],n=e.createElement("style"),r="\n            html {\n                height: 100%\n            }\n\n            body {\n                height: 100%;\n                box-sizing: border-box;\n                padding: 1rem 10px 1rem 10px;\n                font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;\n                font-size: 14px;\n                line-height: 1.65em;\n                color: #222;\n                word-wrap: break-word;\n            }\n\n            blockquote {\n                padding: 0 0 0 1rem;\n                margin: 0;\n                border-left: 4px solid #e5e5e5;\n            }\n\n            blockquote blockquote blockquote {\n                padding-left: 0;\n                margin-left: 0;\n                border: none;\n            }\n\n            .proton-embedded:not([src]) {\n                position: relative;\n                min-height: 38px;\n                border: 1px solid;\n                border-color: #444 #CCC #CCC #444;\n                background: url('/assets/img/icons/broken-img.png') no-repeat 0 50% white;\n            }\n\n            .proton-embedded:not([src]):not([alt]) {\n                background-position-x: 50%;\n            }\n\n            .proton-embedded[alt]:not([src])::after {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                content: \" \" attr(alt);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                padding: 10px 0 0 20px;\n                color: rgba(0,0,0,0.5);\n                background: url('/assets/img/icons/broken-img.png') no-repeat 0 50% white;\n            }\n\n            /* see embedded.scss rules */\n            .proton-embedded:not([width]):not([style*=\"width\"]) {\n                max-width: 100%;\n                min-width: 38px;\n            }\n\n            .protonmail_signature_block-empty { display: none }\n\n            .protonmail_quote {\n                position: relative;\n            }\n\n            li {\n                list-style-position: inside;\n            }\n\n            // Handle outlook https://github.com/ProtonMail/Angular/issues/6711\n            p.MsoNormal, li.MsoNormal, div.MsoNormal {\n                margin: 0;\n            }\n            ";n.setAttribute("type","text/css"),n.setAttribute("rel","stylesheet"),n.styleSheet?n.styleSheet.cssText=r:n.appendChild(e.createTextNode(r)),t.appendChild(n),e.childNodes[0].className=hh+" "},l=function(e){e.setTextDirectionLTR=function(){return e.setTextDirection()},e.setTextDirectionRTL=function(){return e.setTextDirection("rtl")},e.setTextDirectionWithoutFocus=function(t){e.forEachBlock((function(e){t?e.dir=t:e.removeAttribute("dir")}),!0)},e.alignCenter=function(){return e.setTextAlignment("center")},e.alignRight=function(){return e.setTextAlignment("right")},e.alignCenter=function(){return e.setTextAlignment("center")},e.alignLeft=function(){return e.setTextAlignment("left")},e.alignJustify=function(){return e.setTextAlignment("justify")};var t=function(t){return function(){return e._root.contentEditable=t}};e.disableInput=t(!1),e.enableInput=t(!0),e.makeHeading=function(){return e.setFontSize("2em"),e.bold()};var n=Object(Pe.i)(),r=e.insertHTML;return e.insertHTML=function(){var t=c()(o.a.mark((function t(a,c){var s,u,l,d,p,f;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=17;break}if(t.prev=1,s=i.sanitizeToDOMFragment(a,c,e),u=Object(Kt.d)(s),l=u.first,d=u.last,!l||l!==d||"IMG"!==l.tagName){t.next=12;break}if(n){t.next=7;break}return t.abrupt("return");case 7:return p=l.src,t.next=10,Object(I.a)(p);case 10:return f=t.sent,t.abrupt("return",e.fireEvent("paste.image",{file:f}));case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),console.error(t.t0);case 17:r.call(e,a,c);case 18:case"end":return t.stop()}}),t,null,[[1,14]])})));return function(e,n){return t.apply(this,arguments)}}(),e};return{create:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,c=n.ID,d=void 0===c?"editor":c;return r[d]=o,new Promise((function(r,o){try{s(e,(function(e){var o=e[0].contentWindow.document;u(o);var c=t.load({ID:d},l(new gh.a(o,i)),e);c._root.dataset.enableGrammarly=!1,r(c),_rAF((function(){a["squire.editor"]("loaded",{editor:c,$iframe:e,message:n})}))}))}catch(c){console.error(c),o(c)}}))},clean:function(e){delete r[e.ID],t.remove(e)},getType:function(e){var t=e.ID;return r[t]}}}var yh=bh;function Eh(e,t,r){var a=r((function(){return{insert:{formTitle:t.getString("Insert link",null,"Composer, add Link"),actionTitle:t.getString("Insert",null,"Composer, add Link"),deleteTitle:t.getString("Delete",null,"Composer, add Link")},update:{formTitle:t.getString("Edit link",null,"Composer, add Link"),actionTitle:t.getString("Update",null,"Composer, add Link"),deleteTitle:t.getString("Delete",null,"Composer, add Link")}}}));return e({controllerAs:"ctrl",templateUrl:n("Sbr+"),controller:["params",function(e){var t=this,n=e.isUpdate?a.update:a.insert;this.isUpdate=e.isUpdate,this.formTitle=n.formTitle,this.actionTitle=n.actionTitle,this.deleteTitle=n.deleteTitle,this.link=e.link,this.form=e.form,this.submit=function(){return e.submit(t.link,t.form)},this.delete=function(){return e.delete()},this.cancel=function(){return e.cancel()}}]})}Eh.$inject=["pmModal","gettextCatalog","translator"];var Sh=Eh;function Dh(e,t,r){var a=r((function(){return{insert:{formTitle:t.getString("Insert image",null,"Composer, add File"),actionTitle:t.getString("Insert",null,"Composer, add File"),addFileTitle:t.getString("Add file",null,"Composer, add File"),deleteTitle:t.getString("Delete",null,"Composer, add File")}}}));return e({controllerAs:"ctrl",templateUrl:n("AUsZ"),controller:["params",function(e){var t=this,n=a.insert;this.formTitle=n.formTitle,this.actionTitle=n.actionTitle,this.addFileTitle=n.addFileTitle,this.deleteTitle=n.deleteTitle,this.image=e.image,this.form=e.form,this.canAddFile=e.canAddFile,this.submit=function(){return e.submit(t.image,t.form)},this.addFile=function(){return e.addFile()},this.delete=function(){return e.delete()},this.cancel=function(){return e.cancel()}}]})}Dh.$inject=["pmModal","gettextCatalog","translator"];var kh=Dh;function Ah(e,t,n,r,a){var o=a((function(){return{DICT_DEFAULT_MESSAGE:e.getString("Drop an image here to insert",null,"Info"),INVALID_FILE_SVG:e.getString("We do not support embedded SVG files inside the signature",null,"Error")}}));return function(e,a,i){var c=e[0].querySelector(".squire-dropzone"),s=new Ar.a(c,function(e,t){return{addRemoveLinks:!1,dictDefaultMessage:o.DICT_DEFAULT_MESSAGE,url:"/file/post",acceptedFiles:"image/*",autoProcessQueue:!1,previewTemplate:'<div style="display:none"></div>',paramName:"file",init:function(){var a=this;this.on("addedfile",(function(i){"signature"===e.ID&&"image/svg+xml"===i.type?r.error(o.INVALID_FILE_SVG):n.insertImage(e,{url:"",file:i}),a.removeAllFiles(),t[0].classList.remove("editorDropzone-enter")}))}}}(a,e)),u=er()((function(){return t="editorDropzone-enter",e[0].classList.remove(t);var t}),500),l=function(n){var r;t.isUploadAbleType(n)&&(r="editorDropzone-enter",e[0].classList.add(r))};return e[0].addEventListener("dragenter",l),i.addEventListener("dragenter",l),c.addEventListener("dragover",u),function(){e[0].removeEventListener("dragenter",l),i.removeEventListener("dragenter",l),c.removeEventListener("dragover",u),s.off("addedfile"),s.destroy()}}}Ah.$inject=["gettextCatalog","attachmentFileFormat","squireExecAction","notification","translator"];var Ih=Ah;function Ch(e,t,n,r,a,i,u,l,d,p,f){var v=Object(Pe.j)(),m=function(e){return"message"===e},g=function(e,t){var n=e.ID,r=t.message,a=void 0===r?{}:r,o=t.messageID;return n===a.ID||n===o},h=function(e){e.altKey||!e.ctrlKey&&!e.metaKey||83!==e.keyCode||(e.preventDefault(),d.trigger("mod+s"))};return function(d,p,b){var y=b.typeContent,E=b.action;return function(b,S){var D=d.message,k=[],A=a(["composer.update","squire.editor","editor.draggable","editorListener"]),I=A.dispatcher,C=A.on,w=A.unsubscribe;if(!m(y)){k.push(i(p,D,S));var O=er()((function(){return b(S.getHTML())}),32);S.addEventListener("input",O),k.push((function(){O.cancel(),S.removeEventListener("input",O)}))}if(m(y)){!function(e,t,n,r){e(["attachment.upload",n].filter(Boolean).join("."),(function(e,n){var a=n.type,o=n.data;if(g(r,o)&&"plain/text"!==r.MIMEType)switch(a){case"upload.success":Be()(Ue()((function(e){var t=e.attachment;return"inline"===(void 0===t?{}:t).Headers["content-disposition"]})),nc()((function(e){var n=e.cid,r=e.url,a=e.attachment;t.fireEvent("refresh",{action:"attachment.embedded",data:{url:r,cid:n,attachment:a}})})))(o.upload);break;case"remove.embedded":t.fireEvent("refresh",{action:"attachment.remove",data:o.attachment.Headers})}}))}(C,S,E,D);var M=u(E),P=Hr()((function(){return M(D,S)}),300);S.addEventListener("input",P),k.push((function(){return S.removeEventListener("input",P)})),C("editorListener",function(){var e=c()(o.a.mark((function e(t,n){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.type,a=n.data,g(D,a)){e.next=3;break}return e.abrupt("return");case 3:e.t0=r,e.next="pre.close.message"===e.t0?6:"pre.send.message"===e.t0?10:"send.failed"===e.t0?15:"pre.save.message"===e.t0?17:21;break;case 6:return e.next=8,b(S.getHTML());case 8:return I["composer.update"]("close.message",{message:D,save:!0}),e.abrupt("break",21);case 10:return S.disableInput(),e.next=13,b(S.getHTML());case 13:return I["composer.update"]("send.message",{message:D}),e.abrupt("break",21);case 15:return S.enableInput(),e.abrupt("break",21);case 17:return e.next=19,b(S.getHTML());case 19:return I["composer.update"]("save.message",{message:D}),e.abrupt("break",21);case 21:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),S._doc.addEventListener("keydown",h),k.push((function(){return S._doc.removeEventListener("keydown",h)}));var x=er()(c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(S.getHTML());case 2:I["composer.update"]("autosave.message",{message:D});case 3:case"end":return e.stop()}}),e)}))),s.ec);S.addEventListener("input",x),k.push((function(){x.cancel(),S.removeEventListener("input",x)}))}["dragleave","dragenter","drop"].forEach((function(e){var t=function(e,t,n,r){if("message"!==r)return angular.noop;var a=function(r){e["editor.draggable"](t,{messageID:n.ID,message:n,event:r})};return"dragleave"===t||"drop"===t?er()(a,500):a}(I,e,D,y);S.addEventListener(e,t),k.push((function(){return S.removeEventListener(e,t)}))}));var T=function(){return p.removeClass("focus").triggerHandler("blur")},L=function(e){return e.preventDefault()},j=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.action,o=void 0===a?"":a,i=n.data;if("attachment.remove"===o){var c=t.removeEmbedded(D,i,S.getHTML());return S.setHTML(c),b(c)}if("attachment.embedded"===o)return r.insertImage(D,{url:i.url,opt:{"data-embedded-img":i.cid,alt:i.attachment.Name}});if("message.changeFrom"===o){var s=e.update(D,S.getHTML());return!D.isPlainText()&&S.setHTML(s),b(s,!0,!0)}return"signature.update"===o?(S.setHTML(i),b(i)):void 0},N=function(){p.addClass("focus").triggerHandler("focus"),I["composer.update"]("editor.focus",{editor:S,element:p,message:D,isMessage:m(y)})},$=function(e){n.isUploadAbleType(e)&&e.preventDefault();var t=e.dataTransfer.files[0];t&&/image/.test(t.type||"")&&(e.preventDefault(),r.insertImage(D,{url:"",file:t}))},R=f(D),_=f(D,"paste.image");return function(e,t,n,r){var a=function(e){return function(t,n){1===l.get().Hotkeys&&e(t,n)}};t.setKeyHandler("escape",a((function(){m(r)&&e.editorListener("pre.close.message",{message:n})})));var o="".concat(v?"meta":"ctrl","-enter");t.setKeyHandler(o,a((function(t,a){m(r)&&(a.preventDefault(),e.editorListener("pre.send.message",{message:n}))})));var i="".concat(v?"meta":"ctrl","-k");t.setKeyHandler(i,a((function(t,r){r.preventDefault(),e["squire.editor"]("squireActions",{action:"makeLink",message:n})})))}(I,S,D,y),S.addEventListener("paste",R),S.addEventListener("paste.image",_),S.addEventListener("drop",$),S.addEventListener("refresh",j),S.addEventListener("focus",N),S.addEventListener("blur",T),S.addEventListener("mscontrolselect",L),function(){k.forEach((function(e){return e()})),k.length=0,w(),S.removeEventListener("paste",R),S.removeEventListener("paste.image",_),S.removeEventListener("drop",$),S.removeEventListener("refresh",j),S.removeEventListener("focus",N),S.removeEventListener("blur",T),S.removeEventListener("mscontrolselect",L)}}}}Ch.$inject=["signatureBuilder","embedded","attachmentFileFormat","squireExecAction","dispatchers","editorDropzone","removeInlineWatcher","mailSettingsModel","hotkeys","$state","pasteImage"];var wh=Ch;function Oh(e){var t=function(e,t,n){var r=n.latest,a=n.dispatch,o=(e.match(/(rel=("([^"]|"")*"))|(data-embedded-img=("([^"]|"")*"))/g)||[]).filter((function(e){return'rel="noreferrer nofollow noopener"'!==e})).map((function(e){return e.replace(/rel="|data-embedded-img="/,"")})).map((function(e){return e.slice(0,-1)}));if(o.length<r.CID.length){var i=t.Attachments.filter((function(e){var t=e.uploading,n=e.Headers;if(t)return!1;var r="".concat((void 0===n?{}:n)["content-id"]||"");return!!r&&-1===o.indexOf(r.replace(/[<>]+/g,""))}));a({message:t,list:i})}r.CID=o};return function(n){var r={CID:[]},a=["attachment.upload",n].filter(Boolean).join("."),o=e([a]).dispatcher,i=function(e){return o[a]("remove.all",e)};return function(e,n){var a=n.getHTML()||"";t(a,e,{dispatch:i,latest:r})}}}Oh.$inject=["dispatchers"];var Mh=Oh;function Ph(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ph(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ph(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Th(e,t){var n=t(["squire.editor"]),r=n.on,a=n.dispatcher,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a["squire.editor"](e,t)};r("squire.editor",(function(t,n){var r=n.type,a=n.data;"squireActions"===r&&function(t){var n=t.action,r=t.argument,a=void 0===r?{}:r,c=t.message,u=e.find(c).editor,l=i(u,n);if(/^(makeLink|insertImage|changeColor|changeFontFamily|changeFontSize|moreToggle|addKey|sign|requestReadReceipt)$/.test(n))return;var d=Object.keys(l.tests).filter((function(e){return l.tests[e]}));d.length?d.forEach((function(e){return u[e]()})):("setEditorMode"!==n&&u[n](s(n,a)),o("squire.native.action",{action:n,argument:a,message:c}));u.focus()}(a)}));var i=function(e,t){var n=e.testPresenceinSelection("makeOrderedList",t,"OL",/>OL\b/),r=e.testPresenceinSelection("makeUnorderedList",t,"UL",/>UL\b/);return{value:t,tests:{removeBold:e.testPresenceinSelection("bold",t,"B",/>B\b/),removeItalic:e.testPresenceinSelection("italic",t,"I",/>I\b/),removeUnderline:e.testPresenceinSelection("underline",t,"U",/>U\b/),removeList:n||r,removeLink:e.testPresenceinSelection("removeLink",t,"A",/>A\b/),decreaseQuoteLevel:e.testPresenceinSelection("increaseQuoteLevel",t,"blockquote",/>blockquote\b/)},isNotValue:function(e){return e===t&&""!==this.value}}},c=function(e){return Object(I.e)(e,(function(e){return/image.*/.test(e.type)}))},s=function(e,t){var n=t.value;return"setFontSize"===e?"".concat(n,"px"):n};return{makeLink:function(t,n){var r=n.link,a=void 0===r?"":r,i=n.title,c=n.wrap,s=e.find(t),u=s.editor,l=s.iframe,d=angular.element(u.getSelection().commonAncestorContainer).closest("a")[0],p=l[0].contentWindow.document.createRange(),f=l[0].contentWindow.getSelection();if(d&&(p.selectNodeContents(d),f.removeAllRanges(),f.addRange(p),u.setSelection(p)),u.makeLink(a,{target:"_blank",title:a,rel:"nofollow"}),!c){var v=angular.element(u.getSelection().commonAncestorContainer);(v.closest("a")[0]||v.find("a")[0]).textContent=i||a}o("squire.native.action",{action:"makeLink",message:t})},removeLink:function(t){e.find(t).editor.removeLink(),o("squire.native.action",{action:"removeLink",message:t})},insertImage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.url,a=n.file,o=n.opt,i=void 0===o?{}:o,s=e.find(t),u=s.editor;i.class=((i.class||" ")+"proton-embedded").trim();var l=function(e,t){u.focus(),e&&u.insertImage(e,xh({},t))};if(a){var d=xh({},i,{alt:a.name||a.Name});c(a).then((function(e){return l(e,d)}))}else l(r,i)},changeColor:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"color",a=e.find(t),i=a.editor,c="color"===r?"setTextColour":"setHighlightColour";i[c](n),o("squire.native.action",{action:c,argument:n,message:t})}}}Th.$inject=["editorModel","dispatchers"];var Lh=Th,jh=n("1M3H"),Nh=n.n(jh);function $h(e){var t=document.createElement("body"),n=Nh()("default",{breaks:!0,linkify:!0}),r=function(e){var t="";do{t=Math.random().toString(36).substring(3)+Math.random().toString(36).substring(3)}while(e.includes(t));return t},a=function(e,t){return(e.startsWith("\n")?e:"\n".concat(e)).replace(/((\r\n|\n)\s*(\r\n|\n))+/g,(function(e){return function(e,t){return e.replace(/(\r\n|\n)/g,(function(e){return e+t})).replace(new RegExp(t+"$","g"),"")}(e,t)})).replace(/^\n/g,"").replace(/(>[^\r\n]*(?:\r\n|\n))(\s*[^>])/g,(function(e,t,n){return"".concat(t,"\n").concat(n)}))},i=function(e,t){return e.replace(new RegExp(t,"g"),"")},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\\/g,"\\\\")},u=function(t,n){var r=e.getTXT(n);return t.replace(r,"--protonSignature--")},l=function(t,n,r){var a=e.getHTML(n,!1,!r.startsWith("--protonSignature--"));return t.replace("--protonSignature--",a)},d=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=u(e,o),d=r(c),p=i(n.render(a(s(c),d)),d);return t.innerHTML=p,We()(t.querySelectorAll("p"),(function(e){var t=document.createElement("div");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)})),l(t.innerHTML,o,c)},p=function(){var e=c()(o.a.mark((function e(){var t=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.apply(void 0,t));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{parse:d,parseAsync:p}}$h.$inject=["signatureBuilder"];var Rh=$h;Fh.$inject=["dispatchers","embeddedUtils","attachmentModel","textToHtmlMail"];var _h=s.Gb.DEFAULT,Uh=s.Gb.PLAINTEXT;function Fh(e,t,n,r){var a=e(["squire.toggleMode","attachment.upload","message"]),o=a.on,i=a.dispatcher,c={CAN_TOGGLE:{},ATTACHMENTS_PROCESSING:{}},s=function(e){return!(function(e){return e.uploading&&!!n.getCurrentQueue(e)&&n.getCurrentQueue(e).files.some((function(e){return e.file.inline}))}(e)||e.MIMEType===Uh&&function(e){var n=e.getDecryptedBody(),r=t.getBodyParser(n);return t.extractEmbedded(e.Attachments,r).length}(e)||xo()(c.ATTACHMENTS_PROCESSING[e.ID]).length)};o("attachment.upload",(function(e,t){var n=t.type,r=t.data;"remove.success"!==n&&"remove.error"!==n||!c.ATTACHMENTS_PROCESSING[r.message.ID]||delete c.ATTACHMENTS_PROCESSING[r.message.ID][r.attachment.ID],!r.message||r.message.ID in c.CAN_TOGGLE&&c.CAN_TOGGLE[r.message.ID]===s(r.message)||(c.CAN_TOGGLE[r.message.ID]=s(r.message),function(e,t){i["squire.toggleMode"](e,{message:t})}(c.CAN_TOGGLE[r.message.ID]?"enableToggle":"disableToggle",r.message))}));return{canToggle:s,clear:function(e){var t=e.ID;delete c.CAN_TOGGLE[t],delete c.ATTACHMENTS_PROCESSING[t]},toPlainText:function(e,n){var r=e.getDecryptedBody(),a=t.getBodyParser(r,!0),o=t.extractEmbedded(e.Attachments,a);i["attachment.upload"]("remove.all",{message:e,list:o}),c.ATTACHMENTS_PROCESSING[e.ID]=c.ATTACHMENTS_PROCESSING[e.ID]||{};var s=o.reduce((function(e,t){return e[t.ID]=!0,e}),{});Ge()(c.ATTACHMENTS_PROCESSING[e.ID],s);var u=Ff(n);return e.MIMEType=Uh,e.setDecryptedBody(u,!1),i.message("updated",{message:e}),u},toHtml:function(e,t){var n=r.parse(t,e);return e.MIMEType=_h,e.setDecryptedBody(n,!1),i.message("updated",{message:e}),n}}}var Bh=Fh;function Kh(e,t,n,r,a){var i=a((function(){return{PASTED_IMAGE:r.getString("Pasted-image",null,"Title pasted image")}})),s=function(e){var t=Object(Pe.f)();if(!Object(Pe.i)()&&!t){var n=(e.type||"image/jpeg").split("/"),r=G()(n,2)[1],a=void 0===r?"":r;return new File([e],"".concat(i.PASTED_IMAGE,"-").concat(new Date,".").concat(a),{lastModified:new Date,type:e.type})}return t?e.getAsFile():e},u=function(){var r=c()(o.a.mark((function r(a,i){var c,u,l,d;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.isUploadMIMEType(a.type)){r.next=2;break}return r.abrupt("return");case 2:return(c=s(a)).inline=1,c.upload={uuid:"".concat(Object(Ot.k)())},r.next=7,t.create(c,i);case 7:if(r.t0=r.sent,r.t0){r.next=10;break}r.t0={};case 10:u=r.t0,l=u.url,d=u.cid,n.insertImage(i,{url:l,opt:{"data-embedded-img":d,alt:c.title}});case 14:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}();return function(e,t){return function(n){if("paste.image"===t)return u(n.file,e);var r=n.clipboardData,a=void 0===r?window.clipboardData:r,o=Array.from(a.files||a.items||[]).map((function(t){return u(t,e)}));Promise.all(o)}}}Kh.$inject=["attachmentFileFormat","attachmentModel","squireExecAction","gettextCatalog","translator"];var Gh=Kh,Vh=angular.module("proton.squire",[]).directive("addFile",Dg).directive("addLink",Ig).directive("colorList",jg).directive("colorPopover",$g).directive("moreToggle",Fg).directive("plainTextArea",Gg).directive("squire",Wg).directive("squireModalListener",dh).directive("squireActions",Jg).directive("squireSelectColor",Zg).directive("squireSelectFontFamily",th).directive("squireSelectFontSize",rh).directive("squireToolbar",oh).directive("squireState",ch).factory("pasteImage",Gh).factory("editorModel",ph).factory("editorState",vh).factory("squireEditor",yh).factory("editorDropzone",Ih).factory("editorListener",wh).factory("removeInlineWatcher",Mh).factory("squireExecAction",Lh).factory("addLinkModal",Sh).factory("addFileModal",kh).factory("textToHtmlMail",Rh).factory("toggleModeEditor",Bh).name;function qh(e,t,r){return{restrict:"E",replace:!0,scope:{},templateUrl:n("E0jj"),link:function(n,a){var o=r.get(),i=o.Name,c=o.Password;n.VPNName=i,n.VPNPassword=c;var s=function(r){switch(r.target.getAttribute("data-action")){case"changeName":!function(t){var n={name:t.VPNName,close:function(n){n&&t.$applyAsync((function(){t.VPNName=n})),e.deactivate()}};e.activate({params:n})}(n);break;case"changePassword":!function(e){var n={password:e.VPNPassword,close:function(n){n&&e.$applyAsync((function(){e.VPNPassword=n})),t.deactivate()}};t.activate({params:n})}(n);break;case"togglePassword":a[0].classList.toggle("openVpnSection-show-password")}};a.on("click",s),n.$on("$destroy",(function(){a.off("click",s)}))}}}qh.$inject=["changeVPNNameModal","changeVPNPasswordModal","vpnSettingsModel"];var Hh=qh;var zh=function(){return{scope:{},restrict:"E",replace:!0,templateUrl:n("FkcE")}};function Yh(e,t,r,a,o){return{restrict:"E",replace:!0,scope:{},templateUrl:n("25VP"),link:function(n){var i=e(),c=i.on,s=i.unsubscribe,u=function(){var e;n.VPNLogin=a.isMember()?(e=t.get()).length?e[0].Email:"":r.user.Name,n.vpnStatus=o.get("Status"),n.hasPaidVpn=r.hasPaidVpn()};c("updateUser",(function(){n.$applyAsync((function(){u()}))})),u(),n.$on("$destroy",s)}}}Yh.$inject=["dispatchers","addressesModel","authentication","memberModel","vpnSettingsModel"];var Wh=Yh;function Xh(e,t,r,a,o){return e({controllerAs:"ctrl",templateUrl:n("zJe1"),controller:["params","gettextCatalog",function(e,n){var i=this,c=n.getString("OpenVPN login updated",null,"Info");this.VPNName=e.name||"",this.submit=function(){var n=i.VPNName,s=o.updateName({VPNName:n}).then((function(){return r.call()})).then((function(){return t.success(c),e.close(n)}));a.track(s)},this.cancel=function(){return e.close()}}]})}Xh.$inject=["pmModal","notification","eventManager","networkActivityTracker","vpnSettingsModel"];var Jh=Xh;function Qh(e,t,r,a,o,i){return e({controllerAs:"ctrl",templateUrl:n("bmhq"),controller:["params","gettextCatalog",function(e,n){var a=this,c=n.getString("OpenVPN password updated",null,"Info");this.VPNPassword="",this.passwordDefined=e.password,this.submit=function(){var n=a.VPNPassword,s=i.updatePassword({VPNPassword:n}).then((function(){return r.call()})).then((function(){return t.success(c),e.close(n)}));o.track(s)},this.cancel=function(){return e.close()}}]})}Qh.$inject=["pmModal","notification","eventManager","gettextCatalog","networkActivityTracker","vpnSettingsModel"];var Zh=Qh;function eb(e,t){var n=t.build("vpn");return{get:function(){return e.get(n())}}}eb.$inject=["$http","url"];var tb=eb,nb=angular.module("proton.vpn",[]).factory("vpnApi",tb).directive("openVpnSection",Hh).directive("vpnRessources",zh).directive("vpnView",Wh).factory("changeVPNNameModal",Jh).factory("changeVPNPasswordModal",Zh).name,rb=function(e){return{link:function(t,n,r){var a=r.displayWizardButton,o=r.displayPosition,i=e(["tourActions"]).dispatcher,c=function(){return i.tourActions(a||"tourStart",{position:+o})};n.on("click",c),t.$on("$destroy",(function(){n.off("click",c)}))}}};rb.$inject=["dispatchers"];var ab=rb;function ob(e,t,r,a,i,s,u){return{restrict:"E",replace:!0,templateUrl:n("5W4V"),link:function(n,l){var d=e(),p=d.on,f=d.unsubscribe,v=function(){return l[0].classList.remove("wizardStep-hidden")},m=function(){return l[0].classList.add("wizardStep-hidden")};r((function(){t.welcome&&i.activate({params:{cancel:function(){i.deactivate()},next:function(){i.deactivate(),u.is("mobile")||g()}}})}),0),p("tourActions",(function(e,t){var n=t.type,r=t.data,a=void 0===r?{}:r;"tourStart"===n&&g(),"tourEnd"===n&&b(),"tourNext"===n&&y(),"tourGo"===n&&E(a.position)})),p("$stateChangeSuccess",(function(){l[0].classList.contains("wizardStep-hidden")||b()})),n.$on("$destroy",(function(){f(),b()}));function g(){return h.apply(this,arguments)}function h(){return(h=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.go("secured.inbox");case 2:u.set("tourActive",!0),n.$applyAsync((function(){n.tourActive=!0,v(),r((function(){return l[0].focus()}),0,!1)})),E(1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){m(),u.set("tourActive",!1),n.$applyAsync((function(){n.tourActive=!1,s.hideTooltips(),$(".tooltip").removeClass("tour")}))}function y(){4!==n.tourStep&&E(Number(n.tourStep+1))}function E(e){s.destroyTooltips(),n.$applyAsync((function(){n.tourStep=e,s.renderTooltips(e),function(e){l[0].className=l[0].className.replace(/wizardStep-\d{1}/,"wizardStep-".concat(e))}(e)}))}l.on("keydown",(function(e){var t=e.keyCode;37===t&&n.tourStep>1&&E(Number(n.tourStep-1)),39===t&&y()}))}}}ob.$inject=["dispatchers","$stateParams","$timeout","$state","welcomeModal","wizardBuilder","AppModel"];var ib=ob;var cb=function(){var e=[];return{hideTooltips:function(){return e.forEach((function(e){return e.hide()}))},destroyTooltips:function(){e.forEach((function(e){return e.dispose()})),e.length=0},renderTooltips:function(t){var n=setTimeout((function(){(function(t){switch(t){case 2:e.push(Object(O.a)($("#tour-layout"),{title:"1",placement:"left",trigger:"manual"})),e.push(Object(O.a)($("#tour-settings"),{title:"2",placement:"left",trigger:"manual"}));break;case 3:e.push(Object(O.a)($("#tour-label-dropdown"),{title:"1",placement:"bottom",trigger:"manual"})),e.push(Object(O.a)($("#tour-folder-dropdown"),{title:"2",placement:"bottom",trigger:"manual"})),e.push(Object(O.a)($("#tour-label-settings"),{title:"3",placement:"top",trigger:"manual"}));break;case 4:e.push(Object(O.a)($("#tour-support"),{title:"1",placement:"left",trigger:"manual"}))}return e})(t).forEach((function(e){return e.show()})),$(".tooltip:visible").addClass("tour"),clearTimeout(n)}))}}},sb=angular.module("proton.wizard",[]).directive("displayWizardButton",ab).directive("wizard",ib).factory("wizardBuilder",cb).name,ub=n("60cV");function lb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function db(e,t,r,a,i,u,l){var d={241:"Two-for-one deal",2:"Two-year deal",price:function(e){return"".concat(e," for the first 2 years")},regularPrice:function(e){return"Regular monthly price ".concat(e)},currentPrice:function(e){return"Current price ".concat(e)},currentSubscriptionPrice:function(e,t){return"You are currently charged ".concat(e,"/month for ").concat(t)},savings:function(e){return"Save ".concat(e," over two years")},billing:function(e){return"Billed as ".concat(e," for two years")},afterBilling:function(e){return"Minus any prorated refund for remaining funds allocated to a current plan. After two years, your subscription automatically renews at the price of ".concat(e," every two years.")},header:function(e){var t=Object(as.a)();return"".concat(t,1===e?" deal":" deals")},and:" and ",commit2:"Save more with a two year plan!",get2:"Get two years for the price of one!",perMonth:"/mo",buy:"Get the deal"},p=function(e,t,n){return l("currency")(e/100/t,n)},f=l("percentage"),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(e){return e.Type===s.Sb.PLAN})).map((function(e){return e.Title}))},g=function(e,t){return{payment:t,PlanIDs:e}},h=function(e,t){var n=e.PlanIDs,r=e.plans,a=void 0===r?[]:r,o=G()(e.payments,3),i=o[0];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lb(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lb(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},function(e){var t=e.discount,n=e.regular,r=e.after,a=e.index,o="*".repeat(a+1),i=t.Cycle,c=t.Currency,s=Object(ub.d)(t),u=Object(ub.a)(t),l=n.Amount,v=Object(ub.f)(l,n.Cycle,i),m=v-u,g=Object(ub.a)(r);return{header:d[s?241:2],percentage:f((v-u)/v),discountedPrice:p(u,i,c),regularPrice:d.regularPrice(p(l,n.Cycle,c)),savings:d.savings(p(m,1,c)),billing:d.billing(p(u,1,c))+o,afterBilling:o+d.afterBilling(p(g,1,c))}}({discount:i,regular:o[1],after:o[2],index:t}),{plans:m(a),clickData:g(n,i)})};return{restrict:"E",replace:!0,scope:{},templateUrl:n("v29M"),link:function(n,l){var f=e(["closeDropdown","blackFriday"]),v=f.dispatcher,g=f.on,b=f.unsubscribe,y=function(e){return n.$applyAsync((function(){return n.state.loading=e}))},E=function(e){return y(!0),e.then((function(e){return y(!1),e})).catch((function(e){return y(!1),Promise.reject(e)}))},S=function(){var e=c()(o.a.mark((function e(t){var r,c,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.payment,c=t.PlanIDs,!n.state.loading){e.next=3;break}return e.abrupt("return");case 3:return s=E(i.plans()),e.next=6,u.track(s);case 6:l=e.sent,a.activate({params:{isBlackFriday:!0,planIDs:c,valid:r,plans:l,cancel:function(){a.deactivate()}}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(e){var t=e.target;if(n.offers){var r=t.dataset.buyOffer,a=n.offers[r];a&&(S(a.clickData),v.blackFriday("closeModal"))}},k=function(e){return E(r.getOffers(e)).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n.$applyAsync((function(){n.state.header=d.header(e.length),n.state.intro=d[e.some((function(e){var t=G()(e.payments,1)[0];return!Object(ub.d)(t)}))?"commit2":"get2"],n.offers=e.map(h)}))}))};n.state={loading:!0,currency:t.currency(),perMonth:d.perMonth,buy:d.buy,end:Object(as.b)()?s.i.BETWEEN.END:s.F.BETWEEN.END},n.currentPrice=function(e){var t=e.Amount,n=e.Cycle,r=e.Currency,a=e.Plans;if(t){var o=m(void 0===a?[]:a).join(d.and);return d.currentSubscriptionPrice(p(t,n,r),o)}}(t.get()),u.track(r.loadPayments().then((function(){return k(n.state.currency)}))),l.on("click",D),g("blackFridayCurrency",(function(e,t){var r=t.type,a=t.data;"change"===r&&(n.state.currency=a,u.track(k(n.state.currency)))})),n.$on("destroy",(function(){l.off("click",D),b()}))}}}db.$inject=["dispatchers","subscriptionModel","blackFridayModel","paymentModal","PaymentCache","networkActivityTracker","$filter"];var pb=db;var fb=function(){var e=function(e,t){var n=moment(t).diff(e);if(n<0)return"Expired";var r=Math.floor(n/s.nc.DAY),a=Math.floor(n%s.nc.DAY/s.nc.HOUR),o=Math.floor(n%s.nc.HOUR/s.nc.MINUTE),i=Math.floor(n%s.nc.MINUTE/s.nc.SECOND);return["".concat(r," d"),"".concat(a," h"),"".concat(o," m"),"".concat(i," s")].join(" : ")};return{restrict:"E",replace:!0,templateUrl:n("rc0/"),scope:{},link:function(t,n,r){var a=r.end,o=moment(void 0===a?"":a,"YYYY-MM-DD").valueOf(),i=moment(new Date);n[0].textContent=e(i,o);var c=setInterval((function(){o-=s.nc.SECOND,n[0].textContent=e(i,o)}),s.nc.SECOND);t.$on("$destroy",(function(){clearInterval(c)}))}}};function vb(e,t){var n={},r=t(["blackFriday"]),a=r.dispatcher;return(0,r.on)("logout",(function(){clearInterval(n.intervalHandle),delete n.intervalHandle})),function(){clearInterval(n.intervalHandle),n.intervalHandle=setInterval((function(){return a.blackFriday("tictac")}),s.i.INTERVAL)}}vb.$inject=["$stateParams","dispatchers"];var mb=vb,gb=s.G.TWO_YEARS,hb=s.Rb.PLAN,bb=hb.PLUS,yb=hb.VPN_PLUS,Eb=hb.VPN_BASIC,Sb=hb.PROFESSIONAL,Db=hb.VISIONARY,kb={offers:[{name:bb},{name:yb}],coupon:s.i.COUPON_CODE,cycle:s.i.CYCLE},Ab=function(e){return-1===e.indexOf("vpn")?-1:1},Ib=function(e,t){var n=e.CouponCode,r=e.Cycle,a=e.Plans,o=void 0===a?[]:a,i=t.Role,c=t.subuser,u="LIFETIME"===n||"VISIONARYFOREVER"===n,l=r===gb,d=i===s.Nb;if(u||d||!!c||l)return[];var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){var n=t.Name,r=t.Type;return r===s.Sb.ADDON&&(e.addons[n]=t),r===s.Sb.PLAN&&(e.plans[n]=t),e}),{plans:{},addons:{}})}(o);return function(e,t){var n=Object.keys(e).length,r=Object.keys(t).length;return(e[bb]||e[Sb])&&r>0?[{offers:[].concat(we()(Object.keys(e).sort(Ab).map((function(e){return{name:e}}))),we()(Object.keys(t).map((function(e){return{name:e,quantity:t[e].Quantity}})))),cycle:s.G.TWO_YEARS}]:n?e[Eb]&&1===n?[{offers:[{name:Eb}],cycle:gb},{offers:[{name:yb}],coupon:s.i.COUPON_CODE,cycle:s.i.CYCLE}]:e[yb]&&1===n?[{offers:[{name:yb}],cycle:gb},{offers:[{name:bb},{name:yb}],cycle:gb}]:e[bb]&&1===n?[{offers:[{name:bb}],cycle:gb},kb]:e[bb]&&e[Eb]?[kb]:e[bb]&&e[yb]?[{offers:[{name:bb},{name:yb}],cycle:gb}]:e[Db]?[{offers:[{name:Db}],cycle:gb}]:e[Sb]?[{offers:we()(Object.keys(e).sort(Ab).map((function(e){return{name:e}}))),cycle:gb}]:[]:[{offers:[{name:bb}],coupon:s.i.COUPON_CODE,cycle:s.i.CYCLE},kb]}(p.plans,p.addons)};function Cb(e,t,n,r){var a=function(){return"protonmail_black_friday_".concat(e.user.ID,"_").concat(s.i.YEAR)},i=function(){return Object(na.a)(a(),!1)},u=function(e,t,n){return function(e){var a=e.offers,o=void 0===a?[]:a,i=e.coupon,c=e.cycle,u=o.reduce((function(e,n){var r=n.name,a=n.quantity,o=void 0===a?1:a,i=t[r],c=i.ID;return e.PlanIDs[c]=o,e.plans.push(i),e}),{PlanIDs:{},plans:[]}),l=u.PlanIDs,d=u.plans;return Promise.all([r.valid({PlanIDs:l,Currency:n,Cycle:c,CouponCode:i}),r.valid({PlanIDs:l,Currency:n,Cycle:s.G.MONTHLY}),r.valid({PlanIDs:l,Currency:n,Cycle:s.i.CYCLE})]).then((function(e){return{PlanIDs:l,payments:e,plans:d}}))}};return{isDealPeriod:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!!Ib(t.get(),e.user).length&&(!(!n&&i())&&Object(as.c)())},loadPayments:function(){return Promise.all([n.getMethods(),n.getStatus()])},getOffers:function(){var n=c()(o.a.mark((function n(a){var i,c,s,l,d;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=t.get(),(c=Ib(i,e.user)).length){n.next=4;break}return n.abrupt("return");case 4:return n.next=6,r.plans();case 6:return s=n.sent,l=Object(ub.c)(s),d=u(0,l,a||l.free.currency),n.abrupt("return",Promise.all(c.map(d)));case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),saveClose:function(){Object(na.b)(a(),"closed")}}}Cb.$inject=["authentication","subscriptionModel","paymentModel","PaymentCache"];var wb=Cb;function Ob(e,t,r){return e({controllerAs:"ctrl",templateUrl:n("j5nk"),controller:["params",function(e){var n=r(),a=n.on,o=n.unsubscribe;a("blackFriday",(function(t,n){"closeModal"===n.type&&e.close()})),this.$onDestroy=function(){t.saveClose(),o()}}]})}Ob.$inject=["pmModal","blackFridayModel","dispatchers"];var Mb=Ob;function Pb(e,t,n,r,a){var o={};(0,a().on)("logout",(function(){o={}}));var i=function(){t.activate({params:{close:function(){t.deactivate()}}})};return function(){if(o.loading)return o.loading;var t=n.currency();return o.hasData&&t===o.currency?(i(),Promise.resolve()):(o.hasData=!1,o.currency=t,o.loading=e.getOffers(t).then((function(){o.hasData=!0,o.loading=void 0,i()})).catch((function(){o.currency=void 0,o.loading=void 0})),r.track(o.loading),o.loading)}}Pb.$inject=["blackFridayModel","blackFridayModal","subscriptionModel","networkActivityTracker","dispatchers"];var xb=Pb,Tb=angular.module("proton.blackFriday",[]).directive("blackFriday",pb).directive("blackFridayCountdown",fb).factory("blackFridayHandler",mb).factory("blackFridayModel",wb).factory("blackFridayModalOpener",xb).factory("blackFridayModal",Mb).name,Lb=n("9nhX"),jb=n.n(Lb),Nb=function(e){function t(e){this.message=e,this.stack=(new Error).stack}return t.prototype=Object.create(Error.prototype),t.prototype.name=e,t},$b=Nb("ContactUpdateError"),Rb=(Nb("ContactRemoveError"),n("6R14"));Ub.$inject=["$http","dispatchers","url","chunk","contactEncryption","sanitize","eventManager","contactProgressReporter"];var _b=[s.w.ENCRYPTED,s.w.ENCRYPTED_AND_SIGNED];function Ub(e,t,n,r,a,i,u,l){var d=n.build("contacts"),p=t(["contacts"]).dispatcher;function f(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(e){return e.Email=i.input(e.Email),e.Name=Nl()(i.input(e.Name)),e}))}function v(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return e.get(t,{params:n,timeout:r}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?{}:t;return n}))}var m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=we()(new Array(e)).map((function(e,t){return t+n})),o=r(a,s.u);return Object(Rb.b)(o,t,1e3)};function g(){return h.apply(this,arguments)}function h(){return(h=c()(o.a.mark((function e(){var t,n,r,a,i,c,s,u,l,d,p=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:"",n=p.length>1?p[1]:void 0,r=n.PageSize,a=n.key,i=void 0===a?"":a,c=p.length>2?p[2]:void 0,s=function(e){return v(t,{PageSize:r,Page:e},c)},e.next=6,s();case 6:if(u=e.sent,!((l=Math.ceil(u.Total/r)-1)>0)){e.next=14;break}return e.next=11,m(l,s,1);case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=[];case 15:return d=e.t0,e.abrupt("return",[u].concat(we()(d)).reduce((function(e,t){return e.concat(t[i])}),[]));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t){return y.apply(this,arguments)}function y(){return(y=c()(o.a.mark((function e(t,n){var r,i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(d(t),{},n);case 2:return r=e.sent,i=r.Contact,e.next=6,a.decrypt([i]);case 6:return c=e.sent,s=G()(c,1),u=s[0],e.abrupt("return",u);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(t){return e.put(d("delete"),t).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?{}:t;return n})).then((function(e){var t=e.Responses;return(void 0===t?[]:t).reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.ID,r=t.Response,a=void 0===r?{}:r;return a.Error?e.errors.push({ID:n,Error:a.Error,Code:a.Code}):e.removed.push(n),e}),{removed:[],errors:[]})}))},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data.Responses,n=void 0===t?[]:t;return n.reduce((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.Response,r=void 0===n?{}:n,a=r.Contact,o=(a=void 0===a?{}:a).ID;return o&&e.push(o),e}),[])},D=function(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=bt()(n,(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.data,r=void 0===n?{}:n;return We()(r.Responses,(function(t){var n=t.Response,r=void 0===n?{}:n;if(r.Error)return e.errors.push({code:r.Code,name:r.Name,emails:r.Emails,error:r.Error});e.created.push(r.Contact)})),e}),{created:[],errors:[]}),a=r.created,o=r.errors;return{created:a,errors:o,total:e,mapCategories:t}}};function k(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,p=a?l(50,100,n):function(){},f=vo(t),v=jb()(s.s,5,t.length/5),m=r(t,v),g=jb()(s.r,1,m.length/3),h=[];return r(m,g).reduce(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(){var n=c()(o.a.mark((function n(r,a){var s,l,f;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r;case 2:return s=n.sent,l=a.map(function(){var t=c()(o.a.mark((function t(n){var r,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={Contacts:n,Groups:1,Overwrite:1,Labels:0},t.next=3,e.post(d(),r);case 3:return a=t.sent,!i.isCancelled()&&p(n.length),t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.next=6,Promise.all(l);case 6:return f=n.sent,s.push.apply(s,we()(f)),t.push.apply(t,we()(f.map(S))),n.next=11,u.call();case 11:return i.check(),n.abrupt("return",r);case 13:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}(h),[]).catch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t){if(t.isCancellationError){var n=function(){throw t};return E({IDs:e}).then(u.call).then(n,n)}throw t}}(h)).then(D(n,f))}function A(){return(A=c()(o.a.mark((function e(){var t,n,r,i,c,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:[],n=s.length>1&&void 0!==s[1]?s[1]:Object(Rb.a)(),r=s.length>2&&void 0!==s[2]&&s[2],e.next=5,a.encrypt(t,n,r);case 5:return i=e.sent,e.next=8,k(i,t.length,r,n);case 8:return c=e.sent,p.contacts("contactsUpdated"),e.abrupt("return",c);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=c()(o.a.mark((function t(n){var r,i,c,s,u,l,p,f,m,g,h,b,y;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d(n.ID),i=a.encrypt([n]),c=v(r),t.next=5,Promise.all([i,c]);case 5:return s=t.sent,u=G()(s,2),l=G()(u[0],1),p=l[0],f=u[1].Contact,m=function(e){return _b.includes(e)},g=f.Cards.filter((function(e){var t=e.Type;return m(t)})),p.Cards=p.Cards.filter((function(e){var t=e.Type;return!m(t)})).concat(g),t.next=15,e.put(r,p);case 15:if(t.t0=t.sent,t.t0){t.next=18;break}t.t0={};case 18:return h=t.t0,b=h.data,(y=void 0===b?{}:b).cards=p.Cards,t.abrupt("return",y);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(){return(C=c()(o.a.mark((function e(){var t,n,r,i=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:s.V,n=i.length>1&&void 0!==i[1]?i[1]:Object(Rb.a)(),e.next=4,g(d("export"),{key:"Contacts",PageSize:t});case 4:return r=e.sent,e.abrupt("return",a.decrypt(r,n,!0));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=c()(o.a.mark((function e(t){var n,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.decrypt([t]);case 2:return n=e.sent,r=G()(n,1),i=r[0],e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=function(){var t=c()(o.a.mark((function t(n){var r,a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.put(d("emails","label"),n);case 2:return r=t.sent,a=r.data,i=void 0===a?{}:a,t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function M(){return(M=c()(o.a.mark((function t(n){var r,a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(d("emails"),{params:{LabelID:n}});case 2:return r=t.sent,a=r.data,i=void 0===a?{}:a,t.abrupt("return",i.ContactEmails);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{hydrate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.x;return g(d("emails"),{key:"ContactEmails",PageSize:e}).then(f)},all:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.p;return g(d(),{key:"Contacts",PageSize:e})},get:b,getMultiple:function(e,t){return Promise.all(e.map((function(e){return b(e,t)})))},add:function(){return A.apply(this,arguments)},update:function(t){return a.encrypt([t]).then((function(n){return e.put(d(t.ID),n[0]).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,r=void 0===t?{}:t;return r.cards=n[0].Cards,r})).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?{}:t;throw new $b(n.Error)}))}))},updateUnencrypted:function(e){return I.apply(this,arguments)},remove:E,clear:function(){return e.delete(d())},exportAll:function(){return C.apply(this,arguments)},groups:function(){return e.get(d("groups"))},decrypt:function(e){return w.apply(this,arguments)},load:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e?d(e):d(),n=e?s.x:s.p/10;return v(t,{PageSize:n})},exportGroup:function(e){return M.apply(this,arguments)},label:function(){var t=c()(o.a.mark((function t(n){var r,a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.put(d("label"),n);case 2:return r=t.sent,a=r.data,i=void 0===a?{}:a,t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),unlabel:function(t){return e.put(d("unlabel"),t)},labelEmails:O,unlabelEmails:function(t){return e.put(d("emails","unlabel"),t)}}}var Fb=Ub;var Bb=function(){var e="contactAddressInput-street",t="contactAddressInput-field",r="contactAddressInput-focussed",a=200;return{restrict:"E",replace:!0,scope:{value:"=",form:"=",focused:"="},templateUrl:n("3c8R"),link:function(n,o){var i=o.find(".".concat("contactAddressInput-default")),c=Array.isArray(n.value)&&n.value.length>1?n.value:["","",n.value],s=G()(c,7),u=s[0],l=void 0===u?"":u,d=s[1],p=void 0===d?"":d,f=s[2],v=void 0===f?"":f,m=s[3],g=void 0===m?"":m,h=s[4],b=void 0===h?"":h,y=s[5],E=void 0===y?"":y,S=s[6],D=void 0===S?"":S,k=o.find(".".concat(t)),A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.value;return e.filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.trim()})).join("\n")};function I(){o.addClass(r),setTimeout((function(){return o.find(".".concat(e)).focus()}),a),n.$applyAsync((function(){return n.focused=!0}))}function C(){setTimeout((function(){o.find(".".concat(t,":focus")).length||(o.removeClass(r),n.$applyAsync((function(){return n.focused=!1})))}),a)}function w(){n.$applyAsync((function(){var e=n.model,t=e.postBox,r=e.extended,a=e.street,o=e.locality,i=e.region,c=e.postalCode,s=e.country;n.value=[t,r,a,o,i,c,s],n.model.default=A()}))}n.model={default:A(c),postBox:l,extended:p,street:v,locality:g,region:b,postalCode:E,country:D},l.length&&o.addClass("contactAddressInput-show-post-box"),p.length&&o.addClass("contactAddressInput-show-extended"),i.on("focus",I),k.on("change",w),k.on("blur",C),n.$on("$destroy",(function(){i.off("focus",I),k.off("change",w),k.off("blur",C)}))}}};function Kb(e,t){var r="contactPhotoRow-image-blocked";return{restrict:"E",replace:!0,require:"^form",scope:{value:"=",form:"="},templateUrl:n("GI6n"),link:function(n,a,o,i){var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!n.showImage&&s.Zb.test(e);n.uri=t?s.Qb:e||s.Qb,n.value=e,a[0].classList[e?"remove":"add"]("contactPhotoRow-hide-clear-button"),a[0].classList[t?"add":"remove"](r)},u={edit:function(){e.activate({params:{uri:n.value,submit:function(t){e.deactivate(),n.$applyAsync((function(){n.showImage=!0,c(t),i.$setDirty()}))},cancel:function(){e.deactivate()}}})},clear:function(){n.$applyAsync((function(){c(),i.$setDirty()}))},load:function(){n.$applyAsync((function(){n.showImage=!0,n.uri=n.value||s.Qb,a[0].classList.remove(r)}))}},l=function(e){var t=e.target.getAttribute("data-action");t&&u[t]()};n.showImage=t.get("ShowImages")&s.ac,a.on("click",l),c(n.value),n.$on("$destroy",(function(){a.off("click",l)}))}}}Kb.$inject=["contactPhotoModal","mailSettingsModel"];var Gb=Kb;var Vb=function(){return{replace:!0,priority:100,templateUrl:n("vntB")}},qb=n("ejxE"),Hb=n.n(qb),zb=function e(t){return Array.isArray(t)?t.filter(e).length:!t||t.isEmpty()},Yb=function(e,t){return!t||e.getGroup()===t},Wb=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return ri()(e,(function(e){var t=e.getType(),n=e.valueOf();if(t)return"".concat(t," ").concat(n);if("categories"===e.getField()){var r=(e.getParams()||{}).group;return"".concat(t," ").concat(n," ").concat(r)}return n}))};function Xb(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wa.a,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).group;return t.reduce((function(t,r){var a=e.get(r);if(zb(a))return t;var o=a.valueOf();if(Array.isArray(o))return co(o).forEach((function(e){Yb(e,n)&&t.push(e)})),t;if(La.PHOTO.includes(r)){var i=new wa.a.Property(r,Object(Bt.b)(o),a.getParams());return Yb(i,n)&&t.push(i),t}return Yb(a,n)&&t.push(a),t}),[])}function Jb(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wa.a;return bt()(Object.keys(e.data),(function(t,n){var r=e.get(n),a=Array.isArray(r)?r:[r];return t.concat(a)}),[])}function Qb(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wa.a,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return Object.keys(e.data).reduce((function(r,a){return Object(ka.e)(e.get(a)).filter((function(e){return e.getField()!==t||e.getGroup()!==n})).forEach((function(e){r.addProperty(e)})),r}),new wa.a)}ny.$inject=["$state","AppModel","contactDetailsModel","contactBeforeToLeaveModal","contactEncryptionModal","gettextCatalog","notification","subscriptionModel","memberModel","dispatchers","translator"];var Zb=s.w.ENCRYPTED_AND_SIGNED,ey=s.w.ENCRYPTED,ty=s.w.SIGNED;function ny(e,t,r,a,o,i,c,s,u,l,d){var p=d((function(){return{invalidForm:i.getString("This form is invalid",null,"Error displays when the user try to leave an unsaved and invalid contact details")}}));return{restrict:"E",replace:!0,priority:200,scope:{contact:"=",modal:"=",mode:"="},templateUrl:n("E7tl"),link:function(n,i){var d=l(["contacts"]),f=d.on,v=d.unsubscribe,m=d.dispatcher,g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if([Zb,ty,ey].some((function(t){return-1!==e.indexOf(t)})))return i.addClass("contactDetails-encrypted-and-signed");i.removeClass("contactDetails-encrypted-and-signed")},h=!s.hasPaid("mail")&&!u.isMember(),b=Jb(n.contact.vCard),y=J()(b,(function(e){return"email"===e.getField()})).length;function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n.contactForm.$invalid||!Be()(Hb.a,Ne()((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.concat(t.filter((function(e){var t=e.value;return void 0===t?"":t})))}),[]))(n.model).length)return c.error(p.invalidForm),!1;var t=r.prepare(n);return n.contact.ID?(t.ID=n.contact.ID,m.contacts("updateContact",{contact:t})):m.contacts("createContact",{contacts:[t],state:e}),n.$applyAsync((function(){n.contactForm.$setSubmitted(!0),n.contactForm.$setPristine(!0)})),!0}_rAF((function(){return i.find('[autofocus="autofocus"]').focus()})),n.model={},n.state={encrypting:!1,ID:n.contact.ID,hasEmail:y,isFree:h},g(n.contact.types),i.on("submit",(function(){return E()})),f("contacts",(function(e,t){var r=t.type,a=void 0===r?"":r,o=t.data,i=void 0===o?{}:o;n.modal&&"submitContactForm"===a&&E(),"contactBeforeToLeaveModal"===a&&"confirm"===i.choice&&E(),"contactUpdated"===a&&i.contact.ID===n.contact.ID&&g(i.cards.map((function(e){return e.Type})))})),f("hotkeys",(function(e,n){var r=n.type;"save"!==(void 0===r?"":r)||t.get("activeComposer")||E()})),f("$stateChangeStart",(function(t,r,o){n.state.ID&&n.contactForm.$dirty&&(t.preventDefault(),function(t,r){a.activate({params:{confirm:function(){a.deactivate(),E({toState:t,toParams:r})&&e.go(t.name,r)},discard:function(){a.deactivate(),n.contactForm.$setPristine(!0),e.go(t.name,r)}}})}(r,o))})),n.$on("$destroy",(function(){i.off("submit",E),v(),o.deactivate()}))}}}var ry=ny;function ay(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ay(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ay(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function iy(e,t,r){var a=[{field:"FN",icon:"fa-user"},{field:"EMAIL",icon:"fa-envelope"},{field:"TEL",icon:"fa-phone"},{field:"BDAY",icon:"fa-birthday-cake"},{field:"ADR",icon:"fa-home"},{field:"ORG",icon:"fa-vcard"},{field:"NOTE",icon:"fa-sticky-note"},{field:"PHOTO",icon:"fa-photo"}].reduce((function(e,t){return e[Ha(t.field.toLowerCase())?"personnals":"uniq"].push(t),e}),{personnals:[],uniq:[]}),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return r.toLangExplicit(t)||r.toLangExplicit(e)||e},i=function(e,t){return"n"===e||"adr"===e?t.join("\n").trim():t},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=n.field,a=void 0===r?"":r,c=n.icon,s=arguments.length>2?arguments[2]:void 0;return t.extract({vcard:e,field:a},s).map((function(e,t){var n=e.type,r=e.key,a=e.value,s=e.params,u=(s=void 0===s?{}:s).group;return{key:r,label:o(r,n),value:i(r,a),group:u,icon:0===t?c:void 0}}))};return{restrict:"E",replace:!0,scope:{vcard:"<"},templateUrl:n("izcq"),link:function(e){var t=a.uniq.map((function(t){return oy({},t,{items:c(e.vcard,t)})})),n=a.personnals.map((function(t){return oy({},t,{items:c(e.vcard,t,!0)})}));e.properties=t.concat(n)}}}iy.$inject=["gettextCatalog","contactDetailsModel","contactTransformLabel"];var cy=iy;function sy(e){return e({controllerAs:"ctrl",templateUrl:n("reAa"),controller:["params",function(e){var t=e.vcard,n=e.onClickMerge,r=e.onClickClose;this.vcard=t,this.onClickClose=r,this.onClickMerge=n}]})}sy.$inject=["pmModal"];var uy=sy;function ly(e){return e({controllerAs:"ctrl",templateUrl:n("m/v6"),controller:["params",function(e){this.uri=e.uri||"",this.submit=e.submit,this.cancel=e.cancel}]})}ly.$inject=["pmModal"];var dy=ly;function py(e){return e({controllerAs:"ctrl",templateUrl:n("Mfc5"),controller:["params",function(e){Ge()(this,e)}]})}py.$inject=["pmModal"];var fy=py;function vy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function my(e,t,r){var a=r((function(){return{invalidForm:e.getString("Invalid form",null,"Error")}}));return{restrict:"E",replace:!0,templateUrl:n("Bjqm"),link:function(e,n){var r=function(){return J()(e.ctrl.list,{selected:!0}).concat(e.ctrl.others)},o=e.ctrl.close,i=function(){e.selectorForm.$invalid?t.error(a.invalidForm):e.$applyAsync((function(){var t=r();e.ctrl.submit(t)}))},c=function(){var t=r();n[0].classList[t.length?"remove":"add"]("contactSelectorForm-no-recipients"),e.checkAll=e.ctrl.list.length===J()(e.ctrl.list,{selected:!0}).length},s=function(t){var n=t.target,r=n.getAttribute("data-list"),a=n.getAttribute("data-index");switch(r){case"others":e.$applyAsync((function(){e.ctrl.others.splice(a,1),c()}));break;case"list":e.$applyAsync((function(){J()(e.ctrl.list,{selected:!0})[a].selected=!1,c()}))}};n.on("submit",i),n.on("reset",o),n.on("click",s),e.disableCheckAll=!e.ctrl.list.length,e.onCheck=function(){return c()},e.onSelectAll=function(){e.ctrl.list=e.ctrl.list.map((function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vy(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vy(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{selected:e.checkAll})}))},c(),e.$on("$destoy",(function(){n.off("submit",i),n.off("reset",o),n.off("click",s)}))}}}my.$inject=["gettextCatalog","notification","translator"];var gy=my;function hy(e,t,r){var a=r((function(){return{error:e.getString("Image upload failed",null,"Error")}}));return{restrict:"E",replace:!0,templateUrl:n("YIcE"),link:function(e,n){var r=n[0].querySelector(".contactPhotoModal-input-file"),o=function(n){var r=n.target.files[0],o=new FileReader;o.onloadend=function(){Object(Bt.e)(o.result,s.y,"image/jpeg",.7).then((function(t){e.$applyAsync((function(){e.ctrl.uri=t,e.ctrl.submit(e.ctrl.uri)}))})).catch((function(e){throw t.error(a.error),e}))},o.readAsDataURL(r)};r.addEventListener("change",o),e.$on("$destroy",(function(){r.removeEventListener("change",o)}))}}}hy.$inject=["gettextCatalog","notification","translator"];var by=hy;function yy(e,t){var r="contactDetails-show-custom-fields",a=t((function(){return{SHOW:e.getString("Show custom fields",null,"Action in contact details"),HIDE:e.getString("Hide custom fields",null,"Action in contact details")}}));return{restrict:"E",replace:!0,templateUrl:n("N24w"),link:function(e,t){var n=t.find(".".concat("contactDetails-toggle-custom-fields")),o=function(){var e=t[0].classList.contains(r)?"HIDE":"SHOW";n[0].textContent=a[e]},i=function(){return t[0].classList.toggle(r),o()};n.on("click",i),o(),e.$on("$destroy",(function(){n.off("click",i)}))}}}yy.$inject=["gettextCatalog","translator"];var Ey=yy;function Sy(e){return{replace:!0,templateUrl:n("VRFI"),link:function(t,n){var r=e(["contacts"]).dispatcher,a=function(e){"resign"===e.target.dataset.action&&r.contacts("updateContact",{contact:t.contact,action:"resign"})};n.on("click",a),t.$on("$destroy",(function(){n.off("click",a)}))}}}Sy.$inject=["dispatchers"];var Dy=Sy;function ky(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ay(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ky(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ky(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Iy(e,t,r,a){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith("x")?e:"X-".concat(e)},i={Name:"FN",Emails:"EMAIL",Tels:"TEL",Adrs:"ADR",Notes:"NOTE",Photos:"PHOTO",Scheme:"X-PM-SCHEME",Sign:"X-PM-SIGN",Encrypt:"X-PM-ENCRYPT",MIMEType:"X-PM-MIMETYPE"},c=function(e,t){var n=e.vCard,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return i[e]||e.toUpperCase()}(t);return a.extract({vcard:n,field:r})};return{restrict:"E",require:"^form",priority:90,templateUrl:n("OUDj"),scope:{contact:"=",form:"=",model:"=",type:"@type"},link:function(n,a,i,s){var u=e(["contacts","contact.item","composer.new","tooltip"]),l=u.dispatcher,d=u.on,p=u.unsubscribe,f=a.find(".contactItem-container"),v=n.type,m=c(n.contact,v);n.itemContactDragControlListeners={containment:".contactDetails-container",containerPositioning:"relative",accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id},dragStart:function(){n.itemMoved=!0},dragEnd:function(){n.itemMoved=!1},orderChanged:function(){s.$setDirty()}},n.config={isFocusedAddress:!1},n.UI=r.initialize(m,v),f.addClass("contactItem-container-".concat(n.type)),f.addClass("as-sortable-disabled");var g={add:function(){var e=r.populate(n.UI,v);s.$setDirty(),n.$applyAsync((function(){r.add(n.UI,e.key,e.type,""),setTimeout((function(){return a.find(".contactItem-field").focus()}),100)}))},remove:function(e){return t=n.UI.items[e],l.tooltip("hideAll"),r.remove(n.UI,t),s.$setDirty(),void n.change();var t},toggleSortable:function(){n.$applyAsync((function(){n.UI.items.forEach((function(e){return e.displaySelector=!1})),n.UI.sortableState=!n.UI.sortableState,f.toggleClass("as-sortable-disabled")}))}};function h(e){e.stopPropagation();var t=e.target.getAttribute("data-action"),n=parseInt(e.target.getAttribute("data-index"),10);g[t]&&g[t](n)}n.getAddressValue=function(e){var t=e.value;return angular.isArray(t)?t.join(" "):angular.isString(t)?t:""},n.change=function(){return n.$applyAsync((function(){n.model[v]=n.UI.items,l["contact.item"]("change",{items:n.UI.items,type:n.type})}))},n.visibleItems=function(){return n.UI.items.filter((function(e){return!e.hide}))},n.toggleSelector=function(e,t){var r=t.uuid,a=t.displaySelector;e.preventDefault(),e.stopPropagation(),n.UI.items=n.UI.items.map((function(e){return r===e.uuid?Ay({},e,{displaySelector:!a}):Ay({},e,{displaySelector:!1})})),l["contact.item"]("closeAllSelectors",{type:n.type})},n.setLabel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.label=r||e.label,"Customs"===v&&(e.type=o(e.label)),"Personals"===v&&(e.type=t.toVCard(e.label)),s.$setDirty(),n.change(),e.displaySelector=!1},n.change(),a.on("click",h),d("contact.item",(function(e,t){var r=t.type,a=void 0===r?"":r,o=t.data,i=void 0===o?{}:o;"closeAllSelectors"===a&&n.type!==i.type&&n.$applyAsync((function(){n.UI.items=n.UI.items.map((function(e){return Ay({},e,{displaySelector:!1})}))}))})),d("contacts",(function(e,t){var r=t.type,a=void 0===r?"":r;f.hasClass("as-sortable-disabled")||"updateContact"!==a&&"createContact"!==a||n.$applyAsync((function(){n.UI.sortableState=!1,f.addClass("as-sortable-disabled")}))})),n.$on("$destroy",(function(){a.off("click",h),p()}))}}}Iy.$inject=["dispatchers","contactTransformLabel","contactUI","contactDetailsModel"];var Cy=Iy;function wy(e,t){return{replace:!0,restrict:"E",scope:{},templateUrl:n("hMtj"),link:function(n){var r=t(),a=r.on,o=r.unsubscribe,i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n.keyPinningEnabled=e.length>0};a("advancedSetting",(function(e,t){var r=t.type,a=t.data,o=void 0===a?{}:a;"updateKeys"===r&&n.$applyAsync((function(){i(o.keys)}))})),i(e.get("Keys")),n.$on("$destroy",(function(){o()}))}}}wy.$inject=["contactPgpModel","dispatchers"];var Oy=wy;function My(e){return{replace:!0,templateUrl:n("H0Og"),link:function(t,n){var r,a,o;r=Object(kg.a)(e),a=r.sort,o=r.order,a&&n.attr("data-sort")===a&&n.attr("order",o)}}}My.$inject=["$stateParams"];var Py=My;function xy(e,t,r,a,o,i){var c=120,s={ITEM:"contactList-item",ACTIVE:"contactList-item-activeContact",ACTIVE_CURSOR:"contactList-item-activeCursorContact",LOADED:"contactList-loaded",CHECKBOX:".customCheckbox-input"};return{restrict:"E",replace:!0,scope:{},templateUrl:n("uA+/"),link:function(e,n){var u=t(["contacts"]),l=u.dispatcher,d=u.on,p=u.unsubscribe,f=null,v=!!a.id,m={cursorID:null};e.contacts=[],e.showContact=function(e){return r.go("secured.contacts.details",{id:e})},e.isSelected=function(e){return e.ID===m.cursorID},e.isActive=function(e){return e.ID===a.id};var g=function(){return o.paginate(o.get("filtered"))},h=function(t,r){m.cursorID=t;var o=(r||n.find(".".concat(s.ITEM))).has('[data-contact-id="'.concat(unescape(m.cursorID),'"]')),i=a.id===t;o[0]&&e.$applyAsync((function(){i&&o[0].classList.add(s.ACTIVE),o[0].querySelector(s.CHECKBOX).focus()}))};function b(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(n.find(".".concat(s.ITEM)).removeClass(s.ACTIVE),a.id){var t=n.find(".".concat(s.ITEM,'[data-contact-id="').concat(unescape(a.id),'"]'));g().filter((function(e){return e.selected})).length||t.addClass(s.ACTIVE),m.cursorID||(m.cursorID=a.id),e&&t[0]&&n.animate({scrollTop:t.offset().top-c},1e3)}}var y=function(t,n,r){return e.$applyAsync((function(){!function(t,n,r){var a=[t.ID];if(f){if(r){var o=e.contacts.indexOf(t),i=z()(e.contacts,{ID:f.ID}),c=e.contacts.slice(Math.min(o,i),Math.max(o,i)+1);a.push.apply(a,we()(k()(c,"ID")))}f=t}else f=t;l.contacts("selectContacts",{contactIDs:a,isChecked:n})}(le()(e.contacts,{ID:t}),n,r)}))},E=function(t){return Hr()((function(){var r=z()(e.contacts,{ID:m.cursorID})||0,a="DOWN"===t?r+1:r-1;if(!("DOWN"===t&&a===e.contacts.length||"UP"===t&&a<0)){var o=e.contacts[a].ID,i=n.find(".".concat(s.ITEM)),u=i.has('[data-contact-id="'.concat(unescape(m.cursorID),'"]'));h(o,i),u.offset()?u.offset().top>n[0].clientHeight?n[0].scrollTop+=i.height():u.offset().top<c+i.height()&&(n[0].scrollTop-=i.height()):n.animate({scrollTop:a*i.height()-c},{duration:500,complete:function(){return h(o)}})}}),50)};function S(e){var t=e.target,n=e.shiftKey;if(!window.getSelection().isCollapsed)return e.preventDefault();t.classList.contains(s.CHECKBOX.slice(1))&&(e.stopPropagation(),y(t.dataset.contactId,t.checked,n));var o=t.getAttribute("data-action");if("showContact"===o&&(h(t.dataset.contactId),l.contacts("selectContacts",{isChecked:!1}),r.go("secured.contacts.details",{id:t.dataset.contactId})),"toggleSort"===o){var i=t.getAttribute("data-sort"),c=(a.sort||"").startsWith("-")?"":"-";r.go("secured.contacts",{sort:"".concat(c).concat(i)})}}var D=function(){r.go("secured.contacts.details",{id:m.cursorID}),i.bind(["mod+s"]),i.unbind(["down","up"])};d("contacts",(function(t,r){var a=r.type,o=void 0===a?"":a;"contactsUpdated"===o&&e.$applyAsync((function(){return t=g(),void e.$applyAsync((function(){e.contacts=t,n[0].classList.contains(s.LOADED)||n[0].classList.add(s.LOADED),ke()((function(){b(v),v=!1,!m.cursorID&&t.length>0&&h(t[0].ID)}),1e3)}));var t})),"deletedContactEmail"===o&&delete m.cursorID})),d("$stateChangeSuccess",(function(){e.$applyAsync((function(){return b()}))})),n.on("click",S),o.hydrate(),d("right",D),d("openMarked",D),d("left",(function(){document.activeElement.blur(),r.go("secured.contacts"),i.bind(["down","up"]),i.unbind(["mod+s"])})),d("hotkeys",(function(e,t){var n=t.type,r=t.data.to;"move"===n&&"archive"===r&&l.contacts("addContact")})),d("markPrevious",E("UP")),d("markNext",E("DOWN")),d("composer.update",(function(e,t){var n=t.type;"close"===(void 0===n?"":n)&&i.bind(["down","up"])})),d("$stateChangeSuccess",(function(e,t){o.unSelectOnStateChange(t)})),e.$on("$destroy",(function(){n.off("click",S),p()}))}}}xy.$inject=["$filter","dispatchers","$state","$stateParams","contactCache","hotkeys"];var Ty=xy;function Ly(e){var t=e(["contacts"]).dispatcher,r={add:"addContact",import:"importContacts"};function a(e){var n=e.target.getAttribute("data-action");r[n]&&t.contacts(r[n])}return{replace:!0,templateUrl:n("Ri7z"),link:function(e,t){t.on("click",a),e.$on("$destroy",(function(){t.off("click",a)}))}}}Ly.$inject=["dispatchers"];var jy=Ly;function Ny(e,t){var r=function(){var e=c()(o.a.mark((function e(n){var r,a,i,c,s,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:[],e.next=3,Promise.all([t.getRawInternalKeys(),t.allKeysExpired(r)]);case 3:a=e.sent,i=G()(a,2),c=i[0],s=i[1],Object(Kt.j)(n,"pgp-expired",!r.length||s),Object(Kt.j)(n,"pgp-no-keys",!r.length),Object(Kt.j)(n,"pgp-no-primary",!c.some((function(e){return r.map((function(e){return e.split("base64,")[1]})).includes(e)}))),Object(Kt.j)(n,"pgp-encrypt",t.get("Encrypt"));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{replace:!0,templateUrl:n("chTo"),restrict:"E",require:"^form",scope:{model:"=",form:"=",email:"@",internalKeys:"="},link:function(n,a,o,i){var c=e(["advancedSetting"]),s=c.on,u=c.unsubscribe,l=a[0];s("advancedSetting",(function(e,n){var a=n.type,o=n.data,c=void 0===o?{}:o;switch(a){case"updateKeys":r(l,c.keys);break;case"updateScheme":Object(Kt.j)(l,"pgp-inline",t.isPGPInline()),Object(Kt.j)(l,"pgp-mime",t.isPGPMime());break;case"updateEncrypt":var s=c.status;Object(Kt.j)(l,"pgp-encrypt",s),s&&Object(Kt.j)(l,"pgp-sign",!0),i.$setDirty();break;case"updateSign":Object(Kt.j)(l,"pgp-sign",c.status),i.$setDirty()}})),t.init(n.model,n.email,n.internalKeys);var d=t.isInternalUser(),p=t.isDisabledUser();Object(Kt.j)(l,"pgp-external",!d),Object(Kt.j)(l,"pgp-internal",d),Object(Kt.j)(l,"pgp-address-disabled",p),Object(Kt.j)(l,"pgp-inline",t.isPGPInline()),Object(Kt.j)(l,"pgp-mime",t.isPGPMime()),Object(Kt.j)(l,"pgp-encrypt",t.get("Encrypt")),Object(Kt.j)(l,"pgp-sign",t.get("Sign")),r(l,t.get("Keys")),n.$on("$destroy",(function(){u()}))}}}Ny.$inject=["dispatchers","contactPgpModel"];var $y=Ny;function Ry(e,t){return{restrict:"E",replace:!0,scope:{},templateUrl:n("cFQX"),link:function(n){var r=e(["contacts"]),a=r.on,o=r.unsubscribe;n.welcomePlaceholder=!0,n.numberElementChecked=0,a("contacts",(function(e,r){if("selectContacts"===r.type){var a=t.paginate(t.get("filtered")).filter((function(e){return e.selected}));n.welcomePlaceholder&&(n.welcomePlaceholder=!1),n.numberElementChecked=a.length}})),n.$on("$destroy",o)}}}Ry.$inject=["dispatchers","contactCache"];var _y=Ry;function Uy(e,t,r,a,i,u,l,d){var p=d((function(){return{invalidKeyMessage:function(e){return a.getPlural(e.length,"{{keys}} is not a valid PGP key.","{{keys}} are not valid PGP keys.",{keys:Object(ka.a)(e,p.LANG_AND)},"Error message")},LANG_AND:a.getString("and",null,"String separator")}}));return{restrict:"E",templateUrl:n("7OQC"),require:"^form",scope:{form:"=",model:"=",email:"@",internalKeys:"="},link:function(n,a,d,f){var v=u(["composer.new","advancedSetting","tooltip"]),m=v.dispatcher,g=v.on,h=v.unsubscribe,b=n.email,y=n.model,E=a.find(".contactItem-container"),S=n.internalKeys.RecipientType===s.Wb.TYPE_INTERNAL,D=r(n,{keys:y,isInternal:S,email:b,onChange:function(){f.$setDirty(),Object(Kt.j)(a[0],"all-keys-trusted",!n.BE.hasUntrusted&&n.BE.items.length>0),m.advancedSetting("updateKeys",{keys:n.UI.items.map((function(e){return e.value}))})}});E.addClass("contactItem-container-".concat(n.type)),E.addClass("as-sortable-disabled");var k={add:function(){a.find(".upload-helper").click(),m.tooltip("hideAll")},download:D.download,remove:function(e,t){D.remove(e,t),m.tooltip("hideAll")},makePrimary:D.makePrimary},A={moveToTrusted:function(e,t){D.moveToTrusted(e,t),m.tooltip("hideAll")},moveAllToTrusted:D.moveAllToTrusted,downloadUntrusted:D.download};function I(e){var t=e.target,r=t.getAttribute("data-action"),a=parseInt(t.getAttribute("data-index"),10);k[r]&&k[r](n.UI.items[a],a),A[r]&&A[r](n.BE.items[a],a)}var C=function(n){return n.reduce(function(){var n=c()(o.a.mark((function n(r,a){var i,c;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r;case 2:return i=n.sent,n.next=5,e.compressKey(a.publicKeyArmored);case 5:if(c=n.sent,a.publicKeyArmored===c){n.next=14;break}return n.t0=i,n.next=10,l.track(t.keyInfo(c,b));case 10:n.t1=n.sent,n.t0.push.call(n.t0,n.t1),n.next=15;break;case 14:i.push(a);case 15:return n.abrupt("return",i);case 16:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),Promise.resolve([]))},w=function(){var e=c()(o.a.mark((function e(t){var n,r,a,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target,$(n).is("input[type=file]")&&n.files&&0!==n.files.length){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,l.track(D.getInfos(we()(n.files)));case 6:return r=e.sent,a=r.reduce((function(e,t){return t.error?e.invalidKeys.push(t.error):e.validKeys.push(t),e}),{invalidKeys:[],validKeys:[]}),c=a.invalidKeys,s=a.validKeys,c.length&&i.error(p.invalidKeyMessage(c)),e.next=11,C(s);case 11:u=e.sent,D.addKeys(u);case 13:return e.prev=13,n.value="",e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,,13,16]])})));return function(t){return e.apply(this,arguments)}}();a.on("click",I),a.on("change",w),g("advancedSettings",(function(e,t){var n=t.type,r=t.data;"toggleKeyPinning"===n&&(r.status?D.moveAllToTrusted():D.removeAll())})),n.$on("$destroy",(function(){a.off("click",I),h()}))}}}Uy.$inject=["keyCompression","contactKey","contactKeyManager","gettextCatalog","notification","dispatchers","networkActivityTracker","translator"];var Fy=Uy;var By=function(){return{restrict:"E",templateUrl:n("qAl9"),scope:{items:"=",enableDelete:"=",enableTrust:"="}}};function Ky(e,t){var r=t((function(){return{available:e.getString("Available Public Keys",null,"Label"),public:e.getString("Public Keys",null,"Laebel"),trusted:e.getString("Trusted Public Keys",null,"Label")}}));return{restrict:"E",replace:!0,scope:{},templateUrl:n("Y/rn"),link:function(e,t,n){var a=n.textTranslate;e.text=r[a]}}}Ky.$inject=["gettextCatalog","translator"];var Gy=Ky;function Vy(e,t,r,a,o,i,c){var u=function(){var e=r.get("selected").filter(Boolean);return e.length?e:[r.getItem(t.id)].filter(Boolean)};return{restrict:"E",replace:!0,scope:{},templateUrl:n("DLcX"),link:function(n,l){var d=c(["composer.new","contacts"]),p=d.on,f=d.unsubscribe,v=d.dispatcher,m=function(e){var t=k()(r.paginate(r.get("filtered")),"ID");v.contacts("selectContacts",{contactIDs:t,isChecked:e})};function g(){var e=r.paginate(r.get("filtered")),a=r.get("selected"),o=J()(e,{selected:!0});n.$applyAsync((function(){n.totalItems=r.total(),n.disabled=!e.length,n.noSelection=!(t.id||a.length),n.selectedLength=a.length,n.checkAll=e.length===o.length}))}function h(e){var t=e.target.getAttribute("data-action");return"composeSelectedContacts"===t&&function(e){var t=u().filter((function(e){var t=e.Emails;return(void 0===t?[]:t).length})).map((function(e){var t=e.Emails,n=e.Name;return{Address:t[0].Email,Name:n}}));if(t.length){var n=o();return n.ToList=t,e["composer.new"]("new",{message:n})}i.error(a.getString("Contact does not contain email address",null,"Error"))}(v),"deleteSelectedContacts"===t?v.contacts("deleteContacts",{contactIDs:k()(u(),"ID")}):"addContact"===t||/^(export|import)Contacts$/.test(t)?v.contacts(t):"mergeContacts"===t?v.contacts(t,{contactIDs:k()(u(),"ID")}):void 0}n.numPerPage=s.t,n.selectPage=function(t){return e.go(e.$current.name,{page:t})},n.currentPage=+(t.page||1),n.selectAll=function(){return m(n.checkAll)},p("contacts",(function(e,t){var n=t.type;("contactsUpdated"===n||"selectContacts"===n)&&g()})),p("$stateChangeSuccess",(function(e,t){"secured.contacts.details"===t.name&&n.noSelection&&g()})),p("hotkeys",(function(e,t){var n=t.type,r=t.data.to;if("move"===n&&"trash"===r)return v.contacts("deleteContacts",{contactIDs:k()(u(),"ID")})})),p("selectElements",(function(e,t){return"all"===t.type&&m(!1)})),p("right",(function(){m(!1)})),l.on("click",h),g(),n.$on("$destroy",(function(){l.off("click",h),f()}))}}}Vy.$inject=["$state","$stateParams","contactCache","gettextCatalog","messageModel","notification","dispatchers"];var qy=Vy;function Hy(e,t,r){var a="contacts-empty",o="contacts-no-result";return{restrict:"E",replace:!0,scope:{},templateUrl:n("C4ZC"),link:function(n,i){var c=r(),s=c.on,u=c.unsubscribe;function l(){var n=t.paginate(t.get("filtered"));i[0].classList.remove(a,o),!n.length&&!e.keyword&&i[0].classList.add(a),!n.length&&e.keyword&&i[0].classList.add(o)}s("contacts",(function(e,t){var r=t.type;"contactsUpdated"===(void 0===r?"":r)&&n.$applyAsync((function(){return l()}))})),l(),n.$on("$destroy",u)}}}Hy.$inject=["$stateParams","contactCache","dispatchers"];var zy=Hy;function Yy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yy(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yy(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Zy.$inject=["dispatchers","contactCache","$stateParams","Contact","contactEncryptionAddressMap","networkActivityTracker"];var Xy=Da.b.TYPE3_CONTACT_VERIFICATION,Jy=Da.b.TYPE2_CONTACT_VERIFICATION,Qy=Da.b.TYPE3_CONTACT_DECRYPTION;function Zy(e,t,r,a,i,s){var u=function(e){return"edition"===e?"view":"edition"},l=function(e){return"contactErrorType-".concat(e,"-error")},d=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.errors,r=void 0===n?[]:n;return e={},v()(e,l("encrypted-verification"),r.includes(Xy)),v()(e,l("encrypted"),r.includes(Qy)),v()(e,l("verification"),r.includes(Jy)),e};return{replace:!0,scope:{},templateUrl:n("lxNF"),link:function(n,l){var p=e(["contacts"]),f=p.on,v=p.unsubscribe,m=p.dispatcher;n.mode="view",n.testErrors=d;var g=function(e){return!!n.contact&&n.contact.ID===e},h=function(){var e=c()(o.a.mark((function e(t){var r,a,i,c,s,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.action,a=t.current,i=t.refresh,c=t.contact,s=(c=void 0===c?{}:c).ID,l=t.forceRefresh,"toggleMode"===r){e.next=5;break}return e.abrupt("return");case 5:d=l?n.mode:u(a),n.$applyAsync((function(){if(g(s))return i||l?(n.mode="",_rAF((function(){n.$applyAsync((function(){n.mode=d}))}))):void(n.mode=d)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=c()(o.a.mark((function e(){var t,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.get(r.id),e.next=3,s.track(t);case 3:c=e.sent,i.init(r.id,c.vCard),n.$applyAsync((function(){n.contact=c}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=c()(o.a.mark((function e(t){var r,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.contact,c=t.cards){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,a.decrypt(Wy({},r,{Cards:c}));case 5:return s=e.sent,i.init(n.contact.ID,s.vCard),n.$applyAsync((function(){n.contact=s})),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();b(),f("contacts",(function(e,r){var a,o=r.type,i=r.data,c=void 0===i?{}:i;if("selectContacts"===o&&(a=t.paginate(t.get("filtered")).some((function(e){return e.selected})),l[0].classList[a?"remove":"add"]("contactRightPanel-placeholder-hidden")),"action.input"===o&&h(c),"contactsUpdated"===o&&c.todo){var s=c.todo.update,u=(void 0===s?[]:s).find((function(e){var t=e.ID;return n.contact.ID===t}));u&&y({contact:u,cards:u.Cards}).then((function(e){h({contact:e,action:"toggleMode",current:"edition"})}))}})),f("keys",(function(e,t){var r=t.type,a=t.data;"reactivate"===r&&((void 0===a?{}:a).contact||{}).ID===n.contact.ID&&setTimeout((function(){m.contacts("updateContact",{contact:n.contact})}),500)})),n.$on("$destroy",v)}}}var eE=Zy;function tE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tE(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tE(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function rE(e,t,n,r,a,o,i,c,u){var l=["secured.contacts"],d={hydrated:!1,contacts:[],map:{all:Object.create(null),selected:[],filtered:[]}},p=n(["contacts"]),f=p.dispatcher,v=p.on,m=function(e){return z()(d.contacts,{ID:e})},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f.contacts("contactsUpdated",nE({all:D(),contact:e},t))},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.toLowerCase()},b=function(){return d.hydrated},y=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.includes("secured.contacts"))return n;var r=t.sort||"Name",a=r.indexOf("-")>-1,o=r.replace("-","");return Et()(n[0],o)?n.slice().sort((function(e,t){return a?t[o].localeCompare(e[o]):e[o].localeCompare(t[o])})):n};function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.id,n=Be()(Ue()((function(e){return e.selected})),Re()("ID"))(D());return!n.length&&e?[e]:n}function S(){var e=t.keyword||"";return e?k()(y(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=h(e);return J()(t,(function(e){var t=e.Name,r=void 0===t?"":t,a=e.Emails,o=void 0===a?[]:a;return h(r).indexOf(n)>-1||P(o,n)}))}(e,D())),"ID"):k()(y(D()),"ID")}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return"all"===e?d.contacts:k()(d.map[e],(function(e){return d.map.all[e]}))}function A(n){if(b()&&!n){var o=e.is("secured.contacts.details")&&"contact.details",i=t.sort&&e.is("secured.contacts")&&"contacts.sort";return I([],o||i),g(),Promise.resolve()}var c=a.all().then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return d.hydrated=!0,d.contacts=e,I(),D()})).then((function(){return g()}));return r.track(c),c}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=G()(e,1)[0],n=(t=void 0===t?{}:t).ID,r=arguments.length>1?arguments[1]:void 0,a=i.getMap();if("contact.details"!==r&&"selected"!==r)if("contacts.sort"!==r){var o=bt()(D(),(function(e,t){return t.Emails=a[t.ID]||[],t.emails=t.Emails.map((function(e){var t=e.Email;return void 0===t?"":t})).join(", "),e.all[t.ID]=t,e.list.push(e.all[t.ID]),e}),{list:[],all:Object.create(null)}),c=o.list,s=o.all;d.contacts=c,d.map={all:s,selected:E(n),filtered:S()}}else d.map.filtered=S();else d.map.selected=E(n)}function C(){d.contacts.length=0,d.hydrated=!1,d.map.all=Object.create(null),d.map.selected.length=0,d.map.filtered.length=0}function w(e){var t=e.ID,n=e.contact,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=m(t);-1!==a?function(e,t){d.contacts[t]=e,d.map.all[e.ID]=e}(n,a):function(e){d.contacts.push(e),d.map.all[e.ID]=e}(n),r&&g(n)}function O(e){var t=e.ID,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=m(t);-1!==r&&w({ID:t,contact:d.contacts[r]},n)}function M(e){var t,n,r=e.ID;d.contacts.length>0&&(t=r,(n=le()(D(),(function(e){return _r()(e.Emails,{ID:t})})))&&w({ID:n.ID,contact:n}))}var P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return _r()(e,(function(e){var n=e.Email;return h(void 0===n?"":n).includes(t)}))};function x(e){var t=e.contactIDs,n=void 0===t?[]:t,r=e.isChecked;n.length||(d.contacts=k()(D(),(function(e){return e.selected=r,e}))),n.forEach((function(e){d.map.all[e]&&(d.map.all[e].selected=r)})),I([],"selected"),u.set("numberElementChecked",d.map.selected.length)}return v("contacts",(function(e,t){var n,r,a,i,s,u=t.type,l=t.data,p=void 0===l?{}:l;"contactEvents"===u&&(n=p.events,r=void 0===n?[]:n,a=Object(Fd.a)(d.contacts,r,"Contact"),i=a.collection,s=a.todo,d.contacts=i,I(s.create),s.update.forEach((function(e){return O(e,!1)})),g(void 0,{todo:s})),"refreshContactEmails"===u&&O(p),"deletedContactEmail"===u&&M(p),"resetContacts"===u&&(C(),A()),"importContacts"===u&&c(p.contactID),"exportContacts"===u&&o(p.contactID),"selectContacts"===u&&x(p),"searchingContact"===u&&(d.map.filtered=S(),g())})),v("logout",(function(){C()})),{hydrate:A,isHydrated:b,clear:C,get:D,total:function(){return t.keyword?d.map.filtered.length:d.contacts.length},paginate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=((t.page||1)-1)*s.t,r=n+s.t;return e.slice(n,r)},load:function(){var e=a.load().then((function(e){var t=e.Contacts,n=void 0===t?[]:t;return d.contacts=n,I(),D()})).then((function(){return g()}));return r.track(e),e},getItem:function(e){return(d.contacts.map.all||{})[e]||le()(d.contacts,{ID:e})},unSelectOnStateChange:function(e){var t=e.name;l.includes(t)||x({isChecked:!1})}}}rE.$inject=["$state","$stateParams","dispatchers","networkActivityTracker","Contact","contactDownloader","contactEmails","contactImporter","AppModel"];var aE=rE,oE=n("vlBi"),iE=n.n(oE);function cE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cE(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cE(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function uE(e,t,n,r,a,o,i){var c=r,u=a((function(){return{unknown:n.getString("Unknown",null,"Default display name vcard")}})),l=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.getField();return{value:fo(t.valueOf(),n),type:d(t)||e,key:n,params:t.getParams()}}};function d(e){var t=e.getType();return Array.isArray(t)?t[0]:t}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.params||{};return _a.includes(t.type)&&(r.type=e.toVCard(t.label)),n&&(r.pref=n),r}function f(e,t){var n=e.vcard,r=void 0===n?new wa.a:n,a=e.field,o=void 0===a?"":a,i=e.type;return Xb(r,qa(o,r,t)||(Ha(o)?qa("PERSONALS",r):[])).map(l(i))}return{extract:f,prepare:function(e){var n=angular.copy(t.contactAPI),r=e.contact.ID||s.v,a={};Object.keys(e.model).forEach((function(t){var s=e.model[t];switch(t){case"Emails":s.forEach((function(e,t){var u=e.value,l=void 0===u?"":u,d=e.type;if(l){var f=p(e,s.length>1&&t+1),v=new wa.a.Property(d,po(l),f);v.group="item".concat(t+1);var m=new wa.a;m.addProperty(v);var g=o.get(r,l),h=i.build({vCard:m,ID:r},l,g);a[f.group]=v.group,n.vCard=c.merge([n.vCard,h])}}));break;case"Tels":case"Adrs":s.forEach((function(e,r){if(e.value){var a=po(e.value),o="Adrs"===t?iE()(a,(function(e){return!e})):a;n.vCard.add(e.type,o,p(e,s.length>1&&r+1))}}));break;default:s.forEach((function(e){if("categories"!==e.type)e.value&&n.vCard.add(e.type,po(e.value),p(e));else{var t=(e.value||[]).toString().split(",").filter(Boolean).toString();if(t.length){var r=p(e),o=a[r.group];o&&n.vCard.add(e.type,fo(po(t)),sE({},r,{group:o}))}}}))}}));var l=n.vCard.get("fn");if(Array.isArray(l)&&(l=l[0]),!l||l.isEmpty()){var d="",f=n.vCard.get("email");if(f){var v=f.valueOf();d=Array.isArray(v)?v[0].valueOf():v}n.vCard.add("fn",d||u.unknown)}return n},unescapeValue:uo,escapeValue:po,extractHumans:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_f.a,n=Ya(e),r=n.reduce((function(t,n){if(Ha(n))return!t.personalsKey&&(t.personalsKey=n),t;var r=f({field:n.toUpperCase(),vcard:e});return r.length?za(n)?(t.encrypted.push(r),t):(t.clear[n]=r,t):t}),{clear:Object.create(null),encrypted:[],personalsKey:void 0}),a=r.clear,o=r.encrypted,i=r.personalsKey;if(i){var c=f({field:i.toUpperCase(),vcard:e}),s=c.filter(t);return{clear:a,encrypted:s.length?o.concat([s]):o}}return{clear:a,encrypted:o}},extractAll:function(t){return Object.keys(La).reduce((function(n,r){var a=f({vcard:t,field:r});return a.length&&!/^x-|^avoid$/i.test(r)&&(n[Va(r)]=a.map((function(t){var n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return e.toLangExplicit(n)||e.toLangExplicit(t)||t}(t.key);return sE({},t,{label:n,type:e.toVCard(n)})}))),n}),Object.create(null))}}}uE.$inject=["contactTransformLabel","contactSchema","gettextCatalog","vcard","translator","contactEncryptionAddressMap","contactEncryptionSaver"];var lE=uE;function dE(e,t,n,r,a){var i=function(e,t){var r=G()(t,1)[0].get("fn");return Array.isArray(r)&&(r=r[0]),"all"!==e&&r?"".concat(n.unescapeValue(r.valueOf()),".vcf"):"proton.vcf"},u=function(e){return Object.keys(e.data).forEach((function(t){var n=e.data[t];n.charset&&(n.charset="UTF-8")})),e},l=function(){var t=c()(o.a.mark((function t(n,r){var a,i,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("all"===n){t.next=6;break}return t.next=3,e.get(n,r.getCancelEvent());case 3:return a=t.sent,i=a.vCard,t.abrupt("return",[u(i)]);case 6:return t.next=8,e.exportAll(s.V,r);case 8:return c=t.sent,t.abrupt("return",c.map((function(e){var t=e.vCard;return u(t)})));case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return c()(o.a.mark((function e(){var n,c,u,d,p,f=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>0&&void 0!==f[0]?f[0]:"all",c=Object(Rb.a)(),u=function(){c.cancel(s.m),t.deactivate()},t.activate({params:{mode:"export",onEscape:u,close:u}}),e.prev=4,e.next=7,l(n,c);case 7:d=e.sent,p=new Blob([a.to(d)],{type:"data:attachment/vcard;"}),t.deactivate(),r(p,i(n,d)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),t.deactivate();case 16:case"end":return e.stop()}}),e,null,[[4,13]])})))}dE.$inject=["Contact","contactLoaderModal","contactDetailsModel","downloadFile","vcard"];var pE=dE;function fE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fE(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fE(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mE(e,t,n,r,a,i,s,u,l,d,p,f,v,m,g,h,b){var y=p(["contacts","progressBar"]),E=y.dispatcher,S=y.on,D=b((function(){return{GENERAL_CONTACT_ERROR:f.getString("Error creating a contact",null,"error message"),EDIT_SUCCESS:f.getString("Contact edited",null,"Success message")}}));function k(e){var t,r=e.contacts,a=void 0===r?[]:r,i=e.mode,s=e.state,l=e.callback,d=void 0===l?q.a:l,p="import"===i,f=Object(Rb.a)(),m=function(){var e=c()(o.a.mark((function e(){var t,r,a,c=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:[],e.prev=1,e.next=4,p?g.process(t):t;case 4:return r=e.sent,e.next=7,n.add(r,f,p);case 7:return a=e.sent,E.contacts("contactCreated",vE({},a,{mode:i,state:s})),d(a),e.abrupt("return",a);case 13:if(e.prev=13,e.t0=e.catch(1),!e.t0.isCancellationError){e.next=17;break}return e.abrupt("return");case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(){return e.apply(this,arguments)}}()(a);return"import"===i?u.activate({params:{mode:"import",close:(t=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.cancel(),e.prev=1,e.next=4,m;case 4:return e.prev=4,u.deactivate(),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])}))),function(){return t.apply(this,arguments)})}}):v.track(m),m}function A(){return(A=c()(o.a.mark((function e(t){var n,r,a,i,c,s,u,l,d,p,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.contact,e.next=3,k({contacts:[n]});case 3:if(r=e.sent,a=G()(r.created,1),i=a[0],c=void 0===(c=r.errors)?[]:c,s=G()(c,1),!(u=s[0])&&i){e.next=14;break}throw d=(l=u||{}).code,p=l.error,f=void 0===p?D.GENERAL_CONTACT_ERROR:p,v=new Error(f),d&&(v.Code=d),v;case 14:return e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(e,t){return t.updated&&e.updated.push(t.updated),t.removed&&(e.removed=e.removed.concat(t.removed)),t.errors&&(e.errors=e.errors.concat(t.errors)),t.total&&(e.total+=t.total),e}),{updated:[],removed:[],errors:[],total:0})}function C(e){return w.apply(this,arguments)}function w(){return(w=c()(o.a.mark((function e(t){var r,a,i,c,s,u,l,d,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.update,a=t.remove,c=(i=void 0===a?[]:a).length+(r?1:0),e.prev=2,!r){e.next=6;break}return e.next=6,P(r);case 6:return e.next=8,n.remove({IDs:i});case 8:return s=e.sent,u=s.removed,l=void 0===u?[]:u,d=s.errors,p=void 0===d?[]:d,e.abrupt("return",{total:c,updated:r,removed:l,errors:p.map((function(e){return e.Error}))});case 16:return e.prev=16,e.t0=e.catch(2),e.abrupt("return",{total:c,updated:e.t0 instanceof $b?void 0:r,errors:[e.t0.message]});case 19:case"end":return e.stop()}}),e,null,[[2,16]])})))).apply(this,arguments)}function O(e){var t=e.actions,n=void 0===t?[]:t,r=e.total,a=h(0,100,void 0===r?0:r);n.forEach((function(e){e.then((function(e){return a(e.total),e}))}))}function M(){return(M=c()(o.a.mark((function e(n){var r,a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.activate({params:{mode:"merge",close:function(){u.deactivate()}}}),r=Object.keys(n),a=r.map((function(e){return C(n[e])})),i=r.reduce((function(e,t){var r=n[t],a=r.update,o=r.remove;return e+(void 0===o?[]:o).length+(a?1:0)}),0),O({actions:a,total:i}),c=Promise.all(a).then(I).then((function(e){return E.contacts("contactsUpdated"),E.contacts("contactsMerged",e),E.contacts("selectContacts",{isChecked:!1}),t.call()})),v.track(c),e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return n.update(e).then((function(e){var t=e.Contact,n=e.cards;return E.contacts("contactUpdated",{contact:t,cards:n}),e}))}function x(e){var n=e.contact,r=void 0===n?{}:n,a=e.callback,i=void 0===a?q.a:a,s=function(){var e=c()(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(r);case 2:return n=e.sent,m.success(D.EDIT_SUCCESS),e.next=6,t.call();case 6:i(n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return v.track(s())}function T(t){var n=t.contactIDs,r=void 0===n?[]:n,a=t.confirm,i=void 0===a||a,s="all"===r?f.getString("All contacts deleted",null,"Success"):f.getPlural(r.length,"Contact deleted","Contacts deleted",null,"Success"),u=function(){var t=c()(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,L(r);case 2:m.success(s),e.go("secured.contacts"),E.contacts("selectContacts",{isChecked:!1});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return i?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n="all"===e?f.getString("Are you sure you want to delete all your contacts?",null,"Info"):f.getPlural(e.length,"Are you sure you want to delete this contact?","Are you sure you want to delete the selected contacts?",null,"Info"),r="all"===e?f.getString("Delete all",null,"Title"):f.getString("Delete",null,"Title");d.activate({params:{title:r,message:n,confirm:function(){t(),d.deactivate()}}})}(r,(function(){return u()})):u()}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r="all"===e?n.clear():n.remove({IDs:e});return v.track(r),r.then((function(){return"all"===e&&(i.clear(),a.clear()),t.call()}))}function j(e,t){var n=e.email,a=e.name,o=angular.copy(l.contactAPI);return n&&o.vCard.add("email",n),a&&o.vCard.add("fn",a),new Promise((function(e){r.activate({params:{hookClose:e,noRedirect:t,contact:o}})}))}return S("contacts",(function(e,t){var n=t.type,r=t.data,a=void 0===r?{}:r;"deleteContacts"===n&&T(a),"updateContact"===n&&x(a),"createContact"===n&&k(a),"addContact"===n&&j(a)})),{init:angular.noop,create:k,createSingular:function(e){return A.apply(this,arguments)},update:x,updateUnencrypted:function(e){var r=e.contact,a=void 0===r?{}:r,o=n.updateUnencrypted(a).then((function(e){var n=e.Contact,r=e.cards;E.contacts("contactUpdated",{contact:n,cards:r}),m.success(D.EDIT_SUCCESS),t.call()}));return v.track(o),o},remove:T,merge:function(e){return M.apply(this,arguments)},add:j,updateContact:P}}mE.$inject=["$state","eventManager","Contact","contactModal","contactEmails","contactCache","contactGroupModel","contactLoaderModal","contactSchema","confirmModal","dispatchers","gettextCatalog","networkActivityTracker","notification","contactImportEncryption","contactProgressReporter","translator"];var gE=mE;function hE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hE(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hE(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}kE.$inject=["Contact","dispatchers","sanitize"];var yE=s.kc.DELETE,EE=s.kc.CREATE,SE=s.kc.UPDATE,DE=function(){return{emails:[],map:Object.create(null),emailMap:Object.create(null)}};function kE(e,t,n){var r=DE(),a=t(["contacts"]),i=a.dispatcher,s=a.on,u=function(e){return i.contacts("refreshContactEmails",{ID:e.ContactID,contact:e})},l=function(e){var t;(t=r.emails).push.apply(t,we()(e)),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=bt()(e,(function(e,t){return e.map[t.ContactID]||(e.map[t.ContactID]=[]),e.map[t.ContactID].push(bE({},t)),e.emailMap[t.ID]=t,e}),r),n=t.map,a=t.emailMap;r.map=n,r.emailMap=a}(e)},d=function(){return r.emails.slice()},p=function(){return r=DE()},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_f.a,n=arguments.length>2?arguments[2]:void 0,r=t(e),a=function(e,a){var o=!n||n===a;return t(e)===r&&o};return{noDefault:function(e){var t=e.Defaults,n=e.Email,r=e.ContactID;return!t&&a(n,r)},match:function(e){var t=e.Email,n=e.ContactID;return a(t,n)}}},v=function(e,t){return function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_f.a,o=arguments.length>2?arguments[2]:void 0,i=f(n,a,o),c=i.noDefault,s=i.match,u="find"===e?le.a:J.a;if(!t){var l=u(r.emails,c);if(Array.isArray(l)?l.length:l)return l}return u(r.emails,s)}},m=v("find"),g=v("filter",!0),h=function(){var t=c()(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.hydrate();case 2:return n=t.sent,l(n),t.abrupt("return",d());case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.Name=n.input(e.Name),e.Email=n.input(e.Email),e}return s("resetContactEmails",(function(){p(),h()})),s("logout",(function(){p()})),{set:l,get:d,getMap:function(){return r.map},getEmail:function(e){return r.emailMap[e]},clear:p,load:h,update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e){return bE({},e,{ContactEmail:b(e.ContactEmail)})})),n=Object(Fd.a)(r.emails,t,"ContactEmail"),a=n.collection;p(),l(a),t.forEach((function(e){e.Action===yE&&i.contacts("deletedContactEmail",{ID:e.ID}),(e.Action===EE||e.Action===SE)&&u(e.ContactEmail)})),e.length&&i.contacts("contactEmails.updated")},findIndex:function(e){return z()(r.emails,{ID:e})},findEmail:m,findEmails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ot.e;return e.map((function(e){return m(e,t)})).filter(Boolean)},findAllByEmail:g,findEmailByContactID:function(e,t){var n=t.ID;return m(e,_f.a,n)},findByEmailVcard:function(e,t){var n=e.value,r=e.type,a=void 0===r?"":r;return g(n,_f.a,t).find((function(e){var t=e.Type,n=void 0===t?[]:t;return!n.length||n.some((function(e){return a.toLowerCase().includes(e.toLowerCase())}))}))}}}var AE=kE,IE=n("NpuA"),CE=n.n(IE),wE={adr:[],anniversary:["anniversary"],bday:["birthday"],email:["e-mail address","e-mail 2 address","e-mail 3 address","email","alternate email 1","alternate email 2","primary email","secondary email"],fn:[],gender:["gender"],geo:["geolocation","location"],impp:["impp"],lang:["language"],logo:["logo"],member:["membmer","group membership"],nickname:["nickname","display name","screen name"],note:["notes","note"],org:["company","organization","department"],photo:["photo","avatar"],prodid:["software"],rev:["revision"],role:["role"],sound:["sound"],tel:["primary phone","other phone","radio phone","other","yahoo phone"],title:["title","job title","jobtitle"],tz:["timezone"],uid:["uid"],url:["url","web page","personal website","business website","website","web page 1","web page 2","personal web page"]},OE={Home:["home phone","home phone 2","voice"],Work:["work phone","company main phone","business phone","business phone 2","telephone work"],Mobile:["mobile","mobile number","mobile phone","x-mobile"],Fax:["fax","fax number","home fax","business fax","other fax","telex"],Pager:["pager","pager number"],Car:["car phone"]},ME={Fax:["Fax"],Home:["Home"],Work:["Work","Business"],Mobile:["Mobile"],Personal:["Personal","Perso","Main","Primary"]},PE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Be()(Ue()((function(t){return ME[t].filter((function(t){return e.indexOf(t)>-1})).length>0})),ec.a)(Object.keys(ME))},xE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.reduce((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=t[n.toLowerCase()];if(r){var a={value:r.toString()},o=PE(n);o&&(a.parameter=o),e.push(a)}return e}),[])},TE={adr:function(e){var t=[];if(We()(["home","work","business","other"],(function(n){var r=function(e,t){var n=e["".concat(t," address")]||e["".concat(t," street")]||"",r=["",e["".concat(t," address 2")]||e["".concat(t," street 2")]||"",n,e["".concat(t," city")]||"",e["".concat(t," state")]||"",e["".concat(t," zipcode")]||e["".concat(t," postal code")]||e["".concat(t," zip")]||"",e["".concat(t," country")]||e["".concat(t," country/region")]||""];return r.join("").trim().length?r.join(";").trim():""}(e,n);r&&t.push({value:r,parameter:n})})),e["address 1 - formatted"]){var n={value:e["address 1 - formatted"]};e["address 1 - type"]&&(n.parameter=e["address 1 - type"]),t.push(n)}if(e["address 2 - formatted"]){var r={value:e["address 2 - formatted"]};e["address 2 - type"]&&(r.parameter=e["address 2 - type"]),t.push(r)}if(e["address 3 - formatted"]){var a={value:e["address 3 - formatted"]};e["address 3 - type"]&&(a.parameter=e["address 3 - type"]),t.push(a)}return t},anniversary:function(e){return xE(wE.anniversary,e)},bday:function(e){var t=xE(wE.bday,e),n=e["birth year"],r=e["birth month"],a=e["birth day"];return n&&r&&a&&t.push({value:"".concat(n,"-").concat(r,"-").concat(a)}),t},email:function(e){var t=xE(wE.email,e);if(e["e-mail 1 - value"]){var n={value:e["e-mail 1 - value"]};e["e-mail 1 - type"]&&(n.parameter=e["e-mail 1 - type"]),t.push(n)}if(e["e-mail 2 - value"]){var r={value:e["e-mail 2 - value"]};e["e-mail 2 - type"]&&(r.parameter=e["e-mail 2 - type"]),t.push(r)}if(e["e-mail 3 - value"]){var a={value:e["e-mail 3 - value"]};e["e-mail 3 - type"]&&(a.parameter=e["e-mail 3 - type"]),t.push(a)}return t},fn:function(e){var t=[],n=[];return e.first&&n.push(e.first),e.name&&n.push(e.name),e.middle&&n.push(e.middle),e.last&&n.push(e.last),e["first name"]&&n.push(e["first name"]),e["middle name"]&&n.push(e["middle name"]),e["last name"]&&n.push(e["last name"]),n.length&&t.push({value:n.join(" ")}),t},gender:function(e){return xE(wE.gender,e)},geo:function(e){return xE(wE.geo,e)},impp:function(e){return xE(wE.impp,e)},lang:function(e){return xE(wE.lang,e)},logo:function(e){return xE(wE.logo,e)},member:function(e){return xE(wE.member,e)},nickname:function(e){return xE(wE.nickname,e)},note:function(e){return xE(wE.note,e)},org:function(e){return xE(wE.org,e)},photo:function(e){return xE(wE.photo,e)},prodid:function(e){return xE(wE.prodid,e)},rev:function(e){return xE(wE.csv,e)},role:function(e){return xE(wE.role,e)},sound:function(e){return xE(wE.sound,e)},tel:function(e){var t=xE(wE.tel,e);if(Object.keys(OE).forEach((function(n){OE[n].forEach((function(r){var a=e[r.toLowerCase()];a&&t.push({value:a,parameter:n})}))})),e["phone 1 - value"]){var n={value:e["phone 1 - value"]};e["phone 1 - type"]&&(n.parameter=e["phone 1 - type"]),t.push(n)}if(e["phone 2 - value"]){var r={value:e["phone 2 - value"]};e["phone 2 - type"]&&(r.parameter=e["phone 2 - type"]),t.push(r)}if(e["phone 3 - value"]){var a={value:e["phone 3 - value"]};e["phone 3 - type"]&&(a.parameter=e["phone 3 - type"]),t.push(a)}return t},title:function(e){return xE(wE.title,e)},tz:function(e){return xE(wE.tz,e)},uid:function(e){return xE(wE.uid,e)},url:function(e){return xE(wE.url,e)}},LE=Object.keys(wE),jE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t[n.toLowerCase()]=e[n],t}),Object.create(null))},NE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\n/g,"\\\\n")},$E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=jE(e);return LE.reduce((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=TE[n](t);return r.forEach((function(t){var r=t.value,a=void 0===r?"":r,o=t.parameter,i=void 0===o?"":o,c={};i&&(c.type=i),e.add(n,NE(a),c)})),e}),new wa.a)},RE=function(e){return new Promise((function(t,n){CE.a.parse(e,{header:!0,dynamicTyping:!1,complete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.data,r=void 0===n?[]:n;return t(r.map($E))},error:n,skipEmptyLines:!0})}))};function _E(e,t,n,r,a,i,s,u){var l=s((function(){return{noFiles:i.getString("No files were selected",null,"Error"),invalid:i.getString("Invalid file type",null,"Error"),parsingCSV:i.getString("Cannot convert the file",null,"Error")}})),d=t(["contacts"]).dispatcher,p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];d.contacts("createContact",{contacts:e.prepareContacts(t),mode:"import"})},f={".vcf":function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p(a.from(t)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),".csv":function(e){return RE(e).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length&&p(e)})).catch((function(e){throw console.error(e),new Error(l.parsingCSV)}))}};function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.ignoreFallback,i=a.resolver,c=a.rejection,s=new FileReader,u=e.name.toLowerCase().slice(-4);if(!f[u])return r.error(l.invalid),n.deactivate();if(".vcf"!==u)return e.result;var d=function(n,r){s.onload=r,s.onload=function(){var t=s.result.match(/CHARSET=(.+):/)||[],a=G()(t,2)[1],i=void 0===a?"":a;return o||/utf-8/i.test(i)?n(s.result):v(e,i,{ignoreFallback:!0,resolver:n,rejection:r})},s.readAsText(e,t)};return o?d(i,c):new Promise(d)}var m=function(){var e=c()(o.a.mark((function e(){var t,a,i,c,s,d,p=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=p.length>0&&void 0!==p[0]?p[0]:[]).length){e.next=3;break}return e.abrupt("return",r.error(l.noFiles));case 3:return a=t[0],i=a.name.toLowerCase().slice(-4),e.prev=5,e.next=8,v(a);case 8:c=e.sent,s=".vcf"===i?c:a,d=f[i](s).then((function(){return n.deactivate()})),u.track(d),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),r.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(){return e.apply(this,arguments)}}();return function(){n.activate({params:{import:m,cancel:function(){n.deactivate()}}})}}_E.$inject=["contactSchema","dispatchers","importContactModal","notification","vcard","gettextCatalog","translator","networkActivityTracker"];var UE=_E;function FE(e,t,n,r){var a=function(e,t){return e.reduce((function(e,n){return e.then((function(e){return t(n).then((function(t){return e.concat([t])}))}))}),Promise.resolve([]))},i=function(e){return new Promise((function(t){return n.activate({params:{email:e,submit:(r=c()(o.a.mark((function e(r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.deactivate();case 2:t(r);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),onEscape:q.a}});var r}))},u=function(e){var t=function(e){var t=Jb(e.vCard),n=so(t),r=0;return function e(){var t="item".concat(++r);return n.includes(t)?e():(n.push(t),t)}}(e),n=Object(ka.e)(e.vCard.get("email"));return n.forEach((function(e){return e.group=e.group||t()})),e.vCard.remove("email"),n.forEach((function(t){return e.vCard.addProperty(t)})),r.reassign(e.vCard)};return{process:function(n){var r=null,l=e.get("sendPreferences"),d=function(){var e=c()(o.a.mark((function e(t){var n,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===r){e.next=2;break}return e.abrupt("return",r);case 2:return e.next=4,i(t);case 4:return n=e.sent,a=n.applyToAll,c=n.encrypt,a&&(r=c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=c()(o.a.mark((function e(n){var r,i,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(n);case 2:return r=Object(ka.e)(n.vCard.get("email")),i=Object(ka.e)(n.vCard.get("key")),p=Object(ka.e)(n.vCard.get("x-pm-encrypt")),e.next=7,a(r,function(){var e=c()(o.a.mark((function e(r){var a,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.getGroup(),0!==(c=i.filter((function(e){return e.getGroup()===a}))).length){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Promise.all(c.map((function(e){return t.parseKey(e).catch((function(){return!1}))})));case 6:return u=e.sent,e.next=9,Promise.all(u.filter((function(e){return e})).map((function(e){var t=G()(e,1)[0];return void 0!==t&&t})).map((function(e){return e?Object(ee.h)(e).then((function(t){return!t&&e})).catch((function(){return!1})):Promise.resolve(e)})));case 9:if(e.sent.some((function(e){return e}))){e.next=13;break}return n.vCard=Qb(n.vCard,"key",a),e.abrupt("return");case 13:if(!(p.filter((function(e){return e.getGroup()===a})).length>0)){e.next=16;break}return e.abrupt("return");case 16:return e.next=18,l.get([r.valueOf()]);case 18:if(e.sent.scheme!==s.Lb.SEND_PM){e.next=21;break}return e.abrupt("return");case 21:return e.next=23,d(r.valueOf());case 23:e.sent&&(n.vCard.add("x-pm-encrypt","true",{group:a}),n.vCard.add("x-pm-sign","true",{group:a}));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a(n,p)}}}FE.$inject=["$injector","contactKey","contactAskEncryptionModal","contactKeyAssigner"];var BE=FE;function KE(e,t,n){var r=n((function(){return{LANG_AND:t.getString("and",null,"String separator"),REVOCATION_MESSAGE:t.getString("This key is revoked.",null,"PGP key warning"),EXPIRATION_MESSAGE:t.getString("This key is expired.",null,"PGP key warning"),userIdMismatch:function(e){return t.getPlural(e.length,"User IDs mismatch. This key is assigned to {{emails}}.","User IDs mismatch. The emails {{emails}} are assigned to this key.",{emails:Object(ka.a)(e,r.LANG_AND)},"PGP key warning")}}})),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="data:"===e.substring(0,5).toLowerCase()?e.split(",")[1]:e;return Object(lt.d)(Object(lt.g)(t))},i=function(e){return Object(lt.j)(Object(lt.b)(e))},s=function(e){return!!e.isExpired&&(e.revocationSignatures.length?r.REVOCATION_MESSAGE:r.EXPIRATION_MESSAGE)},u=function(e,t){var n=e.users,a=(void 0===n?[]:n).reduce((function(e,t){var n=t.userId,r=void 0===n?{}:n;return r&&e.push(r.userid),e}),[]).map((function(e){var t=/<([^>]*)>/.exec(e);return t?t[1]:e}));return!Ma()(a.map(Ot.f),[Object(Ot.f)(t)]).length&&r.userIdMismatch(a)},l=function(e,t,n){var r=[s(e),u(t,n)].filter(Boolean);return!!r.length&&r.join(" ")};return{parseKey:function(t){var n=e.unescapeValue(t.valueOf().trim(),!0);try{var r=a(n);return Object(ee.f)(r)}catch(o){}try{return Object(ee.f)(n)}catch(o){}return!1},getBase64Value:function(){var t=c()(o.a.mark((function t(n){var r,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.unescapeValue(n.valueOf().trim(),!0),t.prev=1,c=a(r),t.next=5,Object(ee.f)(c);case 5:return t.abrupt("return",i(c));case 8:t.prev=8,t.t0=t.catch(1);case 10:return t.prev=10,t.next=13,Object(ee.f)(r);case 13:return t.t1=i,t.next=16,Object(lt.n)(r);case 16:return t.t2=t.sent,t.abrupt("return",(0,t.t1)(t.t2));case 20:t.prev=20,t.t3=t.catch(10);case 22:return t.abrupt("return",!1);case 23:case"end":return t.stop()}}),t,null,[[1,8],[10,20]])})));return function(e){return t.apply(this,arguments)}}(),keyInfo:function(){var e=c()(o.a.mark((function e(t,n){var r,a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ee.f)(t);case 2:return r=e.sent,a=G()(r,1),i=a[0],e.next=7,Object(Sa.a)(t);case 7:return c=e.sent,e.next=10,Object(ee.h)(i);case 10:return s=e.sent,e.next=13,Object(te.e)(t);case 13:return c.key=e.sent,c.isExpired=s,c.invalidMessage=l(c,i,n),e.abrupt("return",c);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}}KE.$inject=["contactDetailsModel","gettextCatalog","translator"];var GE=KE;function VE(e){var t=e(["progressBar"]).dispatcher;return function(e,n,r){var a=0;return function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;a+=o;var i=Math.floor(e+a*(n-e)/r);t.progressBar("contactsProgressBar",{progress:i})}}}VE.$inject=["dispatchers"];var qE=VE;var HE=function(){var e=function(e){var t=e.deleted,n=e.selected;return!t&&n},t={details:function(e,t){return e[t]},preview:function(e){return e},select:function(t,n){var r=t[n];return r.deleted?t:(r.included=e(r),Object(ka.b)(t,n,(function(e){return!1===e.selected||!0===e.deleted})))},undelete:function(t,n){var r=t[n];return r.deleted?(r.deleted=!1,r.selected=!0,r.included=e(r),Object(ka.b)(t,n,(function(e){return!1===e.selected||!0===e.deleted}))):t},delete:function(t,n){var r=t[n];return r.deleted?t:(r.deleted=!0,r.selected=!1,r.included=e(r),Object(ka.b)(t,n,(function(e){return!0===e.deleted})))}},r=function(e,t){var n=e.get(t);return n&&n.valueOf()},a=function(e){var t=(e.getParams()||{}).pref;return parseInt(void 0===t?"0":t,10)},o=function(e){return Array.isArray(e)?e.slice().sort((function(e,t){return a(e)-a(t)})).map((function(e){return e.valueOf()})).join(", "):e},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ID,n=e.vCard;return{id:t,name:o(r(n,"fn")),email:o(r(n,"email")),vCard:n,selected:!0,deleted:!1,included:!0}};return{restrict:"E",replace:!0,scope:{groups:"=",details:"<",preview:"<"},templateUrl:n("/xA7"),link:function(n,r){var a=r[0];n.groups=Object.keys(n.groups).reduce((function(e,t){return e[t]=n.groups[t].map(i),e}),{}),n.dragControlListener={containment:".contactMergerList-table",containerPositioning:"relative",accept:function(t,n,r){return!!e(t.itemScope.modelValue)&&(t.itemScope.sortableScope.$id===n.$id&&(!r||e(r.modelValue)))}},n.willMerge=function(t){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(e)}(n.groups[t]).length>=2};var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return delete n.groups[e],n.groups};function c(e){var r=e.target,a=function(e){for(var t=e;t.parentNode&&!(t=t.parentNode).dataset.email;);return{email:t.dataset.email,i:parseInt(t.dataset.i,10)}},i=r.name;switch(i){case"details":var c=a(r),s=c.email,u=c.i;n.details(t.details(n.groups[s],u));break;case"preview":var l=a(r).email;n.preview(t.preview(n.groups[l]),l,o);break;case"undelete":case"delete":case"select":var d=a(r),p=d.email,f=d.i;n.$applyAsync((function(){n.groups[p]=t[i](n.groups[p],f)}))}}a.addEventListener("click",c),n.$on("$destroy",(function(){a.removeEventListener("click",c)}))}}};var zE=function(e){var t=e.items,n=void 0===t?[]:t,r=e.duplicateKey,a=void 0===r?"":r,o=e.uniqueKey,i=void 0===o?"":o,c=e.objectKey,s=void 0===c?"":c,u=bt()(n,(function(e,t){var n=t[a],r=t[i],o=t[s],c=e.cache,u=e.uniques;return u[r]||(u[r]={potentialDuplicateKeys:[],used:!1,object:o}),u[r].used?e:(c[n]?-1===c[n].indexOf(r)&&(c[n].push(r),u[r].used=!0,c[n].forEach((function(e){u[e].potentialDuplicateKeys.forEach((function(t){t!==n&&(c[t]=Object(ka.c)(c[t],e))})),u[e].potentialDuplicateKeys.length=0}))):(c[n]=[r],u[r].potentialDuplicateKeys.push(n)),e)}),{cache:Object.create(null),uniques:Object.create(null)}),l=u.cache,d=u.uniques;return bt()(Object.keys(l),(function(e,t){return l[t].length<=1?e:(e[t]=l[t].map((function(e){return d[e].object})),e)}),Object.create(null))};function YE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function WE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YE(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YE(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function XE(e,t,n,r,a,i,s,u,l,d,p){var f=d((function(){return{mergeContacts:s.getString("Merge contacts",null,"Title"),noDuplicate:s.getString("You have no duplicate contacts",null,"Info")}})),m=i().on;var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.trim().toLowerCase()};function h(e){var t=e.Name,n=e.vCard;if(t)return t;if(n){var r=n.get("fn");return(Array.isArray(r)?r[0]:r).valueOf()}return""}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=bt()(e,(function(e,t,n){var r,a,o;return(r=t,a=r.Emails,o=r.vCard,Array.isArray(a)?k()(a,(function(e){var t=e.Email;return void 0===t?"":t})):bt()(Jb(o),(function(e,t){return"email"===t.getField()&&e.push(t.valueOf()),e}),[])).forEach((function(r){e.push({duplicate:r,unique:n,contact:t})})),e.push({duplicate:g(h(t)),unique:n,contact:t}),e}),[]);return zE({items:t,duplicateKey:"duplicate",uniqueKey:"unique",objectKey:"contact"})}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return p.merge(k()(e,"vCard"),!0)}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!(e.length<=1))return WE({},r.prepareContact(y(e)),{ID:e[0].id})},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.slice(1).concat(t).map((function(e){return e.id}))};return Object.keys(e).reduce((function(r,a){var o=e[a],i=o.selected,c=o.deleted;return r[a]={update:t(i),remove:n(i,c)},r}),{})}function S(e){return Object.keys(e).reduce((function(t,n){var r=e[n].filter((function(e){return e.selected})),a=e[n].filter((function(e){return e.deleted}));return r.length<=1&&0===a.length?t:(t[n]={selected:r,deleted:a},t)}),{})}function D(e,n){t.activate({params:{vcard:e,onClickMerge:function(){n(),t.deactivate()},onClickClose:function(){t.deactivate()}}})}function A(e){return I.apply(this,arguments)}function I(){return(I=c()(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=S(t),Object.keys(r).length){e.next=3;break}throw new Error("Not enough contacts selected");case 3:return e.abrupt("return",n.merge(E(r)));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(t,n,r){return c()(o.a.mark((function a(){var i;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,A(v()({},n,t));case 2:i=r(n),0===Object.keys(i).length&&e.deactivate();case 4:case"end":return a.stop()}}),a)})))}function w(n){e.activate({params:{title:f.mergeContacts,duplicates:n,onClickMerge:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A(t).catch((function(){})),e.deactivate()},onClickDetails:function(e){!function(e){t.activate({params:{vcard:e,onClickClose:function(){t.deactivate()}}})}(e.vCard)},onClickPreview:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e.filter((function(e){return e.selected}));r.length<=1||D(y(r),C(e,t,n))},onClickClose:function(){e.deactivate()}}})}return m("contacts",(function(e,t){var n=t.type,r=t.data;"mergeContacts"===n&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.length>=2?a.getMultiple(e).then((function(e){return{group:e}})):a.exportAll().then(b);t.then((function(e){if(Object.keys(e).length)return w(e);l.info(f.noDuplicate)})),u.track(t)}((void 0===r?{}:r).contactIDs)})),{init:angular.noop,extractDuplicates:b}}XE.$inject=["contactMergerModal","contactDisplayModal","contactEditor","contactSchema","Contact","dispatchers","gettextCatalog","networkActivityTracker","notification","translator","vcard"];var JE=XE;function QE(e,t){var n={vCard:new wa.a},r=["Tel","Adr","Note"],a=["Bday","Title","Org","Nickname"],o=t((function(){return{UNKNOWN:e.getString("Unknown",null,"Default display name vcard")}})),i=r.concat(a),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{Email:e.valueOf(),Type:d(e)}},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Array.isArray(e)?k()(e,c):[c(e)]},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Array.isArray(e)?e[0].valueOf().trim():e.valueOf().trim()},l=function(e){return!!Array.isArray(e)||e&&!e.isEmpty()&&e.valueOf().trim()};function d(e){var t=e.getType();return Array.isArray(t)?t:[t]}function p(e){var t={Emails:[],vCard:e},n=e.get("fn"),r=e.get("email");if(l(r)&&(t.Emails=s(r)),l(n))t.Name=u(n);else{var a=t.Emails.length?t.Emails[0].Email:o.UNKNOWN;t.Name=a,t.vCard.set("fn",a)}return t}return{contactAPI:n,group:r,personnal:a,custom:function(e){return-1===i.indexOf(e)},prepareContact:p,prepareContacts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(p)}}}QE.$inject=["gettextCatalog","translator"];var ZE=QE;function eS(e){var t=["x-pm-mimetype","x-pm-encrypt","x-pm-sign","x-pm-scheme","x-pm-tls"],n=function(e){return e.toLowerCase().replace(/\+[^@]*@/,"").replace(/[._-](?=[^@]*@)/g,"")},r=Ea()(Sa.a,lt.d,lt.g),a=function(e){var t=e.get("email")||[],n=Array.isArray(t)?t:[t];return bt()(n,(function(e,t){return Ge()(e,v()({},t.getGroup(),t))}),{})},i=function(t,a){return Promise.all(k()(a,function(){var a=c()(o.a.mark((function a(i){var c,s,u,l,d,p;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.getBase64Value(i);case 2:if(c=a.sent,s="data:application/pgp-keys;base64,".concat(c),!1!==c){a.next=6;break}return a.abrupt("return",[]);case 6:if(!Et()(t,i.getGroup())){a.next=8;break}return a.abrupt("return",[i]);case 8:return a.next=10,r(c);case 10:return u=a.sent,l=u.userIds.map((function(e){return/<([^>]*)>/.exec(e)[1]})),d=xo()(t).filter((function(e){var r=n(t[e].valueOf());return _r()(l,(function(e){return n(e)===r}))})),p=d.length?d:xo()(t),a.abrupt("return",p.map((function(e){return new wa.a.Property("key",s,{group:e})})));case 15:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()))},s=function(e,n){return t.forEach((function(t){var r=n.get(t)||[],a=Array.isArray(r)?r:[r],o={},i=a.filter((function(t){var n=t.getGroup();return!Et()(o,n)&&(o[n]=!0,Et()(e,t.getGroup()))})).filter(_f.a);n.remove(t),i.forEach(n.addProperty)}))};return{reassign:function(){var e=c()(o.a.mark((function e(t){var n,r,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.get("key")||[],r=Array.isArray(n)?n:[n],!ba()(r,(function(e){return e.getGroup()}))){e.next=4;break}return e.abrupt("return");case 4:return c=a(t),e.t0=Lo.a,e.next=8,i(c,r);case 8:e.t1=e.sent,u=(0,e.t0)(e.t1),s(c,t),t.remove("key"),u.forEach((function(e){return t.addProperty(e)}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}eS.$inject=["contactKey"];var tS=eS;function nS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rS(e,t,n,r,a,i){var u=function(e,t){return r.getString("Created on {{created}}, {{bits}} bits (can be used for sending and signature verification)",{created:e,bits:t},"Key details")},l=function(e,t){return r.getString("Created on {{created}}, {{bits}} bits (cannot be used for sending)",{created:e,bits:t},"Key details")},d=function(e){return r.getString("The public key with fingerprint {{ fingerprint }} was replaced with a revoked key.",{fingerprint:e},"Notification update")},p=function(e){return r.getString("The public key with fingerprint {{ fingerprint }} updated.",{fingerprint:e},"Notification update")};return function(r,f){var m=f.keys,g=void 0===m?[]:m,h=f.isInternal,b=void 0!==h&&h,y=f.email,E=void 0===y?"":y,S=f.onChange,D=void 0===S?function(){}:S,k=function(){return r.$applyAsync((function(){b&&r.UI.items.forEach((function(e){e.verificationOnly=!r.BE.items.some((function(t){return e.fingerprint===t.fingerprint&&!t.verificationOnly})),e.customKey=!r.BE.items.some((function(t){return e.fingerprint===t.fingerprint}))}));var e=[],t=r.UI.items.reduce((function(t,n){return e.includes(n.fingerprint)?t:(e.push(n.fingerprint),n.verificationOnly||n.isExpired?t.tail.push(n):t.head.push(n),t)}),{head:[],tail:[]}),n=t.head,a=t.tail;r.UI.items=n.concat(a),r.BE.items.forEach((function(e){e.hide=r.UI.items.some((function(t){return t.fingerprint===e.fingerprint}))})),r.BE.hasUntrusted=r.BE.items.some((function(e){return!e.hide})),D()}))},A=function(e){var t=e.created.toLocaleDateString(),n=e.bitSize;return e.verificationOnly?l(t,n):u(t,n)},C=function(e){return{info:e,value:e.key,fingerprint:e.fingerprint,algType:Object(ne.a)(e),created:e.created.toLocaleDateString(),expires:null!=e.expires&&isFinite(e.expires)?e.expires.toLocaleDateString():"-",isExpired:e.isExpired,details:A(e),invalidMessage:e.invalidMessage}},w=function(){var e=c()(o.a.mark((function e(t){var n,r,i,c,s,u,l,d,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.value.split(","),r=G()(n,2),i=r[1],c=Object(lt.d)(Object(lt.g)(i)),e.next=4,Object(ee.f)(c);case 4:s=e.sent,u=G()(s,1),l=u[0],d=new Blob([l.armor()],{type:"data:text/plain;charset=utf-8;"}),p="publickey - ".concat(E," - 0x").concat(t.fingerprint.slice(0,8).toUpperCase(),".asc"),a(d,p);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){return i.get([r.email]).then((function(e){var n=e[r.email].Keys;return Promise.all(n.map((function(e){var n=e.PublicKey,r=e.Flags;return t.keyInfo(n,E).then((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nS(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nS(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{verificationOnly:!(r&s.kb.ENABLE_ENCRYPTION)})}))})))})).then((function(e){return e.map((function(e){return{value:e.key,fingerprint:e.fingerprint,algType:Object(ne.a)(e),details:A(e),bits:e.bitSize,created:e.created.toLocaleDateString(),hide:!1,verificationOnly:e.verificationOnly,info:e}}))}))},M=function(){var e=g.reduce((function(e,n){if(!n)return e;var r=Object(I.b)(n),a=t.keyInfo(r,E).then(C);return e.push(a),e}),[]);return Promise.all(e)};return function(){var e=c()(o.a.mark((function e(){var t,a,i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Promise.all([M(),O()]),a=n.track(t),e.next=4,a;case 4:i=e.sent,c=G()(i,2),s=c[0],u=c[1],r.UI={items:s},r.BE={hide:!0,items:u,hasUntrusted:!1},k();case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),{getInfos:function(e){return Promise.all(e.map((function(e){return Object(I.d)(e).then((function(e){return t.keyInfo(e,E)})).catch((function(){return{error:e.name}}))})))},addKeys:function(t){var n=r.UI.items.map((function(e){return e.fingerprint})),a=t.reduce((function(e,t){return n.includes(t.fingerprint)?e.knownKeys.push(t):e.newKeys.push(t),n.push(t.fingerprint),e}),{knownKeys:[],newKeys:[]}),o=a.knownKeys,i=a.newKeys;0===o.length&&0===i.length||function(t,n){r.$applyAsync((function(){n.forEach((function(e){r.UI.items.push(C(e))})),t.forEach((function(t){var n=r.UI.items.findIndex((function(e){var n=e.fingerprint;return t.fingerprint===n}));n<0||(!r.UI.items[n].isExpired&&t.revocationSignatures.length?e.info(d(t.fingerprint.substring(0,10))):e.info(p(t.fingerprint.substring(0,10))),r.UI.items[n]=C(t))})),k()}))}(o,i)},download:w,removeAll:function(){r.$applyAsync((function(){r.UI.items=[],k()}))},moveToTrusted:function(e){r.$applyAsync((function(){r.UI.items.push(C(e.info)),k()}))},moveAllToTrusted:function(){r.$applyAsync((function(){r.BE.items.filter((function(e){return!e.hide})).forEach((function(e){r.UI.items.push(C(e.info))})),k()}))},makePrimary:function(e,t){r.$applyAsync((function(){r.UI.items.splice(t,1),r.UI.items.unshift(e),k()}))},remove:function(e,t){r.$applyAsync((function(){r.UI.items.splice(t,1),k()}))}}}}rS.$inject=["notification","contactKey","networkActivityTracker","gettextCatalog","downloadFile","keyCache"];var aS=rS,oS=function(e,t,n){return function(r,a){var o=a.getGroup();if(o){var i="".concat(o.toLowerCase(),"-").concat(n&&t);!r.newGroups[i]&&(r.newGroups[i]="item".concat(++r.groupId)),a.group=r.newGroups[i]}var c=e(a);return!r.properties[c]&&(r.properties[c]=[]),r.properties[c].push(a),r}},iS={default:function(e){return e.getField()},encryption:function(e){var t=e.getField(),n=Fa.includes(t);if(n)return"clearText";var r=Ba.includes(t);if(r)return"toSign";var a=Ka.includes(t);return!n&&!r||a?"toEncryptAndSign":void 0}},cS=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.type,r=void 0===n?"default":n,a=t.unicityGroup,o=void 0!==a&&a,i={properties:Object.create(null),groupId:0,newGroups:Object.create(null)},c=bt()(e,(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return bt()(Jb(t),oS(iS[r],n,o),e)}),i),s=c.properties;return s};dS.$inject=["chunk","gettextCatalog","vcard","keysModel","contactKeyAssigner","contactProgressReporter","extractCards"];var sS=s.w.CLEAR_TEXT,uS=s.w.ENCRYPTED_AND_SIGNED,lS=s.w.SIGNED;function dS(e,t,n,r,a,i,u){var l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return k()(e,"error").filter(Boolean)},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r={ID:e,vCard:p(t),errors:l(t),types:n.map((function(e){return e.Type}))};return Object.keys(r.vCard.data).forEach((function(e){Array.isArray(r.vCard.data[e])&&(r.vCard.data[e]=co(r.vCard.data[e]))})),r};function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=bt()(e,(function(e,t){var n=t.data;return"".concat(e).concat(n,"\r\n")}),""),r=n.from(t);return n.merge(r)}var f=a.reassign;function v(e){return m.apply(this,arguments)}function m(){return(m=c()(o.a.mark((function e(r){var a,i,c,u,l,d,p,v,m,g,h,b,y,E,S,D,k,A,I,C,w;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.data,i=r.publicKeys,c=r.privateKeys,u=!0,l=!0,d=[],e.next=6,f(a);case 6:return p=Object(Ot.b)(),v=cS([a],{type:"encryption"}),m=v.toEncryptAndSign,g=void 0===m?[]:m,h=v.toSign,b=void 0===h?[]:h,y=v.clearText,E=void 0===y?[]:y,g.length>0&&(-1===g.map((function(e){return e.getField()})).indexOf("uid")&&g.push(new wa.a.Property("uid",p)),S=n.build(g).toString(s.tc),d.push(Object(ut.a)({data:S,publicKeys:i,privateKeys:c,armor:u,detached:l}).then((function(e){var t=e.data,n=e.signature;return{Type:uS,Data:t,Signature:n}})))),b.length>0&&(-1===(D=b.map((function(e){return e.getField()}))).indexOf("uid")&&b.push(new wa.a.Property("uid",p)),-1===D.indexOf("fn")&&(k=t.getString("Unknown",null,"Default display name vcard"),(A=le()(g,{_field:"n"}))?k=A.valueOf().split(";").join(" "):(I=le()(b,{_field:"email"}))&&(k=I.valueOf()),b.push(new wa.a.Property("fn",k))),C=n.build(b).toString(s.tc),d.push(Object(Ve.h)({data:C,privateKeys:c,armor:u,detached:l}).then((function(e){var t=e.signature;return{Type:lS,Data:C,Signature:t}})))),E.length>0&&(w=n.build(E).toString(s.tc),d.push({Type:sS,Data:w,Signature:null})),e.abrupt("return",Promise.all(d));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=function(e){return function(t){return t.reduce((function(t,n){return t.then(function(t){return function(n){return Promise.all(t.map(e)).then((function(e){return n.concat(e)}))}}(n))}),Promise.resolve([]))}};function h(t){var n=t.contacts,a=t.transform,o=t.progressSpeed,c=void 0===o?100:o,u=t.cancellationToken,l=void 0===u?Object(Rb.a)():u,d=t.progressBar,p=void 0!==d&&d,f=r.getPrivateKeys(s.sb),v=r.getPublicKeys(s.sb),m=n.length,h=p?i(0,c,m):function(){},b=Object(lt.m)(),y=e(n,Math.ceil(s.q/b)),E=e(y,Math.ceil(y.length/b)),S=g((function(e){return a(e,v,f).then((function(e){return l.check(),h(),e}))}));return Promise.all(E.map(S)).then((function(e){return e.reduce((function(e,t){return e.concat(t)}),[])}))}return{decrypt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(Rb.a)(),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return h({contacts:e,transform:function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.ID,i=t.Cards,e.next=3,u({cards:i,privateKeys:r,publicKeys:n});case 3:return c=e.sent,e.abrupt("return",d(a,c,i));case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),progressSpeed:100,cancellationToken:t,progressBar:n})},encrypt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h({cancellationToken:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(Rb.a)(),progressBar:arguments.length>2&&void 0!==arguments[2]&&arguments[2],contacts:e,transform:function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,c,s,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.vCard,i=G()(n,1),c=i[0],s=G()(r,1),u=s[0],e.next=5,v({data:a,publicKeys:[c],privateKeys:[u]});case 5:return l=e.sent,e.abrupt("return",{Cards:l});case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),progressSpeed:50})}}}var pS=dS;function fS(e,t,n,r,a,i,u){var l=u((function(){return{SUCCESS_ADVANCED_SAVED:i.getString("Advanced settings saved",null,"Info")}})),d=n(["contacts"]).dispatcher,p=e.getMap(),f=function(e,n,r){var a=e.vCard,o=e.ID,i=Jb(a),c=i.filter((function(e){return"email"===e.getField()})),u=oo(c,n),l=i.filter((function(e){var t=e.getField();return e.getGroup()!==u||!Ra.includes(t)})),d=c.reduce((function(e,r){var a=Object(Ot.e)(r.valueOf());return a===n?e:(e[a]={model:t.get(o,a),group:r.getGroup()},e)}),v()({},n,{model:r,group:u}));return Object.keys(d).forEach((function(e){var t=d[e],n=t.model,r=t.group;Ra.forEach((function(e){"key"===e&&n.Keys.forEach((function(t,n){l.push(new wa.a.Property(e,String(t),{group:r,pref:n+1}))}));var t=n[p[e]];void 0!==t&&t!==s.z&&l.push(new wa.a.Property(e,String(t),{group:r}))}))})),l.reduce((function(e,t){return e.addProperty(t),e}),new wa.a)};return{save:function(){var e=c()(o.a.mark((function e(t,n,i){var c,s,u,p,v,m,g;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.ID,s=n.vCard,u=r.get("Contact"),p=f({ID:c,vCard:s},i,t),e.next=5,u.updateUnencrypted({ID:c,vCard:p});case 5:v=e.sent,m=v.Contact,g=v.cards,d.contacts("contactUpdated",{contact:m,cards:g}),a.success(l.SUCCESS_ADVANCED_SAVED);case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),build:f}}fS.$inject=["contactEncryptionModel","contactEncryptionAddressMap","dispatchers","$injector","notification","gettextCatalog","translator"];var vS=fS;function mS(e,t){var n=t((function(){return{adr:e.getString("Address",null,"VCard key name"),anniversary:e.getString("Anniversary",null,"VCard key name"),caladruri:e.getString("Calendar user address",null,"VCard key name"),caluri:e.getString("URI for a calendar",null,"VCard key name"),bday:e.getString("Birthday",null,"VCard key name"),categories:e.getString("Categories",null,"VCard key name"),cell:e.getString("Cell",null,"VCard key name"),custom:e.getString("Custom",null,"VCard key name"),other:e.getString("Other",null,"VCard key name"),email:e.getString("Email",null,"VCard key name"),fax:e.getString("Fax",null,"VCard key name"),fburl:e.getString("Free or busy URL",null,"VCard key name"),fn:e.getString("Name",null,"VCard key name"),gender:e.getString("Gender",null,"VCard key name"),geo:e.getString("Geolocation",null,"VCard key name"),home:e.getString("Personal",null,"VCard key name"),impp:e.getString("Impp",null,"VCard key name"),key:e.getString("Public Key",null,"VCard key name"),lang:e.getString("Language",null,"VCard key name"),logo:e.getString("Logo",null,"VCard key name"),member:e.getString("Member",null,"VCard key name"),nickname:e.getString("Nickname",null,"VCard key name"),note:e.getString("Note",null,"VCard key name"),office:e.getString("Office",null,"VCard key name"),org:e.getString("Organization",null,"VCard key name"),photo:e.getString("Photo",null,"VCard key name"),private:e.getString("Private",null,"VCard key name"),prodid:e.getString("Software",null,"VCard key name"),related:e.getString("Related",null,"VCard key name"),rev:e.getString("Revision",null,"VCard key name"),role:e.getString("Role",null,"VCard key name"),sound:e.getString("Sound",null,"VCard key name"),voice:e.getString("Phone",null,"VCard key name"),tel:e.getString("Phone",null,"VCard key name"),title:e.getString("Title",null,"VCard key name"),tz:e.getString("Timezone",null,"VCard key name"),mobile:e.getString("Mobile",null,"VCard key name"),personal:e.getString("Personal",null,"VCard key name"),uid:"UID",url:"URL",work:e.getString("Work",null,"VCard key name"),"pm-scheme":e.getString("Cryptographic scheme",null,"VCard key name"),"pm-mimetype":e.getString("Format",null,"VCard key name"),"pm-sign":e.getString("Sign",null,"VCard key name"),"pm-encrypt":e.getString("Encrypt",null,"VCard key name"),"pm-tls":e.getString("TLS",null,"VCard key name")}})),r=Object.keys(n);return{toLang:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.toLowerCase(),r=t.startsWith("x-")?t.slice(2):t;return n[r]||"".concat(r.charAt(0).toUpperCase()).concat(r.slice(1))},toLangExplicit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n[e.toLowerCase()]},toVCard:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=r.find((function(t){return e===n[t]}));return"tel"===t?"voice":t||e}}}mS.$inject=["gettextCatalog","translator"];var gS=mS;function hS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bS(e,t,n,r){var a=["email","home","work","other"],o=["tel","mobile","work","fax","other"],i=["adr","home","work","other"],c=["org","anniversary","bday","gender","nickname","role","title","url"],s=r((function(){return{name:e.getString("Name",null,"Placeholder"),pgp:e.getString("Public key",null,"Placeholder"),emailAddress:e.getString("Email address",null,"Placeholder"),phoneNumber:e.getString("Phone number",null,"Placeholder"),information:e.getString("Information",null,"Placeholder"),note:e.getString("A note",null,"Placeholder"),address:e.getString("Address",null,"Placeholder"),custom:e.getString("Custom",null,"Placeholder"),customField:e.getString("Custom field",null,"Placeholder"),htmlMimeType:e.getString("Automatic",null,"MIME type"),plaintextMimeType:e.getString("Plain Text",null,"MIME type"),requireTLS:e.getString("Require",null,"TLS type"),optionalTLS:e.getString("Opportunistic",null,"TLS type"),noScheme:e.getString("Use Global Default",null,"Default encryption scheme"),default:e.getString("Default",null,"MIME type")}})),u={Key:{key:"key",type:"key"},Scheme:{key:"x-pm-scheme",type:"pm-scheme"},MIMEType:{key:"x-pm-mimetype",type:"pm-mimetype"},Encrypt:{key:"x-pm-encrypt",type:"pm-encrypt"},Sign:{key:"x-pm-sign",type:"pm-sign"},TLS:{key:"x-pm-tls",type:"pm-tls"},Name:{key:"fn",type:"fn"},Emails:{key:"email",type:"email"},Tels:{key:"tel",type:"tel"},Adrs:{key:"adr",type:"adr"},Customs:{key:"x-custom",type:"custom"},Notes:{key:"note",type:"note"},Photos:{key:"photo",type:"photo"},Categories:{key:"categories",type:"categories"}};function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.toLowerCase();return t.startsWith("x-")?e.substring(2):t.startsWith("x")?e.substring(1):e}function d(e,t){var n,r,a,o=(n=e.items,r=void 0===n?[]:n,a=k()(r,"type"),le()(c,(function(e){return-1===a.indexOf(e)}))||c[_d()(c.length-1)]);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hS(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hS(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},u,{Personals:{key:o,type:o}})[t]}function p(e,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,s=Me()(e.hide,r),u=Array.isArray(o)?o.map((function(e){return n.toTagUnicode(e,"reverse")})):n.toTagUnicode(o,"reverse");e.uuid=Object(Ot.k)(),e.items.push({type:r,label:t.toLang(a),value:u,hide:s,params:i,settings:c,uuid:Object(Ot.k)()})}return{remove:function(e,t){return e.items.splice(e.items.indexOf(t),1)},add:p,initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r={allowCustom:!1,allowMultiple:!1,mode:"singleLine",infinite:!1,unique:!1,sortable:!1,sortableState:!1,placeholder:"",iconClass:"",labels:[],items:[],hide:["version","n","prodid","abuid","uid","categories"],inputType:"text",defaultValue:""};switch(n){case"Name":r.autofocus=!0,r.unique=!0,r.placeholder=s.name,r.iconClass="fa-user";break;case"Emails":r.infinite=!0,r.sortable=!0,r.inputType="email",r.placeholder=s.emailAddress,r.iconClass="fa-envelope",r.labels=a.map((function(e){return t.toLang(e)}));break;case"Tels":r.inputType="tel",r.placeholder=s.phoneNumber,r.iconClass="fa-phone",r.labels=o.map((function(e){return t.toLang(e)}));break;case"Adrs":r.placeholder=s.address,r.iconClass="fa-home",r.mode="address",r.labels=i.map((function(e){return t.toLang(e)}));break;case"Personals":r.placeholder=s.information,r.iconClass="fa-address-card",r.labels=c.map((function(e){return t.toLang(e)}));break;case"Notes":r.placeholder=s.note,r.iconClass="fa-sticky-note",r.mode="multiLine",r.unique=!0;break;case"Photos":r.iconClass="fa-photo",r.mode="photo",r.unique=!0;break;case"Customs":r.infinite=!0,r.placeholder=s.customField,r.iconClass="fa-asterisk",r.labels=[s.custom],r.allowCustom=!0}if(r.selectable=r.labels.length>1,e.length&&(r.allowMultiple=!0,e.forEach((function(e){(e.value||r.unique)&&p(r,e.key,l(e.type)||l(e.key),function(e,t){var n=t.mode,r=t.options;if("select"===n)return le()(r,e);return e}(e.value,r),e.params,e.settings)}))),!e.length||1===e.length&&Me()(r.hide,e[0].key)){var u=d(r,n);p(r,u.key,u.type,r.defaultValue,u.params,{})}return r.inputName="name_".concat(r.placeholder.replace(/\W+|_/g,"")),r.uuid=Object(Ot.k)(),r},populate:d}}bS.$inject=["gettextCatalog","contactTransformLabel","sanitize","translator"];var yS=bS;function ES(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function SS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ES(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ES(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function DS(e,t,n){var r=n(["composer.update"]).dispatcher,a=function(){return t.deactivate()};return{openModal:function(n,o){var i=o.key,c=o.name,s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ToList",r=t[n]||[],a=e.get().map((function(e){return SS({},e)})),o=a.reduce((function(e,t,n){var r=t.Email;return e[void 0===r?"":r]=n,e}),{});return bt()(r,(function(e,t){var n=t.Name,r=t.Address,a=t.invalid,i=o[r];return void 0!==i?(e.list[i].selected=!0,e):(a||e.others.push({Name:n,Email:r}),e)}),{list:a,others:[]})}(n,i),u=s.list,l=s.others;t.activate({params:{close:a,list:u,others:l,submit:function(e){a(),r["composer.update"]("add.recipients",{name:c,recipients:e,messageID:n.ID})}}})}}}DS.$inject=["contactEmails","contactSelectorModal","dispatchers"];var kS=DS;function AS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function IS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AS(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AS(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function CS(e,t){var n=e.getParams(),r=IS({},n,{group:"item".concat(t),pref:t});return{newProp:new wa.a.Property(e.getField(),e.valueOf(),r),config:v()({},n.group,{lastIndex:0,oldParams:n,params:r})}}var wS=function(e,t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=wa.a.parse(e.toString()),r=G()(n,1)[0],a=r.get("email"),o=Array.isArray(a)?a:[a],i=Fm()(t,"Email"),c=o.filter((function(e){var t=i[e._data];return!t||!t.length||!t.some((function(t){var n=t.Type;return(void 0===n?[]:n).some((function(t){return(e.type||"").toLowerCase().includes(t.toLowerCase())}))}))}));return c.length?(r.data.email=c,r):(Ga.forEach((function(e){r.remove(e)})),r)}(e,t);return n.get("email")?function(e){var t=new wa.a,n=e.get("email"),r=(Array.isArray(n)?n:[n]).reduce((function(e,t,n){if(Array.isArray(t._data))return t._data.forEach((function(t,n){var r=CS(t,n+1),a=r.newProp,o=r.config;Object.assign(e.config,o),e.list.push(a)})),e;var r=CS(t,n+1),a=r.newProp,o=r.config;return Object.assign(e.config,o),e.list.push(a),e}),{list:[],config:{}}),a=r.list,o=r.config,i=function(e){var t=o[e.getGroup()].params,n=t.group,r=t.type,a=e.getParams();return new wa.a.Property(e.getField(),e.valueOf(),IS({},a,{},a.type&&{type:r},{},a.pref&&{pref:++o[e.getGroup()].lastIndex},{},a.group&&{group:n}))},c=function(e){return o[e.getGroup()]};return Object.keys(e.data).forEach((function(n){var r=e.get(n);if(Ga.includes(n)){if("email"!==n){if(!r)return;if(Array.isArray(r)){var a=r.filter(c).map(i);return void(t.data[n]=a)}if(c(r)){var o=i(r);t.addProperty(o)}}}else t.addProperty(r)})),t.data.email=a,t}(n):n};function OS(e,t,n,r,a,i,s,u,l,d,p){var f=p((function(){return{successRemove:function(e){return r.getPlural(e,"{{total}} email removed from your contacts","{{total}} emails removed from your contacts",{total:e},"Success")}}})),v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=Fm()(l.get(),(function(e){var t=e.Email;return Object(Ot.e)(t)}));return e.reduce((function(e,r){var a=Object(Ot.e)(r);if(n[a])return e;var o=t.findAllByEmail(a,Ot.e);return o.length&&o.forEach((function(t){e.list.push(t),!e.map[t.ContactID]&&(e.map[t.ContactID]=[]),e.map[t.ContactID].push(t)})),e}),{list:[],map:Object.create(null)})};var m=function(t){var n=t.MAP_CONTACT_EMAILS,r=t.mapEmails,a=t.contactCards.reduce((function(e,t){var a=t.ID,o=t.vCard,i=function(e,t,n){return(t[e]||[]).filter((function(e){var t=e.ID;return n[t]}))}(a,n,r),c=wS(o,i);return function(e){return!Object.keys(e.data).some((function(e){return!/^x-pm|^(fn|uid|version)$/.test(e)}))}(c)?(e.IDs.push(a),e):(e.promises.push(u.updateContact({ID:a,vCard:c})),e)}),{promises:[],IDs:[]}),o=a.IDs,i=a.promises;return o.length&&i.push(e.remove({IDs:o})),Promise.all(i)};function g(e,t,n){return h.apply(this,arguments)}function h(){return(h=c()(o.a.mark((function t(n,r,a){var i,c,s,u,l,d;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.withEmails,c=void 0===i?[]:i,s=n.uniq,u=void 0===s?[]:s,l=c.concat(u),t.next=4,Promise.all(l.map((function(t){return e.get(t)})));case 4:return d=t.sent,t.next=7,m({contactCards:d,MAP_CONTACT_EMAILS:r,mapEmails:a});case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return function(){var e=c()(o.a.mark((function e(){var t,r,c,u,l,p,m,h,b,y=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=y.length>0&&void 0!==y[0]?y[0]:[],r=v(t),c=r.list,u=r.map,c.length){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Object(Rb.c)(1e3);case 6:return e.next=8,new Promise((function(e){a.activate({params:{list:c,submit:function(t){e(t),a.deactivate()},hookClose:function(){e([])}}})}));case 8:return l=e.sent,p=l.reduce((function(e,t){var n=t.ContactID,r=t.ID;if(e.mapEmails[r]=!0,!e.map[n]){var a=s.getItem(n).Emails.length>1;!a&&e.contacts.uniq.push(n),a&&e.contacts.withEmails.push(n),e.map[n]=!0}return e}),{contacts:{uniq:[],withEmails:[]},map:Object.create(null),mapEmails:Object.create(null)}),m=p.contacts,h=p.mapEmails,e.next=12,d.track(g(m,u,h));case 12:return(b=l.length)&&i.success(f.successRemove(b)),e.abrupt("return",n.call());case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}OS.$inject=["Contact","contactEmails","eventManager","gettextCatalog","removeContactListModal","notification","contactCache","contactEditor","addressesModel","networkActivityTracker","translator"];var MS=OS;function PS(e,t){var n=function(t){return e.findEmail(t)||{}};return function(e,r){var a=e||{},o=a.Name,i=void 0===o?"":o,c=a.Address,s=void 0===c?"":c,u=a.isContactGroup,l=a.Email,d=s||l;return"Address"===r?"<".concat(d,">"):"Raw"===r?u?t.getNumberString(s):d:"Name"===r?function(e,t){var r=n(t),a=r.Name,o=void 0===a?"":a,i=r.Email;return o&&o!==i?o:e||t}(i,d):function(e,t){var r=n(t);return t!==e&&e?angular.isString(r.Name)&&r.Name?"".concat(r.Name," <").concat(t,">"):void 0:t}(i,d)||"".concat(i," <").concat(d,">")}}PS.$inject=["contactEmails","contactGroupModel"];var xS=PS;var TS=function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t?J()(e,(function(e){return e.Email.indexOf(t)>-1})):e}};function LS(e){return e({controllerAs:"ctrl",templateUrl:n("BPKk"),controller:["params",function(e){var t=this;this.email=e.email,this.no=function(){e.submit({applyToAll:t.applyToAll,encrypt:!1})},this.yes=function(){e.submit({applyToAll:t.applyToAll,encrypt:!0})},this.applyToAll=!1}]})}LS.$inject=["pmModal"];var jS=LS;function NS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NS(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NS(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function RS(e,t,n){var r=n((function(){return{title:e.getString("Save Changes?",null,"Title for contact modal"),message:e.getString("There are unsaved changes to the contact you are editing. Do you want to save changes?",null,"Message for contact modal")}}));return{activate:function(e){var n=e.params;return t.activate({params:$S({I18N:r,cancel:t.deactivate},n)})},deactivate:t.deactivate}}RS.$inject=["gettextCatalog","discardModal","translator"];var _S=RS;function US(e,t,r,a){var o=a((function(){return{title:function(e){var n=e.email;return t.getString("Advanced settings ({{email}})",{email:n},"Title")}}}));return e({controllerAs:"ctrl",templateUrl:n("QNQp"),controller:["params",function(e){this.model=e.model,this.title=o.title(e),this.email=e.email,this.form=e.form,this.internalKeys=e.internalKeys,this.directSave=e.directSave,this.cancel=function(){return e.close()},this.save=function(){return e.save(r.getModel())}}]})}US.$inject=["pmModal","gettextCatalog","contactPgpModel","translator"];var FS=US;function BS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BS(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BS(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function GS(e,t,r,a){var o=a((function(){return{encrypting:function(e){return t.getString("Encrypting contacts: {{progress}}%",{progress:e},"Label for the progress bar displayed during the contact import")},decrypting:function(e){return t.getString("Decrypting contacts: {{progress}}%",{progress:e},"Label for the progress bar displayed during the contact export")},upload:function(e){return t.getString("Upload: {{progress}}%",{progress:e},"Label for the progress bar displayed during the contact import")},mergeFail:function(e){return t.getString("{{number}} failed to merge.",{number:e},"Number of failed contact during merge")},importFail:function(e){return t.getString("{{number}} failed to import.",{number:e},"Number of failed contact during the contact import")},totalFailure:t.getString("Import failed. Please check the import file or try again.",null,"Error during importation"),cancelling:t.getString("Import cancelled. Rolling back.",null,"Cancelled during importation")}}));o.modal=a((function(){return{import:{title:t.getString("Importing Contacts",null,"Title for the contacts exporter modal"),info:t.getString("Importing contacts, this may take a few minutes.",null,"Information for the contacts importer modal"),progress:function(e){return e>50?o.upload(e):o.encrypting(e)},complete:t.getString("Importing contacts complete!",null,"Import complete"),text:t.getString("contacts successfully imported.",null,"1 of 2 contacts successfully imported.")},export:{title:t.getString("Exporting Contacts",null,"Title for the contacts exporter modal"),info:t.getString("Exporting contacts, this may take a few minutes. When the progress is completed, this modal will close and let you download the file.",null,"Information for the contacts exporter modal"),progress:function(e){return o.decrypting(e)}},merge:{title:t.getString("Merging contacts",null,"Title for the contacts merging modal"),info:t.getString("Merging contacts, this may take a few minutes.",null,"Information for the contacts merging modal"),progress:function(e){return o.upload(e)},complete:t.getString("Merging contacts complete",null,"Merge complete"),text:t.getString("contacts successfully merged.",null,"1 of 2 contacts successfully merged.")}}}));var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return o.modal[e][t]};return r({controllerAs:"ctrl",templateUrl:n("MO4r"),controller:["params","$scope","importContactGroups","networkActivityTracker",function(t,n,r,a){var c=this,s=e(),u=s.on,l=s.unsubscribe,d=document.querySelector(".".concat("contactLoaderModal-label"));this.class="small",this.title=i(t.mode,"title"),this.info=i(t.mode,"info"),this.optionsGroup=r.getOptions(),this.pendingImport=!1;var p=function(){return{}},f=function(e,r){var a=e.created,s=void 0===a?[]:a,u=e.errors,l=void 0===u?[]:u,d=e.total,p=void 0===d?0:d,f=e.categories,v=void 0===f?[]:f,m=e.updated,g=void 0===m?[]:m,h=e.removed,b=void 0===h?{}:h,y="merge"===r?g.length+b.length:s.length;n.$applyAsync((function(){var e;c.state="imported",e={count:y,total:p},c.success=KS({complete:i(t.mode,"complete"),text:i(t.mode,"text")},e),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"import",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;if(t.length)if(c.error={list:t,total:n},t.length!==n)c.error.message=o["".concat(e,"Fail")](t.length);else{var r=G()(t,1),a=r[0],i=(a=void 0===a?{}:a).error,s=void 0===i?o.totalFailure:i;c.error.message=s}}(r,l,p),c.categories=v}))};u("contacts",(function(e,t){var n=t.type,a=void 0===n?"":n,o=t.data,i=void 0===o?{}:o;if("contactCreated"===a){var c=i.created,s=i.mapCategories;p=r(c,s),f(KS({},i,{categories:p.list()}))}"contactsMerged"===a&&f(i,"merge")})),u("progressBar",(function(e,n){var r=n.type,a=void 0===r?"":r,o=n.data,c=void 0===o?{}:o;!d&&(d=document.querySelector(".".concat("contactLoaderModal-label"))),d&&"contactsProgressBar"===a&&(d.textContent=i(t.mode,"progress")(c.progress))})),this.save=function(){n.contactImport.$invalid||(c.pendingImport=!0,a.track(p.run(c.model)).then((function(){return t.close()})).catch((function(){c.pendingImport=!1})))},this.toStep=function(e){c.state=e,c.class="",c.model=c.categories.reduce((function(e,t){var n=t.group,r=+!!n.isNew;return e[n.ID]={action:c.optionsGroup[r],group:{label:n.Name,value:n.ID,data:{}},name:n.isNew?n.Name:""},e}),Object.create(null))},this.close=function(){d&&(d.textContent=o.cancelling),t.close()},this.$onDestroy=function(){l()}}]})}GS.$inject=["dispatchers","gettextCatalog","pmModal","translator"];var VS=GS;function qS(e,t){return t({controllerAs:"ctrl",templateUrl:n("29vb"),controller:["params",function(e){var t=this,n=e.duplicates,r=e.title,a=e.onClickDetails,o=e.onClickPreview,i=e.onClickClose,c=e.onClickMerge;this.title=r,this.duplicates=n,this.onClickDetails=a,this.onClickPreview=o,this.onClickClose=i,this.onClickMerge=function(){c(t.duplicates)}}]})}qS.$inject=["gettextCatalog","pmModal"];var HS=qS;function zS(e,t,r,a,o,i,c){var u=c((function(){return{contactAdded:r.getString("Contact added",null,"Success message for the contact modal"),contactError:r.getString("Error with the request",null,"Default error for the contact modal")}}));return o({controllerAs:"ctrl",templateUrl:n("kOnj"),controller:["params",function(n){var r=t(["contacts"]),o=r.dispatcher,c=r.on,l=r.unsubscribe;c("contacts",(function(t,r){var o=r.type,i=void 0===o?"":o,c=r.data,s=void 0===c?{}:c;if("contactCreated"===i){var l=s.created,d=void 0===l?[]:l,p=s.errors,f=void 0===p?[]:p;if(f.length&&f.forEach((function(e){var t=e.error,n=void 0===t?u.contactError:t;return a.error(n)})),d.length){a.success(u.contactAdded);var v=s.state||{},m=v.toState,g=(m=void 0===m?{}:m).name,h=void 0===g?"secured.contacts.details":g,b=v.toParams;!n.noRedirect&&e.go(h,b||{id:d[0].ID}),n.close()}}})),this.contact=n.contact,i.init(s.v,this.contact.vCard),this.submit=function(){return o.contacts("submitContactForm")},this.$onDestroy=function(){l()}}]})}zS.$inject=["$state","dispatchers","gettextCatalog","notification","pmModal","contactEncryptionAddressMap","translator"];var YS=zS;function WS(e,t){return e({controllerAs:"ctrl",templateUrl:n("sX7S"),controller:["params","$scope",function(e,n){var r=this,a=t(),o=a.on,i=a.unsubscribe,c=[];this.import=function(){return e.import(c)},this.cancel=e.cancel,this.$onDestroy=i,o("importCardDropzone",(function(e,t){var a=t.data;c=a,n.$applyAsync((function(){return r.fileDropped=!0}))}))}]})}WS.$inject=["pmModal","dispatchers"];var XS=WS;function JS(e,t,r,a){var o=e(["importCardDropzone"]).dispatcher,i=a((function(){return{dictDefaultMessage:r.getString("Drop file or click here",null,"Info"),dictInvalidFileType:r.getString("Invalid file type",null,"Error")}}));return{scope:{},replace:!0,restrict:"E",templateUrl:n("fZBE"),link:function(e,n){var r=new Ar.a(n[0].firstElementChild,{addRemoveLinks:!1,dictDefaultMessage:i.dictDefaultMessage,dictInvalidFileType:i.dictInvalidFileType,url:"/file/post",autoProcessQueue:!1,maxFiles:1,paramName:"file",previewTemplate:'<div style="display:none"></div>',ignoreHiddenFiles:!0,acceptedFiles:".vcf,.csv"});r.on("addedfiles",(function(a){var c=a[0];if(!/\.(vcf|csv)$/i.test(c.name))return ke()((function(){return r.removeAllFiles(!0)}),100),t.error(i.dictInvalidFileType);o.importCardDropzone("import",[c]),e.$applyAsync((function(){n[0].classList.add("importCardDropzone-has-file"),e.fileDropped=c.name}))})),e.$on("$destroy",(function(){r.off("dragover"),r.off("addedfiles"),r.destroy()}))}}}JS.$inject=["dispatchers","notification","gettextCatalog","translator"];var QS=JS;tD.$inject=["contactDetailsModel","dispatchers","userType","mailSettingsModel"];var ZS=s.w.SIGNED,eD=s.w.ENCRYPTED_AND_SIGNED;function tD(e,t,r,a){var o=function(e){var t=e.key;return"uid"!==t&&"categories"!==t};return{scope:{contact:"=",mode:"="},replace:!0,restrict:"E",templateUrl:n("CcJv"),link:function(n,i){var c=t(),s=c.on,u=c.unsubscribe,l=function(e,t){return function(n){e.$applyAsync((function(){e.loadImage=n})),t.classList[n?"add":"remove"]("contactViewDetail-loadRemoteImage")}}(n,i[0]);n.isFree=r().isFree,n.isSigned=n.contact.types.includes(ZS)||n.contact.types.includes(eD),l(!!a.get("ShowImages")),n.model=e.extractHumans(n.contact.vCard,o),n.model.hasEncrypted=n.model.encrypted.length,s("contacts",(function(t,r){var a=r.type,i=void 0===a?"":a,c=r.data;"contactUpdated"===i&&(void 0===c?{}:c).contact.ID===n.contact.ID&&n.$applyAsync((function(){n.model=e.extractHumans(n.contact.vCard,o),n.model.hasEncrypted=n.model.encrypted.length}))}));var d=function(e){var t=e.target;"BUTTON"===t.nodeName&&("loadRemoteImage"===t.getAttribute("data-action")&&l(!0))};i.on("click",d),n.$on("$destroy",(function(){u(),i.off("click",d)}))}}}var nD=tD;var rD=function(){return{replace:!0,restrict:"E",templateUrl:n("wlJm"),link:function(e){e.formatAddress=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(Boolean)}}}};function aD(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return e.toLang(n||t)}}aD.$inject=["contactTransformLabel"];var oD=aD;function iD(e,t,r){var a=e(["contacts"]).dispatcher,i=function(e){return new Promise((function(t){var n=function(n){return function(){e.contacts("contactBeforeToLeaveModal",{choice:n}),r.deactivate(),t("discard"!==n)}};r.activate({params:{confirm:n("confirm"),discard:n("discard")}})}))};return{scope:{contactForm:"=form",contact:"=",mode:"="},replace:!0,restrict:"E",templateUrl:n("vGmo"),link:function(e,n){var r={toggleMode:function(){return["action.input",{action:"toggleMode",current:e.mode,contact:e.contact}]},downloadContact:function(e){return["exportContacts",{contactID:e.ID}]},deleteContact:function(e){return["deleteContacts",{contactIDs:[e.ID]}]}},s=function(){var n=c()(o.a.mark((function n(c){var s,u;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=c.target,u=s.getAttribute("data-action"),"BUTTON"===s.nodeName&&u){n.next=4;break}return n.abrupt("return");case 4:if("back"!==u){n.next=6;break}return n.abrupt("return",t.go("secured.contacts"));case 6:if(!e.contactForm||!e.contactForm.$dirty){n.next=11;break}return n.next=9,i(a);case 9:if(!n.sent){n.next=11;break}return n.abrupt("return");case 11:a.contacts.apply(null,r[u](e.contact));case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();n.on("click",s),e.$on("$destroy",(function(){n.off("click",s)}))}}}iD.$inject=["dispatchers","$state","contactBeforeToLeaveModal"];var cD=iD;function sD(e,t,n,r,a){var i=function(){var t=c()(o.a.mark((function t(n,a){var i,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getKeysPerEmail(n);case 2:return i=t.sent,c=r.get(a,n),t.abrupt("return",{keys:i,model:c});case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return function(){var e=c()(o.a.mark((function e(){var u,l,d,p,f,v,m,g,h,b,y,E=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=E.length>0&&void 0!==E[0]?E[0]:{},l=u.value,d=E.length>1?E[1]:void 0,p=E.length>2?E[2]:void 0,f=p.mode,v=p.form,m="view"===f,g=d.ID||s.v,e.next=7,a.track(i(l,g));case 7:return h=e.sent,b=h.model,y=h.keys,e.abrupt("return",new Promise((function(e,i){var s=function(){var e=c()(o.a.mark((function e(t){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.set(g,l,t),!m){e.next=7;break}return i=n.save(t,d,l),e.next=5,a.track(i);case 5:e.next=8;break;case 7:v&&v.$setDirty();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.activate({params:{internalKeys:y,email:l,model:b,directSave:m,save:function(n){s(n),e(),t.deactivate()},close:function(){i(),t.deactivate()}}})})));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}sD.$inject=["keyCache","contactEncryptionModal","contactEncryptionSaver","contactEncryptionAddressMap","networkActivityTracker"];var uD=sD;function lD(e,t){var n=e().on,r={models:Object.create(null)},a=function(e,t,n){r.models[e][Object(Ot.e)(t)]=n};return n("logout",(function(){r.models=Object.create(null)})),{init:function(e,n){r.models[e]=Object.create(null),Xb(n,La.EMAIL).forEach((function(r){var o=Object(Ot.e)(r.valueOf());a(e,o,t.prepare(n,o))})),Ra.forEach((function(e){return n.remove(e)}))},set:a,get:function(e,n){var a=Object(Ot.e)(n);return r.models[e][a]||(r.models[e][a]=t.getDefaultValues()),r.models[e][a]}}}lD.$inject=["dispatchers","contactEncryptionModel"];var dD=lD;function pD(e,t,r){var a=r((function(){return{htmlMimeType:t.getString("Automatic",null,"MIME type"),plaintextMimeType:t.getString("Plain Text",null,"MIME type")}}));return{require:"^form",scope:{form:"=",model:"="},replace:!0,restrict:"E",templateUrl:n("oo4M"),link:function(t,n,r,o){var i=e(["advancedSetting"]),c=i.dispatcher,u=i.on,l=i.unsubscribe,d=function(e){return t.mimetype=le()(t.options,{value:e})};t.options=[{value:s.z,label:a.htmlMimeType},{value:s.Gb.PLAINTEXT,label:a.plaintextMimeType}],t.onChange=function(){c.advancedSetting("updateMIMEType",{value:t.mimetype.value}),o.$setDirty()},u("advancedSetting",(function(e,n){var r=n.type,a=n.data,o=void 0===a?{}:a;"update"===r&&t.$applyAsync((function(){d(o.model.MIMEType)}))})),d(t.model),t.$on("$destroy",(function(){l()}))}}}pD.$inject=["dispatchers","gettextCatalog","translator"];var fD=pD;mD.$inject=["mailSettingsModel"];var vD={"x-pm-encrypt":"Encrypt","x-pm-scheme":"Scheme","x-pm-mimetype":"MIMEType","x-pm-sign":"Sign"};function mD(e){var t=function(){return{Keys:[],Sign:1===e.get("Sign"),Encrypt:!1,MIMEType:s.z,Scheme:s.z}},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduceRight((function(e,t){var n=t.getField(),r=t.valueOf();return"key"===n?(e.Keys.unshift(fo(r,n)),e):(e[vD[n]]=fo(r,n),e)}),t())};return{prepare:function(e,t){var r=Xb(e,La.EMAIL).find((function(e){return Object(Ot.e)(e.valueOf())===t}));if(r){var a=r.getGroup(),o=Xb(e,Ra,{group:a});return n(o)}return Object.keys(e.data).length&&!r?n(Ze()(e.data)):n()},getMap:function(){return vD},getDefaultValues:t}}var gD=mD;function hD(e){return{scope:{model:"="},replace:!0,restrict:"E",templateUrl:n("6vr+"),link:function(t){var n=e(),r=n.on,a=n.unsubscribe,o=function(e){return t.value=e};r("advancedSetting",(function(e,n){var r=n.type,a=n.data,i=void 0===a?{}:a;"update"===r&&t.$applyAsync((function(){o(i.model.Encrypt)}))})),o(t.model),t.$on("$destroy",(function(){a()}))}}}hD.$inject=["dispatchers"];var bD=hD;function yD(e){return{scope:{model:"="},replace:!0,restrict:"E",templateUrl:n("XwBX"),link:function(t){var n=e(),r=n.on,a=n.unsubscribe,o=function(e){return t.value=e};r("advancedSetting",(function(e,n){var r=n.type,a=n.data,i=void 0===a?{}:a;"update"===r&&t.$applyAsync((function(){o(i.model.Sign)}))})),o(t.model),t.$on("$destroy",(function(){a()}))}}}yD.$inject=["dispatchers"];var ED=yD;kD.$inject=["dispatchers","gettextCatalog","mailSettingsModel","translator"];var SD="PGP/Inline",DD="PGP/MIME";function kD(e,t,r,a){var o=a((function(){return{noScheme:t.getString("Use global default",null,"Default encryption scheme")}}));return{require:"^form",scope:{form:"=",model:"="},replace:!0,restrict:"E",templateUrl:n("PSo2"),link:function(t,n,a,i){var c=r.get("PGPScheme")===s.Lb.SEND_PGP_INLINE?SD:DD,u=e(["advancedSetting"]),l=u.dispatcher,d=u.on,p=u.unsubscribe,f=function(e){return t.scheme=le()(t.options,{value:e})};t.options=[{value:s.z,label:"".concat(o.noScheme," (").concat(c,")")},{value:"pgp-mime",label:DD},{value:"pgp-inline",label:SD}],t.onChange=function(){l.advancedSetting("updateScheme",{value:t.scheme.value}),i.$setDirty()},d("advancedSetting",(function(e,n){var r=n.type,a=n.data,o=void 0===a?{}:a;"update"===r&&t.$applyAsync((function(){f(o.model.Scheme)}))})),f(t.model),t.$on("$destroy",(function(){p()}))}}}var AD=kD;MD.$inject=["dispatchers","mailSettingsModel"];var ID=[s.z,s.Gb.PLAINTEXT],CD=s.Lb.SEND_PGP_INLINE,wD=s.Wb.TYPE_INTERNAL,OD=s.kb.ENABLE_ENCRYPTION;function MD(e,t){var n={},r=e(["advancedSetting"]),a=r.dispatcher,i=r.on,u=r.unsubscribe,l=function(e,t){return n.model[e]=t},d=function(e){return n.model[e]},p=function(){return a.advancedSetting("update",n)},f=function(){return n.internalKeys.RecipientType===wD},v=function(e){var r=n.model.Scheme,a=r===s.z&&(t.get("PGPScheme")===CD?"pgp-inline":"pgp-mime")===e;return n.model.Scheme&&!f()&&(r===e||a)},m=function(){return v("pgp-inline")},g=function(){var e=c()(o.a.mark((function e(){var t,n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=a.length>0&&void 0!==a[0]?a[0]:[]).length){e.next=3;break}return e.abrupt("return",!1);case 3:return n=t.map((function(e){return e.split(",")})).map((function(e){var t=G()(e,2)[1];return void 0===t?"":t})).map(lt.g).map(lt.d).filter((function(e){return e.length})).map((function(e){return Object(ee.f)(e).then((function(e){var t=G()(e,1)[0];return Object(ee.h)(t)}))})),e.next=6,Promise.all(n);case 6:return r=e.sent,e.abrupt("return",r.every((function(e){return e})));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=c()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.internalKeys.Keys,e.abrupt("return",Promise.all(t.filter((function(e){return e.Flags&OD})).map(function(){var e=c()(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.PublicKey,e.next=3,Object(lt.n)(n);case 3:return r=e.sent,e.abrupt("return",Object(lt.j)(Object(lt.b)(r)));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=d("Encrypt"),t=d("Sign");!e&&!t||f()||(m()?n.model.MIMEType=s.Gb.PLAINTEXT:n.model.MIMEType=s.z)},y={updateKeys:function(e){var t=e.keys;l("Keys",t),t.length||l("Encrypt",!1),p()},updateMIMEType:function(e){l("MIMEType",e.value),p()},updateSign:function(e){l("Sign",e.status),b(),p()},updateEncrypt:function(e){var t=e.status;l("Encrypt",t),t&&l("Sign",!0),b(),p()},updateScheme:function(e){l("Scheme",e.value),b(),p()}};return i("advancedSetting",(function(e,t){var n=t.type,r=t.data,a=void 0===r?{}:r;(y[n]||q.a)(a)})),i("logout",(function(){u()})),{init:function(e,t,r){n.model=e,n.email=t,n.internalKeys=r,ID.includes(n.model.MIMEType)||(n.model.MIMEType=s.z),b(),p()},isInternalUser:f,isDisabledUser:function(){return f()&&n.internalKeys.Keys.every((function(e){return!(e.Flags&OD)}))},isPGPInline:m,isPGPMime:function(){return v("pgp-mime")},get:d,getModel:function(){return n.model},getRawInternalKeys:h,allKeysExpired:g}}var PD=MD;function xD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function TD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xD(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xD(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function LD(e,t,r){return{scope:{contact:"=",model:"=",mode:"=",form:"="},replace:!0,restrict:"E",templateUrl:n("58Y6"),link:function(n,a){n.isOwnAddress=function(e){var n=t.getByEmail(e),a=r.getUserAddressesKeys(n)||{};return go(n,a)};var i=function(){var t=c()(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e(TD({},n.model),n.contact,{mode:n.mode,form:n.form});case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(){return t.apply(this,arguments)}}();a.on("click",i),n.$on("$destroy",(function(){a.off("click",i)}))}}}LD.$inject=["contactEncryptionSettings","addressesModel","keyCache"];var jD=LD;function ND(e){return{scope:{model:"=",contact:"=",type:"@",action:"@"},replace:!0,restrict:"E",templateUrl:n("XFRG"),link:function(t,n){if(e({notify:!1})){n[0].classList.add("contactGroupsDropdown-free");var r=function(t){t.preventDefault(),t.stopPropagation(),e.notify()};n.on("click",r),t.$on("$destroy",(function(){n.off("click",r)}))}}}}ND.$inject=["needUpgrade"];var $D=ND;function RD(e,t,r,a,i){return{scope:{contact:"=",model:"=",action:"=",type:"="},replace:!0,restrict:"E",templateUrl:n("SzbS"),link:function(n,s){var u,l=r(["contacts","dropdown"]),d=l.on,p=l.unsubscribe,f=l.dispatcher,v="addToContact"===n.action;n.color=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.Color,n=void 0===t?"inherit":t;return{color:n}};var m=i.manage(n.action,n.type,{email:n.model,contact:n.contact}),g=function(r){var i=r.target;"create"===i.dataset.action&&e.activate({params:{model:{Name:n.searchValue},close:function(){e.deactivate(),a.track(t.load(!0))}}}),"apply"===i.dataset.action&&n.$applyAsync(c()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(n.labels);case 2:t=e.sent,"submit"===t.mode&&f.dropdown("close");case 5:case"end":return e.stop()}}),e)}))))},h=function(e){var r=i.getEnv(n.type,{email:n.model,contact:n.contact}),a=r.map,o=r.selected,c=t.get().map((function(t){if(v)return t;var n=a[t.ID]||0;return n>0&&n<o.length?t.Selected=null:t.Selected=n>0,e&&t.ID===e&&(t.Selected=!0),t}));u=void 0,n.$applyAsync((function(){n.labels=c}))};d("dropdown",(function(e,t){var r=t.type,a=t.data;"show"===r&&(void 0===a?{}:a).type===n.type&&h()})),d("contactGroupModel",(function(e,t){var n=t.type,r=t.data,a=void 0===r?{}:r;if("cache.refresh"===n&&h(u),"cache.update"===n){var o=G()(a.create,1)[0],i=(o=void 0===o?{}:o).ID;u=i,h(i)}})),s.on("click",g),n.$on("$destroy",(function(){s.off("click",g),p()}))}}}RD.$inject=["contactGroupModal","contactGroupModel","dispatchers","networkActivityTracker","moveContactGroupHandler"];var _D=RD;function UD(e){return e({controllerAs:"ctrl",templateUrl:n("30ln"),controller:["params","$scope","dispatchers","sanitize","networkActivityTracker","manageContactGroup","eventManager",function(e,t,n,r,a,i,s){var u=this,l=n(),d=l.on,p=l.unsubscribe,f=function(t){return(e.model||{})[t]||""};this.model={ID:f("ID")||void 0,name:f("Name"),color:f("Color"),Display:f("Display")||void 0,contacts:(e.group||[]).map((function(e){return{ID:e.ID,Name:e.Name,Email:e.Email}}))},d("manageContactGroup",(function(e,n){var r=n.type,a=n.data,o=void 0===a?{}:a;"remove.contact"===r&&t.$applyAsync((function(){u.model.contacts=u.model.contacts.filter((function(e){return e.ID!==o.contact.ID}))}))}));this.create=function(t){if(!t.$invalid){var n=function(){var t=c()(o.a.mark((function t(n){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.save(n);case 2:e.close(),s.call();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ID,n=void 0===t?"":t,a=e.name,o=void 0===a?"":a,i=e.color,c=void 0===i?"":i,s=e.contacts,u=void 0===s?[]:s;return{ID:r.input(n)||void 0,Name:r.input(o),Color:r.input(c),ContactIDs:u.map((function(e){var t=e.ID;return r.input(t)}))}}(u.model);a.track(n(l))}},this.$onDestroy=function(){p()}}]})}UD.$inject=["pmModal"];var FD=UD;function BD(e,t,r){return{scope:{list:"=",form:"="},replace:!0,templateUrl:n("jOGx"),compile:t({link:function(t,n,a){var o=a.awesomplete,i=r(),c=i.on,u=i.unsubscribe;t.emails=[];var l=e(t.list,{keyValue:"ID",extraKeys:["Email"],mode:"contact"}),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.doesNotExist;t.$applyAsync((function(){n&&(t.list=l.all()),t.email=e,t.form.$invalid=r,t.form.$valid=!r}))},p=function(e){var t=e.target;if(","===t.value&&(t.value=""),t.value&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.indexOf(",")>-1||e.indexOf(";")>-1}(t.value))return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split(/,|;/).filter(Boolean).map((function(e){return e.trim()}))}(t.value).forEach((function(e){return l.add({label:e,value:e})})),d(),_rAF((function(){return o.input.value="",o.input.focus()}));var n=l.filterContact(t.value),r=n.list,a=n.hasAutocompletion;if(a&&(o.list=r),(t.value||"")&&!a)return d({doesNotExist:!0});d({},!1)},f=function(e){var t=e.target;if(o.minChars=1,"INPUT"===t.nodeName&&!t.value){o.minChars=0;var n=l.filterContact(t.value),r=n.list;n.hasAutocompletion&&(o.list=r)}},v=function(e){e.preventDefault();var t=function(e){if("FORM"===e.nodeName){var t=e.querySelector("input");return{value:(t?t.value:"").trim(),clear:function(){t&&(t.value="")}}}return{value:(e.value||"").trim(),clear:function(){e.value=""}}}(e.target),n=t.value,r=t.clear;if(n){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(s.Xb.test(t)){var n=G()(e.filterContact(t,!0).list,1),r=n[0];if(r)return r}}(l,n);if(!a)return;l.add(a),r(),d(),o.close()}},m=function(e){switch(e.keyCode){case 9:if(o.opened&&o.selected)return e.preventDefault(),o.select(),_rAF((function(){return o.input.focus()}));o.input.value&&v(e);break;case!e.shiftKey:o.select()}};o.replace=function(e){l.add(e),this.input.value="",d()},o.filter=function(e,t){return Awesomplete.FILTER_CONTAINS(e,l.formatInput(t))},c("contacts",(function(e,t){var n=t.type;if(/^contact(Events|Updated)$/.test(n))return d(!0)})),c("contactGroupModel",(function(e,t){var n=t.type,r=t.data;"cache.remove"===n&&r.forEach((function(e){return l.removeItem(e)}))})),n.on("keydown",m),n.on("click",f),n.on("input",p),n.on("submit",v),t.$on("$destroy",(function(){n.off("keydown",m),n.off("click",f),n.off("input",p),n.off("submit",v),u(),l.clear()}))}},{data:function(e){return{label:e.label,value:{value:e.ID,data:{Email:e.value}}}}})}}BD.$inject=["autocompleteEmailsModel","autocompleteBuilder","dispatchers"];var KD=BD,GD=n("j+1e"),VD=n.n(GD);function qD(e,t,n,r,a){var i=function(e){var t=v(e);return r.getPlural(t,"{{$count}} Member","{{$count}} Members",{},"Info")},u={EMAILS:{},NUMBERS:{}},l=e(["contactGroupModel"]),d=l.dispatcher,p=l.on,f=t((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.contactGroupModel(e,t)}),s.ob.CONTACT_GROUP);function v(e){return u.NUMBERS[e]||0}f.getNumber=v,f.getExport=function(){var e=c()(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.EMAILS[t]){e.next=2;break}return e.abrupt("return",u.EMAILS[t]);case 2:return e.next=4,n.exportGroup(t);case 4:return r=e.sent,u.EMAILS[t]=r,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f.getNumberString=i,f.extend=function(e){Object.keys(u.EMAILS).forEach((function(t){var n;e[t]&&((n=u.EMAILS[t]).push.apply(n,we()(e[t])),u.NUMBERS[t]=u.EMAILS[t].length)}))};var m=function(){var e;e=Be()(Ue()((function(e){return e.LabelIDs.length})),Ne()((function(e,t){var n=t.LabelIDs;return e.push.apply(e,we()(n)),e}),[]))(a.get()),u.NUMBERS=VD()(e),d.contactGroupModel("counter.update"),u.EMAILS={}};return p("AppModel",(function(e,t){var n=t.type,r=t.data;"loggedIn"===n&&!(void 0===r?{}:r).value&&f.set()})),p("contacts",(function(e,t){"contactsUpdated"===t.type&&m()})),p("contactGroupModel",(function(e,t){var n=t.type;/^cache\.(load|refresh)$/.test(n)&&m()})),f}qD.$inject=["dispatchers","labelCache","Contact","gettextCatalog","contactEmails"];var HD=qD;function zD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function YD(e,t,r,a,i,u){return e({controllerAs:"ctrl",templateUrl:n("eIcW"),controller:["params","$scope","userType",function(e,n,l){var d,p=this,f=r(["contactGroupModel","customCheckbox"]),m=f.on,g=f.unsubscribe,h=f.dispatcher,b=Object(Fl.a)({scrollableSelector:"#groupsContainer"}),y=b.dragStart,E=b.dragMove,S=b.dragEnd,D={selection:Object.create(null),selected:!1};this.isFree=l().isFree,this.labels=t.get(),this.hasSelection=!1,this.labelsDragControlListeners={containment:"#groupsContainer",dragStart:y,dragMove:E,dragEnd:S,accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id},orderChanged:(d=c()(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=k()(p.labels,"ID"),e.next=3,u.saveOrder(t,s.ob.CONTACT_GROUP);case 3:h.contactGroupModel("reorder.success");case 4:case"end":return e.stop()}}),e)}))),function(){return d.apply(this,arguments)})},this.getNumberMembers=function(e){var n=e.ID;return t.getNumberString(n)},this.create=function(){var n;e.hide(),a.activate({params:{previousModal:e,close:(n=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.deactivate(),e.next=3,i.track(t.load(!0));case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}})},this.selectAll=function(){p.labels.forEach((function(e){e.selected=!D.selected,D.selection[e.ID]=e.selected})),D.selected=!D.selected,p.hasSelection=!0===D.selected},this.removeSelection=c()(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.labels.reduce((function(e,t){var n=t.ID;return t.selected&&e.push(n),e}),[]),e.next=3,u.remove({IDs:n},s.ob.CONTACT_GROUP);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.abrupt("return",t.remove(n));case 7:case"end":return e.stop()}}),e)})));m("contactGroupModel",(function(e,r){var a=r.type;/^cache\.(update|refresh)$/.test(a)&&n.$applyAsync((function(){p.labels.length=0,_rAF((function(){n.$applyAsync((function(){p.labels=t.get().map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zD(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zD(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{selected:D.selection[e.ID]})}))}))}))}))})),m("customCheckbox",(function(e,t){var r=t.type,a=t.data.event;"change"===r&&n.$applyAsync((function(){var e,t,n,r=a.target.dataset.labelId;D.selection=p.labels.reduce((function(e,t){var n=t.ID,r=t.selected;return e[n]=r,e}),Object.create(null)),a.shiftKey&&(e=D.latestSelection,t=r,n=!1,p.labels.forEach((function(r){r.ID===e&&(n=!0),n&&(r.selected=D.selection[e],D.selection[r.ID]=r.selected),r.ID===t&&(n=!1,p.hasSelection=p.labels.some((function(e){return e})))}))),D.latestSelection=r,p.hasSelection=p.labels.some((function(e){var t=e.ID;return D.selection[t]}))}))})),this.$onDestroy=g}]})}YD.$inject=["pmModal","contactGroupModel","dispatchers","contactGroupModal","networkActivityTracker","manageLabels"];var WD=YD;function XD(e,t,r,a,o){return{scope:{},replace:!0,restrict:"E",templateUrl:n("zIo8"),link:function(n,i,c){var s=c.mode,u=function(){if("create"===s){if(o())return;return a.activate({params:{close:function(){a.deactivate(),t.track(r.load(!0))}}})}e.activate()};i.on("click",u),n.$on("$destroy",(function(){i.off("click",u)}))}}}XD.$inject=["manageContactGroupModal","networkActivityTracker","contactGroupModel","contactGroupModal","needUpgrade"];var JD=XD;function QD(e,t,r,a){var i=function(){var e=c()(o.a.mark((function e(t){var n,r,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.contact,r=void 0===n?{}:n,i=t.group,c=void 0===i?{}:i,a.remove(r,c);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{scope:{contact:"=",group:"="},replace:!0,restrict:"E",templateUrl:n("T0rJ"),link:function(e,t,n){var r=n.action;t[0].innerHTML="remove.contact"===r?'<i aria-hidden="true" class="fa fa-times"></i>':"";var a=function(){e.$applyAsync((function(){"remove.contact"===r&&i(e)}))};t.on("click",a),e.$on("$destroy",(function(){t.off("click",a)}))}}}QD.$inject=["Contact","notification","contactGroupModel","manageContactGroup"];var ZD=QD;function ek(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ek(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ek(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nk(e,t,n,r,a,i,u,l,d,p,f,m,g,h,b,y){var E=g(["manageContactGroup"]).dispatcher,S=y((function(){return{saveSuccess:function(e,t){var r=t.label,a=t.group;return"update"===e?n.getString("{{Name}} updated",{Name:r.Name},"Info"):n.getString("{{Name}} created with {{total}} contact(s)",{Name:r.Name,total:a.ContactIDs.length},"Info")},saveError:function(e,t){var r=t.message,a=t.items,o=void 0===a?[]:a;return v()({},13075,(function(){var e=n.getPlural(o.length,"The contact does not exist","These {{$count}} contacts do not exist",{},"Error"),t=o.map((function(e){return"<li>".concat(e,"</li>")})).join("");return"".concat(e,"<ul>").concat(t,"</ul>")}))[e]()||r},remove:function(e){var t=e.Name,r=n.getString("{{Name}} deleted",{Name:t},"Title"),a=n.getString("Delete {{Name}} from the group",{Name:t},"Title");return{NOTIF:r,message:n.getString("Are you sure you want to delete this contact ?",null,"Info"),title:a}},toggleGroup:{label:function(e){return n.getPlural(e,"Apply group success","Apply {{$count}} groups success",{},"Success")},unlabel:function(e){return n.getPlural(e,"Remove group success","Remove {{$count}} groups success",{},"Success")}}}})),D=function(e){var t=e.Responses,n=(void 0===t?[]:t).reduce((function(e,t){var n=t.ID,r=t.Response,a=void 0===r?{}:r;if(!a.Error)return e;e[a.Code]||(e[a.Code]={message:a.Error,items:[]});var o=h.getEmail(n)||{},i=o.Name,c=o.Email;return e[a.Code].items.push(i||c),e}),{});return{total:Object.keys(n).length,errors:n}},A={};function I(){return(I=c()(o.a.mark((function n(r,i,c){var u,l,d,p,f,m,g,h,b,y,E,k,I,C,w,O;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u=r.ID,l=void 0===u?A.ID:u,d=r.Name,p=void 0===d?"":d,f=r.Color,m=void 0===f?"":f,g=r.Display,h=void 0===g?0:g,b=r.ContactIDs,y=void 0===b?[]:b,E=l?"update":"create",n.next=4,e[E](tk({Name:p,Color:m,Type:s.ob.CONTACT_GROUP,Display:0},l&&{ID:l,Display:h}));case 4:return k=n.sent,A=k,I=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;if(!n.length)return{};var a=r?"label":"labelEmails",o=r?"ContactIDs":"ContactEmailIDs";return t[a](v()({LabelID:e},o,n))},n.next=9,I(k.ID,y,i);case 9:if(C=n.sent,!(w=D(C)).total||c){n.next=13;break}return n.abrupt("return",Object.keys(w.errors).forEach((function(e){a.error(S.saveError(e,w.errors[e]))})));case 13:if(!w.total||!c){n.next=16;break}return O=Object.keys(w.errors).map((function(e){return S.saveError(e,w.errors[e])})),n.abrupt("return",{label:k,group:C,errors:w,errorsMsg:O});case 16:return!c&&a.success(S.saveSuccess(E,{label:k,group:{ContactIDs:y}})),A={},n.abrupt("return",{label:k,group:C,errors:w});case 19:case"end":return n.stop()}}),n)})))).apply(this,arguments)}var C=function(e){var t=e.ID,n=l.getExport(t);return u.track(n),n},w=function(){var e=c()(o.a.mark((function e(t,n,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&r.hide(),a=n?l.read(n):t,e.t0=d,e.t1=a,e.next=6,C(a);case 6:e.t2=e.sent,e.t3=r,e.t4=function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.deactivate(),e.next=3,u.track(l.load(!0));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.t5={model:e.t1,group:e.t2,previousModal:e.t3,close:e.t4},e.t6={params:e.t5},e.t0.activate.call(e.t0,e.t6);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),O=function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,c,s,u,d,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.read(t),e.next=3,l.getExport(a.ID);case 3:return i=e.sent,c=f(n.ID),s=c.getDraftConfig(r)||{},u=s[a.ID]||[],d=i.concat(u).filter((function(e){return!e.Group})),p=ga()(d,(function(e){return e.Address||e.Email})),e.abrupt("return",{model:a,groupList:p});case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"label";return c()(o.a.mark((function n(){var r,c,s,l,d,p,f,m,g,h=arguments;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=h.length>0&&void 0!==h[0]?h[0]:[],c=h.length>1&&void 0!==h[1]?h[1]:[],s=h.length>2&&void 0!==h[2]?h[2]:{},l=s.isSilent,d=s.noEvent,c.length&&r.length){n.next=5;break}return n.abrupt("return");case 5:return p=S.toggleGroup[e.replace(/emails/i,"")],f=/email/i.test(e)?"ContactEmailIDs":"ContactIDs",m=Promise.all(r.map((function(n){return t[e](v()({LabelID:n},f,k()(c,"ID")))}))),n.next=10,u.track(m);case 10:if(g=n.sent,d){n.next=14;break}return n.next=14,i.call();case 14:return!l&&a.success(p(r.length)),n.abrupt("return",g);case 16:case"end":return n.stop()}}),n)})))};return{remove:function(e,n){var i=S.remove(e),s=i.message,d=i.title,p=i.NOTIF,f=function(){var e=c()(o.a.mark((function e(n,i){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.ID){e.next=5;break}return e.next=3,t.unlabelEmails({LabelID:i.ID,ContactEmailIDs:[n.ID]});case 3:r.deactivate(),a.success(p);case 5:l.remove([n.ID]),E.manageContactGroup("remove.contact",{contact:n});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();if(!n.ID)return f(e,n);r.activate({params:{title:d,message:s,confirm:function(){u.track(f(e,n))}}})},save:function(e,t,n){return I.apply(this,arguments)},edit:w,editComposer:function(){var e=c()(o.a.mark((function e(t,n,r){var a,i,s,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b().isFree){e.next=2;break}return e.abrupt("return");case 2:return a=m(n),i=function(){var e=c()(o.a.mark((function e(){var i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,n,r);case 2:return i=e.sent,c=i.model,s=i.groupList,e.next=7,a.sync(s);case 7:return u=a.extendFromCache(s),e.abrupt("return",{group:u,model:c});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=6,u.track(i());case 6:s=e.sent,l=s.group,d=s.model,p.activate({params:{type:r,model:d,message:n,group:l}});case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),contact:{attach:M(),detach:M("unlabel")},email:{attach:M("labelEmails"),detach:M("unlabelEmails")}}}nk.$inject=["Label","Contact","gettextCatalog","confirmModal","notification","eventManager","networkActivityTracker","contactGroupModel","contactGroupModal","editComposerContactGroupModal","composerContactGroupSelection","emailsEncryptionFlags","dispatchers","contactEmails","userType","translator"];var rk=nk;function ak(e,t,r){var a=function(e){var t=e.Name,n=e.Color,r=void 0===n?"inherit":n,a=document.createElement("LI");return a.className="contactGroupsOverview-label",a.insertAdjacentHTML("beforeend",'<i aria-hidden="true" class="fa fa-users"></i>'),a.style.color=r,{li:a,tooltip:Object(O.a)(a,{title:t})}},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return e.innerHTML="",t.forEach((function(t){var r=a(t),o=r.li,i=r.tooltip;n.push((function(){return i.dispose()})),e.appendChild(o)})),e.insertAdjacentHTML("beforeend",'<i class="fa fa-ellipsis-h contactGroupsOverview-ellipsis" aria-hidden="true"></i>'),n};return{scope:{contact:"=",email:"="},replace:!0,restrict:"E",templateUrl:n("/6fV"),link:function(n,a,i){var c=i.limit,s=void 0===c?3:c,u=i.type,l=r(),d=l.on,p=l.unsubscribe,f=[],v=function(){f.forEach((function(e){e()})),f.length=0},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];f.push.apply(f,we()(o(a[0],e)))},g=function(){v();var r=function(){if(n.email){var e=(t.findByEmailVcard(n.email,n.contact.ID)||{}).LabelIDs;return void 0===e?[]:e}var r=(n.contact||{}).LabelIDs;return void 0===r?[]:r}();if(r.length){var o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.reduce((function(t,n){var r=e.read(n,"labels");return r&&t.push(r),t}),[])}(r,u);if("none"!==s){var i=o.length,c=i?angular.copy(o.slice(0,s)):[];return a[0].setAttribute("data-overflow",i>s),m(c)}return m(o)}return m()},h=function(){return ke()(g,160)};d("contacts",(function(e,t){"contactsUpdated"===t.type&&h()})),d("contactGroupModel",(function(e,t){var n=t.type;["cache.refresh","cache.remove"].includes(void 0===n?"":n)&&h()})),g(),n.$on("$destroy",(function(){p(),v()}))}}}ak.$inject=["contactGroupModel","contactEmails","dispatchers"];var ok=ak;function ik(e,t,n,r,a,i){var u={CREATE:1,UPDATE:2},l=i((function(){var e;return e={nothing:r.getString("Do not import group",null,"Label")},v()(e,u.UPDATE,r.getString("Merge with existing group",null,"Label")),v()(e,u.CREATE,r.getString("Create a new group",null,"Label")),v()(e,"addSuccess",(function(e){return r.getString("{{total}} groups added",{total:e},"Info")})),v()(e,"updateSuccess",(function(e){return r.getString("{{total}} groups updated",{total:e},"Info")})),e})),d=[{value:u.UPDATE,label:l[u.UPDATE]},{value:u.CREATE,label:l[u.CREATE]},{value:0,label:l.nothing}],p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=bt()(t,(function(e,t){n[t.UID]&&n[t.UID].split(",").forEach((function(n){!e[n]&&(e[n]=[]),e[n].push(t)}));return e}),Object.create(null));return Object.keys(r).map((function(t){return{id:t,group:e.readName(t)||{ID:Object(Ot.k)(),Name:t,isNew:!0},contacts:r[t]}}))};function f(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object.keys(r);if(a.length!==n.length)throw new Error("INVALID");var o=(e={},v()(e,u.CREATE,"create"),v()(e,u.UPDATE,"update"),e);return a.reduce((function(e,a){var i=o[r[a].action.value];if("update"===i){var c=n.find((function(e){return e.group.ID===a})).contacts,u=(r[a].group||{}).value,l=(u=void 0===u?{}:u).value,d=void 0===l?a:l;e[i].push(t.contact.attach([d],c,{noEvent:!0,isSilent:!0}))}if("create"===i){var p=n.find((function(e){return e.group.ID===a})).contacts;e[i].push((function(){return t.save({Name:r[a].name,Color:s.nb[_d()(0,s.nb.length-1)],ContactIDs:k()(p,"ID")},!0,!0)}))}return e}),{update:[],create:[]})}var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.length&&a.success(l.addSuccess(e.length)),t.length&&a.success(l.updateSuccess(t.length));var n=Lo()(k()(e,"errorsMsg").filter(Boolean));n.length&&a.error(n.join("<br>"))},g=function(e){return function(){var t=c()(o.a.mark((function t(r){var a,i,c,s,u,l,d,p,v,g,h;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=f(e,r),i=a.update,c=a.create,s=[],u=!0,l=!1,d=void 0,t.prev=5,p=c[Symbol.iterator]();case 7:if(u=(v=p.next()).done){t.next=17;break}return g=v.value,t.t0=s,t.next=12,g();case 12:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 14:u=!0,t.next=7;break;case 17:t.next=23;break;case 19:t.prev=19,t.t2=t.catch(5),l=!0,d=t.t2;case 23:t.prev=23,t.prev=24,u||null==p.return||p.return();case 26:if(t.prev=26,!l){t.next=29;break}throw d;case 29:return t.finish(26);case 30:return t.finish(23);case 31:return t.next=33,Promise.all(i);case 33:return h=t.sent,t.next=36,n.call();case 36:return m(s,h),t.abrupt("return",{created:s,updated:h});case 38:case"end":return t.stop()}}),t,null,[[5,19,23,31],[24,,26,30]])})));return function(e){return t.apply(this,arguments)}}()};function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=p(e,t);return{list:function(){return n},run:g(n),getFlag:function(e){return u[e]}}}return h.getOptions=function(){return d},h}ik.$inject=["contactGroupModel","manageContactGroup","eventManager","gettextCatalog","notification","translator"];var ck=ik;function sk(e,t,r,a){return{scope:{email:"=model",form:"=form"},replace:!0,templateUrl:n("eFEk"),compile:t({link:function(t,n,o){var i=o.awesomplete,c=o.attr,s=r(["autocompleteEmail"]).dispatcher,u=e([],{mode:"contactGroup"}),l=function(e){var n=e.isRequired||e.doesNotExist;t.$applyAsync((function(){t.email=e,t.form.$invalid=n,t.form.$valid=!n}))},d=function(e){var t=e.target,n=u.filterContact(t.value),r=n.list;n.hasAutocompletion&&(i.list=r);var o=t.value||"";if(!o)return l({isRequired:!0});(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!(!e.length||!a.readName(e))})(o)||l({isRequired:!1,doesNotExist:!0})},p=function(e){var t=e.target;if(i.minChars=1,"INPUT"===t.nodeName&&!t.value){i.minChars=0;var n=u.filterContact(t.value),r=n.list;n.hasAutocompletion&&(i.list=r)}},f=function(){c.eventType&&t.$applyAsync((function(){var e,n;e="input.blur",n={value:t.email,type:c.eventType,eventData:c.eventData},s.autocompleteEmail(e,n)}))};i.replace=l,i.filter=function(e,t){return Awesomplete.FILTER_CONTAINS(e,u.formatInput(t))},n.on("click",p),n.on("input",d),n.find("input").on("blur",f),t.$on("$destroy",(function(){n.off("click",p),n.off("input",d),n.off("blur",f),u.clear()}))}},{data:function(e){return{label:e.label,value:{value:e.value,data:{ContactID:e.ContactID}}}}})}}sk.$inject=["autocompleteEmailsModel","autocompleteBuilder","dispatchers","contactGroupModel"];var uk=sk;function lk(e){return{require:"ngModel",link:function(t,n,r,a){"contactGroup"===r.contactGroupNameValidator&&(a.$validators.duplicateGroup=function(t){return!t||!e.readName(t)})}}}lk.$inject=["contactGroupModel"];var dk=lk;var pk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[{regex:/^--(\d{2})-?(\d{2})$/,cb:function(e){var t=G()(e,3);return{month:t[1],day:t[2]}}},{regex:/^--(\d{2})$/,cb:function(e){return{month:G()(e,2)[1]}}},{regex:/^---(\d{2})$/,cb:function(e){return{day:G()(e,2)[1]}}},{regex:/^(\d{4})-?(\d{2})$/,cb:function(e){var t=G()(e,3);return{year:t[1],month:t[2]}}},{regex:/^(\d{4})$/,cb:function(e){return{year:G()(e,2)[1]}}},{regex:/^(\d{4})(\d{2})(\d{2})$/,cb:function(e){var t=G()(e,4);return{year:t[1],month:t[2],day:t[3]}}},{regex:/^(\d{4})-(\d{2})-(\d{2})$/,cb:function(e){var t=G()(e,4);return{year:t[1],month:t[2],day:t[3]}}}],n=le()(t,(function(t){return t.regex.test(e)}))||{},r=n.regex,a=n.cb;if(r)return a(e.match(r))},fk={n:!0,bday:!0,anniversary:!0,gender:!0,prodid:!0,rev:!0,uid:!0},vk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return fk[e.toLowerCase()]};function mk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}hk.$inject=["notification","sanitize"];var gk=s.w.CLEAR_TEXT;function hk(e,t){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!e.length||s.sc.includes(e.toLowerCase())}function r(){var e=Jb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wa.a);return bt()(e,(function(e,n){var r=n.getType(),o=r&&(Array.isArray(r)?r.map((function(e){return a(e)})).filter((function(e){return e})):a(r)),i=n.getField(),c=n.valueOf(),s=n.getParams();return delete s.type,o&&o.length&&(s.type=o),e.add(i,function(e,n,r){var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.match(/_\$!<(.*)>!\$_/);if(Array.isArray(r))return r[1];if("bday"===t&&"1604"===n.xAppleOmitYear){var a=pk(e)||{},o=a.month,i=a.day;return o&&i?(delete n.xAppleOmitYear,"--".concat(o,"-").concat(i)):e}if("org"===t)return e.split(";").map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.trim()})).filter(Boolean).join(", ");return e}(e,n,r);return t.input(t.toTagUnicode(a))}(c,i,s),s),e}),new wa.a)}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"x-INTERNET"===e?"":n(e)?e:"fn"===e||"x-fn"===e?"":e.toLowerCase().startsWith("x")?e:"x-".concat(e)}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wa.a,t=Fm()(Jb(e),(function(e){return e.getGroup()||"nogroup"}));return bt()(Object.keys(t),(function(e,n){var r=t[n];if("nogroup"===n||1===r.length)return We()(r,(function(t){return e.addProperty(t)})),e;var a=le()(r,(function(e){return"x-ablabel"===e.getField().toLowerCase()}));if(a){var o=le()(r,(function(e){return"x-ablabel"!==e.getField().toLowerCase()})),i=o.getField(),c=o.valueOf(),s=o.getParams()||{},u=a.valueOf();return s.type=u,e.add(i,c,s),e}return We()(r,(function(t){return e.addProperty(t)})),e}),new wa.a)}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new wa.a;return We()(e,(function(e){return t.addProperty(e)})),t}return{from:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{return wa.a.parse(t).map((function(e){return r(o(e))}))}catch(n){e.error(n)}},to:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return bt()(e,(function(e,t){return e+r(t).toString(s.tc)+"\r\n"}),"")},merge:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==e.length){if(1===e.length)return e[0];var n=new wa.a,r=cS(e,{unicityGroup:t});return We()(Object.keys(r),(function(e){if(vk(e))return i([r[e][0]],n);i(Wb(r[e]),n)})),n}},build:i,isValidType:n,updateClearText:function(e,t){var n=e.Cards,r=(void 0===n?[]:n).find((function(e){return e.Type===gk}));if(r){var a=(new wa.a).parse(r.Data),o=t.types.includes(gk)?t.types:[].concat(we()(t.types),[gk]);return Object.keys(t.vCard.data).forEach((function(e){if(!a.data[e]){var n=t.vCard.data[e];Array.isArray(n)?i(n,a):a.addProperty(n)}})),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mk(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mk(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{types:o,vCard:a})}}}}var bk=hk,yk=s.w.CLEAR_TEXT,Ek=s.w.ENCRYPTED_AND_SIGNED,Sk=s.w.ENCRYPTED,Dk=s.w.SIGNED,kk=Da.b.TYPE3_CONTACT_VERIFICATION,Ak=Da.b.TYPE3_CONTACT_DECRYPTION,Ik=Da.b.TYPE2_CONTACT_VERIFICATION,Ck=Da.b.TYPE1_CONTACT;var wk=function(){return function(e){var t,n,r=e.cards,a=void 0===r?[]:r,i=e.privateKeys,u=void 0===i?[]:i,l=e.publicKeys,d=void 0===l?[]:l,p=function(e){return function(t,n){return{type:e,data:t,error:n}}},f=(t={},v()(t,Ek,(n=p(Ek),function(){var e=c()(o.a.mark((function e(t){var r,a,i,c,l,p,f,v,m,g,h,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.Data,a=void 0===r?"":r,i=t.Signature,c=void 0===i?"":i,e.prev=1,e.next=4,Promise.all([Object(Ve.e)(a),Object(Ve.f)(c)]);case 4:return l=e.sent,p=G()(l,2),f=p[0],v=p[1],e.next=10,Object(st.b)({message:f,privateKeys:u,publicKeys:d,armor:!0,signature:v});case 10:if(m=e.sent,g=m.data,h=m.verified,b=g.replace(/TEL;TYPE=:/,"TEL:"),1===h){e.next=16;break}return e.abrupt("return",n(b,kk));case 16:return e.abrupt("return",n(b));case 19:return e.prev=19,e.t0=e.catch(1),e.abrupt("return",n((new wa.a).toString(s.tc),Ak));case 22:case"end":return e.stop()}}),e,null,[[1,19]])})));return function(t){return e.apply(this,arguments)}}())),v()(t,Dk,function(e){return function(){var t=c()(o.a.mark((function t(n){var r,a,i,c,u,l;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.Data,a=void 0===r?"":r,i=n.Signature,c=void 0===i?"":i,t.prev=1,t.next=4,Object(Ve.f)(c);case 4:return u=t.sent,t.next=7,Object(Ve.j)({message:Object(Ve.b)(a),publicKeys:d,signature:u});case 7:if(l=t.sent,1===l.verified){t.next=11;break}return t.abrupt("return",e(a,Ik));case 11:return t.abrupt("return",e(a));case 14:return t.prev=14,t.t0=t.catch(1),t.abrupt("return",e((new wa.a).toString(s.tc),Ik));case 17:case"end":return t.stop()}}),t,null,[[1,14]])})));return function(e){return t.apply(this,arguments)}}()}(p(Dk))),v()(t,Sk,function(e){return function(){var t=c()(o.a.mark((function t(n){var r,a,i,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.Data,a=void 0===r?"":r,t.prev=1,t.next=4,Object(Ve.e)(a);case 4:return i=t.sent,t.next=7,Object(st.b)({message:i,privateKeys:u,armor:!0});case 7:return c=t.sent,t.abrupt("return",e(c));case 11:return t.prev=11,t.t0=t.catch(1),t.abrupt("return",e((new wa.a).toString(s.tc),Ck));case 14:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()}(p(Sk))),v()(t,yk,function(e){return function(t){var n=t.Data;return e(void 0===n?"":n)}}(p(yk))),t),m=a.map((function(e){return f[e.Type](e)}));return Promise.all(m)}};function Ok(e){return e({controllerAs:"ctrl",templateUrl:n("hb0j"),controller:["params",function(e){var t=this;this.list=e.list,this.checkAll=!1,this.onSelectAll=function(){t.list.forEach((function(e){e.selected=t.checkAll}))},this.submit=function(){e.submit(t.list.filter((function(e){return e.selected})))}}]})}Ok.$inject=["pmModal"];var Mk=Ok;function Pk(e){return e({controllerAs:"ctrl",templateUrl:n("rlSM"),controller:["params",function(e){var t=this;this.contacts=e.contacts.reduce((function(e,t){return 1===t.Emails.length&&(t.Emails[0].isSelected=!0,e.push(t)),t.Emails.length>1&&e.push(t),e}),[]),this.submit=function(){var n=t.contacts.reduce((function(e,t){var n=t.Emails,r=(void 0===n?[]:n).filter((function(e){return e.isSelected}));return e.push.apply(e,we()(r)),e}),[]);e.submit({attach:{label:e.label,emails:n}})}}]})}Pk.$inject=["pmModal"];var xk=Pk;function Tk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tk(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tk(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}$k.$inject=["attachGroupContactEmailsModal","manageContactGroup","contactEmails","contactCache","gettextCatalog","notification"];var jk,Nk=(jk="moveContactGroupHandler",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"[".concat(jk,"] ").concat(t.join("\n"))});function $k(e,t,n,r,a,i){var s={noEmailsToAdd:function(e){return a.getPlural(e,"No emails for this contact","No emails for these contacts",{total:e},"Info")},NO_CONTACT_SELECTED:a.getString("No contact selected",null,"Error"),NO_GROUP_SELECTED:a.getString("No contact group selected",null,"Error")},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){var n=t.LabelIDs;return(void 0===n?[]:n).forEach((function(t){return e[t]?e[t]++:e[t]=1})),e}),Object.create(null))},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.email,o=void 0===a?{}:a,i=t.contact,c=void 0===i?{}:i;return"email"===e?[n.findByEmailVcard(o,c.ID)].filter(Boolean):r.get("selected")},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.selection,r=j()(t,["selection"]),a=l(e,r);return{selected:n||a,map:u(n||a)}};return{getEnv:d,manage:function(n,r,a){if(!["contact","email"].includes(r))throw new Error(Nk("Wrong type: ".concat(r),"Expected value: contact or email"));function u(){return(u=c()(o.a.mark((function c(){var u,l,p,f,v,m,g,h,b,y,E=arguments;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(u=E.length>0&&void 0!==E[0]?E[0]:[],l=E.length>1?E[1]:void 0,p="addToContact"===n,f=d(r,Lk({selection:l},a)),v=f.map,m=f.selected,g=u.reduce((function(e,t){var n=t.Selected,r=t.ID;return v[r]&&!n&&null!==n&&e.unlabel.push(r),n&&e.label.push(r),e}),{unlabel:[],label:[]}),h=g.label,b=g.unlabel,m.length&&u.length){o.next=9;break}return!m.length&&i.error(s.NO_CONTACT_SELECTED),p&&!u.length&&i.error(s.NO_GROUP_SELECTED),o.abrupt("return",{});case 9:if(!p||h.length){o.next=12;break}return i.error(s.NO_GROUP_SELECTED),o.abrupt("return",{});case 12:if(!p){o.next=20;break}if(!m.every((function(e){return!e.Emails.length}))){o.next=16;break}return i.error(s.noEmailsToAdd(m.length)),o.abrupt("return",{});case 16:if(1!==m.length||1!==m[0].Emails.length){o.next=19;break}return t.email.attach(h,m[0].Emails),o.abrupt("return",{mode:"submit"});case 19:return o.abrupt("return",new Promise((function(n){e.activate({params:{label:h,unlabel:b,contacts:m,hookClose:function(e){return e&&n({isContactAdd:p,mode:e})},submit:function(r){var a=r.attach;t.email.attach(a.label,a.emails),e.deactivate(),n({isContactAdd:p,mode:"submit"})}}})})));case 20:return(y=t[r||"contact"]).attach(h,m),y.detach(b,m),o.abrupt("return",{mode:"submit"});case 24:case"end":return o.stop()}}),c)})))).apply(this,arguments)}return function(){return u.apply(this,arguments)}}}}var Rk=$k,_k=angular.module("proton.contact",["vs-repeat"]).factory("moveContactGroupHandler",Rk).factory("attachGroupContactEmailsModal",xk).factory("removeContactListModal",Mk).factory("extractCards",wk).directive("contactGroupNameValidator",dk).directive("autocompleteContactGroup",uk).factory("importContactGroups",ck).directive("advancedSettingsBtn",jD).directive("contactGroupsOverview",ok).factory("manageContactGroup",rk).directive("actionContactGroup",ZD).directive("manageContactGroupLink",JD).factory("manageContactGroupModal",WD).factory("contactGroupModel",HD).directive("autocompleteContacts",KD).factory("contactGroupModal",FD).directive("dropdownGroups",_D).directive("contactGroupsDropdown",$D).directive("importCardDropzone",QS).run(["contactEditor","contactMerger",function(e,t){e.init(),t.init()}]).factory("contactPgpModel",PD).directive("contactSchemeSelector",AD).directive("contactSignToggle",ED).directive("contactEncryptToggle",bD).factory("contactEncryptionModel",gD).directive("contactMimetypeSelector",fD).factory("contactEncryptionSettings",uD).directive("contactActionHeader",cD).filter("contactViewType",oD).directive("contactViewItem",rD).directive("contactViewDetail",nD).directive("contactAddressInput",Bb).directive("contactPhotoRow",Gb).directive("contactClear",Vb).directive("contactDisplay",cy).directive("contactDetails",ry).directive("contactEncrypted",Ey).directive("contactError",Dy).directive("contactItem",Cy).directive("contactKeyPinning",Oy).directive("contactArrowsSort",Py).directive("contactList",Ty).directive("contactNoResult",jy).directive("contactPgp",$y).directive("contactPlaceholder",_y).directive("contactMerger",HE).directive("contactPublicKeys",Fy).directive("contactPublicKeyTable",By).directive("contactPublicKeyLabel",Gy).directive("contactToolbar",qy).directive("contactView",zy).directive("contactRightPanel",eE).directive("contactPhotoForm",by).directive("contactSelectorForm",gy).factory("Contact",Fb).factory("contactCache",aE).factory("contactDetailsModel",lE).factory("contactDisplayModal",uy).factory("contactPhotoModal",dy).factory("contactSelectorModal",fy).factory("contactDownloader",pE).factory("contactEditor",gE).factory("contactEmails",AE).factory("contactImporter",UE).factory("contactImportEncryption",BE).factory("contactKey",GE).factory("contactMerger",JE).factory("contactProgressReporter",qE).factory("contactSchema",ZE).factory("contactTransformLabel",gS).factory("contactUI",yS).factory("contactEncryption",pS).factory("contactEncryptionSaver",vS).factory("contactSelectorModel",kS).factory("contactSpam",MS).factory("contactKeyAssigner",tS).factory("contactKeyManager",aS).factory("contactEncryptionAddressMap",dD).filter("contact",xS).filter("spam",TS).factory("contactAskEncryptionModal",jS).factory("contactBeforeToLeaveModal",_S).factory("contactEncryptionModal",FS).factory("contactLoaderModal",VS).factory("contactMergerModal",HS).factory("contactModal",YS).factory("vcard",bk).factory("importContactModal",XS).name;function Uk(e,t,r){return{scope:{isVisible:"="},replace:!0,templateUrl:n("He9t"),compile:e({link:function(e,n,a){var o=a.awesomplete,i={};o.minChars=0;var c=function(){return Object.keys(i).forEach((function(e){return i[e]=null}))},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.all();o.list=e,o.open(),o.evaluate()},u=function(){return e.$applyAsync((function(){return e.mode={value:i.value}}))},l=function(){e.$applyAsync((function(){e.isVisible=!1,r.set("commandPalette",!1)}))},d=function(t){e.$applyAsync((function(){e.value="",_rAF((function(){return s(t),o.input.value=""}))}))};e.$watch("isVisible",(function(e){e&&(s(),_rAF((function(){return o.goto(0)})))}));var p=function(e){var n=e.target,r=t.filter(n.value,i.value),a=r.list;r.hasAutocompletion&&(o.list=a)},f=function(t){var n=t.keyCode,r=27===n,a=t.shiftKey&&32===n;return e.isVisible&&8===n&&/^(labels|folders)$/.test(i.value||"")?(c(),d(),u()):(a||r)&&e.isVisible?i.value?(c(),d(),u()):(d(),l()):void 0};o.replace=function(e){var n=e.value,r=e.label;if(i.key=(le()(o._list,{value:n,label:r})||{}).key,/^(add|remove)\.(label|folder)$/.test(n)){var a=n.split("."),s=G()(a,2),p=s[0],f=void 0===p?"":p,v=s[1],m=void 0===v?"":v;return i.value="".concat(m,"s"),i.type=f,d(t.all(i.value)),u()}t.trigger(n,i),c(),l(),d(),u()},n.on("input",p),n.on("keydown",f),e.$on("$destroy",(function(){n.off("keydown",f),n.off("input",p),t.reset()}))}})}}Uk.$inject=["autocompleteBuilder","autocompleteCommandModel","AppModel"];var Fk=Uk;function Bk(e,t){return{replace:!0,scope:{},templateUrl:n("QxbR"),link:function(n,r){var a,o=function(){n.$applyAsync((function(){n.isVisible=!1,e.set("commandPalette",!1)}))},i=t(),c=i.on,s=i.unsubscribe;c("hotkeys",(function(t,i){var c=i.type;"escape"===c&&o(),"commandPalette"===c&&n.$applyAsync((function(){n.isVisible=!n.isVisible,e.set("commandPalette",n.isVisible),_rAF((function(){a||(a=r.find("input")),a.focus()}))}))})),r.on("reset",o),n.$on("$destroy",(function(){s(),r.off("reset",o)}))}}}Bk.$inject=["AppModel","dispatchers"];var Kk=Bk,Gk=n("eDNR"),Vk=n.n(Gk);function qk(e,t,n,r,a,o){var i=[],c=o((function(){return{"Add folder":r.getString("Add folder",null,"Command palette action"),"Add label":r.getString("Add label",null,"Command palette action"),"Remove label":r.getString("Remove label",null,"Command palette action")}})),u=n(["app.commands"]).dispatcher,l=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((function(e){return!!e.description})).reduce((function(e,t){var n=t.keyboard,r=t.description,a=t.callback;return e.coll.push({label:r,value:n,key:"hotkey"}),e.map["hotkey-".concat(n)]=a,e}),{coll:[],map:Object.create(null)}),t=e.coll,n=e.map,r=["folder","label"].reduce((function(e,t){return e.push(f("add",t)),"label"===t&&e.push(f("remove",t)),e}),[]),a=t.concat(r);return{map:n,list:a}}(e.keys()),d=function(){return i.length=0},p={messageActions:["CREATE_REPLY","CREATE_REPLY_ALL","FORWARD_MSG"].map(e.translations)};function f(e,t){return{label:c["".concat(Object(Ot.h)(e)," ").concat(t)],value:"".concat(e,".").concat(t),key:"action"}}var v=function(e){return!!a.id||-1===p.messageActions.indexOf(e.label)},m=function(e){return"labels"===e||"folders"===e?i:l.list};return{all:function(e){return"labels"===e||"folders"===e?angular.copy(i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"labels";return t.get(e).map((function(t){var n=t.ID;return{label:t.Name,value:n,key:e}}))}(e)):angular.copy(l.list).filter(v)},filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=e.trim(),r=n.toLowerCase(),a=Be()(Ue()(v),Ue()((function(e){return e.label.toLowerCase().includes(r)})),Vk()(s.f))(m(t));return{list:a,hasAutocompletion:!!a.length}},trigger:function(e,n){var r=n.type,a=n.value;if(!r)return l.map["hotkey-".concat(e)]();u["app.commands"]("".concat(r,".").concat(a),function(e,n,r){if(/labels|folders/.test(n)){var a=t.read(r);return{ID:r,list:[(a.Selected="add"===e,a)]}}}(r,a,e)),d()},reset:d}}qk.$inject=["hotkeys","labelsModel","dispatchers","gettextCatalog","$stateParams","translator"];var Hk=qk,zk=angular.module("proton.command",[]).directive("autocompleteCommand",Fk).directive("commandPalette",Kk).factory("autocompleteCommandModel",Hk).name;function Yk(e,t,r){var a=r((function(){return{info:e.getString("This feature is only available for paid users.",null,"Info")}})),o=function(){return t.info(a.info)};return{replace:!0,restrict:"E",scope:{},templateUrl:n("pLkr"),link:function(e,t){var n=t.find(".bridgeFreePanel-btn");n.on("click",o),e.$on("$destroy",(function(){n.off("click",o)}))}}}Yk.$inject=["gettextCatalog","notification","translator"];var Wk=Yk;var Xk=function(){return{replace:!0,restrict:"E",scope:{},templateUrl:n("Mtym")}};function Jk(e){return{replace:!0,restrict:"E",scope:{},templateUrl:n("uBoJ"),link:function(t){t.isFree=e().isFree}}}Jk.$inject=["userType"];var Qk=Jk,Zk=angular.module("proton.bridge",[]).directive("bridgeFreePanel",Wk).directive("bridgePaidPanel",Xk).directive("bridgeView",Qk).name;function eA(e,t,n,r){var a=r((function(){return{activate:function(t){return e.getString("Activate {{email}}",{email:t},"Action")}}})),o=function(){return t.activate()};return{replace:!0,restrict:"E",template:'<button class="pmMeBtn-container" type="button"></button>',link:function(e,t){t[0].textContent=a.activate(n.email()),t.on("click",o),e.$on("$destroy",(function(){t.off("click",o)}))}}}eA.$inject=["gettextCatalog","pmMeModel","premiumDomainModel","translator"];var tA=eA;function nA(e,t,r,a){return{replace:!0,restrict:"E",scope:{},templateUrl:n("JsPb"),link:function(n){var o=e(),i=o.on,c=o.unsubscribe;n.email=a.email(),n.hasPmMe=t.hasPmMe(),n.hasPaidMail=r.hasPaidMail(),i("addressesModel",(function(e,r){var a=r.type;"addresses.updated"===(void 0===a?"":a)&&n.$applyAsync((function(){n.hasPmMe=t.hasPmMe()}))})),n.$on("$destroy",c)}}}nA.$inject=["dispatchers","addressesModel","authentication","premiumDomainModel"];var rA=nA;function aA(e,t,n,r,a,i,s,u,l,d){var p=d((function(){return{info:a.getString("Set a display name and signature for {{email}}",{email:l.email()},"Info to setup @pm.me address"),paid:function(){return a.getString("You can now send and receive email from your new {{email}} address!",{email:l.email()},"Success notification for paid user after @pm.me generation")},free:function(){return a.getString("You can now receive email to your new {{email}} address! To send from it, please upgrade to a paid ProtonMail plan",{email:l.email()},"Success notification for free user after @pm.me generation")}}})),f=function(e){r.activate({params:{info:p.info,submit:function(t){r.deactivate(),e(t)},cancel:function(){r.deactivate()}}})};return{activate:function(){var r=c()(o.a.mark((function r(){var a,c,l,d,v;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=n.hasPaidMail(),c=p[a?"paid":"free"](),l=function(t){var n=t.Password,r=t.DisplayName,a=t.Signature,o=u.unlock({Password:n}).then((function(){return e.setup({Domain:"pm.me",DisplayName:r,Signature:a})})).then(u.lock).then((function(){return s.success(c)}));i.track(o)},r.next=5,t(!1);case 5:if(d=r.sent,v=d.password,!a){r.next=10;break}return f((function(e){var t=e.DisplayName,n=e.Signature;l({Password:v,DisplayName:t,Signature:n})})),r.abrupt("return");case 10:l({Password:v});case 11:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}()}}aA.$inject=["addressModel","askPassword","authentication","setupAddressModal","gettextCatalog","networkActivityTracker","notification","User","premiumDomainModel","translator"];var oA=aA,iA=angular.module("proton.pmMe",[]).directive("pmMeBtn",tA).directive("pmMeView",rA).factory("pmMeModel",oA).name;function cA(e){var t="fa-angle-down",r="fa-angle-up",a="fa-times";return{replace:!0,templateUrl:n("xdW8"),link:function(n,o,i){var c=i.action,s=void 0===c?"show":c,u=e(["advancedSearch"]),l=u.on,d=u.unsubscribe,p=u.dispatcher,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.advancedSearch(e,t)},v=o[0].querySelector(".btnAdvancedSearch-icon-desktop"),m=!1;"close"===s&&(v.classList.remove(t),v.classList.add(a)),l("advancedSearch",(function(e,n){var a=n.type,o=n.data;if("open"===a&&"show"===s){var i=o.visible?r:t,c=o.visible?t:r;v.classList.remove(c),v.classList.add(i),m=o.visible}}));var g=function(){if("close"===s)return f("open",{visible:!1});f("open",{visible:m=!m})};o.on("click",g),n.$on("$destroy",(function(){o.off("click",g),d()}))}}}cA.$inject=["dispatchers"];var sA=cA;function uA(e,t,r,a,o,i){var c=i((function(){return{TITLE:o.getString("Search contacts",null,"Title")}}));return{replace:!0,restrict:"E",scope:{},templateUrl:n("PnKe"),link:function(n,o){var i=e(["contacts"]),s=i.on,u=i.unsubscribe,l=i.dispatcher,d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return l.contacts("searchingContact",{keyword:e})},p=o[0].querySelector(".searchInput");n.query=r.keyword||"";var f=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=e?"secured.contacts":t.$current.name;t.go(r,{page:1,keyword:n},{notify:e}).then((function(){return e?d():d(n)}))},v=function(){return f(!1,n.query)},m=function(){return f(!0)},g=er()(v,300),h=function(){return p.placeholder=(e=a.total())&&a.isHydrated()?"".concat(c.TITLE," (").concat(e,")"):c.TITLE;var e};s("contacts",(function(e,t){"contactsUpdated"===t.type&&h()})),o.on("submit",v),o.on("reset",m),o.on("input",g),h(),n.$on("$destroy",(function(){u(),o.off("submit",v),o.off("reset",m),o.off("input",g)}))}}}uA.$inject=["dispatchers","$state","$stateParams","contactCache","gettextCatalog","translator"];var lA=uA;function dA(e,t,r,a,o,i,c,s){var u=function(e){return e?new Date(1e3*e).toISOString():void 0},l=function(e){return e?new Date(1e3*e):void 0};return{scope:{},replace:!0,templateUrl:n("O25S"),compile:function(n){return n.find(".search-date").attr("placeholder",c.I18N.localizedDatePlaceholder),function(n,a){var c=e(["advancedSearch"]),d=c.on,p=c.unsubscribe,f=c.dispatcher,v=s.get().AutoWildcardSearch,m=o.getFolderList(),g=o.getAddresses(),h=a[0].querySelector(".search-form-fieldset-input");n.model={wildcard:Boolean(v),folder:m[0],address:g[0],attachments:"2"},n.query=i.generateSearchString(m);d("addresses.updated",(function(){n.addresses=o.getAddresses()})),d("hotkeys",(function(e,t){"slash"===t.type&&h.focus()})),d("$stateChangeSuccess",(function(){n.query=i.generateSearchString(m)})),d("advancedSearch",(function(e,t){var o=t.type,c=t.data;"open"===o&&(a[0].classList[c.visible?"add":"remove"]("searchForm-container-adv"),n.$applyAsync((function(){var e;e=Ge()({},i.extractParameters(n.query,m),r),n.addresses=g,n.folders=m,n.model.keyword=e.keyword,n.model.from=e.from,n.model.to=e.to,n.model.beginRaw=u(e.begin),n.model.begin=l(e.begin),n.model.endRaw=u(e.end),n.model.end=l(e.end),n.model.folder=le()(m,{value:e.label})||m[0],n.advancedSearch=c.visible})))})),d("labelsModel",(function(e,t){var n=t.type;"cache.update"!==n&&"cache.refresh"!==n||(m=o.getFolderList())}));var b=function(e,n){t.go(e,n),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f.advancedSearch(e,t)}("open",{visible:!1})},y=function(){var e=n.query,t=a[0].classList.contains("searchForm-container-adv"),r=i.extractParameters(e,m),c=o.build(n.model),s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"secured.".concat(e?"search":"inbox")}(e||c.keyword||t);return b(s,t?c:o.build(r))};a.on("submit",y),n.$on("$destroy",(function(){a.off("submit",y),p()}))}}}}dA.$inject=["dispatchers","$state","$stateParams","authentication","searchModel","searchValue","dateUtils","mailSettingsModel"];var pA=dA;function fA(e,t,n,r){var a=r((function(){return{info:t.getString("Do not require exact match",null,"Label"),learn:t.getString("Learn more",null,"Link")}}));return{restrict:"E",replace:!0,scope:{},template:'\n        <label class="wildcardCheckbox-container">\n            <custom-checkbox data-custom-ng-model="wildcard" data-custom-ng-change="onClick()"></custom-checkbox>\n            <span class="wildcardCheckbox-info">'.concat(a.info,'</span>\n            <a href="https://protonmail.com/support/knowledge-base/search/" target="_blank" class="wildcardCheckbox-link pm_button link">').concat(a.learn,"</a>\n        </label>\n        "),link:function(t){var r=e(["settings"]).dispatcher,a=n.get().AutoWildcardSearch;t.wildcard=Boolean(a),t.onClick=function(){return r.settings("autowildcard.update",{AutoWildcardSearch:t.wildcard?1:0})}}}}fA.$inject=["dispatchers","gettextCatalog","mailSettingsModel","translator"];var vA=fA;function mA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mA(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mA(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hA(e,t,n,r){var a=r((function(){return{ALL:t.getString("All",null,"Option for search panel"),FOLDER:{inbox:t.getString("Inbox",null,"Option for search panel"),spam:t.getString("Spam",null,"Option for search panel"),drafts:t.getString("Drafts",null,"Option for search panel"),starred:t.getString("Starred",null,"Option for search panel"),allDrafts:t.getString("Drafts",null,"Option for search panel"),sent:t.getString("Sent",null,"Option for search panel"),allSent:t.getString("Sent",null,"Option for search panel"),trash:t.getString("Trash",null,"Option for search panel"),archive:t.getString("Archive",null,"Option for search panel"),allmail:t.getString("All Mail",null,"Option for search panel")}}})),o=Object.keys(s.rb).reduce((function(e,t){if("search"!==t&&"label"!==t){var n=s.rb[t];e.push({value:n,label:a.FOLDER[t],group:"folder"})}return e}),[{value:-1,label:a.ALL,group:"default"}]),i=function(){return{address:void 0,page:void 0,filter:void 0,sort:void 0,label:void 0,from:void 0,to:void 0,subject:void 0,keyword:void 0,begin:void 0,end:void 0,attachments:void 0,wildcard:void 0,starred:void 0,reload:void 0}},c=function(e){if(e)return e instanceof Date?Math.abs(+e/1e3):Math.abs(+e)},u=function(e){if(null!==e&&angular.isDefined(e))return-1!==e.value?e.value:void 0},l=function(e){var t=e.begin,n=e.end;return t&&t===n?{begin:t,end:n+86399}:{begin:t,end:n}};return{getFolderList:function(){var e=k()(n.get(),(function(e){return{value:e.ID,label:e.Name,group:1===e.Exclusive?"folder":"label"}}));return o.concat(e)},getAddresses:function(){return[{Email:a.ALL,ID:void 0,Order:0,Receive:1,Status:1}].concat(e.get())},resetParameters:i,build:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=angular.copy(e),n=+t.attachments,r=+t.wildcard,a=l({begin:c(t.begin),end:c(t.end)});return gA({},{address:void 0,page:void 0,filter:void 0,sort:void 0,label:void 0,from:void 0,to:void 0,subject:void 0,keyword:void 0,begin:void 0,end:void 0,attachments:void 0,wildcard:void 0,starred:void 0,reload:void 0},{to:t.to,from:t.from,keyword:t.keyword,wildcard:isNaN(r)?void 0:r,attachments:isNaN(n)?void 0:n,address:(t.address||{}).ID,label:t.label||u(t.folder)},a)}}}hA.$inject=["addressesModel","gettextCatalog","labelsModel","translator"];var bA=hA;function yA(e,t,n,r,a,o){var i=o((function(){return{success:t.getString("Search parameter updated",null,"Success")}}));return(0,e().on)("settings",(function(e,t){var o,c,s=t.type,u=t.data;"autowildcard.update"===s&&(o=(void 0===u?{}:u).AutoWildcardSearch,c=a.updateAutowildcard({AutoWildcardSearch:o}).then((function(){return r.success(i.success)})),n.track(c))})),{init:angular.noop}}yA.$inject=["dispatchers","gettextCatalog","networkActivityTracker","notification","settingsMailApi","translator"];var EA=yA;function SA(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return moment(e).unix()},n=function(e){return moment.unix(e).format("YYYYMMDD")},r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(/(?: |^)(keyword|from|to|in|begin|end):/g);return!t[0]&&t.shift(),t};return{generateSearchString:function(t){var r="";if(angular.isDefined(e.label)){var a=le()(t,{value:e.label});angular.isDefined(a)&&(r+="in:".concat(a.label," "))}return angular.isDefined(e.keyword)?angular.isUndefined(e.from)&&angular.isUndefined(e.to)&&angular.isUndefined(e.label)?r+=e.keyword+" ":r+="keyword:".concat(e.keyword," "):angular.isDefined(e.label)&&(r+="keyword: "),angular.isDefined(e.from)&&(r+="from:".concat(e.from," ")),angular.isDefined(e.to)&&(r+="to:".concat(e.to," ")),angular.isDefined(e.begin)&&(r+="begin:".concat(n(e.begin)," ")),angular.isDefined(e.end)&&(r+="end:".concat(n(e.end)," ")),r.trim()},extractParameters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=r(e).reduce((function(e,t,n,r){var a=n%2,o=r[n-1];return 1===a&&t&&(e["in"===o?"label":o]=t),e}),{});if(a.label){var o=le()(n,{label:a.label});o&&(a.label=o.value),!o&&delete a.label}return a.end&&(a.end=t(a.end)),a.begin&&(a.begin=t(a.begin)),!Object.keys(a).length&&e.length>0&&(a.keyword=e),a}}}SA.$inject=["$stateParams"];var DA=SA,kA=angular.module("proton.search",[]).run(["wildcardModel",function(e){return e.init()}]).directive("btnAdvancedSearch",sA).directive("searchContact",lA).directive("searchForm",pA).directive("wildcardCheckbox",vA).factory("searchModel",bA).factory("wildcardModel",EA).factory("searchValue",DA).name;function AA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function IA(e,t,r,a){var i=a("limitTo");function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{logs:[],loaded:!0,total:0},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AA(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AA(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{perPage:20,currentPage:1,doLogging:e.get().LogAuth},n)}function u(){return l.apply(this,arguments)}function l(){return(l=c()(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.load();case 2:return n=e.sent,e.abrupt("return",{total:n.length,logs:Ia()(n,"Time").reverse(),loaded:!0});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d,p=function(e,t){var n=e.logs,r=e.perPage,a=e.currentPage;return i(n,r,t?0:(a-1)*r)};return{scope:{},replace:!0,restrict:"E",templateUrl:n("tWfZ"),link:(d=c()(o.a.mark((function e(n,a){var i,l,d,f,v,m,g,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r(["paginatorScope"]),l=i.dispatcher,d={},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s(),t=arguments.length>1?arguments[1]:void 0,r=t?ti()(d,["list","logs","loaded","currentPage"]):{};Object.assign(d,s(e,r)),n.$applyAsync((function(){n.model=d,n.model.list=p(d,!0)}))},e.t0=f,e.next=6,u();case 6:e.t1=e.sent,(0,e.t0)(e.t1),v=function(e){return c()(o.a.mark((function n(){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.setLogging(e);case 2:f({currentPage:d.currentPage},!0);case 3:case"end":return n.stop()}}),n)})))},m={download:t.download,disable:v("disable"),basic:v("basic"),advanced:v("advanced"),reload:function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,u();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),clear:function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.clear();case 2:"confirm"===e.sent&&f();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},g=function(e){d.currentPage=e,l.paginatorScope("logs",{page:e}),n.model.list=p(d)},n.changePage=g,h=function(e){var t=e.target.getAttribute("data-action");m[t]&&m[t](d)},a.on("click",h),n.$on("$destroy",(function(){a.off("click",h)}));case 15:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})}}IA.$inject=["userSettingsModel","logsModel","dispatchers","$filter"];var CA=IA;var wA=function(){return{scope:{model:"="},replace:!0,restrict:"E",templateUrl:n("1aFG")}};function OA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function MA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OA(n,!0).forEach((function(t){v()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OA(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function PA(e,t,n,r,a,o,i,c){var s={clear:{title:a.getString("Clear",null,"Title"),message:a.getString("Are you sure you want to clear all your logs?",null,"Info"),updated:a.getString("Logging preference updated",null,"Dashboard/security"),success:a.getString("Logs cleared",null,"Clear user's logs (security)")},logging:{success:a.getString("Logging preference updated",null,"Dashboard/security")}},u={disable:0,basic:1,advanced:2},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n){r.activate({params:MA({title:s.clear.title,message:s.clear.message},t,{confirm:function(){e((function(){return r.deactivate("confirm")}))},hookClose:n})})}))};return{load:function(){return e.track(t.get())},download:function(e){var t=e.logs,r=bt()(t,(function(e,t){var n=t.Event,r=t.Time,a=t.IP;return e.push("".concat(n,",").concat(moment(1e3*r),",").concat(a)),e}),[["Event","Time","IP"].join(",")]).join("\r\n"),a=new Blob([r],{type:"text/csv;charset=utf-8;"});n(a,"logs.csv")},clear:function(){return l((function(n){var r=t.clear().then((function(){c.success(s.clear.success)}));e.track(r),n()}))},setLogging:function(t){var n=u[t];if(0===n){return l((function(t){var r=o.setLogging({LogAuth:n}).then((function(){i.clear(),c.success(s.clear.updated),t()}));e.track(r)}))}var r=o.setLogging({LogAuth:n}).then((function(){c.success(s.logging.success)}));return e.track(r)}}}PA.$inject=["networkActivityTracker","Logs","downloadFile","confirmModal","gettextCatalog","settingsApi","activeSessionsModel","notification"];var xA=PA;angular.module("proton.security",[]).directive("sessionLogsTable",wA).directive("logManager",CA).factory("logsModel",xA);var TA=angular.module("proton.security").name;t.default=angular.module("protonLazy",["as.sortable","ngScrollbars","pikaday","ui.indeterminate",y,TA,Ed,Vh,kA,_k,Zk,iA,zk,sb,Tb,ku,nb,Uu,Sg,Ul,Qn,Se,Di,Pn,zm,Ic,Yd])}}]);
//# sourceMappingURL=appLazy.module.ead794a201.chunk.js.map