var Account=eg.Class({construct:function(options){this._oLoginInfoArea=new LoginInfoArea(options.loginInfo);this._oNicknameArea=new NicknameArea();this._oEmailArea=new EmailArea(options)}});var LoginInfoArea=eg.Class({construct:function(options){this._setVars(options);this._setEvent()},_setVars:function(options){this._ui={loginInfoArea:$("#loginInfoArea")};this._snsCode=options.snsCode;this._message=options.message},_setEvent:function(){this._ui.loginInfoArea.on("click","._btnShare",$.proxy(this._changeShare,this))},_changeShare:function(e){e.preventDefault();var btn=$(e.currentTarget);var bShare=!btn.hasClass("on");btn.toggleClass("on");$.ajax({url:"/settings/share",data:{share:bShare}}).then(function(res){if(res){btn.addClass("on")}else{btn.removeClass("on")}});var clickCode="";if(bShare){clickCode="mya.timelineon";if(btn.length){btn.attr("title",this._message.snsTimelineShare).attr("value",this._message.snsTimelineShare)}}else{clickCode="mya.timelineoff";if(btn.length){btn.attr("title",this._message.snsTimelineNotShare).attr("value",this._message.snsTimelineNotShare)}}clickcr(this,clickCode,"","",e,sNclkLanguageCode)}});var NicknameArea=eg.Class({construct:function(){this._setVars();this._setEvent()},_setVars:function(){this._htMessage=ghtMessage.nickname;var nicknameEditArea=$("#nicknameEditArea");this._ui={nicknameDefaultArea:$("#nicknameDefaultArea"),nicknameEditArea:nicknameEditArea,nicknamePlaceholder:nicknameEditArea.find("label.placeholder"),txtNickname:nicknameEditArea.find("#nickname"),checkButton:nicknameEditArea.find("._btnCheck"),saveButton:nicknameEditArea.find("._btnSave"),msgError:nicknameEditArea.find("._msgError"),msgAvailable:nicknameEditArea.find("._msgAvailable")};this._oWatchInput=new WatchInput(this._ui.txtNickname.get(0)).on("change",$.proxy(this._onInputNickname,this))},_setEvent:function(){this._ui.nicknameDefaultArea.on("click","._btnEdit",$.proxy(this._changeNicknameEditMode,this));this._ui.nicknameEditArea.on("click","._btnCheck",$.proxy(this._checkAvailable,this)).on("click","._btnSave",$.proxy(this._saveNickname,this))},_changeNicknameEditMode:function(e){e.preventDefault();this._ui.nicknameDefaultArea.hide();this._ui.nicknameEditArea.show();var sNickname=this._getInputNickname();this._ui.txtNickname.get(0).focus();this._ui.txtNickname.textrange("set",0,sNickname.length)},_onInputNickname:function(e){var sNickname=this._getInputNickname();this._ui.msgAvailable.hide();this._ui.checkButton.show();this._ui.saveButton.hide();if(!sNickname){this._showPlaceholder();this._disableCheckButton();this._ui.txtNickname.removeClass("error");this._hideErrorMessage()}else{this._hidePlaceholder();this._checkNicknameLength(sNickname)}},_checkAvailable:function(e){e.preventDefault();var sNickname=this._getInputNickname();if(this._checkNicknameLength(sNickname)==false){return false}$.ajax({url:"/account/validateNickname",data:{nickname:sNickname}}).then($.proxy(function(res){if(res.valid){this._ui.msgAvailable.show();this._ui.checkButton.hide();this._ui.saveButton.show()}else{this._showErrorMessage(res.code)}},this))},_saveNickname:function(e){e.preventDefault();var sNickname=this._getInputNickname();if(this._checkNicknameLength(sNickname)==false){return false}$.ajax({url:"/account/saveNickname",method:"POST",data:{nickname:sNickname}}).then($.proxy(function(res){if(res.result){location.reload()}else{this._showErrorMessage(res.reason)}},this))},_showPlaceholder:function(){this._ui.nicknamePlaceholder.show()},_hidePlaceholder:function(){this._ui.nicknamePlaceholder.hide()},_enableCheckButton:function(){this._ui.checkButton.attr("disabled",null)},_disableCheckButton:function(){this._ui.checkButton.attr("disabled","disabled")},_showErrorMessage:function(sCode){var sErrorMessage=this._htMessage[sCode];this._ui.msgError.text(sErrorMessage).show();this._ui.txtNickname.get(0).focus();this._ui.txtNickname.addClass("error")},_hideErrorMessage:function(){this._ui.msgError.text("").hide();this._ui.txtNickname.removeClass("error")},_getInputNickname:function(){var sNickname=this._ui.txtNickname.val();return Util.stripHTML(Util.stripScripts(Util.trim(sNickname)))},_checkNicknameLength:function(sNickname){sNickname=sNickname||"";var nNicknameLen=sNickname.length;if(nNicknameLen>20){this._showErrorMessage("LENGTH");this._disableCheckButton();return false}else{this._hideErrorMessage();this._enableCheckButton();return true}}});var EmailArea=eg.Class({construct:function(options){if(!$("#emailArea").length&&options.isEmailLogin==false){return}this._setVars(options);this._setEvent()},_setVars:function(options){this._isEmailLogin=options.isEmailLogin;this._isEmailPush=options.isEmailPush;this._ui={};if(this._isEmailLogin){this._ui.emailSettings=$("._emailSettings")}else{this._htMessage=ghtMessage.email;this._ui.emailArea=$("#emailArea");this._ui.emailDefaultArea=$("#emailDefaultArea");this._ui.emailEditArea=$("#emailEditArea");this._ui.emailSettings=this._ui.emailArea.find("._emailSettings");this._ui.emailPlaceholder=this._ui.emailArea.find("label.placeholder");this._ui.txtEmail=this._ui.emailEditArea.find("#email");this._ui.verifyButton=this._ui.emailEditArea.find("._btnVerify");this._ui.msgVerification=this._ui.emailEditArea.find("._msgVerification");this._oWatchInput=new WatchInput(this._ui.txtEmail.get(0)).on("change",$.proxy(this._onInputEmail,this))}this._bRequest=false},_setEvent:function(){if(this._isEmailLogin==false){this._ui.emailDefaultArea.on("click","._btnEdit",$.proxy(this._changeEmailEditMode,this));this._ui.emailEditArea.on("click","._btnVerify",$.proxy(this._verify,this))}if(this._ui.emailSettings.length){this._ui.emailSettings.on("click","input",$.proxy(this._changeEmailSetting,this))}},_changeEmailSetting:function(e){e.preventDefault();if(this._bRequest){return false}var buttonArea=$(e.target);if(buttonArea.hasClass("_emailSettings")==false){buttonArea=buttonArea.parents("._emailSettings")}var sEmail=buttonArea.data("email");if(!sEmail){return false}var btn=$(e.currentTarget);btn.toggleClass("on");var bUpdateSetButtonOn=buttonArea.find("._btnUpdateSet").hasClass("on");var bEventSetButtonOn=buttonArea.find("._btnEventSet").hasClass("on");var bCommentSetButtonOn=buttonArea.find("._btnCommentSet").hasClass("on");this._bRequest=true;$.ajax({url:"/account/modifyEmailAlarmSetting",data:{subscriptionAlarm:bUpdateSetButtonOn,eventAlarm:bEventSetButtonOn,commentAlarm:bCommentSetButtonOn}}).done($.proxy(function(res){if(!res.success){alert(res.message);return false}},this)).fail(function(){alert(Util.getErrorMessage("alert.error.unknown"))}).always($.proxy(function(){this._bRequest=false},this));var sClickCode=btn.data("click-code");if(btn.hasClass("on")){sClickCode+="on"}else{sClickCode+="off"}clickcr(this,sClickCode,"","",e,sNclkLanguageCode)},_changeEmailEditMode:function(e){e.preventDefault();this._ui.emailDefaultArea.hide();this._ui.emailEditArea.show();var sEmail=this._getInputEmail();this._ui.txtEmail.get(0).focus();this._ui.txtEmail.textrange("set",0,sEmail.length)},_onInputEmail:function(e){var sEmail=this._getInputEmail();if(!sEmail){this._showPlaceholder()}else{this._hidePlaceholder()}var bValidEmailFormat=Util.isEmail(sEmail);if(bValidEmailFormat){this._enableVerifyButton()}else{this._disableVerifyButton()}},_verify:function(e){e.preventDefault();var sEmail=this._getInputEmail();var bValidEmailFormat=Util.isEmail(sEmail);if(bValidEmailFormat==false){this._disableVerifyButton();return false}var params={email:sEmail};if(this._isEmailPush){params.emailVerificationType="EMAIL_PUSH"}var self=this;$.ajax({url:"/member/sendEmailVerification",data:params}).then($.proxy(function(res){if(res){this._showMessage("SUCCESS")}else{this._showMessage("FAIL")}},this))},_showPlaceholder:function(){this._ui.emailPlaceholder.show()},_hidePlaceholder:function(){this._ui.emailPlaceholder.hide()},_enableVerifyButton:function(){this._ui.verifyButton.attr("disabled",null)},_disableVerifyButton:function(){this._ui.verifyButton.attr("disabled","disabled")},_showMessage:function(sCode){var sMessage=this._htMessage[sCode];this._ui.msgVerification.html(sMessage).show()},_getInputEmail:function(){var sEmail=this._ui.txtEmail.val();return Util.stripHTML(Util.stripScripts(Util.trim(sEmail)))}});
var Placeholder=new eg.Class({construct:function($el){this._setVar($el);this._setEvent();this._init()},_setVar:function($el){var $target=$el;this._ui={target:$target,inputs:$target.find("input[type=text]"),textAreas:$target.find("textarea"),placeholders:$target.find(".placeholder")}},_setEvent:function(){this._ui.inputs.on("keyup",$.proxy(this._checkPlaceholder,this));this._ui.textAreas.on("keyup",$.proxy(this._checkPlaceholder,this));this._ui.target.on("keyup",$.proxy(this._checkPlaceholder,this));this._ui.inputs.on("input",$.proxy(this._checkPlaceholder,this));this._ui.textAreas.on("input",$.proxy(this._checkPlaceholder,this));this._ui.target.on("input",$.proxy(this._checkPlaceholder,this));this._ui.placeholders.on("click",$.proxy(this._onClickPlaceholder,this))},_init:function(){this._ui.inputs.trigger("keyup");this._ui.textAreas.trigger("keyup");this._ui.target.trigger("keyup")},_checkPlaceholder:function(e){var target=$(e.currentTarget);var placeholder=target.prev();if(!placeholder.length){return}if(!placeholder.hasClass("placeholder")){return}if(target.val().length>0){placeholder.hide()}else{placeholder.show()}},_onClickPlaceholder:function(e){var input=$(e.currentTarget).next();if(input.length){input.focus()}}});
var PatreonApi={NUMBER_ID:"numberId",INVALID_URL:"invalidUrl",SUCCESS:"success",authorize:function(){Cookies.set("isCookieUsable","true",{domain:document.domain});if(navigator.cookieEnabled==false||Cookies.get("isCookieUsable")!="true"){alert(Util.getErrorMessage["alert.error.invalid_input"]);return}$.ajax({type:"GET",url:"/challenge/patreon/oauth/authorize",timeout:9000}).then($.proxy(function(res){if(!!res){var returnUrl=location.href;if(this._returnUrl!=undefined){returnUrl=this._returnUrl}var basicEncodeCookie=Cookies.withConverter({write:function(value){return encodeURIComponent(value)},read:function(value){return decodeURIComponent(value)}});basicEncodeCookie.set("returnUrl",returnUrl,{domain:"webtoons.com"});location.href=res}},this)).fail(function(){alert(Util.getErrorMessage["alert.error.unknown"])})},remove:function(){return $.ajax({url:"/challenge/author/removePatreonInfo",method:"POST"})},update:function(usePatronage){return $.ajax({url:"/challenge/author/setPatronageOnOff",data:{usePatronage:usePatronage}})},load:function(patreonId){return $.ajax({url:"/challenge/author/getPatreonInfo",data:{userId:patreonId}})},checkVanity:function(){if(location.hash.indexOf("invalid_patreon_vanity")>0){if(confirm("You do not have a Patreon URL.\nPlease go to your Patreon profile settings and register a username in the Patreon URL section.")){window.open("https://www.patreon.com")}location.hash=""}},};
var PatreonErrorPopup={message:{numberId:'Your Patreon vanity URL contains at least one alphabet. Please check your vanity URL on <a href="https://www.patreon.com/settings/profile" target="_blank" class="lk_patron">patreon.com</a>',invalidUrl:"We couldn't find this vanity URL. Are you sure this is the same one you've entered on patreon.com?",serverError:"We are unable to get a response from server. Please try again in few minutes."},_layer:null,_patreonErrorMessage:null,open:function(message){this._init();if(message){this._patreonErrorMessage.html(message)}this._layer.addClass("on")},_init:function(){if(this._layer==null){var layer=$("#patreonErrorLayer");this._patreonErrorMessage=$("#patreonErrorMessage");this._layer=layer;layer.find("#patreonLayerBtnErrorClose").on("click",function(e){e.preventDefault();layer.removeClass("on")})}}};
var Patreon=eg.Class({construct:function(option){this._setVars(option);this._setEvent()},_setVars:function(option){this._editMode=(option&&option.editMode)?option.editMode:false;this.body=$("body");this._patreonUrl=$("._patreonUrl");this._patreonLoadingImg=$("#patronLoading");this._patreonCountArea=$("#patronCountArea");this._patronAmountArea=$("#patronAmountArea");this._patronCountArea=$("#patronCount");this._patronAmountArea=$("#patronAmount");this._patreonErrorArea=$("#patronErrorArea");this._btnPatreonInfo=$("#btnPatreonInfo");if(this._editMode){this._message=option.message;this._patreonArea=$("#patreonArea");this._btnPatreonRegister=$("#btnPatreonRegister");this._btnPatreonRemove=$("#btnPatreonRemove");this._btnPatronageOnOff=$("#btnPatronageOnOff");this._layerPatreonRemoveConfirm=$("#patreonLayerRemoveConfirm");this._layerPatreonBtnRemove=$("#patreonLayerRemoveConfirm");this._layerPatreonBtnCancle=$("#patreonLayerBtnCancel");this._layerPatreonInfo=$("#patreonLayerInfo");this._layerPatreonDimmed=$("#patreonLayerDimmed");this._patreonLayerBtnInfoClose=$("#patreonLayerBtnInfoClose");this._patreonSwitchInfoLayer=$("#patreonLayerSwitchInfo");this._patreonSwitchInfo=$("#patreonSwitchInfo");this._patreonSwitchInfoLayerBtnClose=$("#patreonSwitchInfoBtnClose");new Placeholder(this._patreonArea)}},_setEvent:function(){this._btnPatreonInfo.on("click",$.proxy(this._openInfoLayer,this));if(this._editMode){this._patreonLayerBtnInfoClose.on("click",$.proxy(this._closeInfoLayer,this));this._btnPatreonRegister.on("click",$.proxy(PatreonApi.authorize,this));this._btnPatreonRemove.on("click",$.proxy(this._openRemoveComfirmLayer,this));this._btnPatronageOnOff.on("click",$.proxy(this._togglePatronageOnOff,this));this._layerPatreonBtnRemove.on("click",$.proxy(this._removeId,this));this._layerPatreonBtnCancle.on("click",$.proxy(this._closeRemoveComfirmLayer,this));this._patreonSwitchInfo.on("click",$.proxy(this._openSwitchInfoLayer,this));this._patreonSwitchInfoLayerBtnClose.on("click",$.proxy(this._closeSwitchInfoLayer,this))}},_openLayer:function(layer){layer.addClass("on")},_closeLayer:function(layer){layer.removeClass("on")},_openSwitchInfoLayer:function(){this._openLayer(this._layerPatreonDimmed);this._openLayer(this._patreonSwitchInfoLayer);this.body.css("overflow","hidden");return false},_closeSwitchInfoLayer:function(){this._closeLayer(this._layerPatreonDimmed);this._closeLayer(this._patreonSwitchInfoLayer);this.body.css("overflow","");return false},_openInfoLayer:function(){this._openLayer(this._layerPatreonDimmed);this._openLayer(this._layerPatreonInfo);this.body.css("overflow","hidden");return false},_closeInfoLayer:function(){this._closeLayer(this._layerPatreonDimmed);this._closeLayer(this._layerPatreonInfo);this.body.css("overflow","");return false},_openRemoveComfirmLayer:function(e){e.preventDefault();this._openLayer(this._layerPatreonRemoveConfirm)},_closeRemoveComfirmLayer:function(event){this._closeLayer(this._layerPatreonRemoveConfirm);return false},_removeId:function(){PatreonApi.remove().then($.proxy(function(res){if(res.success==true){location.reload()}else{PatreonErrorPopup.open(PatreonErrorPopup.message.serverError)}},this)).fail($.proxy(function(){PatreonErrorPopup.open(PatreonErrorPopup.message.serverError)},this));return false},_togglePatronageOnOff:function(e){e.preventDefault();this._btnPatronageOnOff.toggleClass("on");var usePatronage=this._btnPatronageOnOff.hasClass("on");this._toggleNclicksOnOff(usePatronage);PatreonApi.update(usePatronage).fail($.proxy(function(){PatreonErrorPopup.open(PatreonErrorPopup.message.serverError);this._btnPatronageOnOff.toggleClass("on")},this))},_toggleNclicksOnOff:function(on){var beforeClassName=this._btnPatronageOnOff.attr("class");var className=null;if(on){className=beforeClassName.replace("NPI=a:patoff,","NPI=a:paton,")}else{className=beforeClassName.replace("NPI=a:paton,","NPI=a:patoff,")}this._btnPatronageOnOff.attr("class",className)},loadPatronageInfo:function(patreonId){PatreonApi.load(patreonId).then($.proxy(this._onLoadPatreonApi,this)).fail($.proxy(this._onErrorPatreonApi,this))},_onLoadPatreonApi:function(res){if(res){this._patreonLoadingImg.hide();this._patreonCountArea.show();this._patronAmountArea.show();this._patreonUrl.text(res.homeUrl.substr(12));this._patronCountArea.text(Util.changeNumberFormat(res.patronCount)+" Patrons");this._patronAmountArea.text("$"+Util.changeNumberFormat(res.pledgeSum))}},_onErrorPatreonApi:function(){this._patreonLoadingImg.hide();this._patreonErrorArea.show()}});
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{if(typeof exports==="object"){factory(require("jquery"))}else{factory(jQuery)}}})(function($){var browserType,textrange={get:function(property){return _textrange[browserType].get.apply(this,[property])},set:function(start,length){var s=parseInt(start),l=parseInt(length),e;if(typeof start==="undefined"){s=0}else{if(start<0){s=this[0].value.length+s}}if(typeof length!=="undefined"){if(length>=0){e=s+l}else{e=this[0].value.length+l}}_textrange[browserType].set.apply(this,[s,e]);return this},setcursor:function(position){return this.textrange("set",position,0)},replace:function(text){_textrange[browserType].replace.apply(this,[String(text)]);return this},insert:function(text){return this.textrange("replace",text)}},_textrange={xul:{get:function(property){var props={position:this[0].selectionStart,start:this[0].selectionStart,end:this[0].selectionEnd,length:this[0].selectionEnd-this[0].selectionStart,text:this.val().substring(this[0].selectionStart,this[0].selectionEnd)};return typeof property==="undefined"?props:props[property]},set:function(start,end){if(typeof end==="undefined"){end=this[0].value.length}this[0].selectionStart=start;this[0].selectionEnd=end},replace:function(text){var start=this[0].selectionStart;var end=this[0].selectionEnd;var val=this.val();this.val(val.substring(0,start)+text+val.substring(end,val.length));this[0].selectionStart=start;this[0].selectionEnd=start+text.length}},msie:{get:function(property){var range=document.selection.createRange();if(typeof range==="undefined"){var props={position:0,start:0,end:this.val().length,length:this.val().length,text:this.val()};return typeof property==="undefined"?props:props[property]}var start=0;var end=0;var length=this[0].value.length;var lfValue=this[0].value.replace(/\r\n/g,"\n");var rangeText=this[0].createTextRange();var rangeTextEnd=this[0].createTextRange();rangeText.moveToBookmark(range.getBookmark());rangeTextEnd.collapse(false);if(rangeText.compareEndPoints("StartToEnd",rangeTextEnd)===-1){start=-rangeText.moveStart("character",-length);start+=lfValue.slice(0,start).split("\n").length-1;if(rangeText.compareEndPoints("EndToEnd",rangeTextEnd)===-1){end=-rangeText.moveEnd("character",-length);end+=lfValue.slice(0,end).split("\n").length-1}else{end=length}}else{start=length;end=length}var props={position:start,start:start,end:end,length:length,text:range.text};return typeof property==="undefined"?props:props[property]},set:function(start,end){var range=this[0].createTextRange();if(typeof range==="undefined"){return}if(typeof end==="undefined"){end=this[0].value.length}var ieStart=start-(this[0].value.slice(0,start).split("\r\n").length-1);var ieEnd=end-(this[0].value.slice(0,end).split("\r\n").length-1);range.collapse(true);range.moveEnd("character",ieEnd);range.moveStart("character",ieStart);range.select()},replace:function(text){document.selection.createRange().text=text}}};$.fn.extend({textrange:function(arg){var method="get";var options={};if(typeof this[0]==="undefined"){return this}if(typeof arg==="string"){method=arg}else{if(typeof arg==="object"){method=arg.method||method;options=arg}}if(typeof browserType==="undefined"){browserType="selectionStart" in this[0]?"xul":document.selection?"msie":"unknown"}if(browserType==="unknown"){return this}if(!options.nofocus&&document.activeElement!==this[0]){this[0].focus()}if(typeof textrange[method]==="function"){return textrange[method].apply(this,Array.prototype.slice.call(arguments,1))}else{$.error("Method "+method+" does not exist in jQuery.textrange")}}})});
