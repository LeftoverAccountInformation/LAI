(new R9.logger).time("combined");(function(c,e){c.createComponentClass("account.v2.views.account.AccountConnectionsSection",{editableElements:void 0,staticDisplayElement:void 0,emailFormElement:void 0,nameFormElement:void 0,nameFormFirstNameElement:void 0,emailFormLastNameElement:void 0,displayNameFormElement:void 0,displayNameInputElement:void 0,displayNameLabelElement:void 0,emailFormEmailInputElement:void 0,emailFormPassInputElement:void 0,passFormOldPassInputElement:void 0,passFormNewPassInputElement:void 0,passFormConfirmPassInputElement:void 0,
passFormElement:void 0,emailSiteSelect:void 0,linkGoogleElement:void 0,linkFbElement:void 0,oldEmailSiteVal:void 0,options:{editable:!1,isGoogleEnabled:!1,isFbEnabled:!1,socialLinkConflictMsg:void 0,styleJamState:null,emailSiteEnabled:!1,displayNameEnabled:!0},msg:void 0,init:function(){this.initSocial();this.msg=this.options.msg;this.editableElements=this.element.find(".js-editableSection");this.emailFormElement=this.getChildElement("emailEditForm");this.emailFormEmailInputElement=this.getChildElement("emailInput");
this.emailFormPassInputElement=this.getChildElement("passInput");this.passFormElement=this.getChildElement("passEditForm");this.passFormOldPassInputElement=this.getChildElement("passInputCurrent");this.passFormNewPassInputElement=this.getChildElement("passInputNew");this.passFormConfirmPassInputElement=this.getChildElement("passInputConfirm");this.nameFormElement=this.getChildElement("nameEditForm");this.nameFormFirstNameElement=this.getChildElement("nameInputFirst");this.nameFormLastNameElement=
this.getChildElement("nameInputLast");this.linkGoogleElement=this.getChildElement("gLink");this.linkFbElement=this.getChildElement("fbLink");this.staticDisplayElement=this.getChildElement("staticDisplay");this.options.emailSiteEnabled&&(this.emailSiteSelect=this.getChildElement("emailSite").dropdown().getWidget(),this.oldEmailSiteVal=this.emailSiteSelect.getValue());this.options.displayNameEnabled&&(this.displayNameFormElement=this.getChildElement("displayNameForm"),this.displayNameInputElement=this.getChildElement("displayNameInput"),
this.displayNameLabelElement=this.getChildElement("displayNameLabel"),this.displayNameTooltip=this.getChildElement("displayNameTooltip"))},initSocial:function(){this.options.isFbEnabled&&setTimeout(function(){c.Social.FB.ensureAPILoaded()},100);this.options.isGoogleEnabled&&setTimeout(function(){c.Social.Google.ensureAPILoaded()},100)},addEventHandlers:function(){var a=this;this.options.editable&&(this.registerEvent("click",this.getChildElement("editEmail"),this.handleEditEmailClick.bind(this)),this.registerEvent("click",
this.getChildElement("editPass"),this.handleEditPassClick.bind(this)),this.registerEvent("click",this.getChildElement("saveEmail"),this.handleSaveEmailClick.bind(this)),this.registerEvent("click",this.getChildElement("savePass"),this.handleSavePassClick.bind(this)),this.registerEvent("click",this.getChildElement("cancelEmail"),this.handleEmailFormClose.bind(this)),this.registerEvent("click",this.getChildElement("cancelPass"),this.handlePassFormClose.bind(this)));this.registerEvent("click",this.getChildElement("nameLabel"),
this.handleEditNameClick.bind(this));this.registerEvent("click",this.getChildElement("editName"),this.handleEditNameClick.bind(this));this.registerEvent("click",this.getChildElement("saveName"),this.handleSaveNameClick.bind(this));this.registerEvent("click",this.getChildElement("cancelName"),this.handleNameFormClose.bind(this));this.options.displayNameEnabled&&(this.registerEvent("click",this.getChildElement("displayNameLabel"),this.handleEditDisplayNameClick.bind(this)),this.registerEvent("click",
this.getChildElement("editDisplayName"),this.handleEditDisplayNameClick.bind(this)),this.registerEvent("click",this.getChildElement("saveDisplayName"),this.handleSaveDisplayNameClick.bind(this)),this.registerEvent("click",this.getChildElement("cancelDisplayName"),this.handleDisplayNameFormClose.bind(this)),this.displayNameTooltip.toolTip({extraClass:"modal-layer",position:"top",closeOnBodyClick:!0}));this.registerEvent("click",this.editableElements,this.handleEditableSectionFocus.bind(this));this.registerEvent("focus",
this.element.find("input, select"),this.handleEditableSectionFocus.bind(this));this.registerEvent("focus",this.displayNameTooltip,this.handleTooltipFocus.bind(this));this.registerEvent("focusout",this.displayNameTooltip,this.handleTooltipFocusOut.bind(this));this.registerEvent("change",this.getChildElement("emailSite-select"),this.handleChangeEmailSite.bind(this));this.registerEvent("click",this.linkFbElement,function(b){a.handleSocialLinkToggle(e(b.currentTarget),"facebook")});this.registerEvent("click",
this.linkGoogleElement,function(b){a.handleSocialLinkToggle(e(b.currentTarget),"google")});this.subscribe("googleauth.link.success",function(){a.handleSocialLinkSuccess(a.linkGoogleElement)});this.subscribe("fbauth.link.success",function(){a.handleSocialLinkSuccess(a.linkFbElement)});this.subscribe("googleauth.unlink.success",function(){a.handleSocialUnlinkSuccess(a.linkGoogleElement)});this.subscribe("fbauth.unlink.success",function(){a.handleSocialUnlinkSuccess(a.linkFbElement)});this.subscribe(["googleauth.social.error",
"googleauth.unlink.error"],function(b){a.handleSocialLinkError(a.linkGoogleElement,b.message)});this.subscribe(["fbauth.social.error","fbauth.unlink.error"],function(b){a.handleSocialLinkError(a.linkFbElement,b.message)});this.subscribe("fbauth.link.conflict",function(){a.handleSocialLinkConflict(a.linkFbElement)});this.subscribe("googleauth.link.conflict",function(){a.handleSocialLinkConflict(a.linkGoogleElement)});this.subscribe("account.nav.changetabs",this.destroy.bind(this))},inlineComponentsReady:function(){c.Analytics.api.trackEvent({subPageId:"account-connections",
category:"loaded"})},handleSocialUnlinkSuccess:function(a){a.removeClass("linked");this.options.styleJamState&&c.dom.swapClasses(a,this.options.styleJamState.SocialBoxLinked,this.options.styleJamState.SocialBoxUnlinked);c.Analytics.api.trackEvent({subPageId:"account-connections",category:(a===this.linkGoogleElement?"google":"fb")+"-unlink",action:"success"})},handleSocialLinkConflict:function(a){this.handleSocialLinkError(a,this.options.socialLinkConflictMsg)},handleSocialLinkError:function(a,b){a.toolTip({content:b,
extraClass:"modal-layer",position:"top",showImmediately:!0,activation:"click",closeOnBodyClick:!0});c.Analytics.api.trackEvent({subPageId:"account-connections",category:(a===this.linkGoogleElement?"google":"fb")+"-link",action:"error"})},handleTooltipFocus:function(){this.displayNameTooltip.getWidget().open()},handleTooltipFocusOut:function(){this.displayNameTooltip.getWidget().close()},handleSocialLinkSuccess:function(a){a.addClass("linked");this.options.styleJamState&&c.dom.swapClasses(a,this.options.styleJamState.SocialBoxUnlinked,
this.options.styleJamState.SocialBoxLinked);c.Analytics.api.trackEvent({subPageId:"account-connections",category:(a===this.linkGoogleElement?"google":"fb")+"-link",action:"success"})},handleSocialLinkToggle:function(a,b){this.clearElementTooltip(this.linkGoogleElement);this.clearElementTooltip(this.linkFbElement);a.hasClass("linked")?c.authentication.external[b].unlink():c.authentication.external[b].externalLoginAndLink()},handleChangeEmailSite:function(){var a=this,b=this.emailSiteSelect.getValue();
this.oldEmailSiteVal!==b&&(this.oldEmailSiteVal=b,c.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/changeemailsite",data:{cc:b},success:function(){a.swapClasses(a.getChildElement("emailSuccess"),"Checkmark--disabled","Checkmark--enabled");setTimeout(function(){a.swapClasses(a.getChildElement("emailSuccess"),"Checkmark--enabled","Checkmark--disabled")},2500);c.Analytics.api.trackEvent({subPageId:"account-connections",category:"email-site-change",action:"success"})},
fail:function(a){c.Analytics.api.trackEvent({subPageId:"account-connections",category:"email-site-change",action:"error"})}}))},validateEmail:function(){return this.emailFormEmailInputElement.val()?c.validation.customValidate(this.emailFormEmailInputElement,/^.+@.+\..+$/,this.clearEmailFormTooltips.bind(this),this.showError.bind(this,this.emailFormEmailInputElement,this.msg.invalidEmail)):(this.showError(this.emailFormEmailInputElement,this.msg.invalidEmail),!1)},showError:function(a,b){this.showFieldError(a.closest(".js-editableSection"));
a.toolTip({content:b,extraClass:"modal-layer",position:"top",showImmediately:!0,activation:"click",closeOnBodyClick:!0})},handleSaveEmailClick:function(){var a=this,b=this.emailFormPassInputElement.val();this.validateEmail()&&(b?(this.element.addClass("disabled").attr("aria-busy",!0),this.clearEmailFormTooltips(),c.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/changeemail",data:{passwd:b,changeemail:this.emailFormEmailInputElement.val()},success:function(b){a.getChildElement("emailChanged").html(b.msg).show();
a.getChildElement("emailBlock").remove();a.handleEmailFormClose();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"change-email",action:"success"})},fail:function(b){a.showError("email"===b.responseJSON.msgField?a.emailFormEmailInputElement:a.emailFormPassInputElement,b.responseJSON.msg);c.Analytics.api.trackEvent({subPageId:"account-connections",category:"change-email",action:"error"})},always:function(){a.element.removeClass("disabled").attr("aria-busy",!1)}})):this.showError(this.emailFormPassInputElement,
this.msg.passwordMissing))},handleSavePassClick:function(){var a=this;this.clearPassFormTooltips();this.resetFieldError(this.editableElements);var b=this.passFormOldPassInputElement.val(),d=this.passFormNewPassInputElement.val(),f=this.passFormConfirmPassInputElement.val();b?d?f?(this.element.addClass("disabled").attr("aria-busy",!0),this.getChildElement("passUpdated").hide(),c.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/changepass",data:{oldpw:b,newpw:d,
newpwconf:f},success:function(b){c.Analytics.api.trackEvent({subPageId:"account-connections",category:"change-pass",action:"success"});e.ajax({method:"POST",url:"/k/run/auth/login",headers:{"X-CSRF":c.globals.formtoken},data:{username:a.getChildElement("userName").text(),passwd:d,sticky:!0}}).done(function(b){0<=b.status?(c.authentication.formToken=b.formToken,c.authentication.userInfo=b.userInfo,a.getChildElement("passUpdated").show(),a.handlePassFormClose()):location.reload()}).fail(function(){location.reload()})},
fail:function(b){b=b.responseJSON;if("old"===b.msgField)var d=a.passFormOldPassInputElement;else"newpw"===b.msgField?d=a.passFormNewPassInputElement:"newpwconf"===b.msgField&&(d=a.passFormConfirmPassInputElement);"!"===b.old&&a.showFieldError(a.passFormOldPassInputElement.closest(".js-editableSection"));"!"===b.newpw&&a.showFieldError(a.passFormNewPassInputElement.closest(".js-editableSection"));"!"===b.newpwconf&&a.showFieldError(a.passFormConfirmPassInputElement.closest(".js-editableSection"));
d&&d.toolTip({content:b.msg,baseClass:"loginDlgError",extraClass:"modal-layer",position:"top",showImmediately:!0,activation:"click",closeOnBodyClick:!0});c.Analytics.api.trackEvent({subPageId:"account-connections",category:"change-pass",action:"error"})},always:function(){a.element.removeClass("disabled").attr("aria-busy",!1)}})):this.showError(this.passFormConfirmPassInputElement,this.msg.passwordMissing):this.showError(this.passFormNewPassInputElement,this.msg.passwordMissing):this.showError(this.passFormOldPassInputElement,
this.msg.passwordMissing)},handleSaveDisplayNameClick:function(){var a=this;this.element.addClass("disabled").attr("aria-busy",!0);this.clearDisplayNameFormTooltips();this.resetFieldError(this.editableElements);c.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/changedisplayname",data:{name:this.displayNameInputElement.val()},success:function(b){a.displayNameLabelElement.text(b.displayName);a.displayNameInputElement.val(b.displayName);a.handleDisplayNameFormClose();
c.Analytics.api.trackEvent({subPageId:"account-connections",category:"change-display-name",action:"success"})},fail:function(b){var c=a.displayNameInputElement;a.showFieldError(c.closest(".js-editableSection"));c&&c.toolTip({content:b.responseJSON.msg,baseClass:"loginDlgError",extraClass:"modal-layer",position:"top",showImmediately:!0,activation:"click",closeOnBodyClick:!0})},always:function(){a.element.removeClass("disabled").attr("aria-busy",!1)}})},handleSaveNameClick:function(){var a=this;this.element.addClass("disabled").attr("aria-busy",
!0);this.clearNameFormTooltips();this.resetFieldError(this.editableElements);c.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/changename",data:{first:this.nameFormFirstNameElement.val(),last:this.nameFormLastNameElement.val()},success:function(b){c.events.publish("account.action.change-nickname",{newNick:b.nickname,firstName:b.firstName});a.getChildElement("nameLabel").text(b.name);a.options.displayNameEnabled&&(a.displayNameInputElement.val(b.displayName),
a.displayNameLabelElement.text(b.displayName));a.handleNameFormClose();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"change-name",action:"success"})},fail:function(b){if(b.responseJSON.msgField){if("first"===b.responseJSON.msgField)var d=a.nameFormFirstNameElement;else"last"===b.responseJSON.msgField&&(d=a.nameFormLastNameElement);d&&(a.showFieldError(d.closest(".js-editableSection")),d.toolTip({content:b.responseJSON.msg,baseClass:"loginDlgError",extraClass:"modal-layer",
position:"top",showImmediately:!0,activation:"click",closeOnBodyClick:!0}))}else c.events.publish("error.alert",{messages:[b.responseJSON.msg.join("\n")]})},always:function(){a.element.removeClass("disabled").attr("aria-busy",!1)}})},showFieldError:function(a){this.swapClasses(a,"FormSection--active","FormSection--error");this.swapClasses(a,"","FormSection--error")},resetFieldError:function(a){this.swapClasses(a,"FormSection--error","")},clearEmailFormTooltips:function(){this.resetFieldError(this.editableElements);
this.clearElementTooltip(this.emailFormEmailInputElement);this.clearElementTooltip(this.emailFormPassInputElement)},clearPassFormTooltips:function(){this.resetFieldError(this.editableElements);this.clearElementTooltip(this.passFormOldPassInputElement);this.clearElementTooltip(this.passFormNewPassInputElement);this.clearElementTooltip(this.passFormConfirmPassInputElement)},clearNameFormTooltips:function(){this.resetFieldError(this.editableElements);this.clearElementTooltip(this.nameFormFirstNameElement);
this.clearElementTooltip(this.nameFormLastNameElement)},clearDisplayNameFormTooltips:function(){this.resetFieldError(this.editableElements);this.clearElementTooltip(this.displayNameInputElement)},clearElementTooltip:function(a){a.data("toolTip")&&a.data("toolTip").removeWidget()},handleEditNameClick:function(){this.nameFormElement.show();this.nameFormElement.find("input").first().click();this.staticDisplayElement.hide();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"name-form",
action:"open"})},handleEditDisplayNameClick:function(){this.displayNameFormElement.show();this.displayNameInputElement.focus();this.staticDisplayElement.hide();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"display-name-form",action:"open"})},handleEditEmailClick:function(){this.emailFormElement.show();this.emailFormElement.find("input").first().click();this.staticDisplayElement.hide();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"email-form",action:"open"})},
handleEditPassClick:function(){this.passFormElement.show();this.passFormElement.find("input").first().click();this.staticDisplayElement.hide();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"pass-form",action:"open"})},handleNameFormClose:function(){this.clearNameFormTooltips();this.nameFormElement.hide();this.staticDisplayElement.show();this.getChildElement("editName").focus();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"name-form",action:"close"})},
handleDisplayNameFormClose:function(){this.clearDisplayNameFormTooltips();this.displayNameFormElement.hide();this.staticDisplayElement.show();this.getChildElement("editDisplayName").focus()},handleEmailFormClose:function(){this.clearEmailFormTooltips();this.emailFormElement.hide();this.staticDisplayElement.show();this.getChildElement("editEmail").focus();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"email-form",action:"close"})},handlePassFormClose:function(){this.clearPassFormTooltips();
this.passFormElement.hide();this.editableElements.find("input[type\x3d'password']").val("");this.staticDisplayElement.show();this.getChildElement("editPass").focus();c.Analytics.api.trackEvent({subPageId:"account-connections",category:"pass-form",action:"close"})},handleEditableSectionFocus:function(a){a=e(a.currentTarget).closest(".js-editableSection");a.find("input").trigger("focus.auto");this.swapClasses(this.editableElements,"FormSection--active","");this.swapClasses(a,"","FormSection--active")}})})(R9,
jQuery);(function(b,f){b.createComponentClass("account.v2.views.account.AccountDataSharingOptOutSection",{groupCompaniesCheckbox:void 0,travelPartnersCheckbox:void 0,businessPartnersCheckbox:void 0,msg:{unexpectedError:void 0},init:function(){this.msg=this.options.msg;this.groupCompaniesCheckbox=this.getChildElement("checkbox-groupCompanies");this.travelPartnersCheckbox=this.getChildElement("checkbox-travelPartners");this.businessPartnersCheckbox=this.getChildElement("checkbox-businessPartners");this.handleInitOptions()},
addEventHandlers:function(){this.registerEvent("change",this.element.find(".js-checkbox input:checkbox"),this.handleDataSharingOptionChange.bind(this))},inlineComponentsReady:function(){b.Analytics.api.trackEvent({subPageId:"account-data-sharing-optouts",category:"loaded"})},handleInitOptions:function(){f.ajax({type:"GET",url:"/i/api/account/dataSharing/v1/",contentType:"application/json",success:function(c){if((c=c.options)&&0<c.length){var b,e,d;c.forEach(function(a){"DATA_SHARING_BUSINESS_PARTNERS"===
a.key?b=a.hasGivenConsent:"DATA_SHARING_BKNG_HOLDINGS"===a.key?e=a.hasGivenConsent:"DATA_SHARING_TRAVEL_PARTNERS"===a.key&&(d=a.hasGivenConsent)});this.businessPartnersCheckbox.prop("checked",b);this.groupCompaniesCheckbox.prop("checked",e);this.travelPartnersCheckbox.prop("checked",d)}}.bind(this),error:function(){b.Analytics.api.trackEvent({subPageId:"account-data-sharing-optouts",category:"error",action:"load"})}.bind(this),headers:{"X-CSRF":b.globals.formtoken}})},handleDataSharingOptionChange:function(c){c.preventDefault();
c.stopPropagation();var g=f(c.currentTarget),e=g.closest(".js-opt").data("optname"),d=g.is(":checked");c={options:[{key:e,hasGivenConsent:d}]};f.ajax({type:"PUT",dataType:"json",url:"/i/api/account/dataSharing/v1/",success:function(a){(a=a.options)&&0<a.length&&(g.prop("checked",a[0].hasGivenConsent),b.Analytics.api.trackEvent({subPageId:"account-data-sharing-optouts",category:e.toLowerCase(),action:d?"enable":"disable"}))}.bind(this),data:JSON.stringify(c),error:function(){b.Analytics.api.trackEvent({subPageId:"account-data-sharing-optouts",
category:"error",action:d?"enable":"disable"})}.bind(this),headers:{"X-CSRF":b.globals.formtoken},contentType:"application/json"})}})})(R9,jQuery);(function(a,b){a.createComponentClass("account.v2.views.account.AccountDeleteSection",{options:{},init:function(){},addEventHandlers:function(){this.registerEvent("click",this.getChildElement("zapper"),function(){a.Analytics.api.trackEvent({subPageId:"account-delete",category:"delete",action:"click"})})},inlineComponentsReady:function(){a.Analytics.api.trackEvent({subPageId:"account-delete",category:"loaded"})}})})(R9,jQuery);(function(a,c){a.createComponentClass("account.v2.views.account.AccountGetMyDataSection",{confirmDialog:void 0,confirmCheckbox:void 0,confirmButton:void 0,successDialog:void 0,checkboxEl:void 0,msg:{unexpectedError:void 0},allowBtnSubmit:!1,init:function(){this.msg=this.options.msg;this.confirmDialog=this.getChildElement("confirmDialog").getWidget();this.checkboxEl=this.getChildElement("confirmCheckbox");this.confirmCheckbox=this.checkboxEl.styleJamCheckbox?this.checkboxEl.styleJamCheckbox().getWidget():
this.checkboxEl.checkbox().getWidget();this.confirmButton=this.getChildElement("confirmButton");this.successDialog=this.getChildElement("successDialog").getWidget()},addEventHandlers:function(){this.registerEvent("click",this.getChildElement("getMyDataButton"),this.handleAskForConfirmation.bind(this));this.registerEvent("click",this.confirmButton,this.handleSendMyData.bind(this));this.registerEvent("keydown",this.checkboxEl,this.handleCheckboxKeydown.bind(this));this.confirmCheckbox.setOption("change",
this.handleConfirmChange.bind(this))},inlineComponentsReady:function(){a.Analytics.api.trackEvent({subPageId:"account-get-my-data",category:"loaded"})},handleCheckboxKeydown:function(b){b.keyCode===a.globals.keyCodes.RETURN&&(this.allowBtnSubmit=!this.confirmCheckbox.getValue(),this.confirmCheckbox.setChecked(this.allowBtnSubmit))},handleAskForConfirmation:function(){this.confirmDialog.open();a.Analytics.api.trackEvent({subPageId:"account-get-my-data",category:"get-my-data",action:"click"})},handleConfirmChange:function(a){this.allowBtnSubmit=
c(a).prop("checked")},handleSendMyData:function(){this.allowBtnSubmit&&(this.confirmDialog&&this.confirmDialog.close(),a.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/get-my-data",success:function(a){this.successDialog&&this.successDialog.open()}.bind(this),fail:function(b){a.events.publish("error.alert",{messages:[this.msg.unexpectedError]})}.bind(this)}),a.Analytics.api.trackEvent({subPageId:"account-get-my-data",category:"send-email",action:"click"}))}})})(R9,
jQuery);(function(a,b){a.createComponentClass("account.v2.views.account.AccountView",{options:{},init:function(){},addEventHandlers:function(){this.subscribe("account.nav.changetabs",this.destroy.bind(this));this.registerEvent("click",this.getChildElement("watchlistButton"),function(){a.events.publish("account.nav.changetabs",{activeTab:"watchlist"});window.scrollTo(0,0);a.Analytics.api.trackEvent({subPageId:"account-view",category:"watchlist-button",action:"click"})})}})})(R9,jQuery);(function(c,d){c.createComponentClass("account.v2.views.tripsettings.TripsAuthorizedSendersSection",{dialog:void 0,addEmailButtonEl:void 0,emailEl:void 0,sendersSectionEl:void 0,options:{authSenderNewEndPointEnabled:!1},msg:{confirmBreakLink:void 0,invalidEmailError:void 0,confirmDeleteSender:void 0},init:function(){this.sendersSectionEl=this.getChildElement("senders");this.addEmailSectionEl=this.element.find(".js-addEmail");this.emailEl=this.getChildElement("email");this.msg=this.options.msg;this.dialog=
this.getChildElement("addEmailDialog").dialog({}).getWidget()},addEventHandlers:function(){this.registerEvent("click",this.getChildElement("breakLink"),this.handleBreakValidLink.bind(this));this.registerEvent("click",this.getChildElement("breakBadLink"),this.handleBreakLink.bind(this));this.registerEvent("click",".js-deleteEmailBtn",this.handleDeleteAuthorizedSender.bind(this));this.registerEvent("click",".js-resendMsg",this.handleResendAuthorizedSender.bind(this));this.registerEvent("click",this.addEmailSectionEl,
this.handleOpenEmailDialog.bind(this));this.registerEvent("click",this.getChildElement("addEmailButton"),this.handleAddEmailClick.bind(this));this.subscribe("account.nav.changetabs",this.destroy.bind(this))},inlineComponentsReady:function(){c.Analytics.api.trackEvent({subPageId:"trips-senders",category:"loaded"})},handleAddEmailClick:function(){var b=this;this.emailEl.data("toolTip")&&this.emailEl.data("toolTip").removeWidget();var a=this.emailEl.val();validateEmail(a)?(this.getChildElement("addEmailForm").addClass("disabled").attr("aria-busy",
!0),this.doTripsPrefAjaxAction(a,"add","booking",function(){d(c.template.render("newAuthSender",{email:a})).insertBefore(b.addEmailSectionEl);b.dialog.close();b.getChildElement("addEmailForm").removeClass("disabled").attr("aria-busy",!1)},function(){b.getChildElement("addEmailForm").removeClass("disabled").attr("aria-busy",!1)})):this.emailEl.toolTip({content:this.msg.invalidEmailError,extraClass:"modal-layer",position:"top",showImmediately:!0,activation:"click",closeOnBodyClick:!0})},handleOpenEmailDialog:function(){this.dialog.open()},
handleBreakValidLink:function(){window.confirm(this.msg.confirmBreakLink)&&this.handleBreakLink()},handleBreakLink:function(){c.Analytics.api.trackEvent({subPageId:"trips-senders",category:"break-link",action:"click"});d.ajax({type:"POST",url:"/trips/ajax/breakmylink",headers:{"X-CSRF":c.globals.formtoken},data:"",dataType:"html",success:function(){window.location.reload()},error:function(b){c.events.publish("error.alert",{messages:[b.statusText]})},cache:!1})},handleDeleteAuthorizedSender:function(b){var a=
d(b.currentTarget).closest(".js-sender");b=function(){a.remove()};var h=function(){a.removeClass("pendingState")},g=c.Common.Utils.String.formatString(this.msg.confirmDeleteSender,a.data("email"));window.confirm(g)&&(a.addClass("pendingState"),this.doTripsPrefAjaxAction(a.data("email"),"delete","booking",b,h))},handleResendAuthorizedSender:function(b){var a=d(b.currentTarget).closest(".js-sender");a.find(".js-resendMsg").hide();a.find(".js-spinner").show();this.doTripsPrefAjaxAction(a.data("email"),
"resend","booking",function(){a.find(".js-spinner").hide();a.find(".js-resendMsgSuccess").show()})},doTripsPrefAjaxAction:function(b,a,h,g,f){var e=this;c.Analytics.api.trackEvent({subPageId:"trips-senders",category:"auth-sender",action:a});this.options.authSenderNewEndPointEnabled?c.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/authsender/"+a,data:{email:b},success:function(a){g(a);e.swapClasses(e.getChildElement("emailSuccess"),"Checkmark--disabled","Checkmark--enabled");
setTimeout(function(){e.swapClasses(e.getChildElement("emailSuccess"),"Checkmark--enabled","Checkmark--disabled")},2500);c.Analytics.api.trackEvent({subPageId:"account-connections",category:"email-site-change",action:"success"})},fail:function(a){"function"===typeof f&&f(a);e.dialog.close();c.events.publish("error.alert",{messages:[a.responseJSON.msg]})}}):d.ajax({type:"POST",url:"/k/tripsprefajax/receiptemail",headers:{"X-CSRF":c.globals.formtoken},data:{action:a,type:h,email:b,formtoken:c.globals.formtoken,
index:0},dataType:"xml",success:function(a){e.processXmlResponseForErrors(a)?"function"===typeof f&&f():g()},error:function(b,d){c.Analytics.api.trackEvent({subPageId:"trips-senders",category:"auth-sender",action:a+"/fail"});"function"===typeof f&&f();e.dialog.close();c.events.publish("error.alert",{messages:[d]})},cache:!1})},processXmlResponseForErrors:function(b){var a="";b=d(b).find("error");0<b.length&&(a=b.eq(0).text(),null!==a&&(a=a.replace(/^\s+|\s+$/g,"")));return""!==a?(this.dialog.close(),
c.events.publish("error.alert",{messages:[a]}),!0):!1}})})(R9,jQuery);(function(c,g){c.createComponentClass("account.v2.views.tripsettings.TripsAutoShareSection",{dialog:void 0,dialogRbs:void 0,templateIdRegex:void 0,templateCounter:1,emailEl:void 0,autoshareSectionEl:void 0,autosharedWithMeSectionEl:void 0,options:{radioBtnReplaceId:void 0},msg:{genericError:void 0,invalidEmailError:void 0,confirmDeleteAutoshare:void 0,confirmDeleteAutoshareWithMe:void 0},init:function(){var a=this;this.msg=this.options.msg;this.templateIdRegex=new RegExp(this.options.radioBtnReplaceId,
"g");this.emailEl=this.getChildElement("email");this.addEmailEl=this.element.find(".js-addEmail");this.autoshareSectionEl=this.getChildElement("autoshareEmails");this.autosharedWithMeSectionEl=this.getChildElement("autoshared");this.dialog=this.getChildElement("addAutoshareDialog").dialog({}).getWidget();this.element.find(".js-editable").each(function(b,c){g(c).radioButtonSet({change:a.handleIsEditableChange.bind(a)})});this.dialogRbs=g(".js-dialogEditable").radioButtonSet().getWidget()},addEventHandlers:function(){this.registerEvent("click",
this.addEmailEl,this.handleOpenEmailDialog.bind(this));this.registerEvent("click",".js-deleteAutoshare",this.handleDeleteEmailClick.bind(this));this.registerEvent("click",".js-deleteAutoshareWithMe",this.handleDeleteAutosharedClick.bind(this));this.registerEvent("click",this.getChildElement("addEmailButton"),this.handleAddEmailClick.bind(this));this.subscribe("account.nav.changetabs",this.destroy.bind(this))},inlineComponentsReady:function(){c.Analytics.api.trackEvent({subPageId:"trips-share",category:"loaded"})},
handleOpenEmailDialog:function(){c.events.publish("account.v2.validated-action",{successCallback:function(){this.dialog.open();this.dialogRbs.setButtonCheckedByValue("noedit");this.emailEl.val("");c.Analytics.api.trackEvent({subPageId:"trips-share",category:"email-dialog",action:"open"})}.bind(this)})},handleIsEditableChange:function(a){var b=this,d=g(a).closest(".js-autoshare");a={friendUid:d.data("frienduid")};c.Analytics.api.trackEvent({subPageId:"trips-share",category:"email-can-edit",action:"toggle"});
this.doV2TripsAutoshareAction(a,"toggle",function(){var a=d.find(".js-editableSuccess");b.swapClasses(a,"Checkmark--disabled","Checkmark--enabled");setTimeout(function(){b.swapClasses(a,"Checkmark--enabled","Checkmark--disabled")},2500)})},handleDeleteEmailClick:function(a){var b=g(a.target).closest(".js-autoshare");a={friendUid:b.data("frienduid"),allTrips:!1};var d=function(){b.remove()},f=function(){b.removeClass("pendingState")};b.addClass("pendingState");var e=c.Common.Utils.String.formatString(this.msg.confirmDeleteAutoshare,
b.data("email"));confirm(e)?this.doV2TripsAutoshareAction(a,"remove",d,f):b.removeClass("pendingState");c.Analytics.api.trackEvent({subPageId:"trips-share",category:"delete-email",action:"click"})},handleDeleteAutosharedClick:function(a){var b=this,d=g(a.target).closest(".js-autosharedWithMe");a={friendUid:d.data("uid"),allTrips:!1,isOwner:!0};var f=function(){d.remove();1>b.autosharedWithMeSectionEl.find(".js-autosharedWithMe").length&&b.autosharedWithMeSectionEl.hide()},e=function(){d.removeClass("pendingState")};
d.addClass("pendingState");var h=c.Common.Utils.String.formatString(this.msg.confirmDeleteAutoshareWithMe,d.data("email"));confirm(h)?b.doV2TripsAutoshareAction(a,"remove",f,e):d.removeClass("pendingState");c.Analytics.api.trackEvent({subPageId:"trips-share",category:"delete-autoshare",action:"click"})},handleAddEmailClick:function(){var a=this,b=this.getChildElement("addAutoshareForm");this.emailEl.data("toolTip")&&this.emailEl.data("toolTip").removeWidget();var d=this.emailEl.val();if(validateEmail(d)){var f=
{friendEmail:d,isEditor:"edit"===this.dialogRbs.getCheckedButton().val()};c.Analytics.api.trackEvent({subPageId:"trips-share",category:"add-email",action:"click"});this.doV2TripsAutoshareAction(f,"add",function(e){e=c.template.render("newAutoFriend",{email:d,frienduid:e.friendUid});var h=a.options.radioBtnReplaceId+a.templateCounter++;e=e.replace(a.templateIdRegex,h);g(e).insertBefore(a.addEmailEl);a.element.find("#"+h).radioButtonSet().getWidget().setButtonCheckedByValue(a.dialogRbs.getValue());
b.removeClass("disabled").attr("aria-busy",!1);a.dialog.close()},function(){b.removeClass("disabled").attr("aria-busy",!1)})}else this.emailEl.toolTip({content:this.msg.invalidEmailError,extraClass:"modal-layer",position:"top",showImmediately:!0,activation:"click",closeOnBodyClick:!0})},doV2TripsAutoshareAction:function(a,b,d,f){var e=this;c.Analytics.api.trackEvent({category:"auto-share",action:b+"/start"});c.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/autoshare/"+
b,data:a,success:function(a){"function"===typeof d&&d(a);c.Analytics.api.trackEvent({subPageId:"trips-share",category:"auto-share",action:b+"/success"})},fail:function(a){"function"===typeof f&&f(a);c.events.publish("error.alert",{messages:[a.responseJSON.msg||e.msg.genericError]})}})},doTripsAutoshareAction:function(a,b,d,f){var e=this;c.Analytics.api.trackEvent({subPageId:"trips-share",category:"auto-share",action:b+"/start"});g.ajax({type:"POST",url:"/trips/ajax/sharingprefs/"+b,headers:{"X-CSRF":c.globals.formtoken},
data:g.extend(a,{formtoken:c.globals.formtoken}),dataType:"json",success:function(a){a.success||"remove"===b&&"success"===a?("function"===typeof d&&d(a),c.Analytics.api.trackEvent({subPageId:"trips-share",category:"auto-share",action:b+"/success"})):(c.events.publish("error.alert",{messages:[a.error||e.msg.genericError]}),"function"===typeof f&&f(),c.Analytics.api.trackEvent({subPageId:"trips-share",category:"auto-share",action:b+"/fail"}))},error:function(){c.Analytics.api.trackEvent({subPageId:"trips-share",
category:"auto-share",action:b+"/fail"});"function"===typeof f&&f();c.events.publish("error.alert",{messages:[e.msg.genericError]})},cache:!1})}})})(R9,jQuery);(function(a,c){a.createComponentClass("account.v2.views.tripsettings.TripsCalendarSection",{options:{},msg:{confirmCalendarReset:""},init:function(){this.msg=this.options.msg},addEventHandlers:function(){this.registerEvent("click",this.getChildElement("reset"),this.handleResetCalendarClick.bind(this));this.registerEvent("click",this.getChildElement("instructions"),this.handleReadInstructionsClick.bind(this));this.subscribe("account.nav.changetabs",this.destroy.bind(this))},inlineComponentsReady:function(){a.Analytics.api.trackEvent({subPageId:"trips-calendar",
category:"loaded"})},handleResetCalendarClick:function(){var b=this;confirm(this.msg.confirmCalendarReset)&&(a.events.publish("account.v2.execute-account-action",{path:"/s/horizon/account/v2/action/tripspref/resettoken",data:{isPrivate:!1},success:function(a){b.getChildElement("calendarLink").attr("href",a.link).text(a.link)},fail:function(b){a.events.publish("error.alert",{messages:[b.responseJSON.msg]})}}),a.Analytics.api.trackEvent({subPageId:"trips-calendar",category:"resettoken",action:"click"}))},
handleReadInstructionsClick:function(){a.Analytics.api.trackEvent({subPageId:"trips-calendar",category:"help",action:"click"})}})})(R9,jQuery);(function(b,d){b.createComponentClass("account.v2.views.tripsettings.TripsConnectInboxSection",{dialog:void 0,ensureAPIPromise:void 0,errorContainer:void 0,onOutlookMessageEvent:void 0,syncFormEl:void 0,syncSuccessEl:void 0,options:{subpageid:"trips-sync",msg:{disconnectError:"",inboxAlreadyConnectedError:""}},init:function(){this.syncFormEl=this.getChildElement("syncForm");this.syncSuccessEl=this.getChildElement("syncSuccess");this.errorContainer=this.getChildElement("errorContainer");this.dialog=
this.getChildElement("connectDialog").dialog({}).getWidget();this.ensureAPIPromise=b.Social.Google.Gmail.ensureApiLoaded();this.autoOpenDialog()},addEventHandlers:function(){this.registerEvent("click",this.getChildElement("connectButton"),this.handleConnectButtonClick.bind(this));this.registerEvent("click",this.getChildElement("googleConnectButton"),this.handleGmailConnect.bind(this));this.registerEvent("click",this.getChildElement("outlookConnectButton"),this.handleOutlookConnect.bind(this));this.registerEvent("click",
this.element.find(".js-deleteConnectionBtn"),this.handleDisconnectButtonClick.bind(this));this.registerEvent("click",this.getChildElement("addEmail"),this.handleConnectButtonClick.bind(this));this.subscribe("account.nav.changetabs",this.destroy.bind(this))},inlineComponentsReady:function(){b.Analytics.api.trackEvent({subPageId:this.options.subpageid,category:"loaded"})},onDisconnectError:function(){b.events.publish("error.alert",{messages:[this.options.msg.disconnectError]})},handleDisconnectButtonClick:function(a){a=
d(a.currentTarget).closest(".js-connection");"OUTLOOK"==a.data("provider")?this.handleDisconnectOutlook(a):this.handleDisconnectGoogle(a)},removeEmailSyncRow:function(a){a.remove();0===this.element.find(".js-connection").length&&(this.getChildElement("promo").show(),this.getChildElement("connections").hide())},handleDisconnectGoogle:function(a){var c=this;setTimeout(function(){b.Analytics.api.trackEvent({subPageId:c.options.subpageid,category:"trips",action:"disconnect-google",label:"email-sync"})},
10);this.ensureAPIPromise.done(function(){b.Social.Google.Gmail.unauthorize(a.data("email"),function(){c.removeEmailSyncRow(a)},c.onDisconnectError.bind(c))}).fail(this.onDisconnectError.bind(this));c.removeEmailSyncRow(a)},handleDisconnectOutlook:function(a){var c=this;setTimeout(function(){b.Analytics.api.trackEvent({subPageId:c.options.subpageid,category:"trips",action:"disconnect-outlook",label:"email-sync"})},10);d.ajax({type:"POST",dataType:"json",url:"/k/run/inbox/requests/outlook/unsubscription",
headers:{"X-CSRF":b.globals.formtoken},data:{email:a.data("email")}}).done(function(d){jq.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"/inbox/outlook/unsubscribe",headers:{"X-CSRF":b.globals.formtoken},data:JSON.stringify(d)}).done(function(){c.removeEmailSyncRow(a)}).fail(c.onDisconnectError.bind(c))}).fail(c.onDisconnectError.bind(c))},handleConnectButtonClick:function(){this.dialog.open();b.Analytics.api.trackEvent({subPageId:this.options.subpageid,category:"sync-dialog",
action:"open"})},handleOutlookConnect:function(){b.Analytics.api.trackEvent({subPageId:this.options.subpageid,category:"outlook",action:"connect/start"});var a={client_id:b.config.getString("ui.inbox.outlook.clientId"),response_type:"code",response_mode:"form_post",scope:b.config.getString("ui.inbox.outlook.scope"),redirect_uri:b.config.getString("ui.inbox.outlook.redirect_uri"),state:JSON.stringify({token:b.globals.formtoken,lc:b.globals.locale.lc,lc_cc:b.globals.locale.lc_cc})};window.open("https://login.microsoftonline.com/common/oauth2/v2.0/authorize?"+
jq.param(a),"Trips Email Sync","width\x3d480,height\x3d640");window.removeEventListener("message",this.onOutlookMessageEvent);this.onOutlookMessageEvent=this.onOutlookMessage.bind(this);window.addEventListener("message",this.onOutlookMessageEvent,!1);return!1},onOutlookMessage:function(a){a.origin===location.origin&&(a.data&&a.data.success?(b.Analytics.api.trackEvent({subPageId:this.options.subpageid,category:"outlook",action:"connect/success"}),this.onSuccess(d.extend(a.data,{connectionType:"outlook"}))):
(b.Analytics.api.trackEvent({subPageId:this.options.subpageid,category:"outlook",action:"connect/fail"}),this.onError.call(this,a.data.errorOrigin,a.data.errorCode,a.data.errorMessage)))},handleGmailConnect:function(){var a=this;b.Analytics.api.trackEvent({subPageId:a.options.subpageid,category:"google",action:"connect/start"});this.errorContainer.hide();this.ensureAPIPromise.done(function(){b.Social.Google.Gmail.authorize(function(c){a.onSuccess(d.extend(c,{connectionType:"google"}));b.Analytics.api.trackEvent({subPageId:a.options.subpageid,
category:"google",action:"connect/success"})},a.onError.bind(a))}).fail(a.onError.bind(a))},onSuccess:function(){this.syncFormEl.hide();this.syncSuccessEl.show();d(document).on("click",function(){window.location.reload()})},onError:function(a,b,d,g,f){var c=this.errorContainer.find(".js-errDetails");c.empty();if("G"!==a||"popup_closed_by_user"!==b&&"access_denied"!==b){this.errorContainer.show();null==a&&(a="");null==f&&(f="");var e=null;"I"===a&&7==b?e=this.options.msg.inboxAlreadyConnectedError:
null!=d?e=d:null!=b?e=a+"_"+b:null!=g&&(e=a+"_("+f+"): "+g);null!=e&&(e=(" "+e).substring(0,500),c.text(e))}else this.errorContainer.hide()},autoOpenDialog:function(){window.location.search.match(/(\?|&)open=connect-inbox(&|$)/)&&this.dialog.open()}})})(R9,jQuery);(function(c){R9.extend("Widgets",{Checkbox:function(a,b){this.elementNode=a;this.element=c(this.elementNode);this.icon=c(R9.Widgets.Checkbox.findIconNode(this.elementNode));this.validateElement()&&(this.options=c.extend({},this.options,b),this.init())}});R9.extend("Widgets.Checkbox",{isCheckbox:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"checkbox"==a.type.toLowerCase()},isWidgetControlled:function(a){return c(a).hasClass(R9.Widgets.Checkbox.prototype.widgetBaseClass+"-input")},
refresh:function(a,b){b=c(b);b[a.checked?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-checked");b[a.disabled?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-disabled")},findIconNode:function(a){return c(a).closest("[id$\x3d'-icon']")},findElementNode:function(a){return document.getElementById(a.id.substring(0,a.id.lastIndexOf("-icon")))}});R9.extend("Widgets.Checkbox.prototype",{widgetName:"checkbox",widgetBaseClass:"r9-checkbox",elementNode:null,
element:null,icon:null,options:{click:null,change:null},init:function(){this.bindInputClickEvent();this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.element.data(this.widgetName,this)},validateElement:function(){return R9.Widgets.Checkbox.isCheckbox(this.elementNode)&&R9.Widgets.Checkbox.isWidgetControlled(this.elementNode)},bindInputEvent:function(a,b){var c=this;a+="."+
this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,R9.Widgets.Checkbox.findIconNode(this),a)})},bindInputClickEvent:function(){this.bindInputEvent("click",this.handleElementClickEvent)},handleElementClickEvent:function(a,b,c){this.options.click&&this.options.click.apply(this,arguments)},handleElementChangeEvent:function(a,b,c){R9.Widgets.Checkbox.refresh(a,b);this.options.change&&this.options.change.apply(this,arguments)},handleElementFocusEvent:function(a,b,d){a.disabled||(c(b).addClass(this.widgetBaseClass+
"-state-focus"),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,b,d){a.disabled||(c(b).removeClass(this.widgetBaseClass+"-state-focus"),this.options.blur&&this.options.blur.apply(this,arguments))}})})(jq||jQuery);var FOCUSED_CLASS=R9.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");
(function(c){R9.createWidgetClass("checkbox.Checkbox",c.extend({},R9.Widgets.Checkbox.prototype,{isToggle:!1,options:{keydown:c.noop,click:null,change:null},init:function(){this.elementNode=this.element.get(0);this.element.parent().is(".toggle")&&(this.isToggle=!0);this.label=this.getChildElement("label")},addEventHandlers:function(){this.bindInputClickEvent();this.bindInputEvent("change",this._handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",
this.handleElementBlurEvent)},_handleElementChangeEvent:function(a,b,d){this.handleElementChangeEvent(a,b,d);b=c(a).prop("checked");a.setAttribute("aria-checked",b);this.label&&this.isToggle&&this.label.attr("aria-label",this.label.children(b?".on":".off").text())},setEnabled:function(a){a?this.element.removeAttr("disabled"):this.element.attr("disabled","disabled");this.element.attr("aria-disabled",!a);R9.Widgets.Checkbox.refresh(this.element,this.icon)},getValue:function(){return this.element.prop("checked")},
setChecked:function(a){this.element.prop("checked",a)},handleElementFocusEvent:function(){this.base();this.toggleFocusOutline(!0)},handleElementBlurEvent:function(){this.base();this.toggleFocusOutline(!1)},toggleFocusOutline:function(a){this.element.closest(".js-checkbox-container").toggleClass(FOCUSED_CLASS,a)}}))})(jq||jQuery);(function(c,b){c.createWidgetClass("dropdown.Dropdown",{status:null,select:null,selectEl:null,refreshTimer:null,lastSelectedIndex:-1,options:{click:null,change:null,statusClientTemplate:""},init:function(){this.status=this.getChildElement("status");this.status.length||(this.status=this.element.find(".status"));this.select=this.getChildElement("select");this.select.length||(this.select=this.element.find("select"));this.selectEl=this.select.get(0)},addEventHandlers:function(){this.select.click(this.handleSelectClickEvent.bind(this));
this.select.keydown(this.handleSelectKeydownEvent.bind(this));this.select.keyup(this.handleSelectKeyupEvent.bind(this));this.select.focus(this.handleSelectFocusEvent.bind(this));this.select.blur(this.handleSelectBlurEvent.bind(this));this.select.change(this.handleSelectChangeEvent.bind(this))},refresh:function(){this.select.is(":disabled")?this.element.addClass("disabled"):this.element.removeClass("disabled");var a=this.selectEl.selectedIndex;0>a&&(a=0);a=this.selectEl.options[a];"undefined"!==typeof a&&
(this.options.statusClientTemplate?this.status.html(c.template.render(this.options.statusClientTemplate,a)):(this.status.html(c.utils.escapeHTML(a.title||a.text||a.value)),this.selectEl.title=a.title||a.text||a.value))},startRefreshLoop:function(){var a=this;this.lastSelectedIndex=this.selectEl.selectedIndex;this.refreshTimer=setInterval(function(){a.doRefresh()},100)},stopRefreshLoop:function(){null!=this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null,this.lastSelectedIndex=
-1)},doRefresh:function(){this.selectEl.selectedIndex!=this.lastSelectedIndex&&(this.lastSelectedIndex=this.selectEl.selectedIndex,this.refresh())},handleSelectClickEvent:function(){"function"===typeof this.options.click&&this.options.click(this);this.stopRefreshLoop()},handleSelectKeydownEvent:function(){this.startRefreshLoop()},handleSelectKeyupEvent:function(){this.refresh();this.stopRefreshLoop()},handleSelectFocusEvent:function(){this.selectEl.disabled||this.element.addClass("focused")},handleSelectBlurEvent:function(){this.selectEl.disabled||
(this.element.removeClass("focused"),this.refresh(),this.stopRefreshLoop())},handleSelectChangeEvent:function(a){"function"===typeof this.options.change&&this.options.change.call(this,a);this.refresh();this.stopRefreshLoop()},getSelectedElement:function(){return this.selectEl.options[0<=this.selectEl.selectedIndex?this.selectEl.selectedIndex:0]},getName:function(){return this.selectEl.name},hasOptions:function(){return 0!==this.selectEl.options.length},getValue:function(){return this.hasOptions()?
this.getSelectedElement().value:null},val:function(a){if("undefined"!==typeof a)this.setValue(a);else return this.getValue()},getText:function(){return b(this.getSelectedElement()).text()},setText:function(a){this.status.text(a)},setValue:function(a,b){this.select.val(a);b?this.select.trigger("change"):this.refresh()},setOptions:function(a,c){var e=b("\x3cselect\x3e");b.each(a,function(a,d){d.value===c&&(d.selected=!0);e.append(b("\x3coption\x3e",d))});this.select.html(e.html());this.refresh()}})})(R9,
jQuery);(function(a,c){a.createWidgetClass("dropdown.StyleJamDropdown",{status:null,select:null,selectEl:null,refreshTimer:null,lastSelectedIndex:-1,options:{click:null,change:null,statusClientTemplate:"",presentationStates:{},showFocusOutline:!1},init:function(){this.status=this.getChildElement("status");this.status.length||(this.status=this.element.find(".status"));this.select=this.getChildElement("select");this.select.length||(this.select=this.element.find("select"));this.selectEl=this.select.get(0)},
addEventHandlers:function(){this.select.click(this.handleSelectClickEvent.bind(this));this.select.keydown(this.handleSelectKeydownEvent.bind(this));this.select.keyup(this.handleSelectKeyupEvent.bind(this));this.select.focus(this.handleSelectFocusEvent.bind(this));this.select.blur(this.handleSelectBlurEvent.bind(this));this.select.change(this.handleSelectChangeEvent.bind(this));this.options.presentationStates&&this.styleInvalidState()},refresh:function(){this.select.is(":disabled")?this.element.addClass("disabled"):
this.element.removeClass("disabled");var b=this.selectEl.selectedIndex;0>b&&(b=0);b=this.selectEl.options[b];"undefined"!==typeof b&&(this.options.statusClientTemplate?this.status.html(a.template.render(this.options.statusClientTemplate,b)):(this.status.html(a.utils.escapeHTML(b.title||b.text||b.value)),this.selectEl.title=b.title||b.text||b.value))},startRefreshLoop:function(){var b=this;this.lastSelectedIndex=this.selectEl.selectedIndex;this.refreshTimer=setInterval(function(){b.doRefresh()},100)},
stopRefreshLoop:function(){null!=this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null,this.lastSelectedIndex=-1)},doRefresh:function(){this.selectEl.selectedIndex!=this.lastSelectedIndex&&(this.lastSelectedIndex=this.selectEl.selectedIndex,this.refresh())},handleSelectClickEvent:function(){"function"===typeof this.options.click&&this.options.click(this);this.stopRefreshLoop()},handleSelectKeydownEvent:function(){this.startRefreshLoop()},handleSelectKeyupEvent:function(){this.refresh();
this.stopRefreshLoop()},handleSelectFocusEvent:function(){this.selectEl.disabled||(this.element.addClass("focused"),this.options.showFocusOutline&&this.element.addClass(this.getStlBlock("Dropdown--focused")),this.options.presentationStates?(this.element.removeClass(this.options.presentationStates.invalid),a.dom.swapClasses(this.element,this.options.presentationStates.regular,this.options.presentationStates.focus)):this.element.is(".TEXT")?(a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextBlurred,
a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextFocused),a.dom.swapClasses(this.element.children(".icon"),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconText,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconTextFocused)):a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownBlurred,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownFocused))},handleSelectBlurEvent:function(){this.selectEl.disabled||(this.element.removeClass("focused"),
this.options.showFocusOutline&&this.element.removeClass(this.getStlBlock("Dropdown--focused")),this.options.presentationStates?a.dom.swapClasses(this.element,this.options.presentationStates.focus,this.options.presentationStates.regular):(this.element.is(".TEXT")?(a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextFocused,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextBlurred),a.dom.swapClasses(this.element.children(".icon"),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconTextFocused,
a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconText)):a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownFocused,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownBlurred),this.refresh(),this.stopRefreshLoop()))},handleSelectChangeEvent:function(b){"function"===typeof this.options.change&&this.options.change.call(this,b);this.refresh();this.stopRefreshLoop()},styleInvalidState:function(b){b?a.dom.swapClasses(this.element,this.options.presentationStates.regular,
this.options.presentationStates.invalid):a.dom.swapClasses(this.element,this.options.presentationStates.invalid,this.options.presentationStates.regular)},getSelectedElement:function(){return this.selectEl.options[0<=this.selectEl.selectedIndex?this.selectEl.selectedIndex:0]},getName:function(){return this.selectEl.name},hasOptions:function(){return 0!==this.selectEl.options.length},getValue:function(){return this.hasOptions()?this.getSelectedElement().value:null},val:function(b){if("undefined"!==
typeof b)this.setValue(b);else return this.getValue()},getText:function(){return c(this.getSelectedElement()).text()},setText:function(b){this.status.text(b)},setValue:function(b,a){this.select.val(b);a?this.select.trigger("change"):this.refresh()},setOptions:function(a,e){var b=c("\x3cselect\x3e");c.each(a,function(a,d){d.value===e&&(d.selected=!0);b.append(c("\x3coption\x3e",d))});this.select.html(b.html());this.refresh()}})})(R9,jQuery);(function(d){R9.extend("Widgets",{RadiobuttonSet:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!b||b.dontValidate||this.validateElement())this.options=d.extend({},this.options,b),this.init()}});R9.extend("Widgets.RadiobuttonSet",{isRadiobuttonSet:function(a){return a&&a.nodeName&&"span"===a.nodeName.toLowerCase()},isWidgetControlled:function(a){return d(a).hasClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass)},findLabelNode:function(a){return document.getElementById(a.id+
"-label")},findRadiobuttonSetNode:function(a){return null!=a?a.parentNode:null},refresh:function(a){var b=!1;a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).each(function(){var a=d(R9.Widgets.RadiobuttonSet.findLabelNode(this)),e=d(this);e.prop("checked")?(b=!0,a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked")):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked");e.prop("disabled")?a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+
"-label-disabled"):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-disabled")});b||(a=a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).first(),a.prop("checked",!0),d(R9.Widgets.RadiobuttonSet.findLabelNode(a[0])).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked"))},applyCallback:function(a,b,c,e){a&&(d.isFunction(a)?a.apply(b,c):(a=a[e.target.value],d.isFunction(a)&&a.apply(b,c)))}});R9.extend("Widgets.RadiobuttonSet.prototype",
{widgetName:"radiobuttonset",widgetBaseClass:"r9-radiobuttonset",elementNode:null,element:null,options:{change:null,click:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.handleElementClickEvent);this.element.data(this.widgetName,this);R9.Widgets.RadiobuttonSet.refresh(this.element)},bindInputEvent:function(a,b){var c="input."+
this.widgetBaseClass;a+="."+this.widgetName;var d=this;this.element.off(a,c).on(a,c,function(a){b.call(d,this,R9.Widgets.RadiobuttonSet.findLabelNode(this),a)})},validateElement:function(){return R9.Widgets.RadiobuttonSet.isRadiobuttonSet(this.elementNode)&&R9.Widgets.RadiobuttonSet.isWidgetControlled(this.element)&&void 0===this.element.data(this.widgetName)},handleElementFocusEvent:function(a,b,c){a.disabled||d(b).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementBlurEvent:function(a,
b,c){a.disabled||d(b).removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementChangeEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.change,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))},handleElementClickEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.click,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))}})})(jq||jQuery);
(function(d){R9.createWidgetClass("radio.RadioButtonSet",d.extend({},R9.Widgets.RadiobuttonSet.prototype,{currentRadio:null,isTabList:!1,init:function(a){setTimeout(this.refresh.bind(this),1);this.currentRadio=this._getButtons().filter(":checked").next("label");this.isTabList="tablist"===this.getChildElement("set").attr("role")},refresh:function(){R9.Widgets.RadiobuttonSet.refresh(this.element);var a=this.getEnabledRadios().filter("[aria-checked\x3dtrue]");a.length&&this.element.attr("aria-activedescendant",
a.attr("id"));this.focusRadio();this.isTabList&&window.setTimeout(function(){var a=this.getCheckedButton();this._getButtons().attr("aria-selected",!1);a.attr("aria-selected",!0);this._setActiveTabPanel(a)}.bind(this),1)},addEventHandlers:function(a){this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.onClick);this.element.on("focus",this.onFocus.bind(this));this.element.on("blur",this.onBlur.bind(this));this.element.on("keydown",this.onKeyDown.bind(this))},
onClick:function(a,b,c){this.handleElementClickEvent(a,b,c);this.isTabList&&this._getButtons().each(function(b,c){a===c&&this._setButtonCheckedById(c.id)}.bind(this));this.focusRadio()},focusRadio:function(a){a&&a.length||(a=this._getButtons().filter(":checked").next("label:visible"));a.length&&(this.element.attr("aria-activedescendant",a.attr("id")),this.getEnabledRadios().removeClass("focus").attr("aria-checked",!1),a.addClass("focus"),a.attr("aria-checked","false"!==a.attr("aria-checked")),this.currentRadio=
a)},getEnabledRadios:function(){return this.element.find("label:visible")},focusButtonSet:function(){this.getChildElement("set").focus()},onFocus:function(){var a=this.element.attr("aria-activedescendant");"undefined"===typeof a&&0<this.getEnabledRadios().length&&(a=this.getEnabledRadios().get(0).id);a&&this.focusRadio(d("#"+a));this.element.addClass("focused")},onBlur:function(){this.element.removeClass("focused")},onKeyDown:function(a){switch(a.which){case R9.globals.keyCodes.SPACE:this.checkCurrentRadio();
break;case R9.globals.keyCodes.UP:case R9.globals.keyCodes.LEFT:this.focusPreviousRadio();break;case R9.globals.keyCodes.DOWN:case R9.globals.keyCodes.RIGHT:this.focusNextRadio();break;default:return!0}return!1},checkCurrentRadio:function(){this.currentRadio&&this.checkRadio(this.currentRadio)},focusPreviousRadio:function(){var a=this.currentRadio.prevAll("label:visible"),b=this.getEnabledRadios(),a=a.length?d(a.get(0)):d(b.get(b.length-1));this.checkRadio(a)},focusNextRadio:function(){var a=this.currentRadio.nextAll("label:visible"),
a=a.length?d(a.get(0)):d(this.getEnabledRadios().get(0));this.checkRadio(a)},checkRadio:function(a){a.click();this.currentRadio.attr("aria-checked",!1);this.focusRadio(a);this.currentRadio.attr("aria-checked",!0)},getCheckedButton:function(){var a=this._getButtons().get(0);this._getButtons().get().some(function(b){if(!0===d(b).prop("checked"))return a=b,!0});return d(a)},getCheckedPair:function(){var a=this.getCheckedButton();return{value:a.val(),title:a.next("label").attr("title")}},getValue:function(){return this.getCheckedButton().val()},
setValue:function(a){this._setButtonCheckedById(a)},setButtonCheckedByValue:function(a){this._setButtonChecked(function(b){return b.val()===a})},setButtonEnabledByValue:function(a,b){this._setButtonEnabled(function(b){return b.val()===a},b)},setButtonLabelByValue:function(a,b){this._getButtonByValue(a).next("label").find(".label-text").text(b)},_setButtonCheckedById:function(a){this._setButtonChecked(function(b){return b.attr("id")===a})},_setButtonEnabledById:function(a,b){this._setButtonEnabled(function(b){return b.attr("id")===
a},b)},_setButtonChecked:function(a){this._getButtons().each(function(b,c){b=d(c);c=!!a(b);b.prop("checked",c);b.attr("aria-checked",c)});this.refresh()},_setButtonEnabled:function(a,b){this._getButtons().each(function(){var c=d(this);!0===a(c)&&(c.prop("disabled",!1===b),c.attr("aria-disabled",!1===b))});this.refresh()},_setActiveTabPanel:function(a){a=d("[id\x3d'%s']".format(a.attr("aria-controls")));a.length&&(this._getButtons().get().reduce(function(a,c){c=d(c).attr("aria-controls");return a.add(d("[id\x3d'%s']".format(c)))},
d()).attr("aria-expanded",!1),a.attr("aria-expanded",!0))},_getButtons:function(){return this.element.find("input."+this.widgetBaseClass)},_getButtonByValue:function(a){return this._getButtons().filter("[value\x3d'"+a+"']")}}))})(jQuery);(function(b){R9.extend("Widgets",{TextInput:function(a,c){this.elementNode=a;this.element=b(this.elementNode);this.validateElement()&&(this.options=b.extend({},this.options,c),this.init())}});R9.extend("Widgets.TextInput",{isTextInput:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"text"==a.type.toLowerCase()},isWidgetControlled:function(a){return"undefined"==typeof document.createElement("input").placeholder}});R9.extend("Widgets.TextInput.prototype",{widgetName:"textinput",
widgetBaseClass:"r9-textinput",widgetPlaceholderClass:"r9-textinput-placeholder-active",elementNode:null,element:null,options:{click:null,change:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("smartyfocus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindFormSubmission();this.element.data(this.widgetName,this);this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode)},validateElement:function(){return R9.Widgets.TextInput.isTextInput(this.elementNode)&&
R9.Widgets.TextInput.isWidgetControlled(this.elementNode)&&void 0===this.element.data(this.widgetName)},bindInputEvent:function(a,b){var c=this;a+="."+this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,a)})},bindFormSubmission:function(){var a=this,b="submit."+a.widgetName+a.element.attr("id"),d="form-pre-submit."+a.widgetName+a.element.attr("id");this.element.parents("form").off(b).on(b,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)});
this.element.parents("form").off(d).on(d,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)})},handleElementFocusEvent:function(a,c){a.disabled||(b(a).val()==b(a).attr("placeholder")&&this.clearPlaceholderText(b(a)),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,c){a.disabled||(0==b.trim(b(a).val()).length&&this.setPlaceholderText(a),this.options.blur&&this.options.blur.apply(this,arguments))},clearPlaceholderText:function(a){a.removeClass(this.widgetPlaceholderClass).val("")},
setPlaceholderText:function(a){b(a).addClass(this.widgetPlaceholderClass).val(b(a).attr("placeholder"))}})})(jq||jQuery);
(function(b){R9.createWidgetClass("text.StyleJamTextInput",b.extend({},R9.Widgets.TextInput.prototype,{widgetPlaceholderClass:"vs-placeholder",inputElement:null,inputState:null,options:{needsPlaceholderSupport:!1,selectOnFocus:!1,inputValidationEnabled:!1,presentationStates:{}},init:function(){this.inputElement=this.inputElement||this.element;this.elementNode=this.inputElement.get(0);this.options.inputValidationEnabled&&(this.inputState=this.getChildElement("inputState"),this.inputError=this.getChildElement("inputError"),
this.inputSuccess=this.getChildElement("inputSuccess"))},addEventHandlers:function(){var a=this;(this.options.needsPlaceholderSupport||this.options.presentationStates)&&this.bindInputEvent("focus",this.handleElementFocusEvent);this.options.needsPlaceholderSupport&&(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));if(this.options.selectOnFocus)a.inputElement.on("focus",
function(){a.inputElement.on("mouseup.a keyup.a",function(b){a.elementNode.setSelectionRange(0,9999);a.inputElement.off("mouseup.a keyup.a").select()})});this.options.inputValidationEnabled&&null!==this.inputState&&this.subscribe("input.validation",a.handleValidation.bind(this));this.options.presentationStates&&this.styleInvalidState()},getValue:function(){return b(this.inputElement).val()},handleElementFocusEvent:function(a,b){this.options.presentationStates&&this.styleInvalidState(!1);R9.Widgets.TextInput.prototype.handleElementFocusEvent.call(this,
a,b)},styleInvalidState:function(a){a?R9.dom.swapClasses(b(this.elementNode),this.options.presentationStates.regular,this.options.presentationStates.invalid):R9.dom.swapClasses(b(this.elementNode),this.options.presentationStates.invalid,this.options.presentationStates.regular)},handleValidation:function(a){a&&a.state&&a.inputEl===this.element.id()&&("error"===a.state&&this.swapClasses(this.inputError,"TextInput__State--hidden","TextInput__State--visible"),"success"===a.state&&this.swapClasses(this.inputSuccess,
"TextInput__State--hidden","TextInput__State--visible"))}}))})(jq||jQuery);(new R9.logger).timeEnd("combined");