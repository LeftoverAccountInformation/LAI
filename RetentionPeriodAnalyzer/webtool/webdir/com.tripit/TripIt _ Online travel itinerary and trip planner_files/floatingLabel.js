!function(pe){$document.ready(function(){function p(){var e=!0;I||ae(!0),P&&(void 0===pe("#cc_number").val()||0!==pe("#cc_number").val().length)||oe(!0);for(var a=0;a<X.length;a++)if(!W[X[a]]){e=!1;break}e?(N.removeClass(U),0===pe('*[data-required-checkbox="1"]').not(":checked").length&&N.prop("disabled",!1)):(N.addClass(U),N.prop("disabled",!0))}function d(e,a){W[e]=a}function u(e){return pe("#"+e.attr("id")+"-label")}function n(e){return e.parents(J).children(".requirement")}function a(e){var a=pe(e);u(a).addClass(B)}function t(e){e.addClass(M)}function m(e,a){void 0===a&&(a=!0);var o=pe(e),r=pe(n(o));t(o.parents(J)),u(o).addClass(D),a&&"password-error-text"===r.attr("id")&&r.text("At least "+r.data("min-chars")+" characters. Cannot be an email."),r.addClass(Y)}function h(e){var a=pe(e);a.parents(J).removeClass(M),u(a).removeClass(D),n(a).removeClass(Y)}function o(e){var a=g.determineCardType(e),o="0";switch(V=!0,a){case"unknown":V=!(o="-26px");break;case"v":o="-52px";break;case"m":o="-78px";break;case"a":o="-104px";break;case"d":o="-130px";break;default:V=!1}p(),pe("#credit-card-sprites").css("background-position-y",o)}function f(){var e=pe("#cc_exp_year").val(),a=pe("#cc_exp_month").val(),o=pe("#cc_exp_year").parent().parent();$<e||A<=a?(d("cc_exp_date",!0),o.removeClass(M)):(d("cc_exp_date",!1),t(o)),p()}function v(){var e="cc_cvv",a=pe("#"+e).val().length;2<a&&a<5?(h("#cc_cvv"),d(e,!0)):0<a&&(m("#cc_cvv"),d(e,!1)),p()}function _(){var e="cc_zip",a=pe("#"+e).val().length;2<a?(h("#cc_zip"),d(e,!0)):0<a&&(m("#cc_zip"),d(e,!1)),p()}function c(){Q.removeClass("promo-code-success promo-code-failure").css("display","inherit").text("Promo Code")}var e,r,l,s=window.TRIPIT,b=new s.util.Validation,g=new s.util.CreditCard,k="#cc_number, #cc_number_compact, #cc_number_compact_mobile",x=pe("#cc-disclaimer"),w="#cc-disclaimer .checkbox-wrapper input",C=pe("#cc-information"),y=null,$=pe("#cc_exp_year").val(),A=pe("#cc_exp_month").val(),T=pe("#header-text"),q=T.data("product"),z="#initial-disclaimer",E=pe(z+"-wrapper"),P=!0,V=!1,I=!pe(".create-account-wrapper"),S="floating-label-input",B=S+"-filled",D=S+"-error",G=".input-with-floating-label",O=pe("#promo-code-apply"),R=pe("#promo-campaign-token-code"),F=pe("#promo-code-helper"),Q=pe("#promo-campaign-token-code-label"),Y="error-text-holder",H="input-wrapper",J="."+H,K=J+"[data-error]",L=H+"-focus",M=H+"-error",N=pe("#signup-submit-btn"),U="should-not-enable",W={},X=pe(".validate").map(function(){return pe(this).attr("id")}).toArray(),Z=[],ee=null,ae=function(a){Z.forEach(function(e){W[e]=a})},oe=function(a){ee.forEach(function(e){W[e]=a})},re=function(e){O.prop("disabled","true"),R.val(""),C.show(),m("#promo-campaign-token-code"),Q.addClass("promo-code-failure").removeClass("floating-label-input-filled floating-label-input-error").text("Invalid promo code: "+e),p()},ne=function(d){O.prop("disabled",!0),d="string"==typeof d?d:R.val(),pe.ajax({type:"GET",url:"/pro/isValidPromo",data:{promo_code:d},dataType:"json",success:function(e){var a,o,r=e.result_map,n=r.billing_package_id,t=r.is_payment_info_required,i=r.is_trial,c=r.package_description,l=r.promo_campaign_image_url,s=r.promo_campaign_image_alt;pe("#inner-package-description").html(c),pe("form#fmAccount input[name='billing_package_id']").val(n),pe("form#fmAccount input[name='is_promo_code_applied']").val(!0),l?(pe("#promo-image-holder").html('<div id="sponsor-wrapper"></div>'),pe("#sponsor-wrapper").html('<span id="sponsor-label">Brought to you by</span><img id="sponsor-img"/>'),pe("#sponsor-img").attr("src",l).attr("alt",s)):s&&(s=pe("<div/>").text(s).html(),pe("#promo-image-holder").html('<div id="sponsor-wrapper"></div>'),pe("#sponsor-wrapper").html('<span id="sponsor-label">Brought to you by '+s+"</span>")),t||(P=!1,C.hide(),ce(),oe(!0),p()),i?de():se(),a=d,o="Promo code ",pe(window).width()<600&&(o=""),F.removeClass("error-text-holder"),O.html("Remove").attr("id","promo-code-remove").prop("disabled",!1),R.css("display","none"),Q.addClass("promo-code-success").removeClass("promo-code-failure floating-label-input-filled").css("display","inherit").text("").append(o+"<b>"+a+"</b> applied"),pe("#promo-ask").hide()},error:function(){re(d),O.prop("disabled",!0)}})},te=function(){""!=R.val()?O.prop("disabled",!1):O.prop("disabled",!0)},ie=function(){var e=pe("#promo-code-wrapper");"none"===e.css("display")?(e.show(400),te()):e.hide(400)},ce=function(){x.addClass("hidden"),pe(w).each(function(){pe(this).attr("data-required-checkbox",0)})},le=function(){x.removeClass("hidden"),pe(w).each(function(){pe(this).attr("data-required-checkbox",1)}),pe("#initial-disclaimer-wrapper").hasClass("trial_ineligible")?pe(this).attr("data-required-checkbox",0):pe(this).removeClass("hidden")},se=function(){T.text("Start "+q+" Today!"),E.addClass("hidden"),pe(z).attr("data-required-checkbox",0)},de=function(){T.text("Start Your Free "+q+" Trial Today!"),E.hasClass("trial_ineligible")||(E.removeClass("hidden"),pe(z).attr("data-required-checkbox",1))};X.forEach(function(e){W[e]=!1,-1===e.indexOf("cc_")&&Z.push(e)}),X.includes("cc_number")&&(X.push("cc_exp_date"),W.cc_exp_date=!0),ee=X.map(function(e){if(-1!==e.indexOf("cc"))return e}),$document.on("focus",G,function(){a(this)}),$document.on("blur",G,function(){var e;""===(e=pe(this)).val()&&u(e).removeClass(B);var a,o,r,n,t,i,c,l,s=pe(this).attr("id");if("home_airport"!==s&&0!==pe(this).val().length)switch(s){case"email_address":l=pe(c="#"+(i="email_address")).val(),b.isEmailValid(l)?(h(c),d(i,!0)):0<l.length&&(m(c),d(i,!1)),p();break;case"password":t=pe(n="#password").val(),b.isPasswordValid(t)?(h(n),d("password",!0)):0<t.length&&(m(n),d("password",!1)),p();break;case"cc_number":o=pe(a="#cc_number").val(),r=o.length,o=o.replace(/ /g,"").replace(/-/g,"").replace(/\*/g,"1"),0==r?(h(a),d("cc_number",!0)):(f(),_(),v(),r<13||16<r||!V||!o.match(/^[0-9]*$/)?(m(a),d("cc_number",!1)):(h(a),d("cc_number",!0))),p();break;case"cc_cvv":v();break;case"cc_zip":_()}}),$document.on("blur","#cc_exp_month",f),$document.on("blur","#cc_exp_year",f),$document.on("focus",J,function(){pe(this).addClass(L),pe(this).removeClass(M)}),$document.on("blur",J,function(){pe(this).removeClass(L),p()}),pe(G).each(function(){""!==pe(this).val()&&u(pe(this)).addClass(B)}),pe(K).each(function(){var e,a=(e=pe(this),"#"+pe(e).find("input").attr("id")),o=!0;"login"===pe("body").data("js-action")&&(o=!1),m(a,o)}),pe(K).each(function(){return pe(this).children("p").children("input").select(),!1}),pe(J).on("click",function(){pe(this).children("p").children("input").focus()}),pe("input").on("webkitAnimationStart animationstart",function(e){a("#"+e.target.id)}),$document.on("keyup",k,function(){var e=pe(this).val();o(e),y=e}),$document.on("blur",k,function(){var e=pe(this),a=e.val();o(a),function(e){var a=e.val().replace(/ /g,"").replace(/-/g,""),o=a.length,r="",n=0;for(16<o?n=o-12:13<=o&&(n=4),i=0;i<o-n;i++)r+="*";for(j=0;j<n;j++)r+=a[o-(n-j)];e.val(r)}(e)}),$document.on("focus",k,function(){pe(this).val(y),o(y)}),$document.on("keyup","#cc_zip",function(){var e="cc_zip";2<pe("#"+e).val().length?d(e,!0):d(e,!1),p()}),$document.on("click","#promo-code-apply",ne),$document.on("click","#promo-code-remove",function(){var r=pe("#promo-code-remove");r.prop("disabled",!0),pe.ajax({type:"GET",url:"/pro/removePromo",success:function(e){var a=e.result_map.billing_package_id,o=e.result_map.package_description;pe("form#fmAccount input[name='billing_package_id']").val(a),pe("form#fmAccount input[name='is_promo_code_applied']").val(0),r.html("Apply"),r.attr("id","promo-code-apply"),C.show(),le(),pe("#inner-package-description").html(o),pe("#promo-image-holder").html(""),R.val("").css("display","inherit"),Q.removeClass("floating-label-input-filled"),pe("#promo-ask").show(),C.show(),c(),te(),p(),de()},error:function(){r.prop("disabled",!1)}}),d("cc_exp_date",P=!0),p()}),$document.on("keyup","#promo-campaign-token-code",te),$document.on("click","#promo-campaign-token-code",function(){Q.hasClass("floating-label-input-filled")&&c()}),$document.on("submit","#fmAccount",function(){return pe(k).val(y),!0}),$document.on("click","#form-submit button",function(){pe("#form-submit").hide(),pe("#form-part-3").slideDown()}),pe("#promo-ask").on("click",function(e){e.preventDefault(),ie()}),e=pe("#promo-code-wrapper"),r=e.data("valid-promo"),l=e.data("invalid-promo"),r?(ie(),ne(r)):l&&(ie(),re(l))})}(jQuery);