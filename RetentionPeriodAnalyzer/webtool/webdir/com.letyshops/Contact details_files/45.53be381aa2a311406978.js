(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{1115:function(t,e,i){"use strict";i.r(e);var n=i(1186),s=i(998);for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);var r=i(2),o=Object(r.a)(s.default,n.a,n.b,!1,null,null,null);o.options.__file="index.vue",e.default=o.exports},1116:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.TYPES=["pl_bronze","pl_silver","pl_gold","pl_premium_on","pl_premium_end","cashback_insert","cashback_status_approved","cashback_status_denied","cashback_change_cart","ps_insert_referal","ps_insert_cashback","ps_cashback_approved","ps_cashback_denied","ps_change_cashback","user_birthday"]},1148:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.hide,expression:"hide"}],staticClass:"b-header__top-item b-notifications header-separator",class:{"b-drop-down--active":t.open}},[i("div",{staticClass:"b-notifications__trigger",on:{click:t.toggle}},[i("div",{staticClass:"b-notifications__label"},[i("svgIcon",{class:{"ring-animate":t.ringBell},attrs:{name:"ls-notifications"}}),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.newNotificationsCount>0?i("div",{staticClass:"b-notifications__label-indicator"},[t._v("\n                        "+t._s(t.newNotificationsCount>99?"99+":t.newNotificationsCount)+"\n                ")]):t._e()])],1)]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.open?i("div",{ref:"notifications-drop-down",staticClass:"b-notifications__drop-down"},[i("transition",{attrs:{name:"fade"}},[t.process?t._e():i("div",{ref:"scrollbar"},[i("list",{ref:"listComponent",attrs:{currentStatus:t.currentStatus,limit:t.limit,unreadList:t.unreadList,readList:t.readList,process:t.process,showLoadMore:t.showLoadMore,loadMoreProcess:t.loadMoreProcess,dropDownEl:t.$refs["notifications-drop-down"]},on:{loadMore:t.loadMore,initScrollbar:t.initScrollbar,markAsRead:t.markAsRead}})],1)]),t._v(" "),t.process?i("div",{staticClass:"b-notifications__empty"},[i("svgSpinner",{staticClass:"b-spinner b-spinner--blue b-spinner--inline"})],1):t._e()],1):t._e()])],1)},s=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return s})},1186:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"notifications-sections",staticClass:"b-notifications__sections"},[i("div",{ref:"top-of-list",staticClass:"b-notifications__top"},[i("div",{staticClass:"text-gray"},[t._v("\n\t\t\t"+t._s(t.$t("headerNotifications.newNotifications"))+"\n\t\t")]),t._v(" "),t.emptyUnreadList?t._e():i("span",{staticClass:"like-a-link link-decor-inverse",on:{click:function(e){t.markAsRead(null,1)}}},[t._v("\n\n\t\t\t"+t._s(t.$t("headerNotifications.checkLikeReadAll"))+"\n\t\t")])]),t._v(" "),i("ul",{ref:"notificationListNew",staticClass:"b-notifications__list"},t._l(t.unreadList,function(e,n){return i("li",{key:n,ref:"notificationListItem",refInFor:!0,staticClass:"b-notifications__list-item b-notifications__list-item--unread-items",class:{"new-unread":"2"!==e.status},attrs:{"data-index":n}},[i("div",{staticClass:"b-notifications__item"},[i("div",{staticClass:"b-notifications__item-text"},[i("svgIcon",{staticClass:"b-notifications__item-icon",attrs:{name:"ls-"+t.getIconNotification(e)}}),t._v(" "),i("div",{domProps:{innerHTML:t._s(e.message)}})],1)])])})),t._v(" "),t.unreadList.length?t._e():i("div",{staticClass:"b-notifications__empty"},[t._v("\n\n\t\t"+t._s(t.$t("headerNotifications.empty"))+"\n\t")]),t._v(" "),t.readList.length?i("div",{staticClass:"b-notifications__top"},[i("div",{staticClass:"text-gray"},[t._v("\n\t\t\t\t"+t._s(t.$t("headerNotifications.earlyNotifications"))+"\n\t\t\t")])]):t._e(),t._v(" "),i("ul",{ref:"notificationListOld",staticClass:"b-notifications__list"},t._l(t.readList,function(e,n){return i("li",{key:n,ref:"notificationListItem",refInFor:!0,staticClass:"b-notifications__list-item",class:{"new-items":t.highlightCondition(t.unreadList.length+n)},attrs:{"data-index":t.unreadList.length+n}},[i("div",{staticClass:"b-notifications__item"},[i("div",{staticClass:"b-notifications__item-text"},[i("svgIcon",{staticClass:"b-notifications__item-icon",attrs:{name:"ls-"+t.getIconNotification(e)}}),t._v(" "),i("div",{domProps:{innerHTML:t._s(e.message)}})],1)])])})),t._v(" "),t.showLoadMore?i("div",{ref:"notifications-more-link",staticClass:"b-notifications__more-link"},[i("svgSpinner",{staticClass:"b-spinner b-spinner--blue b-spinner--inline"})],1):t._e()])},s=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return s})},794:function(t,e,i){"use strict";i.r(e);var n=i(1148),s=i(996);for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);var r=i(2),o=Object(r.a)(s.default,n.a,n.b,!1,null,null,null);o.options.__file="index.vue",e.default=o.exports},996:function(t,e,i){"use strict";i.r(e);var n=i(997),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e.default=s.a},997:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(i(166)),s=a(i(1115));function a(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(s,a){try{var r=e[s](a),o=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}("next")})}}e.default={name:"header-notifications",props:{notificationsCount:{type:Number}},data:function(){return{open:!1,process:!1,loadMoreProcess:!1,newNotificationsCount:0,limit:10,currentStatus:1,showLoadMore:!0,page:1,ringBell:!1,showIndicator:!1,uniqueIds:[],status:{unread:1,read:2},allData:[]}},components:{List:s.default},computed:{isUnreadStatus:function(){return this.currentStatus===this.status.unread},isReadStatus:function(){return this.currentStatus===this.status.read},unreadList:function(){var t=this;return this.allData.filter(function(e){return e.status===t.status.unread})},readList:function(){var t=this;return this.allData.filter(function(e){return e.status===t.status.read})},scrollToCondition:function(){return!this.$isMobileDevice&&this.uniqueIds.length&&this.allData.length>this.limit&&this.page>1}},watch:{open:function(t){t?document.body.classList.add("mobile-overflow"):document.body.classList.remove("mobile-overflow")}},mounted:function(){this.getNewOnMount()},methods:{hide:function(){this.open=!1,this.updateMessageStatus()},toggle:function(){this.open=!this.open,this.clearNewNotification(),this.open?!this.process&&(this.allData.length<=0||this.isUnreadStatus)&&this.getNotifications():this.hide()},updateMessageStatus:function(){var t=this;this.allData.forEach(function(e){var i=e;e.status===t.status.unread&&(i.status=t.status.read)})},getNewOnMount:function(){var t=this;this.notificationsCount&&(this.newNotificationsCount=this.notificationsCount,this.ringBell=!0,this.showIndicator=!0,this.currentStatus=this.status.unread,this.page=1,setTimeout(function(){t.ringBell=!1},1e3))},getNotifications:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.toggleProcess(),e.prev=1,i=t.isUnreadStatus?0:t.page,e.next=5,n.default.getNotifications({limit:t.limit,page:i,status:t.currentStatus});case 5:s=e.sent,a=s.data,t.allData=[].concat(r(a.data)),t.showLoadMore=!0,t.checkListLength(a),t.isUnreadStatus&&a.data.length&&t.markAsRead(a.data),t.toggleProcess(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),t.handleErrorNewNotifications(e.t0);case 17:case"end":return e.stop()}},e,t,[[1,14]])}))()},loadMore:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loadMoreProcess||!t.showLoadMore){e.next=24;break}return t.toggleLoadMoreProcess(),t.isReadStatus&&(t.page+=1),i=t.isUnreadStatus?0:t.page,e.prev=4,e.next=7,n.default.getNotifications({limit:t.limit,page:i,status:t.currentStatus});case 7:if(s=e.sent,a=s.data,t.isUnreadStatus&&t.markAsRead(a.data),!t.checkIfEndUnreadList(a)){e.next=12;break}return e.abrupt("return");case 12:if(!t.checkIfEndReadList(a)){e.next=14;break}return e.abrupt("return");case 14:t.toggleLoadMoreProcess(),t.checkDuplicatedIds(a),t.scrollTo(a),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(4),a=e.t0.data,t.handleErrorLoadMore(a),t.toggleLoadMoreProcess();case 24:case"end":return e.stop()}},e,t,[[4,19]])}))()},checkIfEndUnreadList:function(t){return!(t.data.length||!this.isUnreadStatus)&&(this.currentStatus=this.status.read,this.showLoadMore=!0,this.toggleLoadMoreProcess(),this.page=0,this.loadMore(),!0)},checkIfEndReadList:function(t){return!!(!t.data.length&&this.isReadStatus||this.isAllUnread(t))&&(this.showLoadMore=!1,this.page=1,this.toggleLoadMoreProcess(),!0)},isAllUnread:function(t){return!!t&&(this.isReadStatus&&t.meta.count===this.unreadList.length)},checkDuplicatedIds:function(t){var e=this,i=t.data.filter(function(t){return!e.allData.find(function(e){return e.id===t.id})});this.uniqueIds=i,i.length?this.allData=this.allData.concat(i):this.loadMore()},scrollTo:function(){var t=this;this.$nextTick(function(){var e=t.$refs.listComponent;e&&t.scrollToCondition&&e.scrollToNewItems(t.uniqueIds.length)})},checkListLength:function(t){!t.data.length&&this.isUnreadStatus&&(this.currentStatus=this.status.read,this.getNotifications()),!t.data.length&&this.isReadStatus&&(this.showLoadMore=!1)},getNew:function(){this.toggleProcess()},clearNewNotification:function(){this.newNotificationsCount=0,this.showIndicator=!1},toggleProcess:function(){this.process=!this.process},toggleLoadMoreProcess:function(){this.loadMoreProcess=!this.loadMoreProcess},initScrollbar:function(){var t=this.$refs.scrollbar;t&&(this.$isMobileDevice||this.$vuebar.initScrollbar(t,{preventParentScroll:!0}))},markAsRead:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o(regeneratorRuntime.mark(function s(){var a,r;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(a=e?e.map(function(t){return t.id}):[],r={notification_ids:a,notification_status:i},t.readProcess){s.next=16;break}return t.readProcess=!0,s.prev=4,s.next=7,n.default.readNotifications(r);case 7:200===s.sent.status&&1===i&&t.updateStateAfterRead(),t.readProcess=!1,s.next=16;break;case 12:s.prev=12,s.t0=s.catch(4),t.readProcess=!1,t.handleCommonError(s.t0);case 16:case"end":return s.stop()}},s,t,[[4,12]])}))()},updateStateAfterRead:function(){var t=this;this.currentStatus=this.status.read,this.updateMessageStatus(),this.$nextTick(function(){var e=t.$refs.listComponent;e&&e.updateObserver()})},handleErrorNewNotifications:function(){this.hide(),this.toggleProcess()},handleErrorLoadMore:function(t){this.toggleLoadMoreProcess(),this.handleCommonError(t)},handleCommonError:function(t){t&&t.message}}}},998:function(t,e,i){"use strict";i.r(e);var n=i(999),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e.default=s.a},999:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1116);i(795),e.default={props:{unreadList:{type:Array},readList:{type:Array},loadMoreProcess:{type:Boolean},showLoadMore:{type:Boolean,default:!1},dropDownEl:{type:HTMLDivElement},limit:{type:Number},process:{type:Boolean}},watch:{loadMoreProcess:function(t){var e=this;t||this.$nextTick(function(){e.updateObserver()})}},data:function(){return{indexToHighlight:null,observer:null,currentPosition:0}},mounted:function(){this.$emit("initScrollbar"),this.createObserver()},destroyed:function(){this.observer.disconnect()},computed:{emptyUnreadList:function(){return 0===this.unreadList.length}},methods:{createObserver:function(){var t={root:this.dropDownEl,threshold:0};this.observer=new IntersectionObserver(this.handleIntersect,t),this.updateObserver()},updateObserver:function(){var t=this,e=this.$refs["notifications-sections"].querySelectorAll("[data-index]");e&&[].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(e)).map(function(e){t.observer.observe(e)})},handleIntersect:function(t,e){var i=this;t.forEach(function(t){t.isIntersecting&&(i.isLoadMoreCondition(t.boundingClientRect.bottom)&&i.isNotTop()&&i.$emit("loadMore"),t.target.classList.contains("new-unread")&&t.target.classList.remove("new-unread"))})},isNotTop:function(){var t=this.$refs["top-of-list"];if(this.$isMobileDevice||this.readList.length<this.limit)return!0;if(!t||!this.emptyUnreadList)return!0;var e=t.getBoundingClientRect().top;return Math.round(e)<0},isLoadMoreCondition:function(t){var e=this.$refs["notifications-more-link"];if(e){var i=e.getBoundingClientRect().top;return e&&Math.round(t)>=Math.round(i)}},getIconNotification:function(t){return n.TYPES.find(function(e){return e===t.subtype})?"cashback"===t.type?t.subtype+"-"+this.$user.balanceCurrency.toLowerCase():t.subtype:"notifications"},markAsRead:function(t,e){this.$emit("markAsRead",t,e)},scrollToNewItems:function(t){var e=this.$refs["notifications-sections"],i=e&&e.querySelectorAll("[data-index]");if(i){this.currentPosition=i.length-t;var n=i[this.currentPosition];this.scrollToEl(n)}},scrollToEl:function(t){if(t){var e={container:this.$el,easing:"linear",offset:-200,force:!0,cancelable:!0,x:!1,y:!0};this.$scrollTo(t,200,e)}},highlightCondition:function(t){return this.currentPosition&&t>=this.currentPosition}}}}}]);