function configureIcons(e){var n=ionic.Platform.isIOS();e.backicon=n?"ion-ios-arrow-left":"ion-android-arrow-back",e.refreshicon=n?"ion-ios-refresh-empty":"ion-android-refresh",e.addicon=n?"ion-ios-plus-empty":"ion-android-add",e.searchicon=n?"ion-ios-search-strong":"ion-android-search",e.closeicon=n?"ion-ios-close-empty":"ion-android-close"}var ioncmtCommonModules=["CoreModule","CoreUiModule","AccountModule","AuthModule","AnalyticsModule","aCarousel"],commonModule=angular.module("CommonModule",ioncmtCommonModules.concat("ionic"));commonModule.constant("IONCMT_COMMON_MODULES_LIST",ioncmtCommonModules),commonModule.constant("IONCMT_DEFAULT_LANG","en"),commonModule.constant("IONCMT_SUPPORTED_LANGS",getContext("applicationConfig.supportedLanguages",["de","en","es","fr","it","ja","pt-BR","pt-PT","ru","sv","zh-CN"])),commonModule.constant("IONCMT_LOCALE_TO_LANG_MAPPING",{"de_*":"de","en_*":"en","es_*":"es","fr_*":"fr","it_*":"it","ja_*":"ja",pt_BR:"pt_BR","pt_*":"pt_PT","ru_*":"ru","sv_*":"sv","zh_*":"zh_CN"}),commonModule.config(["$httpProvider","$compileProvider","$translateProvider","$localeProvider","$translatePartialLoaderProvider","$ionicConfigProvider","$sceDelegateProvider","I18nConfigProvider","$logProvider","IONCMT_DEFAULT_LANG","IONCMT_SUPPORTED_LANGS","IONCMT_LOCALE_TO_LANG_MAPPING","$locationProvider",function(e,n,t,o,i,r,a,u,c,s,l,d,g){if(document.body.className=document.body.className.replace("no-javascript",""),g.hashPrefix(""),getContext("applicationConfig.remoteLogEnabled",!1)){var f=window._LTracker||[];f.push({logglyKey:getContext("applicationConfig.remoteLogKey"),sendConsoleErrors:!1,tag:"CheckMyTrip-Mobile-"+getContext("featureConfig.loggly.TAG")+"-"+getContext("OCTX","TCPROD"),forceHTTPS:!0})}var p=getContext("applicationConfig.angularDebugEnabled",!0),m=5===getContext("applicationConfig.logLevel",5);c.debugEnabled(p);var v=angular.injector(["ng"]).get("$log");m&&v.debug("Configuring debug settings"),n.debugInfoEnabled(p),n.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|geo|market):/),m&&v.debug("Configuring HTTP headers and interceptors"),getContext("isMobileApp")&&e.interceptors.push("AppUpgradeResponseInterceptor"),e.interceptors.push("TimeoutRequestInterceptor"),e.interceptors.push("AuthenticationRequestInterceptor"),e.interceptors.push("AuthenticationResponseInterceptor"),e.interceptors.push("RequestInterceptor"),e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",m&&v.debug("Configuring Strict Contextual Escaping");var C=a.resourceUrlWhitelist();C.push(getContext("server")+"**"),a.resourceUrlWhitelist(C),m&&v.debug("Configuring translations/localizations"),u.detectAndConfigureLanguagesAndLocales({IONCMT_DEFAULT_LANG:s,IONCMT_SUPPORTED_LANGS:l,IONCMT_LOCALE_TO_LANG_MAPPING:d}),i.addPart("common"),m&&v.debug("Configuring ionic"),r.backButton.text(""),r.tabs.position("bottom"),r.navBar.positionPrimaryButtons("right"),window.adjustIonicFunctionalitiesForIE();var h=(new UrlService).parseQueryString(window.location.search);h.ST&&(v.warn("Overriding SITECODE from URL to "+h.ST),setContext("SITECODE",h.ST)),h.LN&&(v.warn("Overriding LANGUAGE from URL to "+h.LN),setContext("LANGUAGE",h.LN)),h.OCTX&&(v.warn("Overriding OCTX from URL to "+h.OCTX),setContext("OCTX",h.OCTX))}]),commonModule.run(["$log","$rootScope","$state",function(e,n,t){e=e.getInstance("CommonModule"),e.info("Module started"),configureIcons(n),n.$state=t,ApplicationContext.config=ApplicationContext.config||{}}]);var ioncmtWebDesktopModules=["ncy-angular-breadcrumb","TaxiModule","ParkcloudModule","MiscModule","ActivitiesModule","EtrMgmtModule","FaqModule","aCarousel","ItmngtModule","SeatMapModule","CurrencyConverterModule","LoungeModule","CarRentalModule"];window.webDesktopModule=angular.module("WebDesktopModule",["CommonModule"].concat(ioncmtWebDesktopModules)),window.webDesktopModule.constant("IONCMT_WEB_DESKTOP_MODULES_LIST",ioncmtWebDesktopModules),window.webDesktopModule.constant("IONCMT_MODULES_LIST",ioncmtCommonModules.concat(ioncmtWebDesktopModules)),window.webDesktopModule.config(["$translatePartialLoaderProvider","$ionicConfigProvider",function(e,n){var t=getContext("applicationConfig.dataManagerKeyPrefix","");setContext("applicationConfig.dataManagerKeyPrefix",getContext("SITECODE",t)+":"),n.views.transition("none"),n.scrolling.jsScrolling(!1)}]),window.webDesktopModule.run(["$log","MainOrchestratorService","AnalyticsService","GoogleWebAnalyticsService","LocalyticsWebAnalyticsService","TagManagerService","$rootScope","IframeBridgeAnalyticsService","SurveyHandler","OneTrustCookiesService",function(e,n,t,o,i,r,a,u,c,s){e=e.getInstance("WebDesktopModule"),e.info("Module started"),t.init({sendTime:!0,registerOnException:!0}),o.init(),i.init(),r.init(),n.init(),u.init(),a.$on("$stateChangeSuccess",function(e,n){document.body.scrollTop=0}),c.init(),s.init()}]),commonModule.provider("CommonRouting",["$stateProvider","$urlRouterProvider",function(e,n){var t=angular.injector(["ng"]).get("$log"),o=this;o.overriddenRoute={},o.MODULES_LIST=[];var i=function(e,n,t,o){var i=angular.extend({},e);return t&&o&&(i.parent=t,i.views={},i.views[o]={templateUrl:e.templateUrl,controller:e.controller},delete i.controller,delete i.templateUrl),n&&(i=angular.extend(i,n)),i},r=function(e,n){for(var t=null,o=0;o<e.length;o++){var i=angular.module(e[o]);if(t=safeAccess(i,"routes."+n,!1)?i.routes[n]:r(i.requires,n))break}return t};o.overrideRoute=function(e,n,a,u){var c=r(o.MODULES_LIST,e);isDefined(c)?o.overriddenRoute[e]=i(c,n,a,u):t.warn("[CommonRoutingProvider] "+e+" not found in any module")},o.duplicateRoute=function(e,n,a,u,c){var s=r(o.MODULES_LIST,e);isDefined(s)?o.overriddenRoute[n]=i(angular.copy(s),a,u,c):t.warn("[CommonRoutingProvider] "+e+" not found in any module")},o.applyRoute=function(t,i){var r={};r=angular.extend(r,t);for(var a=0;a<o.MODULES_LIST.length;a++){var u=angular.module(o.MODULES_LIST[a]);isDefined(u.routes)&&(r=angular.extend(r,u.routes)),r=o.updateRouteDependencies(u,r)}r=angular.extend(r,o.overriddenRoute);for(var c in r)e.state(c,r[c]);n.otherwise(i)},o.updateRouteDependencies=function(e,n){return e.requires.map(function(e){return angular.module(e)}).filter(function(e){return isDefined(e.routes)}).map(function(e){n=angular.extend(n,e.routes),n=o.updateRouteDependencies(e,n)}),n},o.$get=function(){return o}}]),webDesktopModule.config(["CommonRoutingProvider","IONCMT_MODULES_LIST",function(e,n){var t={"default-routing":{url:"/default-routing",controller:"DefaultRoutingController"}};e.MODULES_LIST=n,e.overrideRoute("seatMap",{defaultBackState:"triplist"}),e.overrideRoute("weatherDetails",{defaultBackState:"triplist"}),e.applyRoute(t,"/default-routing")}]),commonModule.controller("DefaultRoutingController",["$log","$timeout","AuthenticationService","OrchestratorChiefService",function(e,n,t,o){e=e.getInstance("DefaultRoutingController"),e.info("Controller Started..."),n(function(){o.next({islogged:t.isLogged()})},0)}]),commonModule.service("MenuHandler",["$state","$log","$rootScope","MenuService","OrchestratorChiefService","AuthenticationService","$q","TripAnalyticsService","AnalyticsService",function(e,n,t,o,i,r,a,u,c){n=n.getInstance("MenuHandler"),n.info("Handler Started...");var s={init:function(){var n=[],t=o.addItem({label:"common.navigation.link.timeline",condition:function(){return r.isLogged()},icon:"icon-timeline-active",name:"tab-triplist",isActive:function(){return safeAccess(window,"itmngtModule.routes."+e.current.name,!1)||safeAccess(window,"seatMapModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){i.navigateTo("triplist")})});return n.push(t),t=o.addItem({label:"common.navigation.link.taxi",condition:function(){return getContext("featureConfig.taxiBooking.enabled",!1)&&r.isLogged()},icon:"icon-taxi-booking-active",name:"tab-taxi",isActive:function(){return safeAccess(window,"taxiModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){i.navigateTo("taxi")})}),n.push(t),t=o.addItem({label:"common.navigation.link.parking",condition:function(){return getContext("featureConfig.parkcloud.enabled",!1)&&r.isLogged()},icon:"icon-parking",name:"tab-parking",isActive:function(){return safeAccess(window,"parkcloudModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){i.navigateTo("parking")})}),n.push(t),t=o.addItem({label:"common.navigation.link.restaurant",condition:function(){return getContext("featureConfig.restaurantBooking.enabled",!1)&&r.isLogged()},icon:"icon-restaurant",name:"tab-restaurant",isActive:function(){return safeAccess(window,"restaurantModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){i.navigateTo("restaurant")})}),n.push(t),t=o.addItem({label:"common.navigation.link.lounge",condition:function(){return getContext("featureConfig.loungeBooking.enabled",!1)&&r.isLogged()},icon:"icon-lounge",name:"tab-lounge",isActive:function(){return safeAccess(window,"loungeModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){i.navigateTo("lounge")})}),n.push(t),t=o.addItem({label:"common.navigation.link.activities",condition:function(){return getContext("featureConfig.activitiesBooking.enabled",!1)&&r.isLogged()},icon:"icon-activity",name:"tab-activities",isActive:function(){return safeAccess(window,"activitiesModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){i.navigateTo("activities")})}),n.push(t),t=o.addItem({label:"common.navigation.link.settings",icon:"icon-settings",name:"tab-settings",condition:function(){return r.isLogged()},isActive:function(){return safeAccess(window,"accountModule.routes."+e.current.name,!1)||safeAccess(window,"faqModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){i.navigateTo("settings")})}),n.push(t),t=o.addItem({label:"common.navigation.link.explore",icon:"icon-explore",name:"tab-exploreList",condition:function(){return getContext("featureConfig.explore.enabled",!0)&&r.isLogged()},isActive:function(){return safeAccess(window,"exploreModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(e){u.discoverClicked(),i.navigateTo("tripadvisor"===getContext("featureConfig.explore.PROVIDER",!1)?"tripAdvisorMap":"exploreMap",{latitude:null,longitude:null,tripId:null,lastName:null,refId:null})})}),n.push(t),t=o.addItem({label:"common.navigation.link.takeMeThere",icon:"icon-take-me-there",name:"tab-discoverList",condition:function(){return getContext("featureConfig.takeMeThere.enabled",!0)&&r.isLogged()},isActive:function(){return safeAccess(window,"discoverModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){u.directionClicked(),i.navigateTo("genericSearch")})}),n.push(t),t=o.addItem({label:"common.navigation.link.carRental",icon:"icon-car-rental",name:"tab-car-rental",condition:function(){return getContext("featureConfig.carRental.enabled",!1)&&r.isLogged()},isActive:function(){return safeAccess(window,"carRentalModule.routes."+e.current.name,!1)}}).then(function(e){e.onClick(function(){c.runSafe(function(){this.sendEvent("Car rental clicked",[],"TripTool")}),i.navigateTo("car-rental",{touchPoint:"CMT_CAR_TABBAR"})})}),n.push(t),a.all(n)}};return s}]),commonModule.service("SurveyHandler",["$log","$rootScope","LayoutService","DataManagerService","AnalyticsService","$window","ParameterService","I18nConfig","AuthenticationService",function(e,n,t,o,i,r,a,u,c){e=e.getInstance("SurveyHandler"),e.info("Handler Started...");var s={STORAGE_KEY:"SURVEY_SHOWN",CATEGORY:"Feedback",init:function(){var e=a.parse(),n=e.language||u.getCurrentDeviceLanguage();isFeatureEnabled("survey")&&getContext("featureConfig.survey.languages",[]).indexOf(n)>-1&&c.isLogged()&&setTimeout(function(){s.showOrNotSurvey(c.getUser())},getContext("featureConfig.survey.displayDelay",1e3))},showOrNotSurvey:function(n){e.method("showOrNotSurvey");var i=o.get(s.STORAGE_KEY,o.LOCALSTORAGE);if(isUndefined(i)){s.surveyViewed();var a="Help us to improve our services by giving your opinion about CheckMyTrip.",u="We value your feedback!";t.showConfirmPopup(u,a,"Go","Remind me <br/> later").then(function(){s.surveyClicked(),r.open(getContext("featureConfig.survey.url"),"_blank"),o.set(!0,s.STORAGE_KEY,{storage:o.LOCALSTORAGE})},function(){o.set(!0,s.STORAGE_KEY,{storage:o.LOCALSTORAGE,ttl:getContext("featureConfig.survey.displayLater","24h")})})}e.returns()},surveyViewed:function(){return e.method("surveyViewed"),i.runSafe(function(){this.sendEvent("Survey viewed",i.extendDefaultParameterWith(),s.CATEGORY)}),e.returns()},surveyClicked:function(){return e.method("surveyClicked"),i.runSafe(function(){this.sendEvent("Survey clicked",i.extendDefaultParameterWith(),s.CATEGORY)}),e.returns()}};return s}]),commonModule.service("MainOrchestratorService",["$state","$log","LayoutService","$ionicHistory","OrchestratorChiefService","$timeout","AuthenticationService","$window","$location",function(e,n,t,o,i,r,a,u,c){n=n.getInstance("MainOrchestratorService"),n.info("Service Started...");var s={init:function(){i.register(s)},_clearIonicCache:function(){return n.method("_clearIonicCache"),r(function(){o.clearCache(),o.clearHistory()},1500),n.returns()},_navigateToInMainOrchestrator:function(e){n.method("_navigateToInMainOrchestrator");var t={location:"replace"},o=i.navigateTo(e,null,t).then(function(){s._clearIonicCache()});return n.returns(o)},_navigateToTripList:function(){return s._navigateToInMainOrchestrator("triplist")},_navigateToTutorial:function(){return s._navigateToInMainOrchestrator("tutorial")},_navigateToWelcome:function(){return s._navigateToInMainOrchestrator("welcome")},_navigateToLanding:function(){return getContext("isWebDesktop")||getContext("isWebMobile")?s._navigateToLogin():s._navigateToInMainOrchestrator("landing")},_navigateToLogin:function(){u.location.href=c.absUrl().replace(/web-.*\.html/,"web-landing.html").replace(/#.*/,"#/login")},next:function(e){if(n.method("next"),e.isFirstTimeAppRun)return e.hasBranchData?s._navigateToWelcome():s._navigateToTutorial(),n.returns(e);if(e.hasBranchData)return n.returns(e);if(e.isMigrated)return n.returns(e);if(isDefined(e.etrPrefillData))return n.returns(i.navigateTo("explore_"+e.etrType,e.etrPrefillData));switch(e.page){case"settings":if(e.islogged!==!1)return i.check(e);s._navigateToLanding();break;case"edit-profile":if(e.islogged)return i.check(e);s._navigateToLanding();break;case"forgotpassword":s._navigateToLogin();break;case"tutorial":case"welcome":s._navigateToLanding();break;case"":case"application-routing":case"default-routing":case"landing":case"login":case"register":case"activation":case"forgotpassword-activation":if(e.islogged){var t=a.getAndRemoveLandedPage();isDefined(t)?(n.warn("User landed on a secured page before login; overriding navigation"),n.warn('Will go to: "'+t.state.name+'" with params: ',t.params),s._navigateToTripList().then(function(){i.navigateToPage(t)})):s._navigateToTripList()}else s._navigateToLanding();break;default:return i.check(e)}return n.returns(e)},toString:function(){return"MainOrchestratorService"}};return s}]),webDesktopModule.controller("HeaderController",["$log","$scope","$rootScope","AuthenticationService","$state","OrchestratorChiefService","MenuService","MenuHandler","TriplistService","TripService","$ionicPopover","$window",function(e,n,t,o,i,r,a,u,c,s,l,d){function g(){var e=a.listItem({},getContext("applicationConfig.menu.tabBarItems",[]));e.length<=n.maxItemsInBar+1?(n.menuItems=e,n.moreMenuItems=[]):(n.menuItems=e.slice(0,n.maxItemsInBar),n.moreMenuItems=e.slice(n.maxItemsInBar,e.length))}function f(e){n.needSpacedLayout=["settings","notifications-settings","edit-profile"].indexOf(e.name)>-1;var o=["triplist","settings","taxi","parking","login","activities","lounge","car-rental"].indexOf(e.name)>-1;t.displayBreadCrumb=!o&&isDefined(e.ncyBreadcrumb)&&isDefined(e.ncyBreadcrumb.label)}e=e.getInstance("HeaderController"),e.info("Controller Started...");var p={},m={menu:{tripListMainItems:"applicationConfig.menu.tripListMainItems"}},v="Can't retrieve trip for:";n.actionMenuStyle=getContext("applicationConfig.menu.mainMenuStyle","pop-over"),n.isMoreMenuOpen=!1,n.maxItemsInBar=5,u.init().then(function(){g()}),n.updateMenu=function(i,r){switch(i){case"triplist":n.actionMenuList=getContext(m.menu.tripListMainItems,[]),c.getUpcomingTripList().then(function(e){n.actionMenuContext=e.trips});break;case"trip-expanded":isDefined(r)&&(n.actionMenuList=getContext("applicationConfig.menu.tripExpandedMainItems",[]),s.retrieveOrImportTrip(r.tripId,r.lastName,r.firstName,{forceFromServer:!1}).then(function(e){n.actionMenuContext=t.trip=e},function(n){e.warn(v,n)}));break;case"segment-expanded":isDefined(r)&&(isUndefined(n.trip)?s.retrieveOrImportTrip(r.tripId,r.lastName,r.firstName,{forceFromServer:!1}).then(function(e){t.trip=e,n.actionMenuContext=t.segment=s.getSegmentFromTrip(e,r.segmentRefId)},function(n){e.warn(v,n)}):n.actionMenuContext=t.segment=s.getSegmentFromTrip(n.trip,r.segmentRefId));break;case"seatMap":n.actionMenuList=getContext(m.menu.tripListMainItems,[]),n.actionMenuContext={userLogged:o.isLogged()},isDefined(r)&&(isUndefined(n.trip)?s.retrieveOrImportTrip(r.tripId,r.lastName,r.firstName,{forceFromServer:!1}).then(function(e){t.trip=e,t.segment=s.getSegmentFromTrip(e,r.segmentRefId)},function(n){e.warn(v,n)}):t.segment=s.getSegmentFromTrip(n.trip,r.segmentRefId));break;default:n.actionMenuList=getContext(m.menu.tripListMainItems,[]),n.actionMenuContext={userLogged:o.isLogged()}}},n.onApplicationLogoClick=function(){var e=o.isLogged(),n=e?"triplist":"login";r.navigateTo(n)},n.openMoreMenu=function(){var e=t.$new();e.menuItems=n.moreMenuItems;var o=53;e.contentStyle={height:n.moreMenuItems.length*o+"px",width:"227px"},l.fromTemplateUrl("moreMenuPopOver.html",{scope:e}).then(function(t){n._popover=t,e.popoverItemClicked=function(e){n._popover.hide(),e.onClick()},e.$on("popover.shown",function(e,t){t.el.classList.add("menu"),t.el.classList.add("more-menu"),n.isMoreMenuOpen=!0}),e.$on("popover.hidden",function(){n._popover.remove(),n.isMoreMenuOpen=!1}),n._popover.show(n.getCompliantTarget(document.getElementById("more-menu-text")))})},n.getCompliantTarget=function(e){var n=e,t=18;return n.getBoundingClientRect=function(){return{width:n.offsetWidth,height:n.offsetHeight,top:n.offsetTop+t+document.getElementById("mainContainer").offsetTop-(isDefined(d.scrollY)?d.scrollY:d.pageYOffset),left:document.body.clientWidth/2-document.getElementById("mainContainer").offsetWidth/2+n.offsetLeft}},n},n.isActiveMenuEntryInMoreMenu=function(){var e=!1;return n.moreMenuItems.forEach(function(n){n.isActive()&&(e=!0)}),e},t.$on("userLoggedEvent",function(e,t){n.updateMenu(),g()}),t.$on("userLoggedOutEvent",function(e,t){n.updateMenu(),g()}),t.$on("tripAddedEvent",function(e,t){n.updateMenu(p.name,p.params)}),t.$on("$stateChangeSuccess",function(e,t,o,i,r){p={name:t.name,params:o},n.updateMenu(t.name,o),f(t)})}]),webDesktopModule.controller("FooterController",["$log","$scope","$rootScope","$ionicPopover","$window","$timeout","DataManagerService","FeedbackAnalyticsService","I18nConfig","IONCMT_SUPPORTED_LANGS",function(e,n,t,o,i,r,a,u,c,s){function l(e){for(var t=n.supportedLanguages,o=0;o<t.length;o++)if(e===p[t[o]])return t[o]}function d(e){a.set(e,g,{storage:a.LOCALSTORAGE,ttl:a.INFINITE}),window.location.reload()}e=e.getInstance("FooterController"),e.info("Controller Started...");var g="USER_PREFERRED_LOCALE_KEY",f=2,p={English:"en",Deutsch:"de","Español":"es","Français":"fr",Italiano:"it","日本語":"ja","Português (Brasil)":"pt-BR","русский":"ru",Svenska:"sv","简体中文":"zh-CN"},m=function(e){for(var n in p)if(p[n]===e)return n};n.getListOfSupportedLanguages=function(){for(var e=[],t=0;t<s.length;t++){var o=m(s[t]);o&&e.push(o)}return e.sort(),n.sortLanguageList(e,f)};var v=function(e,n){var t=0,o=e.length,i=[];for(t=0;o>t;t+=n){var r=e.slice(t,t+n);i.push(r)}return i};n.sortLanguageList=function(e,n){for(var t=[],o=0,i=0,r=Math.ceil(e.length/n),a=0;a<e.length;a++){i=Math.floor(a/r);var u=i+o*n;t[u]=e[a],o=++o%r}return t},n.getBrowserLanguage=function(){return l(c.getCurrentApplicationLanguage())};var C=function(e){var n=e.currentTarget||e.target,t=16;return n.getBoundingClientRect=function(){return{top:document.getElementById("mainContainer").offsetTop+document.getElementById("footer").offsetTop-t-(i.pageYOffset?document.getElementById("footer").offsetHeight/2:document.getElementById("footer").offsetHeight)-(i.pageYOffset?i.pageYOffset:document.getElementsByTagName("ion-popover-view")[0].offsetHeight),left:i.innerWidth/2-document.getElementById("mainContainer").offsetWidth/2+n.offsetLeft+n.offsetWidth/2-document.getElementsByTagName("ion-popover-view")[0].offsetWidth/2}},n};n.openLanguageSelectionPopover=function(e){var i=t.$new();i.items=v(n.supportedLanguages,f),o.fromTemplateUrl("language-selection-popover.html",{scope:i}).then(function(t){n._popover=t,i.itemClicked=function(e,t){t.isIonicTap&&n._popover.hide(),n.selectedLanguage=e,u.languageSelected(p[e]),d(p[e])},i.$on("popover.shown",function(e,n){n.el.classList.add("language")}),i.$on("popover.hidden",function(){n._popover.remove()}),n._popover.show(C(e))})};var h=function(){e.method("onControllerLoad"),n.supportedLanguages=n.getListOfSupportedLanguages(),n.selectedLanguage=n.getBrowserLanguage(),n.currentYear=(new Date).getFullYear(),e.returns()};h()}]),webDesktopModule.controller("WallpaperAdvertisementController",["$log","$scope","$rootScope","AdvertisementService","$q","ImagesService","TriplistService","LayoutService","$state","$timeout","AuthenticationService",function(e,n,t,o,i,r,a,u,c,s,l){e=e.getInstance("WallpaperAdvertisementController"),e.info("Controller Started..."),n._adModel=null,n.wallpaperAdContainer=angular.element(document.getElementById("wallpaperAdCampaignContainer")),n.clickAd=function(){var e=safeAccess(n._adModel,"refUrl");isDefined(e)&&u.openInExternalBrowser(e)},n._setBackgroundImage=function(e){var t="background-image";isDefined(e)&&isDefined(n.wallpaperAdContainer)?r.preloadImage(e).then(function(e){n.wallpaperAdContainer.addClass("wallpaperAdCampaignContainerDisplayed"),n.wallpaperAdContainer.css(t,"url('"+e+"')")},function(){n.wallpaperAdContainer.removeClass("wallpaperAdCampaignContainerDisplayed"),n.wallpaperAdContainer.css(t,"none")}):(n.wallpaperAdContainer.removeClass("wallpaperAdCampaignContainerDisplayed"),n.wallpaperAdContainer.css(t,"none"))},n.reloadWallpaperAdvertisement=function(){a.getFirstOngoingOrUpcoming().then(function(t){var i=safeAccess(t,"tripId"),r=[{id:"wallpaper",page:"background",type:"wallpaper",tripId:i}],a={requestTimeout:getContext("featureConfig.wallpaperAdvertisement.requestTimeout",15e3)};o.getAdvertisement(r,a).then(function(e){if(1===e.length){var t=e[0];isDefined(t.mediaUrl)&&(n._adModel=t,n._setBackgroundImage(n._adModel.mediaUrl))}},function(n){e.warn(n)})})};var d=function(){getContext("featureConfig.wallpaperAdvertisement.enabled")&&(s(function(){var e=c.current.name;if(l.isLogged())if("triplist"===e||"default-routing"===e)var o=t.$on("triplistUpdatedFromServerEvent",function(){o(),n.reloadWallpaperAdvertisement()});else n.reloadWallpaperAdvertisement()}),t.$on("userLoggedEvent",function(){s(function(){n.reloadWallpaperAdvertisement()},1e3)}))};d()}]);