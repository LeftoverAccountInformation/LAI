function __formatDateTime(e,t,n){var i=n.DateTimeService.getMomentFromBackendDate(e);return i?n.StringService.capitalizedFirst(i.format(t)):""}function __formatSegmentDateTime(e,t,n){var i=n.DateTimeService.getMomentFromBackendDate(e);return i?n.StringService.capitalizedFirst(i.format(t)):""}window.coreConfigModule=angular.module("CoreConfigModule",[]).constant("EMAIL_REGEX",/^\S+@\S+\.\S+$/).constant("PASSWORD_REGEX",/^(?=.*[0-9])(?=.*[a-zA-Z])(.{7,15})$/).constant("NAME_REGEX",/^([a-zA-Z ]){2,25}$/).constant("PNR_REGEX",/^([A-Za-z0-9]{6,10})$/).constant("FLIGHT_NUMBER_REGEX",/^([^\W_]{2}[a-zA-Z]?)?(\d{1,4})[a-zA-Z]?$/).constant("CONFIRMATION_NUMBER_REGEX",/^([A-Za-z0-9]{0,20})$/).constant("DATE_PATTERN",/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/).constant("TIME_PATTERN",/^([0-9]{2}):([0-9]{2})$/),window.coreModule=angular.module("CoreModule",["CoreConfigModule","ionic","ipCookie","pascalprecht.translate"]),window.coreModule.config(["$translatePartialLoaderProvider","$translateProvider","$provide","$qProvider",function(e,t,n,i){function a(e,t,n,i){var a={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?a[n][0]:a[n][1]}e.addPart("core"),i.errorOnUnhandledRejections(!1),t.useMissingTranslationHandler("MissingTranslationHandler"),n.decorator("$exceptionHandler",["$log","$delegate",function(e,t){return function(n,i){isDefined(e.getInstance)&&(e=e.getInstance("Core"));var a=safeAccess(n,"message","No message in exception"),r=safeAccess(n,"stack","at No stack in exception"),o=r.split("at ")[1];e.error(a,o),t(n,i)}}]),moment.updateLocale("en",{relativeTime:{future:"Starts in %s",past:"Ended %s ago",s:"seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"}}),moment.updateLocale("fr",{relativeTime:{future:"Commence dans %s",past:"Terminé il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"}}),moment.updateLocale("de",{relativeTime:{future:"Beginnt in %s",past:"Endete vor %s",s:"ein paar Sekunden",m:a,mm:"%d Minuten",h:a,hh:"%d Stunden",d:a,dd:a,M:a,MM:a,y:a,yy:a}}),moment.updateLocale("it",{relativeTime:{future:"Comincia tra %s",past:"Concluso %s fa",s:"alcuni secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"}}),moment.updateLocale("es",{relativeTime:{future:"Empieza en %s",past:"Terminó hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(e){return e.toString()}}),moment.updateLocale("pt",{relativeTime:{future:"Começa em %s",past:"Acabado há %s",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"}}),moment.updateLocale("zh",{relativeTime:{future:"还有%s 开始",past:"%s 前结束",s:"秒",m:"一分钟",mm:"%d 分钟",h:"一小时",hh:"%d 小时",d:"一天",dd:"%d 天",M:"一个月",MM:"%d 月",y:"一年",yy:"%d 年"}}),moment.updateLocale("ru",{relativeTime:{future:"Начинается через %s",past:"Закончилось %s назад",s:"сек.",m:"минута",mm:"%d мин.",h:"час",hh:"%d ч.",d:"день",dd:"%d дн.",M:"месяц",MM:"%d мес.",y:"год",yy:"%d года"}}),moment.updateLocale("sv",{relativeTime:{future:"Startar om %s",past:"Slutade för %s sedan",s:"sekunder",m:"en minut",mm:"%d minuter",h:"en timma",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en månad",MM:"%d månader",y:"ett år",yy:"%d år"}}),window.cmtSpecificMomentDateFormatters={dayAndMonth:{"default":"Do MMM",ja:"M月D日"},tripdate:{"default":"DD MMM YYYY",ja:"YYYY年M月D日"},tripstart:{"default":"DD[<span>]MMM[</span>]",ja:"M月[<span>]D日[</span>]"},segmentDayLong:{"default":"dddd Do MMMM",ja:"dddd M月D日"},segmentDayLongTwoLines:{"default":"dddd[<br/>]Do MMMM",ja:"dddd[<br/>]M月D日"},segmentDayShort:{"default":"ddd Do MMMM YYYY",ja:"dddd YYYY年M月D日"},segmentDayTimeLong:{"default":"dddd Do MMMM, HH:mm",ja:"dddd YYYY年M月D日, HH:mm"},fullDateTimeTZNoTime:{"default":"dddd Do MMMM YYYY",ja:"dddd YYYY年M月D日"},fullDateTimeTZWithTime:{"default":"dddd Do MMMM YYYY, HH:mm zZ",ja:"dddd YYYY年M月D日, HH:mm zZ"}}}]),window.coreModule.run(["$log","LoggingService","$rootScope","PostMessageService","DataManagerService","NetworkService",function(e,t,n,i,a,r){e=e.getInstance("Core"),e.info("Module started"),a.init(),i.init(),r.init(),n.isDataTapDisabled=!getContext("isWebDesktop",!1)}]),function(e){"use strict";if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(t){}var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},a=n.prototype,r=i.prototype,o=e.FileReaderSync,s=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,d=e.URL||e.webkitURL||e,u=d.createObjectURL,g=d.revokeObjectURL,p=d,m=e.btoa,f=e.atob,v=e.ArrayBuffer,h=e.Uint8Array,S=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(i.fake=r.fake=!0;c--;)s.prototype[l[c]]=c+1;return d.createObjectURL||(p=e.URL=function(e){var t,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=e,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(t=e.match(S),n.origin=t&&t[1])),n}),p.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):m?t+";base64,"+m(e.data):t+","+encodeURIComponent(e.data)):u?u.call(d,e):void 0},p.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&g&&g.call(d,e)},a.append=function(e){var n=this.data;if(h&&(e instanceof v||e instanceof h)){for(var a="",r=new h(e),l=0,c=r.length;c>l;l++)a+=String.fromCharCode(r[l]);n.push(a)}else if("Blob"===t(e)||"File"===t(e)){if(!o)throw new s("NOT_READABLE_ERR");var d=new o;n.push(d.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&f?n.push(f(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},a.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},a.toString=function(){return"[object BlobBuilder]"},r.slice=function(e,t,n){var a=arguments.length;return 3>a&&(n=null),new i(this.data.slice(e,a>1?t:this.data.length),n,this.encoding)},r.toString=function(){return"[object Blob]"},r.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,t){var i=t?t.type||"":"",a=new n;if(e)for(var r=0,o=e.length;o>r;r++)Uint8Array&&e[r]instanceof Uint8Array?a.append(e[r].buffer):a.append(e[r]);var s=a.getBlob(i);return!s.slice&&s.webkitSlice&&(s.slice=s.webkitSlice),s};var i=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=i(new e.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length),t-=e.length;var i=n.indexOf(e,t);return-1!==i&&i===t}),Object.values||(Object.values=function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty(e,n)||t.push(e[n]);return t}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],a=0;n>a;){var r=t[a];if(e.call(i,r,a,t))return r;a++}}}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,i=this.length;i>n;++n)e.call(t,this[n],n,this)}),function(){function e(e){var t="";for(var n in e){t+=n,t+="{";for(var i in e[n])t+=i+":"+e[n][i]+";";t+="}"}return t}function t(e){window.ApplicationContext=window.ApplicationContext||{};for(var t=window.ApplicationContext,n=e.split("."),i=0;i<n.length-1;i++){var a=n[i];if(t[a]||(t[a]={}),!angular.isObject(t[a])||Array.isArray(t[a]))throw new Error("Unable to extract the path '"+e+"' from ApplicationContext; non-object encountered along the path");t=t[a]}return{obj:t,key:n[i]}}window.handleUnexpectedError=function(e){console.warn("Unexpected error inside promise chain:"),console.error(e);var t=angular.element(document.body).injector().get("LayoutService");t&&t.loading(!1)},window.definedOrThrow=function(e,t){if(isUndefined(e)||window.hasUndefined(e))throw new Error(t)},window.hasUndefined=function(e){if(Array.isArray(e)){for(var t=e,n=0,i=t.length;i>n;n++)if("undefined"==typeof t[n])return!0}else if(angular.isObject(e)){for(var a in e)if("undefined"==typeof e[a])return!0}else console.error("hasUndefined: passed param is neither an array nor an object!");return!1},window.isDefined=function(e){return null!==e&&void 0!==e},window.isUndefined=function(e){return!isDefined(e)},window.safeAccess=function(e,t,n){if(window.isUndefined(e))return n;for(var i=t.split("."),a=0,r=i,o=r.length,s=e;o>a;a++){var l=r[a];if(l.indexOf("[")>-1){var c=/(\w*)\[(\d*)\]/.exec(l);l=c[1];var d=""!==l?s[l]:s;if(!isDefined(d)||!isDefined(d[c[2]]))return angular.isFunction(n)?n():n;s=d[c[2]]}else{if(!isDefined(s[l]))return angular.isFunction(n)?n():n;s=s[l]}}return s},window.injectCSSInHead=function(t,n,i){var a=document.getElementsByTagName("head")[0],r=null;if(i=i?i:"screen","string"==typeof t){var o=t;if(o&&o.indexOf(".css")>-1){for(var s=document.getElementsByTagName("link"),l=0;l<s.length;l++)if(s[l].href&&s[l].href===o)return;r=document.createElement("link"),n&&(r.id=n),r.rel="stylesheet",r.type="text/css",r.href=o,r.media=i}}else{var c=e(t);r=document.createElement("style"),n&&(r.id=n),r.styleSheet?r.styleSheet.cssText=c:r.appendChild(document.createTextNode(c)),r.media=i}a.appendChild(r)},window.getContext=function(e,n){var i=t(e),a=i.obj,r=i.key;return isDefined(a[r])?a[r]:n},window.isFeatureEnabled=function(e){return getContext("featureConfig."+e+".enabled",!1)},window.setContext=function(e,n){var i=t(e),a=i.obj,r=i.key;a[r]=n},window.convertCelsiusToFahrenheit=function(e){var t=0;return"string"==typeof e&&(e=parseFloat(e)),isNaN(e)||(t=9*e/5+32,t=parseFloat(t.toFixed(1))),t},window.convertFahrenheitToCelsius=function(e){var t=0;return"string"==typeof e&&(e=parseFloat(e)),isNaN(e)||(t=5*(e-32)/9,t=parseFloat(t.toFixed(1))),t},window.camelCaseToUpperCaseWithUnderscore=function(e){return e.replace(/([A-Z])/g,"_$1").toUpperCase()},window.adjustIonicFunctionalitiesForIE=function(e){if(!getContext("isMobileApp",!1)){var t=window.navigator.userAgent;(t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1||t.indexOf("Edge/")>-1)&&window.addEventListener("click",function(e){"[object PointerEvent]"===Object.prototype.toString.call(e)&&"[object HTMLButtonElement]"===Object.prototype.toString.call(e.target)&&e.stopPropagation()},!0)}},window.isAndroid=function(){return navigator.userAgent.match(/Android/i)},window.isIOS=function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},window.isDesktop=function(){var e={Android:window.isAndroid,BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:window.isIOS,Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return e.Android()||e.BlackBerry()||e.iOS()||e.Opera()||e.Windows()}};return!e.any()},window.isIE=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("msie")>-1||e.indexOf("trident")>-1},window.isEdge=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("edge")>-1},window.isFF=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},window.isChrome=function(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1},window.isSafari=function(){return!window.isChrome()&&navigator.userAgent.toLowerCase().indexOf("safari")>-1},window.getBrowserVersion=function(){var e,t=-1,n=navigator.userAgent;return window.isChrome()&&(e=n.match(/Chrome\/(\d*.\d*)/)),window.isSafari()&&(e=n.match(/Version\/(\d*.\d*)/)),window.isIE()&&(e=n.match(/rv:(\d*.\d*)/)),isDefined(e)&&e.length>1&&(t=parseFloat(e[1])),t}}(),coreModule.service("RequestUtil",function(){function e(e){if(!angular.isObject(e))return null===e||angular.isUndefined(e)?"":e.toString();var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];i=null===i?"":i,t.push(n+"="+encodeURIComponent(i))}var a=t.join("&").replace(/%20/g,"+");return a}return{isRequestManagedExtension:function(e){return null!==e?-1===e.indexOf(".html")&&-1===e.indexOf(".js")&&-1===e.indexOf(".xml"):!1},isResponseManagedExtension:function(e){return null!==e?-1===e.indexOf(".html")&&-1===e.indexOf(".js"):!1},isRequestUrlMatch:function(e,t){if(t)for(var n=0;n<t.length;n++){var i=!0,a=t[n];if("!"===a[0]&&(i=!1,a=a.substr(1)),e.match(a))return i}return!1},getRequestTransform:function(){function t(t,n){return e(t)}return t}}}),function(){function e(){var e=c.__getUserAgent().toLowerCase();return e.indexOf("edge")>-1}function t(){var e=c.__getUserAgent().toLowerCase();return e.indexOf("msie")>-1||e.indexOf("trident")>-1}function n(){var e=c.__getUserAgent().toLowerCase();return e.indexOf("firefox")>-1}function i(){var e=c.__getUserAgent().toLowerCase();return e.indexOf("safari")>-1&&-1===e.indexOf("chrome")&&-1===e.indexOf("chromium")}function a(){return!!window.chrome}function r(e){e=e.toLowerCase();var t=e.match(/firefox\/(\d+.\d+)/);return parseFloat(t[1])}function o(e){e=e.toLowerCase();var t=e.match(/version\/(\d+.\d+)/);return parseFloat(t[1])}function s(e){e=e.toLowerCase();var t=e.match(/chrome\/(\d+.\d+)/);return parseFloat(t[1])}function l(){return document.documentMode}var c={};c.__getUserAgent=function(){return navigator.userAgent},c.isSupportedIEVersion=function(){return l()>=11},c.isBrokenIEVersion=function(){return l()<11},c.isSupportedFirefoxVersion=function(e){return r(e)>=30},c.isBrokenFirefoxVersion=function(e){return r(e)<22},c.isSupportedSafariVersion=function(e){return o(e)>=9},c.isBrokenSafariVersion=function(e){return o(e)<6.2},c.isSupportedChromeLikeVersion=function(e){return s(e)>=26},c.isBrokenChromeLikeVersion=function(e){return s(e)<26},c.isBrowserOfficiallySupported=function(){var r=c.__getUserAgent(),o=a()&&c.isSupportedChromeLikeVersion(r),s=t()&&c.isSupportedIEVersion(r),l=i()&&c.isSupportedSafariVersion(r),d=n()&&c.isSupportedFirefoxVersion(r);return e()||o||s||l||d},c.isBrowserExtremelyOutdated=function(){var e=c.__getUserAgent(),r=a()&&c.isBrokenChromeLikeVersion(e),o=t()&&c.isBrokenIEVersion(e),s=i()&&c.isBrokenSafariVersion(e),l=n()&&c.isBrokenFirefoxVersion(e);return r||o||s||l},window.BrowserUtil=c}(),coreModule.filter("nonBreaking",["$sce",function(e){return function(t){if(isUndefined(t))return"";var n=t.replace(/\s/g,"&nbsp;");return e.trustAsHtml(n)}}]),coreModule.filter("trustAsHtml",["$sce",function(e){return e.trustAsHtml}]),coreModule.filter("dayOfWeek",["DateTimeService","StringService",function(e,t){return function(n){return __formatDateTime(n,"dddd",{DateTimeService:e,StringService:t})}}]),coreModule.filter("dayAndMonth",["DateTimeService","StringService","I18nService",function(e,t,n){return function(i){return __formatDateTime(i,n.getLocalizedDateFormat("dayAndMonth"),{DateTimeService:e,StringService:t})}}]),coreModule.filter("time24h",["$log","DateTimeService","StringService",function(e,t,n){return function(e){return safeAccess(e,"hasTime")?__formatDateTime(e,"HH:mm",{DateTimeService:t,StringService:n}):""}}]),coreModule.filter("cmtTranslate",["$translate",function(e){function t(t,n){return n=n||{},n=angular.extend(n,ApplicationContext),e.instant(t,n)}return t.$stateFul=!0,t}]),coreModule.filter("price",["I18nConfig",function(e){return function(t){var n=1*t.amount,i=n.toLocaleString(e.getCurrentDeviceLanguage()+"-"+e.getCountryCodeFromDeviceLocale(),{style:"currency",currency:t.currencyCode,currencyDisplay:"symbol",minimumFractionDigits:0});return i.replace(new RegExp(String.fromCharCode(160),"g")," ")}}]),coreModule.factory("FileSystemFactory",["$log","$q","$timeout","AppLifeCycleService",function(e,t,n,i){function a(e,t){n(function(){e.resolve(t)})}function r(e,t){n(function(){e.reject(t)})}function o(){i.onAppReady(function(){getContext("isMobileApp")&&isDefined(navigator.persistentStorage)?navigator.persistentStorage.requestQuota(1024*l*1024,function(e){window.cordova?document.addEventListener("deviceready",function(){d(e)},!1):d(e)},function(e){r(s,{text:"Error requesting Quota",obj:e})}):r(s,{text:"Error getting the file system",obj:null})})}e=e.getInstance("FileSystemFactory"),e.info("Factory Started...");var s=t.defer(),l=20,c=0;window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.resolveLocalFileSystemURL=window.resolveLocalFileSystemURL||window.webkitResolveLocalFileSystemURL,navigator.persistentStorage=navigator.persistentStorage||navigator.webkitPersistentStorage,window.webkitStorageInfo=window.webkitStorageInfo||{requestQuota:function(e,t,n,i){i(new Error("Not implemented"))}};var d=function(e){window.requestFileSystem(window.PERSISTENT,e,function(t){c=e,a(s,t)},function(e){r(s,{text:"Error requesting File System access",obj:e})})},u={init:o,isSupported:function(){return isDefined(window.webkitStorageInfo)},grantedBytes:function(){return c},getCurrentUsage:function(){var e=t.defer();return webkitStorageInfo.queryUsageAndQuota(window.PERSISTENT,function(t,n){a(e,{used:t,quota:n})},function(t){r(e,{text:"Error getting quota information",obj:t})}),e.promise},requestQuota:function(e){var n=t.defer();return navigator.persistentStorage.requestQuota(window.PERSISTENT,1024*e*1024,function(e){a(n,e)},function(e){r(n,{text:"Error requesting quota increase",obj:e})}),n.promise},getFolderContents:function(e){function n(e,t){e.getDirectory(t[0],{},function(e){var o=e.createReader();t.length>1?n(e,t.slice(1)):o.readEntries(function(e){a(i,e)},function(e){r(i,{text:"Error reading entries",obj:e})})},function(e){r(i,{text:"Error getting directory",obj:e})})}e=e.replace(/^\//,"");var i=t.defer();return s.promise.then(function(t){n(t.root,e.split("/"))},function(e){i.reject(e)}),i.promise},createFolder:function(e){function n(e,t){e.getDirectory(t[0],{create:!0},function(e){t.length>1?n(e,t.slice(1)):a(i,e)},function(e){r(i,{text:"Error creating directory",obj:e})})}e=e.replace(/^\//,"");var i=t.defer();return s.promise.then(function(t){n(t.root,e.split("/"))},function(e){i.reject(e)}),i.promise},deleteFolder:function(e,n){n="undefined"==typeof n?!1:n;var i=t.defer();return s.promise.then(function(t){t.root.getDirectory(e,{},function(e){var t=function(){a(i,"")},o=function(e){r(i,{text:"Error removing directory",obj:e})};n?e.removeRecursively(t,o):e.remove(t,o)},function(e){r(i,{text:"Error getting directory",obj:e})})},function(e){i.reject(e)}),i.promise},writeFileInput:function(e,i,o){var s=t.defer(),l=new FileReader;return l.onload=function(t){var i=t.target.result;n(function(){u.writeArrayBuffer(e,i,o).then(function(){a(s,"")},function(e){r(s,e)})})},l.readAsArrayBuffer(i),s.promise},writeText:function(e,t,n){n="undefined"==typeof n?!1:n;var i=new Blob([t],{type:"text/plain"});return u.writeBlob(e,i,n)},writeArrayBuffer:function(e,t,n,i){i="undefined"==typeof i?!1:i;var a=new Blob([new Uint8Array(t)],{type:n});return u.writeBlob(e,a,i)},writeBlob:function(e,n,i){i="undefined"==typeof i?!1:i;var o=t.defer();return s.promise.then(function(t){t.root.getFile(e,{create:!0},function(e){e.createWriter(function(e){i&&e.seek(e.length);var t=!1;e.onwriteend=function(e){return t?void a(o,""):(t=!0,void this.truncate(this.position))},e.onerror=function(e){r(o,{text:"Write failed",obj:e})},e.write(n)},function(e){r(o,{text:"Error creating file",obj:e})})},function(e){r(o,{text:"Error getting file",obj:e})})},function(e){o.reject(e)}),o.promise},getFile:function(e){var n=t.defer();return this.getFileEntry(e).then(function(e){e.file(function(e){a(n,e)},function(e){r(n,{text:"Error getting file object",obj:e})})},function(e){n.reject(e)}),n.promise},getFileEntry:function(e){var n=t.defer();return s.promise.then(function(t){t.root.getFile(e,{},function(e){a(n,e)},function(e){r(n,{text:"Error getting file",obj:e})})},function(e){n.reject(e)}),n.promise},getFileFromLocalFileSystemURL:function(e){var n=t.defer();return window.resolveLocalFileSystemURL(e,function(e){e.file(function(e){a(n,e)},function(e){r(n,{text:"Error getting file object",obj:e})})},function(e){r(n,{text:"Error resolving FileSystem URL",obj:e})}),n.promise},readFile:function(e,n){var i=t.defer();return n=n||"text",s.promise.then(function(t){t.root.getFile(e,{},function(e){e.file(function(e){var t=new FileReader;switch(t.onloadend=function(){a(i,this.result)},t.onerror=function(e){r(i,{text:"Error reading file",obj:e})},n){case"arraybuffer":t.readAsArrayBuffer(e);break;case"binarystring":t.readAsBinaryString(e);break;case"dataurl":t.readAsDataURL(e);break;default:t.readAsText(e)}},function(e){r(i,{text:"Error getting file",obj:e})})},function(e){r(i,{text:"Error getting file",obj:e})})},function(e){i.reject(e)}),i.promise},deleteFile:function(e){var n=t.defer();return s.promise.then(function(t){t.root.getFile(e,{create:!1},function(e){e.remove(function(){a(n,"")},function(e){r(n,{text:"Error deleting file",obj:e})})})},function(e){n.reject(e)}),n.promise},downloadRemoteFileToFileSystem:function(n,i){var a=t.defer();return s.promise.then(function(t){try{var r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="arraybuffer",r.addEventListener("load",function(){if(4===r.readyState&&200===r.status){var e=u.getMimeTypeFromExtension(u.getFileExtension(n)),o=i.split("/");o[o.length-1].indexOf(".")>-1&&delete o[o.length-1],u.createFolder(o.join("/")).then(function(){u.writeArrayBuffer(i,r.response,e,!1).then(function(){a.resolve(u.pathToFilesystemURLSync(i,t))},function(e){a.reject(e)})},function(e){a.reject(e)})}else a.reject("Request failure: "+r.status+" "+r.statusText)}),r.addEventListener("error",function(t){e.error("downloadRemoteFileToFileSystem xhr error ",t),a.reject(t)}),r.send()}catch(o){a.reject(o)}},function(e){a.reject(e)}),a.promise},getFileExtension:function(e){var t=e.lastIndexOf(".");return-1!==t?e.substring(t+1):""},getMimeTypeFromExtension:function(e){var t={jpg:"image/jpg",gif:"image/gif",png:"image/png"},n=t[e];if(isDefined(n))return t[e];throw"Mime type is not defined, please add it to getMimeTypeFromExtension"},pathToFilesystemURLSync:function(e,t){if(isDefined(t))return 0!==e.indexOf("filesystem:")&&(e="/"===e[0]?t.root.toURL()+e.substring(1):t.root.toURL()+e),e;throw"fileSystem is not defined"},pathToFilesystemURL:function(e){var n=t.defer();return s.promise.then(function(t){n.resolve(u.pathToFilesystemURLSync(e,t))},function(e){n.reject(e)}),n.promise}};return u}]),window.coreModule.factory("MissingTranslationHandler",["$log","I18nService",function(e,t){return function(n,i){if(t.isStringLocalized(n))return n;e.warn("Missing localization for the following key ("+i+"):",n);var a=n.split("."),r=a[a.length-1];return"@"+r+"@"}}]),coreModule.factory("debounce",["$timeout","$q",function(e,t){return function(n,i,a){var r,o=t.defer();return function(){var s=this,l=arguments,c=function(){r=null,a||(o.resolve(n.apply(s,l)),o=t.defer())},d=a&&!r;return r&&e.cancel(r),r=e(c,i),d&&(o.resolve(n.apply(s,l)),o=t.defer()),o.promise}}}]),coreModule.service("LoggingService",["$log",function(e){function t(e){return function(t){var i=n(t);isDefined(i)&&e("Profiling:"+t+"["+i+" seconds]")}}function n(e){if(isDefined(A[e])){var t=new Date,n=(t.getTime()-A[e])/1e3;return delete A[e],y.push({time:n,id:e}),n}A[e]=(new Date).getTime()}function i(t){return getContext("applicationConfig.logLevel",6)>=t?t===h?function(){e[E[t]].apply(null,arguments),isDefined(window._LTracker)&&getContext("applicationConfig.remoteLogEnabled",!1)&&window._LTracker.push({text:"["+arguments[0].split("][")[1],stack:L,version:getContext("versions.app")})}:function(){e[E[t]].apply(this,arguments),L.push(arguments[0]),L.shift()}:function(){L.push(arguments[0]),L.shift()}}function a(e,t){return function(){var i=[].slice.call(arguments),a=i[0]||"",o="_"===a[0],s=getContext("applicationConfig.showPrivateMethodCalls",!1);if(s||!o){m&&console.group&&console.group(a),n(a),D.push(a);var d=l(t)+"Starting function "+a;f&&(d+=" with arguments:"+c(r(arguments.callee.caller.arguments))),i[0]=d,e.apply(null,i)}}}function r(e){for(var t="[\n",n=0,i=e.length;i>n;n++){var a=e[n];if(angular.isObject(a)&&v){try{a=JSON.stringify(a)}catch(r){a=a.toString()}a.length>400&&(a=a.slice(0,400)+"...}")}else angular.isString(a)&&(a.length>200&&(a=a.slice(0,200)+"..."),a="'"+a+"'");t+=a,t+=i>n+1?",\n":""}return t+="\n]"}function o(e,t){return function(){var i=D.pop();if(isDefined(i))var a="_"===i[0],r=l(t)+"Ending function "+i;var o=getContext("applicationConfig.showPrivateMethodCalls",!1),s=function(){if((o||!a)&&(m&&console.groupEnd&&console.groupEnd(),isDefined(r))){var t=n(i);e.apply(null,[r+":"+t])}};return isDefined(arguments[0])&&isDefined(arguments[0].then)?arguments[0].then(s)["catch"](function(e){console.error(r+" Fails with",e)}):!o&&a||s(),arguments[0]}}function s(){return moment().format(getContext("applicationConfig.logDateFormat","HH:mm:ss.SSS"))}function l(e){return"["+s()+"]["+e+"] "}function c(e){return e.replace(/(password.*?)"?:["|'](.*?)["|']/gi,'$1":"*******"')}function d(e,t){return function(){var n=[].slice.call(arguments),i=n[0],a=l(t);angular.isString(i)?a+=i:angular.isObject(i)&&(isDefined(i.status)&&isDefined(i.statusText)&&(a+=" Response status is "+i.status+" "+i.statusText),safeAccess(i,"config.url")&&(a+=" URL was: "+safeAccess(i,"config.url"))),n[0]=c(a),e.apply(null,n)}}function u(e,t){return function(){var n=[].slice.call(arguments),i=n[0];if(angular.isString(i)){var a=l(t)+i;n[0]=c(a),e.apply(null,n)}else angular.isObject(i)&&i.errorCodes&&i.errorCodes.forEach(function(i){var a=l(t)+"BackendError "+i;n[0]=c(a),e.apply(null,n)})}}function g(e){return function(){var t=[].slice.call(arguments);throw t[0]=l(e)+t[0],t[0]=c(t[0]),t[0]}}function p(e,t){return function(){var n=[].slice.call(arguments),i=n[0]||"";angular.isObject(i)&&(i=r([i]));var a=e;n[0]=l(t)+i,n[0]=c(n[0]),a.apply(null,n)}}var m=getContext("applicationConfig.useConsoleGroup",!0),f=!0,v=!0,h=1,S=2,C=3,T=4,b=5,E=["noop","error","warn","info","log","debug"];getContext("applicationConfig.logLevel",6)<T&&(m=!1,f=!1,v=!1),e.getInstance=function(e){return{log:p(i(T),e),info:p(i(C),e),warn:p(i(S),e),debug:p(i(b),e),error:p(i(h),e),profile:t(i(b)),method:a(i(b),e),throwException:g(e),backendError:u(i(h),e),httpError:d(i(h),e),returns:o(i(b),e),toString:function(){return"LoggingService"}}};var A={},y=[];window.displayProfiling=function(){y.sort(function(e,t){return e.time>t.time?-1:e.time<t.time?1:0}),console.table(y)};var L=[];!function(){for(var e=getContext("applicationConfig.logRetention",15),t=0;e>t;t++)L.push("")}();var D=[]}]),coreModule.provider("I18nConfig",["$translateProvider","$windowProvider",function(e,t){function n(e){var t={en:"GB","pt-PT":"PO","pt-BR":"PO","zh-TW":"TW","zh-CN":"CN",da:"DK",ja:"JP",nb:"NO",nn:"NO",sv:"SE",tr:"TK"};return isDefined(e)?isDefined(t[e])?t[e]:e.toUpperCase():(r.error("convertIsoLanguageToAmadeusLanguage: input not defined"),"GB")}function i(e){var t={zh:"CN",fr:"FR",en:"GB"};return t[e]||"GB"}function a(e){var t=e.languages,n=t[0],i=n.split("-"),a=n;if(1===i.length)for(var r=0;r<t.length;r++){var o=t[r],s=o.split("-");if(s.length>1&&s[0]===n){a=o;break}}return a}var r=angular.injector(["ng"]).get("$log"),o=5===getContext("applicationConfig.logLevel",2),s=this,l="You need to call I18nConfigProvider.detectAndConfigureLanguagesAndLocales in module.config() block!";s.$get=function(){var e={getCurrentApplicationLanguage:function(){return s.__currentApplicationLanguage?s.__currentApplicationLanguage:e._logError(l)},getCurrentDeviceLanguage:function(){return s.__deviceLanguage?s.__deviceLanguage:e._logError(l)},getCurrentAmadeusLanguage:function(){return s.__currentAmadeusLanguage?s.__currentAmadeusLanguage:e._logError(l)},getCountryCodeFromDeviceLocale:function(){return s.__deviceCountry?s.__deviceCountry:e._logError(l)},convertIsoLanguageOrLocaleToAmadeusLanguage:n,_logError:function(e){return e}};return e},s.__deviceLocale=null,s.__deviceLanguage=null,s.__deviceCountry=null,s.__currentApplicationLanguage=null,s.__currentAmadeusLanguage=null,s.detectAndConfigureLanguagesAndLocales=function(l){var c=t.$get().navigator,d=l.IONCMT_DEFAULT_LANG,u=l.IONCMT_SUPPORTED_LANGS,g=l.IONCMT_LOCALE_TO_LANG_MAPPING,p=getContext("applicationConfig.dataManagerKeyPrefix","");s.__deviceLocale=function(){var e=localStorage.getItem(p+"USER_PREFERRED_LOCALE_KEY");return isDefined(e)?(angular.isString(e)&&(e=JSON.parse(e).data),e):c.languages&&c.languages[0]?a(c):c.language||c.userLanguage||c.systemLanguage||"en-GB"}(),s.__deviceLanguage=(s.__deviceLocale.split("-")[0]||"en").toLowerCase(),s.__deviceCountry=(s.__deviceLocale.split("-")[1]||c.language.split("-")[1]||i(s.__deviceLanguage)).toUpperCase(),s.__deviceLocale=s.__deviceLanguage+"-"+s.__deviceCountry,s.__currentApplicationLanguage=function(){var e=-1!==u.indexOf(s.__deviceLocale),t=-1!==u.indexOf(s.__deviceLanguage);return e?(o&&r.info("application language: will use "+s.__deviceLocale),s.__deviceLocale):t?(o&&r.info("application language: will use "+s.__deviceLanguage),s.__deviceLanguage):(o&&r.info("application language: will fall back to default language"),d)}(),e.registerAvailableLanguageKeys(u,g),e.addInterpolation("$translateMessageFormatInterpolation");var m=getContext("applicationConfig.useLocalisationBundle",!1);if(m){var f=getContext("versions.jenkinsBuildId","000");e.useStaticFilesLoader({prefix:"i18n/Localization_",suffix:"-"+f+".json"})}else e.useLoader("$translatePartialLoader",{urlTemplate:"js/{part}/resources/i18n/Localization_{lang}.json"});e.useSanitizeValueStrategy("escapeParameters"),e.preferredLanguage(s.__currentApplicationLanguage),moment.locale(d),moment.locale(s.__deviceLocale),o&&r.info("effective momentjs locale: "+moment.locale()),s.__currentAmadeusLanguage=n(s.__currentApplicationLanguage),setContext("LANGUAGE",s.__currentAmadeusLanguage),o&&r.info("effective Amadeus language: "+getContext("LANGUAGE"))}}]),coreModule.service("I18nService",["$translate","$q","$log","I18nConfig",function(e,t,n,i){function a(e,t){var n=e.pop(),i=t[n];return delete t[n],i}n=n.getInstance("I18nService");var r="000000",o="999",s={getPriceFromBackendObject:function(e,t){return e&&isDefined(e.amount)?parseFloat(e.amount).toLocaleString(t,{style:"currency",currency:e.currencyCode,currencyDisplay:"symbol",minimumFractionDigits:2}):null},isStringLocalized:function(e){function t(e){return"@"===e[0]&&"@"===e[e.length-1]?!1:/\s/.test(e)||e.indexOf("..")>-1||e.split(".").length<3}var n=!0;return isDefined(e)&&(angular.isString(e)&&(e=[e]),e.forEach(function(e){n=n&&t(e)})),n},getLocalizedDateFormat:function(e){var t=window.cmtSpecificMomentDateFormatters[e];if(t){var a=i.getCurrentApplicationLanguage(),r=t[a]||t["default"];return r}return n.error('getLocalizedDateFormat: no config for "'+e+'"!'),"__"},translate:function(i,a,r){a=a||{},a=angular.extend(a,ApplicationContext);var o=t.defer();return Array.isArray(i)||"string"==typeof i?e(i,a,r).then(function(e){o.resolve(e)},function(e){
o.resolve(e)}):(n.error("translate: parameter should be an array or string!"),o.resolve("")),o.promise},translateHttpStatusCode:function(e){"string"!=typeof e&&"number"!=typeof e&&(n.error("translateHttpStatusCode: status should be a string or number"),e=o);var i=t.defer();e="core.httpErrorCodes."+e;var l=[e,"core.backendErrorCodes."+r];return s.translate(l).then(function(e){var t=a(l,e),n=l[0],r=e[n];s.isStringLocalized(r)?i.resolve(r):i.resolve(t)}),i.promise},translateBackendErrorCodes:function(e){var i=t.defer();return"string"!=typeof e&&"number"!=typeof e||(e=[e]),Array.isArray(e)||(n.error("translateBackendErrorCodes: codes should be an array, string or number!"),e=[r]),e=e.map(function(e){return"core.backendErrorCodes."+e}),e.push("core.backendErrorCodes."+r),s.translate(e).then(function(t){var n=a(e,t),r=[];e.forEach(function(e){var i=t[e];s.isStringLocalized(i)?r.push(i):r.push(n)}),i.resolve(r)}),i.promise},getDeviceLocaleCountryCodeFromPlugin:function(){var e=t.defer(),n=i.getCountryCodeFromDeviceLocale();return getContext("isMobileApp",!1)&&safeAccess(window,"cordova.plugins.DeviceLocale.getDeviceCountryCode")?window.cordova.plugins.DeviceLocale.getDeviceCountryCode(function(t){isDefined(t)?e.resolve(t):e.resolve(n)},function(){e.resolve(n)}):e.resolve(n),e.promise},replaceSpecialWhitespaces:function(e){return e.replace(new RegExp(String.fromCharCode(8239),"g")," ").replace(new RegExp(String.fromCharCode(160),"g")," ")}};return s}]),coreModule.service("PromiseService",["$log","I18nService","$q",function(e,t,n){function i(n,i){var r,o="http"===i;e.warn(n.method+": rejecting promise due to "+i+" error"),n.payload&&e.warn("The payload was: "+JSON.stringify(n.payload));var s=n.response;o?(e.httpError(s),n.deferred&&(r=safeAccess(s,"status"),t.translateHttpStatusCode(r).then(function(e){n.deferred.reject(e)}))):(e.backendError(s.data),n.deferred&&(s.cmtSwallowError?n.deferred.reject(a.CMT_SILENT_ERROR):(r=safeAccess(s,"data.errorCodes[0]","000000"),t.translateBackendErrorCodes([r]).then(function(e){n.deferred.reject(e[0])}))))}e=e.getInstance("PromiseService"),e.info("Service Started...");var a={CMT_SILENT_ERROR:"CMT_SILENT_ERROR",processMdwSuccessOrError:function(t,i){var r=n.defer();return t.then(function(t){var n=safeAccess(t,"data.success");n?(e.info(i+": resolving with success"),r.resolve(t)):a.rejectDueToBackendError({deferred:r,response:t,method:i})},function(e){a.rejectDueToHttpError({deferred:r,response:e,method:i})})["catch"](handleUnexpectedError),r.promise},rejectDueToBackendError:function(e){i(e,"backend")},rejectDueToHttpError:function(e){i(e,"http")},getDefaultOkHandler:function(e){return function(t){var n=safeAccess(t,"data.success");n||a.rejectDueToBackendError({response:t,method:e})}},getDefaultFailHandler:function(e){return function(t){a.rejectDueToHttpError({response:t,method:e})}}};return a}]),coreModule.service("AppPermissionsService",["$log","$q","AppLifeCycleService",function(e,t,n){e=e.getInstance("AppPermissionsService"),e.info("Service Started...");var i="pluginNotAvailable",a="unableToCheckPermissions",r="unableToRequestPermissions",o={permissionReadCalendar:"READ_CALENDAR",permissionWriteCalendar:"WRITE_CALENDAR",permissionFineLocation:"ACCESS_FINE_LOCATION",permissionCoarseLocation:"ACCESS_COARSE_LOCATION",_getPermissionsKey:function(e){var t=safeAccess(window,"cordova.plugins.permissions");if(t){if(angular.isString(e))return t[e];if(angular.isArray(e))return e.map(function(e){return t[e]}).filter(function(e){return void 0!==e})}return null},checkPermission:function(n){var r=t.defer(),s=safeAccess(window,"cordova.plugins.permissions");return s?(n=o._getPermissionsKey(n),s.checkPermission(n,function(t){e.info("checkPermission:",t.hasPermission),r.resolve(t.hasPermission)},function(t){e.error("cordova.plugins.permissions.checkPermission error: ",t),r.reject(a,t)})):(e.error("cordova.plugins.permissions error: plugin not available"),r.reject(i)),r.promise},checkAndProvidePermission:function(a){var s=t.defer(),l=safeAccess(window,"cordova.plugins.permissions");return l?(n.preventSystemPause(),a=o._getPermissionsKey(a),l.requestPermissions(a,function(t){e.info("requestPermission:",t.hasPermission),s.resolve(t.hasPermission)},function(t){e.error("cordova.plugins.permissions.requestPermissions error: ",t),s.reject(r)})):(getContext("isMobileApp",!1)&&e.error("cordova.plugins.permissions error: plugin not available"),s.reject(i)),s.promise},toString:function(){return"AppPermissionsService"}};return o}]),coreModule.service("AppLifeCycleService",["$log","$ionicPlatform","DataManagerService",function(e,t,n){e=e.getInstance("AppLifeCycleService"),e.info("Service Started...");var i="isSystemPause",a={_pauseCallbacks:[],_resumeCallbacks:[],onAppReady:function(e){t.ready(function(){e()})},onAppPause:function(e){a._pauseCallbacks.push(e)},onAppResume:function(e){a._resumeCallbacks.push(e)},preventSystemPause:function(){n.set(!0,i,{storage:n.CACHE,ttl:"30s"})},_init:function(){t.on("pause",function(){if(e.info("onAppPause"),n.get(i,n.CACHE))e.info("onAppPause skipped because system pause");else for(var t=0;t<a._pauseCallbacks.length;t++)a._pauseCallbacks[t]()}),t.on("resume",function(){if(e.info("onAppResume"),n.get(i,n.CACHE))e.info("onAppResume skipped because system resume"),n.remove(i,n.CACHE);else for(var t=0;t<a._resumeCallbacks.length;t++)a._resumeCallbacks[t]()})},toString:function(){return"AppLifeCycleService"}};return a._init(),a}]),coreModule.service("DateTimeService",["$log",function(e){e=e.getInstance("DateTimeService"),e.info("Service Started...");var t={decodeTTL:function(e){for(var t=/(([0-9]{1,2})([y|M|d|h|m|s]))/g,n=t.exec(e),i={};n;)i[n[3]]=n[2],n=t.exec(e);var a=i.y?31536e6*i.y:0,r=i.M?2592e6*i.M:0,o=i.d?864e5*i.d:0,s=i.h?36e5*i.h:0,l=i.m?6e4*i.m:0,c=i.s?1e3*i.s:0;return a+r+o+s+l+c},getMomentFromBackendDate:function(e){var t;return isDefined(e)&&(t=moment(e.utcTimestampMillis),t.utcOffset(e.offsetMinutes||0)),t},getDurationFromBackendDates:function(e,n){var i,a,r=!1;if(e=t.getMomentFromBackendDate(e),n=t.getMomentFromBackendDate(n),isDefined(e)&&isDefined(n)){var o=n.diff(e);0>o&&(r=!0);var s=moment.duration(o);a=s.minutes().toString(),"0"!==a&&a.length<2&&(a="0"+a),i={hours:(24*s.days()+s.hours()).toString(),minutes:a,isNegative:r}}return i},isSameBackendDate:function(e,n){return e=t.getMomentFromBackendDate(e),n=t.getMomentFromBackendDate(n),isDefined(e)&&isDefined(n)&&0===e.diff(n)},isPastDate:function(n){if(!n)return e.warn("isPastDate: null or undefined passed"),!1;var i=moment();return n=n.utcTimestampMillis?t.getMomentFromBackendDate(n):moment(n),i.diff(n)>0},createMdwDateTimeObject:function(e){var n=t.combineDateTimeObject(e),i=n.valueOf();return{utcTimestampMillis:i,offsetMinutes:isDefined(e.offsetMinutes)?e.offsetMinutes:null,hasTime:isDefined(e.timePart)}},combineDateTimeObject:function(e){var t=moment.utc();return isDefined(e.offsetMinutes)&&t.utcOffset(e.offsetMinutes),isDefined(e.datePart)&&(t.year(e.datePart.getFullYear()),t.month(e.datePart.getMonth()),t.date(e.datePart.getDate())),isDefined(e.timePart)&&(t.hours(e.timePart.getHours()),t.minutes(e.timePart.getMinutes()),t.seconds(0),t.milliseconds(0)),t},convertBackendDateToInputDate:function(e){var n=t.getMomentFromBackendDate(e),i=n.toDate().getTimezoneOffset();return n.add(e.offsetMinutes+i,"minutes"),n.toDate()},isValidDate:function(e){return isDefined(e)&&isDefined(e.date)&&isDefined(e.time)&&isDefined(e.timezoneOffset)},isValidDatesRange:function(e,n){var i=!1;if(t.isValidDate(e)&&t.isValidDate(n)){var a=t.createMdwDateTimeObject({datePart:e.date,timePart:e.time,offsetMinutes:parseInt(e.timezoneOffset,10)}),r=t.createMdwDateTimeObject({datePart:n.date,timePart:n.time,offsetMinutes:parseInt(n.timezoneOffset,10)});i=r.utcTimestampMillis>a.utcTimestampMillis}return i},parseETRSegmentDate:function(e){switch(e.type){case"Train":case"Meeting":case"Excursion":case"Parking":case"ShowAndEvent":case"Activity":case"Cruise":case"Taxi":case"Transfer":case"Urban":case"MoveMisc":case"Air":e.sDate=e.startDate,e.eDate=e.endDate;break;case"Car":e.sDate=e.pickupDateTime,e.eDate=e.dropoffDateTime;break;case"Hotel":e.sDate=e.checkin,e.eDate=e.checkout}return e},toString:function(){return"DateTimeService"}};return t}]),coreModule.service("DataManagerService",["ipCookie","I18nConfig","$log","$window","$q","$ionicPlatform","DateTimeService",function(e,t,n,i,a,r,o){function s(e){n.info("Initializing DataManager storage from "+e+" entry in localStorage...");var t=localStorage.getItem(g+e);if(t){n.info("Found data in storage: "+t.length+" bytes; trying to parse from JSON...");try{t=JSON.parse(t),n.info("JSON parse success")}catch(i){n.error("Unable to parse JSON, storage corrupted?")}}else n.info("No data found under given key. Initializing "+e+" to empty object"),t={};return t}n=n.getInstance("DataManagerService"),n.info("Service Started...");var l="USERDATA_KEYS",c="MEMORY_STATE",d="SECURED_USERDATA_KEYS_STORAGE_KEY",u="Secure Storage not available fallback in LocalStorage",g=getContext("applicationConfig.dataManagerKeyPrefix",""),p=s(l),m=s(d),f=s(c);f=f&&f.data?f.data:{};var v={},h={__userDataKeys:p,__securedUserDataKeys:m,__memory:f,__cache:v,cacheLocalStorage:!0,dataManagerKeyPrefix:g,MEMORY:0,CACHE:1,COOKIES:2,LOCALSTORAGE:3,INFINITE:-1,ONE_TIME:-2,TEXT:20,BINARY:21,ERR_SECURE_STORAGE_NOT_AVAILABLE:-1,ERR_SECURE_STORAGE_FAIL:0,_secureStoragePlugin:void 0,secureStorageDeferred:void 0,init:function(){window.DataManager=h,h._initSecureStorage().then(function(){n.info("SecureStorage plugin initialized")},function(e){n.warn("Cannot initialized SecureStorage plugin: "+e.message)}),i.addEventListener("beforeunload",function(){h.__onBeforeUnload()})},__onBeforeUnload:function(){var e=getContext("applicationConfig.dumpMemoryToStorageOnExit");e?(n.info("__onBeforeUnload: storing memory contents to localStorage..."),h.set(h.__memory,c,{storage:h.LOCALSTORAGE,ttl:"10m"})):n.info("__onBeforeUnload: Nothing to do (dumpMemoryToStorageOnExit == false)")},set:function(t,i,a){a=a||{};var r=a.storage,o=a.ttl,s=a.languageDependent||!1,c=a.belongsToUser||!1;void 0===t&&void 0===i&&n.throwException("Missing mandatory parameter data or key");var d=h._getEntry(t,o,s,c);switch(d.belongsToUser&&(h.__userDataKeys[i]=i,h._localStorageSet(l,h.__userDataKeys)),r){case h.LOCALSTORAGE:h._localStorageSet(i,d);break;case h.COOKIES:e(h.dataManagerKeyPrefix+i,JSON.stringify(d));break;case h.CACHE:h.__cache[i]=d;break;default:h.__memory[i]=d}},setSecureAsync:function(e,t){var i=a.defer();return h.secureStorageDeferred.promise.then(function(a){a.set(function(){h.__securedUserDataKeys[t]=t,i.resolve()},function(e){n.error("fail to set secured data with:"+e),i.reject(e)},t,e)},function(a){n.warn(u),n.warn(a.message),h.set(e,t,{storage:a.code===h.ERR_SECURE_STORAGE_NOT_AVAILABLE?h.MEMORY:h.LOCALSTORAGE,ttl:h.INFINITE,belongsToUser:!0}),i.resolve()}),i.promise},removeSecureAsync:function(e){var t=a.defer();return h.secureStorageDeferred.promise.then(function(i){i.remove(function(e){delete h.__securedUserDataKeys[e],t.resolve()},function(e){n.error(e),t.reject(e)},e)},function(i){n.warn(u),n.warn(i.message),h.remove(e,{storage:i.code===h.ERR_SECURE_STORAGE_NOT_AVAILABLE?h.MEMORY:h.LOCALSTORAGE,ttl:h.INFINITE,belongsToUser:!0}),t.resolve()}),t.promise},_localStorageSet:function(e,t){try{localStorage.setItem(h.dataManagerKeyPrefix+e,JSON.stringify(t)),h.cacheLocalStorage&&(h.__cache[e]=t)}catch(i){h.__memory[e]=t,n.warn("Error writing to the local storage for key = "+e+" fallback to memory"),n.error("Storage error",i)}},_localStorageGet:function(e){var t;try{t=h.__cache[e],t||(t=localStorage.getItem(h.dataManagerKeyPrefix+e),t&&h.cacheLocalStorage&&(t=JSON.parse(t),h.__cache[e]=t))}catch(i){t=h.__memory[e],n.warn("Error reading to the storage for key = "+e+" fallback from memory")}return isUndefined(t)&&(t=h.__memory[e]),t},get:function(e,t){var n=h._getStock(e,t);return isDefined(n)&&(angular.isString(n)&&(n=JSON.parse(n)),n=h._getValidatedStock(n,e,t)),null===n?void 0:n},getStoredDate:function(e,t){var n=h._getStock(e,t),i=null;return isDefined(n)&&(angular.isString(n)&&(n=JSON.parse(n)),isDefined(n.timestamp)&&(i=moment(n.timestamp))),i},_getStock:function(t,n){var i;switch(n){case h.LOCALSTORAGE:i=h._localStorageGet(t);break;case h.COOKIES:i=e(h.dataManagerKeyPrefix+t);break;case h.CACHE:i=h.__cache[t];break;default:i=h.__memory[t]}return i},getSecureAsync:function(e){var t=a.defer();return h.secureStorageDeferred.promise.then(function(i){i.get(function(e){t.resolve(e)},function(e){n.error("fail to get secured data with:"+e),t.reject(e)},e)},function(i){n.warn(u),n.warn(i.message),t.resolve(h.get(e,i.code===h.ERR_SECURE_STORAGE_NOT_AVAILABLE?h.MEMORY:h.LOCALSTORAGE))}),t.promise},_initSecureStorage:function(){return isUndefined(h.secureStorageDeferred)&&(h.secureStorageDeferred=a.defer(),r.ready(function(){safeAccess(window,"cordova.plugins.SecureStorage",!1)?h._secureStoragePlugin=new cordova.plugins.SecureStorage(function(){h.secureStorageDeferred.resolve(h._secureStoragePlugin)},function(e){h.secureStorageDeferred.reject({message:e,code:h.ERR_SECURE_STORAGE_FAIL})},getContext("appName","my_app")):h.secureStorageDeferred.reject({message:"Plugin not available",code:h.ERR_SECURE_STORAGE_NOT_AVAILABLE})})),h.secureStorageDeferred.promise},_getValidatedStock:function(e,n,i){return(e.TTL<0||!h._isTimeout(e.TTL,e.timestamp))&&("ZZ"===e.language||e.language===t.getCurrentApplicationLanguage())?(e.TTL===h.ONE_TIME&&h.remove(n,i),e=e.data):e=void 0,isUndefined(e)&&h.remove(n,i),e},remove:function(t,n){switch(n){case h.LOCALSTORAGE:localStorage.removeItem(h.dataManagerKeyPrefix+t),delete h.__cache[t];break;case h.COOKIES:e.remove(h.dataManagerKeyPrefix+t);break;case h.CACHE:delete h.__cache[t];break;default:delete h.__memory[t]}},clearUserData:function(){for(var t in h.__userDataKeys)localStorage.removeItem(h.dataManagerKeyPrefix+t),e.remove(h.dataManagerKeyPrefix+t),delete h.__memory[t],delete h.__cache[t];for(var n in h.__securedUserDataKeys)h.removeSecureAsync(n);localStorage.removeItem(h.dataManagerKeyPrefix+l),localStorage.removeItem(h.dataManagerKeyPrefix+d)},_isTimeout:function(e,t){var n=(new Date).getTime();return n>e+t},_getEntry:function(e,i,a,r){i=angular.isString(i)?o.decodeTTL(i):angular.isNumber(i)?i:h.INFINITE;var s=a?t.getCurrentApplicationLanguage():"ZZ";return r=!!r,n.returns({data:e,TTL:i,language:s,belongsToUser:r,timestamp:(new Date).getTime()})},toString:function(){return"DataManagerService"}};return h}]),window.UrlService=function(){var e={parseUrl:function(t){var n=new window.URL(t);return{search:n.search,parsedParameters:e.parseQueryString(n.search),parsedHash:e.parseHash(n.hash),pathname:n.pathname,origin:n.origin,hash:n.hash}},parseHash:function(e){var t={};if(isDefined(e)&&""!==e){e=e.replace("#/","");var n=e.split("?");if(n.length<=1&&(n=e.split("/")),t.route=n[0],n.length>1){var i=n[1].split("&");i.length<=1?(n.splice(0,1),i=n.map(function(e,t){return{key:t,value:e}})):i=i.map(function(e){var t=e.split("=");return{key:t[0],value:t[1]}}).filter(function(e){return""!==e.key}),t.params={};for(var a=0;a<i.length;a++)t.params[i[a].key]=i[a].value}}return t},parseQueryString:function(e){var t={};if(isDefined(e)&&""!==e){"?"===e[0]&&(e=e.slice(1));for(var n=e.split("&"),i=0,a=n.length;a>i;i++){var r=n[i].split("=");r[0]&&r[1]&&(t[r[0]]=decodeURIComponent(r[1]))}}return t},addParameterToQueryString:function(t,n,i){var a=e.parseUrl(t);a.parsedParameters[n]=i;var r=[];for(var o in a.parsedParameters)a.parsedParameters.hasOwnProperty(o)&&r.push(o+"="+a.parsedParameters[o]);var s=a.origin+a.pathname;return r.length>0&&(s+="?"+r.join("&")),a.hash&&""!==a.hash&&(s+=a.hash),s},toString:function(){return"UrlService"}};return e},coreModule.service("UrlService",window.UrlService),coreModule.service("ParameterService",["DataManagerService","UrlService","$log","$location","$stateParams",function(e,t,n,i,a){n=n.getInstance("ParameterService"),n.info("Service Started...");var r={parse:function(e){var n={};if(e=!!e,e||!safeAccess(ionic,"Platform.device",!1)||0===Object.keys(ionic.Platform.device).length){var a=this._getSearch(),r=t.parseQueryString(a),o=i.search();n=angular.extend({},r,o)}return n},safeGetStateParam:function(e){return isDefined(a[e])&&""!==a[e]?a[e]:null},_getSearch:function(){return window.location.search.substring(1)},toString:function(){return"ParameterService"}};return r}]),coreModule.service("PostMessageService",["$log","$window","$q",function(e,t,n){e=e.getInstance("PostMessageService"),e.info("Service Started...");var i={_isNativeAndroid:!1,cmtWindow:null,init:function(){"webkit"in t&&t.webkit.messageHandlers.integrationHandler?i.cmtWindow=t.webkit.messageHandlers.integrationHandler:"android"in window?(i.cmtWindow=window.android,i._isNativeAndroid=!0):i.cmtWindow=t.parent,t.addEventListener("message",function(e){i._handleEvent(e)},!1)},_handleEvent:function(e){var t=!0,n=e.data;if(angular.isString(n))try{n=JSON.parse(n)}catch(a){t=!1}t&&isDefined(n.type)&&i._eventHandler[n.type]&&i._eventHandler[n.type].forEach(function(e){e.notify(n.payload||n)})},send:function(t){if(isUndefined(i.cmtWindow))return void e.error("You must call init before calling this method!");try{i.cmtWindow.postMessage(i._isNativeAndroid?JSON.stringify(t):t,"*")}catch(n){e.error("Could not send message!",n)}},_eventHandler:{},when:function(e){var t=n.defer();isUndefined(i._eventHandler[e])&&(i._eventHandler[e]=[]);var a=(new Date).getTime()+i._eventHandler[e].length;return t.promise.revocationId=a,t.revovationId=a,i._eventHandler[e].push(t),t.promise._then=t.promise.then,t.promise.then=function(e){return this._then(null,null,e)},t.promise},cancelReceive:function(e,t){isDefined(i._eventHandler[e])&&(i._eventHandler[e]=i._eventHandler[e].filter(function(e){return e.revovationId!==t}))},toString:function(){return"PostMessageService"}};return i}]),coreModule.service("RequestService",["$q","$timeout","$http","$log",function(e,t,n,i){function a(e,n,i){t(function(){for(var t=o[e]?o[e]:[];t.length>0;)t.shift()(n,i);delete o[e]},1)}function r(e){return e.params[0]+JSON.stringify(e.params[1])}i=i.getInstance("RequestService"),i.info("Service Started...");var o={},s={post:function(e,t,n){return s._request({params:[e,t,{module:n}],method:"post"})},get:function(e,t,n){return s._request({params:[e,angular.merge({module:t},n)],method:"get"})},put:function(e,t,n){return s._request({params:[e,t,{module:n}],method:"put"})},"delete":function(e,t){return s._request({params:[e,{module:t}],method:"delete"})},_request:function(t){var s=e.defer(),l=r(t);return t.requestKey=l,isUndefined(o[l])?(o[l]=[],n[t.method].apply(n,t.params).then(function(e){a(l,e,!0),s.resolve(e)},function(e){a(l,e,!1),s.reject(e)})):(i.warn("The request with same config is already in progress! Enqueueing a callback..."),o[l].push(function(e,t){t?s.resolve(e,!0):s.reject(e)})),s.promise}};return s}]),coreModule.service("RequestInterceptor",["$q","RequestUtil","$log","$rootScope",function(e,t,n,i){function a(e){try{return JSON.parse(e)}catch(t){return{rawData:e}}}var r,o={APF:function(e){var t=e.data.replace(/\t|\n|\r/g,""),n=/<!\[CDATA\[(.*?)\]\]>/g,i=n.exec(t)[1];i=a(i),r=i.session.id;var o=n.exec(t)[1];e.data=a(o),isDefined(e.data)&&isDefined(e.data.model)&&(e.data=e.data.model)},HOTEL:function(e){var t,n=e.data.replace(/\t|\n|\r/g,""),i=/<!\[CDATA\[(.*?)\]\]>/g;t=-1===n.indexOf("model")?i.exec(n)[1]:i.exec(n)[1],e.data=a(t)},JSON:function(e){angular.isString(e.data)&&(e.data=a(e.data)),safeAccess(e,"data.model",!1)&&(e.data=e.data.model)}},s=function(e,t){t=isDefined(t)?t:l(e);var n=getContext("moduleConfig."+t+".type","JSON");return o[n]?o[n]:o.JSON},l=function(e){var t=e.split("/");return t.length>1?t[t.length-2]:""},c=function(e){if(getContext("applicationConfig.useMocks")){var t=e,n=e.split("/");n.length>1&&(t=n[1]);var i=getContext("applicationConfig.mockedUrls")||[],a=getContext("applicationConfig.ignoreMockedUrls")||[];return i.length>0?i.indexOf(t)>-1:a.length>0?-1===a.indexOf(t):!0}return!1},d=function(e,t){t=isDefined(t)?t:l(e);var n=getContext("backend",""),i=getContext("moduleConfig."+t+".backend");i=isDefined(i)?i:n;var a=getContext("server","/")+i;return a.endsWith("/")&&"/"===e[0]&&(a=a.substr(0,a.length-1)),a.endsWith("/")||"/"===e[0]||(a+="/"),a+e},u=function(e,t){var n=getContext("moduleConfig."+t+".overrides",{});return e=isDefined(n[e])?n[e]:e},g=function(e,t){e=u(e,t);var n=r?";jsessionid="+r:"",i=[];i.push("LANGUAGE="+getContext("LANGUAGE","GB")),i.push("SITE="+getContext("SITECODE","NCMTNCMT"));var a=getContext("OCTX");isDefined(a)&&i.push("OCTX="+a);var o=d(e,t)+n;return o+=-1!==o.indexOf("?")?"&":"?",o+=i.join("&")},p=function(e){return e.status>300},m={},f=function(e){if(p(e)&&v(e.config.url)){var t=getContext("applicationConfig.banFailureRequest",!0);if(t){var n=e.status;isUndefined(m[n])&&(m[n]=[]),m[n].push(e.config.url)}}return e},v=function(e){var t=getContext("applicationConfig.banFailureRequest",!0);if(t)for(var i in m)if(m[i].indexOf(e)>-1)return n.warn(e+" was banned because of bad request answer"),!1;return!0},h=function(e){var t="666";for(var n in m)m[n].indexOf(e.url)>-1&&(t=n);return{config:e,statusText:"Multiple failure, request stopped",status:t}},S=function(e){return e.startsWith("https://")||e.startsWith("http://")};return{request:function(n){if(isDefined(n)){if(t.isRequestManagedExtension(n.url)){if(S(n.url))return n;if(c(n.url))n.url.startsWith("mocks/mobile")||(n.url="mocks/mobile/"+n.url),n.method="GET";else{n.url=g(n.url,n.module);var i=getContext("moduleConfig."+n.module+".contentType");if(isDefined(i)&&(n.headers["Content-Type"]=i),!v(n.url))return e.reject(h(n));"POST"===n.method&&isDefined(n.data)&&(getContext("isMobileApp")&&(n.headers.x_weblogic_msession="SEREiT7GHDYzo8A"),getContext("moduleConfig."+n.module+".useData",!0)&&(n.data={data:JSON.stringify(n.data)}))}}getContext("moduleConfig."+n.module+".transform",!0)&&(n.transformRequest=t.getRequestTransform())}return n},response:function(e){if(t.isResponseManagedExtension(e.config.url)){var n=s(e.config.url,e.config.module);n(e)}return e},responseError:function(n){return isDefined(n)&&isDefined(n.config)&&t.isRequestManagedExtension(n.config.url)&&(f(n),i.$emit("error_message",{func:"Failed to contact the server, please try again later",tech:"Failure to request:"+n.config.url+" status:"+n.status})),e.reject(n)}}}]),coreModule.service("TimeoutRequestInterceptor",["$log",function(e){var t=6e4;return{request:function(n){if(isUndefined(n.timeout)){var i=getContext("applicationConfig.httpTimeoutMilliseconds.default",t);if("POST"===n.method){var a=getContext("applicationConfig.httpTimeoutMilliseconds.perAction."+n.url);isDefined(a)&&(e.info("TimeoutRequestInterceptor overriding "+n.url+" timeout to "+a),i=a)}n.timeout=i}return n}}}]),coreModule.service("LayoutService",["$ionicLoading","$log","$rootScope","$timeout","$q","$templateCache","I18nService","$ionicPopup","PromiseService","$window","PostMessageService",function(e,t,n,i,a,r,o,s,l,c,d){t=t.getInstance("LayoutService"),t.info("Service Started...");var u={isLoading:!1,keyboardClosingDuration:500,messageTimeoutPromise:null,_currentModals:[],MESSAGE_TYPE:{error:"error",warn:"warn",info:"info",debug:"debug"},isKeyboardOpened:function(){var e=document.activeElement;if(isDefined(e)){var t=e.tagName;if("INPUT"===t||"TEXTAREA"===t)return!0}return!1},unFocusActiveElement:function(){var e=a.defer(),t=document.activeElement;return isDefined(t)&&t.blur(),i(function(){e.resolve()},200),e.promise},startLoading:function(e,t){e!==!0&&u.loading(!0,t)},stopLoading:function(e,t){if(e===!0){if(!isDefined(t))throw"stopLoading scope is not defined";t.$broadcast("scroll.refreshComplete")}else u.loading(!1)},loading:function(e,t,n){var i=a.when().promise;return o.isStringLocalized(t)?u._loading(e,t,n):i=o.translate(t).then(function(t){u._loading(e,t,n)}),i},_loading:function(t,n,a){t?(u.unFocusActiveElement(),c.parentLoading&&angular.isFunction(c.parentLoading)?c.parentLoading(!0,n):u._ionicLoadingProvider(n,a)):(isDefined(u.messageTimeoutPromise)&&i.cancel(u.messageTimeoutPromise),c.parentLoading&&angular.isFunction(c.parentLoading)?c.parentLoading(!1):e.hide()),d.send({type:t?"spinnerDisplayedEvent":"spinnerRemovedEvent"}),this.isLoading=t},_ionicLoadingProvider:function(t,n){var a='<ion-spinner class="spinner-positive"></ion-spinner>';if(isDefined(t)){var r=isDefined(n)?"display: none;":"";a+='<div id="spinner_message" class="spinner_message" style="'+r+'">'+t+"</div>",isDefined(n)&&(u.messageTimeoutPromise=i(function(){var e=document.getElementById("spinner_message");isDefined(e)&&(e.style.display="block")},n))}e.show({template:a,delay:100})},toast:function(e){return o.isStringLocalized(e)?u._toast(e):o.translate(e).then(u._toast)},toastWithBackdrop:function(e,t){var n;n=o.isStringLocalized(e)?u._toastWithBackdrop(e,t):o.translate(e).then(function(e){return u._toastWithBackdrop(e,t)})},_toast:function(t){var n=a.defer();return u.unFocusActiveElement(),u.loading(!1),e.show({noBackdrop:!0,template:t}),i(function(){e.hide(),n.resolve()},2500),n.promise},_toastWithBackdrop:function(t,n){var r=a.defer();return u.unFocusActiveElement(),e.show({template:t}),u.isLoading=!0,i(function(){n?u.loading(!1):u.isLoading&&u.loading(!0),r.resolve()},2500),r.promise},toastError:function(e,t){var n,i=isDefined(t)?t:"core.title.errorPopup",a="core.button.ok";if(o.isStringLocalized(e)&&o.isStringLocalized(i))n=o.translate(a).then(function(t){return u._toastError(e,t,i)});else{var r=[];angular.isArray(e)?r=r.concat(e):r.push(e),r.push(i),r.push(a),n=o.translate(r).then(function(e){var t=e[i],n=e[a];delete e[i],delete e[a];var r=Object.values(e);return u._toastError(r,n,t)})}return n},_toastError:function(e,n,i){var r=a.defer(),o=this.isLoading;if(this.isLoading&&this.loading(!1),"string"==typeof e&&(e=[e]),e=e||[],e.indexOf(l.CMT_SILENT_ERROR)>-1)return t.warn("Received CMT_SILENT_ERROR, not displaying a popup!"),r.resolve(),r.promise;u.unFocusActiveElement();var c="<ul><li>"+e.join("</li><li>")+"</li></ul>",d=s.alert({title:i,template:c,okText:n});return d.then(function(){o&&u.loading(!0),r.resolve()}),r.promise},showConfirmPopup:function(e,t,n,i){u.unFocusActiveElement(),n=n||"core.button.ok",i=i||"core.button.cancel";var a=[];o.isStringLocalized(e)?"":a.push(e),o.isStringLocalized(t)?"":a.push(t),o.isStringLocalized(n)?"":a.push(n),o.isStringLocalized(i)?"":a.push(i);var r;return r=a.length>0?o.translate(a).then(function(a){var r=a[e]||e,o=a[t]||t,s=a[n]||n,l=a[i]||i;return u._showConfirmPopup(r,o,s,l)}):u._showConfirmPopup(e,t,n,i)},_showConfirmPopup:function(e,t,i,r){var o=s.confirm({title:e,template:t,cancelText:r,okText:i});g(o);var l=a.defer();return o.then(function(e){n.stateChangePopupListener(),e?l.resolve():l.reject()}),l.promise},showAlertPopup:function(e,t){var i=a.defer();angular.isArray(t)&&(t="<ul><li>- "+t.join("</li><li>- ")+"</li></ul>");var r=s.alert({title:e,template:t});return g(r),r.then(function(){n.stateChangePopupListener(),i.resolve()}),i.promise},showCustomPopup:function(e){u.unFocusActiveElement(),e.template=r.get(e.templateUrl);var t=s.show(e);g(t);var i=a.defer();return t.then(function(e){n.stateChangePopupListener(),e?i.resolve():i.reject()}),i.promise},hidetabs:function(){n.hidetabs=!0},showModal:function(e,t){t=t||"closeModal";var n=safeAccess(e,"scope.$parent."+t);isDefined(n)&&(window.closeModal=n),d.send({type:"modalDisplayedEvent",closeButtonEnabled:isDefined(n),closeModalAction:isDefined(n)?"closeModal":null}),e.modal_id=(new Date).getTime(),u._currentModals.push(e);var i=u._manageModal(e,"show");return i},hideModal:function(e){e=isDefined(e)?e:u._currentModals[u._currentModals.length-1],d.send({type:"modalRemovedEvent"});var t=u._manageModal(e,"hide");return t},removeModal:function(e){e=isDefined(e)?e:u._currentModals[u._currentModals.length-1],d.send({type:"modalRemovedEvent"});var t=u._manageModal(e,"remove").then(function(){u.cleanModal(e)});return t},cleanModal:function(e){u._currentModals=u._currentModals.filter(function(t){return t.modal_id!==e.modal_id})},_manageModal:function(e,t){var n=a.defer();return u.closeKeyboard().then(function(){e[t]().then(function(){n.resolve(!0)})}),n.promise},closeKeyboard:function(){var e=a.defer(),t=function(){e.resolve()};return u.isKeyboardOpened()?(u.unFocusActiveElement(),i(t,u.keyboardClosingDuration)):t(),e.promise},addFormErrors:function(e){for(var n in e)for(var i=e[n],a=0;a<i.length;a++){var r=i[a].$name+" : "+n;this.addMessage(r,this.MESSAGE_TYPE.warn),t.warn(r)}},addErrors:function(e){e=e||[];for(var t=0;t<e.length;t++)this._addError(e[t])},_addError:function(e){this.addMessage(e,this.MESSAGE_TYPE.error),t.error(e)},addMessage:function(e,t){t+="s",isUndefined(n[t])&&(n[t]=[]),n[t].push(e)},removeMessages:function(e){n[e+"s"]=[]},hasCssClass:function(e,t){var n=!1;return angular.isElement(e)&&(e=angular.element(e),n=e.hasClass(t)),n},addCssClass:function(e,t){angular.isElement(e)&&(e=angular.element(e),e.addClass(t))},removeCssClass:function(e,t){angular.isElement(e)&&(e=angular.element(e),e.removeClass(t))},showDomElement:function(e){this.removeCssClass(e,"hide")},hideDomElement:function(e){this.addCssClass(e,"hide")},getActiveView:function(){var e=document.querySelectorAll("ion-view");for(var t in e){var n=e[t];if("entering"===n["$attr-nav-view"]||"active"===n["$attr-nav-view"])return n}},openInExternalBrowser:function(e,t,n){var i=e;t=isDefined(t)?t:e,n=isDefined(n)?n:t,getContext("isMobileApp")&&(ionic.Platform.isAndroid()?i=t:ionic.Platform.isIOS()&&(i=n)),window.open(i,"_system")},getMainMenuStyle:function(){return getContext("applicationConfig.menu.mainMenuStyle","action-sheet")},getCardMenuStyle:function(){return getContext("applicationConfig.menu.cardMenuStyle","action-sheet")},showBackButton:function(e){var t=e?"hide":"showBackButton",n=e?"showBackButton":"hide";i(function(){for(var e=document.querySelectorAll("button[default-nav-back-button]")||{},i=0;i<e.length;i++)e[i].classList.remove(t),e[i].classList.add(n)},100)},toString:function(){return"LayoutService"}};n.$on("error_message",function(e,n){u.addErrors[n.func],t.error(n.tech)});var g=function(e){n.stateChangePopupListener=n.$on("$stateChangeStart",function(){e.close()})};return u}]),coreModule.service("GloballistService",["DataManagerService","RequestService","$log","$q",function(e,t,n,i){n=n.getInstance("GloballistService"),n.info("Service Started...");var a={GLOBAL_LIST_URL:"mcmtng/globals",getGl:function(n){var r=e.get(a.getGLKey(n),e.MEMORY),o=i.defer();if(isUndefined(r)){var s=a._getResourcePath(n)+"/"+n+".json",l=t.get(s);l.then(function(e){a._successStaticGLCallback(e,n,o)},function(e){a._failureStaticGLCallback(e,n,o)})}else o.resolve(r);return o.promise},_successStaticGLCallback:function(t,n,i){e.set(t.data,a.getGLKey(n),{storage:e.MEMORY,ttl:"7d",languageDependent:a._isLanguageDependent(n),belongsToUser:!1}),i.resolve(t.data)},_failureStaticGLCallback:function(e,t,i){n.warn("The Globallist ["+t+"] is not present we need to request it, please add it to your bower.json configuration");var r=a.reloadGl(t);r.then(function(e){i.resolve(e)},function(e){i.reject(e)})},getGLKey:function(e){return"Gl_"+e},reloadGl:function(e){var n=i.defer(),r=this,o=t.get(a.GLOBAL_LIST_URL+"?RES="+e);return o.then(function(t){r._successGLCallback(t,e,n)},function(t){r._failureGLCallback(t,e,n)}),n.promise},_successGLCallback:function(t,n,i){e.set(t.data[n],a.getGLKey(n),{storage:e.LOCALSTORAGE,ttl:"7d",languageDependent:a._isLanguageDependent(n)}),i.resolve(t.data[n])},_failureGLCallback:function(e,t,n){n.reject(e.statusText)},_isLanguageDependent:function(e){return 0===e.indexOf("LANG_")||0===e.indexOf("SL_")},_isSiteDependent:function(e){return 0===e.indexOf("SITE_")||0===e.indexOf("SL_")},_getResourcePath:function(e){var t=["resources",getContext("SITECODE"),getContext("LANGUAGE")];return e&&(a._isSiteDependent(e)||t.splice(1,1),
a._isLanguageDependent(e)||t.pop()),getContext("applicationConfig.useMocks",!1)&&t.unshift("mocks"),t.join("/")},toString:function(){return"GloballistService"}};return a}]),coreModule.factory("GloballistProcessor",["GloballistService","$log","$q",function(e,t,n){t=t.getInstance("GloballistProcessor"),t.info("Service Started...");var i={getCallingCountryCodeByCountry:function(){var t=n.defer(),i=e.getGl("SL_GET_COUNTRY_CALLING_CODE");return i.then(function(e){var n=e.map(function(e){return{countryCode:e[0],country:e[1],phoneCode:"+"+e[2]}});t.resolve(n)},function(e){t.reject("SL_GET_COUNTRY_CALLING_CODE",e)}),t.promise},getCountryCodeByCountry:function(){var t=e.getGl("LANG_COUNTRY_REGION_LIST").then(i.cleanZZLanguage).then(i.matrixToObjectArray);return t},matrixToObjectArray:function(e){var t=e.map(function(e){return{value:e[0],text:e[1]}});return t},cleanZZLanguage:function(e){for(var t=e.length-1;t>=0;t--)"ZZ"===e[t][0]&&e.splice(t,1);return e},toString:function(){return"GloballistProcessor"}};return i}]),coreModule.service("OrchestratorChiefService",["$state","$log","$ionicViewSwitcher","$rootScope","$ionicHistory","$q","LayoutService",function(e,t,n,i,a,r,o){function s(t,n){var i=["landing","login"],a=n.isFromFooterTabs||!1;return a||-1===e.current.name.indexOf("more")||-1!==i.indexOf(t)||-1===t.indexOf("more")&&(t="more-"+t),t}t=t.getInstance("OrchestratorChiefService"),t.info("Service Started...");var l={page:e.current.name},c={_orchestrators:[],_index:0,getUserContext:function(){return l},canNavigateBack:function(){return isDefined(a.backView())||(e.current||{}).defaultBackState},registerCustomBackAction:function(e){c.customBackButtonFunction=e},deregisterCustomBackAction:function(){c.customBackButtonFunction=void 0},navigateTo:function(t,a,l){var c=r.defer();return a=a||{},l=l||{},t&&getContext("isB2b",!1)&&(t=s(t,a)),l.reload!==!1&&isDefined(e.current)&&e.current.name===t&&(l.reload=!0),o.closeKeyboard().then(function(){getContext("isWebDesktop")?n.nextTransition("none"):n.nextTransition(ionic.Platform.isAndroid()?"android":"ios"),e.go(t,a,l)["finally"](function(){c.resolve(!0)})}),i.hidetabs&&(i.hidetabs=!1),c.promise},navigateToPage:function(e){return c.navigateTo(e.state.name,e.params)},navigateToLandingPage:function(){return c.navigateTo(getContext("applicationConfig.landingPage","landing"))},navigateToLoginPage:function(){return c.navigateTo("login")},navigateBack:function(){o.closeKeyboard().then(function(){if(isDefined(c.customBackButtonFunction))c.customBackButtonFunction();else{var t=(e.current||{}).defaultBackState;a.backView()?i.$ionicGoBack():t?(n.nextDirection("back"),a.nextViewOptions({disableBack:!0,historyRoot:!0}),c.navigateTo(t)):isDefined(navigator.app)&&navigator.app.exitApp()}})},getPreviousView:function(){return a.backView()},register:function(e){if(!e.next)throw e+"is not a valid orchestrator";c._orchestrators.push(e)},check:function(e,t){var n=null;return c._index>-1&&(n=c._orchestrators[c._index--].next(e,t)),n},next:function(t){c._index=c._orchestrators.length-1;var n=angular.copy(l),i=angular.extend({},l,t);return i.page=e.current.name,c.check(i,n)},toString:function(){return"OrchestratorChiefService"},onBackButtonModalEvent:function(){o.removeModal().then(function(){c.unregisterNavigateBackFromModal()})},registerNavigateBackFromModal:function(){var e=i.$on("$stateChangeStart",function(t){window.onpopstate&&(t.preventDefault(),history.pushState(null,null,window.location.href)),e()});window.onpopstate=c.onBackButtonModalEvent},unregisterNavigateBackFromModal:function(){window.onpopstate=null}};return c}]),coreModule.service("EasterEggService",["$log","$timeout","$rootScope","$ionicModal","LayoutService","RequestService",function(e,t,n,i,a,r){function o(){s=null,c=0}e=e.getInstance("EasterEggService"),window.isEasterEggEnabled=!1;var s=null,l=3e3,c=0,d=5,u={displayEasterEgg:function(){function e(){var e=JSON.stringify(o,null,2);e=e.substring(1).slice(0,-1).replace(/[",]/g,""),s.debugInfo=e,i.fromTemplateUrl("core/templates/partial/EasterEggModal.html",{scope:s,animation:"slide-in-up",focusFirstInput:!1}).then(function(e){t=e,a.showModal(t)})}if(window.cmt&&window.cmt.getDebugInfo){var t,o=window.cmt.getDebugInfo(),s=n.$new();if(s.closeModal=function(e){if(e=e||{localStorageOverridesCleared:!1},e.localStorageOverridesCleared)window.localStorage.removeItem("__EASTER_EGG_OCTX"),window.localStorage.removeItem("__EASTER_EGG_SERVER"),setContext("server",getContext("buildTimeImmutableConfig.server"));else{var n=getContext("OCTX")!==s.octx.current||getContext("server")!==s.server.current;if(n){var i=o.isReleaseBuild;!i&&getContext("isMobileApp")&&(window.localStorage.setItem("__EASTER_EGG_OCTX",s.octx.current),window.localStorage.setItem("__EASTER_EGG_SERVER",s.server.current)),setContext("OCTX",s.octx.current),setContext("server",s.server.current)}}setContext("applicationConfig.useMocks",s.useMocks.activated),s.featuresActivation.forEach(function(e){setContext(e.ApplicationContextKey,e.isEnabled)}),a.removeModal(t)},s.clearLocalStorageOverride=function(){s.closeModal({localStorageOverridesCleared:!0})},s.testConnection=function(e){var t;t="http"===e?"http://cors-test.appspot.com/test":"https://cors-test.appspot.com/test",r.get(t,{timeout:15e3}).then(function(e){window.alert("it works :)")},function(e){window.alert("it failed :(")})},s.isReleaseBuild=o.isReleaseBuild,s.isUserLogged=isDefined(o.userId),o.isReleaseBuild||(window.isEasterEggEnabled=!0),s.featuresActivation=[],!o.isReleaseBuild){var l=getContext("featureConfig",{});for(var c in l){var d=c+".enabled",u=safeAccess(l,d,void 0);if(void 0!==u){var g={label:c,isEnabled:u,ApplicationContextKey:"featureConfig."+d};s.featuresActivation.push(g)}}}if(s.useMocks={},s.useMocks.showToggle=!getContext("isMobileApp"),s.useMocks.activated=getContext("applicationConfig.useMocks"),s.octx={},s.octx.current=getContext("OCTX"),s.octx.list=o.octxList||[],s.server={},s.server.current=getContext("server"),s.server.list=o.serverList||[],s.isLocalStorageOverrideActive=!1,getContext("isMobileApp")){var p=window.localStorage.getItem("__EASTER_EGG_OCTX"),m=window.localStorage.getItem("__EASTER_EGG_SERVER");(p||m)&&(s.isLocalStorageOverrideActive=!0)}o.octxList=void 0,o.serverList=void 0;var f=+new Date;r.get("dependencies.js?ts="+f,{timeout:5e3}).then(function(t){var n=t.data;n=n.replace("window.dependencyCallback(","").replace(");","").replace(/\r\n/g,""),n=JSON.parse(n),o.cmtwebapp={buildTimestamp:n.timestamp,buildArtifact:n.webapp,ioncmtArtifact:"ioncmt-"+n["amadeus-mobile.version"]},e()})["catch"](function(){e()})}},handleEasterEgg:function(){s||(s=t(l).then(o)),c++,c===d&&(u.displayEasterEgg(),o())}};return u}]),coreModule.service("NetworkService",["$log","$q","$window","$rootScope",function(e,t,n,i){e=e.getInstance("NetworkService"),e.info("Service Started...");var a={isOnline:!0},r={Connection:{UNKNOWN:"unknown"},init:function(){n.addEventListener("offline",function(){i.$apply(function(){r.updateNetworkStatus({isOnline:!1})})},!1),n.addEventListener("online",function(){i.$apply(function(){r.updateNetworkStatus({isOnline:!0})})},!1)},hasConnectivity:function(e){var n=t.defer();return n.resolve(a.isOnline),n.promise.isOnline=a.isOnline,n.promise},hasHighProfile:function(){return!0},getRequestTimeout:function(){return this.hasHighProfile()?1e4:6e4},updateNetworkStatus:function(e){a=e},getNetworkType:function(){return this.Connection.UNKNOWN.toUpperCase()},toString:function(){return"NetworkService"}};return r}]),coreModule.service("StringService",["$log",function(e){e=e.getInstance("StringService"),e.info("Service Started...");var t={capitalizedFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},removeAtTheEnd:function(e,t){var n=e.lastIndexOf(t);return n>=0&&n+t.length===e.length&&(e=e.slice(0,n)),e},isValidJsonString:function(e){if("string"!=typeof e)return!1;try{JSON.parse(e)}catch(t){return!1}return!0},toString:function(){return"StringService"}};return t}]),coreModule.service("ClipboardService",["$log","$q","$window","LayoutService",function(e,t,n,i){function a(t,i,a){var r=n.document.querySelector(t);if(!r)return e.error("Oops, unable to find selector!"),void a.reject();var o=r.textContent;try{n.cordova.plugins.clipboard.copy(o,function(){e.info("Copy to clipboard ok"),a.resolve()},function(){e.error("Oops, unable to copy text!"),a.reject()}),i.preventDefault()}catch(s){return e.error("Oops, unable to copy text!"),void a.reject()}}function r(t,a,r){if(!isDefined(n.document.queryCommandEnabled)||!n.document.queryCommandSupported("copy"))return e.error("Oops, the browser does not support copying to clipboard!"),void r.reject();var o=n.document.querySelector(t);if(!o)return e.error("Oops, unable to find selector!"),void r.reject();i.addCssClass(o,"copyToClipboard");var s=n.document.createRange();s.selectNode(o),n.getSelection().addRange(s);try{var l=n.document.execCommand("copy");n.getSelection().removeAllRanges(),l?(e.info("Copy to clipboard ok"),a.preventDefault(),r.resolve()):(e.error("Oops, unable to copy text!"),r.reject())}catch(c){e.error("Oops, unable to copy text!"),r.reject()}i.removeCssClass(o,"copyToClipboard")}e=e.getInstance("ClipboardService"),e.info("Service Started...");var o={copyToClipboard:function(e,n){var i=t.defer();return getContext("isMobileApp")&&isDefined(safeAccess(window,"cordova.plugins.clipboard"))?a(e,n,i):r(e,n,i),i.promise},toString:function(){return"ClipboardService"}};return o}]),coreModule.service("MenuService",["$log","OrchestratorChiefService","I18nService","$q",function(e,t,n,i){e=e.getInstance("MenuService"),e.info("Service Started...");var a={menuItems:[],ids:0,addItem:function(e){var t,r=a.getItem(e.name);if(isUndefined(r))if(r=e,r.id=a.ids++,n.isStringLocalized(e.label))r.label=e.label,a._addItem(r),t=i.when({onClick:function(e){return r.onClick=e,this},id:r.id});else{var o=a._addItem(r);t=n.translate(e.label).then(function(e){return a.menuItems[o].label=e,{onClick:function(e){return r.onClick=e,this},id:r.id}})}else t=i.when({onClick:function(e){return r.onClick=e,this},id:r.id});return t},_addItem:function(e){return e.icon=isDefined(e.icon)?e.icon:"",a.menuItems.push(e),a.menuItems.length-1},addDestructiveItem:function(e){return e.isDestructive=!0,a.addItem(e)},getDestructiveItem:function(e,t){var n=a.menuItems.filter(function(e,n,i){return t.indexOf(e.name)>-1}).filter(function(t,n,i){return a.isVisibleInThisContext(t,e,!0)}).filter(function(e,t,n){return e.isDestructive}).map(function(t,n,i){return a._prepareItem(t,e)});return n.length>0?n[n.length-1]:null},isVisibleInThisContext:function(e,t,n){return(isUndefined(e.isDestructive)||e.isDestructive===n)&&(isUndefined(e.condition)||a.safeCall(e.condition,t))},safeCall:function(n,i){try{return n(i,t.getUserContext())}catch(a){return e.error("Fail during menu item condition evaluation",a),!1}},removeAll:function(){a.menuItems=[],a.ids=0},getItem:function(e){var t=a.menuItems.filter(function(t,n,i){return t.name===e});return t.length>0?t[0]:null},removeItem:function(e){for(var t=0;t<a.menuItems.length;t++)if(a.menuItems[t].id===e)return a.menuItems.splice(t,1)[0];return null},_prepareItem:function(n,i){var a=angular.copy(i),r=angular.copy(n);return r.action=function(n){isDefined(r.onClick)?r.onClick.apply(n,[a,t.getUserContext()]):e.warn("There is no action associated to ",r)},r},listItem:function(e,t,n){var i=a.menuItems.filter(function(e,n,i){return t.indexOf(e.name)>-1}).filter(function(t,i,r){return a.isVisibleInThisContext(t,e,n)}).map(function(t,n,i){return a._prepareItem(t,e)}).sort(function(e,n){if(t){var i=t.indexOf(e.name),a=t.indexOf(n.name);return i-a}return 0});return i},toString:function(){return"MenuService"}};return a}]),coreModule.service("MapService",["RequestService","$log",function(e,t){return t=t.getInstance("MapService"),t.info("Service Started..."),{createLeafLetMap:function(e,t,n,i){var a=L.map(e).setView([t,n],13);return L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),a},plotSourceInformation:function(e,t,n,i){var a="Source Information";L.marker([t,n]).addTo(e).bindPopup(a)},plotDestinationInformation:function(e,t,n){var i="Destination Information";if(null!=t&&t.length>0)for(var a=0;a<t.length;a++)L.marker([t[a].lat,t[a].lng]).addTo(e).bindPopup(i)}}}]),coreModule.service("GpsCheckinService",["$log","RequestService","$q",function(e,t,n){e=e.getInstance("GpsCheckinService"),e.info("Service Started...");var i="v1/account/secureCheckIn",a={secureCheckinActionCall:function(a){var r=n.defer(),o={};return o.latitude=a.coords.latitude,o.longitude=a.coords.longitude,t.post(i,o).then(function(t){safeAccess(t,"data")&&t.data.success?(e.info("Location details sent successfully to server"),r.resolve(a)):(e.error("Location details update failed in server"),r.reject(t.data.errors[0]))},function(t){e.error("Location details action call failed from server"),r.reject(t)}),r.promise},getGeolocationData:function(){var t=n.defer();return safeAccess(navigator,"geolocation")?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(n){e.error(n),t.reject(n)},{timeout:15e3,maximumAge:1e4}):t.reject("No plugin available"),t.promise},toString:function(){return"GpsCheckinService"}};return a}]),coreModule.service("GooglePlaceService",["$log","$q","$timeout","StringService","$window",function(e,t,n,i,a){e=e.getInstance("GooglePlaceService");var r="__onGooglePlacesJsApiLoad",o={GOOGLE_PLACES_LOAD_TIMEOUT_MS:15e3,__pendingGooglePlacesPromise:null,__googlePlacesLoadTimeout:null,_getGooglePlacesJsApiUrl:function(){var t=getContext("featureConfig.googlePlaces.apiKey");return t||e.error("You need to define Google Places API key in ApplicationContext."),"https://maps.googleapis.com/maps/api/js?libraries=places&key="+t+"&callback="+r},loadGooglePlacesJsApi:function(){if(isDefined(o.__pendingGooglePlacesPromise))e.info("Already pending the load of Google Places API, reusing the pending promise");else{var i=t.defer();if(safeAccess(window,"google.maps.places"))e.info("Google Places API already loaded"),i.resolve();else{window[r]=function(){n.cancel(o.__googlePlacesLoadTimeout),e.info("Google Places API loaded"),i.resolve(),window[r]=null},o.__googlePlacesLoadTimeout=n(function(){e.error("Failed to load Google Places API, timeout"),window[r]=function(){},i.reject(),o.__pendingGooglePlacesPromise=null},o.GOOGLE_PLACES_LOAD_TIMEOUT_MS);var s=a.document.createElement("script");s.src=o._getGooglePlacesJsApiUrl(),o._appendChildToHead(s)}o.__pendingGooglePlacesPromise=i.promise}return o.__pendingGooglePlacesPromise},_appendChildToHead:function(e){a.document.getElementsByTagName("head")[0].appendChild(e)},convertGooglePlacesDataModelToAmadeusMdwLocationObject:function(e){var t=o._jsonifyAddress(e.address_components),n=o._jsonifyGeometry(e.geometry),a=safeAccess(t,"locality.long_name");isUndefined(a)&&(a=safeAccess(t,"administrative_area_level_1.long_name",""));var r=safeAccess(t,"street_number.long_name"),s=safeAccess(t,"route.long_name"),l=[r,s].filter(function(e){return void 0!==e}).join(" ");l=""==l?null:l;var c=safeAccess(t,"neighborhood.long_name"),d=safeAccess(t,"colloquial_area.long_name"),u=safeAccess(e,"vicinity","");u=i.removeAtTheEnd(u,", "+a),u===a&&(u=null);var g={addressLine1:l||c||d||u||null,addressLine2:null,cityCode:null,cityName:a,code:null,countryCode:safeAccess(t,"country.short_name",null),countryName:safeAccess(t,"country.long_name",null),latitude:String(n.latitude),longitude:String(n.longitude),name:safeAccess(e,"name",null),stateCode:null,zip:safeAccess(t,"postal_code.long_name",null)};return g},_jsonifyGeometry:function(e){var t={},n=safeAccess(e,"location.lat"),i=safeAccess(e,"location.lng");return isDefined(n)&&angular.isFunction(n)&&(n=n()),isDefined(i)&&angular.isFunction(i)&&(i=i()),t.latitude=n,t.longitude=i,t},_jsonifyAddress:function(e){var t={};if(isDefined(e)&&angular.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];t[i.types[0]]={long_name:i.long_name,short_name:i.short_name}}return t},toString:function(){return"GooglePlaceService"}};return o}]),coreModule.service("CurrencyService",["$log","$q","DataManagerService","I18nConfig","GloballistService","GloballistProcessor",function(e,t,n,i,a,r){e=e.getInstance("CurrencyService"),e.info("Service Started...");var o={CURRENCY_LIST_GLOBAL:"LANG_CURRENCY_DESCRIPTION",CURRENCY_COUNTRY_MAPPING_GLOBAL_LIST:"NO_SL_COUNTRY",LOCALE_CURRENCY_MAP_KEY:"localeCurrencyMap",getCurrencyList:function(){var i=t.defer(),s=n.get(o.CURRENCY_LIST_KEY,n.MEMORY);return isDefined(s)?i.resolve(s):a.getGl(o.CURRENCY_LIST_GLOBAL).then(function(e){var t=r.matrixToObjectArray(e);t=o._sortCurrencyByCode(t),n.set(t,o.CURRENCY_LIST_KEY,{storage:n.MEMORY}),i.resolve(t)},function(t){e.error("getCurrencyList: rejecting promise due to backend error",t),i.reject(t)}),i.promise},_sortCurrencyByCode:function(e){var t=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};return e.sort(t)},getCurrencyCountryMappingList:function(){var i=t.defer(),r=n.get(o.LOCALE_CURRENCY_MAP_KEY,n.MEMORY);return r?i.resolve(r):a.getGl(o.CURRENCY_COUNTRY_MAPPING_GLOBAL_LIST).then(function(e){for(var t=e,a={},r=0;r<t.length;r++)a[t[r][0]]=t[r][1];n.set(a,o.LOCALE_CURRENCY_MAP_KEY,{storage:n.MEMORY}),i.resolve(a)},function(t){e.error("getCurrencyCountryMappingList: rejecting promise due to backend error",t),i.reject(t)}),i.promise},getDeviceLocaleCurrency:function(){var e=t.defer();return getContext("isMobileApp",!1)&&safeAccess(window,"cordova.plugins.DeviceLocale.getDeviceLocale")?window.cordova.plugins.DeviceLocale.getDeviceLocale(function(t){isDefined(t)?e.resolve(t):e.reject()},function(){e.reject()}):e.reject(),e.promise},getCurrencyCodesforLocales:function(n){var a=t.defer();return o.getCurrencyCountryMappingList().then(function(e){var t=e;o.getDeviceLocaleCurrency(t).then(function(e){a.resolve(o._processCountryCodeList(n,t,e))},function(e){var r=i.getCountryCodeFromDeviceLocale().toUpperCase();a.resolve(o._processCountryCodeList(n,t,t[r]))})},function(t){e.error("getCurrencyCodesforLocales: rejecting promise due to backend error",t),a.reject(t)}),a.promise},_processCountryCodeList:function(e,t,n){for(var i=[],a=0;a<e.length;a++)isDefined(e[a])&&""!==e[a]?i.push(t[e[a]]):i.push(n);return i},getDeviceCurrency:function(){var e=t.defer();return o.getDeviceLocaleCurrency().then(function(t){e.resolve(t)},function(){o._getCurrencyFromLocale().then(function(t){e.resolve(t)})}),e.promise},_getCurrencyFromLocale:function(){var e="EUR",n=t.defer(),a=i.getCountryCodeFromDeviceLocale().toUpperCase();return o.getCurrencyCountryMappingList().then(function(t){n.resolve(t[a]||e)},function(){n.resolve(e)}),n.promise},toString:function(){return"CurrencyService"}};return o}]),coreModule.directive("defaultNavBackButton",["$ionicHistory","$ionicConfig","$ionicPlatform","OrchestratorChiefService","$state",function(e,t,n,i,a){function r(a,r,s){a.backTitle=function(){return t.backButton.previousTitleText()&&o()?e.backTitle()||"back":void 0},a.goBack=function(){i.navigateBack()},a.$on("$stateChangeSuccess",function(){var e=o();r.toggleClass("hide",!e),r.toggleClass("showBackButton",e)}),n.registerBackButtonAction(function(){i.navigateBack()},100)}function o(){var e=(a.current||{}).defaultBackState;return isDefined(e)}var s={link:r,restrict:"EA"};return s}]),coreModule.directive("navigateTo",["OrchestratorChiefService",function(e){return{restrict:"A",compile:function(t,n){var i=n.navigateTo;return function(t,n){n.on("click",function(t){e.navigateTo(i)})}}}}]),coreModule.directive("stopPropagation",function(){return{restrict:"A",compile:function(e,t){return function(e,t){t.on("click",function(e){e.stopPropagation()})}}}}),coreModule.run(["$templateCache",function(e){e.put("core/templates/partial/EasterEggModal.html",'<ion-modal-view debug-file-path="EasterEggModal.html"><ion-header-bar class="bar-stable"><h1 class="title">You&apos;re a developer now!</h1><span class="button button-clear icon {{::closeicon}}" ng-click="closeModal()"></span></ion-header-bar><ion-content><div class="list" ng-if="!isReleaseBuild"><div class="spaced-element" ng-if="isUserLogged"><p><b>Log out to be able to change OCTX and Server</b></p></div><div ng-if="!isUserLogged"><div ng-if="server.list.length"><div class="item item-divider settings-header spaced-element">Server</div><div><ion-radio name="server" ng-model="server.current" ng-repeat="_server in server.list" ng-value="_server.value">{{_server.label}}</ion-radio></div></div><div ng-if="octx.list.length"><div class="item item-divider settings-header spaced-element">OCTX</div><div><ion-radio name="octx" ng-model="octx.current" ng-repeat="_octx in octx.list" ng-value="_octx.value">{{_octx.label}}</ion-radio></div></div><div ng-if="useMocks.showToggle"><div class="item item-divider settings-header spaced-element">Use mocks</div><div><ion-toggle ng-model="useMocks.activated" toggle-class="toggle-balanced">Activated</ion-toggle></div></div></div></div><div class="list" ng-if="!isReleaseBuild"><div ng-if="featuresActivation.length"><div class="item item-divider settings-header">Features activation</div><div ng-repeat="feature in featuresActivation"><ion-toggle ng-model="feature.isEnabled" toggle-class="toggle-balanced" ng-change="feature.onActivationChange()">{{feature.label}}</ion-toggle></div></div></div><div class="list"><div class="item item-divider settings-header">Connection test</div><div class="debugInfoButtonContainer"><button ng-click="testConnection(&apos;http&apos;)">http</button> <button ng-click="testConnection(&apos;https&apos;)">https</button></div></div><div class="list" ng-if="isLocalStorageOverrideActive"><div class="item item-divider settings-header">Local storage override is active</div><div class="debugInfoButtonContainer"><button ng-click="clearLocalStorageOverride()">Clear localstorage override</button></div></div><div class="list"><div class="item item-divider settings-header">Build info</div><pre><code class="debugInfoContainer" ng-bind-html="debugInfo"></code></pre></div></ion-content></ion-modal-view>')}]),window.CONSTANTS={FEATURE_CONFIG_GUEST_MODE_ENABLED:"featureConfig.guestMode.enabled",FEATURE_CONFIG_SHARE_CMT_URL_ENABLED:"featureConfig.share.cmtUrlEnabled",ITMNGT_SHARE_ERROR:"itmngt.share.error",CLICKED_BRANCH_LINK:"+clicked_branch_link",NON_BRANCH_LINK:"+non_branch_link",FEATURE_CONFIG_EXPLORE_ENABLED:"featureConfig.explore.enabled",HIDE_TABS_ON_KEYBOARD_OPEN:"hide-tabs-on-keyboard-open",APPLICATION_CONFIG_MENU_TRIPLIST_MAIN_ITEMS:"applicationConfig.menu.tripListMainItems",FORGOT_PASSWORD_ACTIVATION:"forgotpassword-activation",ACCOUNT_RECOVERY:"account-recovery",TAB_SETTINGS:"tab-settings",TAB_PROFILE:"tab-profile",NOTIFICATION_SETTINGS:"notifications-settings",EDIT_PROFILE:"edit-profile",TAB_BOOKING:"tab-booking",TAB_TRIPLIST:"tab-triplist",TAB_PAST_TRIPS:"tab-pastTrips",TRIP_EXPANDED:"trip-expanded",SEGMENT_EXPANDED:"segment-expanded",TAB_DISCOVER:"tab-discover",EPOWER_SEARCH:"epower-search",WEATHER_DETAILS:"weather-details",PROFILE_NOTIFICATIONS_SETTINGS:"profile-notifications-settings",PROFILE_EDIT_PROFILE:"profile-edit-profile",PROFILE_ADDRESS:"profile-address",PROFILE_LOYALTY_CARD_LIST:"profile-loyaltycardlist",PROFILE_LOYALTY_CARD_ADD:"profile-loyaltycardadd",PROFILE_LOYALTY_CARD_UPDATE:"profile-loyaltycardupdate",PROFILE_CREDIT_CARD_LIST:"profile-creditcardlist",PROFILE_CREDIT_CARD_ADD:"profile-creditcardadd",PROFILE_CREDIT_CARD_UPDATE:"profile-creditcardupdate",PROFILE_MARKET:"profile-market",PROFILE_GPS_CHECKIN:"profile-gpsCheckin",HELP_CONTACT:"help-contact",HELP_TERMS_AND_CONDITIONS:"help-termsandconditions",HELP_COOKIE_POLICY:"help-cookiepolicy",HELP_LICENSE:"help-license",HELP_PRIVACY_POLICY:"help-privacypolicy",PAST_TRIP_EXPANDED:"past-trip-expanded",PAST_SEGMENT_EXPANDED:"past-segment-expanded",PAST_WEATHER_DETAILS:"past-weather-details",GUEST_HOME:"guest-home",GUEST_HOTEL_BOOKING:"guest-hotelBooking",GUEST_CONTACT_US:"guest-contactUs",GUEST_FLIGHT_BOOKING:"guest-flightBooking",GUEST_EPOWER:"guest-epower",GUEST_EPOWER_SEARCH:"guest-epower-search",GUEST_EZEEGO1:"guest-ezeego1",GUEST_EZEEGO1_HOTELS:"guest-ezeego1Hotels",GUEST_DISCOVER_LIST:"guest-discoverList",GUEST_TAB_DISCOVER:"guest-tab-discover",GUEST_DISCOVER_RESULTS:"guest-discoverResults",GUEST_SEGMENT_RESULTS:"guest-segmentResults",GUEST_DISCOVER_LIST_BKNG:"guest-discoverListBkng",GUEST_GENERIC_SEARCH:"guest-genericSearch",GUEST_DISCOVER_RESULTS_BKNG:"guest-discoverResultsBkng",GUEST_SEGMENT_RESULTS_BKNG:"guest-segmentResultsBkng",GUEST_EXPLORE_MAP:"guest-exploreMap",GUEST_EXPLORE_DETAILS:"guest-exploreDetails",GUEST_TRIP_ADVISOR_MAP:"guest-tripAdvisorMap",GUEST_TRIP_ADVISOR_DETAILS:"guest-tripAdvisorDetails",GUEST_ACTIVITIES:"guest-activities",GUEST_LOUNGE:"guest-lounge",GUEST_STATIC_CONTENT:"guest-staticContent",GUEST_PARKING:"guest-parking",GUEST_HELP:"guest-help",GUEST_TAB_HELP:"guest-tab-help",GUEST_HELP_TERMS_AND_CONDITIONS:"guest-help-termsandconditions",GUEST_HELP_PRIVACY_POLICY:"guest-help-privacypolicy",GUEST_HELP_COOKIE_POLICY:"guest-help-cookiepolicy",GUEST_HELP_FAQ:"guest-help-faq",GUEST_HELP_LICENSE:"guest-help-license",ONETRUST_COOKIE_POLICY:"onetrust-cookiepolicy",AIR_SEARCH_MIN_DURATION_PARAMETER:"featureConfig.airSearchParams.minDuration",PASSANGER_FARE_AMOUNT_WITHOUT_TAX:"passengerFare.amountWithoutTax",PASSANGER_FARE_WITH_TAX:"passengerFare.tax",PASSANGER_FARE_PRICE:"passengerFare.price",CORE_TITLE_ERROR_POPUP:"core.title.errorPopup",AIR_FLIGHT_CONFIRM_SESSION_EXPIRED:"air.flightConfirm.sessionExpired",CORE_BACKEND_ERROR_CODES:"core.backendErrorCodes.000000",TYPE_QUANTITY:"type.quantity",AIR_LABEL_OPTIONS:"air.label.nextOptions",SSR_PAYMENT:"SSR Payment",SSR_ERROR_GENRIC_ERROR:"ssr.error.genericError",SSR_SEAT_TEXT_CONTACT_AGENCY_CHANGE_SEAT:"ssr.seat.text.contactAgencyChangeSeat",SSR_SEAT_LABEL_NAME:"ssr.seat.label.name",SSR_LUGGAGE_LABEL_NAME:"ssr.luggage.label.name",DATA_SUCCESS:"data.success",SSR_BOOKING_ERROR_OCCURED:"SSR booking : error occured",SSR_BOOKING_EXCEPTION_OCCURED:"SSR booking : exception occured",NO_DATA_RECIEVED:"No data received",LOADING_CONTAINER_LOADING:".loading-container .loading",LOCATION_YES:"location:yes",FEATURE_CONFIG_CORPORATE_CLIENTID:"featureConfig.corporate.clientId",FEATURE_CONFIG_CORPORATE_REDIRECTURI:"featureConfig.corporate.redirectURI",FEATURE_CONFIG_CORPORATE_AUTHURL:"featureConfig.corporate.authURL",ERROR_ADDING_NEW_CARD:"Add Card: Error adding new card",CREDITCARD:"Credit Card",CURRENCYCONVERTER_ERROR_CURRENCYINFO_NOT_AVAILABLE:"currencyConverter.error.currencyInfoNotAvailable",CYTRIC_VIEW:"cytric/templates/pages/CytricView.html",DISCOVER_CURRENTLOCATION:"discover.currentlocation",GUEST_DISCOVERLIST:"guest-discoverList",GUEST_DISCOVER_LIST_BKG:"guest-discoverListBkng",TRIP_DETAILS:"From - Trip-Details",FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ENABLED:"featureConfig.manualEtrManagement.enabled",FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ACTIVITY_ENABLED:"featureConfig.manualEtrManagement.segments.activityEnabled",FROM_EXPLORE_DETAILS:"From Explore details - ",FEATURE_CONFIG_EZEEGO1_URL:"featureConfig.ezeego1.url",EXTENSION_TYPE:"extension-type",FEATURE_CONFIG_HOTEL_CONFIG_MAX_AVL:"featureConfig.hotelConfig.maxAvl",FEATURE_CONFIG_HOTEL_CONFIG_MIN_AVL:"featureConfig.hotelConfig.minAvl",HOTEL_BOOKING:"Hotel Booking",RATE_PAYMENT_TYPE_GUARANTEE:"rate.paymentType.guarantee",RATE_PAYMENT_TYPE_DEPOSIT:"rate.paymentType.deposit",MODEL_JSON:"model.json",HOTEL_PURCHASE_COND_BOOKING_DAY:"hotel.purchaseCond.bookingDay",HOTEL_PURCHASE_COND_BOOKING_DAYS:"hotel.purchaseCond.bookingDays",HOTEL_BOOKING_ERROR_WHILE_CONFIRMATION:"Hotel Booking-Error while hotel confirmation",MESSENGER_RESET_ERROR_POPUP:"messenger.reset.errorPopup",SLIDE_IN_UP:"slide-in-up",MESSENGER_ERROR:"messenger.error.",FEATURE_CONFIG_MAIN_FEATURES_PROFILE_MENU_ENABLED:"featureConfig.mainFeatures.isProfileMenuEnabled",MARKET_DATA_IS_GROUP_ENABLED:"marketData.isGroupEnabled",MARKET_DATA_COUNTRY_LIST_OPTIONS:"marketData.countryListOptions",MARKET_DATA_MARKETS_WITH_COUNTRY:"marketData.marketsWithCountry",MARKET_DATA_MARKET_LIST_OPTIONS:"marketData.marketListOptions",DATA_ERROR_CODES:"data.errorCodes",CARD_ERRORS:"card-errors",FAILED_TO_GET_MESSAGES:"Failed to get messages",DD_MM_YYYY:"DD/MM/YYYY",ACTIVE_ION_POPOVER_VIEW:".active ion-popover-view",SHARED_LABEL_DONE:"shared.label.done",TAB_ITEM_ACTIVE:"tab-item-active",EXTERNAL_CONTENT:"External Content",STATIC_CONTENT:"Static Content",FEATURE_CONFIG_CYTRIC_ENABLED:"featureConfig.cytric.enabled",ICON_MORE_DOTS:"icon-more-dots",TRAVELDOC_BUTTON_OK_BUTTON:"travelDoc.button.okBtn",TRAVELDOC_ERROR_DOC_DUPLICATE_FILE:"travelDoc.error.docDuplicateFile",ERROR_AFTER_CREATING_DIRECTORY:"Error : Unkonwn error after creating directory",FAILED_TO_RESOLVE_SOURCE_FILE:"Failed to Resolve source file path"},window.coreUiModule=angular.module("CoreUiModule",["ionic","CoreModule","$actionButton","ionic-datepicker","ionic-timepicker"]),window.coreUiModule.config(["$translatePartialLoaderProvider","$translateProvider",function(e,t){e.addPart("core-ui")}]),window.coreUiModule.run(["$log","LoggingService",function(e,t){e=e.getInstance("CoreUi"),e.info("Module started")}]),coreUiModule.directive("focusMe",["$timeout","$parse",function(e,t){return{link:function(n,i,a){var r=t(a.focusMe);n.$watch(r,function(t){t===!0&&e(function(){i[0].focus()})})}}}]),coreUiModule.directive("enabledIf",["$animate","$compile","$rootScope",function(e,t,n){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(i,a,r,o,s){function l(n){isDefined(n)&&isFeatureEnabled(n)?d||s(function(n,i){d=i,n[n.length++]=t.$$createComment("end ngIf",r.ngIf),c={clone:n},e.enter(n,a.parent(),a)}):(u&&(u.remove(),u=null),d&&(d.$destroy(),d=null),c&&(u=getBlockNodes(c.clone),e.leave(u).done(function(e){e!==!1&&(u=null)}),c=null))}var c,d,u;i.$watch(r.enabledIf,l),n.$on("paramsUpdates",function(e,t){l(r.enabledIf)})}}}]),coreUiModule.directive("cmtTextArea",["I18nService",function(e){return{restrict:"E",templateUrl:"core-ui/directives/CmtTextAreaDirective.html",require:["^form"],controller:["$scope",function(e){}],scope:{"class":"@",label:"@",placeholder:"@",name:"@",readonly:"=",minlength:"@",maxlength:"@",rows:"@",charsCounter:"=",requiredTranslation:"@",minLengthTranslation:"@",maxLengthTranslation:"@",data:"=",onBlur:"&",onFocus:"&"},compile:function(e,t){var n=e.find("textarea")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,this.link},link:function(t,n,i,a){t.form=a[0],void 0===t.requiredTranslation&&e.translate("coreUi.error.mandatory").then(function(e){t.requiredTranslation=e}),void 0===t.minLengthTranslation&&e.translate("coreUi.error.minLength").then(function(e){t.minLengthTranslation=e}),void 0===t.maxLengthTranslation&&e.translate("coreUi.error.maxLength").then(function(e){t.maxLengthTranslation=e}),t.validateMaxLength=function(){isDefined(t.maxlength)&&t.data&&t.data.length>t.maxlength&&(t.data=t.data.substr(0,t.maxlength))},t.required=isDefined(i.required)},toString:function(){return"cmtTextArea"}}}]),coreUiModule.directive("cmtInputText",["I18nService","I18nConfig","NAME_REGEX","PNR_REGEX","FLIGHT_NUMBER_REGEX","CONFIRMATION_NUMBER_REGEX",function(e,t,n,i,a,r){return{restrict:"E",templateUrl:"core-ui/directives/CmtInputTextDirective.html",require:["^form"],scope:{"class":"@",label:"@",placeholder:"@",name:"@",type:"@",readonly:"=",minlength:"@",maxlength:"@",usePattern:"@",requiredTranslation:"@",minLengthTranslation:"@",maxLengthTranslation:"@",usePatternTranslation:"@",data:"=",onBlur:"&",onFocus:"&",autoComplete:"@",allowMaskedValues:"="},compile:function(e,t){var n=e.find("input")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,this.link},link:function(t,o,s,l){if(t.form=l[0],t.type=isDefined(t.type)?t.type:"text",
t.autoComplete=isDefined(t.autoComplete)?t.autoComplete:"on",void 0===t.requiredTranslation&&e.translate("coreUi.error.mandatory").then(function(e){t.requiredTranslation=e}),void 0===t.minLengthTranslation&&e.translate("coreUi.error.minLength").then(function(e){t.minLengthTranslation=e}),void 0===t.maxLengthTranslation&&e.translate("coreUi.error.maxLength").then(function(e){t.maxLengthTranslation=e}),void 0!==t.usePattern){var c="coreUi.error.pattern";switch(t.usePattern){case"firstName":case"lastName":t.pattern=n,c="coreUi.error.invalidName";break;case"PNR":t.pattern=i,c="coreUi.error.invalidPNR",t.autoComplete="off";break;case"flightNumber":t.pattern=a,c="coreUi.error.invalidFlightNumber";break;case"confirmationNumber":t.pattern=r,c="coreUi.error.invalidConfirmationNumber";break;default:t.pattern=void 0}void 0!==t.pattern&&void 0===t.usePatternTranslation&&e.translate(c).then(function(e){t.usePatternTranslation=e})}t.required=isDefined(s.required),t.allowMaskedValues&&(t.pattern="")},toString:function(){return"cmtInputText"}}}]),coreUiModule.directive("cmtInputDate",["I18nService","ionicDatePicker","$filter",function(e,t,n){return{restrict:"E",templateUrl:"core-ui/directives/CmtInputDateDirective.html",require:["^form"],scope:{"class":"@",label:"@",name:"@",requiredTranslation:"@",from:"=",to:"=",data:"="},compile:function(e,t){var n=e.find("input")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,this.link},link:function(i,a,r,o){i.form=o[0],i.readonly=getContext("isWebDesktop",!1),i.openPicker=function(){if(getContext("isWebDesktop")){var e=moment.localeData(),a=e.months(),r=e.weekdaysMin(),o=moment(i.data),s={callback:function(e){i.data=new Date(e)},titleLabel:o.format("DD MMM YYYY"),weeksList:r,monthsList:a,setLabel:n("translate")("core.button.ok"),closeLabel:n("translate")("core.button.cancel"),from:isDefined(i.from)?i.from:null,to:isDefined(i.to)?i.to:null,inputDate:i.data,mondayFirst:!0};t.openDatePicker(s)}},void 0===i.requiredTranslation&&e.translate("coreUi.error.mandatory").then(function(e){i.requiredTranslation=e}),i.required=isDefined(r.required)},toString:function(){return"cmtInputDate"}}}]),coreUiModule.directive("cmtInputTime",["I18nService","ionicTimePicker","$filter",function(e,t,n){return{restrict:"E",templateUrl:"core-ui/directives/CmtInputTimeDirective.html",require:["^form"],scope:{"class":"@",label:"@",name:"@",requiredTranslation:"@",data:"="},compile:function(e,t){var n=e.find("input")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,this.link},link:function(i,a,r,o){i.form=o[0],i.readonly=getContext("isWebDesktop",!1),i._convertDateToEpochTime=function(e){return 60*e.getHours()*60+60*e.getMinutes()},i._convertEpochTimeToDate=function(e){var t=new Date(1e3*e),n=60*t.getUTCHours()*60+60*t.getUTCMinutes()+60*t.getTimezoneOffset();return new Date(1e3*n+864e5)},i.openPicker=function(){if(getContext("isWebDesktop")){var e=moment(i.data),a={callback:function(e){i.data=i._convertEpochTimeToDate(e)},titleLabel:e.format("HH:mm"),setLabel:n("translate")("core.button.ok"),closeLabel:n("translate")("core.button.cancel"),inputTime:i._convertDateToEpochTime(i.data),format:24,step:5};t.openTimePicker(a)}},void 0===i.requiredTranslation&&e.translate("coreUi.error.mandatory").then(function(e){i.requiredTranslation=e}),i.required=isDefined(r.required)},toString:function(){return"cmtInputTime"}}}]),coreUiModule.directive("inputTimeFormat",["$filter",function(e){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){getContext("isWebDesktop")&&i.$formatters.unshift(function(e){return e.replace(":00.000","")})}}}]),coreUiModule.directive("cmtInputEmail",["I18nService","EMAIL_REGEX",function(e,t){return{restrict:"E",templateUrl:"core-ui/directives/CmtInputEmailDirective.html",require:["^form"],controller:["$scope",function(e){}],scope:{"class":"@",label:"@",placeholder:"@",name:"@",requiredTranslation:"@",invalidEmailTranslation:"@",modelContainer:"=",modelKey:"=",allowMaskedValues:"="},compile:function(e,t){var n=e.find("input")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,this.link},link:function(n,i,a,r){n.form=r[0],n.allowMaskedValues?n.emailRegex="":n.emailRegex=t,isDefined(r[0].emailInput)&&isDefined(r[0].emailInput.$validators)&&(r[0].emailInput.$validators.email=function(){return!0}),void 0===n.requiredTranslation&&e.translate("coreUi.error.mandatory").then(function(e){n.requiredTranslation=e}),void 0===n.invalidEmailTranslation&&e.translate("coreUi.error.invalidEmail").then(function(e){n.invalidEmailTranslation=e}),n.required=void 0!==a.required,n.readonly=n.$eval(a.readonly)||n.allowMaskedValues},toString:function(){return"cmtInputEmail"}}}]),coreUiModule.directive("cmtInputPhone",["$rootScope","$log","GloballistProcessor","$ionicModal","LayoutService","I18nService","I18nConfig",function(e,t,n,i,a,r,o){return t=t.getInstance("cmtInputPhone"),{restrict:"E",templateUrl:"core-ui/directives/CmtInputPhoneDirective.html",require:["^form"],controller:["$scope",function(e){}],scope:{"class":"@",label:"@",placeholder:"@",name:"@",readonly:"=",requiredTranslation:"@",invalidPhoneTranslation:"@",phoneNumberModel:"=",phoneCodeModel:"="},compile:function(e,t){var n=e.find("input")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,this.link},link:function(o,s,l,c){o.phoneData={_phoneCountryCodesList:[]},o._reloadFlagDependingOnPhoneCode=function(){};var d=n.getCallingCountryCodeByCountry();d.then(function(e){o.phoneData._phoneCountryCodesList=e,isDefined(o.phoneCodeModel)&&""!==o.phoneCodeModel?o._reloadFlagDependingOnPhoneCode():r.getDeviceLocaleCountryCodeFromPlugin().then(function(t){for(var n=0;n<e.length;n++)if(e[n].countryCode===t){o.phoneCodeModel=e[n].phoneCode;break}}),o.$watch("phoneCodeModel",function(e,t){o._reloadFlagDependingOnPhoneCode()})},function(e,n){t.error("Can't get the GlobalList:"+e+" Reason:"+JSON.stringify(n))}),o.form=c[0],void 0===o.requiredTranslation&&r.translate("coreUi.error.mandatory").then(function(e){o.requiredTranslation=e}),void 0===o.invalidPhoneTranslation&&r.translate("coreUi.error.invalidPhoneNumber").then(function(e){o.invalidPhoneTranslation=e}),o.chooseCountry=function(){o.readonly||i.fromTemplateUrl("selectcountry-modal.html",{scope:o,animation:"slide-in-up",focusFirstInput:!1}).then(function(e){o.modal=e,a.showModal(o.modal)})},o.closeModal=function(e){e&&(o.phoneCodeModel=e.phoneCode),a.removeModal(o.modal)},o.allowOnlyNumbers=function(e){isDefined(e)&&(o.phoneNumberModel=e.replace(/\D/g,""))},o.closeicon=e.closeicon,o.required=/^true$/i.test(l.required)},toString:function(){return"cmtInputPhone"}}}]),coreUiModule.directive("cmtInputPassword",["I18nService","PASSWORD_REGEX","LayoutService","$timeout",function(e,t,n,i){return{restrict:"E",templateUrl:"core-ui/directives/CmtInputPasswordDirective.html",require:["^form"],controller:["$scope",function(e){}],scope:{"class":"@",label:"@",name:"@",requiredTranslation:"@",invalidPasswordTranslation:"@",data:"="},compile:function(e,t){var n=e.find("input")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,this.link},link:function(a,r,o,s){a.form=s[0],a.keepFocusOnInput=!1,void 0===a.requiredTranslation&&e.translate("coreUi.error.mandatory").then(function(e){a.requiredTranslation=e}),void 0===o.novalidate&&void 0===a.invalidPasswordTranslation&&e.translate("coreUi.error.invalidPassword").then(function(e){a.invalidPasswordTranslation=e}),void 0!==o.required?a.required=!0:a.required=!1;var l=getContext("featureConfig.registration.passwordRegExpression","");void 0!==o.novalidate?a.pattern=void 0:null!==l&&""!==l?a.pattern=l:a.pattern=t,a.toggle=function(){var e=r.find("input")[0],t=r.find("i")[0];document.activeElement===e&&(a.keepFocusOnInput=!0),"password"===e.type?(e.type="text",n.addCssClass(t,"show-password")):(e.type="password",n.removeCssClass(t,"show-password"))},a.onInputBlur=function(e){isDefined(e.srcElement)&&a.keepFocusOnInput&&(e.srcElement.focus(),i(function(){e.srcElement.focus()})),a.keepFocusOnInput=!1}},toString:function(){return"cmtInputPassword"}}}]),coreUiModule.directive("cmtSelect",["I18nService",function(e){return{restrict:"E",templateUrl:"core-ui/directives/CmtSelectDirective.html",require:["^form"],controller:["$scope",function(e){}],scope:{"class":"@",wrapClass:"@",label:"@",name:"@",requiredTranslation:"@",placeholder:"@",options:"&",data:"="},compile:function(e,t){var n=e.find("select")[0],i=e.find("label")[0],a=(new Date).getTime()+"_"+Math.floor(1e3*Math.random());return n.id=a,i.htmlFor=a,t.wrapClass=t.wrapClass||"input-wrap",this.link},link:function(t,n,i,a){t.form=a[0],void 0===t.requiredTranslation&&e.translate("coreUi.error.mandatory").then(function(e){t.requiredTranslation=e}),void 0!==i.required?t.required=!0:t.required=!1},toString:function(){return"cmtSelect"}}}]),coreUiModule.directive("cmtMenu",["$rootScope","$log","MenuService","$ionicActionSheet","$timeout","$ionicTabsDelegate","$actionButton","$ionicPopover","I18nService","$window","PostMessageService",function(e,t,n,i,a,r,o,s,l,c,d){t=t.getInstance("cmtMenu");var u={restrict:"E",templateUrl:"core-ui/directives/CmtMenuDirective.html",scope:{list:"=",context:"=",isHeaderMenu:"<",menuStyle:"<",showLabel:"<"},MATERIAL_DESIGN:"material-design",ACTION_SHEET:"action-sheet",destructiveItem:void 0,hideSheet:null,_popover:void 0,actionSheet:function(t,n,a,r){isUndefined(u.hideSheet)&&l.translate("coreUi.button.cancel").then(function(t){var o={name:"cancel",label:t,action:function(){u.hideSheet=null,e.$emit("MultiMenuCancelEvent")}};u.destructiveItem=r,a=a.map(function(e){return e.text='<i id="menu-'+e.name+'" class="space-rt icon '+e.icon+'"></i> '+e.label,e}),isDefined(u.destructiveItem)&&(u.destructiveItem.text='<i id="menu-'+r.name+'" class="space-rt icon '+r.icon+'"></i> '+r.label),u.hideSheet=i.show({destructiveText:isDefined(u.destructiveItem)?u.destructiveItem.text:null,destructiveButtonClicked:isDefined(u.destructiveItem)?u.callDestructive:null,cancelText:isDefined(o)?o.label:null,cancel:isDefined(o)?o.action:null,buttons:a,buttonClicked:function(e){return u.hideSheet(),u.hideSheet=null,isDefined(a[e].action)&&a[e].action(n),!0}})})},callDestructive:function(){isDefined(u.hideSheet)&&(u.hideSheet(),u.hideSheet=null),u.destructiveItem.action()},openPopOver:function(t,n,i,a){isDefined(a)&&i.push(a);var r=e.$new();r.listItem=i;var o=57;r.contentStyle={height:i.length*o+"px"},s.fromTemplateUrl("menuPopOver.html",{scope:r}).then(function(e){u._popover=e,r.popoverItemClicked=function(e,n){n.isIonicTap&&u.popoverItemClickedHandler(e,n,t.context)},r.$on("popover.shown",function(e,t){t.el.classList.add("menu")}),r.$on("popover.hidden",function(){u._popover.remove()}),u._popover.show(u.getCompliantTarget(n))})},getCompliantTarget:function(e){var t=e.currentTarget||e.target,n=16;return t.getBoundingClientRect=function(){return{width:t.offsetWidth,height:t.offsetHeight,top:t.offsetTop+n+document.getElementById("mainContainer").offsetTop-(isDefined(c.scrollY)?c.scrollY:c.pageYOffset),left:document.body.clientWidth/2-document.getElementById("mainContainer").offsetWidth/2+t.offsetLeft+t.offsetWidth/2-document.getElementsByTagName("ion-popover-view")[0].offsetWidth/2}},t},popoverItemClickedHandler:function(e,t,n){u._popover.hide().then(function(){isDefined(e.action)&&e.action(t)})},handleClick:function(t){var n=u.getItems(t.scope),i=n.listItem,a=n.destructiveItem;if(i.length>1||i.length>0&&isDefined(a)){e.$emit("MultiMenuOpenEvent");var r=u.determineMenuStyle(t.scope);r===u.ACTION_SHEET?u.actionSheet(t.scope,t.event,i,a):u.openPopOver(t.scope,t.event,i,a)}else{var o=isDefined(i[0])?i[0]:a;isDefined(o.action)&&o.action(t.event)}},getItems:function(e){var t=isDefined(e.list)?e.list:[];return{destructiveItem:n.getDestructiveItem(e.context,t),listItem:n.listItem(e.context,t,!1)}},displayMainButton:function(e){var t=u.getItems(e),n=t.listItem.length;isDefined(t.destructiveItem)&&n++;var i=n>1;if(e.show=!1,n>0){var a=u.determineMenuStyle(e);a===u.MATERIAL_DESIGN?u.showAsFloatingButton(e,i,t.listItem,t.destructiveItem,a):u.showAsStaticButton(e,i,t.listItem,t.destructiveItem,a)}},isMaterialDesignSupported:function(){return ionic.Platform.isAndroid()&&ionic.Platform.version()>4.4||isDesktop()},showAsStaticButton:function(e,t,n,i,r){e.show=!0,e.handleClick=function(t){a(function(){u.handleClick({scope:e,event:t})},300),t.stopPropagation()};var o=u.getMainItem(n,i,r);e.icon=o.icon,e.label=o.label,d.send({type:"navBarButtonChangeEvent",buttonType:e.icon.replace("icon-",""),buttonID:0}),d.when("navBarButtonTapEvent").then(function(t){!isDefined(t)||0!==t&&0!==t.buttonID||u.handleClick({scope:e,event:null})})},showAsFloatingButton:function(e,t,n,i,a){e.show=!1;var s=u.getMainItem(n,i,a),l={hasTab:r.showBar(),removeOnStateChange:!0,mainAction:{icon:s.icon,label:s.label,id:"menu-main",closeIcon:"ion-android-close",onClick:void 0},buttons:void 0};if(t){l.buttons=[],i&&n.push(i);for(var c=0;c<n.length;c++){var d=n[c];l.buttons.push({icon:d.icon,label:d.label,id:"menu-"+d.name,destructive:d.isDestructive,onClick:function(e,t){isDefined(n[t])&&isDefined(n[t].action)&&e.isIonicTap&&n[t].action(e)}})}}else l.mainAction.onClick=function(e){e.isIonicTap&&s.action(e)};u.$actionButton&&u.$actionButton.hide(),u.$actionButton=o.create(l)},getMainItem:function(e,t,n){return e.length>1||1===e.length&&isDefined(t)?n===u.MATERIAL_DESIGN?{icon:"ion-plus"}:{icon:"icon-plus"}:isDefined(t)?t:e[0]},determineMenuStyle:function(e){return isUndefined(e.menuStyle)||e.menuStyle===u.MATERIAL_DESIGN&&!u.isMaterialDesignSupported()?u.ACTION_SHEET:e.menuStyle},link:function(e,t,n){e.$watch("context",function(t,n){u.displayMainButton(e)});var i=e.$on("$stateChangeStart",function(){var t=u.determineMenuStyle(e);t===u.ACTION_SHEET&&d.send({type:"navBarButtonChangeEvent",buttonType:null,buttonID:0}),i()})}};return u}]),coreUiModule.directive("dateRange",["$timeout","DateTimeService",function(e,t){return{restrict:"AE",scope:{dateRangeStart:"=",dateRangeEnd:"="},require:"ngModel",link:function(n,i,a,r){var o=n.$eval(a.defaultStartDate),s=n.$eval(a.defaultEndDate),l=a.validityKey,c=a.datesOffsetUnit,d=parseInt(a.datesOffsetValue,10);n._calculateNewValidDateAndTime=function(e,t,i){var a=n._createTimeFromDate(e.date,e.time);switch(i){case"h":a.setHours(a.getHours()+t);break;case"d":a.setDate(a.getDate()+t)}return a},n._createTimeFromDate=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())};var u,g=isDesktop()?100:700;n.$watch("dateRangeStart",function(i,a){e.cancel(u),e.cancel(p),u=e(function(){n.dateRangeStart.date=n.dateRangeStart.date||o,n.dateRangeStart.time=n.dateRangeStart.time||o;var e=t.isValidDatesRange(n.dateRangeStart,n.dateRangeEnd);if(r.$setValidity(l,e),!e){var i=n._calculateNewValidDateAndTime(n.dateRangeStart,d,c);n.dateRangeEnd.date=i,n.dateRangeEnd.time=i}},g)},!0);var p;n.$watch("dateRangeEnd",function(i,a){e.cancel(u),e.cancel(p),p=e(function(){n.dateRangeEnd.date=n.dateRangeEnd.date||s,n.dateRangeEnd.time=n.dateRangeEnd.time||s;var e=t.isValidDatesRange(n.dateRangeStart,n.dateRangeEnd);if(r.$setValidity(l,e),!e){var i=n._calculateNewValidDateAndTime(n.dateRangeEnd,-d,c);n.dateRangeStart.date=i,n.dateRangeStart.time=i}},g)},!0)}}}]),coreUiModule.directive("googlePlace",["GooglePlaceService","$log","LayoutService","$ionicModal","$rootScope","OrchestratorChiefService",function(e,t,n,i,a,r){t=t.getInstance("googlePlace"),t.info("Directive Started...");var o={restrict:"E",templateUrl:"core-ui/directives/GooglePlaceDirective.html",require:["^form"],scope:{"class":"@",label:"@",id:"@",title:"@",name:"@",required:"@",readonly:"@",location:"="},updateLocation:function(e){if(isDefined(e.location)&&isDefined(e.location.amadeusLocation)){var t=e.location.amadeusLocation,n=[e.location.Name,t.addressLine1,t.cityName,t.countryName];n=n.filter(function(e){return isDefined(e)&&""!==e.trim()}),e.googlePlacesAutocompleteSelectedName=e.location.Name,e.googlePlacesAutocompleteSelectedDescription=n.join(", "),e.amadeusLocation=e.location.amadeusLocation}},controller:["$scope",function(s){s.closeicon=a.closeicon,s.forms={},o.updateLocation(s),s.showModalPlace=function(){n.startLoading(),e.loadGooglePlacesJsApi().then(function(){i.fromTemplateUrl("GooglePlacesModalView.html",{scope:s,animation:"slide-in-up",focusFirstInput:!0}).then(function(e){n.stopLoading(),s.googlePlacesModal=e,n.showModal(s.googlePlacesModal).then(function(){t.info("modal displayed")}),r.registerNavigateBackFromModal()})},function(e){n.stopLoading(),t.error(e),n.toastError("core.backendErrorCodes.000000")})},s.closeGooglePlacesModal=function(){safeAccess(s,"googlePlacesModal")&&(n.removeModal(s.googlePlacesModal),s.googlePlacesModal=null,r.unregisterNavigateBackFromModal())},s.onSelectionChanged=function(t){s.location={name:t.name,utc_offset:t.details.utc_offset,amadeusLocation:e.convertGooglePlacesDataModelToAmadeusMdwLocationObject(t.details)},s.googlePlacesAutocompleteSelectedDescription=t.description,s.closeGooglePlacesModal()},s.$watch("location",function(e,t){e!==t&&o.updateLocation(s)})}],link:function(e,t,n,i){e.form=i[0]},toString:function(){return"googlePlace"}};return o}]),coreUiModule.directive("lazyScroll",["$rootScope",function(e){return{restrict:"A",link:function(t,n){var i=t.$onScroll;t.$onScroll=function(){e.$broadcast("lazyScrollEvent"),"function"==typeof i&&i()}}}}]).directive("imageLazySrc",["$document","$timeout","$ionicScrollDelegate","$compile",function(e,t,n,i){return{restrict:"A",scope:{lazyScrollResize:"@lazyScrollResize",imageLazyBackgroundImage:"@imageLazyBackgroundImage",imageLazySrc:"@",imageLazyLoadIfHidden:"="},link:function(a,r,o){function s(){"true"!==a.imageLazyBackgroundImage&&r.addClass("ng-hide"),d(),o.imageLazyLoader&&(u=i('<div class="image-loader-container"><ion-spinner class="image-loader" icon="'+o.imageLazyLoader+'"></ion-spinner></div>')(a),r.after(u));var e=a.$on("lazyScrollEvent",function(){c()&&(l(),e())});t(function(){c()&&(l(),e())},300)}function l(){if(r.on("load",function(e){"true"!==a.imageLazyBackgroundImage&&r.removeClass("ng-hide"),d(),"true"===a.lazyScrollResize&&n.resize(),r.off("load")}),r.on("error",function(e){if(d(),o.imageLazyErrorText&&!a.hasDisplayedError){a.hasDisplayedError=!0;var t=i("<p>"+o.imageLazyErrorText+"</p>")(a);r.after(t)}r.off("error")}),"true"===a.imageLazyBackgroundImage){var e=new Image;e.onload=function(){o.imageLazyLoader&&u.remove(),r[0].style.backgroundImage="url("+o.imageLazySrc+")","true"===a.lazyScrollResize&&n.resize()},e.src=o.imageLazySrc}else r[0].src=o.imageLazySrc}function c(){if(a.imageLazyLoadIfHidden)return!0;var t=e[0].documentElement.clientHeight,n=e[0].documentElement.clientWidth,i=r[0].getBoundingClientRect();return i.top>=0&&i.top<=t+parseInt(o.imageLazyDistanceFromBottomToLoad,10)&&i.left>=0&&i.left<=n+parseInt(o.imageLazyDistanceFromRightToLoad,10)}function d(){o.imageLazyLoader&&u&&u.remove()}a.hasDisplayedError=!1;var u;o.imageLazyDistanceFromBottomToLoad||(o.imageLazyDistanceFromBottomToLoad=0),o.imageLazyDistanceFromRightToLoad||(o.imageLazyDistanceFromRightToLoad=0),a.$watch("imageLazySrc",function(e,t){t!==e&&s()}),s()}}}]),coreUiModule.run(["$templateCache",function(e){e.put("core-ui/directives/CmtInputDateDirective.html",'<script debug-file-path="CmtInputDateDirective.html" id="CmtInputDateDirective_Errors.html" type="text/ng-template"><span ng-show="form.$submitted && form.{{name}}Input.$error.required" class="validation ng-hide">{{requiredTranslation}}</span></script><div class="{{class}}"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-show="label"></label> <span class="input-wrap"><input id="__generatedid__" name="{{name}}Input" ng-click="openPicker()" ng-model="data" ng-readonly="readonly" ng-required="required" type="date"><ng-include src="&apos;CmtInputDateDirective_Errors.html&apos;"></ng-include></span></div>'),e.put("core-ui/directives/CmtInputEmailDirective.html",'<div class="{{class}}" debug-file-path="CmtInputEmailDirective.html"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-show="label"></label> <span class="input-wrap"><input autocomplete="off" id="__generatedid__" name="{{name}}Input" ng-class="{&apos;color-lowContrast&apos;: readonly}" ng-model="modelContainer[modelKey]" ng-pattern="emailRegex" ng-readonly="readonly" ng-required="required" placeholder="{{placeholder}}" type="email"> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}Input.$error.required">{{requiredTranslation}}</span> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}Input.$error.pattern">{{invalidEmailTranslation}}</span></span></div>'),e.put("core-ui/directives/CmtInputPasswordDirective.html",'<div class="{{class}}" debug-file-path="CmtInputPasswordDirective.html"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-show="label"></label> <span class="input-wrap input-wrap-with-icon"><input autocomplete="off" id="__generatedid__" name="{{name}}Input" ng-blur="onInputBlur($event)" ng-model="data" ng-pattern="pattern" ng-required="required" type="password"> <i class="icon-password" ng-click="toggle()"></i> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}Input.$error.required">{{requiredTranslation}}</span> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}Input.$error.pattern">{{invalidPasswordTranslation}}</span></span></div>'),e.put("core-ui/directives/CmtInputPhoneDirective.html",'<div class="{{class}}" debug-file-path="CmtInputPhoneDirective.html"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-show="label"></label> <span class="input-wrap"><div class="phone-country-and-number"><div class="phone-country-choice-wrapper"><span class="phone-country-choice" id="countryChoice" ng-class="{&apos;color-lowContrast&apos;: readonly}" ng-click="chooseCountry()">{{phoneCodeModel}}</span></div><input class="phone-number-input" id="__generatedid__" name="{{name}}" ng-change="allowOnlyNumbers(phoneNumberModel)" ng-class="{&apos;color-lowContrast&apos;: readonly}" ng-model="phoneNumberModel" ng-readonly="readonly" ng-required="required" placeholder="{{placeholder}}" style="width:calc(100% - 4.5em)" type="tel"></div><span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}.$error.required">{{requiredTranslation}}</span> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}.$error.phoneNumber">{{invalidPhoneTranslation}}</span></span><script id="selectcountry-modal.html" type="text/ng-template"><ion-modal-view>\n              <ion-header-bar class="bar-stable">\n                  <h1 class="title" translate>coreUi.phoneinput.title.selectphonecountry</h1>\n                  <span class="button icon button-clear {{::closeicon}}" ng-click="closeModal()"></span>\n              </ion-header-bar>\n              <ion-content>\n                  <ul class="list">\n                      <li ng-click="closeModal(phoneCountryCode)" class="item"\n                          ng-repeat="phoneCountryCode in phoneData._phoneCountryCodesList">\n                          {{phoneCountryCode.country}}\n                      </li>\n                  </ul>\n              </ion-content>\n          </ion-modal-view></script></div>'),e.put("core-ui/directives/CmtInputTextDirective.html",'<script debug-file-path="CmtInputTextDirective.html" id="CmtInputTextDirective_Errors.html" type="text/ng-template"><span ng-show="form.$submitted && form.{{name}}Input.$error.required" class="validation ng-hide">{{requiredTranslation}}</span>\n  <span ng-show="form.$submitted && form.{{name}}Input.$error.minlength" class="validation ng-hide">{{minLengthTranslation}}</span>\n  <span ng-show="form.$submitted && form.{{name}}Input.$error.maxlength" class="validation ng-hide">{{maxLengthTranslation}}</span>\n  <span ng-show="form.$submitted && form.{{name}}Input.$error.pattern" class="validation ng-hide">{{usePatternTranslation}}</span></script><div class="{{class}}"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-if="label"></label> <span class="input-wrap"><input autocomplete="{{autoComplete}}" id="__generatedid__" name="{{name}}Input" ng-blur="onBlur($event);" ng-class="{&apos;color-lowContrast&apos;: readonly}" ng-focus="onFocus($event);" ng-maxlength="{{maxlength}}" ng-minlength="{{minlength}}" ng-model="data" ng-pattern="pattern" ng-readonly="readonly" ng-required="required" placeholder="{{placeholder}}" type="{{type}}"><ng-include src="&apos;CmtInputTextDirective_Errors.html&apos;"></ng-include></span></div>'),e.put("core-ui/directives/CmtInputTimeDirective.html",'<script debug-file-path="CmtInputTimeDirective.html" id="CmtInputTimeDirective_Errors.html" type="text/ng-template"><span ng-show="form.$submitted && form.{{name}}Input.$error.required" class="validation ng-hide">{{requiredTranslation}}</span></script><div class="{{class}}"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-show="label"></label> <span class="input-wrap"><input id="__generatedid__" input-time-format name="{{name}}Input" ng-click="openPicker()" ng-model="data" ng-readonly="readonly" ng-required="required" type="time"><ng-include src="&apos;CmtInputTimeDirective_Errors.html&apos;"></ng-include></span></div>'),e.put("core-ui/directives/CmtMenuDirective.html",'<script debug-file-path="CmtMenuDirective.html" id="menuPopOver.html" type="text/ng-template"><ion-popover-view ng-style="contentStyle">\n    <ion-content>\n      <ion-list show-delete="false"\n                show-reorder="false"\n                can-swipe="false">\n        <ion-item ng-repeat="item in listItem" ng-click="popoverItemClicked(item,$event)">\n          <i ng-attr-id="{{\'menu-\' + item.name}}" class="icon space-rt" ng-class="item.icon"></i> {{item.label|translate}}\n        </ion-item>\n      </ion-list>\n    </ion-content>\n  </ion-popover-view></script><button class="icon {{icon}}" id="menu-main" ng-class="{&apos;btn-inverse&apos;: !isHeaderMenu, &apos;button button-clear&apos;: isHeaderMenu}" ng-click="handleClick($event)" ng-if="show" stop-propagation>{{showLabel?label:&apos;&apos;}}</button>'),e.put("core-ui/directives/CmtSelectDirective.html",'<div class="{{class}}" debug-file-path="CmtSelectDirective.html"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-show="label"></label> <span class="{{wrapClass}}"><select id="__generatedid__" name="{{name}}" ng-model="data" ng-required="required"><option value ng-show="placeholder">{{placeholder}}</option><option value="{{option.value}}" ng-repeat="option in options()" ng-selected="option.value == data">{{option.text}}</option></select> <i class="icon-select"></i> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}.$error.required">{{requiredTranslation}}</span></span></div>'),e.put("core-ui/directives/CmtTextAreaDirective.html",'<div class="{{class}}" debug-file-path="CmtTextAreaDirective.html"><label for="__generatedid__" ng-bind-html="label | nonBreaking" ng-show="label"></label> <span class="input-wrap"><textarea id="__generatedid__" name="{{name}}" ng-blur="onBlur($event);" ng-change="validateMaxLength();" ng-class="{&apos;color-lowContrast&apos;: readonly}" ng-focus="onFocus($event);" ng-model="data" ng-readonly="readonly" ng-required="required" placeholder="{{placeholder}}" rows="{{rows}}"></textarea> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}.$error.required">{{requiredTranslation}}</span> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}.$error.minlength">{{minLengthTranslation}}</span> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}.$error.maxlength">{{maxLengthTranslation}}</span> </span><span class="char-counter" ng-if="charsCounter">{{data.length || 0}} / {{maxlength}}</span></div>'),e.put("core-ui/directives/GooglePlaceDirective.html",'<script debug-file-path="GooglePlaceDirective.html" id="GooglePlacesModalView.html" type="text/ng-template"><ion-modal-view>\n    <ion-header-bar class="bar-stable">\n      <h1 class="title">{{title|translate}}</h1>\n      <span class="button icon button-clear {{::closeicon}}" ng-click="closeGooglePlacesModal()"></span>\n    </ion-header-bar>\n    <ion-content has-bouncing="false">\n      <form class="google-places-form etr-search-place" name="forms.googlePlacesForm" novalidate>\n        <ion-google-place-autocomplete placeholder="{{label | translate}}" ng-model="modalScope.googlePlacesAutocompleteUserEntry"\n          name="address" location-changed="onSelectionChanged" search-types="modalScope.googlePlacesSearchTypes" required/>\n      </form>\n    </ion-content>\n  </ion-modal-view></script><div class="etr-input not-really-disabled"><label for="{{id}}">{{label|translate}}</label><div class="etr-search-place" ng-click="showModalPlace(&apos;departure&apos;)"><span class="input-wrap input-wrap-with-icon vanilla"><input class="{{class}}" disabled="disabled" id="{{id}}" name="{{name}}" ng-model="googlePlacesAutocompleteSelectedDescription" readonly="readonly" required type="text"> <i class="icon-search-slim"></i> <span class="ng-hide validation" ng-show="form.$submitted &amp;&amp; form.{{name}}.$error.required" translate>coreUi.error.mandatory</span></span></div></div>')}]),window.analyticsModule=angular.module("AnalyticsModule",["ionic","CoreModule"]),window.analyticsModule.config(function(){}),window.analyticsModule.run(["$log",function(e){e=e.getInstance("Analytics"),e.info("Module started")}]),analyticsModule.service("AnalyticsService",["$exceptionHandler","$q","$log","$injector","DataManagerService","$timeout","$rootScope","AppLifeCycleService",function(e,t,n,i,a,r,o,s){n=n.getInstance("AnalyticsService"),n.info("Service Started...");var l={providers:[],options:{sendTime:!1,registerOnException:!1,pauseResumeEvent:!1},user:null,defaultParameters:[],pauseDuration:0,APPLICATION_PAUSE_DATE_KEY:"ANALYTICS_APPLICATION_PAUSE",FIRST_NAME:"First name",LAST_NAME:"Last name",USER_ID:"Referrer user ID",EMAIL:"Referrer user ID",FULL_NAME:"Full name",init:function(t){l.options=angular.extend(l.options,t),safeAccess(l.options,"registerOnException",!1)&&analyticsModule.factory("$exceptionHandler",function(){return function(t,n){l.runSafe(function(){this.sendException(t)}),e(t,n)}}),o.$on("userLoggedEvent",function(e,t){l.user=t}),o.$on("userLoggedOutEvent",function(){l.user=null}),l.options.pauseResumeEvent&&l.registerEvents()},getPropertiesFactory:function(e){return e=isDefined(e)?e:"",{_data_:[],_current_:{sensitive:!1},build:function(){return this._data_},flagMarketing:function(){return this._current_.isMarketing=!0,this},flagCLV:function(){return this._current_.isCLV=!0,this},flagSensitive:function(){return this._current_.sensitive=!0,this},setDimension:function(e){return this._current_.dimension=e,this},setMetric:function(e){return this._current_.metric=e,this},create:function(t,n){return this._current_=angular.merge({name:e+t,value:n},this._current_),this},push:function(){return this._data_.push(angular.copy(this._current_)),this._current_={sensitive:!1},this}}},runSafe:function(e){r(function(){try{e.apply(l)}catch(t){n.error(t.message,t)}},0)},setDefaultParameters:function(e){e.map(function(e){l.setDefaultParameter(e)})},setDefaultParameter:function(e){l.defaultParameters[e.name]=e},extendDefaultParameterWith:function(){var e=[];for(var t in l.defaultParameters)e.push(l.defaultParameters[t]);for(var n=0;n<arguments.length;n++)if(isDefined(arguments[n])){var i=angular.isArray(arguments[n])?arguments[n]:[arguments[n]];e=e.concat(i)}return function(t){
return e.filter(function(e){return t.isTrusted?!0:!e.sensitive})}},registerEvents:function(){s.onAppPause(function(){var e=+moment();n.info("storing application pause date ["+e+"] in localstorage"),a.set(e,l.APPLICATION_PAUSE_DATE_KEY,{storage:a.LOCALSTORAGE}),l.sendEvent("paused")}),s.onAppResume(function(){var e=a.get(l.APPLICATION_PAUSE_DATE_KEY,a.LOCALSTORAGE);isDefined(e)&&(l.pauseDuration=+moment()-e),l.sendEvent("resumed")})},register:function(e){return l.providers.push(e),this},getUserId:function(e){return isDefined(l.user)&&e?l.user.userId:"Anonymous"},_callAllProviders:function(e,t){l.providers.forEach(function(i){try{var a=[].slice.call(t);a=a.map(function(e){return angular.isFunction(e)?e(i):e}),a.push(l.getUserId(i.isTrusted)),i[e]?i[e].apply(i,a):n.warn(i+" is not implementing "+e)}catch(r){n.error(e+" fails calling on "+i,r)}})},setProperty:function(e,t,n){return l._callAllProviders("setProperty",[function(i){return i.isTrusted||!n?{name:e,value:t,sensitive:n}:{}}]),this},sendEvent:function(e,t,n){return l._callAllProviders("sendEvent",arguments),this},sendException:function(e){return l._callAllProviders("sendException",arguments),this},sendTime:function(e,t){return l._callAllProviders("sendTime",arguments),this},screenView:function(e,t,n){return this.runSafe(function(){var i;isUndefined(n)&&(n="Screen View"),i=[e,l.extendDefaultParameterWith(t),n],l._callAllProviders("screenView",i)}),this},promise:function(){return t.when(!0)},toString:function(){return"AnalyticsService"}};return l}]),analyticsModule.service("GoogleWebAnalyticsService",["$log","AnalyticsService","GAService",function(e,t,n){e=e.getInstance("GoogleWebAnalyticsService"),e.info("Service Started...");var i={SITE_CODE_DIMENSION:6,isTrusted:!1,init:function(){var e=getContext("featureConfig.analytics.googleAPIKeyWeb",getContext("featureConfig.analytics.google.APIKey"));!getContext("isMobileApp",!1)&&window.ga&&isDefined(e)&&(window.ga("create",{trackingId:e,cookieDomain:"auto"}),i.setContext(),t.register(i))},setProperty:function(e,t){if(isDefined(e)){e=angular.isArray(e)?e:[e];for(var n=0;n<e.length;n++)isDefined(e[n])&&window.ga("send",{hitType:"event",eventCategory:"User Property",eventAction:e[n].name,eventLabel:e[n].value})}},setContext:function(){window.ga("set","dimension"+i.SITE_CODE_DIMENSION,getContext("SITECODE","-")),window.ga("set","appVersion",getContext("versions.app")),window.ga("set","appName",getContext("appName"))},screenView:function(e,t,a){var r,o={};isDefined(t)&&(o=n.prepareParameters(t),r=i.getDimensionAndMetric(o)),window.ga("send","pageview",e,r)},sendEvent:function(e,t,a,r){var o,s={};isDefined(t)&&(s=n.prepareParameters(t),o=i.getDimensionAndMetric(s)),isDefined(o)?window.ga("send","event",a,e,o):window.ga("send","event",a,e,s.label,isFinite(s.value)?s.value:void 0)},getDimensionAndMetric:function(e){var t={},n=!1;return e.metrics.forEach(function(e){e.metric&&isFinite(e.value)&&(t["metric"+e.metric]=e.value,n=!0)}),e.dimensions.forEach(function(e){e.dimension&&(t["dimension"+e.dimension]=""+e.value,n=!0)}),n?t:null},sendException:function(e,t){window.ga("send","exception",{exDescription:e.message,exFatal:safeAccess(e,"isFatal",!0)})},sendTime:function(e,t,n){window.ga("send",{hitType:"timing",timingCategory:t,timingVar:"",timingValue:e})},toString:function(){return"GoogleWebAnalyticsService"}};return i}]),window.analyticsModule.service("GAService",["$log",function(e){e=e.getInstance("GAService"),e.info("Service Started...");var t={prepareParameters:function(e){var n={label:null,value:null,dimensions:[],metrics:[]};return e.filter(isDefined).filter(function(e){return t.updateDimension(e),t.updateMetric(e),isDefined(e.dimension)?(n.dimensions.push(e),!1):isDefined(e.metric)?(n.metrics.push(e),!1):!0}).forEach(function(e){t.isLabelParameterAllowed(e)&&(n.label=e.value),t.isValueParameterAllowed(e)&&(n.value=e.value)}),n},isLabelParameterAllowed:function(e){return getContext("featureConfig.analytics.google.allowedParametersLabel",[]).indexOf(e.name)>-1},isValueParameterAllowed:function(e){return getContext("featureConfig.analytics.google.allowedParametersValue",[]).indexOf(e.name)>-1},updateDimension:function(e){var t;switch(e.name){case"Online Status":t=1;break;case"Trips count":t=7;break;case"Past trips count":t=8;break;case"Future and ongoing trips count":t=9;break;case"Closest trip time left minutes":t=10;break;case"AirHelp - Flight status":t=11}e.dimension=t},updateMetric:function(e){var t;switch(e.name){case"Trip - Days until start":t=5;break;case"Segment - Hours until start":t=6;break;case"AirHelp - Compensation":t=7}e.metric=t},toString:function(){return"GAService"}};return t}]),analyticsModule.service("NavigationAnalyticsService",["AnalyticsService","$log",function(e,t){t=t.getInstance("NavigationAnalyticsService"),t.info("Service Started...");var n={CATEGORY:"Navigation",PAST_TRIP_LOADED:"Load past trips button tapped",TRIP_ACTION_SHEET_OPEN:"Opened trip action sheet",tripActionSheetOpen:function(){e.runSafe(function(){this.sendEvent(n.TRIP_ACTION_SHEET_OPEN,e.extendDefaultParameterWith(),n.CATEGORY)})},pastTripLoaded:function(){e.runSafe(function(){this.sendEvent(n.PAST_TRIP_LOADED,e.extendDefaultParameterWith(),n.CATEGORY)})},toString:function(){return"NavigationAnalyticsService"}};return n}]),analyticsModule.service("NativeBridgeAnalyticsService",["$log","AnalyticsService","PostMessageService",function(e,t,n){e=e.getInstance("NativeBridgeAnalyticsService"),e.info("Service Started...");var i={isTrusted:!1,init:function(){t.register(i)},_send:function(e){n.send({type:"analytics",payload:e})},setProperty:function(e,t){i._send({event:"property",properties:e})},screenView:function(e,t,n){i._send({event:"screenView",name:e,parameters:t})},sendEvent:function(e,t,n,a){i._send({event:"behavior",name:e,parameters:t,category:n})},sendException:function(e,t){i._send({event:"exception",value:e})},sendTime:function(e,t,n){i._send({event:"time",value:e})},toString:function(){return"NativeBridgeAnalyticsService"}};return i}]),analyticsModule.service("IframeBridgeAnalyticsService",["$log","AnalyticsService","PostMessageService",function(e,t,n){e=e.getInstance("IframeBridgeAnalyticsService"),e.info("Service Started...");var i={CATEGORY:"Monetization",init:function(){n.when("analytics").then(i._propagate)},_propagate:function(n){var a=n.event;switch(a){case"behavior":t.runSafe(function(){this.sendEvent(n.name,i._buildParameters(n.parameters),n.category||i.CATEGORY)});break;case"screenView":t.runSafe(function(){this.screenView(n.name,isDefined(n.parameters)?i._buildParameters(n.parameters):[])});break;default:e.warn(a+" not implemented yet")}},_buildParameters:function(e){var n=t.getPropertiesFactory("External - ");return Object.keys(e).forEach(function(t){n.create(t,e[t]).flagMarketing().push()}),n.build()},toString:function(){return"IframeBridgeAnalyticsService"}};return i}]),analyticsModule.service("FeedbackAnalyticsService",["AnalyticsService","$log",function(e,t){t=t.getInstance("FeedbackAnalyticsService"),t.info("Service Started...");var n={CATEGORY:"Feedback",rateAppDisplayed:function(){e.runSafe(function(){this.sendEvent("Rate app",e.extendDefaultParameterWith(),n.CATEGORY)})},storeDisplayed:function(){e.runSafe(function(){this.sendEvent("Store prompt displayed",e.extendDefaultParameterWith(),n.CATEGORY)})},onboardingSummary:function(t,i,a){e.runSafe(function(){var r=e.getPropertiesFactory();r.create("Duration Viewed (seconds)",t).flagMarketing().push().create("Screens Viewed",i).flagMarketing().push().create("Completed",a?"Yes":"No").flagMarketing().push(),this.sendEvent("Onboarding Summary",r.build(),n.CATEGORY)})},advertisementPresented:function(t,i){e.runSafe(function(){var a=e.getPropertiesFactory();a.create("Ad Provider",t).flagMarketing().push().create("Ad Type",i).flagMarketing().push(),this.sendEvent("Advertisement Presented",a.build(),n.CATEGORY)})},languageSelected:function(t){e.runSafe(function(){var i=e.getPropertiesFactory();i.create("preferred language",t).flagMarketing().push(),this.sendEvent("Language selected",i.build(),n.CATEGORY)})},smartBannerClosed:function(){e.runSafe(function(){this.sendEvent("Smart banner closed",e.extendDefaultParameterWith(),n.CATEGORY)})},smartBannerViewed:function(){e.runSafe(function(){this.sendEvent("Smart banner viewed",e.extendDefaultParameterWith(),n.CATEGORY)})},toString:function(){return"FeedbackAnalyticsService"}};return n}]),window.analyticsModule.service("LocalyticsService",["$log",function(e){e=e.getInstance("LocalyticsService"),e.info("Service Started...");var t={prepareParameters:function(e){var n={data:{},dimensions:[],customerLifetimeValue:void 0};return isDefined(e)?(e.filter(function(e){return isDefined(e)}).filter(function(e){return e.isCLV&&(n.customerLifetimeValue=e.value),!e.isCLV}).filter(function(e){return t.updateDimension(e),isDefined(e.dimension)?(n.dimensions.push(e),!1):!0}).map(function(e){return n.data[e.name]=e.value,e}),n):void 0},updateDimension:function(e){var t;switch(e.name){case"Logged in channel":t=1;break;case"Total trips":t=2;break;case"Future and ongoing trips count":t=3;break;case"Past trips":t=4;break;case"Email provider":t=5}e.dimension=t},toString:function(){return"LocalyticsService"}};return t}]),window.analyticsModule.service("LocalyticsWebAnalyticsService",["$log","AnalyticsService","LocalyticsService",function(e,t,n){e=e.getInstance("LocalyticsWebAnalyticsService"),e.info("Service Started...");var i={isTrusted:!0,scope:"app",init:function(){var e=getContext("featureConfig.analytics.localytics.APIKey");isFeatureEnabled("analytics.localytics")&&isDefined(window.ll)&&isDefined(e)&&(t.register(i),window.ll("init",e,{}))},setProperty:function(e,a){window.ll("setCustomerId",a),e.name===t.FIRST_NAME?window.ll("setCustomerFirstName",e.value):e.name===t.LAST_NAME?window.ll("setCustomerLastName",e.value):e.name===t.EMAIL?window.ll("setCustomerEmail",e.value):e.name===t.FULL_NAME?window.ll("setCustomerFullName",e.value):isDefined(e.value)?window.ll("setProfileAttribute",e.name,e.value,i.scope):window.ll("deleteProfileAttribute",e.name,i.scope),n.updateDimension(e),isDefined(e.dimension)&&window.ll("setCustomDimension",e.dimension,e.value)},sendEvent:function(e,t,i,a){var r=n.prepareParameters(t);r.dimensions.map(function(e){window.ll("setCustomDimension",e.dimension,e.value)}),window.ll("tagEvent",e,r.data,isDefined(r.customerLifetimeValue)?r.customerLifetimeValue:0)},screenView:function(e,t,n){window.ll("tagScreen",e),i.sendEvent("View "+e,t)},toString:function(){return"LocalyticsWebAnalyticsService"}};return i}]),window.analyticsModule.service("TagManagerService",["$log","AnalyticsService","$ionicPlatform",function(e,t,n){e=e.getInstance("TagManagerService"),e.info("Service Started...");var i={isTrusted:!0,_customEvent:[],mapping:{"Trip details":"View Trip"},init:function(){isFeatureEnabled("analytics.tagManager")&&(window.tmpack={trigCustomEvent:function(){i._customEvent.push(arguments)}},n.ready(function(){var e=getContext("featureConfig.analytics.tagManager.id"),t=document.createElement("script");if(isFeatureEnabled("cookiesConsent")){var n=getContext("featureConfig.cookiesConsent.targetingAds_groupId",4);t.type="text/plain",t.setAttribute("class","optanon-category-"+n)}else t.type="text/javascript";t.async=1,t.onload=i._loaded,t.src="//"+getContext("featureConfig.analytics.tagManager.server")+"/"+e+"/"+getContext("featureConfig.analytics.tagManager.script");var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a.nextSibling)}),t.register(i))},_loaded:function(){i._customEvent.forEach(function(e){window.tmpack.trigCustomEvent.apply(window.tmpack,e)}),i._customEvent=[]},_prepareParameter:function(e){return e.map(function(e){return{name:e.name,value:e.value}})},sendEvent:function(e,t,n,a){"Trip"!==n&&"Screen View"!==n||window.tmpack.trigCustomEvent(e.replace(" ","_"),i._prepareParameter(t),!1,!0)},screenView:function(e,t,n){i.sendEvent(i.mapping[e]?i.mapping[e]:e,i._prepareParameter(t),n)},toString:function(){return"TagManagerService"}};return i}]),window.accountModule=angular.module("AccountModule",["ionic","CoreModule","CoreUiModule","AnalyticsModule"]),window.accountModule.run(["$log","$rootScope","AccountOrchestratorService","AuthenticationService","LoginWithEmailService",function(e,t,n,i,a){e=e.getInstance("Account"),e.info("Module started"),setContext("applicationConfig.forgotPasswordKey","forgot_password_email"),n.noop(),i.init(),a.noop()}]),window.accountModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("account")}]);var profileMenuEnabledConfig="featureConfig.mainFeatures.isProfileMenuEnabled",helpMenuEnabledConfig="featureConfig.mainFeatures.isHelpMenuEnabled";window.accountModule.routes={login:{url:"/login",templateUrl:"account/templates/pages/LoginView.html",controller:"AuthenticationController",secured:!1,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Login with email").promise()}]},ncyBreadcrumb:{label:"{{'account.login.title.login'|translate}}"}},register:{url:"/register",templateUrl:"account/templates/pages/RegistrationView.html",controller:"RegistrationController",defaultBackState:"login",secured:!1,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Create account").promise()}]},ncyBreadcrumb:{label:"{{'account.registration.title.createAccount'|translate}}",parent:"login"}},forgotpassword:{url:"/forgotpassword",templateUrl:"account/templates/pages/ForgotPasswordView.html",controller:"ForgotPasswordController",defaultBackState:"login",secured:!1,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Forgot password").promise()}]},ncyBreadcrumb:{label:"{{'account.forgotPassword.title.forgotPassword'|translate}}",parent:"login"}},"forgotpassword-activation":{url:"/forgotpassword-activation?userId&activationKey",templateUrl:"account/templates/pages/ForgotPasswordActivationView.html",controller:"SharedActivationController",resolve:{ACTIVATION_SERVICE_NAME:function(){return"ForgotPasswordActivationService"},analytics:["AnalyticsService",function(e){return e.screenView("Forgot password activation").promise()}]}},activation:{url:"/activation?userId&activationKey",templateUrl:"account/templates/pages/AccountActivationView.html",controller:"SharedActivationController",secured:!1,forceLogout:!0,resolve:{ACTIVATION_SERVICE_NAME:function(){return"AccountActivationService"},analytics:["AnalyticsService",function(e){return e.screenView("Account activation").promise()}]}},settings:{url:"/settings",templateUrl:"account/templates/pages/SettingsView.html",controller:"SettingsController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Settings").promise()}]},ncyBreadcrumb:{label:"{{'account.settings.title.view'|translate}}"}},help:{url:"/help",templateUrl:"account/templates/pages/HelpView.html",controller:"SettingsController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Help").promise()}]},ncyBreadcrumb:{label:"{{'account.settings.label.helpmenuitem'|translate}}"}},profile:{url:"/profile",templateUrl:"account/templates/pages/ProfileMenuView.html",controller:"SettingsController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Profile").promise()}]},ncyBreadcrumb:{label:"{{'account.settings.label.profilemenuitem'|translate}}"}},"notifications-settings":{url:"/notifications-settings",templateUrl:"account/templates/pages/NotificationsSettingsView.html",controller:"ProfileSettingsController",defaultBackState:getContext(profileMenuEnabledConfig,!1)?"profile":"settings",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Notification settings").promise()}]},ncyBreadcrumb:{label:"{{'account.notificationsSettings.title.notifications'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(profileMenuEnabledConfig,!1)?"profile":"settings":null}]}},"edit-profile":{url:"/edit-profile",templateUrl:"account/templates/pages/ProfileView.html",controller:"ProfileSettingsController",defaultBackState:getContext(profileMenuEnabledConfig,!1)?"profile":"settings",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Edit profile").promise()}]},ncyBreadcrumb:{label:"{{'account.editProfile.title.editProfile'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(profileMenuEnabledConfig,!1)?"profile":"settings":null}]}},address:{url:"/address",templateUrl:"account/templates/pages/AddressView.html",controller:"ProfileSettingsController",defaultBackState:getContext(profileMenuEnabledConfig,!1)?"profile":"settings",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Address").promise()}]},ncyBreadcrumb:{label:"{{'account.address.label.address'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(profileMenuEnabledConfig,!1)?"profile":"settings":null}]}},termsandconditions:{url:"/termsandconditions",templateUrl:"account/templates/pages/SharedContentInIframeView.html",controller:"SharedContentInIframeController",resolve:{IFRAME_PARAMS:function(){return{controllerName:"TermsAndConditionsController",serverUrl:"termsandcondition",labelSlow:"tandcnotslow",labelNotFound:"tandcnotfound",labelHeader:"account.registration.title.termsAndConditions"}},analytics:["AnalyticsService",function(e){return e.screenView("Terms and conditions").promise()}]},defaultBackState:getContext(helpMenuEnabledConfig,!1)?"help":"settings",ncyBreadcrumb:{label:"{{'account.settings.label.termsandcondition'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(helpMenuEnabledConfig,!1)?"help":"settings":getContext(helpMenuEnabledConfig,!1)?"guest-help":null}]}},privacypolicy:{url:"/privacypolicy",templateUrl:"account/templates/pages/SharedContentInIframeView.html",controller:"SharedContentInIframeController",resolve:{IFRAME_PARAMS:function(){return{controllerName:"PrivacyPolicyController",serverUrl:"privacypolicy",labelSlow:"privacypolicyslow",labelNotFound:"privacypolicynotfound",labelHeader:"account.settings.label.privacypolicy"}},analytics:["AnalyticsService",function(e){return e.screenView("Privacy policy").promise()}]},defaultBackState:getContext(helpMenuEnabledConfig,!1)?"help":"settings",ncyBreadcrumb:{label:"{{'account.settings.label.privacypolicy'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(helpMenuEnabledConfig,!1)?"help":"settings":getContext(helpMenuEnabledConfig,!1)?"guest-help":null}]}},cookiepolicy:{url:"/cookiepolicy",templateUrl:"account/templates/pages/SharedContentInIframeView.html",controller:"SharedContentInIframeController",resolve:{IFRAME_PARAMS:function(){return{controllerName:"CookiePolicyController",serverUrl:"cookiepolicy",labelSlow:"cookiepolicyslow",labelNotFound:"cookiepolicynotfound",labelHeader:"account.settings.label.cookiepolicy"}},analytics:["AnalyticsService",function(e){return e.screenView("Cookie Policy").promise()}]},defaultBackState:getContext(helpMenuEnabledConfig,!1)?"help":"settings",ncyBreadcrumb:{label:"{{'account.settings.label.cookiepolicy'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(helpMenuEnabledConfig,!1)?"help":"settings":getContext(helpMenuEnabledConfig,!1)?"guest-help":null}]}},cookiepolicyWeb:{url:"/webcookiepolicy",templateUrl:"account/templates/pages/SharedContentInIframeView.html",controller:"SharedContentInIframeController",resolve:{IFRAME_PARAMS:function(){return{controllerName:"CookiePolicyController",serverUrl:"cookiepolicy",labelSlow:"cookiepolicyslow",labelNotFound:"cookiepolicynotfound",labelHeader:"account.settings.label.cookiepolicy"}},analytics:["AnalyticsService",function(e){return e.screenView("Cookie Policy Web").promise()}]},defaultBackState:getContext(helpMenuEnabledConfig,!1)?"help":"settings",ncyBreadcrumb:{label:"{{'account.settings.label.cookiepolicy'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(helpMenuEnabledConfig,!1)?"help":"settings":getContext(helpMenuEnabledConfig,!1)?"guest-help":null}]}}},window.accountModule.value("IFRAME_PARAMS",{controllerName:"TermsAndConditionsController",serverUrl:"termsandcondition",labelSlow:"tandcnotslow",labelNotFound:"tandcnotfound",labelHeader:"account.registration.title.termsAndConditions"}),accountModule.service("AuthenticationService",["DataManagerService","$log","RequestService","$rootScope","$q","I18nService","$ionicHistory","PromiseService","OrchestratorChiefService","LayoutService","$injector","AccountAnalyticsService","$window",function(e,t,n,i,a,r,o,s,l,c,d,u,g){t=t.getInstance("AuthenticationService"),t.info("Service Started...");var p=!1,m={_prefillData:{firstName:"",lastName:"",email:"",phoneNumber:"",phoneCode:"",password:""},_autoMarketKey:null,events:{userLoggedEvent:"userLoggedEvent",userLoggedOutEvent:"userLoggedOutEvent",pushTokenUpdateInProfileSuccessEvent:"pushTokenUpdateInProfileSuccessEvent",pushTokenUpdateInProfileFailureEvent:"pushTokenUpdateInProfileFailureEvent"},NO_USER_ID:"noid",USER_STORAGE_KEY:"User",USER_PASSWORD_STORAGE_KEY:"UserPassword",AUTH_METHOD_STORAGE_KEY:"UserAuthMethod",ACCESS_TOKEN_STORAGE_KEY:"AccessToken",MULTIMARKET_CONTACT_DATA_STORAGE_KEY:"MultiMarketContactData",LOGOUT_URL_PATH:"v1/account/logout",REGISTER_DEVICE_NOTIFICATION_TOKEN_URL_PATH:"v1/account/registerDevice",EMAIL_METHOD:"email",CORPORATE_METHOD:"corporate",ERR_NO_INTERNET_CONNECTIVITY:"No internet connectivity",USER_NOT_LOGGED_LANDED_PAGE:"USER_NOT_LOGGED_LANDED_PAGE",init:function(){if(i.$on("userLoggedOutEvent",function(e){l.next({forceLogoutNavigation:!0,islogged:!1})}),m.retrieveToken(),isDefined(g.authenticationInformation)){var e=g.authenticationInformation.user,n=g.authenticationInformation.token;isDefined(e)&&isDefined(n)&&isDefined(e.firstName)&&isDefined(e.lastName)?(m._storeUser(e),m._storeUserAccessToken(n)):t.error("Trying to authenticate with bad formatted data",e,n);var a=g.authenticationInformation.site;isDefined(a)&&(setContext("SITECODE",a),setContext("applicationConfig.dataManagerKeyPrefix",a+":"));var r=g.authenticationInformation.octx;isDefined(a)&&setContext("OCTX",r);var o=g.authenticationInformation.googlePlacesApiKey;isDefined(o)&&setContext("featureConfig.googlePlaces.apiKey",o)}i.$on("$stateChangeStart",function(e,n,i,a,r){if(n.secured&&!m.isLogged()){var o=getContext("applicationConfig.securedPage.redirectionRoute","login");t.warn("User not logged, blocking navigation to "+n.name+" (stored in localStorage)"),t.warn('Will redirect to "'+o+'" instead'),m.setLandedPage(n,i),o.indexOf(".html")>-1?g.location.href=g.location.href.replace(/web\-\w*\.html/i,o):l.navigateTo(o)}if(n.secured===!1&&m.isLogged())if(n.forceLogout)m.__logout();else{var s=getContext("applicationConfig.securedPage.redirectionHomeRoute","");t.warn("User logged, blocking navigation to "+n.name),t.warn('Will redirect to "'+s+'" instead'),l.navigateTo(s)}}),i.$on("$stateChangeError",function(e,n,i,a,r,o){t.error("Error during state change",n,o)})},retrieveToken:function(){e.getSecureAsync(m.ACCESS_TOKEN_STORAGE_KEY).then(function(e){isDefined(e)&&m._storeUserAccessToken(e)})},isFirstUsage:function(){var t=e.get("isFirstTimeAppRun",e.LOCALSTORAGE);return e.set(!1,"isFirstTimeAppRun",{storage:e.LOCALSTORAGE}),isUndefined(t)},isLogged:function(){return isDefined(m.getUser())},getUser:function(){return e.get(m.USER_STORAGE_KEY,e.LOCALSTORAGE)},getMultiMarketContactData:function(){return e.get(m.MULTIMARKET_CONTACT_DATA_STORAGE_KEY,e.LOCALSTORAGE)},getUserId:function(){var e=m.getUser();return isDefined(e)?e.userId:m.NO_USER_ID},getUserPassword:function(){return e.getSecureAsync(m.USER_PASSWORD_STORAGE_KEY)},getUserAccessToken:function(){var t=isDefined(window.cordova)?e.MEMORY:e.LOCALSTORAGE;return e.get(m.ACCESS_TOKEN_STORAGE_KEY,t)},getUserAuthMethod:function(){return e.get(m.AUTH_METHOD_STORAGE_KEY,e.LOCALSTORAGE)},_storeUser:function(t){e.set(t,m.USER_STORAGE_KEY,{storage:e.LOCALSTORAGE,ttl:e.INFINITE,belongsToUser:!0})},_storeUserPassword:function(t){return e.setSecureAsync(t,m.USER_PASSWORD_STORAGE_KEY)},_storeUserAccessToken:function(t){var n=isDefined(window.cordova)?e.MEMORY:e.LOCALSTORAGE;e.set(t,m.ACCESS_TOKEN_STORAGE_KEY,{storage:n,ttl:e.INFINITE,belongsToUser:!0}),isDefined(window.cordova)&&e.setSecureAsync(t,m.ACCESS_TOKEN_STORAGE_KEY)},_storeUserAuthMethod:function(t){e.set(t,m.AUTH_METHOD_STORAGE_KEY,{storage:e.LOCALSTORAGE,ttl:e.INFINITE,belongsToUser:!0})},_storeMultiMarketContactData:function(t){e.set(t,m.MULTIMARKET_CONTACT_DATA_STORAGE_KEY,{storage:e.LOCALSTORAGE,ttl:e.INFINITE,belongsToUser:!0})},setLandedPage:function(t,n){e.set({state:t,params:n},m.USER_NOT_LOGGED_LANDED_PAGE,{storage:e.LOCALSTORAGE,ttl:"1h",belongsToUser:!0})},getAndRemoveLandedPage:function(){var t=e.get(m.USER_NOT_LOGGED_LANDED_PAGE,e.LOCALSTORAGE);return e.remove(m.USER_NOT_LOGGED_LANDED_PAGE,e.LOCALSTORAGE),t},getLandedPage:function(){return e.get(m.USER_NOT_LOGGED_LANDED_PAGE,e.LOCALSTORAGE)},hasLandedPage:function(){return isDefined(m.getLandedPage())},updatePushNotificationTokenInUserProfile:function(){if(!m.isLogged())return t.warn("Not logged; unable to update the push token in the profile"),void i.$emit(m.events.pushTokenUpdateInProfileFailureEvent);var e=m.augmentLoginLogoutPayloadWithDeviceInfo({});return isDefined(safeAccess(e,"device.token"))?(t.info("Sending push token to backend to update in profile"),void n.post(m.REGISTER_DEVICE_NOTIFICATION_TOKEN_URL_PATH,e).then(function(e){var t=safeAccess(e,"data.success");t?i.$emit(m.events.pushTokenUpdateInProfileSuccessEvent):(s.rejectDueToBackendError({response:e,method:"updatePushNotificationTokenInUserProfile"}),i.$emit(m.events.pushTokenUpdateInProfileFailureEvent))},function(e){s.getDefaultFailHandler("updatePushNotificationTokenInUserProfile")(e),i.$emit(m.events.pushTokenUpdateInProfileFailureEvent)})["catch"](handleUnexpectedError)):(t.warn("Push token not available; unable to update the push token in the profile"),void i.$emit(m.events.pushTokenUpdateInProfileFailureEvent))},augmentLoginLogoutPayloadWithDeviceInfo:function(e){e=e||{};var n;if(getContext("isMobileApp",!1)&&(n=d.get("PushNotificationService").getNotificationToken()),isDefined(n)){t.info("adding push token to payload");var i="";ionic.Platform.isIOS()?i="iOS":ionic.Platform.isAndroid()&&(i="Android"),e.device={system:i,token:n}}else t.info("push token not available");return e},loginSuccessCallback:function(e,n,i){var a=e.data;if(isDefined(a))if(a.success&&isDefined(a.user))m.afterLoginSuccessSharedCallback(a,n,a.accessToken),i.resolve(a);else{t.backendError(a);var o=safeAccess(e,"data.errorCodes");r.translateBackendErrorCodes(o).then(function(e){i.reject(e)})}else i.reject("No data received");return i.promise},afterLoginSuccessSharedCallback:function(e,t,n){if(e.overriddenContextParameters){var a=e.overriddenContextParameters;m._storeMultiMarketContactData(a)}var r=angular.copy(e.user);delete r.triplist,m._storeUser(r);var o=t.password;getContext("isMobileApp")&&m._storeUserPassword(o);var s="",l=safeAccess(t,"network.type");s=isDefined(l)?getContext("featureConfig.corporate.enabled",!1)?m.CORPORATE_METHOD:l.toLowerCase():m.EMAIL_METHOD,m._storeUserAuthMethod(s),s===m.EMAIL_METHOD&&m.registerEventsForEmailMethod(),s===m.CORPORATE_METHOD&&getContext("isMobileApp",!1)&&m.registerEventsForCorporateMethod(),m._storeUserAccessToken(n),u.loggedIn(s,r),i.$emit(m.events.userLoggedEvent,e.user)},loginFailureCallback:function(e,n,i){return t.httpError(e),isDefined(e)?r.translateHttpStatusCode(e.status).then(function(e){i.reject(e)}):r.translateHttpStatusCode("0").then(function(e){i.reject(e)}),i.promise},logout:function(e){e=e||{doMiddlewareCall:!0};var t=a.defer();if(e.doMiddlewareCall){var i=m.augmentLoginLogoutPayloadWithDeviceInfo({}),r=n.post(m.LOGOUT_URL_PATH,i);r["finally"](function(){m.__frontendLogout(t)})}else m.__frontendLogout(t);return t.promise},__frontendLogout:function(e){m.__logout(),i.$emit(m.events.userLoggedOutEvent),e.resolve()},__logout:function(){t.info("logout.finally: cleaning user data"),m.userLogOutEventDeregistrationHandler&&(m.userLogOutEventDeregistrationHandler(),delete m.userLogOutEventDeregistrationHandler),e.clearUserData(),t.info("Cleaning ionic history"),o.clearHistory(),u.loggedOut()},setAutoMarketSelectionData:function(e,t,n){getContext("featureConfig.multiMarket.autoMarketSelection",!1)&&(isDefined(e)&&""!==e&&isDefined(t)&&""!==t&&isDefined(n)&&""!==n?m._autoMarketKey={userId:e,marketId:t,officeId:n}:m._autoMarketKey=null)},getAutoMarketSelectionData:function(){return m._autoMarketKey},setEncryptedPayload:function(e,t,n){isDefined(e)||isDefined(t)||isDefined(n)?m._encryptedPayload={email:isDefined(e)?e:"",firstName:isDefined(t)?t:"",lastName:isDefined(n)?n:""}:m._encryptedPayload=null},getEncryptedPayload:function(){return m._encryptedPayload},setPrefillData:function(e,t,n,i,a){m._prefillData={firstName:isDefined(t)?t:"",lastName:isDefined(n)?n:"",email:isDefined(e)?e:"",phoneNumber:isDefined(i)?i:"",phoneCode:isDefined(a)?a:"",password:""}},getPrefillData:function(){return m._prefillData},registerEventsForEmailMethod:function(){m.userLogOutEventDeregistrationHandler&&(t.warn("userLogOutEventDeregistrationHandler is still alive !!!"),m.userLogOutEventDeregistrationHandler()),m.userLogOutEventDeregistrationHandler=i.$on("userLogOutEvent",function(){m.logout()})},registerEventsForCorporateMethod:function(){m.userLogOutEventDeregistrationHandler&&(t.warn("userLogOutEventDeregistrationHandler is still alive !!!"),m.userLogOutEventDeregistrationHandler()),m.userLogOutEventDeregistrationHandler=i.$on("userLogOutEvent",function(){m.logout()})},toString:function(){return"AuthenticationService"}};return i.$on("userLoggedEvent",function(){m.updatePushNotificationTokenInUserProfile()}),i.$on("auth:needToLogOutTheUserEvent",function(){t.info("Doing front-end logout"),m.logout({doMiddlewareCall:!1}).then(function(){return p?(t.info("There is already an auth error popup displayed, not displaying a second one!"),a.when()):(t.info("Displaying auth error popup"),p=!0,r.translate("account.silentLogin.error.authFailure").then(function(e){return c.toastError(e)}))})["finally"](function(){c.loading(!1),p=!1})}),m}]),accountModule.service("LoginWithEmailService",["$log","RequestService","$q","I18nService","AuthenticationService","$rootScope",function(e,t,n,i,a,r){e=e.getInstance("LoginWithEmailService"),e.info("Service Started...");var o={LOGIN_WITH_EMAIL_URL_PATH:"v1/account/loginWithEmail",noop:function(){},login:function(i,r,s){e.profile("emaillogin"),definedOrThrow([i,r],"You must pass a login and a password");var l=a.augmentLoginLogoutPayloadWithDeviceInfo({userId:i,password:r,triplistTimeWindow:"Future"}),c=a.getAutoMarketSelectionData();isDefined(c)&&(l.marketId=safeAccess(c,"marketId",void 0),l.officeId=safeAccess(c,"officeId",void 0)),getContext("isMobileApp",!1)&&getContext("featureConfig.cytric.enabled",!1)&&(ionic.Platform.isIOS()?l.clientPlatform="iPhone":l.clientPlatform="Android");var d=n.defer(),u=t.post(o.LOGIN_WITH_EMAIL_URL_PATH,l,s);return u.then(function(t){e.profile("emaillogin"),a.loginSuccessCallback(t,l,d)},function(t){e.profile("emaillogin"),a.loginFailureCallback(t,l,d)}),d.promise},logout:function(){var e=a.logout();return e},toString:function(){return"LoginWithEmailService"}};return a.getUserAuthMethod()===a.EMAIL_METHOD&&a.registerEventsForEmailMethod(),o}]),accountModule.service("RegistrationService",["DataManagerService","$log","RequestService","$q","I18nService","I18nConfig","AccountAnalyticsService",function(e,t,n,i,a,r,o){t=t.getInstance("RegistrationService"),t.info("Service Started...");var s={REGISTER_URL_PATH:"v1/account/register",register:function(e){var a={};angular.extend(a,e),definedOrThrow(a,"You must at least pass email, firstName, lastName, phoneCode, phoneNumber, password");
try{parseInt(a.phoneCode,10),parseInt(a.phoneNumber,10)}catch(o){t.throwException("The phone format should be only digit")}var l={userId:a.email,firstName:a.firstName,lastName:a.lastName,password:a.password,preferredLanguage:r.getCurrentAmadeusLanguage()};getContext("featureConfig.registration.displayPhoneNumberInput",!1)&&(l.mobileCountryCode=a.phoneCode,l.mobilePhoneNumber=a.phoneNumber),getContext("featureConfig.multiMarket.isEnabled",!1)&&a.marketInformation&&(l.marketInformation=a.marketInformation,l.officeId=a.officeId);var c=i.defer();return n.post(s.REGISTER_URL_PATH,l).then(function(e){s._registerSuccessCallback(e,c)},function(e){s._registerFailureCallback(e,c)}),c.promise},_registerSuccessCallback:function(e,n){var i=e.data;if(isDefined(i))if(i.success)o.accountCreatedWithEmail(),n.resolve(i);else{t.backendError(i);var r=safeAccess(e,"data.errorCodes");a.translateBackendErrorCodes(r).then(function(e){n.reject(e)})}else n.reject("No data received")},_registerFailureCallback:function(e,n){t.httpError(e),a.translateHttpStatusCode(e.status).then(function(e){n.reject(e)})},toString:function(){return"RegistrationService"}};return s}]),accountModule.service("ShareService",["$q","$log",function(e,t){return t=t.getInstance("ShareService"),t.info("Service Started..."),{shareViaEmail:function(t){var n=e.defer();return window.open("mailto:?subject="+t.subject+"&body="+encodeURIComponent(t.message),"_self"),n.resolve(),n.promise},shareViaWhatsApp:function(t){var n=e.defer();return n.reject("Not implemented yet"),n.promise},checkAppAvailability:function(t){var n=e.defer();return n.reject("Not implemented yet"),n.promise},toString:function(){return"ShareService"}}}]),accountModule.controller("AuthenticationController",["$scope","$rootScope","LayoutService","LoginWithEmailService","$log","OrchestratorChiefService","DataManagerService","$controller","$q","AuthenticationService","EasterEggService","ProfileService","ContentService",function(e,t,n,i,a,r,o,s,l,c,d,u,g){function p(){var t=getContext("applicationConfig.angularDebugEnabled");getContext("featureConfig.page.hasCustomBackground",!1)&&e.setupBackgroundImage(),t?(e.loginInputs={email:o.get("__DEBUG_USER_EMAIL",o.LOCALSTORAGE)||"",password:o.get("__DEBUG_USER_PASSWORD",o.LOCALSTORAGE)||""},o.remove("__DEBUG_USER_EMAIL",o.LOCALSTORAGE),o.remove("__DEBUG_USER_PASSWORD",o.LOCALSTORAGE)):m()}function m(){e.loginInputs={email:safeAccess(e,"prefillData.email",""),password:""}}function f(){var t=l.defer(),n=e.$new(!0);try{s("MultiMarketLoginController",{$scope:n}),n.isMarketEmpty()?n.showMarketSelectPopUp().then(function(){t.resolve("Market changed successfully!")},function(){t.resolve("Market change failed, stick to default Market.")}):t.resolve("User already has Market!")}catch(i){a.error(i),t.resolve("MultiMarketLoginController not found, falling back to continue login flow.")}return t.promise}a=a.getInstance("AuthenticationController"),a.info("Controller Started..."),e.forms={},e.showCustomBackgroundScreen=!1,e.prefillData=c.getPrefillData(),isDefined(c.getEncryptedPayload())&&(e.allowMaskedValues=!0),e.isForgotPasswordEnabled=getContext("featureConfig.whiteLabelCustomFeatures.isForgotPasswordEnabled",!0),e.isCreateAccountEnabled=getContext("featureConfig.whiteLabelCustomFeatures.isCreateAccountEnabled",!0);var v=c.getLandedPage();e.isLoginToSeeYourTripMessageDisplayed="trip-expanded"===safeAccess(v,"state.name"),e.isInternetExplorer=isIE(),e.login=function(){if(e.forms.loginform.$valid){n.loading(!0);var t=c.getEncryptedPayload(),a=e.loginInputs.email;isDefined(t)&&(a=t.email),i.login(a,e.loginInputs.password).then(S,C)}else n.addErrors(e.forms.loginform.$error)};var h=function(){r.next({islogged:!0}),m(),e.forms.loginform.$setPristine(),c.setEncryptedPayload(),c.setPrefillData()},S=function(e){n.loading(!1),getContext("featureConfig.multiMarket.isEnabled",!1)?f().then(function(e){a.info(e),h()}):h()},C=function(t){n.loading(!1),n.toastError(t).then(function(){o.set(e.loginInputs.email,getContext("applicationConfig.forgotPasswordKey"),{storage:o.MEMORY,ttl:"1m"})})};e.handleEasterEgg=function(){d.handleEasterEgg()},e.setupBackgroundImage=function(){var t=g.getBackgroundImageUrl();u.preloadImage(t).then(function(t){e.showCustomBackgroundScreen=!!t},function(){e.showCustomBackgroundScreen=!1})},t.$on("paramsUpdates",function(t,n){e.isForgotPasswordEnabled=getContext("featureConfig.whiteLabelCustomFeatures.isForgotPasswordEnabled",!0),e.isCreateAccountEnabled=getContext("featureConfig.whiteLabelCustomFeatures.isCreateAccountEnabled",!0)}),p()}]),accountModule.controller("RegistrationController",["$scope","$rootScope","LayoutService","RegistrationService","$log","I18nService","OrchestratorChiefService","AuthenticationService","$ionicPopup","DataManagerService","$ionicModal","NetworkService","ContentService","ProfileService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p){function m(){n.loading(!0);var t={email:e.registerInputs.email,firstName:e.registerInputs.firstName,lastName:e.registerInputs.lastName,phoneCode:e.registerInputs.phoneCode.substr(1),phoneNumber:e.registerInputs.phoneNumber.replace(/[a-zA-Z ()-]/g,""),password:e.registerInputs.password};safeAccess(e,"autoMarketData.marketId",!1)&&safeAccess(e,"autoMarketData.officeId",!1)&&(t.marketInformation=e.autoMarketData.marketId,t.officeId=e.autoMarketData.officeId),e.isMultiMarket&&(t.marketInformation=safeAccess(e.registerInputs,"marketInformation.marketCode",""));var a=s.getEncryptedPayload();isDefined(a)&&(t.email=a.email,t.firstName=a.firstName,t.lastName=a.lastName);var r=i.register(t);r.then(v,h)}if(a=a.getInstance("RegistrationController"),a.info("Controller Started..."),s.isLogged()&&o.next({islogged:!0}),e.showCustomBackgroundScreen=!1,e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView(),e.createAccountButtonDisabled=!1,e.displayPhone=getContext("featureConfig.registration.displayPhoneNumberInput",!1),e.phoneNumberRequired=getContext("featureConfig.registration.phoneNumberRequired",!1),e.marketData=null,e.isMultiMarket=getContext("featureConfig.multiMarket.isEnabled",!1)&&!getContext("featureConfig.multiMarket.hideMarketSelection",!1),e.autoMarketData=s.getAutoMarketSelectionData(),e.forms={},e.registerInputs=s.getPrefillData(),isDefined(s.getEncryptedPayload())){var f=s.getEncryptedPayload();e.allowMaskedValues=!0,isDefined(f.firstName)&&""!==f.firstName&&(e.isFirstNameReadOnly=!0,e.allowMaskedFirstName=!0),isDefined(f.lastName)&&""!==f.lastName&&(e.isLastNameReadOnly=!0,e.allowMaskedLastName=!0)}e.isInternetExplorer=isIE(),e.register=function(){return e.createAccountButtonDisabled?void a.info("Multiple consecutive clicks on create account button, not doing anything this time!"):void(e.forms.registerform.$valid?(e.isOnline=u.hasConnectivity(!0).isOnline,e.isOnline&&(e.createAccountButtonDisabled=!0,e.$on("modal.hidden",function(){e.createAccountButtonDisabled=!1}),d.fromTemplateUrl("account/templates/partial/termsAndConditions.html",{scope:e,animation:"slide-in-up"}).then(function(i){e.termsAndConditionsModal=i,e.termsAndConditionsSuccess=function(){n.removeModal(e.termsAndConditionsModal).then(function(){m()})},e.termsAndConditionsFailure=function(){n.removeModal(e.termsAndConditionsModal),t.$emit("termsAndConditionsFailure")},n.showModal(e.termsAndConditionsModal),o.registerNavigateBackFromModal()}))):n.addErrors(e.forms.registerform.$error))};var v=function(){n.loading(!1),r.translate(["account.registration.label.registrationOkTitle","account.registration.label.registrationOkMessage"]).then(function(t){var n=l.alert({title:t["account.registration.label.registrationOkTitle"],template:t["account.registration.label.registrationOkMessage"]});n.then(function(t){o.next({registered:!0});var n=e.registerInputs.phoneCode;e.registerInputs={},e.registerInputs.phoneCode=n,e.forms.registerform.$setPristine(),s.setEncryptedPayload(),s.setPrefillData()})})},h=function(t){n.loading(!1),n.toastError(t).then(function(){c.set(e.registerInputs.email,getContext("applicationConfig.forgotPasswordKey"),{storage:c.MEMORY,ttl:"1m"}),t.indexOf("2116076")>-1&&o.navigateTo("forgotpassword")})},S=function(n){n&&(e.marketData=t.marketData,e.registerInputs.marketInformation={regionCode:"",marketCode:""})};S(e.isMultiMarket),e.setupBackgroundImage=function(){var t=g.getBackgroundImageUrl();p.preloadImage(t).then(function(t){e.showCustomBackgroundScreen=!!t},function(){e.showCustomBackgroundScreen=!1})},getContext("featureConfig.page.hasCustomBackground",!1)&&e.setupBackgroundImage(),t.$on("multiMarketParamsChangedEvent",function(t,n){safeAccess(n,"marketData")&&(e.marketData=n.marketData,e.$broadcast("marketDataChangedEvent",e.marketData)),e.isMultiMarket=getContext("featureConfig.multiMarket.isEnabled",!1)&&!getContext("featureConfig.multiMarket.hideMarketSelection",!1),S(e.isMultiMarket)})}]),accountModule.service("ProfileService",["$log","$q","RequestService","AuthenticationService","PromiseService","DataManagerService","$rootScope","ContentService",function(e,t,n,i,a,r,o,s){e=e.getInstance("ProfileService"),e.info("Service Started...");var l={UPDATE_PROFILE_URL_PATH:"v1/account/updateProfile",DELETE_PROFILE_URL_PATH:"v1/account/deleteProfile",GET_PROFILE_URL_PATH:"v1/account/getProfile",CHECKIN_REMINDER_ENABLED_KEY:"CHECKIN_REMINDER_ENABLED",SSR_NOTIF_ENABLED_KEY:"SSR_NOTIF_ENABLED",getProfile:function(){return i.getUser()},getProfileFromServer:function(){var e=t.defer();return n.post(l.GET_PROFILE_URL_PATH).then(function(t){l.__getProfileSuccess(e,t,"getProfileFromServer")},function(t){l.__getProfileFailure(e,t,"getProfileFromServer")}),e.promise},updateProfile:function(e){var i=l.getProfile();isDefined(e.mobileCountryCode)||isDefined(e.mobilePhoneNumber)||(e.mobileCountryCode=i.mobileCountryCode,e.mobilePhoneNumber=i.mobilePhoneNumber);var a=t.defer();return n.post(l.UPDATE_PROFILE_URL_PATH,e).then(function(e){l.__getProfileSuccess(a,e,"updateProfile")},function(e){l.__getProfileFailure(a,e,"updateProfile")}),a.promise},deleteProfile:function(){var i={},a=t.defer();return n.post(l.DELETE_PROFILE_URL_PATH,i).then(function(t){var n=safeAccess(t,"data.success");if(n)a.resolve();else{e.error("deleteProfile: rejecting promise due to backend error");var i={errorCode:safeAccess(t,"data.errorCodes[0]","000000"),errorType:"backend"};a.reject(i)}},function(t){e.error("deleteProfile: rejecting promise due to http error");var n={errorCode:t.status,errorType:"http"};a.reject(n)}),a.promise},__getProfileSuccess:function(t,n,a){var r=n.data,o=safeAccess(n,"data.success");if(o)i._storeUser(r.user),t.resolve(r.user);else{e.warn(a+": rejecting promise due to backend error");var s={errorCode:safeAccess(n,"data.errorCodes[0]","000000"),errorType:"backend"};t.reject(s)}},__getProfileFailure:function(t,n,i){e.warn(i+": rejecting promise due to http error");var a={errorCode:n.status,errorType:"http"};t.reject(a)},isCheckinReminderNotifEnabled:function(){var e=r.get(l.CHECKIN_REMINDER_ENABLED_KEY,r.LOCALSTORAGE);return isDefined(e)||(e=!0),e},setCheckinReminderNotifEnabled:function(t){"boolean"!=typeof t&&(e.error("setCheckinReminderNotifEnabled: boolean expected, received: "+t),t=!!t);var n=l.isCheckinReminderNotifEnabled();n!==t&&(r.set(t,l.CHECKIN_REMINDER_ENABLED_KEY,{storage:r.LOCALSTORAGE}),o.$emit("userProfileCheckinNotificationSettingsChangedEvent",t))},isSsrNotifEnabled:function(){var e=r.get(l.SSR_NOTIF_ENABLED_KEY,r.LOCALSTORAGE);return isDefined(e)||(e=!0),e},setSsrNotifEnabled:function(t){"boolean"!=typeof t&&(e.error("setSsrNotifEnabled: boolean expected, received: "+t),t=!!t);var n=l.isSsrNotifEnabled();n!==t&&(r.set(t,l.SSR_NOTIF_ENABLED_KEY,{storage:r.LOCALSTORAGE}),o.$emit("userProfileSsrNotificationSettingsChangedEvent",t))},preloadImage:function(e){var n=!1,i=t.defer(),a=new Image;return a.onload=function(){n=!0,i.resolve(n)},a.onerror=function(){i.reject()},a.src=e,i.promise},toString:function(){return"ProfileService"}};return l}]),accountModule.service("AccountOrchestratorService",["$state","$log","LayoutService","$ionicHistory","OrchestratorChiefService","$timeout","$q",function(e,t,n,i,a,r,o){t=t.getInstance("AccountOrchestratorService"),t.info("Service Started...");var s={noop:function(){},_navigateToSettings:function(){return a.navigateTo("settings")},navigateToLoginPage:function(){return a.navigateTo("login")},_navigateToLoginOrLanding:function(){var e=getContext("featureConfig.whiteLabelCustomFeatures.isCreateAccountEnabled",!0),n=function(){r(function(){t.info("Cleaning ionic cache"),i.clearCache()},500)};return e?(t.info("Redirecting user to landing page"),a.navigateToLandingPage()["finally"](n)):(t.info("Redirecting user to login page"),s.navigateToLoginPage()["finally"](n))},next:function(e,t){var n=o.when(e);if(e.forceLogoutNavigation)n=s._navigateToLoginOrLanding();else switch(e.page){case"":case"settings":case"more-settings":case"login":case"register":case"activation":case"forgotpassword":case"forgotpassword-activation":n=e.islogged?s._navigateToSettings():s._navigateToLoginOrLanding();break;default:n=a.check(e,t)}return n},toString:function(){return"AccountOrchestratorService"}};return a.register(s),s}]),accountModule.service("SharedActivationService",["$log","RequestService","$q","I18nService","AuthenticationService","PromiseService","AccountAnalyticsService",function(e,t,n,i,a,r,o){e=e.getInstance("SharedActivationService"),e.info("Service Started...");var s={ACTIVATE_URL_PATH:"!undefined!",activate:function(e){var i={userId:e.userId,password:e.password,activationKey:e.activationKey},a=this,r=n.defer();return t.post(a.ACTIVATE_URL_PATH,i).then(function(t){a._activateSuccessCallback(t,e,r)},function(t){a._activateFailureCallback(t,e,r)}),r.promise},_activateSuccessCallback:function(e,t,n){var s=e.data;if(isDefined(s))if(s.success&&isDefined(s.user))o.accountActivated(),a.afterLoginSuccessSharedCallback(s,t,s.accessToken),n.resolve(s);else{var l=safeAccess(e,"data.errorCodes[0]","000000");"777955"===l?i.translateBackendErrorCodes(["2016257"]).then(function(e){n.reject(e[0])}):r.rejectDueToBackendError({deferred:n,response:e,payload:t,method:"activate"})}else n.reject("No data received")},_activateFailureCallback:function(e,t,n){r.rejectDueToHttpError({deferred:n,response:e,payload:t,method:"activate"})},toString:function(){return"SharedActivationService"}};return s}]),accountModule.service("DecryptionService",["$log","RequestService","$q","PromiseService",function(e,t,n,i){e=e.getInstance("DecryptionService"),e.info("Service Started...");var a={DECRYPT_URL_PATH:"v1/tools/decryptAndMask",decryptLink:function(e){var i={email:safeAccess(e,"email",""),firstName:safeAccess(e,"firstName",""),lastName:safeAccess(e,"lastName","")},r=n.defer();return t.post(a.DECRYPT_URL_PATH,i).then(function(t){a._decryptLinkSuccessCallback(t,e,r)},function(t){a._decryptLinkFailureCallback(t,e,r)}),r.promise},_decryptLinkSuccessCallback:function(e,t,n){var i=e.data;if(isDefined(i))if(i.success&&isDefined(i.email))n.resolve(i);else{var a=safeAccess(e,"data.errorCodes");n.reject(a)}else n.reject("No data received")},_decryptLinkFailureCallback:function(e,t,n){i.rejectDueToHttpError({deferred:n,response:e,payload:t,method:"decryptLink"})},toString:function(){return"DecryptionService"}};return a}]),accountModule.service("AccountActivationService",["SharedActivationService",function(e){var t=Object.create(e);return angular.extend(t,{ACTIVATE_URL_PATH:"v1/account/activate",toString:function(){return"AccountActivationService"}}),t}]),accountModule.service("ForgotPasswordActivationService",["SharedActivationService",function(e){var t=Object.create(e);return angular.extend(t,{ACTIVATE_URL_PATH:"v1/account/activatePassword",toString:function(){return"ForgotPasswordActivationService"}}),t}]),accountModule.service("ContentService",["$log","I18nConfig","$q","I18nService","$timeout","LayoutService","NetworkService","$injector",function(e,t,n,i,a,r,o,s){e=e.getInstance("ContentService"),e.info("Service Started...");var l={_createStaticUrlForServerContent:function(e,t){var n;return n=getContext("isB2b",!1)?getContext("cdnHost")+getContext("SITECODE")+"/html/":getContext("server")+getContext("pathToHTML","")+"html/"+getContext("SITECODE")+"/",n+=t+"_"+e+".html"},createStaticUrlForServerContentWithCurrentLocale:function(e){var n=t.getCurrentApplicationLanguage(),i=l._createStaticUrlForServerContent(n,e);return i},createStaticUrlWithLocaleOfType:function(e,t,n){var i;return i=getContext("isMobileApp",!1)?"resources/":getContext("isB2b",!1)?getContext("cdnHost")+getContext("SITECODE")+"/app_html/":"resources/",i+=t+"_"+l._makeProperCase(e)+"."+n},_makeProperCase:function(e){var t=e.split("-");return t.length>1?t[0].toLowerCase()+"-"+t[1].toUpperCase():t[0].toLowerCase()},contentSlow:function(e){return a(function(){i.translate("account.settings.error."+e).then(function(e){r.toast(e)})},o.getRequestTimeout())},getFileOpenerService:function(){return s.has("FileOpenerService")?s.get("FileOpenerService"):null},openFileUrl:function(e){var t=l.getFileOpenerService();if(t){var n=e.getElementsByTagName("a");t.openFileUrl(n)}},getInjectedService:function(e){return s.has(e)?s.get(e):null},contentNotFound:function(e,t){return a(function(){i.translate("account.settings.error."+e).then(function(e){r.toast(e)}),a.cancel(t)},1e3)},getBackgroundImageUrl:function(){var e="";if(getContext("isMobileApp"))e="../www/images/mobileBackground.jpg";else{var t=getContext("cdnHost","");e=getContext("applicationConfig.isWebDesktop")?t+getContext("SITECODE")+"/images/desktopBackground.jpg":t+getContext("SITECODE")+"/images/mobileBackground.jpg"}return e}};return l}]),accountModule.service("TemperatureUnitService",["DataManagerService","I18nConfig","AuthenticationService","$log",function(e,t,n,i){i=i.getInstance("TemperatureUnitService"),i.info("Service Started...");var a=["F","C"],r={getTemperatureUnit:function(){var i=ApplicationContext.SITECODE+"_TEMPERATURE_UNIT_KEY_"+n.getUserId(),a=e.get(i,e.LOCALSTORAGE);if(isUndefined(a)){var r=t.getCountryCodeFromDeviceLocale(),o=getContext("featureConfig.weather.countriesDisplayingTempInFahrenheit",["US"]);a=o.indexOf(r)>-1?"F":"C"}return a},updateTemperatureUnit:function(t){if(a.indexOf(t)>-1){var i=ApplicationContext.SITECODE+"_TEMPERATURE_UNIT_KEY_"+n.getUserId();return e.set(t,i,{storage:e.LOCALSTORAGE}),!0}return!1},isTemperatureFahrenheit:function(){return"F"===r.getTemperatureUnit()},toString:function(){return"TemperatureUnitService"}};return r}]),accountModule.service("AccountAnalyticsService",["$log","AnalyticsService","StringService",function(e,t,n){e=e.getInstance("AccountAnalyticsService"),e.info("Service Started...");var i={CATEGORY:"User Lifecycle",LOYALTY_EVENTS:{add:"Loyalty Card Added Successfully",update:"Loyalty Card Updated Successfully","delete":"Loyalty Card Deleted Successfully",select:"Loyalty Card Selected",addCard:"Add Loyalty Card Button Clicked",deleteCard:"Delete Loyalty Card Button Clicked",saveCardAdd:"Save Loyalty Card Button Clicked for Add Card",saveCardEdit:"Save Loyalty Card Clicked for Edit Card"},EVENTS:{loggedIn:"Customer Logged In",accountCreatedWithEmail:"Customer Registered",accountActivated:"Account activated",loggedOut:"Customer Logged Out",appOpenedFromShareTripLink:"Opened app from share trip link"},loggedIn:function(e,n){t.runSafe(function(){this.setProperty("Logged in channel",e),this.setProperty(t.FIRST_NAME,n.firstName,!0),this.setProperty("Email provider",n.userId.split("@")[1]),this.sendEvent(i.EVENTS.loggedIn,t.extendDefaultParameterWith(i._getLoggedInParameter(e)),i.CATEGORY)})},_getLoggedInParameter:function(e){return[{name:"Channel",isMarketing:!0,value:n.capitalizedFirst(e)}]},accountCreatedWithEmail:function(){t.runSafe(function(){this.sendEvent(i.EVENTS.accountCreatedWithEmail,t.extendDefaultParameterWith(),i.CATEGORY)})},accountActivated:function(){t.runSafe(function(){this.sendEvent(i.EVENTS.accountActivated,t.extendDefaultParameterWith(),i.CATEGORY)})},loggedOut:function(){t.runSafe(function(){this.sendEvent(i.EVENTS.loggedOut,t.extendDefaultParameterWith(),i.CATEGORY)})},appOpenedFromShareTripLink:function(){t.runSafe(function(){this.sendEvent(i.EVENTS.appOpenedFromShareTripLink,t.extendDefaultParameterWith(),i.CATEGORY)})},loyaltyCardActionDone:function(e,n){var a=[];isDefined(n)&&""!==n?a.push({value:"Type : "+n}):a.push({value:"-"}),isDefined(e)&&i.LOYALTY_EVENTS[e]&&t.runSafe(function(){this.sendEvent(i.LOYALTY_EVENTS[e],a,"User Settings")})},exceptionOccurred:function(e,n){t.runSafe(function(){this.sendException({message:e,isFatal:n})})},toString:function(){return"AccountAnalyticsService"}};return i}]),accountModule.controller("SharedActivationController",["$scope","$log","$stateParams","LayoutService","OrchestratorChiefService","I18nService","$ionicPopup","$injector","ACTIVATION_SERVICE_NAME","$rootScope","ContentService","ProfileService","DecryptionService","EMAIL_REGEX",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p){t=t.getInstance("SharedActivationController");var m=s.get(l);t.info("Controller Started..."),e.forms={},e.activationInputs={activationKey:n.activationKey,userId:n.userId,password:"",email:""},p.test(n.userId)?e.activationInputs.email=n.userId:(e.allowMaskedValues=!0,e.$on("$ionicView.beforeEnter",function(e,t){i.loading(!0),g.decryptLink({email:n.userId}).then(h,S)})),e.showCustomBackgroundScreen=!1,e.activate=function(){if(e.allowMaskedValues&&e.forms.activateform.passwordInput.$valid||e.forms.activateform.$valid){i.loading(!0);var t=e.activationInputs;m.activate(t).then(f,v)}else i.addErrors(e.forms.activateform.$error)};var f=function(){i.loading(!1);var t="AccountActivationService"===l?"activation":"forgotPasswordActivation";r.translate(["account."+t+".label.activationOkTitle","account."+t+".label.activationOkMessage"]).then(function(n){var i=o.alert({title:n["account."+t+".label.activationOkTitle"],template:n["account."+t+".label.activationOkMessage"]});i.then(function(t){a.next({islogged:!0}),c.$broadcast("accountActivatedEvent",{}),e.activationInputs={},e.forms.activateform.$setPristine()})})},v=function(e){i.loading(!1),i.toastError(e)},h=function(t){i.loading(!1),e.activationInputs.email=t.email},S=function(e){if(i.loading(!1),"777955"===e[0]||"777959"===e[0]){var t="AccountActivationService"===l?"activation":"forgotPasswordActivation";r.translate(["core.title.errorPopup","account."+t+".error.message"]).then(function(e){var n=o.alert({title:e["core.title.errorPopup"],template:e["account."+t+".error.message"]});n.then(function(e){a.next()})})}else i.toastError(e).then(function(){a.next()})};e.setupBackgroundImage=function(){var t=d.getBackgroundImageUrl();u.preloadImage(t).then(function(t){e.showCustomBackgroundScreen=!!t},function(){e.showCustomBackgroundScreen=!1})},getContext("featureConfig.page.hasCustomBackground",!1)&&e.setupBackgroundImage()}]),accountModule.service("ForgotPasswordService",["$log","RequestService","$q","I18nService",function(e,t,n,i){e=e.getInstance("ForgotPasswordService"),e.info("Service Started...");var a={RESET_PASSWORD_URL_PATH:"v1/account/resetPassword",forgotPassword:function(e){var i=getContext("featureConfig.whiteLabelCustomFeatures.isPasswordFieldDisplayedInForgotPasswordFlow",!0),r={userId:e.email};i?(r.newPassword=e.password,definedOrThrow(r,"missing one of mandatory fields (email, password)")):definedOrThrow([r.userId],"missing one of mandatory fields (email)");var o=n.defer();return t.post(a.RESET_PASSWORD_URL_PATH,r).then(function(t){a._forgotPasswordSuccessCallback(t,e,o)},function(t){a._forgotPasswordFailureCallback(t,e,o)}),o.promise},_forgotPasswordSuccessCallback:function(t,n,a){var r=t.data;if(isDefined(r))if(r.success)a.resolve(r);else{e.backendError(r);var o=safeAccess(t,"data.errorCodes");i.translateBackendErrorCodes(o).then(function(e){a.reject(e)})}else a.reject("No data received")},_forgotPasswordFailureCallback:function(t,n,a){e.httpError(t),i.translateHttpStatusCode(t.status).then(function(e){a.reject(e)})},toString:function(){return"ForgotPasswordService"}};return a}]),accountModule.controller("ForgotPasswordController",["$scope","ForgotPasswordService","$log","DataManagerService","LayoutService","I18nService","$ionicPopup","OrchestratorChiefService","ContentService","ProfileService",function(e,t,n,i,a,r,o,s,l,c){n=n.getInstance("ForgotPasswordController"),n.info("Controller Started..."),e.forms={},e.formInputs={email:i.get(getContext("applicationConfig.forgotPasswordKey")),password:""},e.showCustomBackgroundScreen=!1,e.isPasswordFieldDisplayedInForgotPasswordFlow=getContext("featureConfig.whiteLabelCustomFeatures.isPasswordFieldDisplayedInForgotPasswordFlow",!0),e.isInternetExplorer=isIE(),e.forgotPassword=function(){e.forms.forgotpasswordform.$valid?(a.loading(!0),t.forgotPassword(e.formInputs).then(d,u)):a.addErrors(e.forms.forgotpasswordform.$error)};var d=function(){a.loading(!1),r.translate(["account.forgotPassword.label.forgotPasswordOkTitle","account.forgotPassword.label.forgotPasswordOkMessage"]).then(function(t){var n=o.alert({title:t["account.forgotPassword.label.forgotPasswordOkTitle"],template:t["account.forgotPassword.label.forgotPasswordOkMessage"]});n.then(function(){s.next({forgotPassword:!0}),e.formInputs={},e.forms.forgotpasswordform.$setPristine()})})},u=function(e){a.loading(!1),a.toastError(e)};e.setupBackgroundImage=function(){var t=l.getBackgroundImageUrl();c.preloadImage(t).then(function(t){e.showCustomBackgroundScreen=!!t},function(){e.showCustomBackgroundScreen=!1})},getContext("featureConfig.page.hasCustomBackground",!1)&&e.setupBackgroundImage()}]),accountModule.controller("SettingsController",["$scope","$log","LayoutService","I18nService","OrchestratorChiefService","AuthenticationService","NetworkService","$rootScope","TemperatureUnitService",function(e,t,n,i,a,r,o,s,l){t=t.getInstance("SettingsController"),t.info("Controller Started..."),e.isWebDesktop=getContext("isWebDesktop",!1),e.isProfileSectionEnabled=!getContext("featureConfig.mainFeatures.isProfileMenuEnabled",!1),e.navigateTo=function(e){switch(e){case"termsandconditions":c(e,"tandcnotconnected");break;case"privacypolicy":c(e,"privacypolicynotconnected");break;case"cookiepolicy":c(e,"cookiepolicynotconnected");break;case"logout":d();break;default:getContext("featureConfig.guestMode.enabled",!1)&&!r.isLogged()?a.navigateTo("guest-"+e):a.navigateTo(e)}};var c=function(e,t){o.hasConnectivity().isOnline?getContext("featureConfig.guestMode.enabled",!1)&&!r.isLogged()?a.navigateTo("guest-"+e):a.navigateTo(e):i.translate("account.settings.error."+t).then(function(e){n.toast(e)})},d=function(){var e=["account.login.title.logout","account.login.label.logOutMessage","account.login.button.logout","account.login.button.cancel"];i.translate(e).then(function(t){n.showConfirmPopup(t[e[0]],t[e[1]],t[e[2]],t[e[3]]).then(function(){n.loading(!0),s.$emit("userLogOutEvent"),s.$on("userLoggedOutEvent",function(e){n.loading(!1)})})})};e.updateTemperatureUnit=function(t){e.temperatureUnit!==t&&l.updateTemperatureUnit(t)&&(e.temperatureUnit=t)};var u=function(){var e=getContext("featureConfig.multiMarket.isEnabled",!1),t=getContext("featureConfig.multiMarket.displaySettings",!1);return e&&t},g=function(){return getContext("featureConfig.gpsCheckin.isEnabled",!1)&&r.isLogged()},p=function(){return e.enableGPSCheckinButton},m=function(){return getContext("featureConfig.dynamicMenuPage.faqPageEnabled",!1)},f=function(){return getContext("featureConfig.license.enabled",!1)},v=function(){return(getContext("featureConfig.notifications.flightAlertsPushEnabled",!0)||getContext("featureConfig.notifications.tripAddedPushEnabled",!0)||getContext("featureConfig.notifications.flightAlertsEmailEnabled",!0))&&r.isLogged()},h=function(){return(e.enableTermsAndConditionsSection||e.enablePrivacyPolicySection||e.enableCookiePolicyButton)&&!getContext("featureConfig.mainFeatures.isHelpMenuEnabled",!1)};e.showAddressOption=getContext("featureConfig.profile.profileAddressEnabled",!1),e.showLoyaltyCardOption=getContext("featureConfig.loyaltyCards.enabled",!1),e.showCreditCardOption=getContext("featureConfig.profile.isSaveCCCardEnabled",!1),e.showTemperatureControlOption=getContext("featureConfig.dynamicMenuPage.temperatureControlEnabled",!1);var S=function(){e.temperatureUnit=l.getTemperatureUnit()},C=function(){var t=getContext("featureConfig.mainFeatures.isContactUsMenuEnabled",!1),n=getContext("featureConfig.dynamicMenuPage.contactPageEnabled",!1);e.enableContactButton=!t&&n,e.enableCookiePolicyButton=getContext("featureConfig.dynamicMenuPage.cookiesPageEnabled",!1),e.enableCookieSettingsButton=getContext("featureConfig.dynamicMenuPage.cookieSettingsEnabled",!1)&&getContext("featureConfig.cookiesConsent.enabled",!1),e.showMarketOption=u(),e.enableGPSCheckinButton=g(),e.enableFAQButton=m(),e.enableLicenseButton=f(),e.enableAboutSection=(e.enableContactButton||m())&&!getContext("featureConfig.mainFeatures.isHelpMenuEnabled",!1),e.enableInformationSection=p(),e.enableNotificationsSection=v(),e.enableTermsAndConditionsSection=getContext("featureConfig.dynamicMenuPage.termsAndConditionsEnabled",!0),e.enablePrivacyPolicySection=getContext("featureConfig.dynamicMenuPage.privacyPolicyEnabled",!0),e.showLegalSection=h()};e.$on("$ionicView.beforeEnter",function(){C(),S()})}]),accountModule.controller("ProfileSettingsController",["$scope","$log","ProfileService","LayoutService","I18nService","$rootScope","GloballistProcessor","DataManagerService","AnalyticsService","AuthenticationService",function(e,t,n,i,a,r,o,s,l,c){function d(r){e.enableDeleteAccount=getContext("featureConfig.profile.enableDeleteAccount",!1),e.phoneNumberRequired=getContext("featureConfig.registration.phoneNumberRequired",!1);var s=safeAccess(r,"notificationSettings",{});e.pushChannel={flightAlerts:safeAccess(s,"flightAlertType.pushChannelEnabled",!1),newTripAdded:safeAccess(s,"tripAddedType.pushChannelEnabled",!1)},e.emailChannel={flightAlerts:safeAccess(s,"flightAlertType.emailChannelEnabled",!1),newTripAdded:safeAccess(s,"tripAddedType.emailChannelEnabled",!1)},e.smsChannel={newTripAdded:safeAccess(s,"tripAddedType.smsChannelEnabled",!1),flightAlerts:safeAccess(s,"flightAlertType.smsChannelEnabled",!1)},e.localNotifs={checkinReminder:n.isCheckinReminderNotifEnabled()},e.userProfile=e.userProfile||{},e.userProfile.userId=safeAccess(r,"userId"),e.userProfile.firstName=safeAccess(r,"firstName"),e.userProfile.lastName=safeAccess(r,"lastName"),e.userProfile.phoneNumber=safeAccess(r,"mobilePhoneNumber",""),isDefined(safeAccess(r,"mobileCountryCode"))&&(e.userProfile.phoneCode="+"+r.mobileCountryCode);var l=getContext("featureConfig.profile.profileAddressEnabled",!1);if(l){e.addressInputs={street:safeAccess(r,"address.addressLine"),city:safeAccess(r,"address.cityName"),state:safeAccess(r,"address.stateName"),countries:[],zipcode:safeAccess(r,"address.postalCode")};var c=o.getCountryCodeByCountry();c.then(function(t){e.addressInputs.countries=t,e.addressInputs.country=safeAccess(r,"address.countryName")},function(e){t.warn("Something went wrong while fetching country list"+e),a.translate("account.address.error.retrieveCountryFailed").then(function(e){i.toast(e)})})}}function u(r,o,s){i.loading(!0),n.updateProfile(r).then(function(r){t.info("__tryUpdateProfile ok"),i.loading(!1),a.translate(s).then(function(e){i.toast(e)}),n.setCheckinReminderNotifEnabled(e.localNotifs.checkinReminder),n.setSsrNotifEnabled(e.pushChannel.flightAlerts),d(r),e.forms[o].$setPristine(),"addressForm"===o&&l.runSafe(function(){this.sendEvent("Address Save Success",[{value:"-"}],"User Settings")})},function(e){t.error("__tryUpdateProfile failed: "+e),i.loading(!1),"http"===e.errorType?a.translateHttpStatusCode(e.errorCode).then(function(e){i.toastError(e)}):a.translateBackendErrorCodes([e.errorCode]).then(function(e){i.toastError(e)}),"addressForm"===o&&l.runSafe(function(){this.sendException({message:"Address Save Failed",isFatal:!1})})})["catch"](handleUnexpectedError)}t=t.getInstance("ProfileSettingsController"),
t.info("Controller Started..."),e.forms={notificationsSettingsForm:{},editProfileForm:{},addressForm:{}},e.userProfile={userId:"",firstName:"",lastName:"",phoneNumber:"",phoneCode:""},e.disableUpdateProfile=!getContext("featureConfig.profile.enableUpdateProfile",!0),e.displayPhone=getContext("featureConfig.registration.displayPhoneNumberInput",!1),e.enableDeleteAccount=getContext("featureConfig.profile.enableDeleteAccount",!1),e.phoneNumberRequired=getContext("featureConfig.registration.phoneNumberRequired",!1);var g=function(){return e.enableFlightAlertsPush||e.enableTripAddedPush||e.enableCheckinReminderLocalNotif},p=function(){return e.enableFlightAlertsEmail||e.enableTripAddedEmail},m=function(){return e.enableFlightAlertsSms||e.enableTripAddedSms},f=function(){e.enableFlightAlertsPush=getContext("featureConfig.notifications.flightAlertsPushEnabled",!0),e.enableTripAddedPush=getContext("featureConfig.notifications.tripAddedPushEnabled",!0),e.enablePushNotifications=g(),e.enableFlightAlertsEmail=getContext("featureConfig.notifications.flightAlertsEmailEnabled",!0),e.enableTripAddedEmail=getContext("featureConfig.notifications.tripAddedEmailEnabled",!0),e.enableEmailNotifications=p(),e.enableTripAddedSms=getContext("featureConfig.notifications.tripAddedSmsEnabled",!0),e.enableFlightAlertsSms=getContext("featureConfig.notifications.flightAlertsSmsEnabled",!0),e.enableSmsNotifications=m(),e.enableCheckinReminderLocalNotif=getContext("isMobileApp")&&getContext("featureConfig.notifications.checkinReminderLocalNotifEnabled",!0)};f();var v=null;e.$on("$ionicView.leave",function(){isDefined(v)&&v()}),e.saveNotificationsSettings=function(){var t={flightAlertEmailNotification:e.emailChannel.flightAlerts,tripAddedEmailNotification:e.emailChannel.newTripAdded,flightAlertPushNotification:e.pushChannel.flightAlerts,tripAddedPushNotification:e.pushChannel.newTripAdded,tripAddedSmsNotification:e.smsChannel.newTripAdded,flightAlertSmsNotification:e.smsChannel.flightAlerts};u(t,"notificationsSettingsForm","account.notificationsSettings.label.settingsSaved")},e.saveProfile=function(){if(e.forms.editProfileForm.$valid){t.info("saveProfile: form ok");var n={firstName:e.userProfile.firstName,lastName:e.userProfile.lastName};e.displayPhone&&angular.extend(n,{mobileCountryCode:e.userProfile.phoneCode.substr(1),mobilePhoneNumber:e.userProfile.phoneNumber.replace(/[a-zA-Z ()-]/g,"")}),u(n,"editProfileForm","account.editProfile.label.profileUpdated")}else t.warn("saveProfile: form invalid"),i.addErrors(e.forms.editProfileForm.$error)},e.deleteAccount=function(){var e=["account.editProfile.label.deleteAccount","account.editProfile.text.confirmDeleteAccount","core.button.ok","core.button.cancel"];a.translate(e).then(function(t){i.showConfirmPopup(t[e[0]],t[e[1]],t[e[2]],t[e[3]]).then(function(){i.loading(!0),n.deleteProfile().then(function(){i.loading(!1),c.logout({doMiddlewareCall:!1}).then(function(){i.toast("account.editProfile.text.deleteAccountSuccess")})},function(e){i.loading(!1),"http"===e.errorType?a.translateHttpStatusCode(e.errorCode).then(function(e){i.toastError(e)}):a.translateBackendErrorCodes([e.errorCode]).then(function(e){i.toastError(e)})})})})},e.saveAddress=function(){if(l.runSafe(function(){this.sendEvent("Address Save Button Clicked",[{value:"-"}],"User Settings")}),e.forms.addressForm.$valid){t.info("saveAddress: form ok");var n={address:{addressLine:null!=safeAccess(e.addressInputs,"street")?e.addressInputs.street:"",cityName:null!=safeAccess(e.addressInputs,"city")?e.addressInputs.city:"",stateName:null!=safeAccess(e.addressInputs,"state")?e.addressInputs.state:"",countryName:null!=safeAccess(e.addressInputs,"country")?e.addressInputs.country:"",postalCode:null!=safeAccess(e.addressInputs,"zipcode")?e.addressInputs.zipcode:""}};u(n,"addressForm","account.address.label.addressUpdated")}else t.warn("saveAddress: form invalid"),i.addErrors(e.forms.addressForm.$error)},e.$on("$ionicView.enter",function(){var e=n.getProfile();d(e),i.loading(!0),n.getProfileFromServer().then(function(e){d(e)})["finally"](function(){i.loading(!1)}),v=r.$on("paramsUpdates",function(e,t){f()})})}]);var alreadyDownloadedUrl={};accountModule.controller("SharedContentInIframeController",["$scope","$log","LayoutService","ContentService","$timeout","$window","$sce","IFRAME_PARAMS","OneTrustCookiesService","$rootScope",function(e,t,n,i,a,r,o,s,l,c){function d(){a.cancel(p),a.cancel(f)}function u(t){"content_loaded"===t.data&&(e._displayIframe(!0),e.contentLoadedSuccessfully=!0,d(),n.loading(!1),alreadyDownloadedUrl[e.iframeContentUrl]=!0),"navigation_back"===t.data&&isFF()&&window.history.back(),"open_cookies"===t.data&&isFeatureEnabled("cookiesConsent")&&(Optanon||l.init(),Optanon.ToggleInfoDisplay())}function g(){if(navigator.onLine){e.hideSharedContentInIframe&&(e.iframeContentUrl="");var t=i.createStaticUrlForServerContentWithCurrentLocale(s.serverUrl);"cookiepolicy"===s.serverUrl&&(t+=isFeatureEnabled("cookiesConsent")?"?consent=1":"?consent=0"),"cookiepolicy"===s.serverUrl&&getContext("isB2b",!1)&&(t+="&isB2b=1"),e.isIOSWebView?S(t):(t=o.trustAsResourceUrl(t),a(function(){e.iframeId=s.serverUrl+"_iframe",e.iframeContentUrl=t},500),alreadyDownloadedUrl[t]||n.loading(!0))}else e._displayIframe(!1),d()}t=t.getInstance(s.controllerName),t.info("Controller Started...");var p=i.contentSlow(s.labelSlow);e.headerLabel=s.labelHeader,e.contentLoadedSuccessfully=!1,e.hideSharedContentInIframe=!1,e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView(),e.$on("$ionicView.enter",function(){g()}),e.$on("modal.shown",function(){g()});var m=function(){safeAccess(e,"webview",!1)&&(e.webview.close(),e.webview=null)};e.acceptTermsAndConditions=function(){e.termsAndConditionsSuccess&&e.termsAndConditionsSuccess(),m()},e.rejectTermsAndConditions=function(){e.termsAndConditionsFailure&&e.termsAndConditionsFailure(),m()},e._displayIframe=function(t){e.hideSharedContentInIframe=!t},e.refreshButtonClick=function(){g()},e.slowNetworkHandler=function(){e._displayIframe(!1),n.loading(!1)};var f=a(e.slowNetworkHandler,15e3),v=function(){e.webview.executeScript('setTimeout(function(){var anchors = document.getElementsByTagName("a");for (var index = 0; index < anchors.length; index++) {var anchor = anchors[index];if (anchor.getAttribute("href").startsWith("http") || anchor.getAttribute("href").startsWith("https")) {anchor.dataset.href = anchor.getAttribute("href");anchor.dataset.extension = anchor.getAttribute("extension-type");anchor.setAttribute("href", "javascript:");anchor.addEventListener("click", function(inboxEvent) {webkit.messageHandlers.shareContentHandler.postMessage({linkUrl: inboxEvent.target.dataset.href,extension: inboxEvent.target.dataset.extension});}, false);}}},10)')},h=function(){a(function(){e.contentLoadedSuccessfully=!0},500),v()},S=function(n){if(safeAccess(r,"cordova.plugins.AMWebview")){t.info("Setting URL of WebView: "+n),m(),e.webview=r.cordova.plugins.AMWebview(n,{hasTabs:!0,hideHeader:!0,postMessageHandler:"shareContentHandler",hasAdditionalHeader:"NCMTBOSC"===getContext("SITECODE")}),e.webview.addEventListener("loadend",h);var a=i.getFileOpenerService();a&&e.webview.addEventListener("onMessage",a.handleWebViewContentLink)}};e.$on("$stateChangeStart",function(t,i,a,r,o,s){var l=["termsandconditions","privacypolicy","cookiepolicy","help-termsandconditions","help-privacypolicy","help-cookiepolicy","more-help-termsandconditions","more-help-privacypolicy","more-help-cookiepolicy","guest-help-termsandconditions","guest-help-privacypolicy","guest-help-cookiepolicy","more-guest-help-termsandconditions","more-guest-help-privacypolicy","more-guest-help-cookiepolicy"];l.indexOf(r.name)>-1&&(n.unFocusActiveElement(),e.isIOSWebView&&e.webview&&(e.webview.removeEventListener("onMessage",function(t){e.receiveMessage(t)}),m()))}),c.$on("onMoreMenuPopup",function(t,n){e.isIOSWebView&&e.webview&&(safeAccess(n,"modalDisplayed")?e.webview.hide():e.webview.show())}),r.onIframeContentLoaded=function(t){if(getContext("isMobileApp",!1)){var a=document.getElementById(e.iframeId);if(isDefined(a)){var r=a.contentDocument.documentElement;i.openFileUrl(r)}}""===t.target.src||e.contentLoadedSuccessfully||(d(),alreadyDownloadedUrl[e.iframeContentUrl]=!1,e._displayIframe(!1),n.loading(!1))},r.addEventListener("message",u),e.$on("$destroy",function(){r.removeEventListener("message",u),r.onIframeContentLoaded=void 0,d()})}]),accountModule.service("OneTrustCookiesService",["$log","I18nConfig","ParameterService","$rootScope","$timeout",function(e,t,n,i,a){e=e.getInstance("OneTrustCookiesService"),e.info("OneTrustCookiesService Started...");var r={oneTrustUrls:{DEFAULT:"71082daf-f05a-452e-96a5-002692c3127a",fr:"4c9733d0-e494-4fba-b7a6-76be6857d7f3",de:"b22ac1c3-bada-4dd3-9762-81c8ac78aa65",it:"de737747-ab0b-4666-9e91-05cf004de7ed","pt-BR":"d5ccde65-80ee-4ed2-baec-38263c12e274","pt-PT":"78737b8d-9e79-484d-9dc2-6eaf1a3fba02",sv:"2d7161af-0030-4438-b4df-03a609299a4a",ru:"85ef030c-e4d7-428c-a106-b08c457352da",ja:"a7d56730-399c-4ee4-93ab-9214bcecc102","zh-CN":"661eefff-5b8c-44bf-911c-790d9bda1641","zh-TW":"0f5a2d9e-150d-4142-9a5c-a986e2645294",es:"5c94795c-5dcb-460b-acf8-39b9a57798b9",ar:"3c9fad52-ba2e-4736-b639-a4d3ad8b868c",da:"382dd2a7-0d6a-4a22-aa90-d6d949341cb3",fi:"ecde7313-606f-48c8-8469-027adb3b52b5",ko:"b2d8a57b-3cc4-4e39-808a-1ab3d4f25387",no:"c7906e7f-9b12-4366-8e6e-98a6d23b4528",pl:"a2c770a3-6767-429b-934e-cb7b0c8f6fea",th:"5833d2d5-a375-46b7-8d37-91278a1d3d42",tr:"07f08c03-5019-4a39-9d9e-6273b7ecd2d5",nl:"d030ecd6-785d-4f01-8535-573f1c89bdd4"},determineUrl:function(){var e=n.parse(),i=e.language||t.getCurrentApplicationLanguage(),a=r.oneTrustUrls[i];a=a?a:r.oneTrustUrls.DEFAULT;var o="https://optanon.blob.core.windows.net/consent/",s=getContext("featureConfig.cookiesConsent.url",o),l=getContext("featureConfig.cookiesConsent.script",".js");return s+a+l},getStaticPageUrl:function(e){var t="";return t+="/"===getContext("server","/")?window.location.origin+"/":getContext("server"),t+=getContext("applicationConfig.entryPoint","cmtweb")+"/",getContext("isB2b",!1)?(t+="?ST="+getContext("SITECODE","NCMTDEMO"),t+="&OCTX="+getContext("OCTX","TCPROD"),t+="&TYPE=ONETRUST","cookiepolicy"===e&&(e="onetrust-cookiepolicy")):n.parse().OCTX&&(t+="?OCTX="+n.parse().OCTX),t+="#/"+e},updatePopupDesign:function(e,t,n){var i=document.querySelectorAll("ul#optanon-menu > li")[3];if(i.setAttribute("style","display: none;"),t){for(var a=document.querySelectorAll("#optanon.modern #optanon-popup-top, #optanon.modern #optanon-popup-body-left-shading"),r=0;r<a.length;r++)a[r].setAttribute("style","background-color: "+t+" !important;");document.querySelector("#optanon #optanon-popup-bottom").setAttribute("style","background-color: "+t+" !important;")}if(n){document.querySelector(".optanon-alert-box-wrapper .optanon-alert-box-button-middle").setAttribute("style","background-color: "+n+" !important;");for(var o=document.querySelectorAll("#optanon #optanon-popup-wrapper .optanon-white-button-middle"),s=0;s<o.length;s++)o[s].setAttribute("style","background-color: "+n+" !important;");document.querySelector("div.optanon-alert-box-button-middle.accept-cookie-container").setAttribute("style","background-color: "+n+" !important; border-color: "+n+" !important;")}e&&document.querySelector("#optanon.modern #optanon-popup-wrapper #optanon-branding-top-logo").setAttribute("style","background-image: url('"+e+"') !important;")},getLogoUrlForB2B:function(){e.method("getLogoUrlForB2B");var t="";return t=getContext("isMobileApp",!1)?"resources/":getContext("cdnHost"),t&&(t+=getContext("SITECODE"),t+="/images/logo-toolbar.png"),t},setupUIwithContext:function(){window.addEventListener("load",function(){e.info("DOM loaded");var n,i=r.getStaticPageUrl("cookiepolicy"),o=5;n=window.setInterval(function(){if(o--,document.querySelector(".optanon-alert-box-wrapper")){window.clearInterval(n),e.info("Customizing oneTrust UI...");var s=document.querySelector("a.banner-policy-link"),l=document.querySelector("p.preference-menu-item > a"),c=document.querySelectorAll("ul#optanon-menu > li")[4];if(c.onclick=function(){a(function(){var e=document.querySelectorAll("p.optanon-subgroup-cookies-list.subgroup-cookies-list");if(getContext("featureConfig.restaurantBooking.enabled",!1)&&-1!==getContext("featureConfig.activitiesBooking.defaultUrl").indexOf("opentable")||e[0].setAttribute("style","display: none;"),getContext("featureConfig.activitiesBooking.enabled",!1)&&-1!==getContext("featureConfig.activitiesBooking.defaultUrl").indexOf("mylittleadventure")||e[1].setAttribute("style","display: none;"),getContext("featureConfig.parkcloud.enabled",!1)||e[2].setAttribute("style","display: none;"),getContext("featureConfig.taxiBooking.enabled",!1)&&-1!==getContext("featureConfig.taxiBooking.iframeUrl").indexOf("transferbookingengine")){if(e[3]&&getContext("isB2b",!1)){var n=t.getCurrentDeviceLanguage();"zh"===n&&(n="cn");var i=getContext("featureConfig.taxiBooking.websiteUrl","");if(i){i=i+"?language="+n;var a=e[3].querySelector("div").querySelector("a");a.setAttribute("href",i)}}}else e[3].setAttribute("style","display: none;");if(getContext("featureConfig.loungeBooking.enabled",!1)||e[4].setAttribute("style","display: none;"),e[5]&&!getContext("featureConfig.cytric.enabled",!1)&&e[5].setAttribute("style","display: none;"),e[6]&&!getContext("featureConfig.ezeego1.enabled",!1)&&e[6].setAttribute("style","display: none;"),e[7]&&!getContext("featureConfig.airhelp.enabled",!1)&&e[7].setAttribute("style","display: none;"),(e[8]&&!getContext("featureConfig.activitiesBooking.enabled",!1)||-1===getContext("featureConfig.activitiesBooking.defaultUrl").indexOf("viator"))&&e[8].setAttribute("style","display: none;"),e[9]&&!getContext("featureConfig.stripe.enabled",!1)&&e[9].setAttribute("style","display: none;"),e[10]&&!getContext("featureConfig.flightBookAndSearchEpower.enabled",!1))e[10].setAttribute("style","display: none;");else if(e[10]){var r=getContext("featureConfig.flightBookAndSearchEpower.url","");if(r){var o=e[10].querySelector("div").querySelector("a");o.setAttribute("href",r)}}(e[11]&&!getContext("featureConfig.explore.enabled",!1)||"tripadvisor"!==getContext("featureConfig.explore.PROVIDER"))&&e[11].setAttribute("style","display: none;"),e[12]&&!getContext("featureConfig.bookingDotCom.enabled",!1)&&e[12].setAttribute("style","display: none;")})},s&&s.setAttribute("href",i),l&&l.setAttribute("href",i),getContext("isB2b",!1)){var d=r.getLogoUrlForB2B();r.updatePopupDesign(d)}}else 1>o&&window.clearInterval(n)},500)})},init:function(){if(getContext("featureConfig.cookiesConsent.enabled",!1)){var e=r.determineUrl(),t=getContext("featureConfig.analytics.google.APIKey","UA-18514622-6"),n=getContext("featureConfig.cookiesConsent.analytical_groupId",2),i=getContext("featureConfig.cookiesConsent.targetingAds_groupId",4),a=new RegExp(","+i+","),o="https://amadeus-d.openx.net/privacy/optout",s=document.createElement("script");s.setAttribute("src",e),s.setAttribute("type","text/javascript"),s.setAttribute("charset","UTF-8");var l=document.createElement("script");l.setAttribute("type","text/javascript"),l.innerHTML="function OptanonWrapper(){ Optanon.BlockGoogleAnalytics('"+t+"', "+n+"); if(!OptanonActiveGroups.match("+a+")){var img = document.createElement('img'); img.src ='"+o+"'; img.style='display: none;' ;document.body.appendChild(img);}}",document.head.appendChild(l);var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(s,c),r.setupUIwithContext()}},toString:function(){return"OneTrustCookiesService"}};return r}]),accountModule.run(["$templateCache",function(e){e.put("account/templates/pages/AccountActivationView.html",'<ion-view debug-file-path="AccountActivationView.html"><ion-nav-title translate>account.activation.title.activation</ion-nav-title><div ng-class="{&apos;custom-bg-screen&apos;: showCustomBackgroundScreen}"></div><ion-content class="spaced-layout splash"><div class="transbox"></div><article class="contained-narrow"><form name="forms.activateform" novalidate role="form"><cmt-input-email allow-masked-values="allowMaskedValues" class="custom-bg-text" id="userId" label="{{&apos;account.activation.label.email&apos;|translate}}" model-container="activationInputs" model-key="&apos;email&apos;" name="userId" readonly="true" required></cmt-input-email><cmt-input-password class="custom-bg-text semi-spaced-element" data="activationInputs.password" id="password" label="{{&apos;account.activation.label.password&apos;|translate}}" name="password" novalidate required></cmt-input-password><button class="btn-fullwidth spaced-element" name="account_activation_view_submit" ng-click="activate()" translate type="submit">account.activation.button.activate</button></form></article></ion-content></ion-view>'),e.put("account/templates/pages/AddressView.html",'<ion-view debug-file-path="AddressView.html"><ion-nav-title translate>account.address.label.address</ion-nav-title><ion-content><div class="contained-pad loyalty-card-head" translate>account.address.label.address</div><article class="contained-pad"><form name="forms.addressForm" novalidate role="form"><cmt-input-text data="addressInputs.street" id="addressStreet" label="{{&apos;account.address.label.street&apos;|translate}}" maxlength="50" name="street"></cmt-input-text><cmt-input-text data="addressInputs.city" id="addressCity" label="{{&apos;account.address.label.city&apos;|translate}}" maxlength="30" name="city" class="spaced-element"></cmt-input-text><cmt-input-text data="addressInputs.state" id="addressState" label="{{&apos;account.address.label.state&apos;|translate}}" maxlength="25" name="state" class="spaced-element"></cmt-input-text><cmt-input-text data="addressInputs.zipcode" id="addressZipcode" label="{{&apos;account.address.label.zipCode&apos;|translate}}" maxlength="20" name="zipCode" class="spaced-element"></cmt-input-text><cmt-select class="spaced-element" data="addressInputs.country" id="addressCountry" label="{{&apos;account.address.label.country&apos;|translate}}" name="country" ng-if="addressInputs.countries" options="addressInputs.countries" placeholder="{{&apos;account.address.label.selectCountry&apos;|translate}}"></cmt-select><button class="spaced-element btn-fullwidth" id="addressSubmit" name="address_view_submit" ng-click="saveAddress()" ng-disabled="forms.addressForm.$pristine" translate type="submit">account.address.button.save</button></form></article></ion-content></ion-view>'),e.put("account/templates/pages/ForgotPasswordActivationView.html",'<ion-view debug-file-path="ForgotPasswordActivationView.html"><ion-nav-title translate>account.forgotPasswordActivation.title.activation</ion-nav-title><div ng-class="{&apos;custom-bg-screen&apos;: showCustomBackgroundScreen}"></div><ion-content class="spaced-layout splash"><div class="transbox"></div><article class="contained-narrow"><form name="forms.activateform" novalidate role="form"><cmt-input-email allow-masked-values="allowMaskedValues" class="custom-bg-text" id="userId" label="{{&apos;account.forgotPasswordActivation.label.email&apos;|translate}}" model-container="activationInputs" model-key="&apos;email&apos;" name="userId" readonly="true" required></cmt-input-email><cmt-input-password class="custom-bg-text semi-spaced-element" data="activationInputs.password" id="password" label="{{&apos;account.forgotPasswordActivation.label.password&apos;|translate}}" name="password" novalidate required></cmt-input-password><button class="btn-fullwidth spaced-element" name="forgot_password_activation_view_submit" ng-click="activate()" translate type="submit">account.forgotPasswordActivation.button.activate</button></form></article></ion-content></ion-view>'),e.put("account/templates/pages/ForgotPasswordView.html",'<ion-view debug-file-path="ForgotPasswordView.html"><ion-nav-title translate>account.forgotPassword.title.forgotPassword</ion-nav-title><div ng-class="{&apos;custom-bg-screen&apos;: showCustomBackgroundScreen}"></div><ion-content class="spaced-layout splash"><div class="transbox"></div><article class="contained-narrow"><form name="forms.forgotpasswordform" novalidate role="form"><cmt-input-email class="custom-bg-text" label="{{&apos;account.forgotPassword.label.email&apos;|translate}}" model-container="formInputs" model-key="&apos;email&apos;" name="email" required></cmt-input-email><cmt-input-password class="custom-bg-text semi-spaced-element" data="formInputs.password" label="{{&apos;account.forgotPassword.label.password&apos;|translate}}" name="password" ng-if="isPasswordFieldDisplayedInForgotPasswordFlow" required></cmt-input-password><input class="input-hidden-but-active" ng-click="forgotPassword()" ng-if="isInternetExplorer" type="submit"> <button class="btn-fullwidth spaced-element" name="forgot_password_view_submit" ng-click="forgotPassword()" translate type="submit">account.forgotPassword.button.submit</button></form></article></ion-content></ion-view>'),e.put("account/templates/pages/HelpView.html",'<ion-view debug-file-path="HelpView.html"><ion-nav-title translate>account.settings.label.helpmenuitem</ion-nav-title><ion-content><article class="contained-mobile-pad"><div class="list"><div class="item item-divider settings-header" ng-if="isWebDesktop" translate>account.settings.label.helpmenuitem</div><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;help-termsandconditions&apos;)" ng-if="enableTermsAndConditionsSection"><span translate>account.settings.label.termsandcondition</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;help-privacypolicy&apos;)" ng-if="enablePrivacyPolicySection"><span translate>account.settings.label.privacypolicy</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;help-cookiepolicy&apos;)" ng-if="enableCookiePolicyButton"><span translate>account.settings.label.cookiepolicy</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;help-contact&apos;)" ng-if="enableContactButton"><span translate>account.settings.label.contactmenuitem</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;help-faq&apos;)" ng-if="enableFAQButton"><span translate>account.settings.label.faqpage</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;help-license&apos;)" ng-if="enableLicenseButton"><span translate>account.settings.label.licenses</span><i class="icon icon-chevron-right-small"></i></a></div></article></ion-content></ion-view>'),e.put("account/templates/pages/LoginView.html",'<ion-view debug-file-path="LoginView.html"><ion-nav-title translate>account.login.title.login</ion-nav-title><div ng-class="{&apos;custom-bg-screen&apos;: showCustomBackgroundScreen}"></div><ion-content class="spaced-layout splash"><div class="transbox"></div><article class="align-login-page contained-narrow"><i class="cmtLogo" ng-click="handleEasterEgg()"></i><form id="login-form" method="POST" name="forms.loginform" novalidate role="form"><span translate class="log-in-to-see-trip-message ng-hide validation" ng-show="isLoginToSeeYourTripMessageDisplayed">account.login.error.logInToSeeYourTrip</span><cmt-input-email allow-masked-values="allowMaskedValues" class="custom-bg-text" label="{{&apos;account.login.label.email&apos;|translate}}" model-container="loginInputs" model-key="&apos;email&apos;" name="email" required></cmt-input-email><cmt-input-password class="custom-bg-text semi-spaced-element" data="loginInputs.password" label="{{&apos;account.login.label.password&apos;|translate}}" name="password" novalidate required></cmt-input-password><input class="input-hidden-but-active" ng-click="login()" ng-if="isInternetExplorer" type="submit"> <button class="spaced-element btn-fullwidth" id="login-submit" name="login_view_submit" ng-click="login()" translate type="submit">account.login.button.login</button><p class="custom-bg-text sentence spaced-element" ng-if="isForgotPasswordEnabled"><a class="important" navigate-to="forgotpassword" translate>account.login.link.forgotPassword</a></p><p class="custom-bg-text sentence spaced-element" ng-if="isCreateAccountEnabled"><span translate ng-click="handleEasterEgg()" style="cursor:default">account.login.label.notMember</span> <a class="important" navigate-to="register" translate>account.login.link.createAccount</a></p></form></article></ion-content></ion-view>'),e.put("account/templates/pages/NotificationsSettingsView.html",'<ion-view debug-file-path="NotificationsSettingsView.html"><ion-nav-title translate>account.notificationsSettings.title.notifications</ion-nav-title><ion-content><article class="contained-mobile-pad"><form name="forms.notificationsSettingsForm"><div class="list"><div class="item item-divider settings-header" ng-if="enablePushNotifications" translate>account.notificationsSettings.label.pushChannel</div><ion-toggle ng-if="enableFlightAlertsPush" ng-model="pushChannel.flightAlerts" toggle-class="toggle-balanced">{{&apos;account.notificationsSettings.label.flightAlerts&apos;|translate}}</ion-toggle><ion-toggle ng-if="enableTripAddedPush" ng-model="pushChannel.newTripAdded" toggle-class="toggle-balanced">{{&apos;account.notificationsSettings.label.newTripAdded&apos;|translate}}</ion-toggle><ion-toggle ng-if="enableCheckinReminderLocalNotif" ng-model="localNotifs.checkinReminder" toggle-class="toggle-balanced">{{&apos;account.notificationsSettings.label.checkinReminder&apos;|translate}}</ion-toggle><div class="item item-divider settings-header" ng-if="enableEmailNotifications" translate>account.notificationsSettings.label.emailChannel</div><ion-toggle ng-if="enableFlightAlertsEmail" ng-model="emailChannel.flightAlerts" toggle-class="toggle-balanced">{{&apos;account.notificationsSettings.label.flightAlerts&apos;|translate}}</ion-toggle><ion-toggle ng-if="enableTripAddedEmail" ng-model="emailChannel.newTripAdded" toggle-class="toggle-balanced">{{&apos;account.notificationsSettings.label.newTripAdded&apos;|translate}}</ion-toggle><div class="item item-divider settings-header" ng-if="enableSmsNotifications" translate>account.notificationsSettings.label.smsChannel</div><ion-toggle ng-if="enableFlightAlertsSms" ng-model="smsChannel.flightAlerts" toggle-class="toggle-balanced">{{&apos;account.notificationsSettings.label.flightAlerts&apos;|translate}}</ion-toggle><ion-toggle ng-if="enableTripAddedSms" ng-model="smsChannel.newTripAdded" toggle-class="toggle-balanced">{{&apos;account.notificationsSettings.label.newTripAdded&apos;|translate}}</ion-toggle><div class="contained-narrow spaced-layout-element"><button class="btn-fullwidth" name="notification_settings_view_save" ng-click="saveNotificationsSettings()" ng-disabled="forms.notificationsSettingsForm.$pristine" translate>account.notificationsSettings.button.save</button></div></div></form></article></ion-content></ion-view>'),e.put("account/templates/pages/ProfileMenuView.html",'<ion-view debug-file-path="ProfileMenuView.html"><ion-nav-title translate>account.settings.label.profilemenuitem</ion-nav-title><ion-content><article class="contained-mobile-pad"><div class="list"><div class="item item-divider settings-header" ng-if="isWebDesktop" translate>account.settings.label.profilemenuitem</div><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;profile-notifications-settings&apos;)" ng-if="enableNotificationsSection"><span translate>account.settings.label.notification</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right e2e-personal-information" href ng-click="navigateTo(&apos;profile-edit-profile&apos;)"><span translate>account.settings.label.personalinformation</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;profile-market&apos;)" ng-if="showMarketOption"><span translate>multiMarket.label.travelAgency</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;profile-address&apos;)" ng-if="showAddressOption"><span translate>account.address.label.address</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;profile-loyaltycardlist&apos;)" ng-if="showLoyaltyCardOption"><span translate>account.settings.label.loyaltyCards</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;profile-creditcardlist&apos;)" ng-if="showCreditCardOption"><span translate>account.settings.label.creditCards</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" ng-if="showTemperatureControlOption"><span translate class="temperature-control-label">account.settings.label.temperatureControl</span><div class="btn-set temperature-control-buttons"><button name="profile_menu_view_temperature_celcius_button" ng-click="updateTemperatureUnit(&apos;C&apos;)" ng-class="{&apos;active&apos;: temperatureUnit === &apos;C&apos;}" type="button"><span translate class="temperature-unit-text-full">account.settings.text.temperatureCelcius</span> <span translate class="temperature-unit-text-small">account.settings.text.temperatureCelciusSmall</span></button> <button name="profile_menu_view_temperature_fahrenheit_button" ng-click="updateTemperatureUnit(&apos;F&apos;)" ng-class="{&apos;active&apos;: temperatureUnit === &apos;F&apos;}" type="button"><span translate class="temperature-unit-text-full">account.settings.text.temperatureFahrenheit</span> <span translate class="temperature-unit-text-small">account.settings.text.temperatureFahrenheitSmall</span></button></div></a></div><div class="contained-narrow spaced-layout-element"><button name="profile_menu_view_logout_button" ng-click="navigateTo(&apos;logout&apos;)" class="btn-fullwidth" id="e2e-logout" translate>account.settings.label.logoutmenuitem</button></div></article></ion-content></ion-view>'),e.put("account/templates/pages/ProfileView.html",'<ion-view debug-file-path="ProfileView.html"><ion-nav-title translate>account.editProfile.title.editProfile</ion-nav-title><ion-content class="spaced-layout"><article class="contained-narrow"><form name="forms.editProfileForm" novalidate role="form"><cmt-input-email label="{{&apos;account.editProfile.label.email&apos;|translate}}" model-container="userProfile" model-key="&apos;userId&apos;" name="email" readonly="true" required></cmt-input-email><cmt-input-text class="semi-spaced-element" data="userProfile.firstName" label="{{&apos;account.editProfile.label.firstName&apos;|translate}}" name="firstname" readonly="disableUpdateProfile" required use-pattern="firstName"></cmt-input-text><cmt-input-text class="semi-spaced-element" data="userProfile.lastName" label="{{&apos;account.editProfile.label.lastName&apos;|translate}}" name="lastname" readonly="disableUpdateProfile" required use-pattern="lastName"></cmt-input-text><cmt-input-phone class="semi-spaced-element" label="{{&apos;account.editProfile.label.mobileNumber&apos;|translate}}" name="phoneNumber" ng-if="displayPhone" phone-code-model="userProfile.phoneCode" phone-number-model="userProfile.phoneNumber" readonly="disableUpdateProfile" required="{{phoneNumberRequired}}"></cmt-input-phone><button class="btn-fullwidth spaced-element" name="profile_view_submit" ng-click="saveProfile()" translate type="submit" ng-disabled="forms.editProfileForm.$pristine" ng-hide="disableUpdateProfile">account.editProfile.button.save</button><div class="contained-narrow spaced-element" ng-if="enableDeleteAccount"><button class="btn-fullwidth btn-danger e2e-delete-account" name="profile_view_delete_account_button" ng-click="deleteAccount()" translate type="button">account.editProfile.label.deleteAccount</button></div></form></article></ion-content></ion-view>'),
e.put("account/templates/pages/RegistrationView.html",'<ion-view debug-file-path="RegistrationView.html"><ion-nav-title translate>account.registration.title.createAccount</ion-nav-title><div ng-class="{&apos;custom-bg-screen&apos;: showCustomBackgroundScreen}"></div><ion-content class="spaced-layout splash"><div class="transbox"></div><article class="contained-narrow"><form name="forms.registerform" novalidate role="form"><cmt-input-text allow-masked-values="allowMaskedFirstName" class="custom-bg-text" data="registerInputs.firstName" id="registrationFirstname" label="{{&apos;account.registration.label.firstName&apos;|translate}}" name="firstname" readonly="isFirstNameReadOnly" required use-pattern="firstName"></cmt-input-text><cmt-input-text allow-masked-values="allowMaskedLastName" class="custom-bg-text semi-spaced-element" data="registerInputs.lastName" id="registrationLastname" label="{{&apos;account.registration.label.lastName&apos;|translate}}" name="lastname" readonly="isLastNameReadOnly" required use-pattern="lastName"></cmt-input-text><cmt-input-email allow-masked-values="allowMaskedValues" class="custom-bg-text semi-spaced-element" id="registrationEmail" label="{{&apos;account.registration.label.email&apos;|translate}}" model-container="registerInputs" model-key="&apos;email&apos;" name="email" required></cmt-input-email><cmt-input-phone class="custom-bg-text semi-spaced-element" id="registrationPhone" label="{{&apos;account.registration.label.mobileNumber&apos;|translate}}" name="phoneNumber" ng-if="displayPhone" phone-code-model="registerInputs.phoneCode" phone-number-model="registerInputs.phoneNumber" required="{{phoneNumberRequired}}"></cmt-input-phone><cmt-input-password class="custom-bg-text semi-spaced-element" data="registerInputs.password" id="registrationPassword" label="{{&apos;account.registration.label.password&apos;|translate}}" name="password" required></cmt-input-password><div ng-if="isMultiMarket"><multi-market-select class="custom-bg-text" data="marketData" fields-data="registerInputs.marketInformation"></multi-market-select></div><input class="input-hidden-but-active" ng-click="register()" ng-if="isInternetExplorer" type="submit"> <button class="btn-fullwidth spaced-element" id="registrationsubmit" name="registration_view_submit" ng-click="register()" translate type="submit">account.registration.button.createAccount</button></form></article></ion-content></ion-view>'),e.put("account/templates/pages/SettingsView.html",'<ion-view debug-file-path="SettingsView.html"><ion-nav-title translate>account.settings.title.view</ion-nav-title><ion-content><article class="contained-mobile-pad"><div class="list"><div ng-if="isProfileSectionEnabled"><div class="item item-divider settings-header" translate>account.settings.label.profilemenuitem</div><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;notifications-settings&apos;)" ng-if="enableNotificationsSection"><span translate>account.settings.label.notification</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right e2e-personal-information" href ng-click="navigateTo(&apos;edit-profile&apos;)"><span translate>account.settings.label.personalinformation</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;market&apos;)" ng-if="showMarketOption"><span translate>multiMarket.label.travelAgency</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;address&apos;)" ng-if="showAddressOption"><span translate>account.address.label.address</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;loyaltycardlist&apos;)" ng-if="showLoyaltyCardOption"><span translate>account.settings.label.loyaltyCards</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;creditcardlist&apos;)" ng-if="showCreditCardOption"><span translate>account.settings.label.creditCards</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" ng-if="showTemperatureControlOption"><span translate class="temperature-control-label">account.settings.label.temperatureControl</span><div class="btn-set temperature-control-buttons"><button ng-click="updateTemperatureUnit(&apos;C&apos;)" name="profile_menu_view_temperature_celcius_button" ng-class="{&apos;active&apos;: temperatureUnit === &apos;C&apos;}" type="button"><span translate class="temperature-unit-text-full">account.settings.text.temperatureCelcius</span> <span translate class="temperature-unit-text-small">account.settings.text.temperatureCelciusSmall</span></button> <button ng-click="updateTemperatureUnit(&apos;F&apos;)" name="profile_menu_view_temperature_fahrenheit_button" ng-class="{&apos;active&apos;: temperatureUnit === &apos;F&apos;}" type="button"><span translate class="temperature-unit-text-full">account.settings.text.temperatureFahrenheit</span> <span translate class="temperature-unit-text-small">account.settings.text.temperatureFahrenheitSmall</span></button></div></a></div><div ng-if="showLegalSection"><div class="item item-divider settings-header" translate>account.settings.label.legalmenuitem</div><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;termsandconditions&apos;)" ng-if="enableTermsAndConditionsSection"><span translate>account.settings.label.termsandcondition</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;privacypolicy&apos;)" ng-if="enablePrivacyPolicySection"><span translate>account.settings.label.privacypolicy</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;cookiepolicy&apos;)" ng-if="enableCookiePolicyButton"><span translate>account.settings.label.cookiepolicy</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right optanon-toggle-display" href ng-if="enableCookieSettingsButton"><span translate>account.settings.label.cookiesettings</span> <i class="icon icon-chevron-right-small"></i></a></div><div ng-if="enableAboutSection"><div class="item item-divider settings-header" translate ng-if="enableInformationSection">account.settings.label.informationmenuitem</div><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;gpsCheckin&apos;)" ng-if="enableGPSCheckinButton"><span translate>gpsCheckin.label.gpsCheckin</span> <i class="icon icon-chevron-right-small"></i></a></div><div ng-if="enableAboutSection"><div class="item item-divider settings-header" translate>account.settings.label.aboutmenuitem</div><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;contact&apos;)" ng-if="enableContactButton"><span translate>account.settings.label.contactmenuitem</span> <i class="icon icon-chevron-right-small"></i> </a><a class="item cmt-link-midcontrast item-icon-right" href ng-click="navigateTo(&apos;faq&apos;)" ng-if="enableFAQButton"><span translate>account.settings.label.faqpage</span> <i class="icon icon-chevron-right-small"></i></a></div></div><div class="contained-narrow spaced-layout-element" ng-if="isProfileSectionEnabled"><button ng-click="navigateTo(&apos;logout&apos;)" class="btn-fullwidth" id="e2e-logout" translate>account.settings.label.logoutmenuitem</button></div></article></ion-content></ion-view>'),e.put("account/templates/pages/SharedContentInIframeView.html",'<ion-view debug-file-path="SharedContentInIframeView.html"><ion-nav-title>{{headerLabel | translate}}</ion-nav-title><ion-content class="iframe-fullpage" ng-class="{&apos;hideContentOverflow&apos;: hideSharedContentInIframe}"><div class="sharedContentErrorContainer" ng-if="hideSharedContentInIframe"><p><i class="space-rt icon icon-alert-tri-outline"></i><br>{{&apos;account.settings.error.nonetwork&apos;|translate}}</p><button class="btn-small" name="shared_content_in_iframe_view_refresh_button" ng-click="refreshButtonClick()" type="button"><i class="space-rt icon-refresh"></i> {{&apos;account.settings.button.refresh&apos;|translate}}</button></div><div class="iframe-container" ng-if="!isIOSWebView"><iframe class="iframe-content" id="{{iframeId}}" ng-class="{&apos;sharedContentFrameHidden&apos;: hideSharedContentInIframe}" ng-src="{{iframeContentUrl}}" onload="if(window.onIframeContentLoaded) window.onIframeContentLoaded(event)"></iframe></div></ion-content></ion-view>'),e.put("account/templates/partial/termsAndConditions.html",'<ion-modal-view class="terms-and-conditions-modal" debug-file-path="termsAndConditions.html"><ion-header-bar class="bar-stable"><h1 class="title" translate>account.registration.title.termsAndConditions</h1></ion-header-bar><ion-content class="t-and-c-with-buttons has-header" ng-show="!isIOSWebView"><div class="t-and-c-with-buttons align-t-and-c" ng-controller="SharedContentInIframeController" ng-class="{&apos;hideContentOverflow&apos;: hideSharedContentInIframe}" ng-if="!isIOSWebView"><div class="has-header has-tabs"><div class="sharedContentErrorContainer" ng-if="hideSharedContentInIframe"><p><i class="space-rt icon icon-alert-tri-outline"></i><br>{{&apos;account.settings.error.nonetwork&apos;|translate}}</p><button class="btn-small" name="terms_and_conditions_refresh_button" ng-click="refreshButtonClick()" type="button"><i class="space-rt icon-refresh"></i> {{&apos;account.settings.button.refresh&apos;|translate}}</button></div></div><div class="iframe-container"><iframe class="iframe-content" id="{{iframeId}}" ng-class="{&apos;iframe-loaded&apos;: contentLoadedSuccessfully}" ng-src="{{iframeContentUrl}}" onload="if(window.onIframeContentLoaded) window.onIframeContentLoaded(event)"></iframe></div><div ng-class="{&apos;fixedFooter&apos;: hideSharedContentInIframe}"><a class="two-equal-column reject" id="rejecttandc" ng-click="rejectTermsAndConditions()" translate ng-show="isOnline">account.registration.link.reject</a> <a class="two-equal-column accept" id="accepttandc" ng-click="acceptTermsAndConditions()" translate ng-show="isOnline &amp;&amp; contentLoadedSuccessfully">account.registration.link.accept</a></div></div></ion-content><ion-content ng-if="isIOSWebView" scroll="false"><div class="t-and-c-with-buttons fixedFooterIOS" ng-controller="SharedContentInIframeController"><a class="two-equal-column reject" id="rejecttandc" ng-click="rejectTermsAndConditions()" translate>account.registration.link.reject</a> <a class="two-equal-column accept" id="accepttandc" ng-click="acceptTermsAndConditions()" translate ng-show="contentLoadedSuccessfully">account.registration.link.accept</a></div></ion-content></ion-modal-view>')}]),window.weatherModule=angular.module("WeatherModule",["ionic","CoreModule","AnalyticsModule","AccountModule"]),window.weatherModule.run(["$log",function(e){e=e.getInstance("Weather"),e.info("Module started")}]),window.weatherModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("weather")}]),window.weatherModule.routes={"weather-details":{url:"/weather-details/:tripId/:lastName/:firstName/:addressLine1/:addressLine2/:cityCode/:cityName/:code/:countryCode/:countryName/:latitude/:longitude/:name/:stateCode/:zip",templateUrl:"weather/templates/pages/WeatherDetailsView.html",controller:"WeatherDetailsController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Weather Details").promise()}]},ncyBreadcrumb:{label:"{{'weather.title.weather'|translate}}",parent:function(e){return e.trip||(e.trip={}),!e.trip.title&&isDefined(e.$state.params.tripId)&&(e.trip.title=e.$state.params.tripId),"trip-expanded"}}}},weatherModule.controller("WeatherDetailsController",["$scope","$rootScope","$log","$stateParams","WeatherService","$q","LayoutService","OrchestratorChiefService",function(e,t,n,i,a,r,o,s){n=n.getInstance("WeatherDetailsController"),n.info("Controller Started...");var l=3,c=function(e){return isDefined(e)&&""!==e?e:null},d={addressLine1:c(i.addressLine1),addressLine2:c(i.addressLine2),cityCode:c(i.cityCode),cityName:c(i.cityName),code:c(i.code),countryCode:c(i.countryCode),countryName:c(i.countryName),latitude:c(i.latitude),longitude:c(i.longitude),name:c(i.name),stateCode:c(i.stateCode),zip:c(i.zip)};e.location=d,e.locationName="",e.weatherSlides=[],e.pullToRefreshEnabled=getContext("applicationConfig.pullToRefreshEnabled",!0),e.isCurrencyConverterEnabled=getContext("featureConfig.currencyConverter.enabled",!1),e.pullToRefresh=function(){e.refreshWeather({forceFromServer:!0,fromPullToRefresh:!0})},e.refreshWeather=function(n){var i=r.defer();return n=n||{},o.startLoading(n.fromPullToRefresh),t.$emit("WeatherDetailsRefreshEvent"),a.getWeather(d,n).then(function(t){var r=angular.copy(t);e.weatherSlides=[],e.locationName=a.getLocationString(d);var s=function(t,n){t.length>0?(n.push(t[0]),t.shift(),n.length===l?(e.weatherSlides.push(n),s(t,[])):s(t,n)):n.length>0&&n.length<l?(n.push({isGeneric:!0}),s(t,n)):n.length>0&&e.weatherSlides.push(n)};s(r,[]),o.stopLoading(n.fromPullToRefresh,e),i.resolve()},function(t){o.stopLoading(n.fromPullToRefresh,e),o.toastError(t).then(function(){i.reject(t)})}),i.promise};var u=function(){e.refreshWeather().then(function(){},function(e){s.navigateBack()})};u()}]),weatherModule.directive("segmentWeather",["$log","$ionicHistory","WeatherService","I18nConfig","OrchestratorChiefService",function(e,t,n,i,a){return{restrict:"E",templateUrl:"weather/directives/SegmentWeatherDirective.html",controller:["$scope",function(e){}],scope:{location:"=",forceRefresh:"=",tripId:"=",lastName:"=",firstName:"="},link:function(i,r,o,s){i.$watch("location",function(){i.canNavigateToWeatherForecast=!1,i.locationName,i.temperature,i.weatherIcon="generique";var r=i.location;if(i.isCurrencySegmentShown=getContext("featureConfig.currencyConverter.enabled",!1),i.segmentLocation=r,isDefined(r)){i.locationName=n.getLocationString(r);var o={forceFromServer:i.forceRefresh===!0};n.getTodayWeather(r,o).then(function(e){i.temperature=safeAccess(e,"maxTemp"),i.weatherIcon=safeAccess(e,"weatherSummary.iconCode","generique"),i.canNavigateToWeatherForecast=!0},function(e){})}else e.error("No location provided to get the weather");i.navigateToWeather=function(){var e=t.currentView(),n="weather-details";if(!isDefined(e)||"past-trip-expanded"!==e.stateName&&"more-past-trip-expanded"!==e.stateName||(n="past-weather-details"),isDefined(r)&&i.canNavigateToWeatherForecast){var o=angular.merge(r,{tripId:i.tripId,lastName:i.lastName,firstName:i.firstName});a.navigateTo(n,o)}}})},toString:function(){return"segmentWeatherDirective"}}}]),weatherModule.service("WeatherService",["$log","$q","RequestService","DataManagerService","PromiseService","I18nConfig","TemperatureUnitService",function(e,t,n,i,a,r,o){e=e.getInstance("WeatherService"),e.info("Service Started...");var s={WEATHER_URL_PATH:"v1/trips/weatherForecast",MAX_DAYS_RETURNED:5,TODAY_INDEX:0,CACHE_TTL:getContext("featureConfig.weather.cache","2h"),getWeather:function(r,o){var l=t.defer();if(isDefined(r)){var c=s._getWeatherLSkey(r);if(o=o||{forceFromServer:!1},!o.forceFromServer&&isDefined(c)){var d=i.get(c,i.LOCALSTORAGE);if(d)return e.info("Resolving from storage"),l.resolve(d),l.promise}e.info("Resolving from server");var u={location:{addressLine1:r.addressLine1,addressLine2:r.addressLine2,cityCode:r.cityCode,cityName:r.cityName,code:r.code,countryCode:r.countryCode,countryName:r.countryName,latitude:r.latitude,longitude:r.longitude,name:r.name,stateCode:r.stateCode,zip:r.zip}};n.post(s.WEATHER_URL_PATH,u).then(function(e){var t=safeAccess(e,"data.success");if(t){var n=safeAccess(e,"data.weatherForecast");isDefined(c)&&i.set(n,c,{storage:i.LOCALSTORAGE,belongsToUser:!1,ttl:s.CACHE_TTL}),l.resolve(n)}else a.rejectDueToBackendError({deferred:l,response:e,method:"getWeather"})},function(e){a.rejectDueToHttpError({deferred:l,response:e,method:"getWeather"})})["catch"](handleUnexpectedError)}else l.reject("Location is null");return l.promise},getTodayWeather:function(e,n){var i=t.defer();return s.getWeather(e,n).then(function(e){e.length>s.TODAY_INDEX?i.resolve(e[s.TODAY_INDEX]):i.reject("No weather for today")},function(e){i.reject(e)}),i.promise},getLocationString:function(e){if(e){var t=safeAccess(e,"cityName"),n=safeAccess(e,"name"),i=safeAccess(e,"addressLine1"),a=safeAccess(e,"addressLine2");if(isDefined(t)){if(isDefined(n))return s._prefixWithCityIfNeeded(t,n);if(isDefined(i)){var r=i+(isDefined(a)?" "+a:"");return s._prefixWithCityIfNeeded(t,r)}return t}if(isDefined(n))return n;if(isDefined(i))return i+(isDefined(a)?" "+a:"")}return null},_prefixWithCityIfNeeded:function(e,t){return-1!==t.indexOf(e)?t:e+" : "+t},_getWeatherLSkey:function(e){var t=[];e=e||{};var n=["cityCode","cityName","code","latitude","longitude","name","zip"];n.forEach(function(n){var i=e[n];isDefined(i)&&""!==i&&t.push(i)});var i;return t.length>0&&(i="weather_"+t.join("-")),i},shouldDisplayInFahrenheit:function(){return o.isTemperatureFahrenheit()},toString:function(){return"WeatherService"}};return s}]),weatherModule.filter("temperatureLocale",["WeatherService",function(e){return function(t){if(t=t||{},isDefined(t.value)&&isDefined(t.unit)){var n=e.shouldDisplayInFahrenheit();if(n&&"C"===t.unit){var i=convertCelsiusToFahrenheit(t.value);return Math.round(i)}if(n||"F"!==t.unit)return Math.round(t.value);var a=convertFahrenheitToCelsius(t.value);return Math.round(a)}return"-"}}]),weatherModule.filter("temperatureUnitLocale",["WeatherService",function(e){return function(t){return t=t||{},isDefined(t.unit)?e.shouldDisplayInFahrenheit()?"°F":"°C":"-"}}]),weatherModule.run(["$templateCache",function(e){e.put("weather/directives/SegmentWeatherDirective.html",'<section class="weather-widget" debug-file-path="SegmentWeatherDirective.html" ng-click="navigateToWeather()"><div class="container"><h2><span ng-bind-html="locationName | trustAsHtml"></span> - <span translate>weather.label.today</span></h2><div class="cmt-row"><i class="weather-icon-{{weatherIcon}} weather-temp-icon"></i><p class="weather-temp">{{temperature | temperatureLocale}}<span ng-if="temperature">{{temperature | temperatureUnitLocale}}</span></p><p class="weather-currency-converter"><i class="icon-chevron-right-rounded weather-chevron-right" ng-if="canNavigateToWeatherForecast"></i></p></div><currency-segment ng-if="isCurrencySegmentShown" segment-location="segmentLocation"></currency-segment></div></section>'),e.put("weather/templates/pages/WeatherDetailsView.html",'<ion-view debug-file-path="WeatherDetailsView.html"><ion-nav-title translate>weather.title.weather</ion-nav-title><ion-content><ion-refresher ng-if="pullToRefreshEnabled" on-refresh="pullToRefresh()" pulling-text="{{&apos;weather.label.pullToRefresh&apos;|translate}}" spinner="lines"></ion-refresher><div class="hero weather-details-hero"></div><div class="contained-pad"><section class="weather-panel"><header class="weather-panel-header"><h1 ng-bind-html="locationName | trustAsHtml"></h1></header><section class="weather-details"><ion-slides slider="data.slider"><ion-slide-page ng-repeat="weatherSlide in weatherSlides"><div class="three-column-weather"><div ng-if="!weatherDay.isGeneric" ng-repeat-start="weatherDay in weatherSlide"><h4 class="wd-day">{{weatherDay.forecastDateTime | dayOfWeek}}</h4><h6 class="wd-date">{{weatherDay.forecastDateTime | dayAndMonth}}</h6><i class="wd-weather-icon weather-icon-{{weatherDay.weatherSummary.iconCode}}"></i><p class="wd-temp-highter">{{weatherDay.maxTemp | temperatureLocale}}<span class="wd-temp-highter-symbol">{{weatherDay.maxTemp | temperatureUnitLocale}}</span></p><p class="wd-temp-lower">{{weatherDay.minTemp | temperatureLocale}}{{weatherDay.minTemp | temperatureUnitLocale}}</p><p class="wd-weather-description">{{weatherDay.weatherSummary.shortDescription}}</p></div><div ng-if="weatherDay.isGeneric"><h4 class="wd-day">&#xA0;</h4><h6 class="wd-date">&#xA0;</h6><i class="wd-weather-icon weather-icon-default"></i><p class="wd-weather-description" translate>weather.label.comingSoon</p></div><hr ng-repeat-end></div></ion-slide-page></ion-slides></section></section></div><currency-converter ng-if="isCurrencyConverterEnabled" segment-location="location"></currency-converter></ion-content></ion-view>')}]),window.advertisementModule=angular.module("AdvertisementModule",["ionic","CoreModule","AnalyticsModule"]),window.advertisementModule.config(["$translatePartialLoaderProvider",function(e){}]),window.advertisementModule.run(["$log",function(e){e=e.getInstance("Advertisement"),e.info("Module started")}]),advertisementModule.controller("AdvertisementController",["$scope","LayoutService","$log","$ionicModal","AdvertisementService","$timeout","$q","DataManagerService","AdvertisementAnalyticsService",function(e,t,n,i,a,r,o,s,l){n=n.getInstance("AdvertisementController"),n.info("Controller Started..."),e.automaticHidingTimeout=null,e.advertisementModal=null,e.advertisementData=null,e.clickAdvertisement=function(){window.open(e.advertisementData.refUrl,"_system"),l.adClicked("interstitial")};var c=function(n){r.cancel(e.automaticHidingTimeout),t.removeModal(e.advertisementModal),n.resolve()};e.displayInterstitialAdvertisement=function(d){var u=o.defer(),g="interstitial",p=[{id:"home",page:"home",type:g,tripId:d}],m={sendGeolocation:getContext("featureConfig.homeAdvertisement.sendGeolocation"),requestTimeout:getContext("featureConfig.homeAdvertisement.requestTimeout")};return a.getAdvertisement(p,m).then(function(o){var d=o[0];if(isDefined(d.mediaUrl)&&isDefined(d.refUrl)){e.advertisementData=d;var p=+moment(),m=a.LAST_DISPLAY_DATE_KEY+g;n.info("storing last ad displayed date ["+p+"] in localStorage"),s.set(p,m,{storage:s.LOCALSTORAGE}),i.fromTemplateUrl("advertisement/templates/partial/fullScreenAdvertisement.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.advertisementModal=n,e.clickCloseAdvertisement=function(){c(u)},t.showModal(n).then(function(){e.automaticHidingTimeout=r(function(){c(u)},getContext("featureConfig.homeAdvertisement.autoHideTimeout",7e3))}),l.adDisplayed("interstitial")})}else n.info("Not displaying the interstitial advertisement because mediaUrl or refUrl is not defined")},function(e){u.reject(e)}),u.promise}}]),advertisementModule.service("AdvertisementService",["$log","$q","RequestService","PromiseService","$window","NetworkService","I18nConfig","AppLifeCycleService","AdvertisementAnalyticsService","LayoutService","AppPermissionsService",function(e,t,n,i,a,r,o,s,l,c,d){e=e.getInstance("AdvertisementService"),e.info("Service Started...");var u={ADSERVER_GET_ADS_URL_PATH:"v2/trips/ads",LAST_DISPLAY_DATE_KEY:"lastAdDisplayedDate",_generatePayload:function(n,i){n=n||[],i=i||{},i.sendGeolocation!==!1&&(i.sendGeolocation=!0);var l=t.defer();return s.onAppReady(function(){var t={device:{networkType:r.getNetworkType()},adsRequests:[],language:o.getCurrentAmadeusLanguage()};n.forEach(function(e){t.adsRequests.push({id:e.id,page:isDefined(e.tripId)?e.page+"WithContext":e.page,adType:e.type,recLoc:isDefined(e.tripId)?e.tripId:null,resolution:a.innerWidth+"x"+a.innerHeight})});var s=safeAccess(navigator,"geolocation");if(i.sendGeolocation&&isDefined(s)){var c=function(n){var i=n.coords.longitude,a=n.coords.latitude,r=n.coords.accuracy;isDefined(i)&&isDefined(a)&&isDefined(r)&&75e3>r?t.device.geoposition={longitude:i,latitude:a}:e.warn("Not sending geolocation for advertisement because:\nlongitude, latitude or accuracy is not defined OR accuracy > 75kms");var o="http://maps.google.com/?q="+n.coords.latitude+","+n.coords.longitude;e.info("Geolocation for ad:\nLatitude: "+n.coords.latitude+"\nLongitude: "+n.coords.longitude+"\nAltitude: "+n.coords.altitude+"\nAccuracy: "+n.coords.accuracy+"\nAltitude Accuracy: "+n.coords.altitudeAccuracy+"\nHeading: "+n.coords.heading+"\nSpeed: "+n.coords.speed+"\nTimestamp: "+n.timestamp+"\nCheck your location: "+o+"\n"),l.resolve(t)},u=function(n){e.warn("Cannot get geolocation for advertisement: ",n.code,n.message),l.resolve(t)},g={maximumAge:9e4,timeout:2e3,enableHighAccuracy:!1};d.checkAndProvidePermission([d.permissionFineLocation,d.permissionCoarseLocation]).then(function(e){e?navigator.geolocation.getCurrentPosition(c,u,g):u({code:-1,message:"permission not allowed"})},function(){u({code:-1,message:"permission plugin failed"})})}else l.resolve(t)}),l.promise},getAdvertisement:function(e,i){i=i||{};var a,r=t.defer();return isDefined(i.requestTimeout)&&(a={timeout:i.requestTimeout}),u._generatePayload(e,i).then(function(e){var t=n.post(u.ADSERVER_GET_ADS_URL_PATH,e,a);t.then(function(t){u._getAdvertisementSuccessCallback(t,e,r)},function(t){u._getAdvertisementFailureCallback(t,e,r)})}),r.promise},onAdBannerClick:function(e){l.adClicked(e.type);var t=e.link;isDefined(t)&&c.openInExternalBrowser(t)},_getAdvertisementSuccessCallback:function(e,t,n){var a=safeAccess(e,"data",{});isDefined(a.adsResponses)&&a.adsResponses.length>0?n.resolve(a.adsResponses):isDefined(a.errorCodes)?i.rejectDueToBackendError({deferred:n,response:e,payload:t,method:"getAdvertisement"}):n.reject("no ads to display")},_getAdvertisementFailureCallback:function(e,t,n){isUndefined(e.data)&&(e.status=-1,e.statusText="Timeout"),i.rejectDueToHttpError({deferred:n,response:e,payload:t,method:"getAdvertisement"})},toString:function(){return"AdvertisementService"}};return u}]),advertisementModule.service("AdvertisementAnalyticsService",["$log","AnalyticsService",function(e,t){e=e.getInstance("AdvertisementAnalyticsService"),e.info("Service Started...");var n={CATEGORY:"Monetization",EVENTS:{adDisplayed:"Ad displayed",adClicked:"Ad clicked"},adDisplayed:function(e,t){n._sendEvent(n.EVENTS.adDisplayed,e,t)},_sendEvent:function(e,i,a){t.runSafe(function(){var r=t.getPropertiesFactory();r.create("Ad Type",i).flagMarketing().push(),r.create("Campaign URL",a).flagMarketing().push(),this.sendEvent(e,r.build(),n.CATEGORY)})},adClicked:function(e,t){n._sendEvent(n.EVENTS.adClicked,e,t)}};return n}]),advertisementModule.service("JsAdvertisementService",["$log","$q","RequestService","PromiseService","I18nConfig","AdvertisementAnalyticsService",function(e,t,n,i,a,r){e=e.getInstance("JsAdvertisementService"),e.info("Service Started...");var o={SCREEN_MAPPING:{timeline:"1200",timelineWithContext:"1201",tripDetails:"1202",tripDetailsWithContext:"1203",tripDetailsDesktop:"1206",tripDetailsDesktopWithContext:"1206"},PRODUCT_MAPPING:{billboard:"W22",leaderboard:"W08"},_generateUrlAndParameters:function(e){e=e||{};var t={};t.PT=o.PRODUCT_MAPPING[e.type];var n=isDefined(e.tripId)?e.page+"WithContext":e.page;t.ST=o.SCREEN_MAPPING[n],t.MD="JSCLKD";var i=getContext("SITECODE","NCMTNCMT");i=8===i.length?i.substr(4,4):void 0,t.WL=i,t.LN=a.getCurrentAmadeusLanguage(),t.PNR=e.tripId,t.DIV=e.adContainerId;var r=getContext("featureConfig.jsAdvertisement.advServer","https://mediasolutions.amadeus.net/");return r+="1ASIHADV/ADVRAD/GetBannerContent.html",{url:r,parameters:t}},getAdvertisement:function(e,i){i=i||{};var a=t.defer(),s={};isDefined(i.requestTimeout)&&(s.timeout=i.requestTimeout);var l=o._generateUrlAndParameters(e);s.params=l.parameters;var c=n.get(l.url,null,s);return c.then(function(t){r.adDisplayed(e.type),o._getAdvertisementSuccessCallback(t,e,a)},function(e){o._getAdvertisementFailureCallback(e,a)}),a.promise},resetAdvertisementModel:function(e){if(e=e||{},isDefined(e.scriptContainerId)){var t=document.getElementById(e.scriptContainerId);t&&(t.innerHTML="")}return{hasAdvertisement:!1,cardStyle:{height:"0"},isImage:!1,isJavascript:!1,advertisementSrc:null,scriptContainerId:safeAccess(e,"scriptContainerId",""),adContainerId:safeAccess(e,"adContainerId",""),link:null}},reInjectAdvertisement:function(e){if(isDefined(e)){var t=o._injectAdvertisement(e.jsScript,e.adContainerId,e.scriptContainerId);return isDefined(t)?t:e}},_injectAdvertisement:function(e,t,n){var i=document.getElementById(n);if(i&&isDefined(e)){var a={hasAdvertisement:!0,scriptContainerId:n,adContainerId:t,cardStyle:{height:"166px"},isJavascript:!0,jsScript:e};i.innerHTML="";var r=document.createElement("div");r.id=t,i.appendChild(r);var o=document.createElement("script");return o.setAttribute("type","text/javascript"),o.innerHTML=e,i.appendChild(o),a}},_getAdvertisementSuccessCallback:function(e,t,n){var i=e.data||"";i=i.trim();var a=o._injectAdvertisement(""!==i?i:null,t.adContainerId,t.scriptContainerId);n.resolve(a)},_getAdvertisementFailureCallback:function(e,t){isUndefined(e.data)&&(e.status=-1,e.statusText="Timeout"),i.rejectDueToHttpError({deferred:t,response:e,payload:null,method:"getAdvertisement"})},toString:function(){return"JsAdvertisementService"}};return o}]),advertisementModule.run(["$templateCache",function(e){e.put("advertisement/templates/partial/fullScreenAdvertisement.html",'<ion-modal-view class="fullScreenAdvertisementView" debug-file-path="fullScreenAdvertisement.html"><div class="homeAdvertisement"><button id="full-screen-ad-close" ng-click="clickCloseAdvertisement()">X</button> <img class="imgAd" ng-click="clickAdvertisement()" ng-src="{{advertisementData.mediaUrl}}"></div></ion-modal-view>')}]),window.itmngtModule=angular.module("ItmngtModule",["ionic","CoreModule","CoreUiModule","AccountModule","AnalyticsModule","WeatherModule","AdvertisementModule","ngProgress"]),window.itmngtModule.run(["$log","ItmngtOrchestratorService","FileSystemFactory","$rootScope","$controller","AddTripMenuHandler","UngroupTripMenuHandler","DeleteTripMenuHandler","AddToCalendarMenuHandler","ShareTripInfoMenuHandler","PrintTripMenuHandler","TriplistService",function(e,t,n,i,a,r,o,s,l,c,d,u){e=e.getInstance("Itmngt"),e.info("Module started"),t.init(),u.init(),n.init(),r.init(),o.init(),s.init(),l.noop(),c.init(),d.init()}]),window.itmngtModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("itmngt")}]),window.itmngtModule.routes={triplist:{url:"/triplist",templateUrl:"itmngt/templates/pages/TriplistView.html",controller:"TriplistController",secured:!0,resolve:{analytics:["AnalyticsService","TripAnalyticsService",function(e,t){return e.screenView("Triplist",[],t.CATEGORY).promise()}]},ncyBreadcrumb:{label:"{{'itmngt.title.feed'|translate}}"}},pastTrips:{url:"/pastTrips",templateUrl:"itmngt/templates/pages/PastTripsView.html",controller:"PastTripsController",secured:!0,resolve:{analytics:["AnalyticsService","TripAnalyticsService",function(e,t){return e.screenView("PastTrips",[],t.CATEGORY).promise()}]},ncyBreadcrumb:{label:"{{'itmngt.title.loadPastTrips'|translate}}"}},"trip-expanded":{url:"/trip-expanded/:tripId/:lastName/:firstName",params:{firstName:{value:null,squash:!0},lastName:{value:null,squash:!0},forceRefreshTripDetails:!1,forceRefreshFlightStatus:!1},templateUrl:"itmngt/templates/pages/TripExpandedView.html",controller:"TripExpandedController",defaultBackState:"triplist",secured:!0,resolve:{analytics:["TripAnalyticsService","$stateParams",function(e,t){return e.tripDetailsView({tripId:t.tripId,lastName:t.lastName})}]},ncyBreadcrumb:{label:"{{trip.title}}",parent:"triplist"}},"segment-expanded":{url:"/segment-expanded/:tripId/:lastName/:firstName/:segmentRefId",templateUrl:"itmngt/templates/pages/SegmentExpandedView.html",controller:"SegmentExpandedController",defaultBackState:"triplist",secured:!0,resolve:{analytics:["TripAnalyticsService","$stateParams","FlightStatusService",function(e,t,n){return e.segmentDetailsView({tripId:t.tripId,lastName:t.lastName,segmentRefId:t.segmentRefId},n)}]},ncyBreadcrumb:{label:"{{segment.title}}",parent:"trip-expanded"}}},window.itmngtModule.routes["t-e"]=angular.copy(window.itmngtModule.routes["trip-expanded"]),window.itmngtModule.routes["t-e"].url=window.itmngtModule.routes["t-e"].url.replace("trip-expanded","t-e"),
itmngtModule.service("FlightStatusService",["$log","$q","RequestService","I18nService","DataManagerService","DateTimeService",function(e,t,n,i,a,r){e=e.getInstance("FlightStatus"),e.info("Service Started...");var o=getContext("featureConfig.flightStatus.queryEnd","24h"),s={FLIGHT_STATUS_URL_PATH:"v1/trips/flightStatus",_getKeyFromSegmentRefId:function(e){return"FS_"+e},getCachedFlightStatus:function(e,t){var n,i=s._getKeyFromSegmentRefId(e);return n=t?a.getStoredDate(i,a.LOCALSTORAGE):a.get(i,a.LOCALSTORAGE)},_setInCacheAndLocalStorage:function(e,t,n){n?n.storage=a.CACHE:n={storage:a.CACHE};var i=a.set(e,t,n);n.storage=a.LOCALSTORAGE;var r=a.set(e,t,n);return i&&r},canCallSegmentFlightStatus:function(e){var t=!1,n=getContext("featureConfig.flightStatus.enabled",!0);if(n&&e&&"AIR"===e.type.toUpperCase()){var i=e.endDate,a=s.getCachedFlightStatus(e.refId);a&&a.forEach(function(e){"AY"===e.status&&isDefined(e.estimatedArrival)&&(i=e.estimatedArrival)});var l=r.getMomentFromBackendDate(i).diff(),c=r.decodeTTL(o);t=l>-c}return t},getSegmentStatus:function(e,i){if("AIR"!==e.type.toUpperCase())throw"Segment is not an air segment";var a=t.defer();if(!i){var o=s.getCachedFlightStatus(e.refId);if(isDefined(o)&&o.length>0){var l=r.getMomentFromBackendDate(e.startDate).diff(moment()),c=l>r.decodeTTL("3d");if(c){var d=s.getCachedFlightStatus(e.refId,!0);d.diff()<-r.decodeTTL("24h")?i=!0:a.resolve(o)}else i=!0}else i=!0}if(i===!0){var u={flightNumber:safeAccess(e,"flight.flightNumber"),carrier:safeAccess(e,"flight.airlineCode"),boardPoint:e.fromLocation.code,departureDateTime:e.startDate,departureGate:e.departureGate,departureTerminal:e.departureTerminal,offPoint:e.toLocation.code,arrivalDateTime:e.endDate,arrivalTerminal:e.arrivalTerminal},g=n.post(s.FLIGHT_STATUS_URL_PATH,u);g.then(function(t){s._flightStatusSuccessCallback(e,t,a)},function(t){s._flightStatusFailureCallback(e,t,a)})}return a.promise},getLayoverSegmentsToUpdate:function(e){var t=[];return e.forEach(function(n,i){var a=null;if("LAYOVER"===n.segment.type.toUpperCase()&&(a=n.segment),null!=a){var r,o=null;e.forEach(function(e,t){e.segment.refId===a.layoverRefIds[0]&&(r=e.segment),e.segment.refId===a.layoverRefIds[1]&&(o=e.segment)}),s._hasAtLeastOneDepartureOrArrivalDelays(r,o)&&(a.duration=s._getEstimatedDuration(a,r,o),t.push(a))}}),t},_hasAtLeastOneDepartureOrArrivalDelays:function(e,t){return null!=e.estimatedArrivalDate||null!=e.scheduledArrivalDate||null!=t.estimatedDepartureDate||null!=t.scheduledDepartureDate},_getRealStartDate:function(e){return null!=e.estimatedDepartureDate?e.estimatedDepartureDate:null!=e.scheduledDepartureDate?e.scheduledDepartureDate:e.startDate},_getRealEndDate:function(e){return null!=e.estimatedArrivalDate?e.estimatedArrivalDate:null!=e.scheduledArrivalDate?e.scheduledArrivalDate:e.endDate},_getEstimatedDuration:function(e,t,n){var i=s._getRealEndDate(t),a=s._getRealStartDate(n);return r.getDurationFromBackendDates(i,a)},_flightStatusSuccessCallback:function(t,n,r){var o=n.data;if(isDefined(o))if(o.success)isDefined(o.changes)||(o.changes=[]),s._setInCacheAndLocalStorage(o.changes,s._getKeyFromSegmentRefId(t.refId),{storage:a.LOCALSTORAGE,ttl:a.INFINITE,belongsToUser:!0}),r.resolve(o.changes);else{e.backendError(o);var l=safeAccess(n,"data.errorCodes");i.translateBackendErrorCodes(l).then(function(e){r.reject({errors:e,previousFlightStatus:s.getCachedFlightStatus(t.refId)})})}else r.reject("No data received")},_flightStatusFailureCallback:function(t,n,a){e.httpError(n),i.translateHttpStatusCode(n.status).then(function(e){a.reject({errors:e,httpErrorCode:n.status,previousFlightStatus:s.getCachedFlightStatus(t.refId)})})},setStatusChangedItem:function(e,t,n){var i=s.getCachedFlightStatus(e);if(isDefined(i)&&i.length>0){var a=i.filter(function(e){return e.status!==t});i=a}else i=[];var r={status:t,data:n||null};i.push(r),s._setInCacheAndLocalStorage(i,s._getKeyFromSegmentRefId(e))},deleteStatusChangedFromAllSegments:function(e,t){e.forEach(function(e){s._deleteStatusChangedItem(e.refId,t)})},_deleteStatusChangedItem:function(e,t){var n=s.getCachedFlightStatus(e);if(isDefined(n)&&n.length>0){var i=n.filter(function(e){return e.status!==t});s._setInCacheAndLocalStorage(i,s._getKeyFromSegmentRefId(e))}},toString:function(){return"FlightStatusService"}};return s}]),itmngtModule.service("TriplistService",["TriplistCacheService","DataManagerService","AuthenticationService","$log","$rootScope","RequestService","$q","PromiseService","TripService","TripAnalyticsService","DateTimeService",function(e,t,n,i,a,r,o,s,l,c,d){i=i.getInstance("TriplistService"),i.info("Service Started...");var u={TRIPLIST_REFRESH_ON_NEXT_DISPLAY_KEY:"refreshTriplistOnNextDisplay",TRIPLIST_REFRESH_URL_PATH:"v1/trips/triplistRefresh",init:function(){a.$on("userLoggedEvent",function(e,t){var n=safeAccess(t,"triplist.trips",[]),i=u._sortTriplist(n);c.updatePropertyAndParameters(i.upcomingTrips,i.pastTrips)})},_getTriplist:function(t){var d=o.defer();t=t||{forceFromServer:!1};var g=e.getCachedTripList(t.triplistTimeWindow);if(!t.forceFromServer&&g)return i.info("resolving from storage or memory"),g=u._filterAndSortTriplist(g),d.resolve(g),d.promise;var p=isDefined(t.triplistTimeWindow)&&getContext("featureConfig.timeline.splitTripList",!1)?{triplistTimeWindow:t.triplistTimeWindow}:{};return n.isLogged()?r.post(u.TRIPLIST_REFRESH_URL_PATH,p).then(function(n,r){if(r)m=u._filterAndSortTriplist(e.getCachedTripList(t.triplistTimeWindow)),d.resolve(m);else{var p=safeAccess(n,"data.success");if(p){i.info("_getTriplist: resolving from network");var m=safeAccess(n,"data.triplist.trips",[]),f=e.cacheTripList(m,t.triplistTimeWindow);c.addedOutsideApp(g,m);var v=[];for(var h in f.tripsToDownload){var S=f.tripsToDownload[h];i.info("_getTriplist: trip "+S.tripId+" has to be downloaded because it has a new version, or we did not have tripDetails"),v.push(l.retrieveTrip(S.tripId,S.bookingLastName,{forceFromServer:!0}))}m=u._filterAndSortTriplist(e.getCachedTripList(t.triplistTimeWindow)),d.resolve(m),a.$emit("triplistUpdatedFromServerEvent",m),0===v.length&&v.push(o.when(!0)),c.updatePropertyAndParameters(m.upcomingTrips,m.pastTrips),o.all(v)["finally"](function(){var n=u._filterAndSortTriplist(e.getCachedTripList(t.triplistTimeWindow));a.$emit("triplistUpdatedFromServerWithTripDetailsEvent",n)})}else s.rejectDueToBackendError({deferred:d,response:n,method:"_getTriplist"})}},function(e){s.rejectDueToHttpError({deferred:d,response:e,method:"_getTriplist"})})["catch"](handleUnexpectedError):d.reject("You are not logged"),d.promise},_sortTriplist:function(e){var t=[],n=[];return e.forEach(function(e){l.isPastTrip(e)?t.push(e):n.push(e)}),t.sort(l.sortTripByDateASC),n.sort(l.sortTripByDateASC),i.returns({pastTrips:t,upcomingTrips:n})},_filterTriplist:function(e){var t=e.filter(l.isSupportedTrip);return t},_filterAndSortTriplist:function(e){var t=u._filterTriplist(e),n=u._sortTriplist(t);return n},getFullTripList:function(e){var t=o.defer();return e=e||{},e.triplistTimeWindow=void 0,u._getTriplist(e).then(function(e){var n=[];n=n.concat(e.pastTrips),n=n.concat(e.upcomingTrips),t.resolve({trips:n})},function(e){t.reject(e)}),t.promise},getUpcomingTripList:function(e){var t=o.defer();return e=e||{},e.triplistTimeWindow="Future",u._getTriplist(e).then(function(e){t.resolve({trips:e.upcomingTrips})},function(e){t.reject(e)}),t.promise},getPastTripList:function(e){var t=o.defer();return e=e||{},e.triplistTimeWindow="Past",u._getTriplist(e).then(function(e){t.resolve({trips:e.pastTrips})},function(e){t.reject(e)}),t.promise},getFirstOngoingOrUpcoming:function(e){var t=o.defer();return u.getUpcomingTripList({forceFromServer:!1}).then(function(n){var i=null;if(n.trips.length>0&&(i=n.trips[0],isDefined(e))){var a=d.getMomentFromBackendDate(i.startDate),r=a.diff(moment()),o=d.decodeTTL(e);r>o&&(i=null)}t.resolve(i)},function(){t.resolve(null)}),t.promise},refreshTriplistOnNextDisplay:function(){t.set(!0,u.TRIPLIST_REFRESH_ON_NEXT_DISPLAY_KEY,{storage:t.LOCALSTORAGE})},shouldRefreshTriplistOnNextDisplay:function(){var e=t.get(u.TRIPLIST_REFRESH_ON_NEXT_DISPLAY_KEY,t.LOCALSTORAGE);return t.set(!1,u.TRIPLIST_REFRESH_ON_NEXT_DISPLAY_KEY,{storage:t.LOCALSTORAGE}),e===!0},toString:function(){return"TriplistService"}};return u}]),itmngtModule.service("TriplistCacheService",["DataManagerService","$log","DateTimeService",function(e,t,n){t=t.getInstance("TriplistCacheService"),t.info("Service Started...");var i="Triplist",a={TRIPLIST_STORAGE_KEY:i,SUPPORTED_TRIP_LIST_TYPES:["Past","Future"],TRIP_STORAGE_OPTIONS:{storage:e.LOCALSTORAGE,ttl:e.INFINITE,languageDependent:!0,belongsToUser:!0},_getKeyFromTripId:function(e){return"trip_"+e},isPastTrip:function(e,t,i){t=t||moment(),i=i||getContext("featureConfig.timeline.considerPastTripAfter");var a=n.getMomentFromBackendDate(e.endDate);if(isDefined(i)){var r=n.decodeTTL(i);a.add(r,"ms")}return t>a},addTripToCache:function(e){var t=!1,n=a.isPastTrip(e)?"Past":"Future",r=a.getCachedTriplistAssociation(n);return r||(r=[]),-1===r.indexOf(e.tripId)&&r.push(e.tripId),a._cacheTrip(e)&&(t=a._setInCacheAndLocalStorage(r,i+n,a.TRIP_STORAGE_OPTIONS)),t},removeTripFromCache:function(e,t){var n=a.getCachedTriplistAssociation(t);if(n){var r=n.indexOf(e);r>-1&&(n.splice(r,1),a._setInCacheAndLocalStorage(n,i+t,a.TRIP_STORAGE_OPTIONS))}a._deleteCachedTrip(e)},getCachedTriplistAssociation:function(t){var n,r=isDefined(t)?[t]:a.SUPPORTED_TRIP_LIST_TYPES;return r.forEach(function(t){var a=e.get(i+t,e.LOCALSTORAGE);a&&(n=n?n.concat(a):a)}),n},getCachedTripList:function(e){var t=null,n=a.getCachedTriplistAssociation(e);if(isDefined(n)){for(var i=[],r=0;r<n.length;r++){var o=n[r],s=a.getCachedTrip(o);s&&i.push(s)}t=i}return t},getCachedTrip:function(t){var n=a._getKeyFromTripId(t),i=e.get(n,e.LOCALSTORAGE);return i},getFolderContainingTrip:function(e){var t=a.getCachedTripList();if(t)for(var n=0;n<t.length;n++)if(a.isFolder(t[n])&&a._isTripPartOfFolder(t[n],e))return t[n]},_isTripPartOfFolder:function(e,t){return safeAccess(e,"associatedRecords",[]).some(function(e){return e===t})},isFolder:function(e){return isDefined(e.isFolder)?e.isFolder:isDefined(e.tripId)&&10===e.tripId.length},cacheTripList:function(e,n){var r=isDefined(e),o=[];if(r){var s={Future:[],Past:[]};e.forEach(function(e){a.isPastTrip(e)?s.Past.push(e.tripId):s.Future.push(e.tripId);var t=a._cacheTrip(e);t.hasToBeDownloaded&&o.push(e)});var l=a.getCachedTriplistAssociation(n);s.full=[].concat(s.Past,s.Future),isDefined(l)&&l.filter(function(e){-1===s.full.indexOf(e)&&a._deleteCachedTrip(e)});var c=isDefined(n)?[n]:a.SUPPORTED_TRIP_LIST_TYPES;c.forEach(function(e){r=a._setInCacheAndLocalStorage(s[e],i+e)&&r})}return t.returns({success:r,tripsToDownload:o})},_cacheTrip:function(e){var i=!1,r=!1,o=a.getCachedTrip(e.tripId);if(o){var s=!!e.tripDetails,l=!!o.tripDetails,c=n.isSameBackendDate(e.lastModifiedDate,o.lastModifiedDate),d=c&&!l&&!s,u=c&&l&&!s,g=!c&&l&&!s,p=a.isPastTrip(e),m=safeAccess(e,"toLocation.imageSet");o.toLocation=o.toLocation||{},isDefined(m)&&(o.toLocation.imageSet=safeAccess(e,"toLocation.imageSet"),i=a._setInCacheAndLocalStorage(o,a._getKeyFromTripId(o.tripId),a.TRIP_STORAGE_OPTIONS)),u?i=!0:g||d&&!p?r=!0:(angular.extend(o,e),e=o,i=a._setInCacheAndLocalStorage(e,a._getKeyFromTripId(e.tripId),a.TRIP_STORAGE_OPTIONS))}else i=a._setInCacheAndLocalStorage(e,a._getKeyFromTripId(e.tripId),a.TRIP_STORAGE_OPTIONS),r=!0;return t.returns({success:i,hasToBeDownloaded:r})},_deleteCachedTrip:function(n){e.remove(a._getKeyFromTripId(n),e.LOCALSTORAGE),t.info("_deleteCachedTrip trip "+n+" deleted from cache and localstorage")},_setInCacheAndLocalStorage:function(t,n,i){i||(i=a.TRIP_STORAGE_OPTIONS);var r=e.set(t,n,i);return r},getLastServerCallDate:function(t){var n=e.getStoredDate(i+t,e.LOCALSTORAGE);return n},removeTripOnlyFromCache:function(n){e.remove(a._getKeyFromTripId(n),e.CACHE),t.info("removeTripOnlyFromCache trip "+n+" deleted from cache")},toString:function(){return"TriplistCacheService"}};return a}]),window.injectedCssClasses=[],window.injectedDestinationImages=[],itmngtModule.service("ImagesService",["RequestService","$q","$log","DataManagerService","$rootScope","FileSystemFactory","DateTimeService",function(e,t,n,i,a,r,o){return n=n.getInstance("ImagesService"),n.info("Service Started..."),a.$on("userLoggedOutEvent",function(e){var t=document.getElementsByTagName("head")[0];window.injectedCssClasses.forEach(function(e){t.removeChild(document.getElementById(e))}),window.injectedCssClasses=[],window.injectedDestinationImages=[]}),{CARD_SIZE_XS:"300x200",CARD_SIZE_S:"600x400",CARD_SIZE_M:"900x600",CARD_SIZE_L:"1200x800",CARD_SIZE_XL:"1500x1000",CARD_SIZE_XXL:"2000x1333",getImage:function(e,i){var a=t.defer();if(isDefined(e)&&""!==e)if(ionic.Platform.isIOS())a.resolve(e);else{var o=this._getFileSystemPath(e);r.getFileEntry(o).then(function(e){a.resolve(e.toURL())},function(){i===!0&&(getContext("isMobileApp")||r.grantedBytes()>0)?r.downloadRemoteFileToFileSystem(e,o).then(function(e){a.resolve(e)},function(t){n.warn("Can't get the image:"+e),a.reject(t)}):a.resolve(e)})}else a.reject("Image path is empty");return a.promise},getTripImage:function(e,t){t=t||this.CARD_SIZE_S;var n=safeAccess(e,"toLocation.imageSet.imageUrls."+t),i=null;if(n){var a=n.split(";");if(a.length>0){var r=o.getMomentFromBackendDate(e.startDate),s=(r.date()+r.month())%a.length;i=a[s]}}return i},getCompanyLogoImage:function(e,n){var i=t.defer(),a=safeAccess(e,"200x200");return isDefined(a)?this.getImage(a,n).then(function(e){i.resolve(e)},function(e){i.reject(e)}):i.reject("No airline logo defined"),i.promise},injectCardBackground:function(e,t){if(-1===window.injectedCssClasses.indexOf(e)){window.injectedCssClasses.push(e);var n={},i="linear-gradient(to bottom, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.4) 100%), url("+t+") !important";n["."+e]={"background-image":i},injectCSSInHead(n,e)}},getAndInjectCardImage:function(e,n,i){var a=t.defer();i=i||this.CARD_SIZE_S;var r=this.getTripImage(e,i);if(isDefined(r)){var o=this._getCardCssClass(r);if(window.injectedDestinationImages.indexOf(o)>-1)a.resolve({cssClassName:o});else{window.injectedDestinationImages.push(o);var s=this;this.getImage(r,n).then(function(e){s.injectCardBackground(o,e),a.resolve({cssClassName:o})},function(e){var t=window.injectedDestinationImages.indexOf(o);t>-1&&window.injectedDestinationImages.splice(t,1),a.reject(e)})}}else a.reject("No image available");return a.promise},getCardCssClass:function(e,t){t=t||this.CARD_SIZE_S;var n=null,i=this.getTripImage(e,t);return isDefined(i)&&(n=this._getCardCssClass(i)),n},_getCardCssClass:function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("."),i=e.substr(t+1,n-t-1);return"hero-"+i},_getFileSystemPath:function(e){var t=new window.URL(e);return t.pathname},preloadImage:function(e){var n=t.defer(),i=new Image;return i.onload=function(){n.resolve(i.src)},i.onerror=function(){n.reject()},i.src=e,n.promise},toString:function(){return"ImagesService"}}}]),itmngtModule.service("ItmngtOrchestratorService",["$log","OrchestratorChiefService","$q",function(e,t,n){e=e.getInstance("ItmngtOrchestratorService"),e.info("Service Started...");var i={init:function(){t.register(i)},_navigateToTripList:function(){var e=t.navigateTo("triplist");return e},_navigateToPastTrips:function(){var e=t.navigateTo("pastTrips");return e},_navigateToTripExpanded:function(e){var n=t.navigateTo("trip-expanded",e);return n},_navigateToPrintTrip:function(e){var n=t.navigateTo("print-trip",e);return n},_navigateToSegmentExpanded:function(e){var n=t.navigateTo("segment-expanded",e);return n},next:function(e,a){var r;if(e.segmentSelected&&(r=i._navigateToSegmentExpanded(e.segmentSelected)),e.tripSelected&&(r=""===e.page||"triplist"===e.page?i._navigateToTripExpanded(e.tripSelected):"trip-expanded"===e.page&&e.print?i._navigateToPrintTrip(e.tripSelected):i._navigateToTripList().then(function(){i._navigateToTripExpanded(e.tripSelected)})),(e.tripDeleted||e.tripUngrouped)&&(r="past-trip-expanded"===e.page||"more-past-trip-expanded"===e.page?i._navigateToPastTrips():"trip-expanded"===e.page?i._navigateToTripList():n.when()),e.tripImported&&(r=i._navigateToTripExpanded(e.tripImported)),e.taxiBookingCompleted){var o=e.taxiTripInput;isDefined(e.taxiTripInput.contextTripId)&&(o.tripId=e.taxiTripInput.contextTripId),r=i._navigateToTripList().then(function(){i._navigateToTripExpanded(o)})}if(e.taxiReco&&(r=t.navigateTo("taxi",{tripId:safeAccess(e.taxiReco,"trip.tripId"),prefillUrl:safeAccess(e.taxiReco,"segment.parameters"),touchPoint:safeAccess(e.taxiReco,"touchPoint","CMT_TAXI_RECO_DIRECT"),recoId:safeAccess(e.taxiReco,"recoId",null)})),e.parkingReco&&(r=t.navigateTo("parking")),e.loungeReco&&(r=t.navigateTo("lounge")),e.activityReco&&(r=t.navigateTo("activities",{prefillUrl:safeAccess(e.activityReco,"segment.fromLocation.cityCode"),directUrl:safeAccess(e.activityReco,"segment._activityAvailability.url")})),isUndefined(r))switch(e.page){case"":case"triplist":i._navigateToTripList();break;default:r=t.check(e,a)}return r},toString:function(){return"ItmngtOrchestratorService"}};return i}]),itmngtModule.service("TripService",["$log","$q","TriplistCacheService","AuthenticationService","PromiseService","I18nService","SegmentService","RequestService","DateTimeService","DataManagerService","FlightStatusService","$rootScope",function(e,t,n,i,a,r,o,s,l,c,d,u){e=e.getInstance("TripService"),e.info("Service Started...");var g={ERROR_RETRIEVE_FAILED_NO_FIRST_NAME:"ERROR_RETRIEVE_FAILED_NO_FIRST_NAME",SCROLL_TO_ON_NEXT_DISPLAY_KEY:"scrollToOnNextDisplay",TRIPS_REFRESH_FROM_CACHE_ON_NEXT_DISPLAY_KEY:"refreshTripFromCacheOnNextDisplay",TRIPS_REFRESH_ON_NEXT_DISPLAY_KEY:"refreshTripOnNextDisplay",IMPORT_TRIP_URL_PATH:"v1/trips/importTrip",IMPORT_SHARED_TRIP_URL_PATH:"v2/trips/importSharedTrip",DELETE_TRIP_URL_PATH:"v1/trips/deleteTrip",UNGROUP_TRIP_URL_PATH:"v1/trips/ungroupFolder",RETRIEVE_TRIP_URL_PATH:"v1/trips/retrieveTrip",GUEST_RETRIEVE_TRIP_URL_PATH:"v1/trips/guestRetrieveTrip",SUPPORTED_SEGMENT_TYPES:["Activity","Air","Car","Cruise","Excursion","Hotel","Insurance","Meeting","MoveMisc","Parking","ServiceMisc","ShowAndEvent","SleepMisc","Taxi","Train","Transfer","Urban","Visa","Layover","RecoHotel","RecoTaxi","RecoActivity","RecoParking","RecoLounge"],isPastTrip:function(e,t,i){return n.isPastTrip(e,t,i)},hasAirSegment:function(e){return safeAccess(e,"segmentStats.numberOfAir",safeAccess(e,"productStats.numberOfAir",0))>0},isReadOnly:function(e){return"READ"===safeAccess(e,"accessRight","").toUpperCase()},isSupportedTrip:function(e){if(getContext("featureConfig.trip.displayUnsupported")===!0)return!0;var t=safeAccess(e,"segmentStats",{}),n=g.SUPPORTED_SEGMENT_TYPES.some(function(e){return t["numberOf"+e]>0});return n},isCheckInEnabled:function(t){e.debug("segment = "+t.index);var n=o.getCheckInUrl(t);if(!n)return!1;var i=moment(),a=safeAccess(t,"startDate");a=l.getMomentFromBackendDate(a);var r=o.getDateFromWhenCheckinIsEnabled(t),s=a;return i>r&&s>i},getTicketNumberList:function(e){var t=[];if(e.travellers)for(var n=0;n<e.travellers.length;n++)e.travellers[n]&&e.travellers[n].ticket&&e.travellers[n].ticket.number&&t.push(e.travellers[n].ticket.number);return t},addTrip:function(e){var i=t.defer();if(e.shareId&&e.shareId.length>10)return g.importSharedTrip(e.shareId);var o={tripId:e.tripId,lastName:e.lastName};return isDefined(e.firstName)&&(o.firstName=e.firstName),isDefined(e.contextTripId)&&(o.contextTripId=e.contextTripId),s.post(g.IMPORT_TRIP_URL_PATH,o).then(function(e){var t=safeAccess(e,"data.success");if(t){var s=safeAccess(e,"data.trip");if(g.isSupportedTrip(s)){n.addTripToCache(s);var l=angular.copy(s);i.resolve(g._filterSegmentsAndServices(l))}else r.translate("itmngt.error.tripHasOnlyUnsupportedSegments").then(function(e){i.reject(e)});u.$emit("tripHasBeenImportedEvent",s)}else{var c=safeAccess(e,"data.errorCodes[0]","000000");"777955"===c?r.translate("itmngt.error.expiredEncryptedValueOrLink").then(function(e){i.reject(e)}):a.rejectDueToBackendError({deferred:i,response:e,payload:o,method:"addTrip"})}},function(e){a.rejectDueToHttpError({deferred:i,response:e,payload:o,method:"addTrip"})})["catch"](handleUnexpectedError),i.promise},importSharedTrip:function(e){var i=t.defer(),o={shareId:e};return s.post(g.IMPORT_SHARED_TRIP_URL_PATH,o).then(function(e){var t=safeAccess(e,"data.success");if(t){var s=safeAccess(e,"data.trip");if(g.isSupportedTrip(s)){n.addTripToCache(s);var l=angular.copy(s);i.resolve(g._filterSegmentsAndServices(l))}else r.translate("itmngt.error.tripHasOnlyUnsupportedSegments").then(function(e){i.reject(e)});u.$emit("tripHasBeenImportedEvent",s)}else a.rejectDueToBackendError({deferred:i,response:e,payload:o,method:"importSharedTrip"})},function(e){a.rejectDueToHttpError({deferred:i,response:e,payload:o,method:"importSharedTrip"})})["catch"](handleUnexpectedError),i.promise},deleteTrip:function(e){var i=t.defer(),r={tripId:e};return s.post(g.DELETE_TRIP_URL_PATH,r).then(function(t){var o=safeAccess(t,"data.success");o?(n.removeTripFromCache(e),i.resolve(!0)):a.rejectDueToBackendError({deferred:i,response:t,payload:r,method:"deleteTrip"})},function(e){a.rejectDueToHttpError({deferred:i,response:e,payload:r,method:"deleteTrip"})})["catch"](handleUnexpectedError),i.promise},ungroupTrip:function(e){var n=t.defer(),i={folderId:e};return s.post(g.UNGROUP_TRIP_URL_PATH,i).then(function(e){var t=safeAccess(e,"data.success");t?n.resolve(!0):a.rejectDueToBackendError({deferred:n,response:e,payload:i,method:"ungroupTrip"})},function(e){a.rejectDueToHttpError({deferred:n,response:e,payload:i,method:"ungroupTrip"})})["catch"](handleUnexpectedError),n.promise},getTripById:function(e){var t=n.getCachedTrip(e);return isUndefined(t)&&(t=n.getFolderContainingTrip(e)),t},retrieveOrImportTrip:function(n,i,a,r){if(r=r||{forceFromServer:!1},n.length>10&&isUndefined(i))return g.importSharedTrip(n);var o=g.retrieveTrip(n,i,r)["catch"](function(){var r,o=getContext("featureConfig.importTrip.firstNameRequired",!1);return isDefined(a)||!o?(e.warn("retrieveOrImportTrip: retrieveTrip failed; trying importTrip"),r=g.addTrip({tripId:n,lastName:i,firstName:a})):(e.warn("retrieveOrImportTrip: retrieveTrip failed; firstName not available but required; rejecting the promise"),r=t.reject(g.ERROR_RETRIEVE_FAILED_NO_FIRST_NAME)),r});return o},retrieveTrip:function(e,r,o){o=o||{forceFromServer:!1};var l=t.defer(),c=n.getCachedTrip(e);if(!o.forceFromServer&&c&&null!==c.tripDetails)return l.resolve(g._filterSegmentsAndServices(c)),l.promise;var d={lastName:r,tripId:e},u=isDefined(c)?c.creationDate:null;isDefined(u)&&(d.creationDate=u);var p;return p=i.isLogged()?g.RETRIEVE_TRIP_URL_PATH:g.GUEST_RETRIEVE_TRIP_URL_PATH,s.post(p,d).then(function(e){var t=e.data;if(t.success){n.addTripToCache(t.trip);var i=angular.copy(t.trip);l.resolve(g._filterSegmentsAndServices(i))}else a.rejectDueToBackendError({deferred:l,response:e,payload:d,method:"retrieveTrip"})},function(e){a.rejectDueToHttpError({deferred:l,response:e,payload:d,method:"retrieveTrip"})})["catch"](handleUnexpectedError),l.promise},isSingleAirPnrFolder:function(e){if(!n.isFolder(e))return!1;var t=g.getSegmentsOfType(e,"Air");if(0===t.length)return!1;var i=!t.some(function(e){return e.confirmationNumber!==t[0].confirmationNumber});return i},importTripForShare:function(e){var n=t.defer(),i={firstName:e.firstName,lastName:e.lastName,tripId:e.tripId};return s.post(g.IMPORT_TRIP_URL_PATH,i).then(function(e){var t=e.data;t.success?n.resolve(t.trip):a.rejectDueToBackendError({deferred:n,response:e,payload:i,method:"importTripForShare"})},function(e){a.rejectDueToHttpError({deferred:n,response:e,payload:i,method:"importTripForShare"})})["catch"](handleUnexpectedError),n.promise},updateSharedTrip:function(e){return n.removeTripFromCache(e.tripId),g.retrieveTrip(e.folderId,e.bookingLastName,{forceFromServer:!0})},_filterSegmentsAndServices:function(e,t){return e.tripDetails=e.tripDetails||{},e.tripDetails.segments=e.tripDetails.segments||[],e.tripDetails.services=e.tripDetails.services||[],e.tripDetails.segments=g._filterSegments(e.tripDetails.segments,t||g.SUPPORTED_SEGMENT_TYPES),e.tripDetails.services=g._filterServices(e.tripDetails.services,t||g.SUPPORTED_SEGMENT_TYPES),e},_filterSegments:function(e,t){if(getContext("featureConfig.trip.displayUnsupportedSegments")===!0)return e;var n=e.filter(function(e){var n=e.type;return isDefined(e.recoType)&&(n=e.type+e.recoType),t.indexOf(n)>-1});return n},_filterServices:function(e,t){if(getContext("featureConfig.trip.displayUnsupportedServices")===!0)return e;var n=e.filter(function(e){return t.indexOf(e.type)>-1});return n},getSegmentFromTrip:function(e,t){for(var n=safeAccess(e,"tripDetails.segments",[]),i=0;i<n.length;i++)if(n[i].refId===t)return n[i];return null},isNotReco:function(e){return"RECO"!==safeAccess(e,"type","").toUpperCase()},getTripSegmentDiff:function(e,t){var n=[safeAccess(e,"tripDetails.segments",[]).filter(g.isNotReco),safeAccess(t,"tripDetails.segments",[]).filter(g.isNotReco)],i=n[0].length>n[1].length?n.shift():n.pop(),a=n.pop();return i.filter(function(e){return!a.find(function(t){return e.refId===t.refId})})},sortTripByDateASC:function(e,t){var n=l.getMomentFromBackendDate(e.startDate),i=l.getMomentFromBackendDate(t.startDate),a=0;return isDefined(n)&&isDefined(i)&&(i>n&&(a=-1),n>i&&(a=1)),a},getSegmentsOfType:function(e,t){var n=safeAccess(e,"tripDetails.segments",[]),i=n.filter(function(e){return e.type===t});return i},getServicesOfType:function(e,t){var n=safeAccess(e,"tripDetails.services",[]),i=n.filter(function(e){return e.type===t});return i},hasSingleTraveller:function(e,t){var n=!1,i=g.getSegmentsOfType(e,t);return n=i.every(function(e){return isDefined(e.travellers)&&1===e.travellers.length})},hasEmptySeatOnFutureSegment:function(e,t,n){n=n||moment();var i=g.getSegmentsOfType(e,t),a=[];return i.forEach(function(e){o.isPastSegment(e,n)||o.hasSegmentStarted(e,n)||a.push(e)}),a.some(function(e){var t=e.travellers;return isDefined(t)?t.some(function(e){return null===e.seat}):void 0})},refreshTripFromCacheOnNextDisplay:function(e,t){e=e===!0;var n=c.get(g.TRIPS_REFRESH_FROM_CACHE_ON_NEXT_DISPLAY_KEY,c.LOCALSTORAGE);isDefined(n)||(n=[]),n.splice(n.indexOf(t),1),e&&n.push(t),c.set(n,g.TRIPS_REFRESH_FROM_CACHE_ON_NEXT_DISPLAY_KEY,{storage:c.LOCALSTORAGE})},scrollToOnNextDisplay:function(e,t){var n=c.get(g.SCROLL_TO_ON_NEXT_DISPLAY_KEY,c.MEMORY);isUndefined(n)&&(n={}),n[e]=t,c.set(n,g.SCROLL_TO_ON_NEXT_DISPLAY_KEY,{storage:c.MEMORY})},shouldScrollToOnNextDisplay:function(e){var t=c.get(g.SCROLL_TO_ON_NEXT_DISPLAY_KEY,c.MEMORY),n=null;isDefined(t)&&(n=t[e],t[e]=null),c.set(t,g.SCROLL_TO_ON_NEXT_DISPLAY_KEY,{storage:c.MEMORY})},shouldRefreshTripFromCacheOnNextDisplay:function(e){var t=c.get(g.TRIPS_REFRESH_FROM_CACHE_ON_NEXT_DISPLAY_KEY,c.LOCALSTORAGE),n=!1;return isDefined(t)&&(n=-1!==t.indexOf(e)),n},refreshTripOnNextDisplay:function(e){var t=c.get(g.TRIPS_REFRESH_ON_NEXT_DISPLAY_KEY,c.LOCALSTORAGE);isUndefined(t)&&(t=[]),isDefined(e)&&-1===t.indexOf(e)&&(t.push(e),c.set(t,g.TRIPS_REFRESH_ON_NEXT_DISPLAY_KEY,{storage:c.LOCALSTORAGE}))},shouldRefreshTripOnNextDisplay:function(e){var t=!1,n=c.get(g.TRIPS_REFRESH_ON_NEXT_DISPLAY_KEY,c.LOCALSTORAGE);return isDefined(n)&&isDefined(e)&&n.indexOf(e)>-1&&(t=!0,n.splice(n.indexOf(e),1),c.set(n,g.TRIPS_REFRESH_ON_NEXT_DISPLAY_KEY,{storage:c.LOCALSTORAGE})),t},isFolder:function(e){return n.isFolder(e)},toString:function(){return"TripService"}};return g}]),itmngtModule.service("SegmentService",["$log","DateTimeService","AuthenticationService",function(e,t,n){e=e.getInstance("SegmentService"),e.info("Service Started...");var i={getSegmentTypeUpperCased:function(e){return safeAccess(e,"type","").toUpperCase()},isSegmentTypeEtrMove:function(e){switch(e=e.toUpperCase()){case"CRUISE":case"URBAN":case"TAXI":case"TRANSFER":case"MOVEMISC":case"ACTIVITY":return!0}return!1},isSegmentTypeEtrStay:function(e){switch(e=e.toUpperCase()){case"EXCURSION":case"MEETING":case"PARKING":case"SHOWANDEVENT":return!0}return!1},isSegmentTypeEtrService:function(e){switch(e=e.toUpperCase()){case"INSURANCE":case"SERVICEMISC":case"VISA":return!0}return!1},hasTimeAndTimezones:function(e){var t=i.getStartDateAndEndDateKeys(e.type);return safeAccess(e,t.startDateKey+".hasTime",!1)&&safeAccess(e,t.endDateKey+".hasTime",!1)&&isDefined(safeAccess(e,t.startDateKey+".offsetMinutes"))&&isDefined(safeAccess(e,t.endDateKey+".offsetMinutes"))},getCheckInUrl:function(e){var t=safeAccess(e,"checkIn.webUrl");return(!t||getContext("isMobileApp")||getContext("isWebMobile"))&&(t=safeAccess(e,"checkIn.mobileUrl",t)),t},getDateFromWhenCheckinIsEnabled:function(e){var n=i.getSegmentTypeUpperCased(e),a=null;if("AIR"===n){var r=safeAccess(e,"checkIn.durationHrs",48),o=safeAccess(e,"startDate");a=t.getMomentFromBackendDate(o).subtract(r,"hours").toDate()}return a},getDateFromWhenSsrNotifIsEnabled:function(e){var n=i.getSegmentTypeUpperCased(e),a=null;if("AIR"===n){var r=getContext("featureConfig.notifications.ssrNotifDays","2"),o=safeAccess(e,"startDate");a=t.getMomentFromBackendDate(o).subtract(r,"days").toDate()}return a},getSegmentDuration:function(e){var n=safeAccess(e,"startDate"),i=safeAccess(e,"endDate");return t.getDurationFromBackendDates(n,i)},getCalendarEventStartAndEndDate:function(e){var n,a,r=i.hasTimeAndTimezones(e),o=i.getStartDateAndEndDateKeys(e.type),s=o.startDateKey,l=o.endDateKey;return r?(n=t.getMomentFromBackendDate(e[s]).toDate(),a=t.getMomentFromBackendDate(e[l]).toDate()):isDefined(e[s])&&isDefined(e[l])&&(n=moment(e[s].utcTimestampMillis).startOf("day").toDate(),a=moment(e[l].utcTimestampMillis).startOf("day").add(1,"days").toDate()),{startDate:n,endDate:a}},getFromLocationAndToLocationKeys:function(e){return e=e.toUpperCase(),"HOTEL"===e||"SLEEPMISC"===e||i.isSegmentTypeEtrStay(e)?{fromLocation:"location",toLocation:"location"}:"CAR"===e?{fromLocation:"pickupLocation",toLocation:"dropoffLocation"}:i.isSegmentTypeEtrService(e)?null:{fromLocation:"fromLocation",toLocation:"toLocation"}},getStartDateAndEndDateKeys:function(e){return e=e.toUpperCase(),"HOTEL"===e||"SLEEPMISC"===e?{startDateKey:"checkin",endDateKey:"checkout"}:"CAR"===e?{startDateKey:"pickupDateTime",endDateKey:"dropoffDateTime"}:{startDateKey:"startDate",endDateKey:"endDate"}},isPastSegment:function(e,n,a){var r=i.getSegmentTypeUpperCased(e),o=i.getStartDateAndEndDateKeys(r);n=n||moment();var s=t.getMomentFromBackendDate(safeAccess(e,o.endDateKey));if(isDefined(a)&&isDefined(s)){var l=t.decodeTTL(a);s.add(l,"ms")}return n>s},hasSegmentStarted:function(e,n){var a=i.getSegmentTypeUpperCased(e),r=i.getStartDateAndEndDateKeys(a);n=n||moment();var o=t.getMomentFromBackendDate(safeAccess(e,r.startDateKey));return n>o},getPassengerSeatAssignment:function(e){var t=[];return e.travellers.forEach(function(e){var n={};n.seat=angular.copy(e.seat),n.firstName=e.firstName,n.lastName=e.lastName,n.hasBookedSeat=null!==n.seat,n.hasBookedSeat||(n.selectedSeatForBooking=!0,n.seatPrice={},n.seatPrice.amount=null,n.seatPrice.currency=null),t.push(n)}),t},getOnSiteLocation:function(e){var t=i.getSegmentTypeUpperCased(e),n=null,a=i.getFromLocationAndToLocationKeys(t);return isDefined(a)&&(n="CAR"===t?safeAccess(e,a.fromLocation):safeAccess(e,a.toLocation)),n},isExtraLuggageBookable:function(e,t,n){var a=i.isPastSegment(e),r=i.hasSegmentStarted(e),o=safeAccess(n,"tripDetails.services",[]),s=i.getExtraLuggage(o,e.refId,t),l=!(a||r||s.isBooked||i.isExtraLuggageAddedForBooking(e,t));return l},isExtraLuggageAddedForBooking:function(e,t){var n=!1,i=e.travellers.filter(function(e){return e.refId===t});return i.length>0&&(n=!!i[0].extraLuggageAddedForBooking),n},getExtraLuggage:function(e,t,n){var i={isBooked:!1,isBookedForSegment:!1},a=e.filter(function(e){return"ProductService"===e.type&&e.code.indexOf("BAG")>-1&&e.referenceIds.indexOf(n)>-1});if(a.length>0){i.isBooked=!0;var r=a.filter(function(e){
return e.referenceIds.indexOf(t)>-1&&e.referenceIds.indexOf(n)>-1});if(r.length>0&&(i.isBookedForSegment=!0,r=r[0],isDefined(r.description))){var o=r.description.match(/\d{1,2}\s{0,1}KG/);null!==o&&(i.weight=o[0])}}return i},getSegmentIconClass:function(e){switch(e){case"Air":return"trip-flight";case"Hotel":return"trip-hotel";case"Car":return"trip-car";case"Transfer":return"trip-etr_TRANSFER";case"Train":return"trip-train";case"Cruise":return"trip-etr_CRUISE";case"Urban":return"trip-etr_URBAN";case"Taxi":return"trip-etr_TAXI";case"MoveMisc":return"trip-etr_MOVEMISC";case"Activity":return"trip-etr_ACTIVITY";case"Excursion":return"trip-etr_EXCURSION";case"Meeting":return"trip-etr_MEETING";case"Parking":return"trip-etr_PARKING";case"ShowAndEvent":return"trip-etr_SHOWANDEVENT";case"Insurance":return"trip-etr_INSURANCE";case"Servicemisc":return"trip-etr_SERVICEMISC";case"Visa":return"trip-etr_VISA"}},toString:function(){return"SegmentService"}};return i}]),itmngtModule.service("SegmentExpandedService",["$log","I18nService","$q","GloballistService","GloballistProcessor","SegmentService",function(e,t,n,i,a,r){e=e.getInstance("SegmentExpandedService"),e.info("Service Started...");var o="itmngt.segmentExpanded.label.piece",s="<br><small>-</small><br>",l={getLocalizedBaggageAllowanceOnSegmentLevel:function(e){if(!isDefined(e)||0===e.length)return n.when(!1);var i=e.length,a=null;if(1===i&&"PC"===e[0].unitCode)i=Number(e[0].quantity),window.isNaN(i)||(a=t.translate(o,{RES:i},"messageformat").then(function(e){return e}));else{var r=e.map(function(e){return e.unitCode}).filter(l.__uniqueFilter),s=r.length>1&&r.indexOf("PC")>-1,c=e.map(function(e){return l._getBaggageAllowanceOneItem(e)});a=n.all(c).then(function(e){return s?e.join("<br><small>-</small><br>"):e.join(", ")})}return a},_getBaggageAllowanceOneItem:function(i){var a="";if("K"===i.unitCode)a="kg";else if("L"===i.unitCode)a="lbs";else if("PC"===i.unitCode)return e.returns(t.translate(o,{RES:i.quantity},"messageformat"));return n.when(i.quantity+" "+a)},getLocalizedExtraBaggageAllowanceOnSegmentLevel:function(i,a,o){if(!isDefined(i))return n.resolve("");var s=i.isBooked&&i.isBookedForSegment||r.isExtraLuggageAddedForBooking(a,o)?1:0;return e.returns(t.translate("itmngt.segmentExpanded.label.piece",{RES:s},"messageformat").then(function(e){return e}))},getLocalizedMealsOnSegmentLevel:function(e,t){if(!isDefined(e)||0===e.length)return null;var n=e.map(function(e){return t["itmngt.segmentExpanded.mealCodes."+e.code]});return n.join(s)},getLocalizedAmenitiesOnSegmentLevel:function(e){if(!isDefined(e))return null;var t=[];for(var n in e)t.push(e[n]);return t.join("<br>")},getHotelRoomType:function(e){var t=i.getGl("LANG_ROOM_DESCRIPTION").then(a.cleanZZLanguage).then(a.matrixToObjectArray).then(function(t){for(var n,i=0;i<t.length;i++)t[i].value===e&&(n=t[i].text);return isUndefined(n)&&(n=e),n});return t},__uniqueFilter:function(e,t,n){return n.indexOf(e)===t},shouldHighlightSeatNumber:function(e){var t=!1;return isDefined(e.seat)&&null!==e.seat&&(isDefined(e.seatPrice)||null===e.seatPrice)&&(t=!0),t},toString:function(){return"SegmentExpandedService"}};return l}]),itmngtModule.service("SmartCheckinService",["$log","LayoutService","I18nService","AuthenticationService","TripAnalyticsService","$interval","$window","$q","AnalyticsService",function(e,t,n,i,a,r,o,s,l){e=e.getInstance("SmartCheckin");var c={SMART_CHECK_IN_FILE:"https://destinations.1aipp.com/SmartCheckin-gcc.js",smartPrefillCategories:{UNCATEGORIZED:0,FIRSTNAME:1,LASTNAME:2,CONFNUMBER:3,FROM:4,FLIGHTNUMBER:5,TO:6,ETICKET:7,FFNUMBER:8},start:function(t,n,i){if(window.cordova&&window.cordova.InAppBrowser)e.log("InAppBrowser available"),c._proceedWithInAppBrowser(t,c.preparePNR(n)).then(function(){a.checkinFinished(i,n)}),a.checkinStarted();else{e.log("InAppBrowser not available, fallback to external browser");var s=o.open(c.preProcessDeepLink(t,c.preparePNR(n)),"_system");if(isDefined(s)){var l=c._createInterval(function(){s.closed&&(r.cancel(l),a.checkinFinished(i,n))},500);a.checkinStarted()}else a.protectedModeActivated()}},_createInterval:function(e,t){return r(e,t)},_proceedWithInAppBrowser:function(i,a){t.loading(!0);var r=s.defer(),o=ionic.Platform.isIOS()||ionic.Platform.isAndroid()?"_blank":"_self",l=ionic.Platform.isAndroid()?"location=yes,hidden=yes":"location=no,hidden=yes",d=cordova.InAppBrowser.open(c.preProcessDeepLink(i,a),o,l);return d.addEventListener("loadstop",function(n){t.loading(!1),d.show(),e.debug("Loaded:"+n.url),n.code||c.loadScript(d,a)}),d.addEventListener("loaderror",function(a){t.loading(!1),e.error(a.message+"-"+a.code+"-"+i);var o="itmngt.smartcheckin.error.failtoloadurl";n.translate(o).then(function(e){t.toast(e[o]),r.reject(a.message)})}),d.addEventListener("exit",function(e){r.resolve()}),r.promise},preProcessDeepLink:function(e,t){return e=e.replace("{DEP_DATE_US}",""),e=e.replace("{departure}",t.map.get("FROM")),e=e.replace("{IATA_DEP}",""),e=e.replace("{FIRST}",t.map.get("FIRSTNAME")),e=e.replace("{firstname}",t.map.get("FIRSTNAME")),e=e.replace("{LAST}",t.map.get("LASTNAME")),e=e.replace("{lastname}",t.map.get("LASTNAME")),e=e.replace("{recloc}",t.map.get("CONFNUMBER")),e=e.replace("{PNR}",t.map.get("CONFNUMBER")),e=e.replace("{TKT_NO}",t.map.get("ETICKET")),e=e.replace("{FLT_NO}",t.map.get("FLIGHTNUMBER"))},loadScript:function(t,n){t.executeScript({file:this.SMART_CHECK_IN_FILE},function(){e.log("Script: Loaded"),t.executeScript({code:"smartPrefill.getIframeNodes()"},function(i){var a=i[0];e.log("Got iframes: "+JSON.stringify(a)),a&&1===a.length&&c._iframename_!==a[0].name&&(c._iframename_=a[0].name,e.debug(a[0].src),c._proceedWithInAppBrowser(a[0].src,n)),a&&0===a.length&&(e.debug("No frame"),t.executeScript({code:"smartPrefillInit("+JSON.stringify(n.prefill)+")"},function(){e.debug("Prefill started")})),a&&a.length>0&&e.debug("Multiple frames"+a.length)})})},preparePNR:function(t){var n=[],i=c.getMap();return n=n.concat(c.getMainTravellerInformation(t,i)),i.set("FLIGHTNUMBER",t.flight.airlineCode+t.flight.flightNumber),n.push(i.asPrefillStructure("FLIGHTNUMBER")),i.set("CONFNUMBER",t.confirmationNumber),n.push(i.asPrefillStructure("CONFNUMBER")),i.set("FROM",t.fromLocation.cityName),n.push(i.asPrefillStructure("FROM")),e.returns({prefill:n,map:i})},getMap:function(){return{set:function(e,t){this[""+c.smartPrefillCategories[e]]=t},get:function(e){return this[""+c.smartPrefillCategories[e]]},asPrefillStructure:function(e){return{value:this.get(e),kw:c.smartPrefillCategories[e]}}}},getMainTravellerInformation:function(e,t){var n,a,r=i.getUser();e.travellers.forEach(function(e){c.isSameTraveller(r,e)?(c.isSameTraveller(n,e)||(a=void 0),n=e):safeAccess(e,"frequentFlyer.number",!1)&&isUndefined(n)&&(a=e.frequentFlyer,n=e)}),isUndefined(n)&&(n=e.travellers[0]),t.set("FIRSTNAME",n.firstName),t.set("LASTNAME",n.lastName);var o=[t.asPrefillStructure("LASTNAME"),t.asPrefillStructure("FIRSTNAME")],s=safeAccess(n,"ticket.number",!1);return s&&(t.set("ETICKET",s),o.push(t.asPrefillStructure("ETICKET"))),isDefined(a)&&(t.set("FFNUMBER",a),o.push(t.asPrefillStructure("FFNUMBER"))),o},isSameTraveller:function(e,t){return isDefined(e)&&isDefined(t)&&c.compareIgnoreCase(t.lastName,e.lastName)&&c.compareIgnoreCase(t.firstName,e.firstName)},compareIgnoreCase:function(e,t){return isDefined(e)&&isDefined(t)&&e.toUpperCase()===t.toUpperCase()},_contains:function(e,t){for(var n=0;n<e.length;n++)if(JSON.stringify(e[n])===JSON.stringify(t))return!0;return!1}};return c}]),itmngtModule.service("AddToCalendarService",["$log","LayoutService","$filter","AppLifeCycleService","$q","$ionicModal","$rootScope","I18nService","TripService","TripAnalyticsService","SegmentService","UrlService","RequestService","AppPermissionsService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p){e=e.getInstance("AddToCalendarService"),e.info("Service Started...");var m={EXPORT_CALENDAR:"v1/trips/exportCalendar",APP_SUPPORTED_SEGMENTS:["Activity","Air","Car","Cruise","Excursion","Hotel","Meeting","MoveMisc","Parking","ShowAndEvent","SleepMisc","Taxi","Train","Transfer","Urban"],DESKTOP_SUPPORTED_SEGMENTS:["Air","Hotel","Car"],isCalendarPluginAvailable:!1,_calendarToUse:void 0,_hasReadWritePermissions:!1,_translations:void 0,desktopSupportedSegmentsStats:function(e){var t=safeAccess(e,"productStats",safeAccess(e,"segmentStats",{})),n={desktopSupportedSegments:0,numberOfSegmentsInTrip:0};return m.APP_SUPPORTED_SEGMENTS.forEach(function(e){if(isDefined(t["numberOf"+e])){var i=t["numberOf"+e];m.DESKTOP_SUPPORTED_SEGMENTS.indexOf(e)>-1&&(n.desktopSupportedSegments+=i),n.numberOfSegmentsInTrip+=i}}),n},getICSContent:function(t){var n=a.defer();return g.get(m.EXPORT_CALENDAR+"?calendarId="+t.calendarId).then(function(t){if(t.data.rawData)n.resolve(t.data.rawData);else{e.backendError(t.data);var i=safeAccess(t,"data.errorCodes");s.translateBackendErrorCodes(i).then(function(e){n.reject(e)})}},function(t){e.error(t),n.reject(t)}),n.promise},checkCalendarInitialization:function(){var e=a.defer();return m._loadTranslations().then(function(){m.isCalendarPluginAvailable?m._checkAndProvideCalendarPermissions().then(function(){m._hasReadWritePermissions?isDefined(m._calendarToUse)?m._manageSuccess(e):m._askCalendarToUse().then(function(t){m._calendarToUse=t.value,m._manageSuccess(e)})["catch"](function(t){m._manageError(e,t)}):m._manageError(e,"noReadWritePermissions")}):m._manageError(e,"calendarNotAvailable")}),e.promise},_checkAndProvideCalendarPermissions:function(){var e=a.defer();return p.checkAndProvidePermission([p.permissionReadCalendar,p.permissionWriteCalendar]).then(function(t){m._hasReadWritePermissions=t,e.resolve()},function(){e.resolve()}),e.promise},_loadTranslations:function(){var e=a.defer();return isDefined(m._translations)?e.resolve():s.translate(["itmngt.addToCalendar.error.noReadWritePermissions","itmngt.addToCalendar.error.calendarNotAvailable","itmngt.addToCalendar.error.loadTranslationFailed","itmngt.addToCalendar.error.userCancelled","itmngt.addToCalendar.error.calendarListFailed","itmngt.addToCalendar.error.segmentNotSupported","itmngt.addToCalendar.error.createEventFailed","itmngt.addToCalendar.error.updateEventFailed","itmngt.addToCalendar.error.findEventFailed","itmngt.addToCalendar.error.missingSegmentData","itmngt.addToCalendar.error.noCalendarAvailable","itmngt.label.flight","itmngt.label.confirmation","itmngt.label.flightnumber","itmngt.label.operatedby","itmngt.label.departure","itmngt.label.arrival","itmngt.label.hotel","itmngt.label.hotelCheckIn","itmngt.label.hotelCheckOut","itmngt.label.car","itmngt.label.pickup","itmngt.label.dropoff","itmngt.label.train","itmngt.label.startdate","itmngt.label.enddate"]).then(function(t){m._translations=t,e.resolve()},function(){m._manageError(e,"loadTranslationFailed")}),e.promise},_askCalendarToUse:function(){var e=a.defer();return window.plugins.calendar.listCalendars(function(n){angular.isArray(n)||(n=[]);var i=n.filter(function(e){return isDefined(e.name)&&""!==e.name});if(i.length>0){var a=null,s=o.$new();s.cancelModal=function(){t.removeModal(a),m._manageError(e,"userCancelled")},s.chooseCalendar=function(n){t.removeModal(a).then(function(){m._manageSuccess(e,n)})},s.calendars=i,r.fromTemplateUrl("itmngt/templates/partial/SelectCalendarModal.html",{scope:s,animation:"slide-in-up",focusFirstInput:!1}).then(function(e){a=e,t.showModal(a)})}else m._manageError(e,"noCalendarAvailable")},function(){m._manageError(e,"calendarListFailed")}),e.promise},addTripToCalendar:function(t){var n=a.defer();return m.checkCalendarInitialization().then(function(){function i(a,r,o){r<a.length?m.addSegmentToCalendar(a[r]).then(function(){o.itemsAdded++,o.numberOfItems++,i(a,r+1,o)},function(t){e.warn("Add to calendar fail for",t),"segmentNotSupported"!==t.errorCode&&(o.numberOfItems++,o.itemsInError++),i(a,r+1,o)}):(m._manageSuccess(n,o),c.addedToCalendar(t,o))}var a=t.tripDetails.segments.concat(t.tripDetails.services);i(a,0,{numberOfItems:0,itemsAdded:0,itemsInError:0})},function(e){m._manageError(n,e)}),n.promise},addSegmentToCalendar:function(e){var t=a.defer();return m.checkCalendarInitialization().then(function(){if(m.APP_SUPPORTED_SEGMENTS.indexOf(e.type)>-1){var n=null,i=e.type.toUpperCase();(d.isSegmentTypeEtrMove(i)||d.isSegmentTypeEtrStay(i)||d.isSegmentTypeEtrService(i))&&(i="ETR");var a=m["_create"+i+"eventData"];isDefined(a)&&(n=a(e)),isDefined(n)?m.addOrUpdateEventIfExists(n).then(function(){m._manageSuccess(t)},function(e){m._manageError(t,e)}):m._manageError(t,"missingSegmentData")}else m._manageError(t,"segmentNotSupported")},function(e){m._manageError(t,e)}),t.promise},addOrUpdateEventIfExists:function(e){var t=a.defer();return m.checkCalendarInitialization().then(function(){m.findEvent(e).then(function(n){m.addEvent(e).then(function(){m._manageSuccess(t)},function(e){m._manageError(t,e)})},function(e){m._manageError(t,e)})},function(e){m._manageError(t,e)}),t.promise},addEvent:function(t){var n=a.defer();return m.checkCalendarInitialization().then(function(){window.plugins.calendar.createEventWithOptions(t.title,t.location,t.notes,t.startDate,t.endDate,m._getCalendarOptions(),function(){e.info("Event '"+t.title+"' added with success to the calendar!"),m._manageSuccess(n)},function(e){m._manageError(n,"createEventFailed")})},function(e){m._manageError(n,e)}),n.promise},updateEvent:function(t,n){var i=a.defer();return m.checkCalendarInitialization().then(function(){window.plugins.calendar.modifyEventWithOptions(t.title,t.location,t.notes,t.startDate,t.endDate,n.title,n.location,n.notes,n.startDate,n.endDate,m._getCalendarOptions(),function(){e.info("Event '"+t.title+"' updated with success to the calendar!"),m._manageSuccess(i)},function(e){m._manageError(i,"updateEventFailed")})},function(e){m._manageError(i,e)}),i.promise},findEvent:function(t){var n=a.defer();return m.checkCalendarInitialization().then(function(){window.plugins.calendar.findEventWithOptions(t.title,t.location,t.notes,t.startDate,t.endDate,m._getCalendarOptions(),function(i){e.info(i.length+" events founded for event: "+t.title);var a=null;i.forEach(function(n){n.title===t.title&&(a=n,e.info("Event '"+t.title+"' already exists in the calendar"))}),m._manageSuccess(n,a)},function(e){m._manageError(n,"findEventFailed")})},function(e){m._manageError(n,e)}),n.promise},_getCalendarOptions:function(){var e=window.plugins.calendar.getCalendarOptions();return e.calendarId=m._calendarToUse.id,e.calendarName=m._calendarToUse.name,e},_manageSuccess:function(e,t){e.resolve({success:!0,value:t})},_manageError:function(t,n){e.warn(n);var i;i="object"==typeof n?n:{success:!1,reason:m._translations["itmngt.addToCalendar.error."+n],errorCode:n},t.reject(i)},_notesLineBreak:function(){var e=ionic.Platform.isIOS(),t=ionic.Platform.isIPad(),n="\n";return(e||t)&&(n=" "),n},_createAIReventData:function(t){var i=null,a=m._segmentFirstDateIsNotLaterThanSecondDate(t);if(t.title=t.title||"",a){var r=m._translations["itmngt.label.confirmation"]+" "+m._print(t.confirmationNumber,!0,!0),o=safeAccess(t,"flight.airlineCode","")+safeAccess(t,"flight.flightNumber","");r+=m._translations["itmngt.label.flightnumber"]+" "+m._print(o,!0,!0),r+=m._print(safeAccess(t,"marketingCarrier.name"),!1,!0),r+=t.operatingCarrier?m._translations["itmngt.label.operatedby"]+" "+m._print(t.operatingCarrier.name,!0,!0):"",r+=m._print(safeAccess(t,"flight.aircraft.name"),!1,!0),r+=m._notesLineBreak()+m._translations["itmngt.label.departure"]+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.startDate)+m._notesLineBreak(),r+=n("displayAirport")(t.fromLocation)+m._notesLineBreak(),r+=m._notesLineBreak()+m._translations["itmngt.label.arrival"]+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.endDate)+m._notesLineBreak(),r+=n("displayAirport")(t.toLocation);var s=d.getCalendarEventStartAndEndDate(t);i={title:m._translations["itmngt.label.flight"]+" "+m._print(t.title),location:n("fullAddress")(t.fromLocation),notes:r,startDate:s.startDate,endDate:s.endDate}}else e.warn("AIR: missing or wrong data, unable to add to calendar");return i},_createHOTELeventData:function(t){var i=null,a=m._segmentFirstDateIsNotLaterThanSecondDate(t);if(t.title=t.title||"",a){var r=m._print(t.name,!1,!0);r+=m._translations["itmngt.label.confirmation"]+" "+m._print(t.reservationNumber,!0,!0),r+=m._notesLineBreak()+m._translations["itmngt.label.hotelCheckIn"]+":"+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.checkin)+m._notesLineBreak(),r+=m._notesLineBreak()+m._translations["itmngt.label.hotelCheckOut"]+":"+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.checkout);var o=d.getCalendarEventStartAndEndDate(t);i={title:m._translations["itmngt.label.hotel"]+" "+m._print(t.title),location:n("fullAddress")(t.location),notes:r,startDate:o.startDate,endDate:o.endDate}}else e.warn("HOTEL: missing or wrong data, unable to add to calendar");return i},_createSLEEPMISCeventData:function(e){var t=m._createHOTELeventData(e);return t},_createCAReventData:function(t){var i=null,a=m._segmentFirstDateIsNotLaterThanSecondDate(t);if(t.title=t.title||"",a){var r=m._print(safeAccess(t,"company.name"),!1,!0);r+=m._translations["itmngt.label.confirmation"]+" "+m._print(t.confirmationNumber,!0,!0),r+=m._notesLineBreak()+m._translations["itmngt.label.pickup"]+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.pickupDateTime)+m._notesLineBreak(),r+=n("fullAddress")(t.pickupLocation)+m._notesLineBreak(),r+=m._notesLineBreak()+m._translations["itmngt.label.dropoff"]+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.dropoffDateTime)+m._notesLineBreak(),r+=n("fullAddress")(t.dropoffLocation);var o=d.getCalendarEventStartAndEndDate(t);i={title:m._translations["itmngt.label.car"]+" "+m._print(t.title),location:n("fullAddress")(t.pickupLocation),notes:r,startDate:o.startDate,endDate:o.endDate}}else e.warn("CAR: missing or wrong data, unable to add to calendar");return i},_createTRAINeventData:function(t){var i=null,a=m._segmentFirstDateIsNotLaterThanSecondDate(t);if(t.title=t.title||"",a){var r=m._print(safeAccess(t,"company.name"),!1,!0);r+=m._translations["itmngt.label.confirmation"]+" "+m._print(t.confirmationNumber,!0,!0),r+=m._notesLineBreak()+m._translations["itmngt.label.departure"]+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.startDate)+m._notesLineBreak(),r+=n("fullAddress")(t.fromLocation)+m._notesLineBreak(),r+=m._notesLineBreak()+m._translations["itmngt.label.arrival"]+m._notesLineBreak(),r+=n("fullDateTimeTZ")(t.endDate)+m._notesLineBreak(),r+=n("fullAddress")(t.toLocation);var o=d.getCalendarEventStartAndEndDate(t);i={title:m._translations["itmngt.label.train"]+" "+m._print(t.title),location:n("fullAddress")(t.fromLocation),notes:r,startDate:o.startDate,endDate:o.endDate}}else e.warn("TRAIN: missing or wrong data, unable to add to calendar");return i},_createETReventData:function(t){var i=null,a=m._segmentFirstDateIsNotLaterThanSecondDate(t);if(t.title=t.title||"",a){var r,o,s=t.type;d.isSegmentTypeEtrStay(s)||d.isSegmentTypeEtrService(s)?(r=m._translations["itmngt.label.startdate"],o=m._translations["itmngt.label.enddate"]):d.isSegmentTypeEtrMove(s)&&(r=m._translations["itmngt.label.departure"],o=m._translations["itmngt.label.arrival"]);var l=r+m._notesLineBreak();l+=n("fullDateTimeTZ")(t.startDate)+m._notesLineBreak(),l+=m._notesLineBreak()+o+m._notesLineBreak(),l+=n("fullDateTimeTZ")(t.endDate);var c=d.getCalendarEventStartAndEndDate(t);i={title:m._print(t.title),location:n("fullAddress")(t.location||t.fromLocation),notes:l,startDate:c.startDate,endDate:c.endDate}}else e.warn("ETR: missing or wrong data, unable to add to calendar");return i},_print:function(e,t,n){var i="";return isDefined(e)&&""!==e?i=e:t===!0&&(i="-"),n&&""!==i&&(i+=m._notesLineBreak()),i},_segmentFirstDateIsNotLaterThanSecondDate:function(e){var t,n=d.getCalendarEventStartAndEndDate(e),i=n.startDate,a=n.endDate;return t=i&&a?a>=i:!1},toString:function(){return"AddToCalendarService"}};return i.onAppReady(function(){m.isCalendarPluginAvailable=isDefined(window.plugins)&&isDefined(window.plugins.calendar)}),m}]),itmngtModule.service("TripAnalyticsService",["$log","$q","AnalyticsService","TripService","DateTimeService",function(e,t,n,i,a){e=e.getInstance("TripAnalyticsService"),e.info("Service Started...");var r={CATEGORY:"Trip",EVENTS:{addedWithRecloc:"Trip added",addedOutsideApp:"Trip added outside app",shared:"Trip shared",addedToCalendar:"Added to calendar",flightStatusUpdate:"Flight status update",checkinFinished:'"Checkin Browser Close"',checkinStarted:'"Checkin Browser"',tripDetailsView:"Trip details",segmentDetailsView:"Segment details",protectedModeActivated:"Protected Mode Activated",taxiRecoTapped:"Taxi reco card tapped",parkingRecoTapped:"Parking reco card tapped",parkingRecoDisplayed:"Parking reco card displayed",loungeRecoTapped:"Lounge reco card tapped",loungeRecoDisplayed:"Lounge reco card displayed",activityRecoTapped:"Activity reco card tapped",taxiRecoDisplayed:"Taxi reco card displayed",activityRecoDisplayed:"Activity reco card displayed",tripUngroupDisplayed:"Trip ungroup displayed",tripUngrouped:"Trip ungroup accepted",tripUngroupCancelled:"Trip ungroup cancelled",eTktButtonClicked:"eTkt Button Clicked",eTktCachedLinkRetreived:"eTkt Link Retrieved Successfully - Cached",eTktNewLinkRetreived:"eTkt Link Retrieved Successfully - New",eTktDocumentRetrieved:"eTkt Document Retrieved Successfully"},directionsClicked:function(e){n.runSafe(function(){e?this.sendEvent("Directions tripdetails clicked",r.getSegmentProperties(e),"TripTool"):this.sendEvent("Directions tabbar clicked",[],"TripTool")})},discoverClicked:function(e){n.runSafe(function(){e?this.sendEvent("Discover tripdetails clicked",r.getSegmentProperties(e),"TripTool"):this.sendEvent("Discover tabbar clicked",r.getSegmentProperties(e),"TripTool")})},taxiDriverClicked:function(e){n.runSafe(function(){e?this.sendEvent("Taxi driver tripdetails clicked",r.getSegmentProperties(e),"TripTool"):this.sendEvent("Taxi driver tabbar clicked",[],"TripTool")})},taxiRecoDisplayed:function(e,t){n.runSafe(function(){this.sendEvent(r.EVENTS.taxiRecoDisplayed,n.extendDefaultParameterWith(r.getTripProperties(e),r.getTaxiRecoProperties(t)),r.CATEGORY)})},taxiRecoTapped:function(e,t){n.runSafe(function(){this.sendEvent(r.EVENTS.taxiRecoTapped,n.extendDefaultParameterWith(r.getTripProperties(e),r.getTaxiRecoProperties(t)),r.CATEGORY)})},parkingRecoTapped:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.parkingRecoTapped,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},parkingRecoDisplayed:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.parkingRecoDisplayed,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},loungeRecoTapped:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.loungeRecoTapped,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},loungeRecoDisplayed:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.loungeRecoDisplayed,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},activityRecoTapped:function(e,t){n.runSafe(function(){this.sendEvent(r.EVENTS.activityRecoTapped,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},activityRecoDisplayed:function(e,t){n.runSafe(function(){this.sendEvent(r.EVENTS.activityRecoDisplayed,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},_airHelpPropertyBuilder:function(e,t){var i=n.getPropertiesFactory();return i.create("AirHelp - Flight status",t.status).push().create("AirHelp - From",safeAccess(e,"fromLocation.code","NA")).push().create("AirHelp - To",safeAccess(e,"toLocation.code","NA")).push().create("AirHelp - Compensation",t.amount||-1).push().create("AirHelp - Depature Date",a.getMomentFromBackendDate(safeAccess(e,"startDate")).format("YYYY-MM-DD")).push().create("AirHelp - Arrival Date",a.getMomentFromBackendDate(safeAccess(e,"endDate","NA")).format("YYYY-MM-DD")).push(),i.build()},airHelpDisplayed:function(e,t){n.runSafe(function(){this.sendEvent("AirHelp button displayed",r._airHelpPropertyBuilder(e,t),r.CATEGORY)})},airHelpClicked:function(e,t){n.runSafe(function(){this.sendEvent("AirHelp button clicked",r._airHelpPropertyBuilder(e,t),r.CATEGORY)})},protectedModeActivated:function(){n.runSafe(function(){this.sendEvent(r.EVENTS.protectedModeActivated,n.extendDefaultParameterWith(),r.CATEGORY)})},addedWithRecloc:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.addedWithRecloc,n.extendDefaultParameterWith(r.getTripProperties(e).concat([{name:"Trip added with",value:"Recloc"}])),r.CATEGORY)})},getTripProperties:function(e){var t=n.getPropertiesFactory("Trip - ");t.create("To code",safeAccess(e,"toLocation.cityCode","NA")).flagMarketing().push().create("From code",safeAccess(e,"fromLocation.cityCode","NA")).flagMarketing().push().create("Days until start",r.getDurationInDays(safeAccess(e,"startDate.utcTimestampMillis",0))).flagMarketing().push().create("Start time",r.getTimeInSecond(safeAccess(e,"startDate.utcTimestampMillis",0))).push().create("End time",r.getTimeInSecond(safeAccess(e,"endDate.utcTimestampMillis",0))).push().create("Trip id",safeAccess(e,"tripId","NA")).flagSensitive().push(),safeAccess(e,"endDate.utcTimestampMillis",!1)&&t.create("Duration days",r.getDurationInDays(safeAccess(e,"endDate.utcTimestampMillis",0),safeAccess(e,"startDate.utcTimestampMillis",0))).flagMarketing().push();var i=safeAccess(e,"productStats",safeAccess(e,"segmentStats",[])),a=0;return angular.forEach(i,function(e,n){t.create(n.replace("numberOf","number of "),e).flagMarketing().push(),a+=e}),t.create("Number of segments",a).flagMarketing().push(),t._data_},getSegmentProperties:function(e,t){var i=n.getPropertiesFactory("Segment - "),a=safeAccess(e,"type","NA");i.create("Type",a).flagMarketing().push().create("Hours until start",r.getDurationInHours(safeAccess(e,"startDate.utcTimestampMillis",0))).flagMarketing().push().create("Days until start",r.getDurationInDays(safeAccess(e,"startDate.utcTimestampMillis",0))).flagMarketing().push().create("Travel Agency Name",safeAccess(e,"travelAgency.name","NA")).flagMarketing().push().create("Duration minutes",r.getSegmentDuration(safeAccess(e,"endDate.utcTimestampMillis",0),safeAccess(e,"startDate.utcTimestampMillis",0))).push().create("Confirmation number",safeAccess(e,"confirmationNumber","NA")).flagSensitive().push().create("Start time",r.getTimeInSecond(safeAccess(e,"startDate.utcTimestampMillis","NA"))).push().create("End time",r.getTimeInSecond(safeAccess(e,"endDate.utcTimestampMillis","NA"))).push();var o="_get"+a+"SegmentProperties";return isDefined(r[o])&&r[o].apply(this,[e,i,t]),i._data_},getTaxiRecoProperties:function(e){var t=n.getPropertiesFactory("Taxi Reco - ");return t.create("Number of passengers",safeAccess(e,"nip","-")).flagMarketing().push().create("Index",safeAccess(e,"index","-")).flagMarketing().push().create("In layover",safeAccess(e,"inLayover","-")).flagMarketing().push(),t._data_},_getAirSegmentProperties:function(e,t,i){return t=t?t:n.getPropertiesFactory("Segment - "),t.create("Departure location",safeAccess(e,"fromLocation.countryCode","")+"-"+safeAccess(e,"fromLocation.cityCode","-")).push().create("Arrival location",safeAccess(e,"toLocation.countryCode","")+"-"+safeAccess(e,"toLocation.cityCode","-")).push().create("Equipment",safeAccess(e,"equipment","NA")).push().create("Baggage allowance",r._flatten(e,"baggageAllowance","quantity","unitCode")).push().create("Meals",r._flatten(e,"meals","code")).push().create("Travellers",safeAccess(e,"travellers",[]).length).push().create("Booking class",safeAccess(e,"bookingClass.code","NA")).push().create("Aircraft type",safeAccess(e,"flight.aircraft.code","NA")).push().create("Flight number",safeAccess(e,"flight.flightNumber","NA"),!0).push().create("Marketing carrier",safeAccess(e,"marketingCarrier.code","NA")).push().create("Operating carrier",safeAccess(e,"operatingCarrier.code","NA")).push().create("Checkin link available",void 0!==safeAccess(e,"checkIn.mobileUrl")).push().create("Checkin duration hours",safeAccess(e,"checkIn.durationHrs","NA")).push(),r._getFlightStatus(t,i),t},_getHotelSegmentProperties:function(e,t){return t=t?t:n.getPropertiesFactory("Segment - "),t.create("Departure location",safeAccess(e,"location.countryCode","")+"-"+safeAccess(e,"location.cityCode","-")).push().create("Chain name",safeAccess(e,"chainName","NA")).push().create("Hotel name",safeAccess(e,"name","NA")).push().create("Hotel code",safeAccess(e,"hotelCode","NA")).push().create("Bed type code",safeAccess(e,"bedTypeCode","NA")).push().create("Room type code",safeAccess(e,"roomTypeCode","NA")).push().create("Number of beds",safeAccess(e,"numberOfBeds","NA")).push().create("Ranking",safeAccess(e,"ranking","NA")).push().create("Additional services",safeAccess(e,"additionalServices","NA")).push(),t},_getCarSegmentProperties:function(e,t){return t=t?t:n.getPropertiesFactory("Segment - "),t.create("Departure location",safeAccess(e,"pickupLocation.countryCode","")+"-"+safeAccess(e,"pickupLocation.cityCode","-")).push().create("Arrival location",safeAccess(e,"dropoffLocation.countryCode","")+"-"+safeAccess(e,"dropoffLocation.cityCode","-")).push(),t},_getTrainSegmentProperties:function(e,t){return t=t?t:n.getPropertiesFactory("Segment - "),t.create("Departure location",safeAccess(e,"fromLocation.countryCode","")+"-"+safeAccess(e,"fromLocation.cityCode","-")).push().create("Arrival location",safeAccess(e,"toLocation.countryCode","")+"-"+safeAccess(e,"toLocation.cityCode","-")).push(),t},updatePropertyAndParameters:function(e,t){e=isDefined(e)?e:[],t=isDefined(t)?t:[],n.runSafe(function(){n.setProperty("Total Trips",e.length+t.length),n.setProperty("Future and ongoing trips count",e.length),n.setProperty("Past Trips",t.length),e.length>0&&(n.setProperty("Next trip date",a.getMomentFromBackendDate(e[0].startDate).format("YYYY-MM-DD")),n.setProperty("Next trip city code",safeAccess(e,"[0].toLocation.cityCode")),n.setProperty("Next trip city name",safeAccess(e,"[0].toLocation.cityName"))),t.length>0&&(n.setProperty("Last trip date",a.getMomentFromBackendDate(t[t.length-1].startDate).format("YYYY-MM-DD")),n.setProperty("Last trip city code",safeAccess(t,"["+(t.length-1)+"].toLocation.cityCode")),n.setProperty("Last trip city name",safeAccess(t,"["+(t.length-1)+"].toLocation.cityName")));var i=n.getPropertiesFactory();if(i.create("Trips count",t.length+e.length).push().create("Past trips count",t.length).push().create("Future and ongoing trips count",e.length).push(),e.length>0){var o=e[0];i.create("Closest trip hours left",r.getDurationInHours(safeAccess(o,"startDate.utcTimestampMillis"))).push()}n.setDefaultParameters(i.build())})},getListOfSegmentAsString:function(e){var t=safeAccess(e,"productStats",{}),n="";for(var i in t)n+=i.replace("numberOf","")+" - "+safeAccess(e,"productStats."+i,0)+", ";return n.substr(0,n.length-2)},_getFlightStatus:function(e,t){for(var n="Flight Status - ",i=safeAccess(t,"changes",[]),a=0;a<i.length;a++){var r=i[a];"AY"===r.status&&e.create(n+"Estimated arrival change","true").push(),"DY"===r.status&&e.create(n+"Estimated departure change","true").push(),"SC"===r.status&&e.create(n+"Schedule change","true").push(),"XL"===r.status&&e.create(n+"Cancelled","true").push(),"GD"===r.status&&e.create(n+"Departure gate","true").push(),"TD"===r.status&&e.create(n+"Departure terminal","true").push(),"TA"===r.status&&e.create(n+"Arrival terminal","true").push()}return e},_flatten:function(e,t,n,i){return safeAccess(e,t,[]).map(function(e){var t="";return isDefined(n)&&isDefined(e[n])&&(t+=e[n]),isDefined(i)&&isDefined(e[i])&&(t+=e[i]),t}).join(",")},_toArrayKeys:function(e){var t=[];for(var n in e)t.push(n);return t},getTimeInSecond:function(e){return e?e/1e3:"NA"},getDurationInDays:function(e,t){return isUndefined(t)&&(t=moment()),t&&e?moment(e).diff(t,"days"):"NA"},getSegmentDuration:function(e,t){return isUndefined(t)&&(t=moment()),t&&e?moment(e).diff(t,"minutes"):"NA"},getDurationInHours:function(e,t){
return isUndefined(t)&&(t=moment()),t&&e?moment(e).diff(t,"hours"):"NA"},addedOutsideApp:function(e,t){n.runSafe(function(){for(var i=r.checkAddedOutsideApp(e,t),a=0;a<i.length;a++)this.sendEvent(r.EVENTS.addedOutsideApp,n.extendDefaultParameterWith(r.getTripProperties(i[a]).concat([{name:"Trip added with",value:"Outside app"}])),r.CATEGORY)})},checkAddedOutsideApp:function(e,t){return isUndefined(e)?[]:t.filter(function(t){return 0===e.filter(function(e){return e.tripId===t.tripId}).length})},shared:function(e,t){n.runSafe(function(){var i=n.getPropertiesFactory();i.create("Channel",t).flagMarketing().push(),this.sendEvent(r.EVENTS.shared,n.extendDefaultParameterWith(r.getTripProperties(e),i.build()),r.CATEGORY)})},addedToCalendar:function(e,t){n.runSafe(function(){var i=n.getPropertiesFactory();i.create("Number of imports",safeAccess(t,"itemsAdded","NA")).flagMarketing().push(),i.create("Total items",safeAccess(t,"numberOfItems","NA")).push(),this.sendEvent(r.EVENTS.addedToCalendar,n.extendDefaultParameterWith(r.getTripProperties(e),i.build()),r.CATEGORY)})},flightStatusUpdate:function(e,t){n.runSafe(function(){var i=n.getPropertiesFactory(),a=isDefined(t)?t:[];a.forEach(function(e){i.create("Flight status code",safeAccess(e,"status","-")).push()}),this.sendEvent(r.EVENTS.flightStatusUpdate,n.extendDefaultParameterWith(r.getSegmentProperties(e),i.build()),r.CATEGORY)})},checkinFinished:function(){n.screenView(r.EVENTS.checkinFinished)},checkinStarted:function(e,t){n.runSafe(function(){this.screenView(r.EVENTS.checkinStarted,n.extendDefaultParameterWith(r.getTripProperties(e),r.getSegmentProperties(t)),r.CATEGORY)})},tripDetailsView:function(e){return n.runSafe(function(){var t=this;e.lastName&&i.retrieveTrip(e.tripId,e.lastName).then(function(e){var n=r.getTripProperties(e);t.screenView(r.EVENTS.tripDetailsView,n,r.CATEGORY)})}),t.when(!0)},sharedTripDetailsView:function(e){n.runSafe(function(){var t=this,n=r.getTripProperties(e);t.screenView(r.EVENTS.tripDetailsView,n,r.CATEGORY)})},segmentDetailsView:function(e,a){return n.runSafe(function(){var t=this;i.retrieveTrip(e.tripId,e.lastName).then(function(n){var o=i.getSegmentFromTrip(n,e.segmentRefId);if(a.canCallSegmentFlightStatus(o))a.getSegmentStatus(o).then(function(e){var i=r.getSegmentProperties(o,e);t.screenView(r.EVENTS.segmentDetailsView,r.getTripProperties(n).concat(i),r.CATEGORY)});else{var s=r.getSegmentProperties(o);t.screenView(r.EVENTS.segmentDetailsView,r.getTripProperties(n,s),r.CATEGORY)}})}),t.when(!0)},tripUngroupDisplayed:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.tripUngroupDisplayed,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},tripUngrouped:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.tripUngrouped,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},tripUngroupCancelled:function(e){n.runSafe(function(){this.sendEvent(r.EVENTS.tripUngroupCancelled,n.extendDefaultParameterWith(r.getTripProperties(e)),r.CATEGORY)})},eticketDownloadClicked:function(){n.runSafe(function(){this.sendEvent(r.EVENTS.eTktButtonClicked,n.extendDefaultParameterWith(),r.CATEGORY)})},eticketNewLinkRetrieveSuccess:function(){n.runSafe(function(){this.sendEvent(r.EVENTS.eTktNewLinkRetreived,n.extendDefaultParameterWith(),r.CATEGORY)})},eticketCacheLinkRetrieveSuccess:function(){n.runSafe(function(){this.sendEvent(r.EVENTS.eTktCachedLinkRetreived,n.extendDefaultParameterWith(),r.CATEGORY)})},eticketRetrieveDocumentSuccess:function(){n.runSafe(function(){this.sendEvent(r.EVENTS.eTktDocumentRetrieved,n.extendDefaultParameterWith(),r.CATEGORY)})},toString:function(){return"TripAnalyticsService"}};return r}]),itmngtModule.service("RecoAvailabilitiesService",["$log","$q","RequestService","DataManagerService","I18nService","CurrencyService",function(e,t,n,i,a,r){e=e.getInstance("RecoAvailabilities"),e.info("Service Started...");var o={RECO_AVAILABILITIES_URL_PATH:"v1/tools/getRecoAvailabilities",getRecoAvailabilityForSegments:function(e,n){return r.getDeviceCurrency().then(function(i){return t.all(e.map(function(e,t,a){return o.getRecoAvailabilities({tripId:n,availabilityType:safeAccess(e,"recoType","Taxi"),currencyCode:i||safeAccess(e,"endLocation.currencyCode","EUR"),refIds:e.recoRefIds}).then(function(t){return e._taxiAvailability=null,t.length>0&&(e._taxiAvailability=t[0]),e},function(t){return e._taxiAvailability=null,t.previousAvailabilities.length>0&&(e._taxiAvailability=t.previousAvailabilities[0]),e})}))})},getRecoAvailabilities:function(e){var i=t.defer(),a={tripId:e.tripId,availabilityType:e.availabilityType,currencyCode:e.currencyCode,refIds:e.refIds};return n.post(o.RECO_AVAILABILITIES_URL_PATH,a,"taxi").then(function(e){o._getRecoAvailabilitiesSuccessCallback(e,a,i)},function(e){o._getRecoAvailabilitiesFailureCallback(e,a,i)}),i.promise},_getRecoAvailabilitiesSuccessCallback:function(t,n,i){var r=t.data;if(isDefined(r))if(r.success){var s=r[o._getMdwAvailabilities(n)];angular.isArray(s)||(s=[]),o._setCachedAvailabilities(n,s),i.resolve(s)}else{e.backendError(r);var l=safeAccess(t,"data.errorCodes");a.translateBackendErrorCodes(l).then(function(e){i.reject({errors:e,previousAvailabilities:o._getCachedAvailabilities(n)})})}else i.reject({errors:"No data received",previousAvailabilities:o._getCachedAvailabilities(n)})},_getRecoAvailabilitiesFailureCallback:function(t,n,i){e.httpError(t),a.translateHttpStatusCode(t.status).then(function(e){i.reject({errors:e,previousAvailabilities:o._getCachedAvailabilities(n)})})},_getMdwAvailabilities:function(e){return e.availabilityType.toLowerCase()+"Availabilities"},_getLSkey:function(e){var t=[];return t.push("availabilities"),t.push(e.availabilityType),t.push(e.currencyCode),t.push(e.tripId),t.push(e.refIds.join("-")),t.join("_")},_getCachedAvailabilities:function(e){var t=i.get(o._getLSkey(e),i.LOCALSTORAGE);return angular.isArray(t)||(t=[]),t},_setCachedAvailabilities:function(e,t){i.set(t,o._getLSkey(e),{storage:i.LOCALSTORAGE})},toString:function(){return"RecoAvailabilitiesService"}};return o}]),itmngtModule.service("ActivityRecoAvailabilityService",["$log","$q","RequestService","DataManagerService","I18nService","CurrencyService",function(e,t,n,i,a,r){e=e.getInstance("ActivityRecoAvailabilityService"),e.info("Service Started...");var o={ACTIVITY_RECO_AVAILABILITY_URL_PATH:"v1/tools/findActivity",featureEnabledByDefault:!1,getActivityRecoAvailabilityForSegment:function(e,n){var i=t.defer();return getContext("featureConfig.activityRecoAvailability.enabled",o.featureEnabledByDefault)?r.getDeviceCurrency().then(function(t){return o._getActivityRecoAvailability({location:{code:e.fromLocation.code,cityCode:e.fromLocation.cityCode,name:e.fromLocation.name,cityName:e.fromLocation.cityName},currencyCode:t||safeAccess(e,"fromLocation.currencyCode","EUR"),tripId:n,recoRefIds:e.recoRefIds}).then(function(t){e._activityAvailability=t,i.resolve(e)},function(t){e._activityAvailability=null,t.previousAvailabilities&&(e._activityAvailability=t.previousAvailabilities),i.resolve(e)}),i.promise}):(e._activityAvailability=null,i.resolve(e),i.promise)},_getActivityRecoAvailability:function(e){var i=t.defer(),a={location:e.location,currencyCode:e.currencyCode};return n.post(o.ACTIVITY_RECO_AVAILABILITY_URL_PATH,a).then(function(t){o._getActivityRecoAvailabilitySuccessCallback(t.data,e,i)},function(t){o._getActivityRecoAvailabilityFailureCallback(t,e,i)}),i.promise},_getActivityRecoAvailabilitySuccessCallback:function(t,n,i){if(isDefined(t))if(t.success){var a=t.activity,r=safeAccess(t,"activity.url",null);r&&-1!==r.indexOf("amadeus.mylittleadventure")&&(r=r.replace("amadeus.mylittleadventure","amadeus-desktop.mylittleadventure"),a.url=r),o._setCachedActivity(n,a),i.resolve(a)}else{e.backendError(t);var s=safeAccess(t,"data.errorCodes");i.reject({errors:s,previousAvailabilities:o._getCachedAvailability(n)})}else i.reject({errors:"No data received",previousAvailabilities:o._getCachedAvailability(n)})},_getActivityRecoAvailabilityFailureCallback:function(t,n,i){e.httpError(t),a.translateHttpStatusCode(t.status).then(function(e){i.reject({errors:e,previousAvailabilities:o._getCachedAvailability(n)})})},_getLSKey:function(e){var t=[];return t.push("activity"),t.push(e.currencyCode),t.push(e.tripId),t.push(e.code),t.push(e.cityCode),t.push(e.recoRefIds.join("-")),t.join("_")},_getCachedAvailability:function(e){return i.get(o._getLSKey(e),i.LOCALSTORAGE)},_setCachedActivity:function(e,t){i.set(t,o._getLSKey(e),{storage:i.LOCALSTORAGE})},toString:function(){return"ActivityRecoAvailabilityService"}};return o}]),itmngtModule.service("RecoBackgroundConstructionService",["$log",function(e){e=e.getInstance("RecoBackgroundConstructionService"),e.info("Service Started...");var t={getActivityRecoStyledBackground:function(e){return e&&"Activity"===e.recoType&&e._activityAvailability?{"background-image":"linear-gradient(to bottom, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.4) 100%), url("+e._activityAvailability.thumbnailUrl+")"}:e&&"Activity"===e.recoType?{"background-image":"linear-gradient(to bottom, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.4) 100%), url(./images/activity-reco.png)"}:null},toString:function(){return"RecoBackgroundConstructionService"}};return t}]),itmngtModule.service("TripToolAnalyticsService",["$log","$q","AnalyticsService","TripService","TripAnalyticsService",function(e,t,n,i,a){e=e.getInstance("TripToolAnalyticsService"),e.info("Service Started...");var r={CATEGORY:"TripTool",EVENTS:{print:"Trip print",openedMap:"Trip Tool - Maps"},openMap:function(){n.runSafe(function(){this.sendEvent(r.EVENTS.openedMap,n.extendDefaultParameterWith(),r.CATEGORY)})},printTripView:function(e){return n.runSafe(function(){var t=this;i.retrieveTrip(e.tripId,e.lastName).then(function(e){t.screenView(r.EVENTS.print,a._getTripProperties(e),r.CATEGORY)})}),t.when(!0)},toString:function(){return"TripToolAnalyticsService"}};return r}]),itmngtModule.service("ShareTripInfoService",["$q","$log","ShareService","$interpolate","$rootScope","I18nService","$sce","$templateCache","MenuService","$injector","ImagesService","NetworkService","TripAnalyticsService","SegmentService","RequestService","PromiseService","TripService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v){t=t.getInstance("ShareTripInfoService"),t.info("Service Started...");var h={SUBJECT_LOC_KEY:"itmngt.share.label.subject",TITLE_LOC_KEY:"itmngt.share.label.title",DATE_FORMAT:"itmngt.share.format.dateformat",channels:{EMAIL:"Email",WHATSAPP:"WhatsApp"},SHARE_ID_URL_PATH:"v2/trips/shareTrip",shareSegment:function(t,n){var i=e.defer(),a=[h.TITLE_LOC_KEY,h.SUBJECT_LOC_KEY];return r.translate(a).then(function(e){var a={message:h._buildMessageFromSegment(t,e),subject:h._buildTitleFromSegment(t,e)};h._share(a,n,i)}),i.promise},_share:function(e,t,i){isUndefined(n["shareVia"+t])?i.reject("Channel is not available"):n["shareVia"+t](e).then(function(){i.resolve()},function(e){i.reject(e)})},_buildTitleFromSegment:function(e,t){var n=t[h.SUBJECT_LOC_KEY].replace(/\{0\}/g,h._getTitle(e,t));return n},_buildMessageFromSegment:function(e,t){var n=a.$new(!0);n.segment={title:h._getTitle(e,t),from:h._getFromDate(e,t),to:h._getToDate(e,t)};var r=s.get("itmngt/templates/partial/ShareSegmentPartial.html"),o=i(r.replace(/&apos;/g,"'"))(n);return o},_getFromDate:function(e,t){var n,i=p.getSegmentTypeUpperCased(e);"AIR"===i?n=safeAccess(e,"startDate.utcTimestampMillis"):"HOTEL"===i?n=safeAccess(e,"checkin.utcTimestampMillis"):"CAR"===i&&(n=safeAccess(e,"pickupDateTime.utcTimestampMillis"));var a=t[h.DATE_FORMAT];return moment(n).format(a)},_getToDate:function(e,t){var n,i=p.getSegmentTypeUpperCased(e);"AIR"===i?n=safeAccess(e,"endDate.utcTimestampMillis"):"HOTEL"===i?n=safeAccess(e,"checkout.utcTimestampMillis"):"CAR"===i&&(n=safeAccess(e,"dropoffDateTime.utcTimestampMillis"));var a=t[h.DATE_FORMAT];return moment(n).format(a)},_getTitle:function(e,t){var n,i,a=t[h.TITLE_LOC_KEY],r=p.getSegmentTypeUpperCased(e);"AIR"===r?(n=safeAccess(e,"fromLocation.cityName",!1),i=safeAccess(e,"toLocation.cityName",!1)):"HOTEL"===r?(n=safeAccess(e,"location.cityName",!1),a="{0}"):"CAR"===r&&(n=safeAccess(e,"pickupLocation.cityName",!1),i=safeAccess(e,"dropoffLocation.cityName",!1),a=n===i?"{0}":a);var o=a.replace(/\{0\}/g,n).replace(/\{1\}/g,i);return o},shareReadyTrip:function(n,i){var a=e.defer(),o=[h.TITLE_LOC_KEY,h.SUBJECT_LOC_KEY,h.DATE_FORMAT];return r.translate(o).then(function(e){var r={message:h._buildMessageFromTrip(n,e),subject:h._buildTitleFromTrip(n,e)};if(getContext("featureConfig.share.useBranchIo")&&getContext("isMobileApp",!1))try{var o=c.get("BranchService");o.showShareSheet(n,d.getTripImage(n),r).then(function(e){g.shared(n,e),a.resolve()},function(e){t.error("Branch not initialized. Fallbacking to default share",e),g.shared(n,i),h._share(r,i,a)})}catch(s){t.error("BranchService not available. Fallbacking to default share",s),g.shared(n,i),h._share(r,i,a)}else g.shared(n,i),h._share(r,i,a)}),a.promise},shareTrip:function(t,n){var i=e.defer(),a={tripId:t.tripId,lastName:t.bookingLastName,firstName:t.bookingFirstName,creationDate:t.creationDate};return m.post(h.SHARE_ID_URL_PATH,a).then(function(e){var a=safeAccess(e,"data.success");a?(t.shareId=safeAccess(e,"data.shareId"),t.folderId=safeAccess(e,"data.folderId"),t.creationDate=safeAccess(e,"data.creationDate"),h.shareReadyTrip(t,n).then(function(){v.updateSharedTrip(t).then(function(e){i.resolve(e)})["catch"](function(e){i.reject(e)})})["catch"](function(e){i.reject(e)})):f.rejectDueToBackendError({deferred:i,response:e,method:"shareTrip"})},function(e){f.rejectDueToHttpError({deferred:i,response:e,method:"shareTrip"})})["catch"](handleUnexpectedError),i.promise},_buildTitleFromTrip:function(e,t){var n=t[h.SUBJECT_LOC_KEY].replace(/\{0\}/g,e.title);return n},_buildMessageFromTrip:function(e,t){var n=a.$new(!0),r=t[h.DATE_FORMAT];n.trip={title:e.title,shareId:e.shareId,lastName:encodeURIComponent(e.bookingLastName),firstName:encodeURIComponent(e.bookingFirstName),from:moment(e.startDate.utcTimestampMillis).format(r),to:moment(e.endDate.utcTimestampMillis).format(r)};var o=[];"/"===getContext("server","/")?o.push(window.location.origin+"/"):o.push(getContext("server"));var l=[],c=[];if(getContext("featureConfig.share.cmtUrlEnabled",!1)||!getContext("isB2b",!1)?l=["retrieve",n.trip.shareId]:(o.push(getContext("applicationConfig.entryPoint","cmtweb")+"/?"),c.push("ST="+getContext("SITECODE","NCMTDEMO")),c.push("LN="+getContext("LANGUAGE","GB")),c.push("OCTX="+getContext("OCTX","TCPROD")),o.push(c.join("&")),l=["#/tab/trip-expanded",n.trip.shareId]),o.push(l.join("/")),o.push("/"),n.url=o.join(""),getContext("isMobileApp",!1))return n.url;n.trip.whitelabelname=getContext("featureConfig.whiteLabelInfo.name",getContext("SITECODE"));var d=s.get("itmngt/templates/partial/ShareViaEmailPartial.html"),u=i(d.replace(/&apos;/g,"'"))(n);return u},toString:function(){return"ShareTripInfoService"}};return h}]),itmngtModule.service("AirHelpService",["$log","$q","RequestService","DataManagerService","DateTimeService","I18nService","TripService","$rootScope","AuthenticationService","OrchestratorChiefService","AppLifeCycleService",function(e,t,n,i,a,r,o,s,l,c,d){e=e.getInstance("AirHelp"),e.info("Service Started...");var u={AIR_HELP_URL_PATH:"/v1/tools/checkCompensation",STORAGE_KEY:"AirHelp",isTripEligible:function(e){var t=!1;if(isDefined(e)&&isDefined(e.endDate)&&o.hasAirSegment(e)&&isFeatureEnabled("airhelp")){var n=a.getMomentFromBackendDate(e.endDate),i=moment().diff(n);i>a.decodeTTL("72h")&&(t=!0)}return t},isAirHelpSegmentBlacklisted:function(e){var t=safeAccess(e,"marketingCarrier.code",""),n=getContext("featureConfig.airhelp.blacklistedAirlines",[]);return n.indexOf(t)>-1},cleanCache:function(e){i.remove(u._getKeyFromTripId(e.tripId),i.LOCALSTORAGE)},getCompensationInformation:function(e){var i=t.defer(),a=u.getCachedCompensationInformation(e.tripId);return isDefined(a)?i.resolve(a):n.post(u.AIR_HELP_URL_PATH,{tripId:e.tripId,creationDate:e.creationDate}).then(function(t){u._airHelpSuccessCallback(e,t,i)},function(t){u._airHelpFailureCallback(e,t,i)}),i.promise},getCachedCompensationInformation:function(e){return i.get(u._getKeyFromTripId(e.tripId),i.LOCALSTORAGE)},_airHelpFailureCallback:function(t,n,i){e.httpError(n),r.translateHttpStatusCode(n.status).then(function(e){i.reject({errors:e})})},_getKeyFromTripId:function(e){return"AIRHELP_"+e},_getCacheValidity:function(e){var t=a.getMomentFromBackendDate(e.startDate),n=t.diff(moment());return n>a.decodeTTL("3d")?"3d":n>0?"1d":"12h"},_sendTripDataToAirHelpPlugin:function(e){var t=safeAccess(e,"upcomingTrips",[]);u._parseFinalTripListForAirHelp(t)},_parseFinalTripListForAirHelp:function(t){for(var n=[],i=0;i<t.length;i++){var a=t[i];if(a.segmentStats.numberOfAir>0){var r=safeAccess(a,"tripId",""),o=safeAccess(a,"bookingLastName",""),s=safeAccess(a,"creationDate");if(isDefined(s))var l=safeAccess(a,"creationDate.utcTimestampMillis","");var c=safeAccess(a,"endDate");if(isDefined(c))var d=safeAccess(a,"endDate.utcTimestampMillis","");var g={importedTrip:{tripId:r,lastName:o,creationDate:{utcTimestampMillis:l},endDate:{utcTimestampMillis:d},segments:[]}},p=safeAccess(a,"tripDetails.segments",[]);p=p.filter(function(e){return"Air"===e.type});for(var m=0;m<p.length;m++){var f=safeAccess(p[m],"flight.airlineCode",""),v=safeAccess(p[m],"flight.flightNumber",""),h=safeAccess(p[m],"toLocation.cityName",""),S=safeAccess(p[m],"refId","");if(!u.isAirHelpSegmentBlacklisted(p[m])){var C={flight:{airlineCode:f,flightNumber:v},toLocation:{cityName:h},refId:S};g.importedTrip.segments.push(C)}}n.push(g)}}isDefined(window.cordova.plugins.AirHelpPlugin)&&window.cordova.plugins.AirHelpPlugin.scheduleNotification(n,function(){e.info("Scheduled Air Help Notification Successfully")},function(){e.error("Could not schedule Air Help Notification")})},_deleteAirHelpDataForNotifications:function(){isDefined(window.cordova.plugins.AirHelpPlugin)&&window.cordova.plugins.AirHelpPlugin.deleteAllTrips(function(){e.info("Deleting AirHelp Prefs data returned successfully")},function(){e.error("Deleting AirHelp Prefs data returned error")})},_registerCallbackForAirHelpNotifClick:function(){isDefined(window.cordova.plugins.AirHelpPlugin)&&window.cordova.plugins.AirHelpPlugin.on("clickairhelp",function(e,t){u._onAirHelpNotificationClicked(e,t)})},_onAirHelpNotificationClicked:function(t,n){t.data&&"string"==typeof t.data&&(t.data=JSON.parse(t.data));var i=safeAccess(t,"data.isAirHelpNotif",!1);if(!i)return void e.info("Got a local notif but it was not a airhelp reminder notif; not doing anything.");var a=safeAccess(t,"data.tripData");a&&a.tripId&&a.lastName?(e.info("Navigating to trip details page!"),c.next({tripSelected:a})):e.error("Got a airhelp notif but it did not have enough trip data!")},_initializeAirHelpDataForNotifications:function(){var t=l.getUserAccessToken(),n="itmngt.airHelp.airhelpNotif.textWithCompensation",i="itmngt.airHelp.airhelpNotif.textWithoutCompensation";r.translate([n,i]).then(function(a){n=a[n],i=a[i];var r=[];r.push("LANGUAGE="+getContext("LANGUAGE","GB")),r.push("SITE="+getContext("SITECODE","NCMTNCMT"));var o=getContext("OCTX");isDefined(o)&&r.push("OCTX="+o);var s=getContext("server"),l=getContext("backend"),c=u.AIR_HELP_URL_PATH,d=s+l+c+"?"+r.join("&");if(isDefined(window.cordova.plugins.AirHelpPlugin)){var g={bearer:t,notifString:{withCompensationString:n,withOutCompensationString:i},serverUrl:d};window.cordova.plugins.AirHelpPlugin.init(g,function(){e.info("init of AirHelp plugin successfully returned")},function(){e.error("init of AirHelp plugin failed")})}})},_airHelpSuccessCallback:function(t,n,a){var o=n.data;if(isDefined(o))if(o.success){var s=o.segmentCompensations||[];i.set(s,u._getKeyFromTripId(t.tripId),{storage:i.LOCALSTORAGE,ttl:u._getCacheValidity(t),belongsToUser:!0}),a.resolve(s)}else{e.backendError(o);var l=safeAccess(n,"data.errorCodes");r.translateBackendErrorCodes(l).then(function(e){a.reject({errors:e})})}else a.reject("No data received")}};return d.onAppReady(function(){isFeatureEnabled("airhelp")&&getContext("isMobileApp",!1)&&u._registerCallbackForAirHelpNotifClick()}),s.$on("userLoggedOutEvent",function(e){isFeatureEnabled("airhelp")&&getContext("isMobileApp",!1)&&u._deleteAirHelpDataForNotifications()}),s.$on("triplistUpdatedFromServerWithTripDetailsEvent",function(e,t){isFeatureEnabled("airhelp")&&getContext("isMobileApp",!1)&&u._sendTripDataToAirHelpPlugin(t)}),u}]),itmngtModule.service("NavigationAppsService",["$log","$q","$window","I18nService",function(e,t,n,i){e=e.getInstance("NavigationAppsService"),e.info("Service Started...");var a={MAP_APPLICATIONS_SUPPORTED:["google_maps","apple_maps","waze"],navigate:function(e,a){var r=t.defer(),o=ionic.Platform.isWebView(),s=["itmngt.locateNavigate.text.selectApp","itmngt.locateNavigate.button.cancel","itmngt.locateNavigate.text.remember","itmngt.locateNavigate.text.useForNextTime","itmngt.locateNavigate.button.yes","itmngt.locateNavigate.button.no","itmngt.locateNavigate.text.noSupportedApp"];return a.successCallBack=function(){r.resolve()},a.errorCallback=function(e){r.reject(e)},i.translate(s).then(function(t){if(a.localizationStrings={appSelectionDialogHeaderText:t["itmngt.locateNavigate.text.selectApp"],appSelectionCancelButtonText:t["itmngt.locateNavigate.button.cancel"],rememberChoicePromptDialogHeaderText:t["itmngt.locateNavigate.text.remember"],rememberChoicePromptDialogBodyText:t["itmngt.locateNavigate.text.useForNextTime"],rememberChoicePromptDialogYesButtonText:t["itmngt.locateNavigate.button.yes"],rememberChoicePromptDialogNoButtonText:t["itmngt.locateNavigate.button.no"],errorNoApp:t["itmngt.locateNavigate.text.noSupportedApp"]},o)try{n.launchnavigator.navigate(e,a)}catch(i){r.reject("Exception: "+i.message)}else r.reject("launchnavigator will only work on a real mobile device! It is a NATIVE app launcher.")}),r.promise},getAvailableMapApplications:function(){var e=t.defer(),i=[];return n.launchnavigator.availableApps(function(t){for(var n in t)t[n]===!0&&-1!==a.MAP_APPLICATIONS_SUPPORTED.indexOf(n)&&i.push(n);e.resolve(i)},function(t){e.reject(t)}),e.promise},toString:function(){return"NavigationAppsService"}};return a}]),itmngtModule.service("GetTicketReceiptService",["$log","$q","RequestService","DataManagerService","I18nConfig",function(e,t,n,i,a){e=e.getInstance("GetTicketReceiptService"),e.info("Service Started...");var r={GET_TICKET_RECEIPT_URL_PATH:"v1/trips/getTicketDocumentReceipt",EITR_DOCUMENT_KEY:"EITR_DOCUMENT",TICKET_DOCUMENT_URL_CACHE_TIME:getContext("featureConfig.eitr.ticketDocumentUrlCacheTime","5m"),getStorageKeyForSegment:function(e){var t=a.getCurrentApplicationLanguage();return r.EITR_DOCUMENT_KEY+"_"+t+"_"+e},getTicketDocumentUrlFromLocalStorage:function(e){var t=r.getStorageKeyForSegment(e),n=i.get(t,i.LOCALSTORAGE);return n},setTicketDocumentUrlToLocalStorage:function(e,t){var n=r.getStorageKeyForSegment(t);i.set(e,n,{storage:i.LOCALSTORAGE,belongsToUser:!0,ttl:r.TICKET_DOCUMENT_URL_CACHE_TIME})},removeTicketDocumentUrlFromLocalStorage:function(e){var t=r.getStorageKeyForSegment(e);i.remove(t,i.LOCALSTORAGE)},getTicketDocumentReceipt:function(i,o){var s=t.defer(),l=a.getCurrentApplicationLanguage(),c={ticketNumberlist:i,languageCode:l};return n.post(r.GET_TICKET_RECEIPT_URL_PATH,c).then(function(t){var n=safeAccess(t,"data.success"),i=safeAccess(t,"data.documentURL");n&&i?(r.setTicketDocumentUrlToLocalStorage(i,o),s.resolve(i)):(e.error("getTicketDocumentReceipt: failed to retrieve URL",safeAccess(t,"data.errors")),s.reject())},function(t){e.error("getTicketDocumentReceipt: rejecting promise due to backend error",t),s.reject(t)}),s.promise},toString:function(){return"GetTicketReceiptService"}};return r}]),itmngtModule.service("DeleteTripMenuHandler",["$log","$ionicHistory","LayoutService","TripService","I18nService","MenuService","TriplistService","OrchestratorChiefService",function(e,t,n,i,a,r,o,s){e=e.getInstance("DeleteTripMenuHandler"),e.info("Handler Started...");var l={init:function(){r.addDestructiveItem({icon:"icon-delete",name:"deleteTrip",label:"itmngt.button.removeFromTriplist",condition:function(e){return isDefined(safeAccess(e,"segmentStats"))}}).then(function(e){e.onClick(function(e){l.deleteTrip(e)})})},deleteTrip:function(r){a.translate(["itmngt.title.removeTrip","itmngt.button.cancel","itmngt.button.remove","itmngt.text.removeTripMessage"],{TRIP_TITLE:'"'+r.title+'"'}).then(function(a){n.showConfirmPopup(a["itmngt.title.removeTrip"],a["itmngt.text.removeTripMessage"],a["itmngt.button.remove"],a["itmngt.button.cancel"]).then(function(){n.startLoading(),i.deleteTrip(r.tripId).then(function(){n.stopLoading(),o.refreshTriplistOnNextDisplay(),t.nextViewOptions({disableBack:!1,historyRoot:!0}),t.clearCache(),s.next({tripDeleted:!0})},function(t){e.error(t),n.stopLoading(),n.toastError(t)})["catch"](handleUnexpectedError)})})}};return l}]),itmngtModule.service("UngroupTripMenuHandler",["$log","$rootScope","MenuService","LayoutService","I18nService","TripAnalyticsService","$ionicHistory","$ionicModal","TripService","OrchestratorChiefService","TriplistService","DateTimeService","SegmentService",function(e,t,n,i,a,r,o,s,l,c,d,u,g){e=e.getInstance("UngroupTripMenuHandler"),e.info("Handler Started...");var p={currentTrip:null,init:function(){n.addItem({icon:"icon-split",name:"ungroupTrip",label:"itmngt.button.ungroupTrip",condition:function(e){return getContext("featureConfig.trip.ungroupTripEnabled",!1)&&"Read"!==e.accessRight&&e.associatedRecords.length>1}}).then(function(e){e.onClick(function(e){p.currentTrip=e,r.tripUngroupDisplayed(e),p.showUngroupTripModal(e)})})},ungroupTripPreview:function(e){var t=e,n=[];return t.associatedRecords.length>1&&t.associatedRecords.forEach(function(e){var i=t.tripDetails.segments.filter(function(t){return t.recLocFromRefId===e&&"Reco"!==t.type});i=p.orderUngroupedTripsByDate([].concat(i),!0),n.push(i)}),p.orderUngroupedTripsByDate(n,!1)},orderUngroupedTripsByDate:function(e,t){var n=[];if(n.push(e[0]),e.length>1)for(var i=1;i<e.length;i++)for(var a=0;a<n.length;a++){var r,o;if(t?(r=e[i],o=n[a]):(r=e[i][0],o=n[a][0]),p.checkETRorTripDateOrder(r,o)){n.splice(a,0,e[i]);break}if(a==n.length-1){n.push(e[i]);break}}return n},checkETRorTripDateOrder:function(e,t){var n=[];return n.push(e,t),n.forEach(function(e){switch(e.type){case"Train":case"Meeting":case"Activity":case"Air":e.date=e.startDate.utcTimestampMillis;break;case"Car":e.date=e.pickupDateTime.utcTimestampMillis;break;case"Hotel":e.date=e.checkin.utcTimestampMillis}}),n[0].date<n[1].date},showUngroupTripModal:function(n){var u=t.$new();u.tripUngrouped=p.ungroupTripPreview(n),s.fromTemplateUrl("itmngt/templates/partial/UngroupTripModal.html",{scope:u,backdropClickToClose:!1}).then(function(t){u.trip=n,u.SegmentService=g,u.TripAnalyticsService=r,u.cancelUngroup=function(){r.tripUngroupCancelled(u.trip),i.removeModal(t).then(function(){u=null,c.unregisterNavigateBackFromModal()})},u.alertUngroup=function(){a.translate(["itmngt.button.ungroup","itmngt.text.ungroupTripInfoMessage"]).then(function(e){i.showAlertPopup(e["itmngt.button.ungroup"],e["itmngt.text.ungroupTripInfoMessage"])})},u.onUngroupTripSuccess=function(){d.refreshTriplistOnNextDisplay(),o.nextViewOptions({disableBack:!1,historyRoot:!0}),o.clearCache(),c.next({tripUngrouped:!0})},u.ungroupTrip=function(){r.tripUngrouped(u.trip),a.translate(["itmngt.text.ungroupTripLoadingMessage"]).then(function(n){i.startLoading(!1,n["itmmgt.text.ungroupTripLoadingMessage"]),l.ungroupTrip(u.trip.tripId).then(function(){i.stopLoading(),i.removeModal(t).then(function(){u.onUngroupTripSuccess(),c.unregisterNavigateBackFromModal(),u=null})},function(t){e.error(t),i.stopLoading(),i.toastError("itmngt.error.ungroupTripError")})["catch"](handleUnexpectedError)})},i.showModal(t),c.registerNavigateBackFromModal()})}};return p}]),itmngtModule.service("AddTripMenuHandler",["$log","$rootScope","MenuService","$ionicModal","LayoutService","AnalyticsService","NetworkService","$q","AuthenticationService","OrchestratorChiefService","TriplistService",function(e,t,n,i,a,r,o,s,l,c,d){e=e.getInstance("AddTripMenuHandler"),e.info("Handler Started...");var u={ERR_ADD_TRIP_USER_CLOSED_MODAL:"ERR_ADD_TRIP_USER_CLOSED_MODAL",ERR_ADD_TRIP_NO_INTERNET_CONNECTIVITY:"ERR_ADD_TRIP_NO_INTERNET_CONNECTIVITY",addTripModal:null,init:function(){t.$on("showAddTripModalEvent",function(e,t){var n=l.getUser();t.prefillData=t.prefillData||{firstName:safeAccess(n,"firstName"),lastName:safeAccess(n,"lastName")},u.showDialog(t)}),t.$on("$stateChangeStart",function(){u.addTripModal&&a.removeModal(u.addTripModal)}),n.addItem({icon:"icon-plus",name:"addTrip",label:"itmngt.title.addTripMenuItem",condition:function(e){return u.isAddTripEnabled()}}).then(function(e){e.onClick(function(e){var t=l.getUser(),n={event:this,disabled:function(e){isDefined(this.event.target)&&(this.event.target.disabled=e)},prefillData:{firstName:safeAccess(t,"firstName"),lastName:safeAccess(t,"lastName")}};u.showDialog(n)})})},isAddTripEnabled:function(){return!getContext("featureConfig.trip.hideImportTrip",!1)&&l.isLogged()},closeModal:function(){return a.removeModal(u.addTripModal)},onAddTripCancel:function(){return u.closeModal()},onAddTripSuccess:function(e){var t={firstName:e.bookingFirstName,lastName:e.bookingLastName,tripId:e.tripId};return u.closeModal().then(function(){d.refreshTriplistOnNextDisplay(),c.next({tripImported:t})})},showDialog:function(n){n=n||{};var l=s.defer();if(o.hasConnectivity(!0).isOnline){isDefined(n.disabled)&&n.disabled(!0);var c=t.$new();c.prefillData=n.prefillData||{},c.triggerValidation=n.triggerValidation||!1,c.onAddTripCancel=function(){u.onAddTripCancel(),l.reject(u.ERR_ADD_TRIP_USER_CLOSED_MODAL)},c.onAddTripSuccess=function(e){u.onAddTripSuccess(e),l.resolve(e)},i.fromTemplateUrl("itmngt/templates/pages/AddTripModal.html",{scope:c,animation:"slide-in-up",focusFirstInput:!1}).then(function(e){u.addTripModal=e,a.showModal(u.addTripModal).then(function(){isDefined(n.disabled)&&n.disabled(!1)})}),r.screenView("Add trip")}else e.warn("No internet connectivity, aborting the display of add trip modal!"),l.reject(u.ERR_ADD_TRIP_NO_INTERNET_CONNECTIVITY);return l.promise}};return u}]),itmngtModule.service("AddToCalendarMenuHandler",["$log","$rootScope","MenuService","LayoutService","AddToCalendarService","$ionicPopup","I18nService","TripAnalyticsService",function(e,t,n,i,a,r,o,s){e=e.getInstance("AddToCalendarMenuHandler"),e.info("Handler Started...");var l={icon:"icon-calendar2",name:"addToCalendar",label:"itmngt.addToCalendar.button.addToCalendar",condition:function(e){return isFeatureEnabled("addToCalendar")&&safeAccess(e,"tripId",!1)}};return n.addItem(l).then(function(e){e.onClick(function(e){if(getContext("isMobileApp")&&a.isCalendarPluginAvailable)a._calendarToUse=void 0,a.addTripToCalendar(e).then(function(e){var t=e.value;t.numberOfItems===t.itemsAdded?i.toast("itmngt.addToCalendar.text.addToCalendarSuccessfully"):t.numberOfItems===t.itemsInError?i.toastError("itmngt.addToCalendar.text.addToCalendarFailed"):i.toastError("itmngt.addToCalendar.text.addToCalendarWithErrors")},function(e){"noCalendarAvailable"!==e.errorCode&&"noReadWritePermissions"!==e.errorCode||i.toastError("itmngt.addToCalendar.error.noCalendarAvailable","itmngt.addToCalendar.error.noCalendarAvailableTitle")});else if(getContext("isWebDesktop")&&isDefined(e.calendarId)){var t=a.desktopSupportedSegmentsStats(e);t.desktopSupportedSegments>0?(i.loading(!0),a.getICSContent(e).then(function(n){if(i.loading(!1),isDefined(window.Blob)&&isDefined(window.saveAs)){var a=getContext("featureConfig.whiteLabelInfo.name","CheckMyTrip")+"-"+e.title+".ics",l="itmngt.addToCalendar.text.calendarCreatedSuccessfully";if(t.desktopSupportedSegments!==t.numberOfSegmentsInTrip&&(l="itmngt.addToCalendar.text.calendarCreatedPartially"),!window.isSafari()||window.getBrowserVersion()>10.1){
var c=new window.Blob([n],{type:"text/calendar;charset=utf-8"});window.saveAs(c,a),i.toast(l),s.addedToCalendar(e)}else{var d="\ufeff"+n,u="data:text/calendar;charset=utf-8,"+encodeURIComponent(d),g="itmngt.addToCalendar.title.downloadICS",p="itmngt.addToCalendar.link.downloadICS",m="core.button.discard";o.translate([g,l,p,m]).then(function(e){r.alert({title:e[g],template:'<p class="download-link"/>'+e[l]+'<a download="'+a+'" href="'+u+'"/>'+e[p]+"</a></p>",okText:e[m]})})}}else i.toastError("itmngt.addToCalendar.text.navigatorNotSupported")},function(e){i.loading(!1),i.toastError("itmngt.addToCalendar.text.calendarCreationFailed")})):i.toastError("itmngt.addToCalendar.text.calendarCreationFailed")}else i.toastError("itmngt.addToCalendar.text.calendarCreationFailed")})}),{noop:function(){}}}]),itmngtModule.service("ShareTripInfoMenuHandler",["MenuService","NetworkService","ShareTripInfoService","$log","$rootScope","$ionicModal","$ionicHistory","LayoutService","TripService","$timeout","OrchestratorChiefService",function(e,t,n,i,a,r,o,s,l,c,d){i=i.getInstance("ShareTripInfoMenuHandler"),i.info("Handler Started...");var u={init:function(){e.addItem({icon:"icon-share",name:"shareTrip",label:"itmngt.share.button.shareTrip",condition:function(e){return getContext("featureConfig.share.enabled",!1)&&safeAccess(e,"tripId",!1)&&!l.isReadOnly(e)}}).then(function(e){e.onClick(function(e){t.hasConnectivity(!0).isOnline&&u._shareTrip(e)})}),e.addItem({icon:"icon-share",name:"shareSegment",label:"itmngt.share.button.shareSegment",condition:function(e){return["AIR","CAR","HOTEL"].indexOf(e.type)>-1&&getContext("isMobileApp")&&getContext("featureConfig.share.segment.enabled")}}).then(function(e){e.onClick(function(e){t.hasConnectivity(!0).isOnline&&n.shareSegment(e,n.channels.EMAIL).then(function(){i.info("Segment shared")},function(e){i.error("Segment not shared for:",e)})})})},_shareTrip:function(e){s.startLoading(),n.shareTrip(e,n.channels.EMAIL).then(function(t){i.info("Trip shared"),s.stopLoading(),t.tripId!==e.tripId&&(o.nextViewOptions({disableBack:!1,historyRoot:!0}),o.clearCache(),d.next({tripSelected:{tripId:t.tripId,lastName:t.bookingLastName,firstName:t.bookingFirstName}}))},function(e){i.error("Trip not shared for:",e),s.stopLoading(),s.toastError(e)})},_shareFolder:function(e){var t=[];t=t.concat(e.tripDetails.segments),t=t.concat(e.tripDetails.services);for(var n={},i=0;i<t.length;i++){var o=safeAccess(t[i],"systemRefIds[0].number");isDefined(o)&&(isDefined(n[o])?n[o].push(t[i]):n[o]=[t[i]])}c(function(){var t=a.$new();r.fromTemplateUrl("itmngt/templates/partial/FolderSharePartial.html",{scope:t}).then(function(i){var r=[];for(var o in n)r.push({pnrRecloc:o,segmentsAndServices:n[o]});t.groupedPnrs=r,t.disableConfirm=!0,t.closeicon=a.closeicon,t.cancelShare=function(){s.removeModal(i)},t.selectPnr=function(e){t.selectedPnr=e,t.disableConfirm=!1},t.confirmPnr=function(){s.startLoading();for(var n,a,r=t.selectedPnr.pnrRecloc,o=t.selectedPnr.segmentsAndServices,c=0;c<o.length;c++){var d=safeAccess(o[c],"travellers[0]");if(isDefined(d)&&isDefined(d.lastName)&&isDefined(d.firstName)){n=d.lastName,a=d.firstName;break}}(isUndefined(n)||isUndefined(a))&&(n=e.bookingLastName,a=e.bookingFirstName),n=n.toUpperCase(),a=a.toUpperCase(),l.importTripForShare({tripId:r,lastName:n,firstName:a}).then(function(e){s.stopLoading(),s.removeModal(i).then(function(){u._shareTrip(e),t=null})},function(e){s.stopLoading(),s.toastError("itmngt.share.error.shareFolderImportTripError")})},s.showModal(i)})})}};return u}]),itmngtModule.service("PrintTripMenuHandler",["$rootScope","$log","MenuService","TripToolAnalyticsService","$stateParams",function(e,t,n,i,a){t=t.getInstance("PrintTripMenuHandler"),t.info("Handler Started...");var r={init:function(){n.addItem({icon:"icon-print",name:"printTrip",label:"itmngt.button.printTrip",condition:function(e){return isFeatureEnabled("print")&&safeAccess(e,"tripId",!1)}}).then(function(e){e.onClick(function(e){i.printTripView({tripId:a.tripId,lastName:a.lastName,firstName:a.firstName}).then(function(){window.print()})})})}};return r}]),itmngtModule.controller("TriplistController",["$scope","TriplistService","$log","LayoutService","ImagesService","OrchestratorChiefService","EasterEggService","$timeout","TripService","TriplistCacheService","$rootScope","ClipboardService","I18nService","$ionicScrollDelegate","AdvertisementService","JsAdvertisementService","$q","DateTimeService","AdvertisementAnalyticsService","ngProgressFactory","AirHelpService","AuthenticationService","DataManagerService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v,h,S,C,T,b,E){function A(e){e.forEach(function(e){var t=getContext("featureConfig.trip.destinationImageSize");a.getAndInjectCardImage(e,!0,t).then(function(t){e.bgImageClass=t.cssClassName},function(e){n.warn("loadCardBackgroundImages failure: "+e)})})}function y(t){t=t||[];var n,i,a=t.length;if(0!==a){for(n=0;a>n;n++)i=t[n],i.isFirstNonPastTrip=!1,i.isMostRecentPastTrip=!1;for(n=0;a>n;n++){i=t[n];var r=l.isPastTrip(i);if(!r){i.isFirstNonPastTrip=!0,e.displayAdAfterTripId=i.tripId;var o=t[n-1];return void(o&&(o.isMostRecentPastTrip=!0))}t.length===n+1&&isUndefined(e.displayAdAfterTripId)&&(e.displayAdAfterTripId=i.tripId)}t[a-1].isMostRecentPastTrip=!0}}function L(e){e=e||[],e.forEach(function(e){if(T.isTripEligible(e)){var t=T.getCachedCompensationInformation(e);t&&t.length>0?(e.airHelpData={},1===t.length&&(e.airHelpData=t[0])):e.airHelpData=null}})}function D(){var e=document.getElementById("triplistScrollHandle"),t=document.getElementById("recentPastTripVirtualAnchor");if(t&&e){var n=t.getBoundingClientRect().top-e.getBoundingClientRect().top;n-=10,p.scrollTo(0,n,!0)}}function _(a,r,o){var s=a.isSilent?a.isSilent:!1;t.getUpcomingTripList(a.getUpcomingTripListOptions).then(function(t){var n=t.trips;e.showEmptyTripList=O(n),e.tripLoadCompleted=!0,x(n,a,!1),e.trips=n,N(!1,o),r.resolve(t)},function(t){n.error("Fail with:"+t),e.tripLoadCompleted=!0,N(!1,o),s||i.toastError(t),r.reject(t)})["catch"](handleUnexpectedError)}function w(e){e?i.showDomElement(document.getElementById("loadPastTripsButton")):i.hideDomElement(document.getElementById("loadPastTripsButton"))}if(n=n.getInstance("TriplistController"),n.info("Controller Started..."),e.forwardTripEmail=getContext("featureConfig.timeline.forwardemail",""),e.emailForwardEnabled=getContext("featureConfig.trip.emailForwardEnabled",!0),e.pullToRefreshEnabled=getContext("applicationConfig.pullToRefreshEnabled",!0),e.arePastTripsDisplayed=!1,e.werePastTripDisplayed=!1,e.displayAdAfterTripId=null,e.disableLoadPastTrip=!1,e.trips=[],e.isWebDesktop=getContext("isWebDesktop",!1),e.advertisementBanner={adContainerId:"timelineAdBannerJavascriptAdContainer",scriptContainerId:"timelineAdBannerJavascript"},e.showEmptyTripList=!0,isFeatureEnabled("progressBar")){var I=C.createInstance();I.setColor(getContext("featureConfig.progressBar.color","#309712")),I.setParent(document.getElementById("triplist-progress-bar"))}var M=null,k=getContext("featureConfig.trip.emptyTriplistBackground",!1);e.pastTripMenu=getContext("featureConfig.trip.pastTripMenu",!1),e.tripLoadCompleted=getContext("featureConfig.trip.tripLoadCompleted",!0),e.$on("$ionicView.beforeEnter",function(t,i){i.fromCache&&(n.info("TriplistView was rendered from cache! Repainting the triplist to assure having fresh data"),e.loadUpcomingTrips({getUpcomingTripListOptions:{forceFromServer:!1}}),e.advertisementBanner&&(e.advertisementBanner=f.resetAdvertisementModel(e.advertisementBanner)),d.$emit("clearSSRShoppingCartEvent")),k&&F()});var R=!1,P=function(){var e=R;return R=!1,e};e.$on("$ionicView.enter",function(){M=d.$on("paramsUpdates",function(t,n){e.forwardTripEmail=getContext("featureConfig.timeline.forwardemail","")});var n=t.shouldRefreshTriplistOnNextDisplay();n&&(R=!0,e.refreshTripList({isSilent:!0})),e.reloadAdvertisement(),e.hideBackButton()}),e.$on("$ionicView.afterEnter",function(t,n){e.werePastTripDisplayed&&p.scrollTo(0,0,!0),e.werePastTripDisplayed=!1}),e.headerPrimaryButtonClick=function(){e.refreshTripList()},e.menuList=getContext("applicationConfig.menu.tripListMainItems",[]),e.menuStyle=i.getMainMenuStyle(),e.reloadAdvertisement=function(){var n=v.defer(),i=getContext("featureConfig.timelineAdvertisement.enabled",!1);if(i){var a=getContext("featureConfig.timelineAdvertisement.sendTripThatStartInLessThan");t.getFirstOngoingOrUpcoming(a).then(function(t){var i=safeAccess(t,"tripId");e.isWebDesktop?e._reloadDesktopAdvertisement(n,i):e._reloadMobileAdvertisement(n,i)})}else n.reject("Timeline advertisement is not enabled");return n.promise},e._reloadMobileAdvertisement=function(t,i){var r=[{id:"banner",page:"timeline",type:"banner",tripId:i},{id:"leaderboard",page:"timeline",type:"leaderboard",tripId:i}],o={sendGeolocation:getContext("featureConfig.timelineAdvertisement.sendGeolocation"),requestTimeout:getContext("featureConfig.timelineAdvertisement.requestTimeout")};m.getAdvertisement(r,o).then(function(i){for(var r,o,s,l=!1,c=0;c<i.length;c++){var d=i[c];if(isDefined(d.mediaUrl)&&isDefined(d.refUrl)&&(r=d.mediaUrl,o=d.refUrl,s=d.id),"banner"===d.id&&isDefined(r)&&isDefined(o)){l=!0;break}}isDefined(r)&&isDefined(o)?(S.adDisplayed(s),a.preloadImage(r).then(function(t){var n=l?100:50;e.advertisementBanner={hasAdvertisement:!0,cardStyle:{height:n+"px"},isImage:!0,advertisementSrc:t,link:o}},function(){t.reject("Image could not be loaded")})):n.info("Not displaying the timeline ad banner because mediaUrl or refUrl is not defined"),t.resolve()},function(e){t.reject(e)})},e._reloadDesktopAdvertisement=function(t,n){var i={page:"timeline",type:"billboard",tripId:n,adContainerId:e.advertisementBanner.adContainerId,scriptContainerId:e.advertisementBanner.scriptContainerId},a={requestTimeout:getContext("featureConfig.timelineAdvertisement.requestTimeout")};f.getAdvertisement(i,a).then(function(n){n?(e.advertisementBanner=n,t.resolve()):t.reject("no ad returned")})},e.onAdBannerImageClick=function(){m.onAdBannerClick(e.advertisementBanner)},e.loadUpcomingTrips=function(e){e=e||{};var t=e.fromPullToRefresh?e.fromPullToRefresh:!1,n=v.defer();return N(!0,t),getContext("isMobileApp")&&ionic.Platform.isIOS()&&!b.getUserAccessToken()?E.getSecureAsync(b.ACCESS_TOKEN_STORAGE_KEY).then(function(i){isDefined(i)&&(b._storeUserAccessToken(i),_(e,n,t))}):_(e,n,t),n.promise};var x=function(t,n,i){y(t),A(t),L(t);var a=e.arePastTripsDisplayed;e.arePastTripsDisplayed=i,w(!i),(n.forceAdvertisementRefresh||safeAccess(n,"getFullTripListOptions.forceFromServer",!1))&&(e.advertisementBanner=f.resetAdvertisementModel(e.advertisementBanner),e.reloadAdvertisement()),a||e.$$postDigest(function(){e.advertisementBanner=f.reInjectAdvertisement(e.advertisementBanner),s(D,100)})};e.loadPastTripButtonClick=function(){s(function(){e.loadPastTrips({forceAdvertisementRefresh:!0}),e.werePastTripDisplayed=!0},100)};var N=function(t,n,a){t?(a&&isDefined(I)?I.start():i.startLoading(n),e.disableLoadPastTrip=e.pullToRefreshEnabled=n):(a&&isDefined(I)?I.complete():i.stopLoading(n,e),e.pullToRefreshEnabled=getContext("applicationConfig.pullToRefreshEnabled",!0),e.disableLoadPastTrip=!1)};e.loadPastTrips=function(a){a=a||{},a.forceFromServer=P();var r=a.fromPullToRefresh?a.fromPullToRefresh:!1,o=a.isSilent?a.isSilent:!1;N(!0,r,isFeatureEnabled("progressBar")),t.getPastTripList(a).then(function(t){var n=t.trips;e.showEmptyTripList=O(n),e.tripLoadCompleted=!0,x(n,a,!0),e.trips=n.concat(e.trips),e.showEmptyTripList=O(e.trips),N(!1,r,isFeatureEnabled("progressBar"))},function(t){e.tripLoadCompleted=!0,n.error(t),N(!1,r,isFeatureEnabled("progressBar")),o||i.toastError(t)})["catch"](handleUnexpectedError)};var O=function(e){return!(0===e.length&&k)};e.loadAllTrips=function(a){a=a||{};var r=a.fromPullToRefresh?a.fromPullToRefresh:!1,o=a.isSilent?a.isSilent:!1;N(!0,r),t.getFullTripList(a.getFullTripListOptions).then(function(t){var n=t.trips;e.showEmptyTripList=O(n),e.tripLoadCompleted=!0,x(n,a,!0),e.trips=n,N(!1,r)},function(t){n.error(t),e.tripLoadCompleted=!0,N(!1,r),o||i.toastError(t)})["catch"](handleUnexpectedError)},e.refreshTripList=function(t){t=t||{};var n=isDefined(t.forceFromServer)?!!t.forceFromServer:!0,i=isDefined(t.fromPullToRefresh)?!!t.fromPullToRefresh:!1,a=isDefined(t.isSilent)?!!t.isSilent:!1;e.arePastTripsDisplayed?e.loadAllTrips({fromPullToRefresh:i,isSilent:a,getFullTripListOptions:{forceFromServer:n}}):e.loadUpcomingTrips({fromPullToRefresh:i,isSilent:a,getUpcomingTripListOptions:{forceFromServer:n}})},e.pullToRefresh=function(){e.refreshTripList({fromPullToRefresh:!0})},e.tryCopyingEmailToClipboard=function(e){u.copyToClipboard(".forward-trip-email",e).then(function(){g.translate("itmngt.text.emailCopiedToClipboard").then(function(e){i.toast(e)})})},e.handleEasterEgg=function(){o.handleEasterEgg()},e.tripExpanded=function(e){r.next({tripSelected:e})},e.getBackgroundImageUrl=function(){if(getContext("isMobileApp"))return"../www/images/mobileTripListBackground.jpg";var e=getContext("cdnHost","");return getContext("applicationConfig.isWebDesktop")?e+getContext("SITECODE")+"/images/desktopTripListBackground.jpg":e+getContext("SITECODE")+"/images/mobileTripListBackground.jpg"};var F=function(){var t=e.getBackgroundImageUrl();isDefined(t)?e.isTripListBackgroundImageAvailable=!0:e.isTripListBackgroundImageAvailable=!1};e.onControllerLoad=function(){e.advertisementBanner=f.resetAdvertisementModel(e.advertisementBanner);var n=r.getPreviousView();if(isDefined(n)&&"login"===n.stateName)s(function(){e.loadUpcomingTrips({forceAdvertisementRefresh:!0,fromPullToRefresh:!1,isSilent:!0,getUpcomingTripListOptions:{forceFromServer:!1}})},1e3);else{var i=c.getLastServerCallDate("Future");i?e.loadUpcomingTrips({fromPullToRefresh:!1,isSilent:!0,getUpcomingTripListOptions:{forceFromServer:!1}}).then(function(n){var a=t.shouldRefreshTriplistOnNextDisplay();0!==n.trips.length||n.hasPastTrips||(a=!0);var r=getContext("featureConfig.timeline.refreshTriplistEvery","3h");r=h.decodeTTL(r),(i.diff()<-r||a)&&(R=!0,e.refreshTripList({isSilent:!0}))}):e.refreshTripList({isSilent:!0})}},e.hideBackButton=function(){if(!isDesktop())for(var e=document.querySelectorAll("button[default-nav-back-button]")||{},t=0;t<e.length;t++)e[t].classList.add("hide"),e[t].classList.remove("showBackButton")},e.onControllerLoad()}]),itmngtModule.controller("PastTripsController",["$scope","TriplistService","$log","LayoutService","ImagesService","OrchestratorChiefService","AirHelpService",function(e,t,n,i,a,r,o){function s(e){e.forEach(function(e){var t=getContext("featureConfig.trip.destinationImageSize");a.getAndInjectCardImage(e,!0,t).then(function(t){e.bgImageClass=t.cssClassName},function(e){n.warn("loadCardBackgroundImages failure: "+e)})})}function l(e){e=e||[],e.forEach(function(e){if(o.isTripEligible(e)){var t=o.getCachedCompensationInformation(e);t&&t.length>0?e.airHelpData=t[0]:e.airHelpData=null}})}n=n.getInstance("PastTripsController"),n.info("Controller Started..."),e.trips=[],e.$on("$ionicView.enter",function(){e.loadPastTrips({forceFromServer:!0})}),e.loadPastTrips=function(a){i.loading(!0),a=a||{};var r=a.isSilent?a.isSilent:!1;t.getPastTripList(a).then(function(t){e.trips=t.trips,s(e.trips),l(e.trips),i.loading(!1)},function(e){n.error(e),i.loading(!1),r||i.toastError(e)})["catch"](handleUnexpectedError)},e.pastTripExpanded=function(e){r.navigateTo("past-trip-expanded",e)},e.onControllerLoad=function(){e.loadPastTrips({forceFromServer:!0})},e.onControllerLoad()}]),itmngtModule.controller("TripExpandedController",["$rootScope","$scope","$controller","TriplistCacheService","TripService","$ionicModal","AddTripMenuHandler","JsAdvertisementService","TriplistService","$log","LayoutService","$stateParams","ImagesService","FlightStatusService","I18nService","$q","$timeout","$ionicHistory","OrchestratorChiefService","$sce","SmartCheckinService","SegmentService","DataManagerService","NavigationAnalyticsService","TripAnalyticsService","RecoAvailabilitiesService","CurrencyService","AirHelpService","$ionicScrollDelegate","GetTicketReceiptService","NetworkService","ActivityRecoAvailabilityService","RecoBackgroundConstructionService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v,h,S,C,T,b,E,A,y,L,D,_,w,I,M,k,R){function P(e){return"RECO"===safeAccess(e,"type","").toUpperCase()}function x(e,t){return t=t||"",P(e)&&safeAccess(e,"recoType","").toUpperCase()===t.toUpperCase()}function N(e){return t.nowTimestamp>safeAccess(e,"displayTimeWindow.startDateTime.utcTimestampMillis")&&t.nowTimestamp<safeAccess(e,"displayTimeWindow.endDateTime.utcTimestampMillis")}function O(e,t){return t&&N(e)}function F(e,n,i,a,r){var o=36e5,s=r&&t.nowTimestamp<r.utcTimestampMillis-o;if(s&&t.loungeRecoEnabled){var l=n&&n>=2&&e.inLayover,c=i&&i>=2,d=a===e.recoRefIds[0].split("-").slice(0,-1).join("-");if((l||c)&&d&&!t.loungeRecoAlreadyDisplayed)return t.loungeRecoAlreadyDisplayed=!0,!0}return!1}function U(e){var n,i,a,r;return t.loungeRecoAlreadyDisplayed=!1,e.filter(function(e){return x(e,"Taxi")?O(e,t.taxiRecoEnabled):!0}).filter(function(e){return x(e,"Activity")?O(e,t.activityRecoEnabled):!0}).filter(function(e){return x(e,"Hotel")?t.hotelRecoEnabled:!0}).filter(function(e){return x(e,"Parking")?O(e,t.parkingRecoEnabled):!0}).filter(function(t){if("layover"===t.type.toLowerCase()){var o=B(e,t),s=p._getRealEndDate(o[0]),l=p._getRealStartDate(o[1]);a=o[1].refId;var c=o[1].startDate;i=l.utcTimestampMillis-c.utcTimestampMillis,n=l.utcTimestampMillis-s.utcTimestampMillis,i=Math.floor(i/36e5%24),n=Math.floor(n/36e5%24),r=l}if("air"===t.type.toLowerCase()){var d=p.getCachedFlightStatus(t.refId);isDefined(d)&&d.length>0&&(t.scheduledDepartureDate=d[0].scheduledDeparture,t.estimatedDepartureDate=d[0].estimatedDeparture,t.scheduledArrivalDate=d[0].scheduledArrival,t.estimatedArrivalDate=d[0].estimatedArrival),a=t.refId,r=p._getRealStartDate(t),i=Math.floor((r.utcTimestampMillis-t.startDate.utcTimestampMillis)/36e5%24)}return x(t,"Lounge")?F(t,n,i,a,r):!0})}function B(e,t){var n,i,a;return e.forEach(function(e){e.refId===t.layoverRefIds[0]&&(n=p.getCachedFlightStatus(e.refId),i=e,isDefined(n)&&n.length>0&&(i.scheduledDepartureDate=n[0].scheduledDeparture,i.scheduledArrivalDate=n[0].scheduledArrival,i.estimatedDepartureDate=n[0].estimatedDeparture,i.estimatedArrivalDate=n[0].estimatedArrival)),e.refId===t.layoverRefIds[1]&&(n=p.getCachedFlightStatus(e.refId),a=e,isDefined(n)&&n.length>0&&(a.scheduledDepartureDate=n[0].scheduledDeparture,a.scheduledArrivalDate=n[0].scheduledArrival,a.estimatedDepartureDate=n[0].estimatedDeparture,a.estimatedArrivalDate=n[0].estimatedArrival))}),[].concat([i,a])}function $(e,t){e.forEach(function(e){!P(e)&&b.isPastSegment(e)&&(e.isPastSegment=!0)}),t.forEach(function(e){b.isPastSegment(e)&&(e.isPastSegment=!0)})}function V(e){e.forEach(function(e,n,i){"AIR"===b.getSegmentTypeUpperCased(e)&&(e.displayCheckinButton=!b.isPastSegment(e)&&getContext("featureConfig.checkin.enabled",!0)&&!a.isReadOnly(t.trip),e.isCheckInEnabled=a.isCheckInEnabled(e))})}function G(e){e.forEach(function(e,n,i){"AIR"!==b.getSegmentTypeUpperCased(e)||!getContext("featureConfig.trip.eitrEnabled",!1)||e.manuallyCreated||e.createdViaMailParserFlow||a.isReadOnly(t.trip)||(e.ticketNumberList=a.getTicketNumberList(e),e.isEitrDownloadAvailable=!b.isPastSegment(e)&&e.ticketNumberList.length>0,e.isEitrDownloadButtonDisplayed=!0)})}function H(e){e.forEach(function(e,n,i){"AIR"===b.getSegmentTypeUpperCased(e)&&(e.seats=safeAccess(e,"travellers",[]).filter(function(e){return isDefined(e.seat)&&""!==e.seat}).map(function(e){return e.seat}).sort(t.orderSeats))})}function q(){var e=getContext("featureConfig.trip.destinationImageSize");g.getAndInjectCardImage(t.trip,!0,e).then(function(e){if(t.config.heroclass=e.cssClassName,isIE){var n=document.getElementById("header-image-div");if(isDefined(n)){var i=n.style.display;n.style.display="none",n.style.display=i}}},function(e){c.warn("loadCardBackgroundImages failure: "+e)})}function Y(e){e.forEach(function(e,t,n){var i=b.getSegmentTypeUpperCased(e),a={displayWidget:!0,location:null},r=b.getFromLocationAndToLocationKeys(i);isDefined(r)&&("CAR"===i.toUpperCase()?a.location=safeAccess(e,r.fromLocation):a.location=safeAccess(e,r.toLocation));var o=b.isSegmentTypeEtrService(i);a.displayWidget=!o&&isDefined(a.location)&&getContext("featureConfig.weather.enabled",!0),e.weatherData=a})}function j(e){e.forEach(function(e,n,i){var a={displayButton:!1};"AIR"===b.getSegmentTypeUpperCased(e)&&!b.isPastSegment(e)&&t.alternateFlightSearchEnabled&&(a.displayButton=!0),e.alternateFlightSearch=a})}function W(e,t){return e.length>t+1?"RECO"===safeAccess(e[t+1],"type","").toUpperCase():!1}function K(e){var t=null;return e=e.map(function(e,n,i){return"RECO"===safeAccess(e,"type","").toUpperCase()?isDefined(t)?(t.list.push(e),t.list.length>2&&t.config.centerOnSelect&&(t.config.centerOnSelect=!1,t.config.overflowScroll=!1),null):W(i,n)?(t={type:"CAROUSEL",index:e.index,inLayover:e.inLayover,refId:e.refId,list:[],config:{align:"center",enabled:!0,centerOnSelect:getContext("isWebDesktop"),overflowScroll:getContext("isWebDesktop")}},t.list.push(e),t):e:(t=null,e)}).filter(function(e){return isDefined(e)}).map(function(e,t,n){return e.index=t,e})}function z(e){e.forEach(function(e,t,n){e.duration=b.getSegmentDuration(e)})}function X(e,t){var n=t.reduce(function(e,t,n,i){return e[t.refId]=t,e},{});e.forEach(function(e,t,i){isDefined(n[e.refId])&&!_.isAirHelpSegmentBlacklisted(e)&&(e.airHelpData=n[e.refId])})}function Z(e,t){e=e||[],t=t||[];var n=[].concat(e,t);n.forEach(function(e,t,n){var i,a,r,o,s=safeAccess(e,"type","").toUpperCase();if(b.isSegmentTypeEtrMove(s)||b.isSegmentTypeEtrStay(s)||b.isSegmentTypeEtrService(s))isDefined(e.provider)&&(i=e.provider.logos,a=e.provider.name);else switch(s){case"AIR":e.marketingCarrier&&(i=e.marketingCarrier.logos,a=e.marketingCarrier.name),e.operatingCarrier&&(r=e.operatingCarrier.logos,o=e.operatingCarrier.name);break;case"CAR":isDefined(e.company)&&(i=e.company.logos,a=e.company.name)}var l=function(e,i,a){var r="<span>"+e+"</span>";n[t][a+"CarrierLogo"]=r,g.getCompanyLogoImage(i,!0).then(function(i){var o=r+'<img alt="'+e+' logo" src="'+i+'" onerror="this.style.display=\'none\'">';n[t][a+"CarrierLogo"]=C.trustAsHtml(o)})};isDefined(a)&&l(a,i,"marketing"),isDefined(o)&&l(o,r,"operating")})}function J(e){if(isUndefined(oe)){var t=e.filter(function(e){return!P(e)}),n=null;t.forEach(function(e,t){null!==n||b.isPastSegment(e)||(n=t)}),n>0&&(se=n)}}c=c.getInstance("TripExpandedController"),c.info("Controller Started...");var Q=!1,ee=getContext("featureConfig.trip.scrollToCurrentSegment",!1);t.greyOutPastSegment=getContext("featureConfig.trip.greyOutPastSegment",!1);var te=t.$new();n("FlightStatusController",{$scope:te});var ne=u.tripId,ie=u.lastName,ae=u.firstName,re=!1,oe=a.shouldScrollToOnNextDisplay(ne),se=null;t.lastName=u.lastName,t.firstName=u.firstName,t.hasRefreshedFromServer=!1,t.trip=null,t.config={},t.menuContext,t.hotelRecoEnabled=getContext("featureConfig.hotelAccommodation.enabled",!1),t.taxiRecoEnabled=getContext("featureConfig.taxiReco.enabled",!1),t.parkingRecoEnabled=getContext("featureConfig.parkingReco.enabled",!1),t.loungeRecoEnabled=getContext("featureConfig.loungeReco.enabled",!1),t.activityRecoEnabled=getContext("featureConfig.activityReco.enabled",!1),t.alternateFlightSearchEnabled=getContext("featureConfig.trip.airTripAlternateSearchEnabled",!1),t.pullToRefreshEnabled=getContext("applicationConfig.pullToRefreshEnabled",!0),t.advertisementBanner={hasAdvertisement:!1,scriptContainerId:"tripDetailsAdBannerJavascript-"+ne,adContainerId:"tripDetailsAdBannerJavascriptAd-"+ne},t.isIE=isIE(),t.isEdge=window.isEdge(),t.loungeRecoAlreadyDisplayed=!1;var le=!1;t.$on("$ionicView.beforeEnter",function(){t.resetAdvertisement();var e=a.shouldRefreshTripFromCacheOnNextDisplay(ne);e&&t.refreshTrip({fromPullToRefresh:!1,forceRefreshTripDetails:!1,forceRefreshFlightStatus:!1,isSilent:!0})}),t.$on("$ionicView.enter",function(){t.reloadAdvertisement(),t.nowTimestamp=+moment.utc();var e=h.currentView();!isDefined(e)||"past-trip-expanded"!==e.stateName&&"more-past-trip-expanded"!==e.stateName||(Q=!0)}),t.$on("$ionicView.afterEnter",function(){var e=!re||u.forceRefreshTripDetails||a.shouldRefreshTripOnNextDisplay(ne),n=!re||u.forceRefreshFlightStatus;ne&&t.refreshTrip({fromPullToRefresh:!1,forceRefreshTripDetails:e,forceRefreshFlightStatus:n}).then(function(e){isDefined(oe)&&(se=e.tripDetails.segments.findIndex(function(e){return e.recLocFromRefId===oe||e.refId===oe})),isDefined(se)&&v(function(){var e=document.getElementById("segment_"+se)||document.querySelector('[id$="_reco_'+se+'"]'),t=0;if(isDesktop()){var n=document.querySelector(".breadcrumb").getBoundingClientRect().height,i=document.querySelector("header").getBoundingClientRect().height;t=i+n}else t=document.querySelector("ion-header-bar").getBoundingClientRect().height;if(isDefined(e)){var a=e.getBoundingClientRect().top-10;isDesktop()?e.scrollIntoView({behavior:"smooth"}):w.scrollTo(0,a-t,!0)}else c.error("Element to scroll to not found, searched for segment id "+se)},1e3)},function(e){c.warn("Unable to to retrieve trip, navigating back to previous page"),S.navigateBack()})}),t.$on("$ionicView.leave",function(t,n){"back"===n.direction&&e.$emit("clearSSRShoppingCartEvent",ne)}),t.$on("MultiMenuOpenEvent",function(e,t){A.tripActionSheetOpen()});var ce=function(){re=!1,t.exploreFeatureStatus={isExploreEnabled:getContext("featureConfig.explore.enabled",!1)&&"tripadvisor"!==getContext("featureConfig.explore.PROVIDER",!1),isTripAdvisorEnabled:getContext("featureConfig.explore.enabled",!1)&&"tripadvisor"===getContext("featureConfig.explore.PROVIDER",!1),isTakeMeThereEnabled:getContext("featureConfig.takeMeThere.enabled",!1)||getContext("featureConfig.discover.nativeMapsEnabled",!1),isTaxiDriverEnabled:getContext("featureConfig.taxiDriver.enabled",!1)},d.startLoading(),e.$emit("ssrRefreshTripAndClearShoppingCartEvent",{tripId:ne});var n=i.getCachedTrip(ne);isDefined(n)&&isDefined(n.tripDetails)&&(re=!0),t.menuList=getContext("applicationConfig.menu.tripExpandedMainItems",[]),t.menuStyle=d.getMainMenuStyle(),t.segmentMenuList=getContext("applicationConfig.menu.segmentCardItems",[]);var a;if(re?(a=angular.copy(n),a.tripDetails=null):a=n,t.trip=a,t.menuContext=a,t.trip){var r=getContext("featureConfig.trip.destinationImageSize");t.config.heroclass=g.getCardCssClass(t.trip,r)}};ce(),t.sendAnalytics=function(e,t){x(t,"Taxi")?y.taxiRecoDisplayed(e,t):"",x(t,"Parking")?y.parkingRecoDisplayed(e):"",x(t,"Lounge")?y.loungeRecoDisplayed(e):"",x(t,"Activity")?y.activityRecoDisplayed(e,t):"",x(t,"Hotel")?y.hotelRecoDisplayed(e,t):""},t.gotoCheckInView=function(e){var n=b.getCheckInUrl(e);return n?(c.info('Opening "'+n+'"'),void T.start(n,e,t.trip)):(c.error("gotoCheckInView: checkInUrl not defined!"),void c.info("tripId=",ne,"lastName=",ie,"segmentIndex=",e.index))},t.orderSeats=function(e,t){var n=[],i=[];for(e.replace(/(\d+)|(\D+)/g,function(e,t,i){n.push([t||1/0,i||""])}),t.replace(/(\d+)|(\D+)/g,function(e,t,n){i.push([t||1/0,n||""])});n.length&&i.length;){var a=n.shift(),r=i.shift(),o=a[0]-r[0]||a[1].localeCompare(r[1]);if(o)return o}return n.length-i.length},t.updateDynamicRecos=function(e){L.getRecoAvailabilityForSegments(e.filter(function(e){return x(e,"Taxi")}),t.trip.tripId).then(function(n){t.displayableSegments=e.map(function(e){var t=n.find(function(t){return t.segmentRefId===e.segmentRefId});return t?t:e})});var n=e.filter(function(e){return x(e,"Activity")})[0];n&&k.getActivityRecoAvailabilityForSegment(n,t.trip.tripId).then(function(e){return e})},t.refreshTrip=function(n){n=n||{};var i=isDefined(n.fromPullToRefresh)?n.fromPullToRefresh:!1,r=isDefined(n.forceRefreshTripDetails)?n.forceRefreshTripDetails:!0,s=isDefined(n.forceRefreshFlightStatus)?n.forceRefreshFlightStatus:!0,l=isDefined(n.isSilent)?n.isSilent:!1,g=f.defer();return d.startLoading(i),a.retrieveOrImportTrip(ne,ie,ae,{forceFromServer:r})["catch"](function(e){return e===a.ERROR_RETRIEVE_FAILED_NO_FIRST_NAME?(d.stopLoading(i,t),o.showDialog({triggerValidation:!0,prefillData:{tripId:ne,lastName:ie,firstName:ae}})):f.reject(e)}).then(function(o){i?_.cleanCache(o):"",t.hasRefreshedFromServer=r,t.trip=o,ne=o.tripId,ie=o.bookingLastName,ae=o.bookingFirstName,t.menuContext=t.trip;var p=t.trip.tripDetails.segments,f=t.trip.tripDetails.services,v=a.isReadOnly(t.trip);f=f.map(function(e,t,n){return e.index=t,e}),p=p.map(function(e,t,n){return e.index=t,e.isReadOnly=v,e}),isUndefined(u.lastname)&&u.tripId.length>10&&y.sharedTripDetailsView(o);var h=r&&isDefined(n.forceRefreshFlightStatus)&&n.forceRefreshFlightStatus;(i||r&&!h)&&e.$emit("clearSSRShoppingCartEvent",t.trip.tripId),h&&e.$emit("ssrUpdateSegmentsFromShoppingCartEvent",p);var S=d.getActiveView();te.updateFlightStatuses(S,p,s).then(function(e){c.info("FSE refresh success:");var n,i=!1,a=!1;e.forEach(function(e,t){c.info("segment index "+e.segment.index+": "+e.success+", "+e.errors),isDefined(e.errors)&&"SCHEDULE CHANGE"===e.errors&&(i=!0),e.success===!1&&(a=!0,n=e.httpErrorCode)}),!le&&i?(le=!0,t.refreshTrip({fromPullToRefresh:!1,forceRefreshTripDetails:!0,forceRefreshFlightStatus:!0})):(le=!1,a&&!l&&m.translate(n&&-1===n?"core.httpErrorCodes."+n:"itmngt.error.errorOnFlightStatusRefresh").then(function(e){d.toastError(e)}))}),p=U(p),$(p,f),V(p),H(p),Z(p,f),q(),Y(p),z(p),ee&&J(p),G(p),_.isTripEligible(t.trip)&&!v&&_.getCompensationInformation(t.trip).then(function(e){X(p,e)}),j(p),isFeatureEnabled("recoCarousel")&&(p=K(p)),t.updateDynamicRecos(p),t.displayableSegments=p,d.stopLoading(i,t),g.resolve(o)})["catch"](function(e){d.stopLoading(i,t),e===o.ERR_ADD_TRIP_USER_CLOSED_MODAL?S.navigateBack():(e===o.ERR_ADD_TRIP_NO_INTERNET_CONNECTIVITY&&(e="core.httpErrorCodes.0"),d.toastError(e).then(function(){g.reject(e)}))}),g.promise},t.pullToRefresh=function(){t.refreshTrip({fromPullToRefresh:!0,forceRefreshTripDetails:!0,forceRefreshFlightStatus:!0})},t.$on("reco-carousel-item-selected",function(e,n){x(n,"Taxi")&&t.taxiRecoClick(t.trip,n),x(n,"Activity")&&t.activityRecoClick(t.trip,n),x(n,"Hotel")&&t.hotelRecoClick(t.trip,n),x(n,"Parking")&&t.parkingRecoClick(t.trip),x(n,"Lounge")&&t.loungeRecoClick(t.trip)}),t.hotelRecoClick=function(e,n){t.hotelRecoEnabled&&S.next({hotelAccommodation:n,hotelAccommodationAdditionalTripData:e})},t.taxiRecoClick=function(e,n){t.taxiRecoEnabled&&(y.taxiRecoTapped(e,n),S.next({taxiReco:{trip:e,segment:n,touchPoint:isDefined(n._taxiAvailability)?"CMT_TAXI_RECO_AVAILABILITY":"CMT_TAXI_RECO_ELIGIBILITY",recoId:isDefined(n._taxiAvailability)?n._taxiAvailability.recoId:null}}))},t.parkingRecoClick=function(e){t.parkingRecoEnabled&&(y.parkingRecoTapped(e),S.next({parkingReco:{}}))},t.loungeRecoClick=function(e){t.loungeRecoEnabled&&(y.loungeRecoTapped(e),S.next({loungeReco:{}}))},t.activityRecoClick=function(e,n){t.activityRecoEnabled&&(y.activityRecoTapped(e,n),S.next({activityReco:{trip:e,segment:n}}))},t.getActivityStyledBackground=function(e){return R.getActivityRecoStyledBackground(e)},t.alternateFlightSearchClick=function(e){t.alternateFlightSearchEnabled&&S.next({alternativeFlightSearch:e})},t.openDestinationImagesModal=function(){if(getContext("featureConfig.trip.destinationImageSlideShowEnabled")){var n="trip.toLocation.imageSet.imageUrls.";n+=getContext("featureConfig.trip.destinationImageSize",g.CARD_SIZE_S);var i=safeAccess(t,n),a=[];if(isDefined(i)&&(a=i.split(";"),a.reverse(),a=a.slice(0,6)),a.length>0){var o=e.$new();o.destinationImages=a,r.fromTemplateUrl("destinationImagesSlideBox.html",{scope:o,animation:"animated fadeIn"}).then(function(e){o.modal=e,o.closeModal=function(){d.removeModal(o.modal)},d.showModal(o.modal)})}}},t.resetAdvertisement=function(){t.advertisementBanner=s.resetAdvertisementModel(t.advertisementBanner)},t.reloadAdvertisement=function(){var e=f.defer(),n=isFeatureEnabled("tripDetailsAdvertisement");if(n){var i={
page:isDesktop()?"tripDetailsDesktop":"tripDetails",type:isDesktop()?"leaderboard":"billboard",tripId:ne,adContainerId:t.advertisementBanner.adContainerId,scriptContainerId:t.advertisementBanner.scriptContainerId},a={requestTimeout:getContext("featureConfig.tripDetailsAdvertisement.requestTimeout")};s.getAdvertisement(i,a).then(function(n){n?(t.advertisementBanner=n,e.resolve()):e.reject("no ad returned")})}else e.reject("Trip details advertisement is not enabled");return e.promise},t.goToSegmentExpanded=function(e){a.isReadOnly(t.trip)||(Q?S.navigateTo("past-segment-expanded",e):S.next({segmentSelected:e}))},t.getSegmentIncludePath=function(e){var t=e.type;isDefined(e.recoType)&&(t=e.type+e.recoType),t=t.toUpperCase();var n="itmngt/templates/partial/"+t+"SegmentPartial.html";return n};var de=function(e,t){getContext("isMobileApp")&&safeAccess(window,"cordova.plugins.fileOpener")?cordova.plugins.fileOpener.open(e,"pdf",{success:function(e){y.eticketRetrieveDocumentSuccess(),d.stopLoading(),I.removeTicketDocumentUrlFromLocalStorage(t)},error:function(e){d.stopLoading(),d.toastError("itmngt.eitr.error.retrieveFailed")}},"eTicket",!0):(d.stopLoading(),window.open(e))};t.downloadEticketReceipt=function(e){if(M.hasConnectivity().isOnline){d.startLoading(),y.eticketDownloadClicked();var t=I.getTicketDocumentUrlFromLocalStorage(e.refId);t?(y.eticketCacheLinkRetrieveSuccess(),de(t,e.refId)):I.getTicketDocumentReceipt(e.ticketNumberList,e.refId).then(function(t){y.eticketNewLinkRetrieveSuccess(),de(t,e.refId)},function(e){d.stopLoading();var t=safeAccess(e,"status");-1===t||0===t?d.toastError("itmngt.eitr.error.noInternet"):d.toastError("itmngt.eitr.error.retrieveFailed")})}else d.toastError("itmngt.eitr.error.noInternet")},t.exposePrivateMethodForUnitTest=function(){t._mergeRecos=K}}]),itmngtModule.controller("SegmentExpandedController",["$scope","$rootScope","$controller","TripService","SegmentService","TriplistCacheService","$log","LayoutService","$stateParams","OrchestratorChiefService","I18nService",function(e,t,n,i,a,r,o,s,l,c,d){o=o.getInstance("SegmentExpandedController"),o.info("Controller Started..."),e.$stateParams=l;var u=l.tripId,g=l.lastName,p=l.firstName,m=l.segmentRefId||e.segmentRefId;e.trip=null,e.segment=null,e.$on("$ionicView.beforeEnter",function(){i.shouldRefreshTripFromCacheOnNextDisplay(u)&&(e.trip=r.getCachedTrip(u),f())});var f=function(){var t=!1,n=e.trip.tripDetails,i=n.segments.concat(n.services);return i.forEach(function(n){if(n.refId===m){e.segment=n;var i=e.segment.type.toUpperCase();t=a.isSegmentTypeEtrMove(i)||a.isSegmentTypeEtrStay(i)||a.isSegmentTypeEtrService(i)||["AIR","HOTEL","SLEEPMISC","CAR","TRAIN"].indexOf(i)>-1}}),t},v=function(){var t=!1;s.startLoading(),i.retrieveOrImportTrip(u,g,p).then(function(n){isUndefined(n)||(e.trip=n,t=f())})["finally"](function(){s.stopLoading(),t||d.translate("itmngt.segmentExpanded.error.invalidSegment").then(function(e){s.toastError(e).then(function(){c.navigateBack()})})})};v()}]),itmngtModule.controller("SegmentExpandedPartialController",["$scope","$rootScope","$controller","SegmentService","TriplistCacheService","$log","LayoutService","$stateParams","OrchestratorChiefService","I18nService","SegmentExpandedService","AuthenticationService",function(e,t,n,i,a,r,o,s,l,c,d,u){function g(e){var t=[e.titleCode,e.firstName,e.middleName,e.lastName].filter(function(e){return isDefined(e)&&""!==e}).join(" ");return t}function p(e,t){var n=g(e),i=E(n);return i.data[S+".label.ticketNumber"]=safeAccess(e,"ticket.number"),i.data[S+".label.coach"]=safeAccess(e,"coach"),i.data[S+".label.seat"]=safeAccess(e,"seat"),i}function m(t,n,a){var r=safeAccess(e.trip,"tripDetails.services",[]),o=i.getExtraLuggage(r,n.refId,t.refId);return d.getLocalizedExtraBaggageAllowanceOnSegmentLevel(o,n,t.refId).then(function(e){var i=g(t),r=E(i);r.data[S+".label.frequentFlyerNumber"]=safeAccess(t,"frequentFlyer.number"),r.data[S+".label.eTicket"]=safeAccess(t,"ticket.number");var s=safeAccess(n,"cabin"),c=s&&["First","Club","Premium","Economy"].indexOf(s)>-1?S+".cabinClass."+s:null;r.data[S+".label.cabinClass"]=c;var u=safeAccess(t,"seat"),p=null;return!isFeatureEnabled("seatMap")||!u&&getContext("featureConfig.seatMap.showButtonOnlyIfSeatDefined",!1)||(p={label:S+".button.viewSeatMap",callback:function(){l.next({seatMap:{tripId:v,segmentRefId:h,lastName:t.lastName,firstName:t.firstName,refId:t.refId,scrollToSeat:u}})}}),r.data[S+".label.seat"]={value:u,className:d.shouldHighlightSeatNumber(t)?"highlight-seat":null,action:p},r=x(r,n,e,o,a,t)})}function f(e,t){return d.getLocalizedBaggageAllowanceOnSegmentLevel(e.baggageAllowance).then(function(n){var i=E(S+".label.moreFlightDetails"),a=safeAccess(e,"flight.aircraft.name");i.data["itmngt.label.aircraft"]={value:a,action:null,className:"breakLine"};var r=t[S+".label.baggageAllowance"]+"<br/>"+t[S+".label.perAdult"];return i.data[r]=n?{value:n,action:null}:"-",i=P(i,e,t)})}r=r.getInstance("SegmentExpandedPartialController"),r.info("Controller Started..."),e.$stateParams=s;var v=s.tripId,h=s.segmentRefId||e.segmentRefId,S="itmngt.segmentExpanded",C=!1;e.segmentInformation=null,e.segmentDescription=null,e.vendorContactCard=null,e.agencyContactCard=null;var T,b=getContext("featureConfig.ssrLuggage.baggageSectionEnabled",!1);e.$on("$ionicView.enter",function(){T=t.$on("paramsUpdates",function(t,n){e.ssrLuggageEnabled=isFeatureEnabled("ssrLuggage"),F()})}),e.$on("$ionicView.leave",function(){isDefined(T)&&T()});var E=function(e){var t={};return t.title=e,t.data={},t},A=function(e,t,n,i){return{name:e,logo:t,phone:n,email:i}},y=function(){r.method("_getTravelAgencyLogoForB2B");var e="";return e=getContext("isMobileApp",!1)?"resources/":getContext("cdnHost"),e+=getContext("OFFICEID",!1)?getContext("SITECODE")+"/"+getContext("OFFICEID"):getContext("SITECODE"),e+="/images/contact_logo.png"},L=function(e){var t;return t=getContext("featureConfig.segment.agencyLogo.useB2BLogic",!1)?y():safeAccess(e,"logoUrl"),isDefined(e)?A(e.name,t,e.phone,e.email):null},D=function(e){var t=E(S+".label.reservationNumber");return t.data[S+".label.bookingReference"]=safeAccess(e,"systemRefIds[0].number"),t},_=function(e){return{title:S+".label.description",text:safeAccess(e,"description")}},w=function(t){c.translate([S+".mealCodes.B",S+".mealCodes.K",S+".mealCodes.L",S+".mealCodes.D",S+".mealCodes.S",S+".mealCodes.O",S+".mealCodes.H",S+".mealCodes.M",S+".mealCodes.R",S+".mealCodes.C",S+".mealCodes.F",S+".mealCodes.P",S+".mealCodes.Y",S+".mealCodes.N",S+".mealCodes.G",S+".mealCodes.V",S+".label.baggageAllowance",S+".button.extraLuggage",S+".label.allFlights",S+".label.perAdult"]).then(function(n){f(t,n).then(function(i){var a=[];if(C&&a.push(D(t)),a.push(i),t.travellers)for(var r=0;r<t.travellers.length;r++){var o=t.travellers[r];m(o,t,n).then(function(t){a.push(t),e.segmentInformation=a})}e.segmentInformation=a,e.segmentDescription=_(t),e.agencyContactCard=L(t.travelAgency)})})},I=function(t){var n=[];if(C&&n.push(D(t)),n.push(M(t)),t.travellers)for(var i=0;i<t.travellers.length;i++){var a=t.travellers[i],r=p(a,t);n.push(r)}e.segmentInformation=n,e.segmentDescription=_(t),e.agencyContactCard=L(t.travelAgency)},M=function(e){var t=E(S+".label.moreRailDetails");return t.data[S+".label.trainNumber"]=safeAccess(e,"trainNumber"),t.data[S+".label.equipmentName"]=safeAccess(e,"trainType.name"),t.data[S+".label.equipmentCode"]=safeAccess(e,"trainType.code"),t},k=function(t){var n=[];C&&n.push(D(t)),e.segmentInformation=n,e.segmentDescription=_(t),e.agencyContactCard=L(t.travelAgency)},R=k,P=function(e,t,n){return e.data[S+".label.meals"]=d.getLocalizedMealsOnSegmentLevel(t.meals,n),e},x=function(t,n,a,r,o,s){if(b){var d=i.isExtraLuggageBookable(n,s.refId,e.trip),u=null;return isFeatureEnabled("ssrLuggage")&&(u={label:S+".button.extraLuggage",callback:function(){l.next({extraLuggage:{tripId:v,lastName:s.lastName,firstName:s.firstName,paxRefId:s.refId,segmentRefId:h}})},isDisabled:!d}),c.translate(S+".button.extraLuggage",{weight:r.weight?"("+r.weight+")":s.extraLuggageWeight}).then(function(e){return t.data[e]=a?{value:a,className:i.isExtraLuggageAddedForBooking(n,s.refId)?"highlight-seat":null,action:u}:"-",t})}return t},N=function(t){var n=[];C&&n.push(D(t));var i=E(S+".label.moreCarDetails"),a={};getContext("featureConfig.car.showPrices",!0)&&(a[S+".label.totalPrice"]=c.getPriceFromBackendObject(safeAccess(t,"price")));var r=safeAccess(t,"carDescription","").split(",").join("<br><small>-</small><br>");a[S+".label.category"]=S+".label.carCategories."+safeAccess(t,"category.code","-1"),a[S+".label.rateCode"]=safeAccess(t,"rateCode"),a[S+".label.carDescription"]={value:r,action:null,className:"breakLine"},i.data=a,n.push(i),e.segmentInformation=n,e.segmentDescription=_(t),e.agencyContactCard=L(t.travelAgency)},O=function(t){var n=[S+".label.adult",S+".label.child",S+".label.bedTypes."+safeAccess(t,"bedTypeCode","*")],i=safeAccess(t,"roomTypeCode");return c.translate(n,{numberOfBed:safeAccess(t,"numberOfBeds","1"),numberOfAdult:safeAccess(t,"numberOfAdults","1"),numberOfChild:safeAccess(t,"numberOfChildren","1")},"messageformat").then(function(a){d.getHotelRoomType(i).then(function(i){var r=[];C&&r.push(D(t));var o=E(S+".label.moreHotelDetails"),s=[];t.numberOfAdults&&s.push(a[n[0]]),t.numberOfChildren&&s.push(a[n[1]]),o.data[S+".label.guests"]=s.length>0?s.join(" / "):void 0,o.data[S+".label.roomCategory"]=i,o.data[S+".label.numberOfBeds"]=safeAccess(t,"numberOfBeds"),o.data[S+".label.bedType"]=c.isStringLocalized(a[n[2]])?a[n[2]]:"-",getContext("featureConfig.hotel.showPrices",!0)&&(o.data[S+".label.priceWithoutTaxes"]=c.getPriceFromBackendObject(t.priceExcludingTax),o.data[S+".label.taxes"]=c.getPriceFromBackendObject(t.taxFees),o.data[S+".label.totalPrice"]=c.getPriceFromBackendObject(t.totalPrice),o.data[S+".label.deposit"]=c.getPriceFromBackendObject(t.deposit)),r.push(o),e.segmentInformation=r,e.segmentDescription=_(t),e.vendorContactCard=A(t.name,t.hotelLogo,t.phone,t.email),e.agencyContactCard=L(t.travelAgency)})})},F=function(){var t=e.segment.type.toUpperCase();if(C=!e.segment.manuallyCreated&&!e.segment.createdViaMailParserFlow,e.isTAContactDetailsEnabled=getContext("featureConfig.trip.triplistContactEnabled",!0)&&!u.getMultiMarketContactData()&&C,i.isSegmentTypeEtrMove(t))k(e.segment);else if(i.isSegmentTypeEtrStay(t)||i.isSegmentTypeEtrService(t))R(e.segment);else switch(t){case"AIR":w(e.segment);break;case"HOTEL":case"SLEEPMISC":O(e.segment);break;case"CAR":N(e.segment);break;case"TRAIN":I(e.segment);break;default:r.warn("You are trying to display un-supported segment",t)}};e.$watch("segment",function(e,t){isDefined(e)&&F()},!0),e.$watch("trip.tripDetails.services",function(e,t){isDefined(e)&&F()},!0)}]),itmngtModule.controller("FlightStatusController",["$scope","$log","LayoutService","FlightStatusService","I18nService","$filter","$q","$timeout","TripAnalyticsService",function(e,t,n,i,a,r,o,s,l){function c(){var t=o.defer();return void 0===e.flightStatusTranslations?a.translate(["itmngt.label.flightStatusChanged","itmngt.label.flightStatusCancelled"]).then(function(n){e.flightStatusTranslations={changed:n["itmngt.label.flightStatusChanged"],cancelled:n["itmngt.label.flightStatusCancelled"]},t.resolve(!0)}):t.resolve(!0),t.promise}function d(e){for(var t=[],n=0;n<O.length;n++){var a=O[n];i.canCallSegmentFlightStatus(a)?t.push(g(a,e)):t.push(o.when({segment:a,success:!0,errors:"Not eligible"}))}return o.all(t)}function u(e){var t=e.duration,n=t.isNegative?"-":t.hours+"h"+t.minutes+"m";k(e),w(e,"fs-layover-period",n)}function g(e,t){var n=o.defer();return i.getSegmentStatus(e,t).then(function(t){p(e,t);for(var i="ok",a=0;a<t.length;a++)m(e,t[a]),"SC"===t[a].status&&(i="SCHEDULE CHANGE");n.resolve({segment:e,success:!0,errors:i})},function(t){v(e,t),n.resolve({segment:e,success:!1,errors:t.errors,httpErrorCode:t.httpErrorCode})}),n.promise}function p(t,i){if(N=n.getActiveView(),"trip-expanded"===N.getAttribute("state"))if(P(t),1===i.length){var a=i[0].status;"XL"===a?D(t,"banner-critical",e.flightStatusTranslations.cancelled):D(t,"banner-warning",e.flightStatusTranslations.changed),f(t,i[0])}else i.length>1&&(D(t,"banner-warning",e.flightStatusTranslations.changed),L(t,i))}function m(e,t){var n=t.status;switch(n){case"SC":e.scheduledDepartureDate=t.scheduledDeparture,e.scheduledArrivalDate=t.scheduledArrival;break;case"DY":e.estimatedDepartureDate=t.estimatedDeparture;break;case"AY":e.estimatedArrivalDate=t.estimatedArrival}}function f(e,t){var n=t.status;switch(n){case"XL":h(e,t);break;case"SC":S(e,t);break;case"DY":C(e,t);break;case"TD":T(e,t);break;case"GD":b(e,t);break;case"AY":E(e,t);break;case"TA":A(e,t);break;case"PS":y(e,t)}}function v(e,t){t.previousFlightStatus&&p(e,t.previousFlightStatus)}function h(e,t){}function S(e,t){M(e,t.status),_(e,"fs-departure-time",r("time24h")(t.scheduledDeparture)),_(e,"fs-departure-date",r("segmentDayLongTwoLines")(t.scheduledDeparture)),_(e,"fs-arrival-time",r("time24h")(t.scheduledArrival)),_(e,"fs-arrival-date",r("segmentDayLongTwoLines")(t.scheduledArrival))}function C(e,t){M(e,t.status),_(e,"fs-departure-time",r("time24h")(t.estimatedDeparture)),_(e,"fs-departure-date",r("segmentDayLongTwoLines")(t.estimatedDeparture))}function T(e,t){M(e,t.status),_(e,"fs-departure-terminal",x(t.value))}function b(e,t){M(e,t.status),_(e,"fs-departure-gate",x(t.value))}function E(e,t){M(e,t.status),_(e,"fs-arrival-time",r("time24h")(t.estimatedArrival)),_(e,"fs-arrival-date",r("segmentDayLongTwoLines")(t.estimatedArrival))}function A(e,t){M(e,t.status),_(e,"fs-arrival-terminal",x(t.value))}function y(e,t){M(e,t.status),_(e,"fs-segment-seats",x(t.value))}function L(e,t){for(var n=0;n<t.length;n++)f(e,t[n])}function D(e,t,i){var a=e.index,r=N.querySelector("#segment_"+a),o=r.querySelector(".banner"),s=r.querySelector(".text-banner");n.addCssClass(o,"is-open "+t),s.innerHTML=i}function _(e,t,n){I(e,t,n,"segment")}function w(e,t,n){I(e,t,n,"layover")}function I(e,t,n,i){var a=e.index,r=N.querySelector("#"+i+"_"+a),o=r.querySelector("."+t);o.innerHTML=n}function M(e,t){R(e,t,"segment")}function k(e){R(e,"layover","layover")}function R(e,t,i){var a=e.index,r=N.querySelector("#"+i+"_"+a);n.addCssClass(r,"fs-"+t)}function P(e){var t=e.index,i=N.querySelector("#segment_"+t);n.removeCssClass(i,"fs-SC fs-DY fs-TD fs-GD fs-AY fs-TA fs-PS fs-layover");var a=i.querySelector(".banner"),r=i.querySelector(".text-banner");n.removeCssClass(a,"is-open banner-warning banner-critical banner-alert"),r.innerHTML="",_(e,"fs-departure-terminal",x(e.departureTerminal)),_(e,"fs-departure-gate",x(e.departureGate)),_(e,"fs-arrival-terminal",x(e.arrivalTerminal))}function x(e,t){void 0===t&&(t="-");var n=t;return isDefined(e)&&""!==e&&(n=e),n}t=t.getInstance("FlightStatusController"),t.info("Controller Started...");var N,O;e.updateFlightStatuses=function(e,t,n){N=e,O=t;var a=o.defer();return c().then(function(){s(function(){d(n).then(function(e){for(var t=i.getLayoverSegmentsToUpdate(e),n=0;n<t.length;n++)u(t[n]);a.resolve(e)})},100)}),a.promise}}]),itmngtModule.controller("AddTripModalController",["$scope","$log","$rootScope","LayoutService","TripAnalyticsService","TripService","$timeout",function(e,t,n,i,a,r,o){t=t.getInstance("AddTripModalController"),t.info("Controller Started..."),o(function(){if(isUndefined(e.onAddTripCancel)||isUndefined(e.onAddTripSuccess))throw"You must pass onAddTripCancel and onAddTripSuccess to the scope";e.triggerValidation&&e.forms.addtripform.$setSubmitted()},0),isUndefined(e.onAddTripFailure)&&(e.onAddTripFailure=function(e){i.toastError(e)}),e.isFirstNameRequired=getContext("featureConfig.importTrip.firstNameRequired",!1),e.closeicon=n.closeicon,e.forms={addtripform:{}},e.addPnrInputs={tripId:safeAccess(e,"prefillData.tripId")||"",lastName:safeAccess(e,"prefillData.lastName")||""},e.isFirstNameRequired&&(e.addPnrInputs.firstName=safeAccess(e,"prefillData.firstName")||""),e.closeAddTripModal=function(){return e.forms.addtripform.$setPristine(),e.addPnrInputs={},e.onAddTripCancel()},e.addTrip=function(){e.forms.addtripform.$valid?(i.startLoading(),e.addPnrInputs.tripId=e.addPnrInputs.tripId.toUpperCase(),e.addPnrInputs.lastName=e.addPnrInputs.lastName.toUpperCase(),e.isFirstNameRequired?e.addPnrInputs.firstName=e.addPnrInputs.firstName.toUpperCase():delete e.addPnrInputs.firstName,r.addTrip(e.addPnrInputs).then(function(t){a.addedWithRecloc(e.addPnrInputs),i.stopLoading(),e.onAddTripSuccess(t)},function(n){t.error(n),i.stopLoading(),e.onAddTripFailure(n)})["catch"](handleUnexpectedError)):i.addErrors(e.forms.addtripform.$error)}}]),itmngtModule.filter("displayAirport",function(){return function(e){var t=[];return isDefined(e.name)&&t.push(e.name),isDefined(e.code)&&t.push("("+e.code+")"),t.join(" ")}}),itmngtModule.filter("fullAddress",function(){return function(e){var t=[];return t.push(safeAccess(e,"addressLine1","")),t.push(safeAccess(e,"addressLine2","")),t.push(safeAccess(e,"cityName","")),t=t.map(function(e){return e.trim()}).filter(function(e){return""!==e}),t.join(", ")}}),itmngtModule.filter("remainingdays",["$log","translateFilter","DateTimeService",function(e,t,n){return function(e){var i,a=n.getMomentFromBackendDate(e.startDate),r=n.getMomentFromBackendDate(e.endDate),o=moment();return isDefined(r)&&o>r?(i=moment().diff(r,"days",!0),i=Math.round(i),i>0?t("itmngt.label.endedInDay",{numberOfDay:i},"messageformat"):r.from()):isDefined(r)&&isDefined(a)&&r>o&&o>a?t("itmngt.label.ongoing"):isDefined(a)?(i=a.diff(moment(),"days",!0),i=Math.round(i),i>0?t("itmngt.label.startInDay",{numberOfDay:i},"messageformat"):a.from()):void 0}}]),itmngtModule.filter("tripStatusLabel",["$log","translateFilter","DateTimeService",function(e,t,n){return function(e){function i(e,n){var i="",a="";return n.value1&&(i=t("itmngt.label."+n.key1,{count:n.value1},"messageformat")),n.value2&&(i+=", "+t("itmngt.label."+n.key2,{count:n.value2},"messageformat")),i&&e?a=t("itmngt.label.startInLabel",{label:i}):i&&(a=t("itmngt.label.endedInLabel",{label:i})),a}var a,r,o,s,l,c,d=n.getMomentFromBackendDate(e.startDate),u=n.getMomentFromBackendDate(e.endDate),g=moment(),p=moment(),m="";return r=d.isAfter(g),a=r?d:u,o=a.diff(p,"months"),p.add(o,"months"),s=a.diff(p,"days"),p.add(s,"days"),l=a.diff(p,"hours"),p.add(l,"hours"),c=a.diff(p,"minutes"),p.add(c,"minutes"),o=Math.abs(o),s=Math.abs(s),l=Math.abs(l),c=Math.abs(c),m=isDefined(u)&&isDefined(d)&&u>g&&g>d?t("itmngt.label.ongoing"):o>=1?i(r,{key1:"monthOrMonths",value1:o,key2:"dayOrDays",value2:s}):s>=1?i(r,{key1:"dayOrDays",value1:s}):l>=1?i(r,{key1:"hourOrHours",value1:l,key2:"minuteOrMinutes",value2:c}):i(r,{key1:"minuteOrMinutes",value1:c})}}]),itmngtModule.filter("tripdate",["$log","DateTimeService","I18nService",function(e,t,n){return function(e){var i=t.getMomentFromBackendDate(e.startDate),a=t.getMomentFromBackendDate(e.endDate),r="",o="",s="";return isDefined(i)&&(o=i.format(n.getLocalizedDateFormat("tripdate"))),isDefined(a)&&(s=a.format(n.getLocalizedDateFormat("tripdate"))),o&&(r+=o),s&&s!==o&&(r+=" - "+s),r}}]),itmngtModule.filter("segmentdate",["$log","DateTimeService","I18nService",function(e,t,n){return function(e){var i=t.getMomentFromBackendDate(e),a="";return isDefined(i)&&(a+=i.format(n.getLocalizedDateFormat("segmentDayLong"))),a}}]),itmngtModule.filter("tripstart",["$log","DateTimeService","I18nService",function(e,t,n){return function(e){var i=t.getMomentFromBackendDate(e.startDate),a="";return isDefined(i)&&(a=i.format(n.getLocalizedDateFormat("tripstart"))),a}}]),itmngtModule.filter("segmentDayLong",["DateTimeService","StringService","I18nService",function(e,t,n){return function(i){return __formatSegmentDateTime(i,n.getLocalizedDateFormat("segmentDayLong"),{DateTimeService:e,StringService:t})}}]),itmngtModule.filter("segmentDayLongTwoLines",["DateTimeService","StringService","I18nService",function(e,t,n){return function(i){return __formatSegmentDateTime(i,n.getLocalizedDateFormat("segmentDayLongTwoLines"),{DateTimeService:e,StringService:t})}}]),itmngtModule.filter("segmentDayShort",["DateTimeService","StringService","I18nService",function(e,t,n){return function(i){return __formatSegmentDateTime(i,n.getLocalizedDateFormat("segmentDayShort"),{DateTimeService:e,StringService:t})}}]),itmngtModule.filter("segmentDayTimeLong",["DateTimeService","StringService","I18nService",function(e,t,n){return function(i){return __formatSegmentDateTime(i,n.getLocalizedDateFormat("segmentDayTimeLong"),{DateTimeService:e,StringService:t})}}]),itmngtModule.filter("fullDateTimeTZ",["DateTimeService","StringService","I18nService",function(e,t,n){return function(i){var a=n.getLocalizedDateFormat("fullDateTimeTZNoTime");return i.hasTime===!0&&(a=n.getLocalizedDateFormat("fullDateTimeTZWithTime")),__formatSegmentDateTime(i,a,{DateTimeService:e,StringService:t})}}]),itmngtModule.filter("tripUngroupDate",["$log","DateTimeService","I18nService",function(e,t,n){return function(e){var i,a=t.getMomentFromBackendDate(t.parseETRSegmentDate(e[0]).sDate);e.length-1==1?i=t.getMomentFromBackendDate(t.parseETRSegmentDate(e[0]).eDate):(e.forEach(function(e){(void 0===i||i.utcTimestampMillis<t.parseETRSegmentDate(e).eDate.utcTimestampMillis)&&(i=t.parseETRSegmentDate(e).eDate)}),i=t.getMomentFromBackendDate(i));var r="",o="",s="";return isDefined(a)&&(o=a.format(n.getLocalizedDateFormat("tripdate"))),isDefined(i)&&(s=i.format(n.getLocalizedDateFormat("tripdate"))),o&&(r+=o),s&&s!==o&&(r+=" - "+s),r}}]),itmngtModule.filter("trustedUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),itmngtModule.directive("segmentInformationList",function(){return{restrict:"E",templateUrl:"itmngt/directives/SegmentInformationListDirective.html",scope:{blocTitle:"@",keyValInformation:"="},controller:["$scope",function(e){var t={};for(var n in e.keyValInformation){var i=e.keyValInformation[n];"object"==typeof i&&null!==i?t[n]={value:i.value,action:i.action,className:i.className}:"string"==typeof i?t[n]={value:i,action:null}:t[n]={value:null,action:null}}e.blocValues=t}],toString:function(){return"SegmentInformationList"}}}),itmngtModule.directive("freeTextWithTitle",function(){return{restrict:"E",templateUrl:"itmngt/directives/FreeTextWithTitleDirective.html",scope:{blocTitle:"@",text:"@",defaultText:"@"},compile:function(e,t){return this.link},link:function(e,t,n,i){void 0===e.defaultText&&(e.defaultText="itmngt.label.noInformation")},toString:function(){return"FreeTextWithTitleDirective"}}}),itmngtModule.directive("vendorContactCard",function(){return{restrict:"E",templateUrl:"itmngt/directives/VendorContactCardDirective.html",controller:["$scope",function(e){}],scope:{vendorName:"=",vendorLogo:"=",vendorPhone:"=",vendorEmail:"="},toString:function(){return"vendorContactCard"}}}),itmngtModule.directive("mapLink",["$filter","LayoutService","TripToolAnalyticsService",function(e,t,n){return{restrict:"E",templateUrl:"itmngt/directives/MapLinkDirective.html",scope:{location:"=",showDefaultMessage:"@",label:"@",showIcon:"@",addressName:"="},controller:["$scope",function(i){i.showDefaultMessage=isUndefined(i.showDefaultMessage)||"true"===i.showDefaultMessage,i.showIcon=isUndefined(i.showIcon)||"true"===i.showIcon,i.hasMapLink=!1,i.$watch("location",function(){var a=i.location;if(isDefined(a)){var r=e("fullAddress")(a),o=""!==r,s=isDefined(a.latitude)&&isDefined(a.longitude),l="";o||s?(i.hasMapLink=!0,o?(i.url=r,l=r):l=e("translate")("itmngt.label.address"),s&&(i.url=a.latitude+","+a.longitude),isDefined(i.label)&&(l=i.label),i.displayText=l,i.mapLinkClick=function(e){var a,r=getContext("featureConfig.map.defaultMapLinkForMobileWeb","http://maps.google.com/?q="),o="http://maps.google.com/?q="+i.url;a=i.addressName?"http://maps.apple.com/?ll="+i.url+"&q="+i.addressName:"http://maps.apple.com/?q="+i.url;var s=r+i.url;t.openInExternalBrowser(s,o,a),e.stopPropagation(),n.openMap()}):i.displayText=isDefined(i.label)?i.label:"itmngt.label.noInformation"}else i.displayText=isDefined(i.label)?i.label:"itmngt.label.noInformation"})}],toString:function(){return"mapLink"}}}]),itmngtModule.directive("seatByTraveller",["OrchestratorChiefService",function(e){return{restrict:"E",templateUrl:"itmngt/directives/SeatByTravellerDirective.html",scope:{seat:"=",segment:"=",lastName:"=",firstName:"="},controller:["$scope","$stateParams",function(t,n){var i=n.tripId,a=t.segment.refId;t.showLink=!1;var r=safeAccess(t,"seat"),o=safeAccess(t,"lastName"),s=safeAccess(t,"firstName");getContext("featureConfig.seatMap.enabled")&&isDefined(r)&&r.length>0&&(t.showLink=!0,t.seatLinkClick=function(t){return t.stopPropagation(),e.next({seatMap:{tripId:i,segmentRefId:a,lastName:o,firstName:s,scrollToSeat:r}}),!1})}],toString:function(){return"seatByTravellerDirective"}}}]),itmngtModule.directive("seatBySegment",["OrchestratorChiefService",function(e){return{restrict:"E",templateUrl:"itmngt/directives/SeatBySegmentDirective.html",scope:{segment:"=",additionalClass:"@"},toString:function(){return"seatBySegmentDirective"}}}]),itmngtModule.directive("segmentButtonPanel",["$log","OrchestratorChiefService","SegmentService","$ionicModal","TripAnalyticsService","I18nService","$filter","NavigationAppsService","$window",function(e,t,n,i,a,r,o,s,l){return e=e.getInstance("segmentButtonPanel"),e.info("Directive Started..."),{restrict:"E",templateUrl:"itmngt/directives/SegmentButtonPanelDirective.html",scope:{trip:"=",segmentIndex:"=",targetAddress:"@",featureStatus:"=",segmentOrService:"=?",displayableSegments:"="},controller:["$scope","LayoutService",function(c,d){function u(e){return 0>e||-1===f.indexOf(g[e].type.toLowerCase())?g[e]:u(e-1)}isUndefined(c.segmentOrService)&&(c.segmentOrService="segments");var g=c.displayableSegments,p=g[c.segmentIndex],m=p?p.type.toLowerCase():null,f=["layover","reco"],v=c.segmentIndex-1,h={};c.segmentIndex>0&&g.length>0&&(h=u(v)),c.destName="",c.srcName="",c.destAddress="",c.srcAddress="",c.isInvalidLocation=function(e){return isUndefined(e)||isUndefined(e.latitude)||isUndefined(e.longitude)};var S=function(e){return isDefined(e)&&isDefined(e.addressLine1)?o("fullAddress")(e):null};c._buildTakeMeThereData=function(){if(c.segmentIndex>0&&!n.isPastSegment(h,0)){var e=n.getFromLocationAndToLocationKeys(h.type),t=safeAccess(h,safeAccess(e,"toLocation",""));if(c.isInvalidLocation(t)&&(t=safeAccess(h,safeAccess(e,"fromLocation",""))),c.isInvalidLocation(t))c.srcLatLng="",c.srcName="",c.srcAddress=S(t);else switch(c.srcLatLng=t.latitude+","+t.longitude,h.type.toLowerCase()){case"meeting":c.srcName=S(t);break;case"car":c.srcName=S(t);break;case"hotel":c.srcName=h.name;break;case"air":c.srcName=t.name;break;case"activity":c.srcName=h.title;break;default:S(t)?c.srcName=S(t):t.name?c.srcName=t.name:h.title?c.srcName=h.title:c.srcName=h.name}}else c.srcLatLng="Current Location",c.srcName="discover.currentlocation";var i=n.getFromLocationAndToLocationKeys(p.type),a=safeAccess(p,safeAccess(i,"fromLocation",""));if(c.isInvalidLocation(a)&&(a=safeAccess(p,safeAccess(i,"toLocation",""))),c.isInvalidLocation(a))c.destLatLng="",c.destName="",c.destAddress=S(a);else{switch(p.type.toLowerCase()){case"meeting":c.destName=S(a);break;case"car":c.destName=S(a);break;case"hotel":c.destName=p.name;break;case"air":c.destName=a.name;break;default:S(a)?c.destName=S(a):a.name?c.destName=a.name:c.destName=p.name}c.srcName===c.destName&&"discover.currentlocation"!==c.srcName&&(a=safeAccess(p,i.toLocation),c.destName=a.name),c.destLat=a.latitude,c.destLng=a.longitude,c.destLatLng=a.latitude+","+a.longitude}},c._buildTaxiDriverData=function(){var e=n.getFromLocationAndToLocationKeys(p.type),t=safeAccess(p,safeAccess(e,"toLocation",""));isDefined(t)?(c.taxiLocationDefined=!0,c.addressName=p.name||p.title,t.addressLine1?(c.addressLine=t.addressLine1||"",c.cityName=t.cityName||"",c.place=[],c.place.push(c.cityName),isDefined(t.countryName)&&c.place.push(t.countryName),c.place=c.place.join(", "),c.zip=t.zip||""):(c.addressLine="",c.place="",c.zip="",r.translate("itmngt.error.addressNotAvailable").then(function(e){c.addressLine=e}))):c.taxiLocationDefined=!1};var C=function(){var e="https://www.google.com/maps/dir/?api=1&",t="origin="+c.srcLatLng+"&destination="+c.destLatLng,n=encodeURI(e+t);window.open(n,"_blank")};c.goToDirections=function(){a.directionsClicked(c.segmentOrService),getContext("featureConfig.discover.nativeMapsEnabled",!1)?getContext("isMobileApp",!1)&&isDefined(l.launchnavigator)?s.getAvailableMapApplications().then(function(t){s.navigate(c.destLatLng,{start:c.srcLatLng,appSelection:{list:t}}).then(function(){e.info("Navigator launched")})["catch"](function(t){"cancelled"!==t&&C(),e.error(t)})})["catch"](function(t){C(),e.error(t)}):C():t.navigateTo("discoverList",{srcLatLng:c.srcLatLng,destLatLng:c.destLatLng,srcName:c.srcName,destName:c.destName,srcAddress:c.srcAddress,destAddress:c.destAddress})},c.goToExplore=function(){var e={latitude:null,longitude:null},i=n.getOnSiteLocation(p);isDefined(i)&&(e.latitude=safeAccess(i,"latitude",null),e.longitude=safeAccess(i,"longitude",null)),a.discoverClicked(c.segmentOrService),t.navigateTo("exploreMap",{latitude:e.latitude,longitude:e.longitude,tripId:c.trip.tripId,lastName:c.trip.bookingLastName})},c.goToTripAdvisor=function(){var e={latitude:null,longitude:null},i=n.getOnSiteLocation(p);isDefined(i)&&(e.latitude=safeAccess(i,"latitude",null),e.longitude=safeAccess(i,"longitude",null)),a.discoverClicked(c.segmentOrService),t.navigateTo("tripAdvisorMap",{latitude:e.latitude,longitude:e.longitude,tripId:c.trip.tripId,lastName:c.trip.bookingLastName})},c.showAddressToTaxiDriver=function(){a.taxiDriverClicked(c.segmentOrService),c.taxiLocationDefined?c.openExpandViewModal():d.toastError("itmngt.error.noAddressFound")},c.openExpandViewModal=function(){i.fromTemplateUrl("taxi-driver-modal.html",{scope:c,animation:"slide-in-up"}).then(function(e){c.modal=e,c.modal.show()})},c.closeExpandViewModal=function(){c.modal.remove().then(function(){c.modal=null})},c.$on("$ionicParentView.beforeLeave",function(e,t){isDefined(c.modal)&&c.closeExpandViewModal()}),c.featureStatus.isTakeMeThereEnabled&&c._buildTakeMeThereData(),"hotel"!==m&&"meeting"!==m||!c.featureStatus.isTaxiDriverEnabled||c._buildTaxiDriverData()}],link:function(e,t,n,i){isUndefined(e.segmentOrService)&&(e.segmentOrService="segments");var a=e.displayableSegments,r=a[e.segmentIndex],o=r?r.type.toLowerCase():null,s=["hotel","air","car","meeting"],l=["hotel","air","car","train"],c=["hotel","air","car","train"],d=["cruise","urban","taxi","transfer","movemisc"],u=["excursion","meeting","parking","showandevent"];l=l.concat(d),l=l.concat(u),c=c.concat(d),c=c.concat(u),e.hideExplore=-1===l.indexOf(o)||!e.featureStatus.isExploreEnabled||"services"===e.segmentOrService,e.hideTripAdvisor=-1===c.indexOf(o)||!e.featureStatus.isTripAdvisorEnabled,e.hideTaxiDriver=!("hotel"===o||"meeting"===o)||!e.featureStatus.isTaxiDriverEnabled,e.hideTakeMeThere=-1==s.indexOf(o)||!e.featureStatus.isTakeMeThereEnabled}}}]),itmngtModule.directive("airHelpLink",["TripAnalyticsService","$filter","DataManagerService","$window","I18nService",function(e,t,n,i,a){var r={restrict:"E",templateUrl:"itmngt/directives/AirHelpLinkDirective.html",scope:{airHelpData:"=",tripId:"=",segment:"="},airHelpSVGLogo:'<svg height="20px" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 205.1 51.2"><defs><style>.cls-1{fill:#fff;}</style></defs><title>airhelp</title><path class="cls-1" d="M16.9,1.5a22.9,22.9,0,0,0-6,3.2,26.06,26.06,0,0,0-8.4,9.9,25,25,0,0,0-2.2,7,27,27,0,0,0,.1,8.5A24.41,24.41,0,0,0,6.3,42.5a25.64,25.64,0,0,0,26.8,7.7A25.26,25.26,0,0,0,48.2,37.9a7,7,0,0,0,1.3-3.3,2.74,2.74,0,0,0-1.9-2.7,2.36,2.36,0,0,0-2.8,1,10.09,10.09,0,0,0-.7,1.5,10.93,10.93,0,0,1-.8,1.5A19.76,19.76,0,0,1,30,45.5a19.36,19.36,0,0,1-8.3,0,19.67,19.67,0,0,1-11.5-6.9A20.09,20.09,0,0,1,5.5,25a19.16,19.16,0,0,1,5.3-13A19.84,19.84,0,0,1,22.7,5.6a22.92,22.92,0,0,1,10,1c.6.2,1,.5,1.6.7a2.5,2.5,0,0,0,2.9-1.5,3,3,0,0,0-1-3.3,5.93,5.93,0,0,0-1.6-.7A24.79,24.79,0,0,0,24.7.2,23.6,23.6,0,0,0,16.9,1.5ZM33.5,14a10.2,10.2,0,0,0,.9-2.2,2.57,2.57,0,0,0-2.6-3.2c-1.8.1-2.3,1.6-2.9,3-1.6,3.8-3.4,8-5,11.7-1.2.4-2.3.9-3.6,1.4s-2.3,1.1-2.5,2.5A2.43,2.43,0,0,0,20.4,30a6.18,6.18,0,0,0,2.7-.9c.9-.4,1.8-.7,2.6-1,3.9,1.7,8.2,3.5,12.1,5.2a4.24,4.24,0,0,0,1.9.6,2.51,2.51,0,0,0,2.8-2.2,2.75,2.75,0,0,0-1.2-2.6,13.55,13.55,0,0,0-2.1-1c-2.2-.9-4.4-1.8-6.5-2.8,4.6-1.8,9.2-3.6,13.7-5.5a8.38,8.38,0,0,0,1.9-.9,2.66,2.66,0,0,0,1-2.9,2.52,2.52,0,0,0-2.5-1.8,6.64,6.64,0,0,0-2.7.9L30.6,20.5C31.7,18.4,32.6,16.1,33.5,14Z"/><path class="cls-1" d="M24.6,0a24.79,24.79,0,0,1,9.9,1.6,7.74,7.74,0,0,1,1.6.7,3,3,0,0,1,1,3.3,2.4,2.4,0,0,1-2.9,1.5,7.74,7.74,0,0,1-1.6-.7,22.92,22.92,0,0,0-10-1,19.84,19.84,0,0,0-11.9,6.4,19.36,19.36,0,0,0-5.3,13,19.9,19.9,0,0,0,4.7,13.6,20.19,20.19,0,0,0,11.5,6.9,23.15,23.15,0,0,0,8.3,0,19.76,19.76,0,0,0,13.3-9.6,10.93,10.93,0,0,0,.8-1.5,6.89,6.89,0,0,1,.7-1.5,2.36,2.36,0,0,1,2.8-1,2.65,2.65,0,0,1,1.9,2.7,7,7,0,0,1-1.3,3.3A25.06,25.06,0,0,1,33,50.1,25.64,25.64,0,0,1,6.2,42.4,25.14,25.14,0,0,1,.4,30a26.93,26.93,0,0,1-.1-8.5A25.67,25.67,0,0,1,10.9,4.6a24.35,24.35,0,0,1,6-3.2A35.17,35.17,0,0,1,24.6,0Z"/><path class="cls-1" d="M30.7,20.5c4.4-1.8,9-3.6,13.5-5.4a7.17,7.17,0,0,1,2.7-.9,2.58,2.58,0,0,1,1.5,4.7,11.08,11.08,0,0,1-1.9.9c-4.6,1.8-9.2,3.7-13.7,5.5,2.1,1,4.3,1.9,6.5,2.8a13.55,13.55,0,0,1,2.1,1,2.57,2.57,0,0,1,1.2,2.6,2.51,2.51,0,0,1-2.8,2.2,8.24,8.24,0,0,1-1.9-.6c-3.9-1.7-8.2-3.5-12.1-5.2-.8.3-1.7.7-2.6,1a8.6,8.6,0,0,1-2.7.9,2.43,2.43,0,0,1-2.6-2.8c.1-1.5,1.3-2.1,2.5-2.5s2.4-1,3.6-1.4c1.6-3.6,3.3-7.8,5-11.7.6-1.4,1.1-2.9,2.9-3a2.54,2.54,0,0,1,2.6,3.2,10.2,10.2,0,0,1-.9,2.2C32.6,16.1,31.7,18.4,30.7,20.5Z"/><path class="cls-1" d="M78.3,27.5H66.1L61.9,38.1H59.6L71.6,8H73L84.8,38.1H82.4ZM66.8,25.6H77.5L73.4,14.8a33.8,33.8,0,0,1-1.2-3.5q-.6,2-1.2,3.6Zm21.4-16c0-1.3.4-2,1.3-2a1.23,1.23,0,0,1,1,.5,2.7,2.7,0,0,1,.4,1.5,2.41,2.41,0,0,1-.4,1.5,1,1,0,0,1-1,.5C88.7,11.6,88.2,10.9,88.2,9.6Zm2.4,28.5h-2V15.8h2Zm16.2-22.8a16,16,0,0,1,3,.3l-.4,1.9a13.58,13.58,0,0,0-2.9-.3,5.65,5.65,0,0,0-4.7,2.4,10,10,0,0,0-1.8,6.1V38H98V15.8h1.7l.2,4h.1a10.59,10.59,0,0,1,2.9-3.5A8.36,8.36,0,0,1,106.8,15.3ZM139,38.1h-6.3v-13H120.8V38h-6.4V8h6.4V19.8h11.9V8.1H139Zm17.4.4c-3.7,0-6.6-1-8.7-3.1s-3.1-4.9-3.1-8.7,1-6.8,2.9-8.9,4.6-3.1,8-3.1c3.2,0,5.8.9,7.6,2.8a10.38,10.38,0,0,1,2.7,7.6v3H151a6.16,6.16,0,0,0,1.6,4.2,5.59,5.59,0,0,0,4.1,1.5,16.11,16.11,0,0,0,3.9-.4,18.52,18.52,0,0,0,3.9-1.4v4.8A14.49,14.49,0,0,1,161,38,20.21,20.21,0,0,1,156.4,38.5Zm-.9-19.3a3.74,3.74,0,0,0-3.1,1.3,5.37,5.37,0,0,0-1.3,3.6h8.8a5.22,5.22,0,0,0-1.2-3.6A3.94,3.94,0,0,0,155.5,19.2Zm21.6,18.9h-6.3V6.2h6.3Zm19.2.4a7.61,7.61,0,0,1-6.3-2.9h-.3q.3,2.85.3,3.3v9.3h-6.3v-33h5.1l.9,3h.3a7.18,7.18,0,0,1,6.5-3.4,7.56,7.56,0,0,1,6.4,3.1c1.5,2.1,2.3,5,2.3,8.7a17.86,17.86,0,0,1-1.1,6.4,8.19,8.19,0,0,1-3.1,4.1,8.39,8.39,0,0,1-4.7,1.4Zm-1.9-18.8a4.15,4.15,0,0,0-3.4,1.4,8.12,8.12,0,0,0-1.1,4.7v.7a10,10,0,0,0,1.1,5.3,3.83,3.83,0,0,0,3.5,1.6q4.2,0,4.2-6.9a10,10,0,0,0-1-5.1A3.66,3.66,0,0,0,194.4,19.7Z"/></svg>',
compile:function(e,t){return this.link},_processAirHelpData:function(o,s){o.hasCompensation=!0,o.hasUrl=isDefined(safeAccess(s,"url"));var l="AIRHELP_ANALYTICS_EVENT_SENT",c=safeAccess(s,"potentialCompensations[0].amount",!1),d="itmngt.airHelp.button.withAmounttInfo",u="";if(c){var g=t("price");u=g({amount:c,currencyCode:safeAccess(s,"potentialCompensations[0].currencyCode","USD")})}else d="itmngt.airHelp.button.noAmountInfo";var p="itmngt.airHelp.label.brand",m="PLACEHOLDER_HERE";a.translate([p,d],{airHelpLogo:m,amount:m}).then(function(e){o.brandLabel=e[p].replace(m,r.airHelpSVGLogo),o.label=e[d].replace(m,u)});var f=n.get(l,n.LOCALSTORAGE);f=isDefined(f)?f:[];var v=o.tripId+"-"+s.refId+"_CLICKED",h=o.tripId+"-"+s.refId+"_DISPLAYED";o.airHelpClick=function(){if(isDefined(s.url)){if(getContext("isMobileApp",!1)&&i.cordova&&i.cordova.InAppBrowser){var t=ionic.Platform.isIOS()||ionic.Platform.isAndroid()?"_blank":"_self",a=ionic.Platform.isAndroid()?"location=yes,hidden=yes":"location=no,hidden=yes";i.cordova.InAppBrowser.open(s.url,t,a).show()}else i.open(s.url);-1===f.indexOf(v)&&(f.push(v),n.set(f,l,{storage:n.LOCALSTORAGE}),e.airHelpClicked(o.segment,{status:s.disruptionReason,amount:c}))}},-1===f.indexOf(h)&&(f.push(h),n.set(f,l,{storage:n.LOCALSTORAGE}),e.airHelpDisplayed(o.segment,{status:s.disruptionReason,amount:c}))},link:function(e,t,n,i){isDefined(e.airHelpData)?r._processAirHelpData(e,e.airHelpData):(e.hasCompensation=!1,e.hasUrl=!1,e.$watch("airHelpData",function(t,n){isDefined(t)?r._processAirHelpData(e,t):""}))}};return r}]),itmngtModule.directive("airHelpBannerLink",["TripAnalyticsService","$filter","DataManagerService","I18nService",function(e,t,n,i){var a={restrict:"E",templateUrl:"itmngt/directives/AirHelpBannerDirective.html",scope:{airHelpData:"=",tripId:"=",segment:"="},airHelpSVGLogo:'<svg height="20px" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 205.1 51.2"><defs><style>.cls-1{fill:#fff;}</style></defs><title>airhelp</title><path class="cls-1" d="M16.9,1.5a22.9,22.9,0,0,0-6,3.2,26.06,26.06,0,0,0-8.4,9.9,25,25,0,0,0-2.2,7,27,27,0,0,0,.1,8.5A24.41,24.41,0,0,0,6.3,42.5a25.64,25.64,0,0,0,26.8,7.7A25.26,25.26,0,0,0,48.2,37.9a7,7,0,0,0,1.3-3.3,2.74,2.74,0,0,0-1.9-2.7,2.36,2.36,0,0,0-2.8,1,10.09,10.09,0,0,0-.7,1.5,10.93,10.93,0,0,1-.8,1.5A19.76,19.76,0,0,1,30,45.5a19.36,19.36,0,0,1-8.3,0,19.67,19.67,0,0,1-11.5-6.9A20.09,20.09,0,0,1,5.5,25a19.16,19.16,0,0,1,5.3-13A19.84,19.84,0,0,1,22.7,5.6a22.92,22.92,0,0,1,10,1c.6.2,1,.5,1.6.7a2.5,2.5,0,0,0,2.9-1.5,3,3,0,0,0-1-3.3,5.93,5.93,0,0,0-1.6-.7A24.79,24.79,0,0,0,24.7.2,23.6,23.6,0,0,0,16.9,1.5ZM33.5,14a10.2,10.2,0,0,0,.9-2.2,2.57,2.57,0,0,0-2.6-3.2c-1.8.1-2.3,1.6-2.9,3-1.6,3.8-3.4,8-5,11.7-1.2.4-2.3.9-3.6,1.4s-2.3,1.1-2.5,2.5A2.43,2.43,0,0,0,20.4,30a6.18,6.18,0,0,0,2.7-.9c.9-.4,1.8-.7,2.6-1,3.9,1.7,8.2,3.5,12.1,5.2a4.24,4.24,0,0,0,1.9.6,2.51,2.51,0,0,0,2.8-2.2,2.75,2.75,0,0,0-1.2-2.6,13.55,13.55,0,0,0-2.1-1c-2.2-.9-4.4-1.8-6.5-2.8,4.6-1.8,9.2-3.6,13.7-5.5a8.38,8.38,0,0,0,1.9-.9,2.66,2.66,0,0,0,1-2.9,2.52,2.52,0,0,0-2.5-1.8,6.64,6.64,0,0,0-2.7.9L30.6,20.5C31.7,18.4,32.6,16.1,33.5,14Z"/><path class="cls-1" d="M24.6,0a24.79,24.79,0,0,1,9.9,1.6,7.74,7.74,0,0,1,1.6.7,3,3,0,0,1,1,3.3,2.4,2.4,0,0,1-2.9,1.5,7.74,7.74,0,0,1-1.6-.7,22.92,22.92,0,0,0-10-1,19.84,19.84,0,0,0-11.9,6.4,19.36,19.36,0,0,0-5.3,13,19.9,19.9,0,0,0,4.7,13.6,20.19,20.19,0,0,0,11.5,6.9,23.15,23.15,0,0,0,8.3,0,19.76,19.76,0,0,0,13.3-9.6,10.93,10.93,0,0,0,.8-1.5,6.89,6.89,0,0,1,.7-1.5,2.36,2.36,0,0,1,2.8-1,2.65,2.65,0,0,1,1.9,2.7,7,7,0,0,1-1.3,3.3A25.06,25.06,0,0,1,33,50.1,25.64,25.64,0,0,1,6.2,42.4,25.14,25.14,0,0,1,.4,30a26.93,26.93,0,0,1-.1-8.5A25.67,25.67,0,0,1,10.9,4.6a24.35,24.35,0,0,1,6-3.2A35.17,35.17,0,0,1,24.6,0Z"/><path class="cls-1" d="M30.7,20.5c4.4-1.8,9-3.6,13.5-5.4a7.17,7.17,0,0,1,2.7-.9,2.58,2.58,0,0,1,1.5,4.7,11.08,11.08,0,0,1-1.9.9c-4.6,1.8-9.2,3.7-13.7,5.5,2.1,1,4.3,1.9,6.5,2.8a13.55,13.55,0,0,1,2.1,1,2.57,2.57,0,0,1,1.2,2.6,2.51,2.51,0,0,1-2.8,2.2,8.24,8.24,0,0,1-1.9-.6c-3.9-1.7-8.2-3.5-12.1-5.2-.8.3-1.7.7-2.6,1a8.6,8.6,0,0,1-2.7.9,2.43,2.43,0,0,1-2.6-2.8c.1-1.5,1.3-2.1,2.5-2.5s2.4-1,3.6-1.4c1.6-3.6,3.3-7.8,5-11.7.6-1.4,1.1-2.9,2.9-3a2.54,2.54,0,0,1,2.6,3.2,10.2,10.2,0,0,1-.9,2.2C32.6,16.1,31.7,18.4,30.7,20.5Z"/><path class="cls-1" d="M78.3,27.5H66.1L61.9,38.1H59.6L71.6,8H73L84.8,38.1H82.4ZM66.8,25.6H77.5L73.4,14.8a33.8,33.8,0,0,1-1.2-3.5q-.6,2-1.2,3.6Zm21.4-16c0-1.3.4-2,1.3-2a1.23,1.23,0,0,1,1,.5,2.7,2.7,0,0,1,.4,1.5,2.41,2.41,0,0,1-.4,1.5,1,1,0,0,1-1,.5C88.7,11.6,88.2,10.9,88.2,9.6Zm2.4,28.5h-2V15.8h2Zm16.2-22.8a16,16,0,0,1,3,.3l-.4,1.9a13.58,13.58,0,0,0-2.9-.3,5.65,5.65,0,0,0-4.7,2.4,10,10,0,0,0-1.8,6.1V38H98V15.8h1.7l.2,4h.1a10.59,10.59,0,0,1,2.9-3.5A8.36,8.36,0,0,1,106.8,15.3ZM139,38.1h-6.3v-13H120.8V38h-6.4V8h6.4V19.8h11.9V8.1H139Zm17.4.4c-3.7,0-6.6-1-8.7-3.1s-3.1-4.9-3.1-8.7,1-6.8,2.9-8.9,4.6-3.1,8-3.1c3.2,0,5.8.9,7.6,2.8a10.38,10.38,0,0,1,2.7,7.6v3H151a6.16,6.16,0,0,0,1.6,4.2,5.59,5.59,0,0,0,4.1,1.5,16.11,16.11,0,0,0,3.9-.4,18.52,18.52,0,0,0,3.9-1.4v4.8A14.49,14.49,0,0,1,161,38,20.21,20.21,0,0,1,156.4,38.5Zm-.9-19.3a3.74,3.74,0,0,0-3.1,1.3,5.37,5.37,0,0,0-1.3,3.6h8.8a5.22,5.22,0,0,0-1.2-3.6A3.94,3.94,0,0,0,155.5,19.2Zm21.6,18.9h-6.3V6.2h6.3Zm19.2.4a7.61,7.61,0,0,1-6.3-2.9h-.3q.3,2.85.3,3.3v9.3h-6.3v-33h5.1l.9,3h.3a7.18,7.18,0,0,1,6.5-3.4,7.56,7.56,0,0,1,6.4,3.1c1.5,2.1,2.3,5,2.3,8.7a17.86,17.86,0,0,1-1.1,6.4,8.19,8.19,0,0,1-3.1,4.1,8.39,8.39,0,0,1-4.7,1.4Zm-1.9-18.8a4.15,4.15,0,0,0-3.4,1.4,8.12,8.12,0,0,0-1.1,4.7v.7a10,10,0,0,0,1.1,5.3,3.83,3.83,0,0,0,3.5,1.6q4.2,0,4.2-6.9a10,10,0,0,0-1-5.1A3.66,3.66,0,0,0,194.4,19.7Z"/></svg>',compile:function(e,t){return this.link},_processAirHelpData:function(r,o){r.hasCompensation=!0,r.hasUrl=isDefined(safeAccess(o,"url"));var s="AIRHELP_ANALYTICS_EVENT_SENT",l=safeAccess(o,"potentialCompensations[0].amount",!1),c="itmngt.airHelp.button.withAmounttInfo",d="";if(l){var u=t("price");d=u({amount:l,currencyCode:safeAccess(o,"potentialCompensations[0].currencyCode","USD")})}else c="itmngt.airHelp.button.noAmountInfo";var g="itmngt.airHelp.label.brand",p="PLACEHOLDER_HERE";i.translate([g,c],{airHelpLogo:p,amount:p}).then(function(e){r.brandLabel=e[g].replace(p,a.airHelpSVGLogo),r.label=e[c].replace(p,d)});var m=n.get(s,n.LOCALSTORAGE);m=isDefined(m)?m:[];var f=r.tripId+"-"+o.refId+"_DISPLAYED";-1===m.indexOf(f)&&(m.push(f),n.set(m,s,{storage:n.LOCALSTORAGE}),e.airHelpDisplayed(r.segment,{status:o.disruptionReason,amount:l}))},link:function(e,t,n,i){isDefined(e.airHelpData)?a._processAirHelpData(e,e.airHelpData):(e.hasCompensation=!1,e.hasUrl=!1,e.$watch("airHelpData",function(t,n){isDefined(t)?a._processAirHelpData(e,t):""}))}};return a}]),itmngtModule.directive("recoCarouselItem",["RecoAvailabilitiesService","ActivityRecoAvailabilityService","RecoBackgroundConstructionService",function(e,t,n){var i={restrict:"E",templateUrl:"itmngt/directives/RecoCarouselItem.html",scope:{ngModel:"="},link:function(i,a,r,o){var s=safeAccess(i,"ngModel.recoType","").toLowerCase();switch(s){case"activity":i.icon="etr_ACTIVITY",i.header="itmngt.label.missingActivity";break;case"taxi":i.icon="etr_TAXI",i.header="itmngt.label.missingTransfer";break;case"hotel":i.icon="hotel",i.header="itmngt.label.hotelAccommodation";break;case"parking":i.icon="etr_PARKING",i.header="itmngt.label.needParkingCarousel";break;case"lounge":i.icon="etr_LOUNGE",i.header="itmngt.label.needLounge"}if(i.css=s,i.bookNow=function(){i.$emit("reco-carousel-item-selected",i.ngModel)},i.getActivityStyledBackground=function(e){return n.getActivityRecoStyledBackground(e)},"taxi"===s){var l=safeAccess(i,"ngModel.recLocFromRefId","");e.getRecoAvailabilityForSegments([i.ngModel],l).then(function(e){i.segment=e[0]})}if("activity"===s){var c=safeAccess(i,"ngModel.recLocFromRefId","");t.getActivityRecoAvailabilityForSegment(i.ngModel,c).then(function(e){i.segment=e})}"parking"!==s&&"lounge"!==s||(i.locationRecoText=safeAccess(i,"ngModel.location.name","")+" ("+safeAccess(i,"ngModel.location.code","")+")")}};return i}]),itmngtModule.run(["$templateCache",function(e){e.put("itmngt/directives/AirHelpBannerDirective.html",'<div class="air-help-banner" debug-file-path="AirHelpBannerDirective.html" ng-if="hasCompensation"><i class="icon-add-item"></i><div class="compensation" translate>itmngt.airHelp.button.noAmountInfo</div></div>'),e.put("itmngt/directives/AirHelpLinkDirective.html",'<div class="air-help-compensation" debug-file-path="AirHelpLinkDirective.html" ng-click="airHelpClick()" ng-if="hasCompensation"><i class="icon-add-item"></i><div class="compensation" ng-bind-html="label | trustAsHtml"></div><div class="brand" ng-bind-html="brandLabel | trustAsHtml"></div><i class="icon-chevron-right-rounded" ng-if="hasUrl"></i></div>'),e.put("itmngt/directives/FreeTextWithTitleDirective.html",'<div debug-file-path="FreeTextWithTitleDirective.html"><h2 ng-if="blocTitle">{{::(blocTitle | translate)}}</h2><div class="free-text" ng-if="text">{{text}}</div><div class="free-text" ng-if="!text">{{(defaultText | translate)}}</div></div>'),e.put("itmngt/directives/MapLinkDirective.html",'<a class="alwaysClickable" debug-file-path="MapLinkDirective.html" ng-click="mapLinkClick($event)" ng-if="hasMapLink"><span class="icon-location"></span> <span ng-bind-html="displayText | trustAsHtml"></span> </a><span ng-if="(!hasMapLink &amp;&amp; showDefaultMessage)"><span class="icon-location"></span> <span class="map-link-default-message" ng-bind-html="displayText | trustAsHtml | translate"></span></span>'),e.put("itmngt/directives/RecoCarouselItem.html",'<div class="trip-panel" debug-file-path="RecoCarouselItem.html"><header class="reco-carousel-item-header"><h1 class="trip-{{::icon}}">{{header| translate}}</h1></header><section class="reco-carousel-item-body {{::css}}-reco" ng-click="bookNow()" ng-style="getActivityStyledBackground(segment)"><p class="reco-text" ng-if="locationRecoText">{{&apos;itmngt.label.in&apos; | translate}} {{locationRecoText}}</p><p class="reco-text" ng-if="segment._taxiAvailability">{{&apos;itmngt.label.passenger&apos; | translate:&quot;{numberOfPax:&quot;+segment._taxiAvailability.nip+&quot;}&quot;:&quot;messageformat&quot;}}</p><p class="reco-text text-ellipsis" ng-if="segment._activityAvailability">{{segment._activityAvailability.title}}</p><button class="btn-small" ng-if="!segment._taxiAvailability &amp;&amp; !segment._activityAvailability" type="button">{{&apos;itmngt.label.bookNow&apos;|translate}}</button> <button class="btn-small book-now" ng-if="segment._taxiAvailability" type="button">{{&apos;itmngt.label.from&apos; | translate}} {{segment._taxiAvailability.price | price}}</button> <button class="btn-small book-now" ng-if="segment._activityAvailability" type="button" translate="itmngt.label.bookFor" translate-values="{price: &apos;{{segment._activityAvailability.price | price}}&apos;}"></button></section></div>'),e.put("itmngt/directives/SeatBySegmentDirective.html",'<dt debug-file-path="SeatBySegmentDirective.html" ng-class="$first ? &apos;{{additionalClass}}&apos; : &apos;second-seat-number sr-only&apos;" ng-if-start="segment.travellers.length" ng-repeat-start="traveller in segment.travellers track by $index" translate translate-interpolation="messageformat" translate-values="{ numberOfSeat: segment.travellers.length }">itmngt.label.seat</dt><dd class="{{additionalClass}}" ng-if-end ng-repeat-end><seat-by-traveller first-name="traveller.firstName" last-name="traveller.lastName" seat="traveller.seat" segment="segment"></seat-by-traveller></dd>'),e.put("itmngt/directives/SeatByTravellerDirective.html",'<span class="seat-number segment-seats" debug-file-path="SeatByTravellerDirective.html" ng-if="(!showLink)">{{seat || &apos;-&apos;}}</span><a class="seat-number segment-seats" ng-click="seatLinkClick($event)" ng-if="showLink">{{seat || &apos;-&apos;}}</a>'),e.put("itmngt/directives/SegmentButtonPanelDirective.html",'<div class="alignHorizontal" debug-file-path="SegmentButtonPanelDirective.html" ng-hide="hidePanel"><a href ng-click="goToDirections()" ng-hide="hideTakeMeThere"><i class="iconDesign tripDetails icon-take-me-there"></i><br><span translate>itmngt.segmentExpanded.button.getThere</span> </a><a href ng-click="goToExplore()" ng-hide="hideExplore"><i class="iconDesign tripDetails icon-explore"></i><br><span translate>itmngt.segmentExpanded.button.discover</span> </a><a href ng-click="goToTripAdvisor()" ng-hide="hideTripAdvisor"><i class="iconDesign tripDetails icon-explore"></i><br><span translate>itmngt.segmentExpanded.button.discover</span> </a><a href ng-click="showAddressToTaxiDriver()" ng-hide="hideTaxiDriver" class="hide-for-large"><i class="iconDesign tripDetails icon-taxi-driver"></i><br><span translate>itmngt.segmentExpanded.button.taxiDriver</span></a></div><script id="taxi-driver-modal.html" type="text/ng-template"><div class="modal taxi-driver-modal" ng-attr-style="left: {{setLeft}}">\n        <div class="modalContent">\n            <div class="iconCloseTaxiDriver icon-close alignRight" ng-click="closeExpandViewModal()"></div>\n            <div class="taxiDriverAddressContainer">\n                <div class="align-taxi-address">\n                    <div class="taxi-address headingText">{{addressName}}</div>\n                    <div class="infoText">\n                        <div class="taxi-address">{{addressLine}}</div>\n                        <div class="taxi-address">{{place}} </div>\n                        <div class="taxi-address">{{zip}}</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div></script>'),e.put("itmngt/directives/SegmentInformationListDirective.html",'<div class="segmentInformationList" debug-file-path="SegmentInformationListDirective.html"><h2 class="segmentInformationListTitle" ng-if="blocTitle">{{::(blocTitle | translate)}}</h2><div class="passenger-details-card"><div class="segmentInformationListContent" ng-repeat="(key, data) in blocValues"><dl><dt ng-bind-html="key|translate"></dt><dd ng-class="data.className"><div ng-class="{&apos;segment-information-highlight&apos;: data.action &amp;&amp; !data.action.isDisabled}" ng-click="data.action.callback()"><p ng-bind-html="(data.value || &apos;-&apos;) | translate | nonBreaking"></p><i class="ion-ios-arrow-forward" ng-if="data.action &amp;&amp; !data.action.isDisabled"></i></div></dd></dl></div></div></div>'),e.put("itmngt/directives/VendorContactCardDirective.html",'<article class="vendor-contact-card" debug-file-path="VendorContactCardDirective.html"><header><h1 class="breakLine">{{vendorName || &apos;-&apos;}}</h1><img ng-src="{{vendorLogo}}" onerror="this.style.display=&apos;none&apos;;"></header><a ng-href="{{(vendorPhone ? &apos;tel:&apos; + vendorPhone : &apos;&apos;)}}"><dl class="phone"><dt translate>itmngt.label.phone</dt><dd ng-bind-html="(vendorPhone || &apos;-&apos;) | nonBreaking"></dd></dl></a><a ng-href="{{(vendorEmail ? &apos;mailto:&apos; + vendorEmail : &apos;&apos;) | lowercase}}"><dl class="email"><dt translate>itmngt.label.email</dt><dd ng-bind-html="(vendorEmail || &apos;-&apos;) | lowercase | nonBreaking"></dd></dl></a></article>'),e.put("itmngt/templates/pages/AddTripModal.html",'<ion-modal-view debug-file-path="AddTripModal.html" ng-controller="AddTripModalController"><ion-header-bar class="bar-stable"><h1 class="title" translate>itmngt.title.addTrip</h1><span class="button button-clear icon {{::closeicon}}" ng-click="closeAddTripModal()"></span></ion-header-bar><ion-content class="spaced-layout"><div><form id="add-trip-form" name="forms.addtripform" novalidate><cmt-input-text data="addPnrInputs.tripId" label="{{&apos;itmngt.label.tripId&apos;|translate}}" name="tripId" required use-pattern="PNR"></cmt-input-text><cmt-input-text data="addPnrInputs.lastName" label="{{&apos;itmngt.label.name&apos;|translate}}" name="lastName" required use-pattern="lastName" class="semi-spaced-element"></cmt-input-text><cmt-input-text data="addPnrInputs.firstName" label="{{&apos;itmngt.label.firstName&apos;|translate}}" name="firstName" required use-pattern="firstName" class="semi-spaced-element" ng-if="isFirstNameRequired"></cmt-input-text><button class="spaced-element btn-fullwidth" id="add-trip-submit" name="add_trip_modal_submit" ng-click="addTrip()" translate type="submit">itmngt.button.importTrip</button></form><p class="spaced-element" translate>{{isFirstNameRequired ? &apos;itmngt.text.importTripWithLastNameAndFirstNameSentence&apos; : &apos;itmngt.text.importTripWithLastNameSentence&apos;}}</p></div></ion-content></ion-modal-view>'),e.put("itmngt/templates/pages/PastTripsView.html",'<ion-view debug-file-path="PastTripsView.html"><ion-nav-title translate>itmngt.title.loadPastTrips</ion-nav-title><ion-content \\ class="hasFloatingButton" id="triplistScrollHandle"><section class="contained-pad timeline-home" ng-class="status"><div class="banner"></div><section class="timeline-module"><div class="nodes-line first" ng-if="trips.length !== 0"></div></section><div class="custom-triplist-bg-message" ng-if="trips.length === 0" translate>itmngt.label.noPastTrips</div><section class="timeline-module" id="trip_{{trip.tripId}}" ng-repeat="trip in trips | orderBy:&apos;-endDate.utcTimestampMillis&apos; track by $index"><div class="nodes-line"><div class="dateHolder"><span class="date" ng-bind-html="trip | tripstart"></span></div></div><div class="timeline-card {{trip.bgImageClass}}" ng-click="pastTripExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName})"><div class="container"><div class="trip-data"><header><h1>{{trip.title}}</h1></header><span class="remaining">{{trip | tripStatusLabel}}</span> <span class="dates">{{trip | tripdate}}</span></div><air-help-banner-link air-help-data="trip.airHelpData" trip-id="trip.tripId"></air-help-banner-link></div></div></section></section></ion-content></ion-view>'),e.put("itmngt/templates/pages/SegmentExpandedView.html",'<ion-view debug-file-path="SegmentExpandedView.html"><ion-nav-title>{{segment.title}}</ion-nav-title><ion-nav-buttons side="primary"><ssr-shopping-cart-button enabled-if="&apos;ssrShoppingCart&apos;"></ssr-shopping-cart-button></ion-nav-buttons><ion-content has-bouncing="true"><div class="contained"><ng-include src="&apos;itmngt/templates/partial/SegmentDetailsPartial.html&apos;"></ng-include></div></ion-content></ion-view>'),e.put("itmngt/templates/pages/TripExpandedView.html",'<ion-view debug-file-path="TripExpandedView.html"><ion-nav-title>{{trip.title}}</ion-nav-title><ion-nav-buttons side="primary"><ssr-shopping-cart-button enabled-if="&apos;ssrShoppingCart&apos;"></ssr-shopping-cart-button><cmt-menu context="menuContext" is-header-menu="true" list="menuList" menu-style="menuStyle"></cmt-menu></ion-nav-buttons><ion-content class="hasFloatingButton" has-bouncing="true"><ion-refresher ng-if="pullToRefreshEnabled" on-refresh="pullToRefresh()" pulling-text="{{&apos;itmngt.label.pullToRefresh&apos;|translate}}" spinner="lines"></ion-refresher><script id="destinationImagesSlideBox.html" type="text/ng-template"><ion-modal-view class="destinationImagesModal">\n        <ion-content ng-click="closeModal()">\n          <ion-slides slider="data.slider" >\n            <ion-slide-page ng-repeat="destinationImage in destinationImages">\n              <div class="destinationImageContainer" >\n                <img image-lazy-src="{{destinationImage}}"\n                     image-lazy-loader="lines"\n                     image-lazy-load-if-hidden="true"\n                     image-lazy-error-text="{{\'itmngt.error.loadImageError\' | translate}}"\n                     class="destinationImage" />\n              </div>\n            </ion-slide-page>\n          </ion-slides>\n        </ion-content>\n      </ion-modal-view></script><div class="hero {{config.heroclass}}" id="header-image-div" ng-click="openDestinationImagesModal()"></div><div class="card-pad contained-pad tripDetailsAdBanner" ng-class="{&apos;tripDetailsAdBanner-displayed&apos;: advertisementBanner.hasAdvertisement}"><section class="expanded trip-panel"><header><h1 class="trip-ad trip-destination">Ad</h1></header><section class="trip-details tripDetailsAdBannerContainer" id="{{advertisementBanner.scriptContainerId}}"></section></section></div><div class="card-pad contained-pad {{segment.type}}-section" ng-class="{&apos;grayCard&apos;: segment.isPastSegment &amp;&amp; greyOutPastSegment, &apos;disabledCard&apos;: segment.isReadOnly}" ng-init="_segmentIncludePath = getSegmentIncludePath(segment); _segmentOrService = &apos;segments&apos;;" ng-repeat="segment in displayableSegments track by segment.refId"><ng-include src="_segmentIncludePath" onload="sendAnalytics(trip,segment)"></ng-include><div class="printable-segment-details" enabled-if="&apos;print&apos;"><ng-include src="&apos;itmngt/templates/partial/SegmentDetailsPartial.html&apos;"></ng-include></div></div><div class="card-pad contained-pad" ng-class="{&apos;grayCard&apos;: segment.isPastSegment &amp;&amp; greyOutPastSegment}" ng-init="_segmentIncludePath = getSegmentIncludePath(segment); _segmentOrService = &apos;services&apos;;" ng-repeat="segment in trip.tripDetails.services track by segment.refId" ng-if="displayableSegments"><ng-include src="_segmentIncludePath"></ng-include><div class="printable-service-details" enabled-if="&apos;print&apos;"><ng-include src="&apos;itmngt/templates/partial/SegmentDetailsPartial.html&apos;"></ng-include></div></div></ion-content></ion-view>'),e.put("itmngt/templates/pages/TriplistView.html",'<ion-view debug-file-path="TriplistView.html"><ion-nav-title translate>itmngt.title.feed</ion-nav-title><ion-nav-buttons side="primary"><cmt-menu context="trips" is-header-menu="true" list="menuList" menu-style="menuStyle"></cmt-menu></ion-nav-buttons><div ng-if="!showEmptyTripList" ng-class="{&apos;custom-triplist-bg&apos;: isTripListBackgroundImageAvailable}"></div><div ng-if="!showEmptyTripList" ng-class="{&apos;custom-triplist-bg-bottom&apos;: isTripListBackgroundImageAvailable}"></div><ion-content class="hasFloatingButton" id="triplistScrollHandle" ng-class="{&apos;custom-triplist-bg-content&apos;: isTripListBackgroundImageAvailable}"><div id="triplist-progress-bar"></div><ion-refresher ng-if="pullToRefreshEnabled" on-refresh="pullToRefresh()" pulling-text="{{&apos;itmngt.label.pullToRefresh&apos;|translate}}" spinner="lines"></ion-refresher><section class="contained-pad timeline-home" ng-class="status"><div class="banner"></div><section class="timeline-module e2e-timeline-module"><div class="nodes-line first" ng-if="showEmptyTripList"></div><div class="pastTripButtonContainer"><button class="btn-small" id="loadPastTripsButton" ng-click="loadPastTripButtonClick();" ng-disabled="disableLoadPastTrip" ng-if="!pastTripMenu" type="button"><i class="icon-past-trip space-rt"></i>{{&apos;itmngt.button.loadPastTrips&apos; | translate}}</button></div></section><ng-include ng-if="trips.length === 0" src="&apos;itmngt/templates/partial/timelineAdBannerCardPartial.html&apos;"></ng-include><section class="timeline-module e2e-timeline-module" id="trip_{{trip.tripId}}" ng-repeat-start="trip in trips"><div ng-if="trip.isMostRecentPastTrip" id="recentPastTripVirtualAnchor" style="position:absolute"></div><div ng-if="trip.isFirstNonPastTrip" id="upcomingTripsVirtualAnchor" style="position:absolute"></div><div class="nodes-line" ng-if="showEmptyTripList"><div class="dateHolder"><span class="date" ng-bind-html="trip | tripstart"></span></div></div><div class="timeline-card {{trip.bgImageClass}}" ng-click="tripExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName})"><div class="container"><div class="trip-data"><header><h1>{{trip.title}}</h1></header><span class="remaining">{{trip | tripStatusLabel}}</span> <span class="dates">{{trip | tripdate}}</span></div><air-help-banner-link air-help-data="trip.airHelpData" trip-id="trip.tripId"></air-help-banner-link></div></div></section><ng-include ng-if="trip.tripId === displayAdAfterTripId" src="&apos;itmngt/templates/partial/timelineAdBannerCardPartial.html&apos;" ng-repeat-end></ng-include><div class="custom-triplist-bg-message" ng-if="!showEmptyTripList" ng-class="{&apos;email-forward-disabled&apos;: !emailForwardEnabled}">{{&apos;itmngt.label.emptyTriplistNoUpcomingTrips&apos; | translate}}</div><div class="custom-triplist-bg-message-wait" ng-if="trips.length === 0 &amp;&amp; !tripLoadCompleted" translate>itmngt.label.loadWait</div><section class="timeline-module timeline-module-email" ng-class="{&apos;custom-triplist-bg-email&apos;: (isTripListBackgroundImageAvailable &amp;&amp; !showEmptyTripList)}" ng-if="emailForwardEnabled &amp;&amp; tripLoadCompleted"><div class="nodes-line" ng-if="showEmptyTripList"></div><div><div class="icons"><i class="i-large icon-send"></i> <i class="i-huge icon-envelope"></i> <i class="i-large icon-arrow-right"></i> <i class="i-huge" ng-class="{&apos;icon-iphone&apos;: !isWebDesktop, &apos;icon-desktop&apos;: isWebDesktop}" ng-click="handleEasterEgg()" style="cursor:default"></i></div><p class="e2e-add-your-trip" translate>itmngt.label.addYourTrips</p><p><a class="forward-trip-email" ng-click="tryCopyingEmailToClipboard($event)">{{forwardTripEmail}}</a></p></div></section></section></ion-content></ion-view>'),e.put("itmngt/templates/partial/ACTIVITYSegmentPartial.html",'<ng-include debug-file-path="ACTIVITYSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrMoveSegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/AIRSegmentPartial.html",'<section class="expanded trip-panel" debug-file-path="AIRSegmentPartial.html" id="segment_{{::segment.index}}"><header><h1 class="trip-destination trip-flight"><cmt-menu class="segment-menu-button" context="segment" list="segmentMenuList"></cmt-menu>{{::segment.title || &apos;-&apos;}}</h1><button class="btn-checkIn btn-small" name="check_in_view_button" ng-click="gotoCheckInView(segment)" ng-disabled="!segment.isCheckInEnabled" ng-show="segment.displayCheckinButton" stop-propagation translate type="button">itmngt.button.checkin</button> <button class="btn-eitr icon-e-itr" name="download_eticket_reciept_button" ng-click="downloadEticketReceipt(segment)" ng-disabled="!segment.isEitrDownloadAvailable" ng-show="segment.isEitrDownloadButtonDisplayed" stop-propagation>eTkt</button></header><section class="trip-details" ng-click="goToSegmentExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName, segmentRefId: segment.refId})"><header class="cmtsegment flight"><dl><dt translate class="confirmation">itmngt.label.confirmation</dt><dd>{{::segment.confirmationNumber || &apos;-&apos;}}</dd><dt translate class="bookingStatus" ng-if-start="segment.status">itmngt.label.segmentStatus</dt><dd class="segment-status segment-status-{{segment.status}}" translate ng-if-end>{{&apos;itmngt.label.segmentStatuses.&apos; + segment.status}}</dd></dl><dl><dt translate class="sr-only vendor-logo vendor-name" ng-if-start="segment.marketingCarrierLogo">itmngt.label.vendor</dt><dd class="semi-spaced-element" ng-bind-html="segment.marketingCarrierLogo" ng-if-end></dd><dt translate>itmngt.label.flightnumber</dt><dd>{{::(segment.flight.airlineCode &amp;&amp; segment.flight.flightNumber) ? segment.flight.airlineCode+segment.flight.flightNumber : &apos;-&apos;}}</dd><dt translate ng-if-start="segment.seats.length" translate-interpolation="messageformat" translate-values="{ numberOfSeat: segment.travellers.length }" ng-class="$first ? &apos;seat-number&apos; : &apos;second-seat-number sr-only&apos;" ng-repeat-start="seat in segment.seats track by $index">itmngt.label.seat</dt><dd ng-if-end ng-repeat-end><seat-by-traveller first-name="firstName" last-name="lastName" seat="seat" segment="segment"></seat-by-traveller></dd><dt translate ng-if-start="!segment.seats.length" translate-interpolation="messageformat" translate-values="{ numberOfSeat: 0 }">itmngt.label.seat</dt><dd ng-if-end>-</dd><dt translate class="vendor-name vendor-text" ng-if-start="segment.operatingCarrierLogo">itmngt.label.operatedby</dt><dd></dd><dt translate class="sr-only vendor-logo vendor-name vendor-name-operator">itmngt.label.vendor</dt><dd ng-if-end ng-bind-html="segment.operatingCarrierLogo"></dd></dl></header><div class="banner"><i class="icon-alert-tri-filled"></i> <span class="text-banner"></span></div><div class="main"><section class="departure"><header><h1><i class="icon-flight-take-off"></i> {{&apos;itmngt.label.departure&apos;|translate}}</h1></header><div class="cmt-row"><dl><dt translate class="sr-only time">itmngt.label.departuretime</dt><dd class="departure-time">{{::segment.startDate|time24h}}</dd><dt translate class="sr-only date" ng-class="{&apos;date-without-time&apos;: !segment.startDate.hasTime}">itmngt.label.departuredate</dt><dd class="departure-date" ng-bind-html="segment.startDate | segmentDayLongTwoLines"></dd><div class="clear"></div><dt translate class="sr-only">itmngt.label.estimatedDeparture</dt><dd class="fs-departure-title" translate>itmngt.label.estimatedDeparture</dd><dt translate class="sr-only time">itmngt.label.departuretime</dt><dd class="fs-departure-time"></dd><dt translate class="sr-only date">itmngt.label.departuredate</dt><dd class="fs-departure-date"></dd><dt translate class="sr-only airport">itmngt.label.departureairport</dt><dd><map-link label="{{segment.fromLocation|displayAirport}}" location="segment.fromLocation"></map-link></dd><dt translate class="terminal">itmngt.label.terminal</dt><dd class="fs-departure-terminal">{{::segment.departureTerminal || &apos;-&apos;}}</dd><dt translate class="gate">itmngt.label.gate</dt><dd class="fs-departure-gate">{{::segment.departureGate || &apos;-&apos;}}</dd></dl></div></section><section class="duration"><div class="cmt-row"><dl><dt class="duration-detail"></dt><dd class="duration-period">{{segment.duration.hours}}h {{segment.duration.minutes}}m</dd></dl></div></section><section class="arrival"><header><h1><i class="icon-flight-land"></i> {{&apos;itmngt.label.arrival&apos;|translate}}</h1></header><div class="cmt-row"><dl><dt translate class="sr-only time">itmngt.label.arrivaltime</dt><dd class="arrival-time">{{::segment.endDate|time24h}}</dd><dt translate class="sr-only date" ng-class="{&apos;date-without-time&apos;: !segment.endDate.hasTime}">itmngt.label.arrivaldate</dt><dd class="arrival-date" ng-bind-html="segment.endDate | segmentDayLongTwoLines"></dd><div class="clear"></div><dt translate class="sr-only">itmngt.label.estimatedArrival</dt><dd class="fs-arrival-title" translate>itmngt.label.estimatedArrival</dd><dt translate class="sr-only time">itmngt.label.arrivaltime</dt><dd class="fs-arrival-time"></dd><dt translate class="sr-only date">itmngt.label.arrivaldate</dt><dd class="fs-arrival-date"></dd><dt translate class="sr-only airport">itmngt.label.arrivalairport</dt><dd><map-link label="{{segment.toLocation|displayAirport}}" location="segment.toLocation"></map-link></dd><dt translate class="terminal">itmngt.label.terminal</dt><dd class="fs-arrival-terminal">{{::segment.arrivalTerminal || &apos;-&apos;}}</dd></dl></div></section></div></section><ng-include src="&apos;itmngt/templates/partial/GenericCardFooterPartial.html&apos;"></ng-include></section><article class="contained-narrow" ng-if="segment.alternateFlightSearch.displayButton &amp;&amp; !segment.isReadOnly"><button class="btn-fullwidth btn-large" name="alternate_flight_search_button" ng-click="alternateFlightSearchClick(segment)" translate type="button">itmngt.label.airTripAlternateSearch</button></article>'),e.put("itmngt/templates/partial/CAROUSELSegmentPartial.html",'<section class="carousel layover reco-panel-layover" id="segment_{{segment.index}}" ng-if="segment.inLayover" debug-file-path="CAROUSELSegmentPartial.html"><div class="nodes-line"></div><div class="layover-carousel-container"><a-carousel array-provider="::segment.list" carousel-id="carousel_{{segment.index}}" carousel-options="::segment.config" item-directive="reco-carousel-item"></a-carousel></div></section><section class="expanded reco-panel" id="segment_{{segment.index}}" ng-if="!segment.inLayover"><a-carousel array-provider="::segment.list" carousel-id="carousel_{{segment.index}}" carousel-options="::segment.config" item-directive="reco-carousel-item"></a-carousel></section>'),
e.put("itmngt/templates/partial/CARSegmentPartial.html",'<section class="expanded trip-panel" debug-file-path="CARSegmentPartial.html" id="segment_{{segment.index}}"><header><h1 class="trip-car trip-destination"><cmt-menu class="segment-menu-button" context="segment" list="segmentMenuList"></cmt-menu>{{segment.title || &apos;-&apos;}}</h1></header><section class="trip-details" ng-click="goToSegmentExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName, segmentRefId: segment.refId})"><header class="car cmtsegment"><dl><dt translate>itmngt.label.confirmation</dt><dd>{{segment.confirmationNumber || &apos;-&apos;}}</dd><dt class="sr-only vendor-logo vendor-name"></dt><dd class="company-name" ng-bind-html="segment.marketingCarrierLogo || &apos;-&apos;"></dd></dl></header><div class="main"><section class="departure"><header><h1 translate>itmngt.label.pickup</h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.pickuptime</dt><dd class="departure-time">{{segment.pickupDateTime|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.pickupDateTime.hasTime}">itmngt.label.departuredate</dt><dd class="departure-date" ng-bind-html="(segment.pickupDateTime | segmentDayLongTwoLines) || &apos;-&apos;"></dd><dt class="sr-only detailDataImportant"></dt><dd>{{segment.pickupLocation.cityName}}</dd><dt class="sr-only map-link"></dt><dd><map-link location="segment.pickupLocation"></map-link></dd><dt class="sr-only phone-number"></dt><dd><a href="tel:{{segment.pickupPhone}}" ng-if="segment.pickupPhone" stop-propagation><i class="icon-iphone"></i> {{segment.pickupPhone}}</a></dd></dl></div></section><section class="arrival"><header><h1 ng-bind-html="&apos;itmngt.label.dropoff&apos; | translate"></h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.dropofftime</dt><dd class="arrival-time">{{segment.dropoffDateTime|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.dropoffDateTime.hasTime}">itmngt.label.arrivaldate</dt><dd class="arrival-date" ng-bind-html="(segment.dropoffDateTime | segmentDayLongTwoLines) || &apos;-&apos;"></dd><dt class="sr-only detailDataImportant"></dt><dd>{{segment.dropoffLocation.cityName}}</dd><dt class="sr-only map-link"></dt><dd><map-link location="segment.dropoffLocation"></map-link></dd><dt class="sr-only phone-number"></dt><dd><a href="tel:{{segment.dropoffPhone}}" ng-if="segment.dropoffPhone" stop-propagation><i class="icon-iphone"></i> {{segment.dropoffPhone}}</a></dd></dl></div></section></div></section><ng-include src="&apos;itmngt/templates/partial/GenericCardFooterPartial.html&apos;"></ng-include></section>'),e.put("itmngt/templates/partial/CRUISESegmentPartial.html",'<ng-include debug-file-path="CRUISESegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrMoveSegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/EXCURSIONSegmentPartial.html",'<ng-include debug-file-path="EXCURSIONSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrStaySegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/ExploreSegmentPartial.html",'<segment-button-panel class="alwaysClickable" debug-file-path="ExploreSegmentPartial.html" displayable-segments="displayableSegments" feature-status="exploreFeatureStatus" ng-show="{{ exploreFeatureStatus.isExploreEnabled || exploreFeatureStatus.isTripAdvisorEnabled || exploreFeatureStatus.isTakeMeThereEnabled || exploreFeatureStatus.isTaxiDriverEnabled}}" segment-index="segment.index" segment-or-service="_segmentOrService" trip="trip"></segment-button-panel>'),e.put("itmngt/templates/partial/FolderSharePartial.html",'<ion-modal-view debug-file-path="FolderSharePartial.html"><ion-header-bar class="bar-stable"><h1 class="title" translate>itmngt.share.title.chooseTripToShare</h1><span class="button button-clear icon {{::closeicon}}" ng-click="cancelShare()"></span></ion-header-bar><ion-content class="spaced-layout"><div class="share-folder-selection-popover"><p translate>itmngt.share.text.selectTripToShare</p><div class="share-folder-selection" ng-class="{&apos;share-folder-selection-selected&apos;: pnr === selectedPnr}" ng-click="selectPnr(pnr)" ng-repeat="pnr in groupedPnrs"><ul><li class="share-folder-trip-title">{{&apos;itmngt.share.label.trip&apos; | translate}} {{$index+1}}:</li><li ng-repeat="segmentOrService in pnr.segmentsAndServices">- {{&apos;itmngt.share.label.type&apos; + segmentOrService.type | translate}} {{segmentOrService.title}}</li></ul></div><button class="btn-fullwidth" name="folder_share_partial_submit" ng-click="confirmPnr()" ng-disabled="disableConfirm" translate type="submit">itmngt.share.button.confirm</button></div></ion-content></ion-modal-view>'),e.put("itmngt/templates/partial/GenericCardFooterPartial.html",'<ng-include debug-file-path="GenericCardFooterPartial.html" src="&apos;itmngt/templates/partial/ExploreSegmentPartial.html&apos;"></ng-include><air-help-link air-help-data="segment.airHelpData" ng-if="segment.airHelpData" segment="segment" trip-id="trip.tripId"></air-help-link><segment-weather class="alwaysClickable" first-name="trip.bookingFirstName" force-refresh="hasRefreshedFromServer" last-name="trip.bookingLastName" location="segment.weatherData.location" ng-if="segment.weatherData.displayWidget" trip-id="trip.tripId"></segment-weather>'),e.put("itmngt/templates/partial/GenericEtrMoveSegmentPartial.html",'<section class="expanded trip-panel" debug-file-path="GenericEtrMoveSegmentPartial.html" id="segment_{{segment.index}}"><header><h1 class="trip-destination trip-etr_{{segment.type.toUpperCase()}}"><cmt-menu class="segment-menu-button" context="segment" list="segmentMenuList"></cmt-menu><span ng-bind-html="segment.title | trustAsHtml"></span></h1></header><section class="trip-details" ng-click="goToSegmentExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName, segmentRefId: segment.refId})"><header class="cmtsegment etr_{{segment.type.toUpperCase()}}"><dl><dt translate>itmngt.label.confirmation</dt><dd>{{segment.confirmationNumber || &apos;-&apos;}}</dd><dt class="sr-only vendor-logo vendor-name"></dt><dd class="company-name" ng-bind-html="segment.marketingCarrierLogo || &apos;-&apos;"></dd></dl></header><div class="main"><section class="departure"><header><h1 translate>itmngt.label.departure</h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.departuretime</dt><dd class="departure-time">{{segment.startDate|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.startDate.hasTime}">itmngt.label.departuredate</dt><dd class="departure-date" ng-bind-html="(segment.startDate | segmentDayLongTwoLines) || &apos;-&apos;"></dd><div class="clear"></div><dt class="sr-only map-link"></dt><dd><map-link location="segment.fromLocation"></map-link></dd></dl></div></section><section class="arrival"><header><h1 translate>itmngt.label.arrival</h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.arrivaltime</dt><dd class="arrival-time">{{segment.endDate|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.endDate.hasTime}">itmngt.label.arrivaldate</dt><dd class="arrival-date" ng-bind-html="(segment.endDate | segmentDayLongTwoLines) || &apos;-&apos;"></dd><div class="clear"></div><dt class="sr-only map-link"></dt><dd><map-link location="segment.toLocation"></map-link></dd></dl></div></section></div></section><ng-include src="&apos;itmngt/templates/partial/GenericCardFooterPartial.html&apos;"></ng-include></section>'),e.put("itmngt/templates/partial/GenericEtrStaySegmentPartial.html",'<section class="expanded trip-panel" debug-file-path="GenericEtrStaySegmentPartial.html" id="segment_{{segment.index}}"><header><h1 class="trip-destination trip-etr_{{segment.type.toUpperCase()}}"><cmt-menu class="segment-menu-button" context="segment" list="segmentMenuList"></cmt-menu>{{segment.title || &apos;-&apos;}}</h1></header><section class="trip-details" ng-click="goToSegmentExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName, segmentRefId: segment.refId})"><header class="cmtsegment etr_{{segment.type.toUpperCase()}}"><dl><dt translate>itmngt.label.confirmation</dt><dd>{{segment.confirmationNumber || &apos;-&apos;}}</dd><dt class="sr-only vendor-logo vendor-name"></dt><dd class="company-name" ng-bind-html="segment.marketingCarrierLogo || &apos;-&apos;"></dd><dt class="sr-only map-link"></dt><dd><map-link location="segment.location"></map-link></dd></dl></header><div class="main"><section class="departure"><header><h1 translate>itmngt.label.start</h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.departuretime</dt><dd class="departure-time">{{segment.startDate|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.startDate.hasTime}">itmngt.label.departuredate</dt><dd class="departure-date" ng-bind-html="(segment.startDate | segmentDayLongTwoLines) || &apos;-&apos;"></dd></dl></div></section><section class="arrival"><header><h1 translate>itmngt.label.end</h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.arrivaltime</dt><dd class="arrival-time">{{segment.endDate|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.endDate.hasTime}">itmngt.label.arrivaldate</dt><dd class="arrival-date" ng-bind-html="(segment.endDate | segmentDayLongTwoLines) || &apos;-&apos;"></dd></dl></div></section></div></section><ng-include src="&apos;itmngt/templates/partial/GenericCardFooterPartial.html&apos;"></ng-include></section>'),e.put("itmngt/templates/partial/HOTELSegmentPartial.html",'<section class="expanded trip-panel" debug-file-path="HOTELSegmentPartial.html" id="segment_{{segment.index}}"><header><h1 class="trip-destination trip-hotel"><cmt-menu class="segment-menu-button" context="segment" list="segmentMenuList"></cmt-menu>{{segment.name || segment.title || &apos;-&apos;}}</h1></header><section class="trip-details" ng-click="goToSegmentExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName, segmentRefId: segment.refId})"><header class="cmtsegment hotel"><dl><dt translate class="sr-only detailDataImportant">itmngt.label.city</dt><dd class="one-line">{{segment.location.cityName || &apos;-&apos;}}</dd><dt translate>itmngt.label.confirmation</dt><dd>{{segment.reservationNumber || &apos;-&apos;}}</dd><dt class="sr-only map-link"></dt><dd><map-link address-name="segment.name" location="segment.location"></map-link></dd><dt class="sr-only phone-number"></dt><dd><a href="tel:{{segment.phone}}" ng-if="segment.phone" stop-propagation><i class="icon-iphone"></i> {{segment.phone}}</a></dd></dl></header><div class="main"><section class="hotel-segment"><div class="cmt-row"><dl><dt translate>itmngt.label.hotelCheckIn</dt><dd class="date">{{segment.checkin|dayOfWeek}}</dd><dd class="date" ng-bind-html="segment.checkin | dayAndMonth | nonBreaking"></dd></dl><dl class="duration"><dt translate class="sr-only">itmngt.label.hotelDuration</dt><dd><span>{{segment.numberOfNights}} </span>{{&apos;itmngt.label.night&apos;|translate:&quot;{numberOfNight:&quot;+segment.numberOfNights+&quot;}&quot;:&quot;messageformat&quot;}}</dd></dl><dl><dt translate>itmngt.label.hotelCheckOut</dt><dd class="date">{{segment.checkout|dayOfWeek}}</dd><dd class="date" ng-bind-html="segment.checkout | dayAndMonth | nonBreaking"></dd></dl></div></section></div></section><ng-include src="&apos;itmngt/templates/partial/GenericCardFooterPartial.html&apos;"></ng-include></section>'),e.put("itmngt/templates/partial/INSURANCESegmentPartial.html",'<ng-include debug-file-path="INSURANCESegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrStaySegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/LAYOVERSegmentPartial.html",'<section class="layover" debug-file-path="LAYOVERSegmentPartial.html" id="layover_{{segment.index}}"><div class="nodes-line"><div class="iconHolder"><span class="clock"></span></div></div><div class="layover-card"><div class="container"><div class="cmt-row"><dl><dt class="layover-detail" translate>itmngt.label.layover</dt><dd class="layover-period">{{segment.duration.hours}}h {{segment.duration.minutes}}m</dd><dd class="fs-layover-period"></dd></dl></div></div></div></section>'),e.put("itmngt/templates/partial/MEETINGSegmentPartial.html",'<ng-include debug-file-path="MEETINGSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrStaySegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/MOVEMISCSegmentPartial.html",'<ng-include debug-file-path="MOVEMISCSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrMoveSegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/PARKINGSegmentPartial.html",'<ng-include debug-file-path="PARKINGSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrStaySegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/PRODUCTSERVICESegmentPartial.html",""),e.put("itmngt/templates/partial/RECOACTIVITYSegmentPartial.html",'<script debug-file-path="RECOACTIVITYSegmentPartial.html" id="RecoActivityCommon.html" type="text/ng-template"><!--<p class="reco-text" ng-if="segment.startLocation.name || segment.startLocation.cityName">{{\'itmngt.label.from\' | translate}} {{segment.startLocation.name || segment.startLocation.cityName}}</p>-->\n  <p class="reco-text" ng-if="segment.endLocation.name || segment.endLocation.cityName">{{\'itmngt.label.to\' | translate}} {{segment.endLocation.name || segment.endLocation.cityName}}</p>\n  <p class="reco-text text-ellipsis" ng-if="segment._activityAvailability" >\n    {{segment._activityAvailability.title}}\n  </p>\n\n  <button ng-if="!segment._activityAvailability" type="button" class="btn-small book-now" translate>itmngt.label.bookNow</button>\n  <button ng-if="segment._activityAvailability" type="button" class="btn-small book-now"\n          translate="itmngt.label.bookFor"\n          translate-values="{price: \'{{segment._activityAvailability.price | price}}\'}">\n  </button>\n\n  <p class="reco-chevron">\n    <i class="icon-chevron-right-rounded" ></i>\n  </p></script><section class="layover reco-panel-layover" id="activity_reco_{{segment.index}}" ng-if="segment.inLayover"><div class="nodes-line"><div class="iconHolder"><span class="activity" ng-class="{&apos;icons-position-for-ie&apos;: isIE}"></span></div></div><section class="activity-reco alwaysClickable reco-layover" data-tap-disabled="{{!(isIE || isEdge)}}" ng-click="activityRecoClick(trip, segment)" ng-style="getActivityStyledBackground(segment)"><p class="reco-text">{{&apos;itmngt.label.missingActivity&apos; | translate}}</p><ng-include src="&apos;RecoActivityCommon.html&apos;"></ng-include></section></section><section class="expanded reco-panel trip-panel" id="activity_reco_{{segment.index}}" ng-if="!segment.inLayover"><header><h1 class="trip-destination trip-etr_ACTIVITY">{{&apos;itmngt.label.missingActivity&apos; | translate}}</h1></header><section class="activity-reco alwaysClickable trip-details" data-tap-disabled="{{!(isIE || isEdge)}}" ng-click="activityRecoClick(trip, segment)" ng-style="getActivityStyledBackground(segment)"><ng-include src="&apos;RecoActivityCommon.html&apos;"></ng-include></section></section>'),e.put("itmngt/templates/partial/RECOHOTELSegmentPartial.html",'<section class="expanded reco-panel trip-panel" debug-file-path="RECOHOTELSegmentPartial.html" id="segment_{{segment.index}}" ng-if="hotelRecoEnabled"><header><h1 class="trip-destination trip-hotel" translate>itmngt.label.hotelAccommodation</h1></header><section class="hotel-reco trip-details" ng-click="hotelRecoClick(trip, segment)"><button class="book-now btn-small" name="reco_hotels_segment_partial_button" translate type="button">itmngt.label.bookNow</button><p class="reco-chevron"><i class="icon-chevron-right-rounded"></i></p></section></section>'),e.put("itmngt/templates/partial/RECOLOUNGESegmentPartial.html",'<script debug-file-path="RECOLOUNGESegmentPartial.html" id="RecoLoungeCommon.html" type="text/ng-template"><p class="reco-text" ng-class="{\'overflow-ellipsis\': segment.inLayover}">\n    {{\'itmngt.label.in\' | translate}} {{segment.location.name}} ({{segment.location.code}})\n  </p>\n\n  <button type="button" name="reco_lounges_segment_partial_button" class="btn-small book-now" translate>itmngt.label.bookNow</button>\n\n  <p class="reco-chevron">\n    <i class="icon-chevron-right-rounded"></i>\n  </p></script><section class="layover reco-panel-layover" id="lounge_reco_{{segment.index}}" ng-if="segment.inLayover"><div class="nodes-line"><div class="iconHolder"><span class="lounge" ng-class="{&apos;icons-position-for-ie&apos;: isIE}"></span></div></div><section class="lounge-reco lounge-reco-width reco-layover" ng-click="loungeRecoClick(trip)"><p class="reco-text">{{&apos;itmngt.label.needLounge&apos; | translate}}</p><ng-include src="&apos;RecoLoungeCommon.html&apos;"></ng-include></section></section><section class="expanded reco-panel trip-panel" id="lounge_reco_{{segment.index}}" ng-if="!segment.inLayover"><header><h1 class="trip-destination trip-etr_LOUNGE">{{&apos;itmngt.label.needLounge&apos; | translate}}</h1></header><section class="lounge-reco trip-details" ng-click="loungeRecoClick(trip)"><ng-include src="&apos;RecoLoungeCommon.html&apos;"></ng-include></section></section>'),e.put("itmngt/templates/partial/RECOPARKINGSegmentPartial.html",'<script debug-file-path="RECOPARKINGSegmentPartial.html" id="RecoParkingCommon.html" type="text/ng-template"><p class="reco-text" ng-class="{\'overflow-ellipsis\': segment.inLayover}">\n    {{\'itmngt.label.in\' | translate}} {{segment.location.name}} ({{segment.location.code}})\n  </p>\n\n  <button type="button" name="reco_parking_segment_partial_button" class="btn-small book-now" translate>itmngt.label.bookNow</button>\n\n  <p class="reco-chevron">\n    <i class="icon-chevron-right-rounded"></i>\n  </p></script><section class="layover reco-panel-layover" id="parking_reco_{{segment.index}}" ng-if="segment.inLayover"><div class="nodes-line"><div class="iconHolder"><span class="parking" ng-class="{&apos;icons-position-for-ie&apos;: isIE}"></span></div></div><section class="parking-reco parking-reco-width reco-layover" ng-click="parkingRecoClick(trip)"><p class="reco-text">{{&apos;itmngt.label.needParkingStandard&apos; | translate}}</p><ng-include src="&apos;RecoParkingCommon.html&apos;"></ng-include></section></section><section class="expanded reco-panel trip-panel" id="parking_reco_{{segment.index}}" ng-if="!segment.inLayover"><header><h1 class="trip-destination trip-etr_PARKING">{{&apos;itmngt.label.needParkingStandard&apos; | translate}}</h1></header><section class="parking-reco trip-details" ng-click="parkingRecoClick(trip)"><ng-include src="&apos;RecoParkingCommon.html&apos;"></ng-include></section></section>'),e.put("itmngt/templates/partial/RECOSegmentPartial.html",'<script debug-file-path="RECOSegmentPartial.html" id="RecoTaxiCommon.html" type="text/ng-template"><!--<p class="reco-text" ng-if="segment.startLocation.name || segment.startLocation.cityName">{{\'itmngt.label.from\' | translate}} {{segment.startLocation.name || segment.startLocation.cityName}}</p>-->\n  <p class="reco-text" ng-if="segment.endLocation.name || segment.endLocation.cityName">{{\'itmngt.label.to\' | translate}} {{segment.endLocation.name || segment.endLocation.cityName}}</p>\n  <p class="reco-text" ng-if="segment._taxiAvailability" >{{\'itmngt.label.passenger\' | translate:"{numberOfPax:"+segment._taxiAvailability.nip+"}":"messageformat"}}</p>\n\n  <button ng-if="!segment._taxiAvailability" name="reco_segment_partial_!_button" type="button" class="btn-small book-now" translate>itmngt.label.bookNow</button>\n  <button ng-if="segment._taxiAvailability" name="reco_segment_partial_button" type="button" class="btn-small book-now" >\n    {{\'itmngt.label.from\' | translate}} {{segment._taxiAvailability.price | price}}\n  </button>\n\n  <p class="reco-chevron">\n    <i class="icon-chevron-right-rounded" ></i>\n  </p></script><section class="layover reco-panel-layover" id="taxi_reco_{{segment.index}}" ng-if="segment.inLayover"><div class="nodes-line"><div class="clockHolder"><span class="taxi"></span></div></div><section class="taxi-reco taxi-reco-layover" data-tap-disabled="true" ng-click="taxiRecoClick(trip, segment)"><p class="reco-text">{{(segment._taxiAvailability ? &apos;itmngt.label.bookTransfer&apos; : &apos;itmngt.label.missingTransfer&apos;) | translate}}</p><ng-include src="&apos;RecoTaxiCommon.html&apos;"></ng-include></section></section><section class="expanded reco-panel trip-panel" id="taxi_reco_{{segment.index}}" ng-if="!segment.inLayover"><header><h1 class="trip-destination trip-etr_TAXI">{{(segment._taxiAvailability ? &apos;itmngt.label.bookTransfer&apos; : &apos;itmngt.label.missingTransfer&apos;) | translate}}</h1></header><section class="taxi-reco trip-details" data-tap-disabled="true" ng-click="taxiRecoClick(trip, segment)"><ng-include src="&apos;RecoTaxiCommon.html&apos;"></ng-include></section></section>'),e.put("itmngt/templates/partial/RECOTAXISegmentPartial.html",'<script debug-file-path="RECOTAXISegmentPartial.html" id="RecoTaxiCommon.html" type="text/ng-template"><!--<p class="reco-text" ng-if="segment.startLocation.name || segment.startLocation.cityName">{{\'itmngt.label.from\' | translate}} {{segment.startLocation.name || segment.startLocation.cityName}}</p>-->\n  <p class="reco-text" ng-if="segment.endLocation.name || segment.endLocation.cityName">{{\'itmngt.label.to\' | translate}} {{segment.endLocation.name || segment.endLocation.cityName}}</p>\n  <p class="reco-text" ng-if="segment._taxiAvailability" >{{\'itmngt.label.passenger\' | translate:"{numberOfPax:"+segment._taxiAvailability.nip+"}":"messageformat"}}</p>\n\n  <button ng-if="!segment._taxiAvailability" name="reco_taxi_segment_partial_!_button" type="button" class="btn-small book-now" translate>itmngt.label.bookNow</button>\n  <button ng-if="segment._taxiAvailability" name="reco_taxi_segment_partial_button" type="button" class="btn-small book-now" >\n    {{\'itmngt.label.from\' | translate}} {{segment._taxiAvailability.price | price}}\n  </button>\n\n  <p class="reco-chevron">\n    <i class="icon-chevron-right-rounded" ></i>\n  </p></script><section class="layover reco-panel-layover" id="taxi_reco_{{segment.index}}" ng-if="segment.inLayover"><div class="nodes-line"><div class="iconHolder"><span class="taxi" ng-class="{&apos;icons-position-for-ie&apos;: isIE}"></span></div></div><section class="taxi-reco reco-layover" ng-click="taxiRecoClick(trip, segment)"><p class="reco-text">{{(segment._taxiAvailability ? &apos;itmngt.label.bookTransfer&apos; : &apos;itmngt.label.missingTransfer&apos;) | translate}}</p><ng-include src="&apos;RecoTaxiCommon.html&apos;"></ng-include></section></section><section class="expanded reco-panel trip-panel" id="taxi_reco_{{segment.index}}" ng-if="!segment.inLayover"><header><h1 class="trip-destination trip-etr_TAXI">{{(segment._taxiAvailability ? &apos;itmngt.label.bookTransfer&apos; : &apos;itmngt.label.missingTransfer&apos;) | translate}}</h1></header><section class="taxi-reco trip-details" ng-click="taxiRecoClick(trip, segment)"><ng-include src="&apos;RecoTaxiCommon.html&apos;"></ng-include></section></section>'),e.put("itmngt/templates/partial/SERVICEMISCSegmentPartial.html",'<ng-include debug-file-path="SERVICEMISCSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrStaySegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/SHOWANDEVENTSegmentPartial.html",'<ng-include debug-file-path="SHOWANDEVENTSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrStaySegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/SLEEPMISCSegmentPartial.html",'<ng-include debug-file-path="SLEEPMISCSegmentPartial.html" src="&apos;itmngt/templates/partial/HOTELSegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/SegmentDetailsPartial.html",'<div debug-file-path="SegmentDetailsPartial.html" ng-controller="SegmentExpandedPartialController"><section class="passenger-details"><segment-information-list bloc-title="{{information.title}}" key-val-information="information.data" ng-repeat="information in segmentInformation"></segment-information-list><div class="free-text-card"><free-text-with-title bloc-title="{{segmentDescription.title}}" class="passenger-details-card" default-text="-" ng-if="segmentDescription" text="{{segmentDescription.text}}"></free-text-with-title><div class="remark-group" ng-repeat="remarkGroup in segment.remarkGroups" enabled-if="&apos;remarks&apos;"><div class="remark" ng-repeat="remark in remarkGroup.remarks">{{remark.content}}</div></div></div></section><vendor-contact-card ng-if="vendorContactCard" vendor-email="vendorContactCard.email" vendor-logo="vendorContactCard.logo" vendor-name="vendorContactCard.name" vendor-phone="vendorContactCard.phone"></vendor-contact-card><vendor-contact-card ng-if="isTAContactDetailsEnabled" vendor-email="agencyContactCard.email" vendor-logo="agencyContactCard.logo" vendor-name="agencyContactCard.name" vendor-phone="agencyContactCard.phone"></vendor-contact-card></div>'),e.put("itmngt/templates/partial/SelectCalendarModal.html",'<ion-modal-view debug-file-path="SelectCalendarModal.html"><ion-header-bar class="bar-stable"><h1 class="title" translate>itmngt.addToCalendar.title.selectACalendar</h1><span class="button button-clear icon {{::closeicon}}" ng-click="cancelModal()"></span></ion-header-bar><ion-content><ul class="list"><li class="item" ng-click="chooseCalendar(calendar)" ng-repeat="calendar in calendars">{{calendar.name}}</li></ul></ion-content></ion-modal-view>'),e.put("itmngt/templates/partial/ShareSegmentPartial.html","{{ segment.title }} {{ segment.from}} {{ segment.to}}"),e.put("itmngt/templates/partial/ShareViaEmailPartial.html","{{ &apos;itmngt.share.text.emailBody&apos; | translate:trip }} {{url}}"),e.put("itmngt/templates/partial/TAXISegmentPartial.html",'<ng-include debug-file-path="TAXISegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrMoveSegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/TRAINSegmentPartial.html",'<section class="expanded trip-panel" debug-file-path="TRAINSegmentPartial.html" id="segment_{{segment.index}}"><header><h1 class="trip-destination trip-train"><cmt-menu class="segment-menu-button" context="segment" list="segmentMenuList"></cmt-menu>{{segment.title || &apos;-&apos;}}</h1></header><section class="trip-details" ng-click="goToSegmentExpanded({tripId: trip.tripId, lastName: trip.bookingLastName, firstName: trip.bookingFirstName, segmentRefId: segment.refId})"><header class="cmtsegment train"><dl><dt translate>itmngt.label.confirmation</dt><dd>{{segment.confirmationNumber || &apos;-&apos;}}</dd><dt class="sr-only semi-spaced-element vendor-logo vendor-name" translate ng-if-start="segment.company.name">itmngt.label.vendor</dt><dd ng-if-end>{{segment.company.name}}</dd></dl></header><div class="main"><section class="departure"><header><h1 translate>itmngt.label.departure</h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.departuretime</dt><dd class="departure-time">{{segment.startDate|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.startDate.hasTime}">itmngt.label.departuredate</dt><dd class="departure-date" ng-bind-html="(segment.startDate | segmentDayLongTwoLines) || &apos;-&apos;"></dd><div class="clear"></div><dt class="sr-only map-link"></dt><dd><map-link label="{{segment.fromLocation.name}}" location="segment.fromLocation"></map-link></dd></dl></div></section><section class="arrival"><header><h1 translate>itmngt.label.arrival</h1></header><div class="cmt-row"><dl><dt class="sr-only time" translate>itmngt.label.arrivaltime</dt><dd class="arrival-time">{{segment.endDate|time24h}}</dd><dt class="sr-only date" translate ng-class="{&apos;date-without-time&apos;: !segment.endDate.hasTime}">itmngt.label.arrivaldate</dt><dd class="arrival-date" ng-bind-html="(segment.endDate | segmentDayLongTwoLines) || &apos;-&apos;"></dd><div class="clear"></div><dt class="sr-only map-link"></dt><dd><map-link label="{{segment.toLocation.name}}" location="segment.toLocation"></map-link></dd></dl></div></section></div></section><ng-include src="&apos;itmngt/templates/partial/GenericCardFooterPartial.html&apos;"></ng-include></section>'),e.put("itmngt/templates/partial/TRANSFERSegmentPartial.html",'<ng-include debug-file-path="TRANSFERSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrMoveSegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/URBANSegmentPartial.html",'<ng-include debug-file-path="URBANSegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrMoveSegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/UngroupTripModal.html",'<ion-modal-view debug-file-path="UngroupTripModal.html"><ion-header-bar class="bar-stable"><span class="button button-clear icon icon-information trip-ungroup-info-icon" ng-click="alertUngroup()"></span><h1 class="title" style="text-align: center">{{trip.title}}</h1><span class="button button-clear icon {{::closeicon}}" ng-click="cancelUngroup()"></span></ion-header-bar><ion-content class="spaced-layout"><div class="main"><section class="contained-pad"><section><p style="margin-bottom: 1em" translate>itmngt.text.ungroupTripStartMessage</p></section><div class="cmt-row" id="trip-ungroup"><div ng-repeat="trip in tripUngrouped track by $index"><section class="expanded trip-panel"><header><h1 class="trip-ungroup-header">{{&apos;itmngt.label.trip&apos; | translate}} {{$index + 1}}</h1><span class="dates" ng-bind-html="(trip | tripUngroupDate) || &apos;-&apos;"></span></header><div ng-repeat="segment in trip" ng-init="_segmentCss = SegmentService.getSegmentIconClass(segment.type)"><p class="trip-destination {{_segmentCss}}">{{segment.title}}</p></div></section></div><button class="btn-fullwidth" name="ungroup_trip_modal_button" ng-click="ungroupTrip()" translate>itmngt.button.ungroup</button></div></section></div></ion-content></ion-modal-view>'),e.put("itmngt/templates/partial/VISASegmentPartial.html",'<ng-include debug-file-path="VISASegmentPartial.html" src="&apos;itmngt/templates/partial/GenericEtrStaySegmentPartial.html&apos;"></ng-include>'),e.put("itmngt/templates/partial/timelineAdBannerCardPartial.html",'<section class="timeline-module timelineAdBanner" debug-file-path="timelineAdBannerCardPartial.html" ng-class="{&apos;timelineAdBanner-displayed&apos;: advertisementBanner.hasAdvertisement}"><div class="nodes-line"><div class="dateHolder"><span class="date"><span>Ad</span></span></div></div><div class="timeline-card" ng-style="advertisementBanner.cardStyle"><div class="container" ng-show="advertisementBanner.isImage" ng-click="onAdBannerImageClick()"><img class="timelineAdBannerFillImage" ng-src="{{advertisementBanner.advertisementSrc}}"></div><div class="container" ng-show="advertisementBanner.isJavascript" id="{{advertisementBanner.scriptContainerId}}"></div></div></section>')}]);var moduleDependencies=["ionic","CoreModule","AccountModule","satellizer"];getContext("isMobileApp",!1)&&moduleDependencies.push("AccountCordovaModule"),window.socialModule=angular.module("SocialModule",moduleDependencies),window.socialModule.run(["$log","SocialService","$injector",function(e,t,n){if(e=e.getInstance("Social"),e.info("Module started"),getContext("isMobileApp",!1)){if(getContext("featureConfig.facebook.enabled",!1)){
var i=n.get("FacebookConnectorService");t.registerConnector(i,i.ID)}if(getContext("featureConfig.google.enabled",!1)){var a=n.get("GoogleplusConnectorService");t.registerConnector(a,a.ID)}}}]),window.socialModule.config(["$translatePartialLoaderProvider","$authProvider",function(e,t){e.addPart("social"),getContext("featureConfig.facebook.enabled",!1)&&t.facebook({clientId:getContext("featureConfig.facebook.appID",function(){throw new Error("Can't activate Facebook login without AppID")})}),getContext("featureConfig.google.enabled",!1)&&t.google({clientId:getContext("featureConfig.google.appID",function(){throw new Error("Can't activate Google login without AppID")})})}]),window.socialModule.routes={social:{url:"/socialLogin",templateUrl:"social/templates/pages/SocialActionView.html",controller:"SocialButtonsController"}},socialModule.service("SocialService",["RequestService","$log","$q","$auth","AuthenticationService","I18nConfig","$rootScope","I18nService","StringService",function(e,t,n,i,a,r,o,s,l){t=t.getInstance("SocialService"),t.info("Service Started...");var c={},d={LOGIN_WITH_SOCIAL_URL_PATH:"v1/account/loginWithSocial",TOKEN_BELONGS_TO_ANOTHER_APPID:"777804",_hasNativePlugin:function(e){return e=isDefined(e)?e.toLowerCase():"",isDefined(c[e])&&c[e].isNative()},registerConnector:function(e,t){c[t.toLowerCase()]=e},login:function(e,r){this._currentProvider=e;var o,s=n.defer();return o=this._hasNativePlugin(e)?c[e.toLowerCase()].login(r):i.authenticate(e),o.then(function(t){d._socialLoginSuccessCallback(t,e,s)},function(n){t.error("Failed to login: ",n),n.errorMessage!==a.ERR_NO_INTERNET_CONNECTIVITY&&d.logout({provider:e,doOnServerSide:!0,doOnSocialSide:!1}),s.reject(n)}),s.promise},_socialLoginSuccessCallback:function(n,i,o){t.debug(n),t.profile("sociallogin");var c=a.augmentLoginLogoutPayloadWithDeviceInfo({email:n.email,network:{type:l.capitalizedFirst((i||"").toLowerCase()),token:n.accessToken},preferredLanguage:r.getCurrentAmadeusLanguage()}),u=e.post(d.LOGIN_WITH_SOCIAL_URL_PATH,c);u.then(function(e){t.profile("sociallogin");var r=safeAccess(e,"data.errorCodes",[]);r.indexOf(d.TOKEN_BELONGS_TO_ANOTHER_APPID)>-1?(t.backendError(e),s.translateBackendErrorCodes(r).then(function(e){d.logout({provider:i,doOnServerSide:!1,doOnSocialSide:!0}).then(function(){o.reject(e)})})):(c.password=n.accessToken,a.loginSuccessCallback(e,c,o).then(null,function(){d.logout({provider:i,doOnServerSide:!1,doOnSocialSide:!0})}))},function(e){t.profile("sociallogin"),a.loginFailureCallback(e,c,o)}),d.registerEvents()},logout:function(e){var r=n.defer();return e.doOnSocialSide?this._hasNativePlugin(e.provider)?c[e.provider.toLowerCase()].logout().then(function(){t.log("Log out success"),r.resolve()},function(e){t.error("Failed to log out user: ",e),r.reject(e)})["finally"](function(){a.logout({doMiddlewareCall:e.doOnServerSide})}):i.logout().then(function(){r.resolve()})["catch"](function(e){t.error(e),r.reject(e)})["finally"](function(){a.logout({doMiddlewareCall:e.doOnServerSide})}):a.logout({doMiddlewareCall:e.doOnServerSide}),d.userLogOutEventDeregistrationHandler&&(d.userLogOutEventDeregistrationHandler(),delete d.userLogOutEventDeregistrationHandler),r.promise},share:function(){},registerEvents:function(){d.userLogOutEventDeregistrationHandler&&(t.warn("userLogOutEventDeregistrationHandler is still alive !!!"),d.userLogOutEventDeregistrationHandler()),d.userLogOutEventDeregistrationHandler=o.$on("userLogOutEvent",function(){d.logout({provider:d._currentProvider,doOnServerSide:!0,doOnSocialSide:!0})})},toString:function(){return"SocialService"}};return isDefined(a.getUserAuthMethod())&&a.getUserAuthMethod()!==a.EMAIL_METHOD&&d.registerEvents(),d}]),socialModule.controller("SocialButtonsController",["$scope","SocialService","$log","LayoutService","AuthenticationService","OrchestratorChiefService","$ionicModal","NetworkService","$q",function(e,t,n,i,a,r,o,s,l){function c(){var t=l.defer(),n=s.hasConnectivity(!0);return e.isOnline=n.isOnline,e.isOnline?o.fromTemplateUrl("account/templates/partial/termsAndConditions.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.termsAndConditionsModal=n,e.termsAndConditionsSuccess=function(){i.removeModal(e.termsAndConditionsModal).then(function(){t.resolve()})},e.termsAndConditionsFailure=function(){i.removeModal(e.termsAndConditionsModal).then(function(){t.reject({errorMessage:g})})},i.showModal(e.termsAndConditionsModal)}):n.then(function(){t.reject({errorMessage:u})}),t.promise}function d(e){c().then(function(){return i.loading(!0,"social.login.message.canBeLong",3e4),t.login(e).then(function(){i.loading(!1),r.next({islogged:!0})})})["catch"](function(t){i.loading(!1);var n=[g,u,p,f];if(-1===n.indexOf(t.errorMessage)){var r;t.errorMessage!==a.ERR_NO_INTERNET_CONNECTIVITY&&t.errorMessage!==m||(r="core.httpErrorCodes.0"),v(e,r)}})}n=n.getInstance("SocialButtonsController"),n.info("Controller Started..."),e.enableFacebook=getContext("featureConfig.facebook.enabled",!1),e.enableGoogle=getContext("featureConfig.google.enabled",!1);var u=0,g=1,p="User cancelled dialog",m="Facebook error: CONNECTION_FAILURE: CONNECTION_FAILURE",f=12501;e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView();var v=function(e,t){var n="social.login.error."+e+"Login",a=angular.isString(t)?t:n;i.toastError(a)};e.loginWithFacebook=function(){d("facebook")},e.loginWithGplus=function(){d("google")}}]),socialModule.run(["$templateCache",function(e){e.put("social/templates/pages/SocialActionView.html",'<ion-view debug-file-path="SocialActionView.html"><ion-nav-title translate>social.redirect.title</ion-nav-title><ion-content class="spaced-layout splash"><ng-include src="&apos;social/templates/partial/SocialButtons.html&apos;"></ng-include></ion-content></ion-view>'),e.put("social/templates/partial/SocialButtons.html",'<div debug-file-path="SocialButtons.html" ng-controller="SocialButtonsController"><button class="btn-fullwidth btn-facebook" ng-click="loginWithFacebook()" ng-if="enableFacebook" translate type="button">social.login.button.facebook</button> <button class="btn-fullwidth btn-google" ng-click="loginWithGplus()" ng-if="enableGoogle" translate type="button">social.login.button.google</button></div>')}]),window.authModule=angular.module("AuthModule",["CoreModule","AccountModule","SocialModule"]),window.authModule.config(function(){}),authModule.service("AuthenticationRequestInterceptor",["RequestUtil","$injector",function(e,t){var n={_accessToken:null,setUserAccessToken:function(e){isDefined(e)&&(n._accessToken=e)},_getUserAccessToken:function(){var e=t.get("AuthenticationService");return e.getUserAccessToken()},request:function(t){var i=t.url;if(e.isRequestManagedExtension(i)&&e.isRequestUrlMatch(i,getContext("applicationConfig.securedUrls",[]))){var a=n._getUserAccessToken();a&&(t.headers=t.headers||{},t.headers.Authorization="Bearer "+a)}return t}};return n}]),authModule.service("AuthenticationResponseInterceptor",["$rootScope","$q","$injector",function(e,t,n){function i(e,t){var n=safeAccess(e,"data.errorCodes",[]);return n.indexOf(t)>-1}function a(e){var i=t.defer();e.cmtIsRequestRetry=!0;var a=n.get("BackgroundLoginService");return a.backgroundLogin().then(function(){r.info("Silent relogin ok, will retry the original request");var t=n.get("$http");t(e).then(function(e){r.info("Retry ok"),i.resolve(e)},function(e){r.info("Retry fail"),i.reject(e)})},function(t){r.info("Silent relogin fail, abandoning the original request");var n=Array.isArray(t)?t:[t],a={config:e,data:{success:!1,errorCodes:["000000"],debugErrorMessages:n},headers:{},status:200,statusText:"OK (faked)"};i.reject(a)}),i.promise}var r=angular.injector(["ng"]).get("$log");getContext("applicationConfig.logLevel",6)>2&&r.info("[AuthenticationResponseInterceptor] Service Started...");var o="800204",s="800202",l="800209",c="800211",d="800212",u={response:function(t){var n=safeAccess(t,"data.success");if(n===!1){if(t.config.cmtIsRequestRetry)return r.info("Request retry failed, giving up!"),t;var u=getContext("isMobileApp",!1);if(i(t,o)&&!u||i(t,s)||i(t,l)||i(t,c)||i(t,d))r.info("[AuthenticationResponseInterceptor] can not authenticate the user, need to log out!"),t.cmtSwallowError=!0,e.$emit("auth:needToLogOutTheUserEvent");else if(i(t,o)&&u){r.info("[AuthenticationResponseInterceptor] user access token expired, will try to relogin and retry the request once");var g=t.config,p=a(g);return p}}return t}};return u}]),authModule.service("BackgroundLoginService",["$log","$q","AuthenticationService","SocialService","LoginWithEmailService","DataManagerService","$injector",function(e,t,n,i,a,r,o){e=e.getInstance("BackgroundLoginService"),e.info("Service Started...");var s="ERR_NO_AUTH_DATA_IN_STORAGE",l={backgroundLogin:function(){var e=t.defer(),a=n.getUserAuthMethod(),o=n.getUser(),c=getContext("featureConfig.smartTrip.enabled",!1)||getContext("featureConfig.cytric.enabled",!1),d=safeAccess(o,"userId");if(isDefined(d)&&isDefined(a))if(a===n.EMAIL_METHOD)n.getUserPassword().then(function(t){return c?void r.getSecureAsync("SMART_TRIP_PIN").then(function(n){return l.loginWithIdAndPassword(n,t,e)},function(){e.reject(s)}):l.loginWithIdAndPassword(d,t,e)},function(){e.reject(s)});else if(a===n.CORPORATE_METHOD){var u=getContext("featureConfig.corporate.identityProvider",""),g=l._getCorporateService();isDefined(g)?g.login(u,!0).then(function(){l.__backgroundLoginSuccess(e)},function(t){l.__backgroundLoginFailure(e,t)}):l.__backgroundLoginFailure(e,"CorporateService not found")}else i.login(a,!0).then(function(){l.__backgroundLoginSuccess(e)},function(t){l.__backgroundLoginFailure(e,t)});else e.reject(s);return e.promise},_getCorporateService:function(){return o.has("CorporateService")?o.get("CorporateService"):void 0},__backgroundLoginSuccess:function(e){e.resolve()},__backgroundLoginFailure:function(t,n){e.error("Fail to silent login: "+n),t.reject(n)},loginWithIdAndPassword:function(e,t,n){return a.login(e,t).then(function(){l.__backgroundLoginSuccess(n)},function(e){l.__backgroundLoginFailure(n,e)}),n.promise},toString:function(){return"BackgroundLoginService"}};return l}]),window.seatMapModule=angular.module("SeatMapModule",["ionic","CoreModule","ItmngtModule","AnalyticsModule"]),window.seatMapModule.run(["$log","SeatMapOrchestratorService","BookableSeatHandler",function(e,t,n){e=e.getInstance("SeatMap"),e.info("Module started"),n.init(),t.noop()}]),window.seatMapModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("seat-map")}]),window.seatMapModule.routes={seatMap:{url:"/seatMap/:tripId/:lastName/:firstName/:refId/:segmentRefId/:scrollToSeat",templateUrl:"seat-map/templates/pages/SeatMapView.html",controller:"SeatMapController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Seatmap").promise()}]},ncyBreadcrumb:{label:"{{'seatMap.title.seatMap'|translate}}",parent:"segment-expanded"}},"seatMap-ext":{url:"/seatMap-ext/:scrollToSeat",templateUrl:"seat-map/templates/pages/SeatMapExtView.html",controller:"SeatMapController"}},seatMapModule.controller("SeatMapController",["$scope","$log","SeatMapService","LayoutService","$q","OrchestratorChiefService","$stateParams","I18nService","$ionicScrollDelegate","$timeout","$ionicPopover","$state","EasterEggService","$rootScope","TripService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m){t=t.getInstance("SeatMapController"),t.info("Controller Started...");var f=5,v=o.tripId,h=o.segmentRefId,S=o.refId,C=o.lastName,T=o.firstName,b=o.scrollToSeat,E={},A=null,y=!1;e.toggleDeckButtonLabel=null,e.seatMap=null,e.currentDeck=null,e.travellers=[],e.selectedSeats=[],e.isPassengerListDisplayed=!1,e.isLoadOk=!1,e.trip=null,e.segment=null,e.allowSeatChange=getContext("featureConfig.seatMap.allowSeatChange",!1),p.$on("updateSeatAssignmentEvent",function(){D(e.travellers)});var L=function(e){if(e){var t=e.split(/([0-9]+)([a-zA-Z]+)/);if(t.length>2){var n=parseInt(t[1],10),i=t[2].toUpperCase();return n+i}}return null},D=function(t){e.selectedSeats=[],t.forEach(function(t){isDefined(t.seat)&&e.selectedSeats.push(L(t.seat))})},_=function(){return s.translate(["seatMap.title.seatCharacteristics","seatMap.label.noInformation","seatMap.text.contactAgencyChangeSeat"]).then(function(e){E=e})};e.refreshSeatMap=function(){var t=a.defer(),n={forceFromServer:!0};return e.getSeatMap(n).then(function(){P(),t.resolve()},function(e){i.toastError(e).then(function(){t.reject(e)})}),t.promise},e.getSeatMap=function(t){var r=a.defer();i.startLoading();var o=e.segment.confirmationNumber?e.segment.confirmationNumber:e.segment.recLocFromRefId,s=m.isFolder(e.trip)?o:v;return n.getSeatMap(e.segment,C,s,t).then(function(t){e.seatMap=n.getWellFormattedDataModel(t),i.stopLoading(),r.resolve()},function(e){i.stopLoading(),r.reject(e)}),r.promise},e.getFrontFacilities=function(e){return w(e,n.FACILITIES_LOCATION_FRONT)},e.getRearFacilities=function(e){return w(e,n.FACILITIES_LOCATION_REAR)};var w=function(e,t){var i=[];return isDefined(e)&&e.filter(function(e){return e.location===t&&["L","C","R"].indexOf(e.position)>-1&&(e.code===n.FACILITIES_LAVATORY||e.code===n.FACILITIES_GALLEY)}).sort(function(e,t){return I(e)-I(t)}).map(function(e){return e.code+"-"+e.position}).filter(function(e,t,n){return n.indexOf(e)===t}).forEach(function(e){var t=e.slice(0,e.indexOf("-"));switch(t){case n.FACILITIES_LAVATORY:i.push("lavatory");break;case n.FACILITIES_GALLEY:i.push("galley")}}),i.length>0?i:!1},I=function(e){var t=0;switch(e.position){case"L":t=1;break;case"LC":t=2;break;case"C":t=3;break;case"RC":t=4;break;case"R":t=5}return t};e.hasLeftExitSeat=function(e){var t=!1;return angular.isArray(e.facilities)&&(t=e.facilities.some(function(e){return e.code===n.FACILITIES_EXIT_DOOR&&e.position===n.FACILITIES_POSITION_LEFT})),t},e.hasRightExitSeat=function(e){var t=!1;return angular.isArray(e.facilities)&&(t=e.facilities.some(function(e){return e.code===n.FACILITIES_EXIT_DOOR&&e.position===n.FACILITIES_POSITION_RIGHT})),t};var M=function(t,i){var a="";return-1===i.indexOf(n.SEAT_CHARACS_UNAVAILABLE)&&i.indexOf(n.SEAT_CHARACS_CHARGEABLE)>-1&&(a="chargeable"),i.indexOf(n.SEAT_CHARACS_UNAVAILABLE)>-1&&(a="unavailable"),isDefined(t)&&e.selectedSeats.indexOf(t)>-1&&(a="assigned"),a};e.getSeatCssClass=function(e,t){var i="";return t=t||[],i=t.indexOf(n.SEAT_CHARACS_NO_SEAT)>-1||t.indexOf(n.SEAT_CHARACS_MISSED_SEAT)>-1||t.indexOf(n.SEAT_CHARACS_OFFICE)>-1?"no-seat":"seat "+M(e,t)},e.getSeatCharacteristicsAsText=function(t){var n=e.seatMap.decodingDictionary.seatCharacteristics,i=[];return t.forEach(function(e){n[e]&&""!==n[e]&&i.push(n[e])}),0===i.length&&i.push(E["seatMap.label.noInformation"]),i},e.generateSeatNumber=function(e,t,n){return e.columns[n]&&""!==e.columns[n]?t+e.columns[n].toUpperCase():""},e.getSeatPrice=function(e,t,i){if(null!=e&&t.columns[i]&&""!==t.columns[i]){var a=e.filter(function(e){return e.location===t.columns[i]||e.location===n.SEAT_CHARACS_FREE_WITH_MARKUP});if(a.length>0)return a[0]}return null},e.onSeatClick=function(t,i,a,r){if(!y){var o=R(t);if(o&&o.hasClass("seat"))if(e.selectedSeats.indexOf(t)>-1){var s=k(t);s=isDefined(s)?s:{};var l=s.firstName+"<br/>"+s.lastName+"<br/>"+s.seat;e.showSeatTooltip(t,l,r)}else isDefined(i)&&i.indexOf(n.SEAT_CHARACS_AVAILABLE)>-1&&n.getBookSeatHandler().call(window,{event:r,seatCharacs:i,seatPrice:a,seatNumber:t,traveller:e.selectedTraveller,trip:e.trip,segmentRefId:h,tripId:v})}y=!1};var k=function(t){var n;return e.travellers.forEach(function(e){L(e.seat)===t&&(n=e)}),n};e.onSeatHold=function(t,n,a){y=!0,i.showAlertPopup(E["seatMap.title.seatCharacteristics"],e.getSeatCharacteristicsAsText(n))},e.selectTraveller=function(t){e.travellers.forEach(function(e){e.isSelected=e===t}),e.selectedTraveller=t,null!==t.seat&&e.highlightSeat(t.seat)},e.highlightSeat=function(t){if(t=L(t)){var n=R(t);if(n){var i=n[0].getBoundingClientRect().top;i-=200,i=0>i?0:i,l.scrollTo(0,i,!0),e.onSeatClick(t)}}},e.fakeSeat=function(e){for(var t=[],n=0;e>n;n++)t.push(n);return t},e.showSeatTooltip=function(t,n,i){e.travellers.forEach(function(e){e.isSelected=e.seat===t}),e.removeDisplayedTooltip();var a=R(t);a&&(A=angular.element("<span>"+n+"</span>"),A.css("opacity",0),a.append(A),window.getComputedStyle(A[0]).opacity,A.css("opacity",.8)),isDefined(i)&&i.stopPropagation()},e.removeDisplayedTooltip=function(){isDefined(A)&&A.remove()};var R=function(e){var t=document.getElementById("seat_"+e);return t&&(t=angular.element(t)),t};e.showLegend=function(t){d.fromTemplateUrl("seat-map/templates/partial/SeatMapLegend.html",{scope:e,backdropClickToClose:!1}).then(function(n){e.removePopover=function(){e.popover.remove()},e.popover=n,n.show(t)})},e.handleEasterEgg=function(){g.handleEasterEgg()},e.toggleDeck=function(){"MAIN"===e.currentDeck.deckLabel?N():x()};var P=function(){e.seatMap.mainDeck?x():e.seatMap.upperDeck?N():e.currentDeck=null},x=function(){e.currentDeck=e.seatMap.mainDeck,e.toggleDeckButtonLabel="seatMap.button.goToUpperDeck"},N=function(){e.currentDeck=e.seatMap.upperDeck,e.toggleDeckButtonLabel="seatMap.button.goToLowerDeck"},O=function(){i.startLoading();var t=e.$on("$ionicView.afterEnter",function(){t();var n=!1;m.retrieveOrImportTrip(v,C,T).then(function(t){e.trip=t,isDefined(safeAccess(e,"trip.tripDetails"))&&e.trip.tripDetails.segments.forEach(function(t){t.refId===h&&(e.segment=t,e.travellers=t.travellers,e.isPassengerListDisplayed=e.travellers.length<=f,D(e.travellers),n=!0)}),n&&e.getSeatMap({forceFromServer:getContext("featureConfig.ssrSeat.enabled",!1)}).then(function(){P(),e.isLoadOk=!0,i.stopLoading(),F(b)},function(e){i.stopLoading(),i.toastError(e).then(function(){r.navigateBack()})})},function(){i.stopLoading(),s.translate("seatMap.error.unableToLoadSeatMap").then(function(e){i.stopLoading(),i.toastError(e).then(function(){getContext("isWebDesktop",!1)?window.history.back():r.navigateBack()})})})})},F=function(t){c(function(){var n,i=k(t),a=e.travellers.filter(function(e){return S===e.refId});n=isDefined(a)&&a.length>0?a[0]:e.travellers[0],e.selectTraveller(isDefined(i)?i:n)},500)},U=function(){i.startLoading(),window.injectAndLoadSeatMap=function(t,a){e.travellers=t,angular.isArray(e.travellers)&&(e.isPassengerListDisplayed=e.travellers.length<=f),e.seatMap=n.getWellFormattedDataModel(a),P(),D(e.travellers),e.isLoadOk=!0,i.stopLoading(),F(b)}};_(),e.$on("$ionicView.beforeEnter",function(){"seatMap"===u.current.name||"more-seatMap"===u.current.name?O():U()}),getContext("isUnitTest")&&(e.privateMethods={assignSelectedSeatsFromTravellers:D,loadTranslations:_,getFacilities:w,getFacilityOrder:I,getSeatDOM:R,showMainDeck:x,showUpperDeck:x,showDefaultDeck:P,cleanSeatNumber:L,extControllerLoad:U}),e.$on("$ionicView.beforeLeave",function(){e.popover.remove()})}]),seatMapModule.service("SeatMapService",["$log","$q","RequestService","DataManagerService","PromiseService",function(e,t,n,i,a){e=e.getInstance("SeatMapService"),e.info("Service Started...");var r={SEAT_MAP_URL_PATH:"v2/trips/seatMap",SEAT_CHARACS_NO_SEAT:"-",SEAT_CHARACS_MISSED_SEAT:"M",SEAT_CHARACS_OFFICE:"GN",SEAT_CHARACS_AVAILABLE:"_A",SEAT_CHARACS_UNAVAILABLE:"_U",SEAT_CHARACS_EXIT:"E",SEAT_CHARACS_LEFT:"LS",SEAT_CHARACS_RIGHT:"RS",SEAT_CHARACS_CHARGEABLE:"CH",SEAT_CHARACS_FREE_WITH_MARKUP:"FWM",FACILITIES_LOCATION_FRONT:"F",FACILITIES_LOCATION_REAR:"R",FACILITIES_POSITION_LEFT:"L",FACILITIES_POSITION_RIGHT:"R",FACILITIES_LAVATORY:"LA",FACILITIES_EXIT_DOOR:"D",FACILITIES_GALLEY:"G",_bookSeatHandler:function(){},getSeatMap:function(o,s,l,c){var d=t.defer();if(c=c||{forceFromServer:!1},!c.forceFromServer){var u=i.get(r._getSeatMapLSkey(o),i.LOCALSTORAGE);if(u)return e.info("resolving from storage"),d.resolve(u),d.promise}var g={boardPoint:safeAccess(o,"fromLocation.code"),departureDateTime:o.startDate,offPoint:safeAccess(o,"toLocation.code"),arrivalDateTime:o.endDate,carrier:safeAccess(o,"flight.airlineCode"),flightNumber:safeAccess(o,"flight.flightNumber"),equipment:safeAccess(o,"flight.aircraft.code"),bookingClassCode:safeAccess(o,"bookingClass.code"),lastName:s,tripId:l};return n.post(r.SEAT_MAP_URL_PATH,g,"seatmap").then(function(e){var t=safeAccess(e,"data.success");if(t){var n=e.data.seatMap;i.set(n,r._getSeatMapLSkey(o),{storage:i.LOCALSTORAGE,belongsToUser:!0}),d.resolve(n)}else a.rejectDueToBackendError({deferred:d,response:e,method:"getSeatMap"})},function(e){a.rejectDueToHttpError({deferred:d,response:e,method:"getSeatMap"})})["catch"](handleUnexpectedError),d.promise},getWellFormattedDataModel:function(e){var t={airSegment:e.airSegment,mainDeck:null,upperDeck:null,decodingDictionary:e.decodingDictionary};return e.decks.forEach(function(e){angular.isArray(e.cabins)&&(e.cabins.forEach(function(t){t.columns=e.columns,t.numberOfColumns=e.numberOfColumns}),"UPPER"===e.deckLabel?t.upperDeck?t.upperDeck.cabins=t.upperDeck.cabins.concat(e.cabins):t.upperDeck=e:t.mainDeck?t.mainDeck.cabins=t.mainDeck.cabins.concat(e.cabins):t.mainDeck=e)}),t},_getSeatMapLSkey:function(e){return"seatMap_"+e.refId},registerBookSeatHandler:function(e){return r._bookSeatHandler=e,function(){r._bookSeatHandler=function(){}}},getBookSeatHandler:function(){return r._bookSeatHandler},toString:function(){return"SeatMapService"}};return r}]),seatMapModule.service("SeatMapOrchestratorService",["$log","LayoutService","OrchestratorChiefService","$q",function(e,t,n,i){e=e.getInstance("SeatMapOrchestratorService"),e.info("Service Started...");var a={noop:function(){},_navigateToSeatMap:function(e){var t=n.navigateTo("seatMap",e);return t},next:function(e,t){var r=i.when(e);switch(e.page){case"trip-expanded":case"segment-expanded":r=e.seatMap?a._navigateToSeatMap(e.seatMap):n.check(e);break;default:r=n.check(e)}return r},toString:function(){return"SeatMapOrchestratorService"}};return n.register(a),a}]),seatMapModule.service("BookableSeatHandler",["SeatMapService","LayoutService",function(e,t){return{init:function(){e.registerBookSeatHandler(function(e){t.toast("seatMap.text.contactAgencyChangeSeat")})}}}]),seatMapModule.run(["$templateCache",function(e){e.put("seat-map/templates/pages/SeatMapExtView.html",'<ion-view debug-file-path="SeatMapExtView.html"><ion-content><ng-include src="&apos;seat-map/templates/partial/SeatMapContent.html&apos;"></ng-include></ion-content></ion-view>'),e.put("seat-map/templates/pages/SeatMapView.html",'<ion-view debug-file-path="SeatMapView.html"><ion-nav-title translate>seatMap.title.seatMap</ion-nav-title><ion-nav-buttons side="primary"><ssr-shopping-cart-button enabled-if="&apos;ssrShoppingCart&apos;"></ssr-shopping-cart-button><button class="button button-clear icon {{::refreshicon}}" ng-click="refreshSeatMap()"></button></ion-nav-buttons><ion-content><ng-include src="&apos;seat-map/templates/partial/SeatMapContent.html&apos;"></ng-include></ion-content></ion-view>'),e.put("seat-map/templates/partial/SeatMapContent.html",'<div class="contained" debug-file-path="SeatMapContent.html"><header class="pax-header"><div class="pax-select" ng-click="isPassengerListDisplayed = !isPassengerListDisplayed"><span translate>seatMap.text.viewPassengerSeats</span> <i ng-class="isPassengerListDisplayed ? &apos;icon-chevron-up&apos; : &apos;icon-chevron-right&apos;"></i></div><div class="pax-list" ng-show="isPassengerListDisplayed"><ul><li ng-class="traveller.seat ? &apos;assigned&apos; : &apos;unavailable&apos;" ng-click="selectTraveller(traveller)" ng-repeat="traveller in travellers"><span>{{traveller.firstName}} {{traveller.lastName}} {{traveller.seat ? &apos;- &apos; + traveller.seat : &apos;&apos;}} <i class="i-big icon-check" ng-if="traveller.isSelected"></i></span></li></ul></div></header><div class="smp-plane" ng-if="isLoadOk" ng-click="removeDisplayedTooltip()"><div class="smp-container"><button ng-click="showLegend($event)" translate>seatMap.button.showLegend</button><div class="toggleDeckContainer" ng-if="seatMap.mainDeck &amp;&amp; seatMap.upperDeck"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAA5CAYAAAB0+HhyAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAASXSURBVGhD1ZlPbFRFHMffRYknL8Y0ISQkJiZiVIwJ4UAwqBw4GC7oETwQDcaDCEmrgaDFkHChGDVGD1zggjaGv6GUtGBWSAksLZW21vKn293X3X27r/unC4gFfsx3d2Yz771ZJ8vhzfSbfPNe39v9zee783ZnOuOUK/Ok80i2TN+MeNSZjNdfszaHWdsqprC1QSa9Kr1wbIY+Tfq050Y5VqNNtD3hVZRssrVBfpoo0qaLHpkS2gaDik22Nsi31wu0fdjnZeMX2gaDik22NsjOqx51j5V52fiFtsGgYpOtDbJ1KEffT1V52fiFtsGgYpOtDbIpMUtHUjVeNn6hbTCo2GRrg6wfdOl09j4vG7/QNhhUbLK1QVb1Z+hS8QEvG7/QNhhUbLK1QV4+naaJ6gIvG7/GWdtgULHJ1gZ5kQ1I2fuPeNn4hbbBoGKT/b9BMKI+89s0ffVXSTnyxmG0DYa/NaN7yyAzfpU62CexZiBLbw/mjBoMYEkzJhUr3DLI0Zs+rWNFbBFYwKRihVsG+WG8SB9dLvAy5gUWMKlY4ZZButkUesfIHC9jXl+wOReYVKxwyyDbr+Rp30SFlzEvsHzOmGTGSrXWPG8GwUX5xpZLOfr51jwvY15gAZPgC9uR4WW/f2GWejN3eRnzAguYwrzi73qPqMKsOefSee9fXsa8wAImwScz4zzwaMnnK85kaLT8Hy9jXmB5lTEJxrADj5Y4x7HjWJoy9x7yMuYFlo7jjTkX+GRWHOtBxB/ixp1CY2ry5ai5qUnYYAET2OQQwoGfX1woVmr00qk0rTpnfmoSNpjABkaZG272CIwL/akSvXHW5R1qn8AGRsEr2CPfkSNTc7Qxkedvs09gA6McBMdIjxwcK9LWK0X+NvsENjDKHz4cGEdw3HXNY18se+ZYYYFt13ChGUBwNx8tcWPb5Tz1/GNu+UenA5NV2jaUa/IK/sij9UEiS4enzS3/6AS2DxONIHIHRHrknYFZ6suZW/7RCWxgFLyCP9Aj8OtsGpAsmVv+0QlsYJQ/fDjSI0vZNGDGoqlJWKm7D+uMglfwB3rEnZunZ3tT1GXR1CRssIERrDJ7IMibfRlayUZO1fTAJmN0B6vM3gySzFZo2ck0PeZdaLPACFYwR4Kcmi7R2sFs45WLQGAFcyTIoUnf6BZbuwIrmCNB9o8W6LOkuS22dgVWMEeC7Liap70Gt9jaVfdYqc4cCbL5Yo5+sWj5RyewgjkSZMP5WTru3uMvs19gBXMkyFtnMzTk2zs1CQusYI4EWXYiTXfY8L9YdLu2UGcOBPHKNeunJmGDdQljBnszyHuDLr1yxv6pSdhgfnfAbQS57Vfp+d9T9MDcNuFTC8xgRwYnkanQa332Lv/oBPY/3Qo5vbdKtP6CPVts7QrsyOD8OO7TFou22NoV2JHB2T1coK7r9i7/6NTJ2JHB+XgoT99ZvPyjE9g/YRmcjX9k6de0PTtT7QrsyOCs7ncpUbBnZ6pdgR0ZnOXsX8abbLhfrJqaXyBkcJ5jw3znIpqahA12ZHB6xorUdY39ciW9oOVrqvuyDb+/54ZPTwDATdbfgNhy9QAAAABJRU5ErkJggg=="> <button ng-click="toggleDeck()" translate data-tap-disabled="isDataTapDisabled" id="toggleDeckButton">{{toggleDeckButtonLabel}}</button></div><div ng-repeat="cabin in currentDeck.cabins track by $index"><div class="smp-header"><div class="drop-selector"><span>{{currentDeck.deckLabel}}</span></div><div class="smp-cols"><div></div><div ng-repeat="col in cabin.columns track by $index">{{col === &apos;-&apos; ? &apos;&apos; : col}}</div><div></div></div></div><div ng-if="!row.isEmptyRow || row.isExitRow" ng-init="_frontFacilities = getFrontFacilities(row.facilities);\n                 _rearFacilities = getRearFacilities(row.facilities);\n                 _hasLeftExitSeat = hasLeftExitSeat(row);\n                 _hasRightExitSeat = hasRightExitSeat(row);" ng-repeat="row in cabin.cabinMap"><div class="narrower smp-area" ng-if="_frontFacilities"><div ng-repeat="facilityClass in _frontFacilities track by $index" ng-class="facilityClass"></div></div><div class="smp-row" ng-if="row.isExitRow"><div class="row-no"></div><div class="no-seat exit-left"></div><div class="no-seat" ng-repeat="generatedSeat in fakeSeat(cabin.numberOfColumns)"></div><div class="no-seat exit-right"></div><div class="row-no"></div></div><div class="smp-row" ng-if="!row.isEmptyRow"><div class="row-no">{{row.rowIndex}}</div><div class="no-seat" ng-class="_hasLeftExitSeat ? &apos;exit-left&apos; : &apos;&apos;"></div><div ng-repeat="seat in row.rowData" ng-class="getSeatCssClass(_seatNumber, seat)" id="{{_seatNumber ? &apos;seat_&apos; + _seatNumber : &apos;&apos;}}" ng-click="onSeatClick(_seatNumber, seat, _seatPrice, $event)" ng-init="_seatNumber = generateSeatNumber(cabin, row.rowIndex, $index); _seatPrice = getSeatPrice(row.seatPrices, cabin, $index)" on-hold="onSeatHold(_seatNumber, seat, _seatPrice,$event)"></div><div class="no-seat" ng-class="_hasRightExitSeat ? &apos;exit-right&apos; : &apos;&apos;"></div><div class="row-no">{{row.rowIndex}}</div></div><div class="narrower smp-area" ng-if="_rearFacilities"><div ng-repeat="facilityClass in _rearFacilities track by $index" ng-class="facilityClass"></div></div></div></div><div class="smp-row">&#xA0;</div></div></div></div>'),e.put("seat-map/templates/partial/SeatMapLegend.html",'<ion-popover-view debug-file-path="SeatMapLegend.html" id="seatMapLegend"><ion-content has-bouncing="false"><section class="seatmap-legend"><h1 ng-click="handleEasterEgg()" style="cursor:default" translate>seatMap.title.legend</h1><i class="close icon-close" ng-click="removePopover()"></i><div class="two-column-equal"><div><ul><li><span><i class="legend-available"></i></span> <span translate>seatMap.label.available</span></li><li><span><i class="legend-assigned"></i></span> <span translate>seatMap.label.assigned</span></li><li ng-if="allowSeatChange"><span><i class="legend-selected"></i></span> <span translate>seatMap.label.selected</span></li></ul></div><div><ul><li><span><i class="legend-unavailable"></i></span> <span translate>seatMap.label.unavailable</span></li><li><span><i class="legend-chargeable"></i></span> <span translate>seatMap.label.chargeable</span></li><li ng-if="allowSeatChange"><span><i class="legend-changed"></i></span> <span translate>seatMap.label.changed</span></li></ul></div></div><div class="two-column-equal"><div><ul><li><span><i class="legend-exit"></i></span> <span translate>seatMap.label.emergencyExit</span></li><li><span><i class="legend-galley"></i></span> <span translate>seatMap.label.galley</span></li></ul></div><div><ul><li><span><i class="legend-lavatory"></i></span> <span translate>seatMap.label.lavatory</span></li><li><span><i class="legend-bassinet"></i></span> <span translate>seatMap.label.bassinet</span></li></ul></div></div></section></ion-content></ion-popover-view>')}]),window.taxiModule=angular.module("TaxiModule",["ionic","CoreModule","ItmngtModule","AnalyticsModule"]),window.taxiModule.run(["$log","$rootScope","TaxiEligibilityRecoService","OrchestratorChiefService","$controller",function(e,t,n,i,a){e=e.getInstance("Taxi"),e.info("Module started");var r=getContext("featureConfig.taxiReco.enabled",!1);if(r&&(t.$on("triplistUpdatedFromServerEvent",function(e,t){n.updateTaxiEligibilityRecoProperties(t)}),t.$on("pushNotificationReceivedForTaxiReco",function(e,t){i.navigateTo("taxi",{prefillUrl:t,touchPoint:"CMT_TAXI_RECO_PUSH"})})),getContext("featureConfig.taxiBooking.enabled",!1)){var o=t.$new();a("TaxiBookingInteractionController",{$scope:o}),o.init()}}]),window.taxiModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("taxi")}]),window.taxiModule.routes={taxi:{url:"/taxi",params:{tripId:null,prefillUrl:null,touchPoint:"CMT_TAXI_DIRECT",recoId:null},templateUrl:"taxi/templates/pages/TaxiView.html",controller:"TaxiController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Taxi booking",[],"CrossSell").promise()}]},ncyBreadcrumb:{label:"{{'taxi.title.taxi'|translate}}"}}},taxiModule.controller("TaxiController",["$scope","$state","$rootScope","$log","I18nConfig","$sce","LayoutService","$timeout","I18nService","$window","NetworkService","UrlService","AnalyticsService","$stateParams","AuthenticationService","CurrencyService","OrchestratorChiefService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v){i=i.getInstance("TaxiController"),i.info("Controller Started..."),e.reloadTaxiBookingLandingPage=!1,e.pageLoaderTimeout,e.taxiIframeUrl=null,e.hideTaxiFrame=!1,e.previousPrefillUrl=p.prefillUrl,e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView(),e.isLogged=m.isLogged(),e.$on("$ionicView.enter",function(){window.addEventListener("message",e.receiveMessage,!1),(e.reloadTaxiBookingLandingPage||isDefined(p.prefillUrl))&&(e.pageLoaderTimeout&&s.cancel(e.pageLoaderTimeout),e._loadTaxiBookingLandingPage(),e.reloadTaxiBookingLandingPage=!1)}),e.$on("$stateChangeStart",function(t,n,i,a,r,s){var l=["taxi","guest-taxi","more-taxi","more-guest-taxi"];-1!=l.indexOf(a.name)&&(o.unFocusActiveElement(),e.isIOSWebView?(e.webview.removeEventListener("onMessage",function(t){e.receiveMessage(t)}),e.webview.close(),e.reloadTaxiBookingLandingPage=!0,v.deregisterCustomBackAction()):window.removeEventListener("message",e.receiveMessage))}),c.onTaxiIframeLoad=function(t){i.info("onTaxiIframeLoad",t),d.hasConnectivity().isOnline?(e._displayIframe(!0),e._injectToken()):(s.cancel(e.pageLoaderTimeout),
o.stopLoading(),e._displayIframe(!1)),e.$apply()},c.onTaxiIframeError=function(t){d.hasConnectivity().isOnline||e._displayIframe(!1),i.info("onTaxiIframeError",t)},e.receiveMessage=function(t){var n={};e.isIOSWebView?(n=t,i.info("New message received:",n)):(n=safeAccess(t,"data",{}),i.info("New message received:",n));var a=n.step;isDefined(a)&&isDefined(h[a])&&h[a](n)};var h={displaySearch:function(t){o.stopLoading(),s.cancel(e.pageLoaderTimeout)},displayConfirmation:function(t){e.reloadTaxiBookingLandingPage=!0;var i={lastName:safeAccess(t,"bookingData.lastName"),firstName:safeAccess(t,"bookingData.firstName"),bookingId:safeAccess(t,"bookingData.recloc"),tripId:p.tripId};g.runSafe(function(){this.sendEvent("Taxi Booking Completed",[],"CrossSell")}),n.$emit("taxiBookingFlowCompleted",i)}};e._getIframeDom=function(){return document.getElementById("taxiBookingFrame")},e._injectToken=function(){var t=m.getUserAccessToken();if(e.isIOSWebView)e.webview.executeScript("window.setCmtToken('"+t+"');");else{var n=e._getIframeDom();if(isDefined(n)){var i=getContext("featureConfig.taxiBooking.iframeUrl","https://transferbookingengine.com/cmt/"),a=i.slice(0,i.indexOf(".com")+4);n.contentWindow.postMessage({cmtToken:t},a)}}},e.goBack=function(){e.webview.canGoBack(function(t){t?e.webview.goBack():(v.deregisterCustomBackAction(),v.navigateBack())})},n.$on("onMoreMenuPopup",function(t,n){e.webview&&(n.modalDisplayed?e.webview.hide():e.webview.show())});var S=function(){v.registerCustomBackAction(e.goBack),o.showBackButton(!0)},C=function(){v.deregisterCustomBackAction(),o.showBackButton(!1)};e._displayIframe=function(t){e.hideTaxiFrame=!t},e.refreshButtonClick=function(){e._loadTaxiBookingLandingPage(!0)},e.createTaxiUrl=function(e){var t=getContext("featureConfig.taxiBooking.iframeUrl","https://transferbookingengine.com/cmt/");t=u.addParameterToQueryString(t,"ts",(new Date).getTime());var n=a.getCurrentDeviceLanguage();t=u.addParameterToQueryString(t,"language",n);var i=a.getCountryCodeFromDeviceLocale();return t=u.addParameterToQueryString(t,"countryCode",i),t=u.addParameterToQueryString(t,"PNR","NULL"),isDefined(p.touchPoint)&&(t=u.addParameterToQueryString(t,"touchpoint",p.touchPoint)),isDefined(p.recoId)&&(t=u.addParameterToQueryString(t,"recoId",p.recoId)),t=u.addParameterToQueryString(t,"currency",e),isDefined(p.prefillUrl)&&(t+="&"+p.prefillUrl),t},e._loadTaxiBookingLandingPage=function(n){e.isIOSWebView||o.startLoading(),f.getDeviceCurrency().then(function(n){var a=e.createTaxiUrl(n);if(e.previousPrefillUrl=p.prefillUrl,e.isIOSWebView){if(!d.hasConnectivity().isOnline)return void e._displayIframe(!1);safeAccess(e,"webview",!1)&&(e.webview.close(),e.webview=void 0),i.info("Setting URL of WebView"),e.webview=c.cordova.plugins.AMWebview(a,{hasTabs:e.isLogged,hideHeader:!0,postMessageHandler:"TransferHandler"}),safeAccess(e,"webview",!1)&&e.webview.addEventListener("loadend",function(n){e.webview.canGoBack(function(e){e?S():"more-taxi"!==t.current.name&&"more-guest-taxi"!==t.current.name&&C()},function(e){i.error(e)})}),e.webview.addEventListener("onMessage",function(t){e.receiveMessage(t)}),e.webview.addEventListener("loadend",e._injectToken,!1)}else{e.pageLoaderTimeout=s(function(){o.stopLoading()},getContext("featureConfig.iframePageLoadTimeout",2500));e.taxiIframeUrl=r.trustAsResourceUrl(a)}})};var T=function(){e._loadTaxiBookingLandingPage()};T(),e.$on("$destroy",function(){c.onTaxiIframeLoad=void 0,c.onTaxiIframeError=void 0}),n.$on("onTaxiBookingMessageReceive",function(t,n){e.webview.showToast(n)})}]),taxiModule.controller("TaxiBookingInteractionController",["$scope","TripService","TriplistService","$rootScope","I18nService","LayoutService","$log","$timeout","OrchestratorChiefService",function(e,t,n,i,a,r,o,s,l){o=o.getInstance("TaxiBookingInteractionController"),o.info("Controller Started..."),e.taxiBookingFlowCompletedHandler,e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView(),e.init=function(){e.taxiBookingFlowCompletedHandler=i.$on("taxiBookingFlowCompleted",function(c,d){o.info("taxiBookingFlowCompleted event received",d),isDefined(d)&&isDefined(d.lastName)&&isDefined(d.bookingId)&&a.translate(["common.taxiBooking.text.importingBooking","common.taxiBooking.text.importBookingSuccess","common.taxiBooking.error.importBookingFailed"]).then(function(a){var o=a["common.taxiBooking.text.importingBooking"];if(e.isIOSWebView)i.$emit("onTaxiBookingMessageReceive",o);else var c=r.toast(o);var u={lastName:d.lastName,firstName:d.firstName,tripId:d.bookingId,contextTripId:d.tripId};t.addTrip(u).then(function(o){var d=a["common.taxiBooking.text.importBookingSuccess"];e.isIOSWebView?s(function(){i.$emit("onTaxiBookingMessageReceive",d)},3e3):c.then(function(){r.toast(d)}),n.refreshTriplistOnNextDisplay(),isDefined(u.contextTripId)&&(t.refreshTripOnNextDisplay(o.tripId),t.scrollToOnNextDisplay(o.tripId,u.tripId),u.contextTripId=o.tripId,u.lastName=o.bookingLastName,u.firstName=o.bookingFirstName),l.next({taxiBookingCompleted:!0,taxiTripInput:u})},function(){var t=a["common.taxiBooking.error.importBookingFailed"];e.isIOSWebView?s(function(){i.$emit("onTaxiBookingMessageReceive",t)},3e3):c.then(function(){r.toastError(t)})})})})},e.$on("$destroy",function(){o.warn("TaxiBookingInteractionController DESTROYED"),isDefined(e.taxiBookingFlowCompletedHandler)&&e.taxiBookingFlowCompletedHandler()})}]),taxiModule.service("TaxiEligibilityRecoService",["$log","$q","TripService","AnalyticsService","ProfileService","DateTimeService",function(e,t,n,i,a,r){e=e.getInstance("TaxiEligibilityRecoService"),e.info("Service Started...");var o={LOCALYTICS_RECO_PREFIX:"Next taxi eligible trip",_getFirstTaxiRecoSegment:function(e){for(var t=safeAccess(e,"tripDetails.segments",[]),n=0;n<t.length;n++){var i=t[n];if(isDefined(i.type)&&isDefined(i.recoType)&&"reco"===i.type.toLowerCase()&&"taxi"===i.recoType.toLowerCase())return i}return null},_isTripEligibleForReco:function(e){var i=t.defer(),a=safeAccess(e,"productStats");if(isDefined(a)){var r=a.numberOfCar+a.numberOfTransfer+a.numberOfTaxi+a.numberOfMoveMisc;isNaN(r)||0!==r?i.resolve(!1):n.retrieveTrip(e.tripId,e.bookingLastName).then(function(e){var t=!1;isDefined(o._getFirstTaxiRecoSegment(e))&&(t=!0),i.resolve(t)},function(e){i.resolve(!1)})}else i.resolve(!1);return i.promise},_getEligibleTrips:function(e,n){var i=t.defer(),a=function(t,r){if(e.length>t){var s=e[t];o._isTripEligibleForReco(s).then(function(e){e&&r.push(s),r.length===n?i.resolve(r):a(t+1,r)})}else i.resolve(r)};return a(0,[]),i.promise},_prepareTripProperties:function(e,t){var n=a.getProfile(),i=safeAccess(n,"notificationSettings.flightAlertType.pushChannelEnabled",!1),s={};s["About trip notifications"]=i.toString();for(var l=0;t>l;l++){var c=e[l],d=l+1,u=o.LOCALYTICS_RECO_PREFIX+" start date "+d,g=o.LOCALYTICS_RECO_PREFIX+" parameters "+d,p=o.LOCALYTICS_RECO_PREFIX+" city code "+d,m=o.LOCALYTICS_RECO_PREFIX+" city name "+d;if(s[u]=null,s[g]=null,s[p]=null,s[m]=null,isDefined(c)){var f=r.getMomentFromBackendDate(c.startDate);s[u]=f.format("YYYY-MM-DD");var v=o._getFirstTaxiRecoSegment(c);isDefined(v)&&(s[g]=safeAccess(v,"parameters"),s[m]=safeAccess(v,"startLocation.cityName"),s[p]=safeAccess(v,"startLocation.cityCode"))}}return s},_sendTripProperties:function(e){i.runSafe(function(){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];i.setProperty(t,n)}})},updateTaxiEligibilityRecoProperties:function(e){var t=getContext("featureConfig.taxiReco.enabled",!1);if(t){var n=getContext("featureConfig.taxiReco.nbOfEligibleTripsToSend",3),i=safeAccess(e,"upcomingTrips",[]);o._getEligibleTrips(i,n).then(function(e){var t=o._prepareTripProperties(e,n);o._sendTripProperties(t)})}}};return o}]),taxiModule.run(["$templateCache",function(e){e.put("taxi/templates/pages/TaxiView.html",'<ion-view debug-file-path="TaxiView.html"><ion-nav-title translate>taxi.title.taxi</ion-nav-title><ion-nav-buttons side="primary"><button class="icon button button-clear {{::refreshicon}}" ng-click="refreshButtonClick()"></button></ion-nav-buttons><ion-content class="has-header has-tabs"><div class="taxiErrorContainer" ng-if="hideTaxiFrame"><p><i class="icon icon-alert-tri-outline space-rt"></i><br>{{&apos;taxi.error.iframeLoadingError&apos;|translate}}</p><button class="btn-small" ng-click="refreshButtonClick()" type="button"><i class="space-rt icon-refresh"></i> {{&apos;taxi.button.refresh&apos;|translate}}</button></div><div class="iframe-container" ng-if="!isIOSWebView"><iframe class="taxiFrame" id="taxiBookingFrame" ng-class="{&apos;taxiFrameHidden&apos;: hideTaxiFrame}" ng-src="{{taxiIframeUrl}}" onerror="if(window.onTaxiIframeError) window.onTaxiIframeError(event);" onload="if(window.onTaxiIframeLoad) window.onTaxiIframeLoad(event);"></iframe></div></ion-content></ion-view>')}]),window.parkcloudModule=angular.module("ParkcloudModule",["ionic","CoreModule","AnalyticsModule"]),window.parkcloudModule.run(["$log",function(e){e=e.getInstance("Parkcloud"),e.info("Module started")}]),window.parkcloudModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("parkcloud")}]),window.parkcloudModule.routes={parking:{url:"/parking",templateUrl:"parkcloud/templates/pages/ParkcloudView.html",controller:"ParkcloudController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Parking booking Viewed",[],"Navigation").promise()}]},ncyBreadcrumb:{label:"{{'parkcloud.title.parking'|translate}}"}}},parkcloudModule.controller("ParkcloudController",["$scope","$rootScope","$state","$log","I18nConfig","$sce","LayoutService","$timeout","I18nService","$window","NetworkService","UrlService","OrchestratorChiefService","$q",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p){function m(t){e.hideParkcloudFrame=!t}i=i.getInstance("ParkcloudController"),i.info("Controller Started..."),e.reloadParkcloudBookingLandingPage=!1,e.hasDisplayedForwardMessage=!0,e.pageLoaderTimeout,e.parkcloudIframeUrl=null,e.hideParkcloudFrame=!1,e.isIOSSafari=null!=window.isIOS()&&window.isSafari(),e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView();var f={en:"en-GB",pt:"pt-PT",de:"de-DE",es:"es-ES",fr:"fr-FR",it:"it-IT",ru:"ru-RU",sv:"sv-SE",da:"dk-DK",fi:"fi-FI",no:"nb-NO",pl:"pl-PL",nl:"nl-NL",ro:"ro-RO"},v=f.en;e.$on("$ionicView.enter",function(){e.reloadParkcloudBookingLandingPage&&(e._loadParkcloudBookingLandingPage(),e.reloadParkcloudBookingLandingPage=!1)}),e.$on("$stateChangeStart",function(t,n,i,a,r,s){var l=["parkcloud","parking","guest-parking","more-parking","more-guest-parking"];-1!=l.indexOf(a.name)&&(o.unFocusActiveElement(),e.isIOSWebView&&(e.webview.removeEventListener("loadend",function(e){}),e.webview.close(),g.deregisterCustomBackAction()),e.reloadParkcloudBookingLandingPage=!0)}),e.goBack=function(){e.webview.canGoBack(function(t){t?e.webview.goBack():(g.deregisterCustomBackAction(),g.navigateBack())})},t.$on("onMoreMenuPopup",function(t,n){e.webview&&(n.modalDisplayed?e.webview.hide():e.webview.show())});var h=function(){g.registerCustomBackAction(e.goBack),o.showBackButton(!0)},S=function(){g.deregisterCustomBackAction(),o.showBackButton(!1)};c.onParkcloudIframeLoad=function(t){i.method("onParkcloudIframeLoad",t),d.hasConnectivity().isOnline?m(!0):(e.hasDisplayedForwardMessage&&(s.cancel(e.pageLoaderTimeout),o.stopLoading()),m(!1)),e.$apply()};var C=function(){var e=getContext("featureConfig.parkcloud.defaultUrl",v),t=a.getCurrentDeviceLanguage();return isDefined(f[t])?e=e+"/"+f[t]:e+="/en-GB",e=u.addParameterToQueryString(e,"ts",(new Date).getTime()),i.info("Will load parkcloud:",t,e),e};e.refreshButtonClick=function(){e._loadParkcloudBookingLandingPage(!0)},e._loadParkcloudBookingLandingPage=function(){var t=getContext("featureConfig.iframePageLoadTimeout",2500);if(e.isIOSWebView||(e.hasDisplayedForwardMessage?o.startLoading():(t=6500,l.translate("parkcloud.text.forwardReservation").then(function(e){o.startLoading(!1,e)}))),e.parkcloudUrl=C(),e.isIOSWebView){if(!d.hasConnectivity().isOnline)return void m(!1);safeAccess(e,"webview",!1)&&(e.webview.close(),e.webview=void 0),i.info("Setting URL of WebView"),e.webview=c.cordova.plugins.AMWebview(e.parkcloudUrl,{hasTabs:!0,hideHeader:!0}),safeAccess(e,"webview",!1)&&e.webview.addEventListener("loadend",function(t){e.webview.canGoBack(function(e){e?h():"more-parking"!==n.current.name&&"more-guest-parking"!==n.current.name&&S()},function(e){i.error(e)})})}else e.pageLoaderTimeout=s(function(){e.hasDisplayedForwardMessage=!0,o.stopLoading()},t),e.parkcloudIframeUrl=r.trustAsResourceUrl(e.parkcloudUrl)};var T=function(){e._loadParkcloudBookingLandingPage()};T(),e.$on("$destroy",function(){c.onParkcloudIframeLoad=void 0,c.onParkcloudIframeError=void 0})}]),parkcloudModule.run(["$templateCache",function(e){e.put("parkcloud/templates/pages/ParkcloudView.html",'<ion-view debug-file-path="ParkcloudView.html"><ion-nav-title translate>parkcloud.title.parking</ion-nav-title><ion-nav-buttons side="primary"><button class="icon button button-clear {{::refreshicon}}" ng-click="refreshButtonClick()"></button></ion-nav-buttons><ion-content><div class="parkcloudErrorContainer" ng-show="hideParkcloudFrame"><p><i class="icon icon-alert-tri-outline space-rt"></i><br>{{&apos;parkcloud.error.iframeLoadingError&apos;|translate}}</p><button class="btn-small" ng-click="refreshButtonClick()" type="button"><i class="space-rt icon-refresh"></i> {{&apos;parkcloud.button.refresh&apos;|translate}}</button></div><div class="iframe-container" ng-if="!isIOSWebView"><iframe class="parkcloudFrame" id="parkcloudBookingFrame" ng-attr-scrolling="{{isIOSSafari ? &apos;no&apos; : &apos;auto&apos;}}" ng-class="{&apos;parkcloudFrameHidden&apos;: hideParkcloudFrame}" ng-src="{{parkcloudIframeUrl}}" onload="if(window.onParkcloudIframeLoad) window.onParkcloudIframeLoad(event);"></iframe></div></ion-content></ion-view>')}]),window.activitiesModule=angular.module("ActivitiesModule",["ionic","CoreModule","AnalyticsModule"]),window.activitiesModule.run(["$log",function(e){e=e.getInstance("Activities"),e.info("Module started")}]),window.activitiesModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("activities")}]),window.activitiesModule.routes={activities:{url:"/activities",params:{prefillUrl:null,directUrl:null},templateUrl:"activities/templates/pages/ActivitiesView.html",controller:"ActivitiesController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Activities booking",[],"CrossSell").promise()}]},ncyBreadcrumb:{label:"{{'activities.title.activities'|translate}}"}},"activities-asb":{url:"/activities/*payload?",params:{prefillUrl:null},templateUrl:"activities/templates/pages/ActivitiesView.html",controller:"ActivitiesController",secured:!1,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Activities booking",[],"CrossSell").promise()}]},ncyBreadcrumb:{label:"{{'activities.title.activities'|translate}}"}}},activitiesModule.controller("ActivitiesController",["$scope","$rootScope","$state","$log","I18nConfig","$sce","LayoutService","$timeout","I18nService","$window","$stateParams","NetworkService","UrlService","OrchestratorChiefService","$ionicHistory","AppPermissionsService","DataManagerService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v){function h(){var e=navigator.userAgent,t=e.match(/Chrome\/(53|54)/),n=e.match(/Android (5|6)/);if(t){var i,a;n?(i="Android System WebView",a="com.google.android.webview"):(i="Google Chrome",a="com.android.chrome"),l.translate(["activities.title.updateWebView","activities.text.updateWebView","activities.button.update","activities.button.cancel"]).then(function(e){var t="market://details?id="+a,n=e["activities.title.updateWebView"].replace("$WEBVIEW_APP",i),r=e["activities.text.updateWebView"].replace("$WEBVIEW_APP",i),s=e["activities.button.update"],l=e["activities.button.cancel"];o.showConfirmPopup(n,r,s,l).then(function(){window.location.href=t})})}}i=i.getInstance("ActivitiesController"),i.info("Controller Started..."),e.reloadActivitiesBookingLandingPage=!1,e.hasDisplayedForwardMessage=!0,e.pageLoaderTimeout,e.activitiesIframeUrl=null,e.hideActivitiesFrame=!1,e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView(),e.isAndroidWebView=ionic.Platform.isAndroid()&&ionic.Platform.isWebView(),e.isIOSSafari=null!=window.isIOS()&&window.isSafari(),e.previousPrefillUrl=d.prefillUrl;var S=null,C=["de","en","es","fr","it","ja","pt-BR","pt-PT","ru","sv","zh-CN"],T={en:"https://www.partner.viator.com/en/13257?EMAIL=trips@checkmytrip.com",de:"https://www.partner.viator.com/de/15500?EMAIL=trips@checkmytrip.com",es:"https://www.partner.viator.com/es/15482?EMAIL=trips@checkmytrip.com",fr:"https://www.partner.viator.com/fr/14461?EMAIL=trips@checkmytrip.com",it:"https://www.partner.viator.com/it/21070?EMAIL=trips@checkmytrip.com",pt:"https://www.partner.viator.com/pt/16093?EMAIL=trips@checkmytrip.com"},b={en:"https://13257.m.viator.com?EMAIL=trips@checkmytrip.com",de:"https://15500.m.viator.com?EMAIL=trips@checkmytrip.com",es:"https://15482.m.viator.com?EMAIL=trips@checkmytrip.com",fr:"https://14461.m.viator.com?EMAIL=trips@checkmytrip.com",it:"https://21070.m.viator.com?EMAIL=trips@checkmytrip.com",pt:"https://16093.m.viator.com?EMAIL=trips@checkmytrip.com"};e.$on("$ionicView.enter",function(){e.reloadActivitiesBookingLandingPage&&(e._loadActivitiesBookingLandingPage(),e.reloadActivitiesBookingLandingPage=!1),e.isIOSWebView&&e._loadActivitiesBookingLandingPage(),h()}),e.$on("$stateChangeStart",function(t,n,i,a,r,s){var l=["activities","guest-activities","more-activities","more-guest-activities"];-1!=l.indexOf(a.name)&&(o.unFocusActiveElement(),e.isIOSWebView&&e.webview&&(e.webview.removeEventListener("loadend",function(e){}),e.webview.close(),p.deregisterCustomBackAction()))}),c.onActivitiesIframeLoad=function(t){i.info("onActivitiesIframeLoad",t),u.hasConnectivity().isOnline?e._displayIframe(!0):(e.hasDisplayedForwardMessage&&(s.cancel(e.pageLoaderTimeout),o.stopLoading()),e._displayIframe(!1)),e.$apply()},c.onActivitiesIframeError=function(e){i.info("onActivitiesIframeError",e)},e._getIframeDom=function(){return document.getElementById("activitiesBookingFrame")},e._displayIframe=function(t){e.hideActivitiesFrame=!t},e.refreshButtonClick=function(){e._loadActivitiesBookingLandingPage(!0)};var E=function(){var t;if(isDefined(d.directUrl))return e.AddTrafficParameters(d.directUrl);var n=getContext("featureConfig.activitiesBooking.defaultUrl"),r=getContext("featureConfig.activitiesBooking.activitiesBookingUrl",!1);n||r||i.error("No url defined for activities booking, aborting!"),t=r||n;var o=a.getCurrentDeviceLanguage();if(-1!==t.indexOf("mylittleadventure")){o.startsWith("pt")?o="pt":-1===C.indexOf(o)&&(o="en"),t=g.addParameterToQueryString(t,"lang",o);var s=a.getCountryCodeFromDeviceLocale(),l=v.get("localeCurrencyMap",v.LOCALSTORAGE);l||(l=v.get("localeCurrencyMap",v.MEMORY));var c=l[s]||"EUR";t=g.addParameterToQueryString(t,"currency",c),t=e.AddTrafficParameters(t)}else if(-1!==t.indexOf("viator")){var u="";getContext("isWebDesktop")?(u=T[o],isDefined(u)&&"en"!==o&&(t=u)):(t=b.en,u=b[o],isDefined(u)&&"en"!==o&&(t=u))}else i.warn("unknown activites provider configured, won't adapt set URL");isDefined(d.prefillUrl)&&(t=g.addParameterToQueryString(t,"iata",d.prefillUrl));var p=g.parseQueryString(window.location.search);return p.CITY&&(t=g.addParameterToQueryString(t,"iata",p.CITY)),t};e._loadActivitiesBookingLandingPage=function(){var t="";if(e.isIOSWebView||e.isAndroidWebView){if(S=E(),t=getContext("SITECODE"),S=g.addParameterToQueryString(S,"AID",t),S=g.addParameterToQueryString(S,"ts",(new Date).getTime()),!u.hasConnectivity().isOnline)return void e._displayIframe(!1);safeAccess(e,"webview",!1)&&(e.webview.close(),e.webview=void 0),i.info("Setting URL of WebView"),l.translate(["activities.title.activities"]).then(function(t){var a=t["activities.title.activities"];e.webview=c.cordova.plugins.AMWebview(S,{hasTabs:!0,hideHeader:!0,postMessageHandler:"PostMessageHandler",headerColor:c.getComputedHeaderColor(),headerText:a.toUpperCase(),hasAdditionalHeader:"NCMTBOSC"===getContext("SITECODE")}),e.isAndroidWebView&&(o.loading(!0),e.webview.addEventListener("loaderror",function(t){o.loading(!1),e.webview.close(),e._displayIframe(!1),i.error(t.message+"-"+t.code+"-"+S)}),e.webview.addEventListener("loadstop",function(t){o.loading(!1),e.webview.show()}),e.webview.addEventListener("exit",function(t){e.webview=null,p.navigateBack()})),e.webview.addEventListener("loadend",function(t){e.webview.canGoBack(function(e){e?A():"more-activities"!==n.current.name&&"more-guest-activities"!==n.current.name&&y()},function(e){i.error(e)})})})}else if(u.hasConnectivity().isOnline){e._displayIframe(!0);var a=getContext("featureConfig.iframePageLoadTimeout",2500);e.hasDisplayedForwardMessage?o.startLoading():(a=6500,l.translate("activities.text.forwardReservation").then(function(e){o.startLoading(!1,e)})),e.pageLoaderTimeout=s(function(){e.hasDisplayedForwardMessage=!0,o.stopLoading()},a);var d=E();t=getContext("SITECODE"),d=g.addParameterToQueryString(d,"AID",t),d=g.addParameterToQueryString(d,"ts",(new Date).getTime()),i.info("Will load activities iframe:",d),e.activitiesIframeUrl=r.trustAsResourceUrl(d)}else e._displayIframe(!1)};var A=function(){p.registerCustomBackAction(e.goBack),o.showBackButton(!0)},y=function(){p.deregisterCustomBackAction(),o.showBackButton(!1)};e.goBack=function(){e.webview.canGoBack(function(t){t?e.webview.goBack():(p.deregisterCustomBackAction(),p.navigateBack())})},t.$on("onMoreMenuPopup",function(t,n){e.webview&&(n.modalDisplayed?e.webview.hide():e.webview.show())}),e.AddTrafficParameters=function(e){return e=g.addParameterToQueryString(e,"utm_source","amadeus"),e=g.addParameterToQueryString(e,"utm_medium","desktop"),e=g.addParameterToQueryString(e,"utm_campaign","cmt")};var L=function(){f.checkAndProvidePermission([f.permissionFineLocation])["finally"](function(){e._loadActivitiesBookingLandingPage()})};L(),e.$on("$destroy",function(){c.onActivitiesIframeLoad=void 0,c.onActivitiesIframeError=void 0})}]),activitiesModule.run(["$templateCache",function(e){e.put("activities/templates/pages/ActivitiesView.html",'<ion-view debug-file-path="ActivitiesView.html"><ion-nav-title translate>activities.title.activities</ion-nav-title><ion-nav-buttons side="primary"><button class="icon button button-clear {{::refreshicon}}" name="activities_view_ion_nav_refresh_button" ng-click="refreshButtonClick()"></button></ion-nav-buttons><ion-content><div class="activitiesErrorContainer" ng-show="hideActivitiesFrame"><p><i class="icon icon-alert-tri-outline space-rt"></i><br>{{&apos;activities.error.iframeLoadingError&apos;|translate}}</p><button class="btn-small" name="activities_view_ion_content_refresh_button" ng-click="refreshButtonClick()" type="button"><i class="space-rt icon-refresh"></i> {{&apos;activities.button.refresh&apos;|translate}}</button></div><div class="iframe-container" ng-if="!(isIOSWebView || isAndroidWebView)"><iframe allow="geolocation *;" class="activitiesFrame" id="activitiesBookingFrame" ng-attr-scrolling="{{isIOSSafari ? &apos;no&apos; : &apos;auto&apos;}}" ng-class="{&apos;activitiesFrameHidden&apos;: hideActivitiesFrame}" ng-src="{{activitiesIframeUrl}}" onerror="if(window.onActivitiesIframeError) window.onActivitiesIframeError(event);" onload="if(window.onActivitiesIframeLoad) window.onActivitiesIframeLoad(event);"></iframe></div></ion-content></ion-view>')}]),window.ionPlaceToolsModule=angular.module("ion-place-tools",[]),ionPlaceToolsModule.directive("ionGooglePlaceAutocomplete",["$timeout",function(e){return{require:"?ngModel",restrict:"E",templateUrl:"ion-place-tools/directives/IonGooglePlaceTemplate.html",replace:!0,scope:{searchQuery:"=ngModel",locationChanged:"&",searchTypes:"="},link:function(t,n,i){var a=1;t.searchTypes=angular.isArray(t.searchTypes)?t.searchTypes:[],t.sessionToken=new google.maps.places.AutocompleteSessionToken;var r=function(e){t.locations=[],t.dropDownActive=!1,t.messageToDisplay=e};r(null);var o=document.getElementById("hidden-google-places-div"),s=new google.maps.places.PlacesService(o),l=new google.maps.places.AutocompleteService,c=null,d=function(){c&&e.cancel(c)};t.selectLocation=function(e){s.getDetails({placeId:e.place_id,fields:["address_component","adr_address","alt_id","formatted_address","geometry","id","name","place_id","scope","type","url","utc_offset","vicinity"],sessionToken:t.sessionToken},function(n,i){i===google.maps.places.PlacesServiceStatus.OK?(t.dropDownActive=!1,t.locationChanged&&t.locationChanged()({name:n.name,description:e.description,details:n})):console.warn("placesService.getDetails: something went wrong")})},t.closeKeyboard=function(){document.activeElement&&document.activeElement.blur()},t.$watch("searchQuery",function(n){n||(n=""),0===n.length?(d(),r(null)):n.length<a?(d(),r("etrMgmt.shared.text.autoCompleteNoResults")):(d(),c=e(function(){if(n){var e={input:n,sessionToken:t.sessionToken,types:void 0};t.searchTypes.length>0&&(e.types=t.searchTypes),l.getPlacePredictions(e,u)}},350))});var u=function(e,n){switch(n){case google.maps.places.PlacesServiceStatus.INVALID_REQUEST:case google.maps.places.PlacesServiceStatus.NOT_FOUND:case google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT:case google.maps.places.PlacesServiceStatus.REQUEST_DENIED:r("core.backendErrorCodes.000000");break;case google.maps.places.PlacesServiceStatus.UNKNOWN_ERROR:r("core.httpErrorCodes.0");break;case google.maps.places.PlacesServiceStatus.ZERO_RESULTS:r("etrMgmt.shared.text.autoCompleteNoResults");break;case google.maps.places.PlacesServiceStatus.OK:var i=e.filter(function(e){return"undefined"!=typeof e.place_id});i.length>0?(r(null),t.locations=i,t.dropDownActive=!0):r("etrMgmt.shared.text.autoCompleteNoResults")}t.$apply()};i.placeholder&&n.find("input").attr("placeholder",i.placeholder)}}}]),ionPlaceToolsModule.run(["$templateCache",function(e){e.put("ion-place-tools/directives/IonGooglePlaceTemplate.html",'<div debug-file-path="IonGooglePlaceTemplate.html"><div class="ion-place-tools-header"><div class="ion-place-tools-autocomplete item"><span class="input-wrap input-wrap-no-border input-wrap-with-icon"><input autocomplete="off" class="ion-place-tools-autocomplete-input" name="searchInput" ng-model="searchQuery" type="text"> <i class="icon-search-slim"></i></span></div></div><div class="ion-place-tools-autocomplete-suggestions" ng-if="dropDownActive"><ion-list on-touch="closeKeyboard()"><ion-item class="ion-place-tools-item" ng-click="selectLocation(location)" ng-repeat="location in locations"><div class="ion-place-tools-item--main">{{location.structured_formatting.main_text}}</div><div class="ion-place-tools-item--secondary">{{location.structured_formatting.secondary_text}}</div></ion-item></ion-list></div><div class="ion-place-tools-autocomplete-message" ng-if="messageToDisplay"><p translate>{{messageToDisplay}}</p></div></div>')}]),window.etrMgmtModule=angular.module("EtrMgmtModule",["ionic","ion-place-tools","CoreModule","CoreUiModule","ItmngtModule","AnalyticsModule"]),window.etrMgmtModule.run(["$log","EtrMgmtMenuHandler","EtrMgmtOrchestratorService",function(e,t,n){e=e.getInstance("EtrMgmt"),e.info("Module started"),t.init(),n.noop()}]),window.etrMgmtModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("etr-mgmt")}]),window.etrMgmtModule.routes={etrMgmtLanding:{cache:!0,url:"/etrMgmtLanding/:tripId?/:lastName?/:firstName?/",templateUrl:"etr-mgmt/templates/pages/EtrMgmtLandingView.html",controller:"EtrMgmtLandingController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Etr Management - Landing").promise()}]}},etrMgmtAir:{cache:!0,url:"/etrMgmtAir/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"etr-mgmt/templates/pages/EtrMgmtAirView.html",controller:"EtrMgmtAirController",defaultBackState:"etrMgmtLanding",secured:!0,resolve:{analytics:["AnalyticsService","$stateParams",function(e,t){return isDefined(t.refId)?e.screenView("Etr Management - Edit").promise():e.screenView("Etr Management - Air").promise()}]}},etrMgmtActivity:{cache:!0,url:"/etrMgmtActivity/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"etr-mgmt/templates/pages/EtrMgmtActivityView.html",controller:"EtrMgmtActivityController",defaultBackState:"etrMgmtLanding",secured:!0,resolve:{analytics:["AnalyticsService","$stateParams",function(e,t){return isDefined(t.refId)?e.screenView("Etr Management - Edit").promise():e.screenView("Etr Management - Activity").promise()}]},params:{prefillData:null}},etrMgmtCar:{cache:!0,url:"/etrMgmtCar/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"etr-mgmt/templates/pages/EtrMgmtCarView.html",controller:"EtrMgmtCarController",defaultBackState:"etrMgmtLanding",secured:!0,resolve:{analytics:["AnalyticsService","$stateParams",function(e,t){return isDefined(t.refId)?e.screenView("Etr Management - Edit").promise():e.screenView("Etr Management - Car").promise()}]}},etrMgmtHotel:{cache:!0,url:"/etrMgmtHotel/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"etr-mgmt/templates/pages/EtrMgmtHotelView.html",controller:"EtrMgmtHotelController",defaultBackState:"etrMgmtLanding",secured:!0,resolve:{analytics:["AnalyticsService","$stateParams",function(e,t){return isDefined(t.refId)?e.screenView("Etr Management - Edit").promise():e.screenView("Etr Management - Hotel").promise()}]}},etrMgmtMeeting:{cache:!0,url:"/etrMgmtMeeting/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"etr-mgmt/templates/pages/EtrMgmtMeetingView.html",controller:"EtrMgmtMeetingController",defaultBackState:"etrMgmtLanding",secured:!0,resolve:{analytics:["AnalyticsService","$stateParams",function(e,t){return isDefined(t.refId)?e.screenView("Etr Management - Edit").promise():e.screenView("Etr Management - Meeting").promise()}]}},etrMgmtTrain:{cache:!0,url:"/etrMgmtTrain/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"etr-mgmt/templates/pages/EtrMgmtTrainView.html",controller:"EtrMgmtTrainController",defaultBackState:"etrMgmtLanding",secured:!0,resolve:{analytics:["AnalyticsService","$stateParams",function(e,t){return isDefined(t.refId)?e.screenView("Etr Management - Edit").promise():e.screenView("Etr Management - Train").promise()}]}}},etrMgmtModule.controller("EtrMgmtController",["$log","$scope","$timeout","AuthenticationService","DateTimeService","EtrMgmtResponseHandler","EtrMgmtService","LayoutService","ParameterService","TripService",function(e,t,n,i,a,r,o,s,l,c){t.getMdwDateTimeObject=function(e){return a.createMdwDateTimeObject({datePart:t.inputs[e].date,timePart:t.inputs[e].time,offsetMinutes:parseInt(t.inputs[e].timezoneOffset,10)})},t.prefillSegmentData=function(e){t.mapToGenericSegment&&t.mapToGenericSegment(e),t.disableSaveButton=!0,t.inputs.carDescription=e.carDescription,t.inputs.confirmationNumber=e.confirmationNumber||e.reservationNumber,t.inputs.description=e.description,t.inputs.provider=e.company?e.company.name:null,t.inputs.title=e.title;var i=a.convertBackendDateToInputDate(e.startDate);t.inputs.start={date:i,time:i};var r=a.convertBackendDateToInputDate(e.endDate);t.inputs.end={date:r,time:r},isIE()?n(function(){t.inputs.start.timezoneOffset=String(e.startDate.offsetMinutes),t.inputs.end.timezoneOffset=String(e.endDate.offsetMinutes)},100):(t.inputs.start.timezoneOffset=String(e.startDate.offsetMinutes),t.inputs.end.timezoneOffset=String(e.endDate.offsetMinutes)),t.hasLocationRange?(e.fromLocation&&(t.inputs.fromLocation=o.getGooglePlaceDirectiveLocationObject(e,"fromLocation")),e.toLocation&&(t.inputs.toLocation=o.getGooglePlaceDirectiveLocationObject(e,"toLocation"))):e.location&&(t.inputs.location=o.getGooglePlaceDirectiveLocationObject(e,"location"))},t.saveSegment=function(){if(t.forms.etrForm.$valid){var n=t.getInputs();s.loading(!0);var i=t.getSaveAction();i(n,t.lastName,t.tripId,t.refId).then(function(e){s.loading(!1);var n=safeAccess(e,"data.trip"),i=c.getSegmentFromTrip(n,t.refId);r.handleSuccessfulCall({
type:t.segmentType,currentTripId:t.tripId,newTrip:n,newSegment:i,update:t.isEditMode})},function(e){s.loading(!1),s.toastError(e)})}else e.warn("Validation did not succeed, can not process with saving meeting")},t.forms={etrForm:{}},t.initialize=function(){var e=(-(new Date).getTimezoneOffset()).toString(),a=moment("12:00","HH:mm"),r=moment("12:00","HH:mm").add(t.enddateOffset.number,t.enddateOffset.unit),c=l.safeGetStateParam("prefillData");t.tripId=l.safeGetStateParam("tripId"),t.refId=l.safeGetStateParam("refId"),t.lastName=l.safeGetStateParam("lastName"),(isUndefined(t.lastName)||isUndefined(t.refId))&&(t.lastName=safeAccess(i.getUser(),"lastName")),isDefined(t.tripId)&&isDefined(t.refId)&&(t.isEditMode=!0),t.config={timezonesList:o.getTimezonesList(),defaultStartDate:a.toDate(),defaultEndDate:r.toDate()},t.defaultFormData={title:void 0,datesValid:!0,start:{date:a.toDate(),time:a.toDate(),timezoneOffset:e},end:{date:r.toDate(),time:r.toDate(),timezoneOffset:e},confirmationNumber:void 0,description:void 0,location:void 0,fromLocation:void 0,toLocation:void 0,carDescription:void 0,provider:void 0,useSameLocation:!t.isEditMode},t.disableSaveButton=!1,t.inputs={location:{amadeusLocation:{}}},t.isEditMode?(t.inputs=t.defaultFormData,s.startLoading(),o.getSegmentFromTrip(t.tripId,t.refId,t.lastName).then(function(e){t.prefillSegmentData(e),n(g,200),s.stopLoading()},function(e){s.stopLoading(),s.toastError(e)})):n(function(){t.inputs=t.defaultFormData,c&&(t.prefillSegmentData(c),t.disableSaveButton=!1)},100);var d,u=function(e,n){angular.equals(e,n)||(t.disableSaveButton=!1,isDefined(d)&&d())},g=function(){d=t.$watch("inputs",function(e,t){u(e,t)},!0)}},t.$on("$ionicView.afterEnter",function(){t.hasLocationRange===!0?(t.$watch("inputs.fromLocation",function(e,n){if(!angular.equals(e,n)){var i=safeAccess(e,"utc_offset");isDefined(i)&&(t.inputs.start.timezoneOffset=String(i),t.inputs.useSameLocation&&(t.inputs.end.timezoneOffset=String(i))),t.inputs.useSameLocation&&(t.inputs.toLocation=e)}}),t.$watch("inputs.toLocation",function(e,n){if(!angular.equals(e,n)){var i=safeAccess(e,"utc_offset");isDefined(i)&&(t.inputs.end.timezoneOffset=String(i))}}),t.$watch("inputs.useSameLocation",function(e,n){angular.equals(e,n)||e&&(t.inputs.toLocation=t.inputs.fromLocation,t.inputs.end.timezoneOffset=t.inputs.start.timezoneOffset)})):(t.$watch("inputs.start.timezoneOffset",function(e,n){isDefined(e)&&e!==n&&(t.inputs.end.timezoneOffset=e)}),t.$watch("inputs.location",function(e,n){if(!angular.equals(e,n)){var i=safeAccess(e,"utc_offset");isDefined(i)&&(t.inputs.start.timezoneOffset=String(i),t.inputs.end.timezoneOffset=String(i))}}))})}]),etrMgmtModule.controller("EtrMgmtCarController",["$controller","$scope","$log","EtrMgmtCarService",function(e,t,n,i){n=n.getInstance("EtrMgmtCarController"),n.info("Controller Started..."),e("EtrMgmtController",{$log:n,$scope:t}),t.segmentType="car",t.hasLocationRange=!0,t.enddateOffset={number:1,unit:"d"},t.getSaveAction=function(){return t.isEditMode?i.updateCarSegment:i.createCarSegment},t.getInputs=function(){var e=t.getMdwDateTimeObject("start"),n=t.getMdwDateTimeObject("end"),i={provider:{code:null,name:t.inputs.provider},pickupLocation:t.inputs.fromLocation.amadeusLocation,pickupDateTime:e,vehicleInformation:{code:null,description:t.inputs.carDescription},description:t.inputs.description||null,dropoffLocation:t.inputs.toLocation.amadeusLocation,dropoffDateTime:n,confirmationNumber:t.inputs.confirmationNumber||null};return i},t.mapToGenericSegment=function(e){e.startDate=e.pickupDateTime,e.endDate=e.dropoffDateTime,e.fromLocation=e.pickupLocation,e.toLocation=e.dropoffLocation},t.$on("$ionicView.beforeEnter",function(){t.initialize()})}]),etrMgmtModule.controller("EtrMgmtAirController",["$scope","$rootScope","$log","$stateParams","EtrMgmtService","$ionicModal","LayoutService","I18nService","EtrMgmtResponseHandler","ParameterService","DateTimeService","TripService","AuthenticationService","$timeout","$q","EtrMgmtAirService","OrchestratorChiefService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v){n=n.getInstance("EtrMgmtAirController"),n.info("Controller Started...");var h=c.safeGetStateParam("tripId"),S=c.safeGetStateParam("refId"),C=c.safeGetStateParam("lastName");(isUndefined(C)||isUndefined(S))&&(C=safeAccess(g.getUser(),"lastName")),isDefined(h)&&isDefined(S)&&(e.isEditMode=!0,o.startLoading(),a.getSegmentFromTrip(h,S,C).then(function(t){e.prefillSegmentData(t),p(T,200),o.stopLoading()},function(e){o.stopLoading(),o.toastError(e)})),e.$on("$ionicView.beforeEnter",function(){isDefined(h)||isDefined(S)||e.initialize()}),e._selectRouteModalScope=null,e.forms={airForm:{}},e.initialize=function(){e.airInputs={flightNumber:void 0,departure:{date:moment().toDate()},confirmationNumber:void 0,description:void 0},e.selectedFlightRoute=null,e.disableSaveButton=!1},e.prefillSegmentData=function(t){e.disableSaveButton=!0,e.airInputs.flightNumber=t.flight.airlineCode+t.flight.flightNumber,e.airInputs.departure.date=d.convertBackendDateToInputDate(t.startDate),e.airInputs.confirmationNumber=t.confirmationNumber,e.selectedFlightRoute={start:{dateTime:t.startDate,location:t.fromLocation},end:{dateTime:t.endDate,location:t.toLocation}}};var T=function(){var t=e.$watch("airInputs",function(n,i){angular.equals(n,i)||(e.disableSaveButton=!1,isDefined(t)&&t())},!0)};e.selectFlightRoute=function(){var n=m.defer();if(e.airInputs.flightNumber&&e.airInputs.departure.date){o.loading(!0);var i=d.createMdwDateTimeObject({datePart:e.airInputs.departure.date,timePart:null,offsetMinutes:null}),a={flightNumber:e.airInputs.flightNumber,departureDateTime:i};f.getRoutesForFlight(a).then(function(i){o.loading(!1);var a=safeAccess(i,"data.routes",[]);0===a.length?n.reject("etrMgmt.air.text.noFlightForThisInput"):1===a.length?(e.selectedFlightRoute=a[0],n.resolve(e.selectedFlightRoute)):(e._selectRouteModalScope=t.$new(),r.fromTemplateUrl("addEtrFlightRoutes.html",{scope:e._selectRouteModalScope,hardwareBackButtonClose:!1}).then(function(t){e._selectRouteModalScope.flightRoutes=a,e._selectRouteModalScope.disableConfirm=!0,e._selectRouteModalScope.selectRoute=function(t){e._selectRouteModalScope.selectedRoute=t,e._selectRouteModalScope.disableConfirm=!1},e._selectRouteModalScope.confirmRoute=function(){e.selectedFlightRoute=e._selectRouteModalScope.selectedRoute,o.removeModal(t).then(function(){e._selectRouteModalScope=null,v.unregisterNavigateBackFromModal(),n.resolve(e.selectedFlightRoute)})},o.showModal(t),v.registerNavigateBackFromModal()}))},function(e){o.loading(!1),n.reject(e)})}else n.reject("etrMgmt.air.text.noFlightForThisInput");return n.promise},e.saveAirSegment=function(){e.airInputs.flightNumber&&(e.airInputs.flightNumber=e.airInputs.flightNumber.toUpperCase()),e.forms.airForm.$valid?e.selectFlightRoute().then(function(t){o.loading(!0);var n={flightNumber:e.airInputs.flightNumber,confirmationNumber:e.airInputs.confirmationNumber,description:e.airInputs.description,routeForFlight:e.selectedFlightRoute},i=f.createAirSegment;e.isEditMode&&(i=f.updateAirSegment),i(n,C,h,S).then(function(t){o.loading(!1);var n=safeAccess(t,"data.trip"),i=u.getTripById(h),a=isDefined(S)?u.getSegmentFromTrip(n,S):u.getTripSegmentDiff(n,i);a=safeAccess(a,"length",0)>0?a[0]:a,l.handleSuccessfulCall({currentTripId:h,type:"air",newTrip:n,newSegment:a,update:e.isEditMode})},function(e){o.loading(!1),o.toastError(e)})},function(e){o.toastError(e)}):n.warn("Validation did not succeed, can not process with saving air")},e.initialize()}]),etrMgmtModule.controller("EtrMgmtActivityController",["$controller","$scope","$log","EtrMgmtActivityService",function(e,t,n,i){n=n.getInstance("EtrMgmtActivityController"),n.info("Controller Started..."),e("EtrMgmtController",{$log:n,$scope:t}),t.segmentType="activity",t.hasLocationRange=!1,t.enddateOffset={number:1,unit:"h"},t.getSaveAction=function(){return t.isEditMode?i.updateActivitySegment:i.createActivitySegment},t.getInputs=function(){var e=t.getMdwDateTimeObject("start"),n=t.getMdwDateTimeObject("end"),i={title:t.inputs.title,location:t.inputs.location.amadeusLocation,startDateTime:e,endDateTime:n,confirmationNumber:t.inputs.confirmationNumber,description:t.inputs.description};return i},t.mapToGenericSegment=function(e){e.location=e.fromLocation},t.$on("$ionicView.beforeEnter",function(){t.initialize()})}]),etrMgmtModule.controller("EtrMgmtHotelController",["$controller","$log","$scope","EtrMgmtHotelService",function(e,t,n,i){t=t.getInstance("EtrMgmtHotelController"),t.info("Controller Started..."),e("EtrMgmtController",{$log:t,$scope:n}),n.segmentType="hotel",n.hasLocationRange=!1,n.enddateOffset={number:1,unit:"d"},n.getSaveAction=function(){return n.isEditMode?i.updateHotelSegment:i.createHotelSegment},n.getInputs=function(){var e=n.getMdwDateTimeObject("start"),t=n.getMdwDateTimeObject("end"),i={hotelName:n.inputs.location.name,location:n.inputs.location.amadeusLocation,checkInDateTime:e,checkOutDateTime:t,confirmationNumber:n.inputs.confirmationNumber,description:n.inputs.description};return i},n.mapToGenericSegment=function(e){e.startDate=e.checkin,e.endDate=e.checkout},n.$on("$ionicView.beforeEnter",function(){n.initialize()})}]),etrMgmtModule.controller("EtrMgmtMeetingController",["$controller","$log","$scope","EtrMgmtMeetingService",function(e,t,n,i){t=t.getInstance("EtrMgmtMeetingController"),t.info("Controller Started..."),e("EtrMgmtController",{$log:t,$scope:n}),n.segmentType="meeting",n.hasLocationRange=!1,n.enddateOffset={number:1,unit:"h"},n.getSaveAction=function(){return n.isEditMode?i.updateMeetingSegment:i.createMeetingSegment},n.getInputs=function(){var e=n.getMdwDateTimeObject("start"),t=n.getMdwDateTimeObject("end"),i={title:n.inputs.title,location:n.inputs.location.amadeusLocation,startDateTime:e,endDateTime:t,confirmationNumber:n.inputs.confirmationNumber,description:n.inputs.description};return i},n.$on("$ionicView.beforeEnter",function(){n.initialize()})}]),etrMgmtModule.controller("EtrMgmtTrainController",["$controller","$scope","$log","EtrMgmtTrainService",function(e,t,n,i){n=n.getInstance("EtrMgmtTrainController"),n.info("Controller Started..."),e("EtrMgmtController",{$log:n,$scope:t}),t.segmentType="train",t.hasLocationRange=!0,t.enddateOffset={number:1,unit:"h"},t.getSaveAction=function(){return t.isEditMode?i.updateTrainSegment:i.createTrainSegment},t.getInputs=function(){var e=t.getMdwDateTimeObject("start"),n=t.getMdwDateTimeObject("end"),i={departureLocation:t.inputs.fromLocation.amadeusLocation,arrivalLocation:t.inputs.toLocation.amadeusLocation,arrivalDateTime:n,departureDateTime:e,confirmationNumber:t.inputs.confirmationNumber,description:t.inputs.description};return i},t.$on("$ionicView.beforeEnter",function(){t.initialize()})}]),etrMgmtModule.controller("EtrMgmtLandingController",["$scope","$log","OrchestratorChiefService","EtrMgmtService","$stateParams","AnalyticsService",function(e,t,n,i,a,r){t=t.getInstance("EtrMgmtLandingController"),t.info("Controller Started..."),e._initFlags=function(){e.airEnabled=i.hasAirEnabled(),e.hotelEnabled=i.hasHotelEnabled(),e.carEnabled=i.hasCarEnabled(),e.trainEnabled=i.hasTrainEnabled(),e.meetingEnabled=i.hasMeetingEnabled(),e.activityEnabled=i.hasActivityEnabled()},e._initFlags(),e["goto"]=function(e){var t={tripId:a.tripId,lastName:a.lastName,firstName:a.firstName};isDefined(t.tripId)?r.screenView("Etr Management - Create Segment"):r.screenView("Etr Management - Create Trip"),n.navigateTo(e,t)}}]),etrMgmtModule.controller("EtrMgmtDeleteController",["$scope","$log","EtrMgmtService","LayoutService","I18nService","EtrMgmtResponseHandler","ParameterService","AuthenticationService","TripService","EtrMgmtAnalyticsService",function(e,t,n,i,a,r,o,s,l,c){t=t.getInstance("EtrMgmtDeleteController"),t.info("Controller Started...");var d=o.safeGetStateParam("tripId"),u=o.safeGetStateParam("refId"),g=o.safeGetStateParam("lastName");isUndefined(g)&&(g=safeAccess(s.getUser(),"lastName")),e.deleteSegment=function(e){var t=["etrMgmt."+e+".title.delete","etrMgmt."+e+".text.deleteConfirmation","etrMgmt.shared.button.delete","etrMgmt.shared.button.cancel"];a.translate(t).then(function(a){i.showConfirmPopup(a[t[0]],a[t[1]],a[t[2]],a[t[3]]).then(function(){i.loading(!0);var t,a=l.getTripById(d);isDefined(a)&&(t=l.getSegmentFromTrip(a,u)),n.deleteSegment({tripId:d,refId:u,lastName:g}).then(function(n){i.loading(!1);var o=safeAccess(n,"data.trip");isDefined(d)&&isDefined(a)&&isDefined(t)&&(isDefined(o)?c.deleteSegmentCompleted(a,t):c.deleteLastSegmentCompleted(a,t)),r.handleSuccessfulCall({type:e,currentTripId:d,newTrip:o,newSegment:null,remove:!0})},function(e){i.loading(!1),i.toastError(e)})})})}}]),etrMgmtModule.service("EtrMgmtMenuHandler",["$log","MenuService","EtrMgmtService","OrchestratorChiefService","NetworkService","$stateParams","LayoutService","AuthenticationService","TripService","SegmentService",function(e,t,n,i,a,r,o,s,l,c){e=e.getInstance("EtrMgmtMenuHandler"),e.info("Handler Started...");var d={init:function(){t.addItem({icon:"icon-add-item",name:"createTrip",label:"etrMgmt.shared.label.addTripManuallyMenuItem",condition:function(e){return n.hasEtrCreationEnabled()&&isDefined(e)&&isUndefined(e.tripId)&&s.isLogged()}}).then(function(e){e.onClick(function(e){a.hasConnectivity(!0).isOnline&&i.next({etrCreation:!0})})}),t.addItem({icon:"icon-add-item",name:"addSegment",label:"etrMgmt.shared.label.addSegmentManuallyMenuItem",condition:function(e){return n.hasEtrCreationEnabled()&&isDefined(e)&&isDefined(e.tripId)&&!l.isPastTrip(e,moment(),"24h")&&!l.isReadOnly(e)&&s.isLogged()}}).then(function(e){e.onClick(function(e){e.numberOfAssociatedRecords<e.maxNumberOfAssociatedRecords?a.hasConnectivity(!0).isOnline&&i.next({etrCreation:!0,tripId:e.tripId,lastName:r.lastName,firstName:r.firstName}):o.toastError("etrMgmt.shared.text.maxNumberOfItemsReached")})}),t.addItem({icon:"icon-edit",name:"editSegment",label:"etrMgmt.shared.label.editSegmentMenuItem",condition:function(e){return n.hasEtrEditionEnabled()&&isDefined(e)&&n.hasEtrEnabledForSegmentType(e.type)&&isDefined(r.tripId)&&isDefined(e.refId)&&safeAccess(e,"manuallyCreated",!1)&&!c.isPastSegment(e,moment(),"24h")&&!e.isReadOnly&&s.isLogged()}}).then(function(e){e.onClick(function(e){a.hasConnectivity(!0).isOnline&&i.next({etrEdition:!0,tripId:r.tripId,lastName:r.lastName,segment:e})})})}};return d}]),etrMgmtModule.service("EtrMgmtResponseHandler",["$log","I18nService","OrchestratorChiefService","LayoutService","TriplistService","$ionicHistory","TripService","EtrMgmtAnalyticsService",function(e,t,n,i,a,r,o,s){e=e.getInstance("EtrMgmtResponseHandler"),e.info("Handler Started...");var l={handleSuccessfulCall:function(e){var t={tripId:null,lastName:null,firstName:null};a.refreshTriplistOnNextDisplay(),isDefined(e.currentTripId)&&isDefined(e.newTrip)&&isDefined(e.newTrip.bookingLastName)&&(t={tripId:e.newTrip.tripId,lastName:e.newTrip.bookingLastName,firstName:e.newTrip.bookingFirstName},e.currentTripId===e.newTrip.tripId&&o.refreshTripOnNextDisplay(e.newTrip.tripId)),r.nextViewOptions({disableBack:!1,historyRoot:!0}),r.clearCache();var i;e.update?(i="updateSegment",s.editSegmentCompleted(e.newTrip,e.newSegment)):e.remove?i="removeSegment":isDefined(e.currentTripId)?(i="addSegment",s.newSegmentCompleted(e.newTrip,e.newSegment)):(i="createTrip",s.newTripCompleted(e.newTrip));var l=isDefined(e.newTrip)?e.newTrip:null;"createTrip"==i&&l&&(t={tripId:l.tripId,lastName:l.bookingLastName,firstName:l.bookingFirstName},o.refreshTripOnNextDisplay(t.tripId)),n.next({etrMgmtTripSelected:t,etrMgmtTripOutput:l,etrMgmtAction:i})},toString:function(){return"EtrMgmtResponseHandler"}};return l}]),etrMgmtModule.service("EtrMgmtService",["$log","$q","RequestService","PromiseService","TripService","TriplistCacheService",function(e,t,n,i,a,r){e=e.getInstance("EtrMgmtService"),e.info("Service Started...");var o={DELETE_SEGMENT_URL_PATH:"v1/trips/deleteSegment",getGooglePlaceDirectiveLocationObject:function(e,t,n){var i=safeAccess(e,t,{}),a=[i.addressLine1,i.cityName,i.countryName];return a=a.filter(function(e){return isDefined(e)&&""!==e.trim()}),{name:a.join(", "),amadeusLocation:i}},deleteSegment:function(e){e=isDefined(e)?e:{};var t=n.post(o.DELETE_SEGMENT_URL_PATH,e);return i.processMdwSuccessOrError(t,"deleteSegment")},hasAirEnabled:function(){return getContext("featureConfig.manualEtrManagement.segments.airEnabled",!1)},hasHotelEnabled:function(){return getContext("featureConfig.manualEtrManagement.segments.hotelEnabled",!1)},hasCarEnabled:function(){return getContext("featureConfig.manualEtrManagement.segments.carEnabled",!1)},hasTrainEnabled:function(){return getContext("featureConfig.manualEtrManagement.segments.trainEnabled",!1)},hasMeetingEnabled:function(){return getContext("featureConfig.manualEtrManagement.segments.meetingEnabled",!1)},hasActivityEnabled:function(){return getContext("featureConfig.manualEtrManagement.segments.activityEnabled",!1)},hasEtrManagementEnabled:function(){return getContext("featureConfig.manualEtrManagement.enabled",!1)},hasEtrCreationEnabled:function(){return o.hasEtrManagementEnabled()&&(o.hasAirEnabled()||o.hasHotelEnabled()||o.hasCarEnabled()||o.hasTrainEnabled()||o.hasMeetingEnabled()||o.hasActivityEnabled())},hasEtrEditionEnabled:function(){return o.hasEtrManagementEnabled()&&getContext("featureConfig.manualEtrManagement.editEnabled",!1)},hasEtrEnabledForSegmentType:function(e){if(isDefined(e)){var t="featureConfig.manualEtrManagement.segments."+e.toLowerCase()+"Enabled";return getContext(t,!1)}return!1},getTimezonesList:function(){for(var e=[],t=-720;840>=t;t+=30){var n="UTC"+o._offsetInMinutesToHHMM(t);e.push({value:t,text:n})}return e},_offsetInMinutesToHHMM:function(e){var t=e>=0?"+":"-";e=Math.abs(e);var n=e%60,i=(e-n)/60;return t+""+o._leftZeroPadTwoDigits(i)+":"+o._leftZeroPadTwoDigits(n)},_leftZeroPadTwoDigits:function(e){var t=e.toString();return t.length<2&&(t="0"+t),t},getSegmentFromTrip:function(e,n,i){var r=t.defer();return a.retrieveTrip(e,i,{forceFromServer:getContext("isWebIntegration",!1)}).then(function(e){r.resolve(a.getSegmentFromTrip(e,n))},function(e){r.reject(e)}),r.promise},toString:function(){return"EtrMgmtService"}};return o}]),etrMgmtModule.service("EtrMgmtHotelService",["$log","$q","RequestService","PromiseService",function(e,t,n,i){e=e.getInstance("EtrMgmtHotelService"),e.info("Service Started...");var a={CREATE_HOTEL_URL_PATH:"v1/trips/createHotel",UPDATE_HOTEL_URL_PATH:"v1/trips/updateHotel",createHotelSegment:function(t,n,i){return t.description||delete t.description,t.confirmationNumber||delete t.confirmationNumber,e.returns(a._saveHotelSegment({inputs:t,lastName:n,tripId:i,endpoint:a.CREATE_HOTEL_URL_PATH,callerMethodName:"createHotelSegment"}))},updateHotelSegment:function(t,n,i,r){return t.confirmationNumber||(t.confirmationNumber=""),t.description||(t.description=""),e.returns(a._saveHotelSegment({inputs:t,lastName:n,tripId:i,refId:r,endpoint:a.UPDATE_HOTEL_URL_PATH,callerMethodName:"updateHotelSegment"}))},_saveHotelSegment:function(e){var t=e.inputs,a={lastName:e.lastName,tripId:e.tripId,refId:e.refId,hotelName:t.hotelName,location:t.location,checkinDateTime:t.checkInDateTime,checkoutDateTime:t.checkOutDateTime,confirmationNumber:t.confirmationNumber,description:t.description};delete a.location.imageSet,delete a.location.stateName,delete a.location.currencyCode,delete a.location.currencyName;var r=n.post(e.endpoint,a);return i.processMdwSuccessOrError(r,e.callerMethodName)},toString:function(){return"EtrMgmtHotelService"}};return a}]),etrMgmtModule.service("EtrMgmtMeetingService",["$log","$q","RequestService","PromiseService",function(e,t,n,i){e=e.getInstance("EtrMgmtMeetingService"),e.info("Service Started...");var a={CREATE_MEETING_URL_PATH:"v1/trips/createMeeting",UPDATE_MEETING_URL_PATH:"v1/trips/updateMeeting",createMeetingSegment:function(t,n,i){return t.description||delete t.description,t.confirmationNumber||delete t.confirmationNumber,e.returns(a._saveMeetingSegment({inputs:t,lastName:n,tripId:i,endpoint:a.CREATE_MEETING_URL_PATH,callerMethodName:"createMeetingSegment"}))},updateMeetingSegment:function(t,n,i,r){return t.confirmationNumber||(t.confirmationNumber=""),t.description||(t.description=""),e.returns(a._saveMeetingSegment({inputs:t,lastName:n,tripId:i,refId:r,endpoint:a.UPDATE_MEETING_URL_PATH,callerMethodName:"updateMeetingSegment"}))},_saveMeetingSegment:function(e){var t=e.inputs,a={lastName:e.lastName,tripId:e.tripId,refId:e.refId,title:t.title,location:t.location,startDate:t.startDateTime,endDate:t.endDateTime,confirmationNumber:t.confirmationNumber,description:t.description};delete a.location.imageSet,delete a.location.stateName,delete a.location.currencyCode,delete a.location.currencyName;var r=n.post(e.endpoint,a);return i.processMdwSuccessOrError(r,e.callerMethodName)},toString:function(){return"EtrMgmtMeetingService"}};return a}]),etrMgmtModule.service("EtrMgmtAirService",["$log","$q","RequestService","PromiseService","MenuService","OrchestratorChiefService","NetworkService","GooglePlaceService","TripService","TriplistCacheService","FLIGHT_NUMBER_REGEX",function(e,t,n,i,a,r,o,s,l,c,d){e=e.getInstance("EtrMgmtAirService"),e.info("Service Started...");var u={CREATE_AIR_URL_PATH:"v1/trips/createAir",UPDATE_AIR_URL_PATH:"v1/trips/updateAir",GET_ROUTE_FOR_FLIGHT_URL_PATH:"v1/trips/getRoutesForFlight",createAirSegment:function(t,n,i){return t.description||delete t.description,t.confirmationNumber||delete t.confirmationNumber,e.returns(u._saveAirSegment({inputs:t,lastName:n,tripId:i,endpoint:u.CREATE_AIR_URL_PATH,callerMethodName:"createAirSegment"}))},updateAirSegment:function(t,n,i,a){return t.description||delete t.description,t.confirmationNumber||delete t.confirmationNumber,e.returns(u._saveAirSegment({inputs:t,lastName:n,tripId:i,refId:a,endpoint:u.UPDATE_AIR_URL_PATH,callerMethodName:"updateAirSegment"}))},_saveAirSegment:function(e){var t=u._splitFlightNumber(e.inputs.flightNumber),a={lastName:e.lastName,airline:{code:t.airlineCode},flightNumber:t.flightNumber,startDate:e.inputs.routeForFlight.start.dateTime,endDate:e.inputs.routeForFlight.end.dateTime,fromLocation:e.inputs.routeForFlight.start.location,toLocation:e.inputs.routeForFlight.end.location,confirmationNumber:e.inputs.confirmationNumber,tripId:e.tripId,refId:e.refId};delete a.fromLocation.imageSet,delete a.fromLocation.stateName,delete a.toLocation.imageSet,delete a.toLocation.stateName;var r=n.post(e.endpoint,a);return i.processMdwSuccessOrError(r,e.callerMethodName)},getRoutesForFlight:function(e){var t=u._splitFlightNumber(e.flightNumber),a={flightNumber:t.flightNumber,airline:t.airlineCode,departureDateTime:e.departureDateTime},r=n.post(u.GET_ROUTE_FOR_FLIGHT_URL_PATH,a);return i.processMdwSuccessOrError(r,"getRouteForFlight")},_splitFlightNumber:function(e){var t=d,n=e.split(t),i={flightNumber:null,airlineCode:null};return n.length>2&&(i.airlineCode=n[1],i.flightNumber=parseInt(n[2],10).toString()),i},toString:function(){return"EtrMgmtAirService"}};return u}]),etrMgmtModule.service("EtrMgmtActivityService",["$log","$q","RequestService","PromiseService",function(e,t,n,i){e=e.getInstance("EtrMgmtActivityService"),e.info("Service Started...");var a={CREATE_ACTIVITY_URL_PATH:"v1/trips/createActivity",UPDATE_ACTIVITY_URL_PATH:"v1/trips/updateActivity",createActivitySegment:function(t,n,i){return t.description||delete t.description,t.confirmationNumber||delete t.confirmationNumber,e.returns(a._saveSegment({inputs:t,lastName:n,tripId:i,endpoint:a.CREATE_ACTIVITY_URL_PATH,callerMethodName:"createActivitySegment"}))},updateActivitySegment:function(t,n,i,r){return t.confirmationNumber||(t.confirmationNumber=""),t.description||(t.description=""),e.returns(a._saveSegment({inputs:t,lastName:n,tripId:i,refId:r,endpoint:a.UPDATE_ACTIVITY_URL_PATH,callerMethodName:"updateActivitySegment"}))},_saveSegment:function(e){var t=e.inputs,a={lastName:e.lastName,tripId:e.tripId,refId:e.refId,title:t.title,location:t.location,startDate:t.startDateTime,endDate:t.endDateTime,confirmationNumber:t.confirmationNumber,description:t.description};delete a.location.imageSet,delete a.location.stateName,delete a.location.currencyCode,delete a.location.currencyName;var r=n.post(e.endpoint,a);return i.processMdwSuccessOrError(r,e.callerMethodName)},toString:function(){return"EtrMgmtActivityService"}};return a}]),etrMgmtModule.service("EtrMgmtTrainService",["$log","$q","RequestService","PromiseService",function(e,t,n,i){e=e.getInstance("EtrMgmtTrainService"),e.info("Service Started...");var a={CREATE_TRAIN_URL_PATH:"v1/trips/createTrain",UPDATE_TRAIN_URL_PATH:"v1/trips/updateTrain",createTrainSegment:function(t,n,i){return t.description||delete t.description,t.confirmationNumber||delete t.confirmationNumber,e.returns(a._saveTrainSegment({inputs:t,lastName:n,tripId:i,endpoint:a.CREATE_TRAIN_URL_PATH,callerMethodName:"createTrainSegment"}))},updateTrainSegment:function(t,n,i,r){return t.confirmationNumber||(t.confirmationNumber=""),t.description||(t.description=""),e.returns(a._saveTrainSegment({inputs:t,lastName:n,tripId:i,refId:r,endpoint:a.UPDATE_TRAIN_URL_PATH,callerMethodName:"updateTrainSegment"}))},_saveTrainSegment:function(e){var t=e.inputs,a={lastName:e.lastName,tripId:e.tripId,refId:e.refId,fromLocation:t.departureLocation,toLocation:t.arrivalLocation,startDate:t.departureDateTime,endDate:t.arrivalDateTime,confirmationNumber:t.confirmationNumber};delete a.fromLocation.imageSet,delete a.fromLocation.stateName,delete a.fromLocation.currencyCode,delete a.fromLocation.currencyName,delete a.toLocation.imageSet,delete a.toLocation.stateName,delete a.toLocation.currencyCode,delete a.toLocation.currencyName;var r=n.post(e.endpoint,a);return i.processMdwSuccessOrError(r,e.callerMethodName)},toString:function(){return"EtrMgmtTrainService"}};return a}]),etrMgmtModule.service("EtrMgmtCarService",["$log","$q","RequestService","PromiseService",function(e,t,n,i){e=e.getInstance("EtrMgmtCarService"),e.info("Service Started...");var a={CREATE_CAR_URL_PATH:"v1/trips/createCar",UPDATE_CAR_URL_PATH:"v1/trips/updateCar",createCarSegment:function(t,n,i){return t.description||delete t.description,t.confirmationNumber||delete t.confirmationNumber,e.returns(a._saveCarSegment({inputs:t,lastName:n,tripId:i,endpoint:a.CREATE_CAR_URL_PATH,callerMethodName:"createCarSegment"}))},updateCarSegment:function(t,n,i,r){return t.confirmationNumber||(t.confirmationNumber=""),e.returns(a._saveCarSegment({inputs:t,lastName:n,tripId:i,refId:r,endpoint:a.UPDATE_CAR_URL_PATH,callerMethodName:"updateCarSegment"}))},_saveCarSegment:function(e){var t=e.inputs,a={lastName:e.lastName,tripId:e.tripId,refId:e.refId,provider:t.provider,pickupLocation:t.pickupLocation,pickupDateTime:t.pickupDateTime,vehicleInformation:t.vehicleInformation,description:t.description,dropoffLocation:t.dropoffLocation,dropoffDateTime:t.dropoffDateTime,confirmationNumber:t.confirmationNumber};delete a.pickupLocation.imageSet,delete a.pickupLocation.stateName,delete a.pickupLocation.currencyCode,delete a.pickupLocation.currencyName,delete a.dropoffLocation.imageSet,delete a.dropoffLocation.stateName,delete a.dropoffLocation.currencyCode,delete a.dropoffLocation.currencyName;var r=n.post(e.endpoint,a);return i.processMdwSuccessOrError(r,e.callerMethodName)},toString:function(){return"EtrMgmtCarService"}};return a}]),etrMgmtModule.service("EtrMgmtAnalyticsService",["$log","$q","TripAnalyticsService","AnalyticsService",function(e,t,n,i){e=e.getInstance("EtrMgmtAnalyticsService"),e.info("Service Started...");var a={CATEGORY:"Trip",EVENTS:{newTripCompleted:"Etr Management new trip completed",newSegmentCompleted:"Etr Management new segment completed",editSegmentCompleted:"Etr Management edit segment completed",deleteSegmentCompleted:"Etr Management delete segment completed",deleteLastSegmentCompleted:"Etr Management delete last segment completed"},newTripCompleted:function(e){i.runSafe(function(){var t=i.getPropertiesFactory();this.sendEvent(a.EVENTS.newTripCompleted,i.extendDefaultParameterWith(n.getTripProperties(e),t.build()),a.CATEGORY)})},newSegmentCompleted:function(e,t){i.runSafe(function(){var r=i.getPropertiesFactory();this.sendEvent(a.EVENTS.newSegmentCompleted,i.extendDefaultParameterWith(n.getTripProperties(e),n.getSegmentProperties(t),r.build()),a.CATEGORY)})},editSegmentCompleted:function(e,t){i.runSafe(function(){var r=i.getPropertiesFactory();this.sendEvent(a.EVENTS.editSegmentCompleted,i.extendDefaultParameterWith(n.getTripProperties(e),n.getSegmentProperties(t),r.build()),a.CATEGORY)})},deleteSegmentCompleted:function(e,t){i.runSafe(function(){var r=i.getPropertiesFactory();this.sendEvent(a.EVENTS.deleteSegmentCompleted,i.extendDefaultParameterWith(n.getTripProperties(e),n.getSegmentProperties(t),r.build()),a.CATEGORY)})},deleteLastSegmentCompleted:function(e,t){i.runSafe(function(){var r=i.getPropertiesFactory();this.sendEvent(a.EVENTS.deleteLastSegmentCompleted,i.extendDefaultParameterWith(n.getTripProperties(e),n.getSegmentProperties(t),r.build()),a.CATEGORY)})},toString:function(){return"EtrMgmtAnalyticsService"}};return a}]),etrMgmtModule.service("EtrMgmtOrchestratorService",["$log","OrchestratorChiefService","StringService","$q",function(e,t,n,i){e=e.getInstance("EtrMgmtOrchestratorService"),e.info("Service Started...");var a={noop:function(){},_navigateToETRCreation:function(e,n,i){var a={tripId:e,lastName:n,firstName:i};return t.navigateTo("etrMgmtLanding",a)},_navigateToETREdition:function(e,i,a,r){var o={tripId:e,lastName:i,firstName:a,refId:r.refId},s=n.capitalizedFirst(r.type);return t.navigateTo("etrMgmt"+s,o)},next:function(e){var n=i.when(e);return n=e.etrMgmtTripSelected?e.etrMgmtTripSelected.tripId?t.navigateTo("triplist").then(function(){t.navigateTo("trip-expanded",e.etrMgmtTripSelected)}):t.navigateTo("triplist"):e.etrCreation?a._navigateToETRCreation(e.tripId,e.lastName,e.firstName):e.etrEdition?a._navigateToETREdition(e.tripId,e.lastName,e.firstName,e.segment):t.check(e)},toString:function(){return"EtrMgmtOrchestratorService"}};return t.register(a),a}]),etrMgmtModule.run(["$templateCache",function(e){e.put("etr-mgmt/templates/pages/EtrMgmtActivityView.html",'<ion-view debug-file-path="EtrMgmtActivityView.html"><ion-nav-title translate>{{isEditMode ? &apos;etrMgmt.activity.title.edit&apos; : &apos;etrMgmt.activity.title.add&apos;}}</ion-nav-title><ion-content class="spaced-layout"><article class="contained-narrow"><form name="forms.etrForm" novalidate><section class="etr-panel"><div id="hidden-google-places-div" style="display:none"></div><div class="etr-header-with-icon"><div class="etr-header-icon etr-icon icon-activity"></div><h1 class="etr-header-caption" translate>{{isEditMode ? &apos;etrMgmt.activity.title.edit&apos; : &apos;etrMgmt.activity.title.add&apos;}}</h1></div><div class="etr-ui-block"><cmt-input-text data="inputs.title" id="title" label="{{&apos;etrMgmt.shared.label.title&apos;|translate}}" name="title" max-length-translation="{{&apos;etrMgmt.shared.error.titleMaxLength&apos;|translate}}" maxlength="99" required></cmt-input-text></div><div class="etr-ui-block"><google-place class="etr-input not-really-disabled" disabled="disabled" id="locationPlace" label="etrMgmt.shared.label.location" location="inputs.location" name="locationPlace" readonly="readonly" required title="etrMgmt.shared.title.chooseLocation"></google-place></div><input date-range date-range-end="inputs.end" date-range-start="inputs.start" dates-offset-unit="h" dates-offset-value="1" default-end-date="config.defaultEndDate" default-start-date="config.defaultStartDate" name="datesValid" ng-model="inputs.datesValid" type="hidden" validity-key="dateRangeValidity"><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.shared.label.start</h2><div class="two-column-equal"><cmt-input-date data="inputs.start.date" id="startdate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="startDate" required></cmt-input-date><cmt-input-time data="inputs.start.time" id="startTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="startTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n              forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.start.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="startTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.shared.label.end</h2><div><div class="two-column-equal"><cmt-input-date data="inputs.end.date" id="endDate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="endDate" required></cmt-input-date><cmt-input-time data="inputs.end.time" id="endTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="endTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n                forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.end.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="endTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div></div><div class="etr-ui-block"><cmt-input-text data="inputs.confirmationNumber" id="confirmationNumber" label="{{&apos;etrMgmt.shared.label.confirmationNumber&apos;|translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" name="confirmationNumber" use-pattern="confirmationNumber"></cmt-input-text></div><div class="etr-ui-block"><cmt-text-area chars-counter="true" data="inputs.description" label="{{&apos;etrMgmt.shared.label.description&apos;|translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" maxlength="99" name="description" ng-if="isEditMode" rows="3"></cmt-text-area></div><div class="contained-narrow spaced-layout-element"><button class="btn-fullwidth e2e-save-button" ng-click="saveSegment()" translate type="submit" data-tap-disabled="isDataTapDisabled" name="saveButton" ng-disabled="disableSaveButton">etrMgmt.shared.button.save</button></div><div class="contained-narrow spaced-layout-element" ng-controller="EtrMgmtDeleteController" ng-if="isEditMode"><button class="btn-fullwidth btn-danger" ng-click="deleteSegment(&apos;activity&apos;)" translate type="button">etrMgmt.shared.button.delete</button></div></section></form></article></ion-content></ion-view>'),
e.put("etr-mgmt/templates/pages/EtrMgmtAirView.html",'<ion-view debug-file-path="EtrMgmtAirView.html"><ion-nav-title translate>{{isEditMode ? &apos;etrMgmt.air.title.edit&apos; : &apos;etrMgmt.air.title.add&apos;}}</ion-nav-title><ion-content class="spaced-layout"><script id="addEtrFlightRoutes.html" type="text/ng-template"><ion-modal-view>\n        <ion-header-bar class="bar-stable">\n          <h1 class="title" translate>etrMgmt.air.label.chooseFlight</h1>\n          <!--<span class="button icon button-clear {{::closeicon}}" ng-click="closeModal()"></span>-->\n        </ion-header-bar>\n\n        <ion-content class="spaced-layout">\n          <div class="etr-flight-route-popover">\n            <div class="etr-flight-route"\n                 ng-repeat="route in flightRoutes"\n                 ng-click="selectRoute(route)" ng-class="{\'etr-flight-route-selected\': route === selectedRoute}">\n              <div class="etr-flight-route-destination etr-flight-route-departure">\n                <p>{{route.start.location.code}}</p>\n                <p>{{route.start.location.name}}</p>\n              </div>\n\n              <i class="icon-flight" ></i>\n\n              <div class="etr-flight-route-destination etr-flight-route-arrival">\n                <p>{{route.end.location.code}}</p>\n                <p>{{route.end.location.name}}</p>\n              </div>\n\n              <div class="clear" ></div>\n            </div>\n            <button type="submit" class="btn-fullwidth" ng-click="confirmRoute()" ng-disabled="disableConfirm" translate>\n              etrMgmt.shared.button.confirm\n            </button>\n          </div>\n        </ion-content>\n      </ion-modal-view></script><article class="contained-narrow"><form name="forms.airForm" novalidate><section class="etr-panel"><div class="etr-header-with-icon"><div class="icon-flight etr-header-icon etr-icon"></div><h1 class="etr-header-caption" translate>{{isEditMode ? &apos;etrMgmt.air.title.edit&apos; : &apos;etrMgmt.air.title.add&apos;}}</h1></div><div class="etr-ui-block"><cmt-input-text data="airInputs.flightNumber" label="{{&apos;etrMgmt.air.label.flightNumber&apos;|translate}}" name="flightNumber" use-pattern="flightNumber" required></cmt-input-text></div><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.air.label.departure</h2><cmt-input-date data="airInputs.departure.date" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="departureDate" required></cmt-input-date></div><div class="etr-ui-block"><div class="etr-flight-route etr-flight-route-selected" ng-if="selectedFlightRoute"><div class="etr-flight-route-destination etr-flight-route-departure"><p>{{selectedFlightRoute.start.location.code}}</p><p>{{selectedFlightRoute.start.location.name}}</p></div><i class="icon-flight"></i><div class="etr-flight-route-destination etr-flight-route-arrival"><p>{{selectedFlightRoute.end.location.code}}</p><p>{{selectedFlightRoute.end.location.name}}</p></div><div class="clear"></div></div></div><div class="etr-ui-block"><cmt-input-text data="airInputs.confirmationNumber" label="{{&apos;etrMgmt.shared.label.confirmationNumber&apos;|translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" name="confirmationNumber" use-pattern="confirmationNumber" id="confirmationNumber"></cmt-input-text></div><div class="contained-narrow spaced-layout-element"><button class="btn-fullwidth e2e-save-button" ng-click="saveAirSegment()" translate type="submit" data-tap-disabled="isDataTapDisabled" name="saveButton" ng-disabled="disableSaveButton">etrMgmt.shared.button.save</button></div><div class="contained-narrow spaced-layout-element" ng-if="isEditMode" ng-controller="EtrMgmtDeleteController"><button class="btn-fullwidth btn-danger" ng-click="deleteSegment(&apos;air&apos;)" translate type="button">etrMgmt.shared.button.delete</button></div></section></form></article></ion-content></ion-view>'),e.put("etr-mgmt/templates/pages/EtrMgmtCarView.html",'<ion-view debug-file-path="EtrMgmtCarView.html"><ion-nav-title translate>{{isEditMode ? &apos;etrMgmt.car.title.edit&apos; : &apos;etrMgmt.car.title.add&apos;}}</ion-nav-title><ion-content class="spaced-layout"><article class="contained-narrow"><form name="forms.etrForm" novalidate><section class="etr-panel"><div id="hidden-google-places-div" style="display:none"></div><div class="etr-header-with-icon"><div class="etr-header-icon etr-icon icon-car"></div><h1 class="etr-header-caption" translate>{{isEditMode ? &apos;etrMgmt.car.title.edit&apos; : &apos;etrMgmt.car.title.add&apos;}}</h1></div><div class="etr-ui-block"><cmt-input-text data="inputs.provider" label="{{&apos;etrMgmt.car.label.provider&apos;|translate}}" name="carProvider" maxlength="99" required></cmt-input-text><span class="ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp; \n                  forms.etrForm.googlePlacesAutocompleteSelectedDescription.$error.required" translate>coreUi.error.mandatory</span></div><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.car.label.pickup</h2><google-place class="etr-input not-really-disabled" disabled="disabled" id="pickupPlace" label="etrMgmt.shared.label.location" location="inputs.fromLocation" name="pickupPlace" readonly="readonly" required title="etrMgmt.shared.title.chooseLocation"></google-place></div><div class="etr-ui-block"><input date-range date-range-end="inputs.end" date-range-start="inputs.start" dates-offset-unit="d" dates-offset-value="1" default-end-date="config.defaultEndDate" default-start-date="config.defaultStartDate" name="datesValid" ng-model="inputs.datesValid" type="hidden" validity-key="dateRangeValidity"><div class="two-column-equal"><cmt-input-date data="inputs.start.date" id="pickupDate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="pickupDate" required></cmt-input-date><cmt-input-time data="inputs.start.time" id="pickupTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="pickupTime" required></cmt-input-time></div><span class="ng-hide validation date-range" ng-show="forms.etrForm.$submitted &amp;&amp;\n              forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.start.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="arrivalTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div><div class="etr-ui-block"><cmt-text-area chars-counter="true" data="inputs.carDescription" label="{{&apos;etrMgmt.car.label.carDescription&apos;|translate}}" maxlength="70" name="carDescription" rows="3" required></cmt-text-area></div><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.car.label.dropOff</h2><div><ion-toggle class="etr-toggle" name="toggle-same-drop-off-location" ng-model="inputs.useSameLocation" toggle-class="toggle-balanced">{{&apos;etrMgmt.car.label.sameDropOffLocation&apos;|translate}}</ion-toggle></div><div class="animate-show-hide" ng-hide="inputs.useSameLocation"><google-place class="etr-input not-really-disabled" disabled="disabled" id="dropOffPlace" label="etrMgmt.shared.label.location" location="inputs.toLocation" name="dropOffPlace" readonly="readonly" required title="etrMgmt.shared.title.chooseLocation"></google-place></div></div><div class="etr-ui-block"><div class="two-column-equal"><cmt-input-date data="inputs.end.date" id="dropOffDate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="dropOffDate" required></cmt-input-date><cmt-input-time data="inputs.end.time" id="dropOffTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="dropOffTime" required></cmt-input-time></div><span class="ng-hide validation date-range" ng-show="forms.etrForm.$submitted &amp;&amp;\n                forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><div class="animate-show-hide" ng-hide="inputs.useSameLocation"><cmt-select data="inputs.end.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="arrivalTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div></div><div class="etr-ui-block"><cmt-input-text data="inputs.confirmationNumber" label="{{&apos;etrMgmt.shared.label.confirmationNumber&apos;\n                            |translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" name="confirmationNumber" id="confirmationNumber" use-pattern="confirmationNumber"></cmt-input-text></div><div class="etr-ui-block"><cmt-text-area chars-counter="true" data="inputs.description" label="{{&apos;etrMgmt.shared.label.description&apos;\n                           |translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" maxlength="90" name="description" rows="3" ng-if="isEditMode"></cmt-text-area></div><div class="contained-narrow spaced-layout-element"><button class="btn-fullwidth e2e-save-button" ng-click="saveSegment()" translate type="submit" data-tap-disabled="isDataTapDisabled" name="saveButton" ng-disabled="disableSaveButton">etrMgmt.shared.button.save</button></div><div class="contained-narrow spaced-layout-element" ng-controller="EtrMgmtDeleteController" ng-if="isEditMode"><button class="btn-fullwidth btn-danger" ng-click="deleteSegment(&apos;car&apos;)" translate type="button">etrMgmt.shared.button.delete</button></div></section></form></article></ion-content></ion-view>'),e.put("etr-mgmt/templates/pages/EtrMgmtHotelView.html",'<ion-view debug-file-path="EtrMgmtHotelView.html"><ion-nav-title translate>{{isEditMode ? &apos;etrMgmt.hotel.title.edit&apos; : &apos;etrMgmt.hotel.title.add&apos;}}</ion-nav-title><ion-content class="spaced-layout"><article class="contained-narrow"><form name="forms.etrForm" novalidate><section class="etr-panel"><div id="hidden-google-places-div" style="display:none"></div><div class="etr-header-with-icon"><div class="etr-header-icon etr-icon icon-hotel"></div><h1 class="etr-header-caption" translate>{{isEditMode ? &apos;etrMgmt.hotel.title.edit&apos; : &apos;etrMgmt.hotel.title.add&apos;}}</h1></div><div class="etr-ui-block"><google-place class="etr-input not-really-disabled" disabled="disabled" id="locationPlace" label="etrMgmt.hotel.label.hotelName" location="inputs.location" name="locationPlace" readonly="readonly" required title="etrMgmt.hotel.title.choose"></google-place></div><input date-range date-range-end="inputs.end" date-range-start="inputs.start" dates-offset-unit="d" dates-offset-value="1" default-end-date="config.defaultEndDate" default-start-date="config.defaultStartDate" name="datesValid" ng-model="inputs.datesValid" type="hidden" validity-key="dateRangeValidity"><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.hotel.label.checkIn</h2><div class="two-column-equal"><cmt-input-date data="inputs.start.date" id="checkindate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="checkInDate" required></cmt-input-date><cmt-input-time data="inputs.start.time" id="checkInTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="checkInTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n              forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.start.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="checkInTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.hotel.label.checkOut</h2><div><div class="two-column-equal"><cmt-input-date data="inputs.end.date" id="checkOutDate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="checkOutDate" required></cmt-input-date><cmt-input-time data="inputs.end.time" id="checkOutTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="checkOutTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n                forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.end.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="checkOutTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div></div><div class="etr-ui-block"><cmt-input-text data="inputs.confirmationNumber" id="confirmationNumber" label="{{&apos;etrMgmt.shared.label.confirmationNumber&apos;|translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" name="confirmationNumber" use-pattern="confirmationNumber"></cmt-input-text></div><div class="contained-narrow spaced-layout-element"><button class="btn-fullwidth e2e-save-button" ng-click="saveSegment()" translate type="submit" data-tap-disabled="isDataTapDisabled" name="saveButton" ng-disabled="disableSaveButton">etrMgmt.shared.button.save</button></div><div class="contained-narrow spaced-layout-element" ng-controller="EtrMgmtDeleteController" ng-if="isEditMode"><button class="btn-fullwidth btn-danger" ng-click="deleteSegment(&apos;hotel&apos;)" translate type="button">etrMgmt.shared.button.delete</button></div></section></form></article></ion-content></ion-view>'),e.put("etr-mgmt/templates/pages/EtrMgmtLandingView.html",'<ion-view debug-file-path="EtrMgmtLandingView.html"><ion-nav-title translate>etrMgmt.landingPage.title</ion-nav-title><ion-content><div class="e2e-etr-container etr-container"><p class="etr-text" translate>etrMgmt.landingPage.text.getStarted</p><div class="etr-item" ng-click="goto(&apos;etrMgmtAir&apos;)" ng-if="airEnabled"><i class="etr-icon icon-flight"></i><p class="etr-text" translate>etrMgmt.landingPage.label.flight</p></div><div class="etr-item" ng-click="goto(&apos;etrMgmtHotel&apos;)" ng-if="hotelEnabled"><i class="etr-icon icon-hotel"></i><p class="etr-text" translate>etrMgmt.landingPage.label.hotel</p></div><div class="etr-item" ng-click="goto(&apos;etrMgmtCar&apos;)" ng-if="carEnabled"><i class="etr-icon icon-car"></i><p class="etr-text" translate>etrMgmt.landingPage.label.car</p></div><div class="etr-item" ng-click="goto(&apos;etrMgmtTrain&apos;)" ng-if="trainEnabled"><i class="etr-icon icon-train"></i><p class="etr-text" translate>etrMgmt.landingPage.label.train</p></div><div class="etr-item" ng-click="goto(&apos;etrMgmtMeeting&apos;)" ng-if="meetingEnabled"><i class="etr-icon icon-meeting"></i><p class="etr-text" translate>etrMgmt.landingPage.label.meeting</p></div><div class="etr-item" ng-click="goto(&apos;etrMgmtActivity&apos;)" ng-if="activityEnabled"><i class="etr-icon icon-activity"></i><p class="etr-text" translate>etrMgmt.landingPage.label.activity</p></div></div></ion-content></ion-view>'),e.put("etr-mgmt/templates/pages/EtrMgmtMeetingView.html",'<ion-view debug-file-path="EtrMgmtMeetingView.html"><ion-nav-title translate>{{isEditMode ? &apos;etrMgmt.meeting.title.edit&apos; : &apos;etrMgmt.meeting.title.add&apos;}}</ion-nav-title><ion-content class="spaced-layout"><article class="contained-narrow"><form name="forms.etrForm" novalidate><section class="etr-panel"><div id="hidden-google-places-div" style="display:none"></div><div class="etr-header-with-icon"><div class="etr-header-icon etr-icon icon-meeting"></div><h1 class="etr-header-caption" translate>{{isEditMode ? &apos;etrMgmt.meeting.title.edit&apos; : &apos;etrMgmt.meeting.title.add&apos;}}</h1></div><div class="etr-ui-block"><cmt-input-text data="inputs.title" id="title" label="{{&apos;etrMgmt.shared.label.title&apos;|translate}}" name="title" max-length-translation="{{&apos;etrMgmt.shared.error.titleMaxLength&apos;|translate}}" maxlength="99" required></cmt-input-text></div><div class="etr-ui-block"><google-place class="etr-input not-really-disabled" disabled="disabled" id="meetingPlace" label="etrMgmt.shared.label.location" location="inputs.location" name="meetingPlace" readonly="readonly" required title="etrMgmt.shared.title.chooseLocation"></google-place></div><input date-range date-range-end="inputs.end" date-range-start="inputs.start" dates-offset-unit="h" dates-offset-value="1" default-end-date="config.defaultEndDate" default-start-date="config.defaultStartDate" name="datesValid" ng-model="inputs.datesValid" type="hidden" validity-key="dateRangeValidity"><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.shared.label.start</h2><div class="two-column-equal"><cmt-input-date data="inputs.start.date" id="startdate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="startDate" required></cmt-input-date><cmt-input-time data="inputs.start.time" id="startTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="startTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n            forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.start.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="startTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div><div class="etr-ui-block"><h2 class="etr-ui-block-header" translate>etrMgmt.shared.label.end</h2><div><div class="two-column-equal"><cmt-input-date data="inputs.end.date" id="endDate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="endDate" required></cmt-input-date><cmt-input-time data="inputs.end.time" id="endTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="endTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n              forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.end.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="endTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div></div><div class="etr-ui-block"><cmt-input-text data="inputs.confirmationNumber" id="confirmationNumber" label="{{&apos;etrMgmt.shared.label.confirmationNumber&apos;|translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" name="confirmationNumber" use-pattern="confirmationNumber"></cmt-input-text></div><div class="etr-ui-block"><cmt-text-area chars-counter="true" data="inputs.description" label="{{&apos;etrMgmt.shared.label.description&apos;|translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" maxlength="99" name="description" ng-if="isEditMode" rows="3"></cmt-text-area></div><div class="contained-narrow spaced-layout-element"><button class="btn-fullwidth e2e-save-button" ng-click="saveSegment()" translate type="submit" data-tap-disabled="isDataTapDisabled" ng-disabled="disableSaveButton">etrMgmt.shared.button.save</button></div><div class="contained-narrow spaced-layout-element" ng-controller="EtrMgmtDeleteController" ng-if="isEditMode"><button class="btn-fullwidth btn-danger" ng-click="deleteSegment(&apos;meeting&apos;)" translate type="button">etrMgmt.shared.button.delete</button></div></section></form></article></ion-content></ion-view>'),e.put("etr-mgmt/templates/pages/EtrMgmtTrainView.html",'<ion-view debug-file-path="EtrMgmtTrainView.html"><ion-nav-title translate>{{isEditMode ? &apos;etrMgmt.train.title.edit&apos; : &apos;etrMgmt.train.title.add&apos;}}</ion-nav-title><ion-content class="spaced-layout"><article class="contained-narrow"><form name="forms.etrForm" novalidate><section class="etr-panel"><div id="hidden-google-places-div" style="display:none"></div><div class="etr-header-with-icon"><div class="etr-header-icon etr-icon icon-train"></div><h1 class="etr-header-caption" translate>{{isEditMode ? &apos;etrMgmt.train.title.edit&apos; : &apos;etrMgmt.train.title.add&apos;}}</h1></div><div class="etr-ui-block"><google-place class="etr-input not-really-disabled" disabled="disabled" id="departurePlace" label="etrMgmt.train.label.departureStation" location="inputs.fromLocation" name="departurePlace" readonly="readonly" required title="etrMgmt.shared.title.chooseLocation"></google-place></div><div class="etr-ui-block"><div class="two-column-equal"><cmt-input-date data="inputs.start.date" id="departureDate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="departureDate" required></cmt-input-date><cmt-input-time data="inputs.start.time" id="departureTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="departureTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n              forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.start.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="departureTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div><div class="etr-ui-block"><google-place class="etr-input not-really-disabled" disabled="disabled" id="arrivalPlace" label="etrMgmt.train.label.arrivalStation" location="inputs.toLocation" name="arrivalPlace" readonly="readonly" required title="etrMgmt.shared.title.chooseLocation"></google-place></div><div class="etr-ui-block"><div><div class="two-column-equal"><cmt-input-date data="inputs.end.date" id="arrivalDate" label="{{&apos;etrMgmt.shared.label.date&apos;|translate}}" name="arrivalDate" required></cmt-input-date><cmt-input-time data="inputs.end.time" id="arrivalTime" label="{{&apos;etrMgmt.shared.label.time&apos;|translate}}" name="arrivalTime" required></cmt-input-time></div><span class="date-range ng-hide validation" ng-show="forms.etrForm.$submitted &amp;&amp;\n                forms.etrForm.datesValid.$error.dateRangeValidity" translate>coreUi.error.invalidDateRange</span><cmt-select data="inputs.end.timezoneOffset" label="{{&apos;etrMgmt.shared.label.timezone&apos; | translate}}" name="arrivalTimezoneOffset" options="config.timezonesList" placeholder="{{&apos;etrMgmt.shared.label.selectTimezone&apos; | translate}}" required></cmt-select></div></div><input date-range date-range-end="inputs.end" date-range-start="inputs.start" dates-offset-unit="h" dates-offset-value="1" default-end-date="config.defaultEndDate" default-start-date="config.defaultStartDate" name="datesValid" ng-model="inputs.datesValid" type="hidden" validity-key="dateRangeValidity"><div class="etr-ui-block"><cmt-input-text data="inputs.confirmationNumber" id="confirmationNumber" label="{{&apos;etrMgmt.shared.label.confirmationNumber&apos;|translate}} {{&apos;etrMgmt.shared.label.optional&apos;|translate}}" name="confirmationNumber" use-pattern="confirmationNumber"></cmt-input-text></div><div class="contained-narrow spaced-layout-element"><button class="btn-fullwidth e2e-save-button" ng-click="saveSegment()" translate type="submit" data-tap-disabled="isDataTapDisabled" name="saveButton" ng-disabled="disableSaveButton">etrMgmt.shared.button.save</button></div><div class="contained-narrow spaced-layout-element" ng-controller="EtrMgmtDeleteController" ng-if="isEditMode"><button class="btn-fullwidth btn-danger" ng-click="deleteSegment(&apos;train&apos;)" translate type="button">etrMgmt.shared.button.delete</button></div></section></form></article></ion-content></ion-view>')}]),window.miscModule=angular.module("MiscModule",["ionic","CoreModule"]),window.miscModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("misc")}]),miscModule.directive("cookieWarning",["$rootScope","$log","DataManagerService","OrchestratorChiefService",function(e,t,n,i){t=t.getInstance("cookieWarning");var a={restrict:"E",templateUrl:"misc/directives/CookieWarningDirective.html",scope:{},DM_KEY:"CookieWarning",controller:["$scope",function(e){e.closeCookieWarning=function(){n.set({acknowledged:!0},a.DM_KEY,{storage:n.LOCALSTORAGE,ttl:"24h"}),e.cookieWarningDisplay=!1},e.openCookiePolicy=function(){i.navigateTo("cookiepolicyWeb")}}],link:function(e,t,i,r){a.cookieWarningStatus=n.get(a.DM_KEY,n.LOCALSTORAGE)||{},e.cookieWarningDisplay=!a.cookieWarningStatus.acknowledged}};return a}]),miscModule.run(["$templateCache",function(e){e.put("misc/directives/CookieWarningDirective.html",'<div class="cookie-warning" debug-file-path="CookieWarningDirective.html" ng-if="cookieWarningDisplay"><div class="cookie-warning-content"><span translate>misc.cookieWarning.text</span>&#xA0;<a ng-click="openCookiePolicy()" translate>misc.cookieWarning.button.readMore</a></div><div class="cookie-warning-action-button"><button ng-click="closeCookieWarning()" translate>core.button.close</button></div></div>')}]),window.exploreModule=angular.module("ExploreModule",["ionic","CoreModule","AnalyticsModule","AccountModule"]),window.exploreModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("explore")}]),window.exploreModule.run(["$log","ExploreOrchestratorService",function(e,t){e=e.getInstance("WebMobileModule"),e.info("Module started"),t.init()}]),window.exploreModule.routes={exploreList:{url:"/exploreList/:latitude?/:longitude?/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"explore/templates/pages/ExploreMapView.html",controller:"ExploreMapController",defaultBackState:"triplist",secured:!0,params:{display:"list"},resolve:{analytics:["AnalyticsService",function(e){return e.screenView("exploreList").promise()}]}},exploreMap:{url:"/exploreMap/:latitude?/:longitude?/:tripId?/:lastName?/:firstName?/:refId?",templateUrl:"explore/templates/pages/ExploreMapView.html",controller:"ExploreMapController",defaultBackState:"triplist",secured:!0,params:{display:"map"},resolve:{analytics:["AnalyticsService",function(e){return e.screenView("exploreMap").promise()}]}},exploreDetails:{url:"/exploreDetails",templateUrl:"explore/templates/pages/ExploreDetailsView.html",controller:"ExploreDetailsController",defaultBackState:"triplist",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("exploreDetails").promise()}]}}},exploreModule.service("ExploreService",["$log","$q","PromiseService","GpsCheckinService","ExploreAnalyticsService","I18nConfig","RequestService","$stateParams","DataManagerService","MapService",function(e,t,n,i,a,r,o,s,l,c){e=e.getInstance("ExploreService"),e.info("Service Started...");var d={latitude:null,longitude:null},u={NO_COORDINATES:"No Coodinates from GPS",createURL:function(e,t){var n=getContext("featureConfig.explore.FOUR_SQUARE_URL_PATH"),i=getContext("featureConfig.explore.CLIENT_ID"),a=getContext("featureConfig.explore.CLIENT_SECRET"),o=r.getCurrentDeviceLanguage(),s="ll="+e,l="&query="+t,c="&client_id="+i,d="&venuePhotos=1",u="&client_secret="+a,g="&v="+(new Date).toISOString().slice(0,10).replace(/-/g,""),p="&locale="+o,m=n+s+l+d+c+u+g+p;return m},exploreSearch:function(e,n){var i=t.defer();return u.getFormattedCoordinates(e).then(function(e){if(getContext("featureConfig.explore.enableCache",!1)){var t=u._getCachedData(e,n);isDefined(t)?u._handleExploreSearchSuccess(t,i):u._sendRequest(e,n,i)}else u._sendRequest(e,n,i)},function(e){i.reject(e),a.exceptionOccured({message:e,isFatal:!0})}),i.promise},_sendRequest:function(e,t,i){var r=u.createURL(e,t);o.get(r).then(function(n){n=n.data,getContext("featureConfig.explore.enableCache",!1)&&u._cacheData(e,n,t),u._handleExploreSearchSuccess(n,i)},function(e){n.rejectDueToHttpError({deferred:i,response:e,method:"exploreSearch"}),a.exceptionOccured({message:"errorInRequest",isFatal:!0})})},_handleExploreSearchSuccess:function(e,t){var n=[],i=safeAccess(e,"response.groups.length",0);if(i>0)for(var a=e.response.groups[0].items,r=0;r<a.length;r++){var o=a[r].venue;o.tips=a[r].tips,n.push(o)}t.resolve(n)},_cacheData:function(e,t,n){l.set({position:e,result:t},u._getCacheKey(n),{storage:l.LOCALSTORAGE,ttl:"24h"})},_getCacheKey:function(e){return"EXPLORE_DATA_"+e},_getCachedData:function(e,t){var n=l.get(u._getCacheKey(t),l.LOCALSTORAGE),i=getContext("featureConfig.explore.maxDistanceKmCache",10);if(isDefined(n)){var a=c.getDistance(u.getCoordinatesFromFormattedCoordinates(e),u.getCoordinatesFromFormattedCoordinates(n.position));n=a>i?void 0:n.result}return n},setExploreVenues:function(e){this.venues=e},getExploreVenues:function(e){return this.venues},toString:function(){return"ExploreService"},setExploreDetailsData:function(e,t,n,i){this.expDetails={expDetailsData:e,detailCategory:t,detailCategoryLabel:n,expImagePath:i}},getExploreDetailsData:function(){return this.expDetails},fetchPhotos:function(e,t,n){if(safeAccess(e,"photos.count",0)>0&&safeAccess(e,"photos.groups[0].count",0)>0){var i=e.photos.groups[0].items[0];return i.prefix+n+i.suffix}return"Coffee"===t?"images/explore/default_Cafe.jpg":"Food"===t?"images/explore/default_Restaurant.jpg":"Shops"===t?"images/explore/default_Shop.jpg":"Museum"===t?"images/explore/default_Museum.jpg":"Sights"===t?"images/explore/default_Sights.jpg":void 0},getCurrentCoordinates:function(){var n=t.defer();return i.getGeolocationData().then(function(e){if(null!=e&&null!=e.coords&&null!=e.coords.latitude&&null!=e.coords.longitude){var t={latitude:e.coords.latitude,longitude:e.coords.longitude};n.resolve(t)}else n.reject("locationNotFound")},function(t){e.error("Error in GPS Settings - "+t),n.reject(u.NO_COORDINATES),a.exceptionOccured({message:"GPS error",isFatal:!1})}),n.promise},setCoordinates:function(e,t){d={latitude:e,longitude:t}},getCoordinates:function(){var e,n=u.getCoordinatesFromUrl();return e=n?t.when(n):u.getCurrentCoordinates()},getCoordinatesFromUrl:function(){return safeAccess(s,"latitude",!1)&&safeAccess(s,"longitude",!1)?{latitude:s.latitude,longitude:s.longitude}:null},getFormattedCoordinates:function(e){var n,i=u.getCoordinatesFromFormattedCoordinates(e);return n=i?t.when(i.latitude+","+i.longitude):u.getCoordinates().then(function(e){return e.latitude+","+e.longitude})},getCoordinatesFromFormattedCoordinates:function(e){if(isDefined(e)&&angular.isString(e)){var t=e.split(",");if(2==t.length)return{latitude:parseFloat(t[0]),longitude:parseFloat(t[1])}}return null},isCoordinatesAvailable:function(){return isDefined(d)&&isDefined(d.latitude)&&isDefined(d.longitude)},setActivityETRData:function(e){this.activityETRData={tripId:e.tripId,lastName:e.lastName,firstName:e.firstName,refId:e.refId}},getActivityETRData:function(){return this.activityETRData},formulateAddress:function(e){var t=[];t.push(e.address),t.push(e.city),t.push(e.state),t.push(e.postalCode),t=t.filter(function(e){return isDefined(e)&&""!==e});var n=t.toString().trim();return isDefined(n)&&n.length<2&&(n="-"),n},buildActivityETRDataforExplore:function(e,t){var n={},i={};i.title=safeAccess(e,"expDetailsData.name");var a={addressLine1:safeAccess(e,"expDetailsData.location.formattedAddress[0]"),addressLine2:null,countryName:safeAccess(e,"expDetailsData.location.country"),countryCode:safeAccess(e,"expDetailsData.location.cc"),stateName:safeAccess(e,"expDetailsData.location.state"),stateCode:null,cityCode:null,cityName:safeAccess(e,"expDetailsData.location.city"),zip:safeAccess(e,"expDetailsData.location.postalCode"),latitude:safeAccess(e,"expDetailsData.location.lat"),longitude:safeAccess(e,"expDetailsData.location.lng"),imageSet:t,name:safeAccess(e,"expDetailsData.location.city"),code:null};i.fromLocation=a;var r=new Date,o={};o.utcTimestampMillis=r.setHours(12,0,0,0),
o.offsetMinutes=-r.getTimezoneOffset(),i.startDate=o,i.endDate=o,n.prefillData=i;var s=u.getActivityETRData();return n.tripId=safeAccess(s,"tripId")||null,n.lastName=safeAccess(s,"lastName")||null,n}};return u}]),exploreModule.service("ExploreAnalyticsService",["$log","$q","$http","PromiseService","LayoutService","AnalyticsService",function(e,t,n,i,a,r){e=e.getInstance("ExploreAnalyticsService"),e.info("Service Started...");var o={CATEGORY:"Explore",moreOptionsClicked:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Explore",CONSTANTS.FROM_EXPLORE_DETAILS+e).push();this.sendEvent("More options clicked",t.build(),o.CATEGORY)})},exploreModuleOpened:function(e,t,n){r.runSafe(function(){var i="";i=n?"Explore in Map view":"Explore in List view";var a=this.getPropertiesFactory().create("Explore",e).push();this.sendEvent(i+" - "+t,a.build(),o.CATEGORY)})},detailsOpened:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Explore","for "+e).push();this.sendEvent("Explore details",t.build(),o.CATEGORY)})},clickedOnCall:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Explore",CONSTANTS.FROM_EXPLORE_DETAILS+e).push();this.sendEvent("Call phone",t.build(),o.CATEGORY)})},imageFullViewOpened:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Explore",CONSTANTS.FROM_EXPLORE_DETAILS+e).push();this.sendEvent("Image full view",t.build(),o.CATEGORY)})},exceptionOccured:function(e){r.runSafe(function(){this.sendException(e)})},takeMeThereClicked:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Explore Category",e).push();this.sendEvent("Directions - Explore clicked",t.build(),o.CATEGORY)})},taxiDriverClicked:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Explore",CONSTANTS.FROM_EXPLORE_DETAILS+e).push();this.sendEvent("Taxi driver - clicked",t.build(),o.CATEGORY)})},addToTimelineClicked:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Explore",CONSTANTS.FROM_EXPLORE_DETAILS+e).push();this.sendEvent("Add to Timeline - clicked",t.build(),o.CATEGORY)})},toString:function(){return"ExploreAnalyticsService"}};return o}]),exploreModule.service("ExploreOrchestratorService",["$log","OrchestratorChiefService",function(e,t){e=e.getInstance("ExploreOrchestratorService"),e.info("Service Started...");var n={init:function(){t.register(n)},next:function(e){return isDefined(e.etrPrefillData)?(t.navigateTo(e.etrType,e.etrPrefillData),e):t.check(e)},toString:function(){return"WebIntegrationModuleOrchestratorService"}};return n}]),exploreModule.controller("ExploreMapController",["$scope","$log","$rootScope","$ionicScrollDelegate","$timeout","LayoutService","$ionicPopup","$translate","I18nService","ExploreService","OrchestratorChiefService","$stateParams","GpsCheckinService","ExploreAnalyticsService","PostMessageService","AuthenticationService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f){t=t.getInstance("ExploreMapController"),t.info("Controller Started..."),e.isGuestMode=!f.isLogged(),e.model={},e.mapView="list"!==u.display;var v,h,S=function(){m.send({type:"navBarButtonChangeEvent",buttonType:e.mapView?"list":"map",buttonID:1})},C=function(){var e=d.getPreviousView();h="Menu",h="booking"===safeAccess(e,"stateName")?"Booking":isDefined(u.tripId)?"TripDetails":"Menu",h="From - "+h};m.when("rightButtonTap").then(function(t){e.toggleView()}),m.when("navBarButtonTapEvent").then(function(t){1==t.buttonID&&e.toggleView()}),e.$on("$ionicView.enter",function(){S(),c.setActivityETRData(u)}),e.$on("$ionicView.leave",function(){m.send({type:"navBarButtonChangeEvent",buttonType:null,buttonID:1})}),e.onClickCategory=function(t,n){C(),e.exploreCategory=n,e.idToMap="map"+t+(new Date).getMilliseconds(),v=t,e.currentExploreCategoryName="Museum"!=t?t:"Arts",p.exploreModuleOpened(h,e.currentExploreCategoryName,e.mapView),r.loading(!0),c.getFormattedCoordinates().then(function(n){e.search(t,n)},function(e){r.loading(!1),e==c.NO_COORDINATES?l.translate(["explore.list.error.gpsErrorMessage","explore.list.error.gpsErrorTitle"]).then(function(e){o.alert({title:e["explore.list.error.gpsErrorTitle"],template:e["explore.list.error.gpsErrorMessage"]})}):r.toast(e)})},e.search=function(t,n){c.exploreSearch(n,t).then(function(i){e.model.source=n.split(","),e.model.category=t,isDefined(i)&&i.length>0&&!e.getTestenabled()?(c.setExploreVenues(i),e.iterateInfo(i,t)):(e.model.destinations=[],e.model.selectedValue=void 0,r.toast("explore.list.error.noResults"),p.exceptionOccured({message:"noResults",isFatal:!1})),r.loading(!1)},function(e){r.toast(e)})},e.iterateInfo=function(t,n){for(var i=[],a=0;a<t.length;a++){var r=t[a],o=isDefined(r.location)?r.location.lat:null,s=isDefined(r.location)?r.location.lng:null,l=r.name,d=c.formulateAddress(r.location),u={};isDefined(o)&&isDefined(s)&&isDefined(l)&&isDefined(d)&&(u.lat=o,u.lng=s,u.address=d,u.name=l,u.distance=isDefined(r.location.distance)?r.location.distance:"-",u.rating=isDefined(r.rating)?r.rating:"-",u.imageUrl=c.fetchPhotos(r,n,"100"),u.venueDetail=r,i.push(u))}e.model.destinations=i,e.model.type=n},e.$on("toggleView",function(){e.toggleView()}),e.$on("navigateToDetailsFromPopup",function(t){e.navigateToDetails(e.model.selectedValue)}),e.setTestenabled=function(t){e.testenabled=t},e.getTestenabled=function(){return e.testenabled},e.toggleView=function(){e.mapView=!e.mapView,isDefined(e.currentExploreCategoryName)&&p.exploreModuleOpened(h,e.currentExploreCategoryName,e.mapView),S(),a(function(){i.resize()},500)},e.toggleViewWithEvent=function(){n.$broadcast("toggleView")},e.exploreDetails=function(t,n,i,a){var r="exploreDetails";e.isGuestMode&&(r="guest-exploreDetails"),c.setExploreDetailsData(t.venueDetail,n,i,a),d.navigateTo(r)},e.navigateToDetails=function(t){if(isDefined(t)){var n="exploreDetails";e.isGuestMode&&(n="guest-exploreDetails"),c.setExploreDetailsData(t.venueDetail,v,e.exploreCategory,null),p.detailsOpened(v),d.navigateTo(n)}},a(function(){i.resize()},500)}]),exploreModule.controller("ExploreDetailsController",["$scope","$log","ExploreService","LayoutService","I18nService","$timeout","$ionicModal","$ionicSlideBoxDelegate","GpsCheckinService","OrchestratorChiefService","$ionicPopup","$translate","$ionicHistory","ExploreAnalyticsService","MenuService","AuthenticationService","$rootScope","TripService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v,h){t=t.getInstance("ExploreDetailsController"),t.info("Controller Started...");var S=function(){if(window.innerWidth>1024){var t=window.navigator.userAgent,n=t.indexOf("MSIE "),i=(window.innerWidth-1024)/2;n>0||navigator.userAgent.match(/Trident.*rv\:11\./)?e.setLeft=i+"px !important":e.setLeft=i+"px"}else e.setLeft="";e.addressForTaxiDriver="",p.taxiDriverClicked(e.currentExploreCategoryName),"-"===e.address?(p.exceptionOccured({message:"Address is not available for Taxi driver from explore",isFatal:!1}),a.translate("itmngt.error.addressNotAvailable").then(function(t){e.addressForTaxiDriver=t})):e.addressForTaxiDriver=e.address,e.openTaxiDriverModal()},C=function(){var e=g.viewHistory();return safeAccess(e,"backView",!1)?"trip-expanded"===safeAccess(e,"views["+e.backView.backViewId+"].stateName",!1):!1},T=function(t){p.takeMeThereClicked(t.detailCategory);var n=C?"discoverList":"discoverListBkng",i=e.isGuestMode?"guest-"+n:n;c.navigateTo(i,{srcLatLng:"Current Location",destLatLng:safeAccess(t,"expDetailsData.location.lat")+","+safeAccess(t,"expDetailsData.location.lng"),srcName:"discover.currentlocation",destName:safeAccess(t,"expDetailsData.name")})};m.addItem({label:"explore.plusmenu.timeline",condition:function(){return getContext(CONSTANTS.FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ENABLED,!1)&&getContext(CONSTANTS.FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ACTIVITY_ENABLED,!1)&&isUndefined(safeAccess(n.getActivityETRData(),"tripId"))&&f.isLogged()},icon:"icon-plus",name:"addToTimeLine"}).then(function(t){t.onClick(function(){var t=n.buildActivityETRDataforExplore(e.expDetails,e.imagePath);c.next({etrPrefillData:t,etrType:"etrMgmtActivity"}),p.addToTimelineClicked(e.currentExploreCategoryName)})}),m.addItem({label:"explore.plusmenu.addToTrip",condition:function(){return getContext(CONSTANTS.FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ENABLED,!1)&&getContext(CONSTANTS.FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ACTIVITY_ENABLED,!1)&&isDefined(safeAccess(n.getActivityETRData(),"tripId"))&&f.isLogged()&&!h.isReadOnly(v.trip)},icon:"icon-plus",name:"addToTrip"}).then(function(t){t.onClick(function(){var t=n.buildActivityETRDataforExplore(e.expDetails,e.imagePath);c.next({etrPrefillData:t,etrType:"etrMgmtActivity"}),p.addToTimelineClicked(e.currentExploreCategoryName)})}),m.addItem({label:"explore.plusmenu.taxidriver",condition:function(){return getContext("featureConfig.taxiDriver.enabled",!1)&&screen.width<768},icon:"icon-taxi-driver",name:"showToTaxiDriver"}).then(function(e){e.onClick(function(){S()})}),m.addItem({label:"explore.plusmenu.takemethere",condition:function(){return getContext("featureConfig.takeMeThere.enabled",!1)&&!getContext("featureConfig.discover.nativeMapsEnabled",!1)},icon:"icon-take-me-there",name:"takeMeThere"}).then(function(e){e.onClick(function(e){T(e)})});var b=function(){switch(e.maskpanel=!1,e.CategoryIconClass="",e.isTakeMeThereEnabled=getContext("featureConfig.takeMeThere.enabled",!1),e.isTaxiDriverEnabled=getContext("featureConfig.taxiDriver.enabled",!1),e.isAddToTimelineEnabled=getContext(CONSTANTS.FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ENABLED,!1)&&getContext(CONSTANTS.FEATURE_CONFIG_MANUAL_ETR_MANAGEMENT_ACTIVITY_ENABLED,!1),e.expDetails=n.getExploreDetailsData(),e.imagePath=n.fetchPhotos(e.expDetails.expDetailsData,e.expDetails.detailCategory,500),e.changeImageTo={"background-image":"linear-gradient(to bottom,rgba(0,0,0,.4) 0,rgba(0,0,0,0) 50%,rgba(0,0,0,.4) 100%),url("+e.imagePath+")"},e.menuList=["addToTimeLine","addToTrip","takeMeThere","showToTaxiDriver"],e.menuStyle="material-design",e.onClickCallEnabled=!!safeAccess(e.expDetails,"expDetailsData.contact.phone"),e.currentExploreCategoryName="Museum"!==e.expDetails.detailCategory?e.expDetails.detailCategory:"Arts",e.expDetails.detailCategory){case"Coffee":e.exploreDetailIcons="explore-icon-cafe";break;case"Food":e.exploreDetailIcons="explore-icon-restaurant";break;case"Shops":e.exploreDetailIcons="explore-icon-shop";break;case"Museum":e.exploreDetailIcons="explore-icon-museum";break;case"Sights":e.exploreDetailIcons="explore-icon-sight"}var t=safeAccess(e,"expDetails.expDetailsData.location.lat"),i=safeAccess(e,"expDetails.expDetailsData.location.lng");(isUndefined(t)||isUndefined(i))&&(e.isTakeMeThereEnabled=!1),e.address=n.formulateAddress(e.expDetails.expDetailsData.location),e.isGuestMode=!f.isLogged()};e.onClickCall=function(){p.clickedOnCall(e.currentExploreCategoryName);var t="";t=e.expDetails.expDetailsData.contact.phone,t=t.replace(/[\s.-]/g,"");var n="tel:"+t;getContext("isMobileApp",!1)?window.open(n,"_system"):window.location.href=n},e.fadeDiv=function(){e.maskpanel?(e.maskpanel=!1,e.changeTextColor="",e.changeAnchorTextColor="",e.showAndHideMenu="plusHideMenu",e.changeicon=""):(p.moreOptionsClicked(e.currentExploreCategoryName),e.maskpanel=!0,e.showAndHideMenu="plusShowMenu",e.changeTextColor="color: #787875",e.changeAnchorTextColor="color: #2475ac",e.changeicon="changeicon")},e.unFadeDiv=function(t){t.target.matches(".icon-plus")||(e.maskpanel=!1,e.showAndHideMenu="plusHideMenu",e.changeTextColor="",e.changeicon="",e.changeAnchorTextColor="")},e.openExpandViewModal=function(t){getContext("featureConfig.explore.zoomImageEnabled",!0)&&(p.imageFullViewOpened(e.currentExploreCategoryName),e.imagePath=t,o.fromTemplateUrl("image-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t,e.modal.show()}))},e.closeExpandViewModal=function(){e.modal.remove().then(function(){e.modal=null})},e.$on("$ionicView.enter",function(){b()}),e.openTaxiDriverModal=function(){o.fromTemplateUrl("taxi-driver-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.taxiDriverModal=t,e.taxiDriverModal.show()})},e.closeTaxiDriverModal=function(){e.taxiDriverModal.remove().then(function(){e.taxiDriverModal=null})},e.$on("$ionicView.beforeLeave",function(){isDefined(e.taxiDriverModal)&&e.closeTaxiDriverModal()})}]),exploreModule.service("MapService",["$http","$log","$rootScope",function(e,t,n){return t=t.getInstance("MapService"),t.info("Service Started..."),{createLeafletMap:function(e,t,n,i,a){var r="";r=getContext("isMobileApp",!1)?"_system":"_blank";var o=null!=a?a:13,s=13==o?L.map(e,{trackResize:!1,attributionControl:!1}):L.map(e,{attributionControl:!1});return s=s.setView([t,n],o),L.control.attribution({prefix:"<a href=\"javascript:\" onclick=\"window.open('http://leafletjs.com', '"+r+"', 'location=yes');\" title=\"A JS library for interactive maps\">Leaflet</a>"}).addTo(s),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; <a href=\"javascript:\" onclick=\"window.open('http://osm.org/copyright', '"+r+"', 'location=yes');\">OpenStreetMap</a> contributors",noWrap:!0,minZoom:1,maxZoom:18}).addTo(s),s},plotSourceInformation:function(e,t,n,i){var a="Source Information";L.marker([t,n]).addTo(e).bindPopup(a)},toString:function(){return"MapService"},plotDestinationInformation:function(e,t,n,i){var a=!1,r={};if(isDefined(t)&&t.length>0){for(var o=0;o<t.length;o++){var s=t[o],l=parseFloat(s.lat),c=s.lng,d=this,u="<img style='width:100px;height:100px;border-radius:100px;' src='"+s.imageUrl+"'/>";if(isDefined(n)){var g=L.divIcon({html:'<i class="'+this.getClassNameForType(n)+'"></i>'}),p={};if(p=L.marker([l,c],{icon:g,destination:s}),p.on("click",function(e){var t=e.target.options.destination;d.setDestination(t),d.propagateAndPrepareSelection(t,i)}),p.addTo(e).bindPopup(u),isDefined(this.getDestination())){var m=this.getDestination();m.lat==s.lat&&m.lng==s.lng?(a=!0,p.openPopup(),d.propagateAndPrepareSelection(s,i)):0===o&&(r=p)}else 0===o&&(a=!0,p.openPopup(),d.propagateAndPrepareSelection(s,i))}else{var f="Destination Information";L.marker([l,c]).addTo(e).bindPopup(f)}}a||(r.openPopup(),d.propagateAndPrepareSelection(t[0],i))}},propagateAndPrepareSelection:function(e,t){isDefined(t)&&t(e),n.$broadcast("popupCallBack",{data:e}),setTimeout(function(){var e=angular.element(document.getElementsByClassName("leaflet-popup-content-wrapper"));e.on("click",function(){n.$broadcast("navigateToDetailsFromPopup",{})})},200)},plotRoutes:function(e,t){if(isDefined(t))for(var n=0;n<t.length;n++){var i=t[n];if(safeAccess(i,"path",!1)){var a=L.PolylineUtil.decode(i.path),r=L.polyline(a,{color:"#2475ac",weight:6,opacity:1}),o=L.divIcon({html:'<i class="'+this.getIconForType(i.type)+'"></i>'}),s=a[0][0],l=a[0][1],c=a[a.length-1][0],d=a[a.length-1][1],u={};u=L.marker([s,l],{icon:o}),u.addTo(e);var g={};g=L.marker([c,d],{icon:o}),g.addTo(e),e.addLayer(r)}else if(safeAccess(i,"source",!1)&&safeAccess(i,"destination",!1)){s=i.source.lat,l=i.source.lng,c=i.destination.lat,d=i.destination.lng;var p=new L.LatLng(s,l),m=new L.LatLng(c,d),f=[p,m];u={},o=L.divIcon({html:'<i class="'+this.getIconForType(i.type)+'"></i>'}),u=L.marker([s,l],{icon:o}),u.addTo(e),g=L.marker([c,d],{icon:o}),g.addTo(e);var v=new L.Polyline(f,{color:"#2475ac",weight:6,opacity:1,smoothFactor:1});v.addTo(e)}}},setDestination:function(e){this.destination=e},getDestination:function(e){return this.destination},getIconForType:function(e){switch(e){case"bus":case"tram":case"shuttle":return"icon-outer-circle icon-urban-transportation discover";case"taxi":case"rideshare":case"towncar":return"icon-outer-circle icon-taxi-booking-active discover";case"plane":return"icon-outer-circle icon-flight discover";case"subway":return"icon-outer-circle icon-train discover";case"foot":return"icon-outer-circle icon-walk discover";case"animal":return"icon-outer-circle icon-animals discover";case"cablecar":return"icon-outer-circle icon-cable-car discover";default:return"icon-outer-circle icon-"+e+" discover"}},getClassNameForType:function(e){return"Coffee"===e?"icon-cafe map-icon":"Food"===e?"icon-restaurant map-icon":"Shops"===e?"icon-shop map-icon":"Museum"===e?"icon-museum map-icon":"Sights"===e?"icon-sight map-icon":void 0},getDistance:function(e,t){var n=6371,i=(t.latitude-e.latitude).toRad(),a=(t.longitude-e.longitude).toRad(),r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e.latitude.toRad())*Math.cos(t.latitude.toRad())*Math.sin(a/2)*Math.sin(a/2),o=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),s=n*o;return s}}}]),"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),exploreModule.directive("cmtLeafletMap",["MapService","$timeout",function(e,t){var n=function(t){var n=null!=t.zoom?t.zoom:"13";t.myMap&&t.myMap.remove(),t.myMap=e.createLeafletMap(t.idtomap,t.source[0],t.source[1],null,n)};return{restrict:"E",templateUrl:"explore/directives/CmtLeafletMapDirective.html",scope:{type:"=",source:"=",idtomap:"@",height:"@",destinations:"=",selected:"=",zoom:"@",routes:"="},compile:function(e,t){return null!=L&&null!=L.Icon&&(L.Icon.Default.imagePath="images/leaflet/"),this.link},controller:["$scope",function(i){i.$watch("destinations",function(a,r){isDefined(a)&&t(function(){n(i),e.plotSourceInformation(i.myMap,i.source[0],i.source[1],null),e.plotDestinationInformation(i.myMap,i.destinations,i.type,function(e){i.selected=e,i.$apply()})},100)}),i.$watch("routes",function(a,r){isDefined(a)&&t(function(){n(i),e.plotRoutes(i.myMap,i.routes)},100)})}],link:function(e,t,n,i){},toString:function(){return"cmtLeafletMap"}}}]),exploreModule.filter("displayDistance",["translateFilter",function(e){return function(t){var n="explore.list.unit.m";return isUndefined(t)?"-":(angular.isString(t)&&(t=parseFloat(t)),t>1e3&&(t=parseFloat(t/1e3).toFixed(1),n="explore.list.unit.km"),t+" "+e(n))}}]),exploreModule.run(["$templateCache",function(e){e.put("explore/directives/CmtLeafletMapDirective.html",'<div data-tap-disabled="true" debug-file-path="CmtLeafletMapDirective.html" id="{{idtomap}}" ng-style="{height:height}"></div>'),e.put("explore/templates/pages/ExploreDetailsView.html",'<ion-view debug-file-path="ExploreDetailsView.html"><ion-nav-title translate>explore.details.label.detailsView</ion-nav-title><ion-nav-buttons side="primary"><cmt-menu context="expDetails" is-header-menu="true" list="menuList" menu-style="menuStyle"></cmt-menu></ion-nav-buttons><ion-content class="has-header"><div class="expImageHeight hero" ng-click="openExpandViewModal(imagePath)" ng-style="changeImageTo"><h1 class="expTextAlign">{{expDetails.expDetailsData.name}}</h1></div><div class="contained-pad expDetailsAddmargin expDetailsposition" ng-click="unFadeDiv($event)" ng-class="{&apos;maskpanel&apos;: maskpanel}"><section class="trip-panel" id="segment_0" ng-class="{&apos;maskpanel&apos;: maskpanel}"><header ng-class="{&apos;maskpanel&apos;: maskpanel}"><h1 class="trip-destination {{exploreDetailIcons}}">{{expDetails.detailCategoryLabel|translate}}</h1></header><ng-include src="&apos;explore/templates/partial/ExploreDetailsPartial.html&apos;"></ng-include></section><script id="image-modal.html" type="text/ng-template"><div class="modal desktop-modal image-modal transparent">\n          <img src=\'{{imagePath}}\' class="fullscreen-image"/>\n          <div class="iconClose icon-close" ng-click="closeExpandViewModal()"></div>\n        </div></script></div></ion-content><script id="taxi-driver-modal.html" type="text/ng-template"><div class="modal taxi-driver-modal" ng-attr-style="left: {{setLeft}}">\n      <div class="modalContent">\n        <div class="iconCloseTaxiDriver icon-close alignRight" ng-click="closeTaxiDriverModal()"></div>\n        <div class="taxiDriverAddressContainer">\n          <div class="align-taxi-address">\n            <div class="taxi-address headingText">{{expDetails.expDetailsData.name}}</div>\n            <div class="taxi-address infoText">{{addressForTaxiDriver}}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div></script></ion-view>'),e.put("explore/templates/pages/ExploreMapView.html",'<ion-view debug-file-path="ExploreMapView.html"><ion-nav-title translate>{{mapView? &quot;explore.map.label.mapView&quot;:&quot;explore.list.label.listView&quot;}}</ion-nav-title><ion-nav-buttons side="secondary"><button class="button-clear button icon" ng-click="toggleView()"><i class="icon-list list-icon-size" ng-show="mapView"></i> <i class="icon-map map-icon-size" ng-show="!mapView"></i></button></ion-nav-buttons><ion-nav-back-button class="button-clear"><i class="ion-arrow-left-c"></i></ion-nav-back-button><ng-include src="&apos;explore/templates/partial/ExploreTabs.html&apos;"></ng-include><ion-header-bar class="bar exploreListHeaderAlign has-tabs-top" ng-class="{&apos;ios&apos;:ionic.Platform.isIOS(),&apos;hide&apos;:mapView}"><div class="exploreListHeaderText">{{exploreCategory|translate}}</div></ion-header-bar><ion-content ng-class="{&apos;explore-map-content&apos;:mapView,&apos;exploreListContentAlign&apos;:!mapView}" overflow-scroll><span ng-hide="mapView"><div ng-repeat="exploreResult in model.destinations"><article class="contact-card exploreListContainer"><div class="exploreListCardSection" ng-click="exploreDetails(exploreResult,model.category,exploreCategory,exploreImagePath)"><div class="exploreListCardHeader">{{ exploreResult.name }}</div><div>{{ exploreResult.name }}</div><div><div>{{ exploreResult.distance | displayDistance }}<span ng-if="exploreResult.rating"> - {{&apos;explore.list.result.rating&apos;|translate}} <span class="rating-value">{{exploreResult.rating}}<sub>/10</sub></span></span></div></div></div><img class="exploreListCardImage" ng-click="exploreDetails(exploreResult,model.category,exploreCategory,exploreImagePath)" ng-src="{{exploreResult.imageUrl}}"></article></div></span><span ng-if="mapView"><cmt-leaflet-map class="exploreMapHeight" destinations="model.destinations" height="calc(100% - 106px)" idtomap="{{idToMap}}" selected="model.selectedValue" source="model.source" type="model.category"></cmt-leaflet-map><div class="map-footer-content" ng-click="navigateToDetails(model.selectedValue)"><header class="header-result"><h1 style>{{model.selectedValue.name}}</h1></header><div class="infoEntryContainer"><dl class="infoEntry"><dt class="infoEntryTitle">{{&apos;explore.map.label.distance&apos; | translate}}</dt><dd class="infoEntryContent">{{model.selectedValue.distance | displayDistance}}</dd></dl><dl class="infoEntry"><dt class="infoEntryTitle">{{&apos;explore.map.label.rating&apos; | translate}}</dt><dd class="infoEntryContent rating-value">{{model.selectedValue.rating != null ?model.selectedValue.rating: &quot;-&quot;}}<sub>/10</sub></dd></dl></div></div></span></ion-content></ion-view>'),e.put("explore/templates/partial/ExploreDetailsPartial.html",'<section class="expDetailsHighlight hotel-segment" debug-file-path="ExploreDetailsPartial.html"><div class="cmt-row"><dl><dt style="{{changeTextColor}}" translate>explore.detaillabel.distance</dt><dd class="expDetailsTextBlue">{{expDetails.expDetailsData.location.distance | displayDistance}}</dd></dl><dl><dt style="{{changeTextColor}}" translate class="expDetailsHeaderMargin">explore.detaillabel.rating</dt><dd class="expDetailsHeaderMargin expDetailsTextBlue">{{expDetails.expDetailsData.rating!=null?expDetails.expDetailsData.rating:&quot;-&quot;}}<sub>/10</sub></dd></dl></div><dl><dt style="{{changeTextColor}}" translate>explore.detaillabel.openingHours</dt><dd class="expDetailsTextBlack">{{expDetails.expDetailsData.hours.status!=null?expDetails.expDetailsData.hours.status:&quot;-&quot;}}</dd></dl><div class="expDetailsLabelPadding"><dl><dt style="{{changeTextColor}}" translate>explore.detaillabel.address</dt><dd class="expDetailsTextBlack">{{address}}</dd></dl></div><div ng-class="{&apos;align-plus-icon&apos; : address !== &apos;-&apos;, &apos;align-plus-icon-without-address&apos; : address === &apos;-&apos;}" ng-if="!onClickCallEnabled"></div><div class="expDetailsLabelPadding" ng-show="onClickCallEnabled"><a class="expDetailsFontSize textheader icon-iphone" href ng-click="onClickCall()" style="{{changeAnchorTextColor}}"></a> <a class="expDetailsFontSize textheader expDetailsAddMargin" href ng-click="onClickCall()" style="{{changeAnchorTextColor}}" translate>explore.contactus.call</a><div class="expDetailSinglePadding"></div></div></section>'),e.put("explore/templates/partial/ExploreTabs.html",'<ion-tabs class="explore has-header tabs-color-active-stable tabs-icon-top tabs-top" debug-file-path="ExploreTabs.html" ng-class="{&apos;hidetabs&apos;: hidetabs}"><ion-tab icon-off="icon-cafe size tab-padding tab-disabled" icon-on="icon-cafe size tab-padding" on-select="onClickCategory(&apos;Coffee&apos;, &apos;explore.list.label.coffee&apos;)" title="{{&apos;explore.list.label.cafe&apos;|translate}}" class="align-map-tabs-ie"></ion-tab><ion-tab icon-off="icon-restaurant size tab-padding tab-disabled" icon-on="icon-restaurant size tab-padding" on-select="onClickCategory(&apos;Food&apos;,&apos;explore.list.label.restaurant&apos;)" title="{{&apos;explore.list.label.restaurant&apos;|translate}}"></ion-tab><ion-tab icon-off="icon-shop size tab-padding tab-disabled" icon-on="icon-shop size tab-padding" on-select="onClickCategory(&apos;Shops&apos;,&apos;explore.list.label.shop&apos;)" title="{{&apos;explore.list.label.shop&apos;|translate}}"></ion-tab><ion-tab icon-off="icon-museum size tab-padding tab-disabled" icon-on="icon-museum size tab-padding" on-select="onClickCategory(&apos;Museum&apos;,&apos;explore.list.label.museum&apos;)" title="{{&apos;explore.list.label.museum&apos;|translate}}"></ion-tab><ion-tab icon-off="icon-sight size tab-padding tab-disabled" icon-on="icon-sight size tab-padding" on-select="onClickCategory(&apos;Sights&apos;, &apos;explore.list.label.sight&apos;)" title="{{&apos;explore.list.label.sight&apos;|translate}}"></ion-tab></ion-tabs>')}]),window.discoverModule=angular.module("DiscoverModule",["ionic","CoreModule","ExploreModule","AnalyticsModule","AccountModule"]),window.discoverModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("discover")}]),window.discoverModule.routes={discoverList:{url:"/discoverList/:srcLatLng?/:destLatLng?/:srcName?/:destName?/:srcAddress?/:destAddress?",templateUrl:"discover/templates/pages/DiscoverListView.html",controller:"DiscoverListController",defaultBackState:"genericSearch",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Take me there Results - List").promise()}]}},genericSearch:{url:"/genericSearch/:srcLatLng/:destLatLng/:srcName/:destName",templateUrl:"discover/templates/pages/GenericSearchView.html",controller:"GenericSearchController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Take me there - Generic Search").promise()}]}},discoverResults:{url:"/discoverResults/:srcLatLng/:destLatLng/:srcName/:destName",templateUrl:"discover/templates/pages/DiscoverResultsView.html",controller:"DiscoverResultsController",defaultBackState:"discoverList",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Take me there Result - Detailed - All").promise()}]}},inputSearch:{url:"/inputSearch/:srcLatLng/:destLatLng/:srcName/:destName",templateUrl:"discover/templates/pages/InputSearchView.html",controller:"InputSearchController",secured:!0,defaultBackState:"genericSearch"},segmentResults:{url:"/segmentResults/:srcLatLng/:destLatLng/:srcName/:destName",templateUrl:"discover/templates/pages/SegmentResultsView.html",controller:"SegmentResultsController",defaultBackState:"discoverResults",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Take me there Result - Detailed - Single").promise()}]}},discoverListBkng:{url:"/discoverListBkng/:srcLatLng/:destLatLng/:srcName/:destName/:srcAddress/:destAddress",templateUrl:"discover/templates/pages/DiscoverListView.html",controller:"DiscoverListController",secured:!0,defaultBackState:"triplist",resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Take me there Results - List").promise()}]}},discoverResultsBkng:{url:"/discoverResultsBkng/:srcLatLng/:destLatLng/:srcName/:destName",templateUrl:"discover/templates/pages/DiscoverResultsView.html",controller:"DiscoverResultsController",secured:!0,defaultBackState:"discoverListBkng",resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Take me there Result - Detailed - All").promise()}]}},segmentResultsBkng:{url:"/segmentResultsBkng/:srcLatLng/:destLatLng/:srcName/:destName",templateUrl:"discover/templates/pages/SegmentResultsView.html",controller:"SegmentResultsController",secured:!0,defaultBackState:"discoverResultsBkng",resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Take me there Result - Detailed - Single").promise()}]}}},discoverModule.service("DiscoverService",["$log","$http","$q","I18nService","I18nConfig","LayoutService","PromiseService","DiscoverAnalyticsService","GloballistService","DataManagerService",function(e,t,n,i,a,r,o,s,l,c){e=e.getInstance("DiscoverService"),e.info("Service Started...");var d={ROME_TO_RIO_URL_PATH:getContext("featureConfig.discover.ROME_TO_RIO_URL_PATH"),CLIENT_KEY:getContext("featureConfig.discover.CLIENT_KEY"),USER_CURRENCY_CODE:getContext("USER_CURRENCY_CODE"),LANGUAGE:a.getCurrentDeviceLanguage(),FEATURE_CURRENCY_CODE:getContext("featureConfig.USER_CURRENCY_CODE"),LOCALE_CURRENCY_MAP_KEY:"localeCurrencyMap",CURRENCY_COUNTRY_MAPPING_GLOBAL_LIST:"NO_SL_COUNTRY",createURL:function(){(isUndefined(d.ROME_TO_RIO_URL_PATH)||isUndefined(d.CLIENT_KEY))&&(d.ROME_TO_RIO_URL_PATH=getContext("featureConfig.discover.ROME_TO_RIO_URL_PATH",getContext("featureConfig.takeMeThere.ROME_TO_RIO_URL_PATH")),d.CLIENT_KEY=getContext("featureConfig.discover.CLIENT_KEY",getContext("featureConfig.takeMeThere.CLIENT_KEY")),d.USER_CURRENCY_CODE=getContext("USER_CURRENCY_CODE"),d.LANGUAGE=a.getCurrentDeviceLanguage());var t,i,r=n.defer(),o=d.coordinates,s=o.srcLatLng,l="&oPos="+s,c=o.destLatLng,u="&dpos="+c,g="key="+d.CLIENT_KEY,p="&languageCode="+d.LANGUAGE,m="",f=d.ROME_TO_RIO_URL_PATH+g+l+u;if(getContext("isMobileApp",!1)&&"undefined"!=typeof cordova.plugins.DeviceLocale)cordova.plugins.DeviceLocale.getDeviceLocale(function(e){t=e,m="&currencyCode="+t,f=f+m+p,r.resolve(f)},function(){i=null!=d.FEATURE_CURRENCY_CODE?d.FEATURE_CURRENCY_CODE:d.USER_CURRENCY_CODE,m="&currencyCode="+i,f=f+m+p,r.resolve(f)});else{var v=a.getCountryCodeFromDeviceLocale().toUpperCase();d.getCurrencyCountryMappingList().then(function(e){var t=e,n=t[v];i=isDefined(n)?n:null!=d.FEATURE_CURRENCY_CODE?d.FEATURE_CURRENCY_CODE:d.USER_CURRENCY_CODE,m="&currencyCode="+i,f=f+m+p,r.resolve(f)},function(t){e.error("getCurrencyCodesforLocales: rejecting promise due to backend error"),r.reject(t)})}return r.promise},getCurrencyCountryMappingList:function(){var t=n.defer(),i=c.get(d.LOCALE_CURRENCY_MAP_KEY,c.LOCALSTORAGE);return i&&t.resolve(i),l.getGl(d.CURRENCY_COUNTRY_MAPPING_GLOBAL_LIST).then(function(e){for(var n=e,i={},a=0;a<n.length;a++)i[n[a][0]]=n[a][1];c.set(i,d.LOCALE_CURRENCY_MAP_KEY,{storage:c.LOCALSTORAGE,belongsToUser:!1,ttl:"7d"}),t.resolve(i)},function(n){e.error("getCurrencyCountryMappingList: rejecting promise due to backend error"),t.reject(n)}),t.promise},discoverResults:function(){var e=n.defer();return this.createURL().then(function(n){t.get(n).then(function(t){e.resolve(t)},function(t){o.rejectDueToHttpError({deferred:e,response:t,method:"discoverResults"}),r.toast("discover.list.error.errorInRequest"),s.exceptionOccured("Take me there - Exception occured while fetching Results",!1)})}),e.promise},setDataForResultsPage:function(e){this.paramsForResultsPage=e},getDataForResultsPage:function(){return this.paramsForResultsPage},setDataForSegmentResultsPage:function(e){this.paramsForSegmentResultsPage=e},getDataForSegmentResultsPage:function(){
return this.paramsForSegmentResultsPage},setCoordinates:function(e,t){this.coordinates={srcLatLng:e,destLatLng:t}},setResults:function(e){this.results=e},getResults:function(){return this.results},getZoomLevel:function(e){var t=0;return t=e.distance<1.13?13:e.distance<2.26?12:e.distance<9.1?11:e.distance<18.1?10:e.distance<36.2?9:e.distance<72.2?8:e.distance<144.5?7:e.distance<577.8?5:e.distance<2311.2?3:e.distance<4622.4?ionic.Platform.isIOS()||ionic.Platform.isAndroid()?1:2:ionic.Platform.isIOS()||ionic.Platform.isAndroid()?1:2},getTextMaxLength:function(e){var t=0;return t=320>=e?36:375>=e?41:414>=e?44:768>=e?101:999999},addConvertedTimeToResults:function(e){var t=n.defer(),a=e,r=safeAccess(a,"routes",[]);return i.translate(["discover.list.durationUnits.day","discover.list.durationUnits.hour","discover.list.durationUnits.minute"]).then(function(e){for(var n=0;n<r.length;n++){r[n].totalDurationInConvertedFormat=d.convertMinutesToDayHourMinFormat(r[n].totalDuration,e);for(var i=safeAccess(r[n],"segments",[]),o=0;o<i.length;o++)i[o].transitDurationConvertedFormat=d.convertMinutesToDayHourMinFormat(i[o].transitDuration,e)}t.resolve(a)}),t.promise},convertMinutesToDayHourMinFormat:function(e,t){var n=e,i="",a={},r={day:{value:1440,displayName:t["discover.list.durationUnits.day"]},hour:{value:60,displayName:t["discover.list.durationUnits.hour"]},minute:{value:1,displayName:t["discover.list.durationUnits.minute"]}};for(var o in r){var s=Math.floor(n/r[o].value);s>0?(i+=s+r[o].displayName+" ",a[o]={value:s,displayName:r[o].displayName}):a[o]={value:"",displayName:""},n%=r[o].value}return a.fullDisplayName=i.trim(),a}};return d}]),discoverModule.service("AutocompleteService",["$log","$http","$q","LayoutService","PromiseService","DiscoverAnalyticsService","I18nConfig","$window","$timeout",function(e,t,n,i,a,r,o,s,l){e=e.getInstance("AutocompleteService"),e.info("Service Started...");var c="",d={},u={},g="__onGooglePlaceJsApiLoad",p={GOOGLE_PLACES_LOAD_TIMEOUT_MS:15e3,AUTO_COMPLETE_PATH:getContext("featureConfig.discover.AUTO_COMPLETE_PATH",getContext("featureConfig.takeMeThere.AUTO_COMPLETE_PATH")),CLIENT_KEY:getContext("featureConfig.discover.CLIENT_KEY",getContext("featureConfig.takeMeThere.CLIENT_KEY")),__pendingGooglePlacesPromise:null,__googlePlacesLoadTimeout:null,createURL:function(){p.LANGUAGE=o.getCurrentDeviceLanguage(),isDefined(p.AUTO_COMPLETE_PATH)&&isDefined(p.CLIENT_KEY)||(p.AUTO_COMPLETE_PATH=getContext("featureConfig.discover.AUTO_COMPLETE_PATH",getContext("featureConfig.takeMeThere.AUTO_COMPLETE_PATH")),p.CLIENT_KEY=getContext("featureConfig.discover.CLIENT_KEY",getContext("featureConfig.takeMeThere.CLIENT_KEY")));var e="key="+p.CLIENT_KEY,t="&languageCode="+p.LANGUAGE,n=p.AUTO_COMPLETE_PATH+e+t;return n},_getGooglePlacesJsApiUrl:function(){var t=getContext("featureConfig.manualEtrManagement.googlePlacesApiKey",getContext("featureConfig.googlePlaces.apiKey"));t||e.error("You need to define Google Places API key in appConfig.js.");var n="key="+t;return"https://maps.googleapis.com/maps/api/js?"+n+"&libraries=places&callback="+g},loadGooglePlacesJsApi:function(){if(isDefined(p.__pendingGooglePlacesPromise))e.info("Already pending the load of Google Places API, reusing the pending promise");else{var t=n.defer();if(safeAccess(window,"google.maps.places"))e.info("Google Places API already loaded"),t.resolve();else{window[g]=function(){l.cancel(p.__googlePlacesLoadTimeout),e.info("Google Places API loaded"),t.resolve(),window[g]=null},p.__googlePlacesLoadTimeout=l(function(){e.error("Failed to load Google Places API, timeout"),window[g]=function(){},t.reject(),p.__pendingGooglePlacesPromise=null},p.GOOGLE_PLACES_LOAD_TIMEOUT_MS);var i=s.document.createElement("script");i.src=p._getGooglePlacesJsApiUrl(),p._appendChildToHead(i)}p.__pendingGooglePlacesPromise=t.promise}return p.__pendingGooglePlacesPromise},_appendChildToHead:function(e){s.document.getElementsByTagName("head")[0].appendChild(e)},setSelectedField:function(e){c=e},setOrigin:function(e){d=e},setDestination:function(e){u=e},getOrigin:function(){return d},getDestination:function(){return u},getSelectedField:function(){return c},getSuggestions:function(e,i){var a=n.defer(),r=i,o=this.createURL();return o+="&query="+i,t.get(o).then(function(t){0===t.data.places.length?p.getSuggestionsFromGoogle(r,a,e):a.resolve(t)},function(){p.getSuggestionsFromGoogle(r,a,e)}),a.promise},getSuggestionsFromGoogle:function(e,t,n){n.getPlacePredictions({input:e},function(e){this.data=e,t.resolve({data:{predictions:safeAccess(this,"data",[])}})},function(e){a.rejectDueToHttpError({deferred:t,response:e,method:"getSuggestions"}),i.toast("discover.list.error.errorInRequest"),r.exceptionOccured("Take me there AutoComplete - Exception occured while fetching Results",!1)})}};return p}]),discoverModule.service("DiscoverAnalyticsService",["$log","$q","$http","PromiseService","LayoutService","AnalyticsService",function(e,t,n,i,a,r){e=e.getInstance("DiscoverAnalyticsService"),e.info("Service Started...");var o={CATEGORY:"Take me there",gotDiscoverResultsList:function(e){r.runSafe(function(){var t="-",n="Take me there - Results - List";switch(e){case"genericSearch":t="From - Take me there-Generic Search";break;case"exploreDetails":t="From - Explore-Details";break;case CONSTANTS.TRIP_EXPANDED:t=CONSTANTS.TRIP_DETAILS;break;case"header":t="From - Header Search"}var i=this.getPropertiesFactory().create("Discover",t).push().build();this.sendEvent(n,i,o.CATEGORY)})},fromAndToLocationReversed:function(e){r.runSafe(function(){var t="-",n="Take me there - Results - From and To Location reversed";switch(e){case"genericSearch":t="From - Take me there-Generic Search";break;case"exploreDetails":t="From - Explore-Details";break;case CONSTANTS.TRIP_EXPANDED:t=CONSTANTS.TRIP_DETAILS;break;case"header":t="From - Header Search"}var i=this.getPropertiesFactory().create("Discover",t).push().build();this.sendEvent(n,i,o.CATEGORY)})},modifyDiscoverResults:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Discover","-").push().build();this.sendEvent("Take me there "+e+" Clicked",t,o.CATEGORY)})},modifiedDiscoverResults:function(e,t){r.runSafe(function(){var n=t.join(", ");"Filter"===e?n="Selected Transports : "+n:"Sort"===e&&(n="Sorted Results by : "+n);var i=this.getPropertiesFactory().create("Discover",n).push().build();this.sendEvent("Take me there - "+e+" Applied",i,o.CATEGORY)})},openedDiscoverResultDetails:function(e){isDefined(e)&&e.length>0&&r.runSafe(function(){var t=e.map(function(e){return e.type}).join(", ");t="Contains : "+t;var n=this.getPropertiesFactory().create("Discover",t).push().build();this.sendEvent("Take me there - Result - Detailed",n,o.CATEGORY)})},openedDiscoverGenericSearchPage:function(e,t,n){r.runSafe(function(){var i="-";switch(e){case"booking":i="From - Booking";break;case CONSTANTS.TRIP_EXPANDED:i=CONSTANTS.TRIP_DETAILS+(t?"-Source Available":"-Source Missing")+(n?"-Destination Available":"-Destination Missing")}var a=this.getPropertiesFactory().create("Discover",i).push().build();this.sendEvent("Take me there - Generic Search",a,o.CATEGORY)})},exceptionOccured:function(e,t){r.runSafe(function(){this.sendException({message:e,isFatal:t})})},expandedMapInDiscoverResultDetails:function(e){isDefined(e)&&e.length>0&&r.runSafe(function(){var t=e.map(function(e){return e.type}).join(", ");t="Contains : "+t;var n=this.getPropertiesFactory().create("Discover",t).push().build();this.sendEvent("Take me there - Clicked on Map Zoom",n,o.CATEGORY)})},discoverGenericSearchInputClicked:function(e){r.runSafe(function(){var t=this.getPropertiesFactory().create("Discover","-").push().build();this.sendEvent("Take me there - Generic Search - "+e+" Clicked",t,o.CATEGORY)})},discoverGenericSearchInputValueSelected:function(e,t){r.runSafe(function(){var n="Selected Value : "+t,i=this.getPropertiesFactory().create("Discover",n).push().build();this.sendEvent("Take me there - Generic Search - "+e+" Selected",i,o.CATEGORY)})},toString:function(){return"DiscoverAnalyticsService"}};return o}]),discoverModule.controller("DiscoverListController",["$scope","$log","$state","$rootScope","$ionicModal","$ionicHistory","$ionicPopup","$filter","OrchestratorChiefService","DiscoverService","I18nService","$stateParams","LayoutService","GpsCheckinService","DiscoverAnalyticsService","$ionicActionSheet","PostMessageService","AuthenticationService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v,h){t=t.getInstance("DiscoverListController"),t.info("Controller Started..."),e.isGuestMode=!h.isLogged();var S,C=2,T=1,b="navBarButtonTapEvent",E="navBarButtonChangeEvent",A=function(){v.send({type:E,buttonType:"sort",buttonID:T}),v.send({type:E,buttonType:"filter",buttonID:C})};e.$on("$ionicView.enter",function(){A(),S=v.when(b),S.then(function(t){switch(t.buttonID){case T:e.openSortModal();break;case C:e.goToFilters()}})});var y=function(){v.send({type:E,buttonType:null,buttonID:T}),v.send({type:E,buttonType:null,buttonID:C})};e.$on("$ionicView.leave",function(){y(),v.cancelReceive(b,S.revocationId)});var L=function(e){return!(isDefined(e)&&""!==e.toString().trim())};e.goBack=function(){var t=["discoverList","guest-discoverList","more-discoverList","more-guest-discoverList","discoverListBkng","guest-discoverListBkng","more-discoverListBkng","more-guest-discoverListBkng"];if(-1!=t.indexOf(e.currState)){var n=-1,i=r.viewHistory(),a=i.currentView.backViewId,o=["discoverList","more-discoverList","guest-discoverList","more-guest-discoverList","discoverResults","more-discoverResults","guest-discoverResults","more-guest-discoverResults","segmentResults","more-segmentResults","guest-segmentResults","more-guest-segmentResults","discoverListBkng","more-discoverListBkng","discoverResultsBkng","more-discoverResultsBkng","segmentResultsBkng","more-segmentResultsBkng"];if(isDefined(i))for(var s=0;null!==a;s++){if(-1===o.indexOf(safeAccess(i.views[a],"stateName",!1))){e.ismovingForward=!0;break}n--,a=safeAccess(i.views[a],"backViewId",null)}l.deregisterCustomBackAction(),r.goBack(n)}},e.getResults=function(){return L(e.destLatLng)&&L(e.$stateParams.destAddress)||L(e.srcLatLng)&&L(e.$stateParams.srcAddress)?void d.translate(["discover.list.error.noResults","discover.list.error.locationErrorMessage"]).then(function(e){g.toast(e["discover.list.error.locationErrorMessage"])}):void(!e.destLatLng&&e.$stateParams.destAddress||!e.srcLatLng&&e.$stateParams.srcAddress||(g.loading(!0),c.discoverResults().then(function(t){isDefined(t)?c.addConvertedTimeToResults(t.data).then(function(t){e.results=t,c.setResults(e.results),e.filter_types=e.extractFilter(e.results),e.filtersApplied=e.filter_types.slice(),e.filtersSelected=e.filter_types.slice(),e.$stateParams.srcName===CONSTANTS.DISCOVER_CURRENTLOCATION?d.translate(CONSTANTS.DISCOVER_CURRENTLOCATION).then(function(t){e.fromLocation=t}):e.fromLocation=e.$stateParams.srcName,e.$stateParams.destName===CONSTANTS.DISCOVER_CURRENTLOCATION?d.translate(CONSTANTS.DISCOVER_CURRENTLOCATION).then(function(t){e.toLocation=t}):e.toLocation=e.$stateParams.destName,e.getData(),g.loading(!1)}):(d.translate("discover.results.error.noResults").then(function(e){g.toast(e)}),e.results="",g.loading(!1))},function(e){t.error(e),g.loading(!1)}),m.gotDiscoverResultsList(safeAccess(l.getPreviousView(),"stateName",""))))},e.setFromAndToLocation=function(){e.$stateParams.srcName===CONSTANTS.DISCOVER_CURRENTLOCATION?d.translate(CONSTANTS.DISCOVER_CURRENTLOCATION).then(function(t){e.fromLocation=t}):e.fromLocation=e.$stateParams.srcName,e.$stateParams.destName===CONSTANTS.DISCOVER_CURRENTLOCATION?d.translate(CONSTANTS.DISCOVER_CURRENTLOCATION).then(function(t){e.toLocation=t}):e.toLocation=e.$stateParams.destName},e.openFilterModal=function(){a.fromTemplateUrl("discover/templates/partial/FilterListView.html",{scope:e,animation:"slide-in-up",focusFirstInput:!1}).then(function(t){e.filterModal=t,y(),g.showModal(e.filterModal)}),m.modifyDiscoverResults("Filter")};var D,_=["price","duration","transfer"],w=["tag","hold","urban-transportation"],I="discover.list.sortlist.",M=function(e,t){return'<i id="menu-'+e+'" class="space-rt icon icon-'+w[e]+'"></i>'+t[I+_[e]]},k=function(){D=void 0,A()},R=function(){k()};e.openSortModal=function(){d.translate(_.concat(["sortlabel"]).map(function(e){return I+e}).concat(["core.button.cancel"])).then(function(t){D=f.show({buttons:[{text:M(0,t)},{text:M(1,t)},{text:M(2,t)}],titleText:t[I+"sortlabel"],cancelText:t["core.button.cancel"],cancel:R,buttonClicked:function(t){return e.sortBy(_[t]),A(),!0}}),window.closeModal=D,v.send({type:"modalDisplayedEvent",closeButtonEnabled:!1,closeModalAction:"closeModal"})}),y(),m.modifyDiscoverResults("Sort")},e.closeFilterModal=function(){g.hideModal(e.filterModal),A()};var P=function(){if(e.filtersApplied)for(var t=0;t<e.filtersApplied.length;t++)e[e.filtersApplied[t]]=!0};e.applyFilter=function(){e.filtersApplied=e.filtersSelected.slice(),e.getData(),e.closeFilterModal(),m.modifiedDiscoverResults("Filter",e.filtersApplied)},e.closeModal=function(){if(e.newFiltersSelected)for(var t=0;t<e.newFiltersSelected.length;t++)e[e.newFiltersSelected[t]]=!1;e.filtersSelected=e.filtersApplied.slice(),e.closeFilterModal()},e.addFilter=function(t){if(-1===e.filtersSelected.indexOf(t))e[t]=!0,e.filtersSelected.push(t),e.newFiltersSelected.push(t);else{e[t]=!1;var n=e.filtersSelected.indexOf(t);e.filtersSelected.splice(n,1),e.newFiltersSelected.splice(n,1)}},e.extractFilter=function(e){var t=[],n=[];if(e.routes){for(var i=0;i<e.routes.length;i++)if(e.routes[i].segments)for(var a=0;a<e.routes[i].segments.length;a++)-1==n.indexOf(e.routes[i].segments[a].vehicle)&&n.push(e.routes[i].segments[a].vehicle);for(var r=0;r<n.length;r++){var o=e.vehicles[n[r]].kind;-1==t.indexOf(o)&&"unknown"!==o&&t.push(o)}}return t},e.splitFilterInChunksOfTwo=function(e,t){var n,i=[];for(n=0;n<e.length;n+=t)i.push(e.slice(n,n+t));return i};var x=!0;e.goToFilters=function(){if(e.newFiltersSelected=[],isDefined(e.filter_types)){var t=e.splitFilterInChunksOfTwo(e.filter_types,2);e.filters=t,e.openFilterModal(),P()}},e.init=function(){e.setFromAndToLocation(),"Current Location"===e.$stateParams.srcLatLng?(g.loading(!0),p.getGeolocationData().then(function(t){g.loading(!1),null!=t&&null!=t.coords&&null!=t.coords.latitude&&null!=t.coords.longitude?(e.srcLatLng=t.coords.latitude+","+t.coords.longitude,e.destLatLng=e.$stateParams.destLatLng,c.setCoordinates(e.srcLatLng,e.destLatLng),e.getResults()):d.translate("discover.list.error.locationNotFound").then(function(e){g.toast(e)})},function(e){g.loading(!1),d.translate(["discover.list.error.gpsErrorTitle","discover.list.error.gpsErrorMessage"]).then(function(n){t.info("Error in GPS Settings - "+e),o.alert({title:n["discover.list.error.gpsErrorTitle"],template:n["discover.list.error.gpsErrorMessage"]})})})):(e.srcLatLng=e.$stateParams.srcLatLng,e.destLatLng=e.$stateParams.destLatLng,c.setCoordinates(e.srcLatLng,e.destLatLng),e.getResults())},e.reconstructFromAppliedFilters=function(t){var n=[];if(t.routes)for(var i=0;i<t.routes.length;i++){if(t.routes[i].segments)for(var a=0;a<t.routes[i].segments.length;a++){var r=t.vehicles[t.routes[i].segments[a].vehicle].kind;if("unknown"===r&&(a>0&&(t.routes[i].segments[a-1].arrPlace=t.routes[i].segments[a].arrPlace),t.routes[i].segments.splice(a,1)),-1===e.filtersApplied.indexOf(r)&&"unknown"!==r){x=!1;break}x=!0}x!==!1&&-1===n.indexOf(t.routes[i])&&n.push(t.routes[i])}return n},e.goToSortPage=function(){isDefined(e.results)&&e.openSortModal()},e.sortBy=function(t){e.sortType=t,e.getSortedData(),m.modifiedDiscoverResults("Sort",[t])},e.getData=function(){e.routes=e.reconstructFromAppliedFilters(e.results),e.getSortedData()},e.getSortedData=function(){var t=e.sortType,n="";"price"===t?n="indicativePrices[0].price":"duration"===t?n="totalDuration":"transfer"===t&&(n="segments.length"),e.routes=s("orderBy")(e.routes,n)},e.showResultsOnMap=function(t){e.ismovingForward=!0;var n="discoverResults";e.isFromBooking&&(n="discoverResultsBkng"),e.isGuestMode&&(n="guest-"+n);var i=[],a={},r=[e.results.places[t.depPlace].lat,e.results.places[t.depPlace].lng],o=e.results.vehicles;if(t.segments)for(var s=0;s<t.segments.length;s++)a=isDefined(t.segments[s].path)?{path:t.segments[s].path,type:e.results.vehicles[t.segments[s].vehicle].kind}:{source:{lat:e.results.places[t.segments[s].depPlace].lat,lng:e.results.places[t.segments[s].depPlace].lng},destination:{lat:e.results.places[t.segments[s].arrPlace].lat,lng:e.results.places[t.segments[s].arrPlace].lng},type:e.results.vehicles[t.segments[s].vehicle].kind},i.push(a);e.paramsForResultsPage={segmentPaths:i,route:t,vehicleKinds:o,source:r,places:e.results.places},m.openedDiscoverResultDetails(i),c.setDataForResultsPage(e.paramsForResultsPage),l.navigateTo(n,{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation})},e.$on("$ionicView.beforeLeave",function(t,n){isDefined(e.filterModal)&&e.closeFilterModal()}),e.triggerFilter=function(){i.$broadcast("FilterView")},e.registerFilterView=function(){"function"!=typeof e.deregisterFilterView&&(e.deregisterFilterView=e.$on("FilterView",function(){e.goToFilters()}))},e.registerFilterView(),e.triggerSort=function(){i.$broadcast("SortView")},e.registerSortView=function(){"function"!=typeof e.deregisterSortView&&(e.deregisterSortView=e.$on("SortView",function(){e.goToSortPage()}))},e.registerSortView(),e.$on("$ionicView.enter",function(){e.isFromBooking=!1,e.ismovingForward=!1;var t=l.getPreviousView(),n=r.viewHistory();isDefined(t)&&isDefined(n)&&("genericSearch"===t.stateName||"discoverListBkng"===safeAccess(n.currentView,"stateName",!1))&&(e.isFromBooking=!0),e.registerFilterView(),e.registerSortView(),l.registerCustomBackAction(e.goBack)}),e.$on("$ionicView.beforeEnter",function(t,i){if(e.currState=n.current.name,i.direction&&"back"!==i.direction){e.$stateParams={};for(var a in u)e.$stateParams[a]=u[a];e.$watchGroup(["$stateParams.srcLatLng","$stateParams.destLatLng"],function(t,n){t[0]===n[0]&&t[1]===n[1]||e.init()})}}),e.$on("$ionicView.leave",function(){l.deregisterCustomBackAction()}),e.$on("$stateChangeStart",function(t,n,i,a,r){var o=["discoverList","more-discoverList","discoverListBkng","more-discoverListBkng"];-1!=o.indexOf(a.name)&&("function"==typeof e.deregisterFilterView&&(e.deregisterFilterView(),e.deregisterFilterView=null),"function"==typeof e.deregisterSortView&&(e.deregisterSortView(),e.deregisterSortView=null));var s=l.getPreviousView();isDefined(s)&&!e.ismovingForward&&n.name===s.stateName&&(t.preventDefault(),e.goBack())}),i.getVehicleIcon=function(e){switch(e){case"bus":case"tram":case"shuttle":return"urban-transportation";case"taxi":case"rideshare":case"towncar":return"taxi-booking-active";case"plane":return"flight";case"subway":return"train";case"foot":return"walk";case"animal":return"animals";case"cablecar":return"cable-car";default:return e}}}]),discoverModule.controller("GenericSearchController",["$scope","$rootScope","$log","OrchestratorChiefService","AutocompleteService","$stateParams","I18nService","GpsCheckinService","LayoutService","$ionicPopup","$ionicModal","DiscoverAnalyticsService","AuthenticationService","$q",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p){n=n.getInstance("GenericSearchController"),n.info("Controller Started..."),e.$stateParams=r,e.closeicon=t.closeicon,e.takeMeThereImagePath="images/takemethere_background.png",e.isGuestMode=!g.isLogged(),screen.width>=768?e.backButtonClass="":e.backButtonClass=ionic.Platform.isIOS()?"ion-ios-arrow-back":"ion-android-arrow-back",e.search={srcName:"",destName:"",srcLatLng:"",destLatLng:""},e.init=function(){var t=p.defer();a.loadGooglePlacesJsApi().then(function(){e.autocompleteService=new google.maps.places.AutocompleteService,e.placesService=new google.maps.places.PlacesService(document.getElementById("hidden-google-places-div"))},function(e){t.reject(),l.toastError("core.backendErrorCodes.000000")}),o.translate("discover.currentlocation").then(function(t){e.currentLocationTranslated=t})};var m=function(){return""!==e.search.srcName&&""!==e.search.destName};e.search.destLatLng=e.$stateParams.destLatLng,e.goToDiscoverList=function(){m()&&(e.isGuestMode?i.navigateTo("guest-discoverListBkng",e.search):i.navigateTo("discoverListBkng",e.search))},e.fieldTap=function(t){a.setSelectedField(t),e.openInputModal(),u.discoverGenericSearchInputClicked(t)},e.openInputModal=function(){d.fromTemplateUrl("discover/templates/partial/InputSearchView.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(t){e.inputModal=t,e.inputModal.searchLabel="",e.suggestions="",e.hideCurrentLocation=!1,e.showNoResultsLabel=!1,l.showModal(e.inputModal)})},e.closeModal=function(){e.closeInputModal()},e.closeInputModal=function(){l.removeModal(e.inputModal).then(function(){e.inputModal=null})},e.openAutocomplete=function(){e.inputModal.searchLabel.length>0?a.getSuggestions(e.autocompleteService,e.inputModal.searchLabel).then(function(t){if(isDefined(t)){if(isUndefined(e.inputModal)||0===e.inputModal.searchLabel.length)return;e.suggestions=t.data,e.hideCurrentLocation=!0,e.showNoResultsLabel=!1,0!==safeAccess(e.suggestions,"predictions.length")&&0!==safeAccess(e.suggestions,"places.length")||(e.hideCurrentLocation=!1,e.showNoResultsLabel=!0)}else o.translate("discover.results.error.noResults").then(function(e){l.toast(e)}),e.suggestions=""},function(e){n.error(e)}):(e.suggestions.places=[],e.suggestions.predictions=[],e.hideCurrentLocation=!1,e.showNoResultsLabel=!1)},e.showSearchPlaceholder=!0,e.$on("$ionicView.beforeLeave",function(t,n){isDefined(e.inputModal)&&e.closeInputModal()}),e.getPlaceCoordinatesfromGoogleApi=function(t,n,i){var a=new google.maps.places.PlacesService(document.getElementById("hidden-google-places-div"));a.getDetails({placeId:t},function(t,a){a===google.maps.places.PlacesServiceStatus.OK?("from"===i?(e.search.srcLatLng=t.geometry.location.lat()+","+t.geometry.location.lng(),e.search.srcName=n):(e.search.destLatLng=t.geometry.location.lat()+","+t.geometry.location.lng(),e.search.destName=n),e.closeInputModal()):console.warn("placesService.getDetails: something went wrong")})},e.setPlace=function(t){"from"===a.getSelectedField()&&(t.description?e.getPlaceCoordinatesfromGoogleApi(t.place_id,t.description,"from"):(e.search.srcLatLng=t.lat+","+t.lng,e.search.srcName=t.longName,e.closeInputModal())),"to"===a.getSelectedField()&&(t.description?e.getPlaceCoordinatesfromGoogleApi(t.place_id,t.description,"to"):(e.search.destLatLng=t.lat+","+t.lng,e.search.destName=t.longName,e.closeInputModal())),u.discoverGenericSearchInputValueSelected(a.getSelectedField(),t.longName)},e.getLocation=function(){l.loading(!0),s.getGeolocationData().then(function(t){if(l.loading(!1),isDefined(t)&&isDefined(t.coords.latitude)&&isDefined(t.coords.longitude)){var n={lat:t.coords.latitude,lng:t.coords.longitude,longName:e.currentLocationTranslated};e.setPlace(n)}else o.translate("discover.list.error.locationNotFound").then(function(e){l.toast(e)})},function(e){l.loading(!1),o.translate("discover.list.error.gpsErrorMessage").then(function(t){n.info("Error in GPS Settings - "+e),c.alert({title:"",template:t})})})}}]),discoverModule.controller("DiscoverResultsController",["$scope","$log","$state","OrchestratorChiefService","DiscoverService","$stateParams","$ionicModal","DiscoverAnalyticsService","AuthenticationService",function(e,t,n,i,a,r,o,s,l){t=t.getInstance("DiscoverResultsController"),t.info("Controller Started..."),e.init=function(){e.idToMap="tkMeThrRes"+(new Date).getMilliseconds(),e.modal=null,e.textLength=a.getTextMaxLength(screen.width),e.$stateParams=r,e.fromLocation=e.$stateParams.srcName,e.toLocation=e.$stateParams.destName,e.srcLatLng=r.srcLatLng,e.destLatLng=r.destLatLng,e.resultsPageData=a.getDataForResultsPage(),e.path=e.resultsPageData.segmentPaths,e.route=e.resultsPageData.route,e.vehicleKinds=e.resultsPageData.vehicleKinds,e.source=e.resultsPageData.source,e.places=e.resultsPageData.places,e.zoomLevel=a.getZoomLevel(e.route),e.currState=n.current.name,1!=e.zoomLevel&&2!=e.zoomLevel||(e.source=[0,0]),e.iosClass=ionic.Platform.isIOS()?"ios":"",e.setStyleForLocation()},e.isGuestMode=!l.isLogged(),e.openExpandViewModal=function(){e.idToMapZoom="mapZoom"+(new Date).getMilliseconds(),o.fromTemplateUrl("map-image-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t,e.modal.show()}),s.expandedMapInDiscoverResultDetails(e.path)},e.setStyleForLocation=function(){e.maxWidth=window.innerWidth-90+"px"},e.closeExpandViewModal=function(){e.modal.remove().then(function(){e.modal=null})},e.goToSegmentView=function(t,n){if(!(e.route.segments.length<=1)){var r=[e.path[n]],o="",l="",c="",d=[safeAccess(e,"places["+t.depPlace+"].lat"),safeAccess(e,"places["+t.depPlace+"].lng")];"Destination"===e.places[t.arrPlace].shortName?(o=e.toLocation,l=e.$stateParams.destLatLng):(o=safeAccess(e.places[t.arrPlace],"shortName"),l=safeAccess(e.places[t.arrPlace],"lat")+","+safeAccess(e.places[t.arrPlace],"lng"));var u="";0===n?(u=e.fromLocation,c=e.$stateParams.srcLatLng):(u=safeAccess(e.places[t.depPlace],"shortName"),c=safeAccess(e.places[t.depPlace],"lat")+","+safeAccess(e.places[t.depPlace],"lng"));var g={segmentPathAndType:r,place:o,segment:t,source:d};a.setDataForSegmentResultsPage(g);var p="segmentResults";e.isFromBooking&&(p="segmentResultsBkng"),e.isGuestMode&&(p="guest-"+p),s.openedDiscoverResultDetails(r),i.navigateTo(p,{srcLatLng:c,destLatLng:l,srcName:u,destName:o})}},e.$on("$ionicView.beforeLeave",function(t,n){isDefined(e.modal)&&e.closeExpandViewModal()}),e.$on("$ionicView.enter",function(){e.isFromBooking=!1;var t=i.getPreviousView();isDefined(t)&&"discoverListBkng"===t.stateName&&(e.isFromBooking=!0)}),e.$on("$ionicView.beforeEnter",function(){e.init(),e.$watchGroup(["srcLatLng","destLatLng"],function(t,n){t[0]===n[0]&&t[1]===n[1]||(-1!==e.currState.indexOf("Bkng")?e.isGuestMode?i.navigateTo("guest-discoverListBkng",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}):i.navigateTo("discoverListBkng",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}):e.isGuestMode?i.navigateTo("guest-discoverList",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}):i.navigateTo("discoverList",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}))})})}]),discoverModule.controller("SegmentResultsController",["$scope","$log","$state","DiscoverService","$stateParams","$ionicModal","DiscoverAnalyticsService","OrchestratorChiefService","AuthenticationService",function(e,t,n,i,a,r,o,s,l){t=t.getInstance("SegmentResultsController"),t.info("Controller Started..."),e.init=function(){e.textLength=i.getTextMaxLength(screen.width),e.idToMap="tkMeThrSeg"+(new Date).getMilliseconds(),e.$stateParams=a,e.srcLatLng=e.$stateParams.srcLatLng,e.destLatLng=e.$stateParams.destLatLng,e.fromLocation=e.$stateParams.srcName,e.toLocation=e.$stateParams.destName,e.segmentResultsPageData=i.getDataForSegmentResultsPage(),e.source=e.segmentResultsPageData.source,e.segment=e.segmentResultsPageData.segment,e.path=e.segmentResultsPageData.segmentPathAndType,e.place=e.segmentResultsPageData.place,e.zoomLevel=i.getZoomLevel(e.segment),e.currState=n.current.name,1!=e.zoomLevel&&2!=e.zoomLevel||(e.source=[0,0]),e.iosClass=ionic.Platform.isIOS()?"ios":"",e.setStyleForLocation()},e.isGuestMode=!l.isLogged(),e.setStyleForLocation=function(){e.maxWidth=window.innerWidth-90+"px"},e.openExpandViewModal=function(){e.idToMapZoom="segMapZoom"+(new Date).getMilliseconds(),r.fromTemplateUrl("map-image-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t,e.modal.show()}),o.expandedMapInDiscoverResultDetails(e.path)},e.closeExpandViewModal=function(){e.modal.remove().then(function(){e.modal=null})},e.$on("$ionicView.beforeLeave",function(t,n){isDefined(e.modal)&&e.closeExpandViewModal()}),e.$on("$ionicView.beforeEnter",function(){e.init(),e.$watchGroup(["srcLatLng","destLatLng"],function(t,n){t[0]===n[0]&&t[1]===n[1]||(-1!==e.currState.indexOf("Bkng")?e.isGuestMode?s.navigateTo("guest-discoverListBkng",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}):s.navigateTo("discoverListBkng",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}):e.isGuestMode?s.navigateTo("guest-discoverList",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}):s.navigateTo("discoverList",{srcLatLng:e.srcLatLng,destLatLng:e.destLatLng,srcName:e.fromLocation,destName:e.toLocation}))})})}]),discoverModule.directive("headerGenericSearch",["$log","$ionicModal","$ionicPopup","I18nService","OrchestratorChiefService","DiscoverAnalyticsService","GpsCheckinService","AutocompleteService","LayoutService","$q",function(e,t,n,i,a,r,o,s,l,c){return e=e.getInstance("headerGenericSearch"),e.info("Directive Started..."),{restrict:"E",templateUrl:"discover/directives/HeaderGenericSearchView.html",scope:{srcName:"=",destName:"=",srcLatLng:"=",destLatLng:"=",invokingState:"=",stateParams:"=?"},controller:["$scope","AutocompleteService","$rootScope",function(s,d,u){var g=c.defer();s.closeicon=u.closeicon,s.openInputModal=function(e){t.fromTemplateUrl("discover/templates/partial/InputSearchView.html",{scope:s,animation:"slide-in-up",focusFirstInput:!1}).then(function(t){l.stopLoading(),s.inputModal=t,isDefined(e)?(l.loading(!0),s.inputModal.searchLabel=e,s.openAutocomplete()):s.inputModal.searchLabel="",s.suggestions="",s.hideCurrentLocation=!1,s.showNoResultsLabel=!1,l.showModal(s.inputModal)})},"discoverList"!==s.invokingState&&"discoverListBkng"!==s.invokingState&&s.invokingState!==CONSTANTS.GUEST_DISCOVERLIST&&s.invokingState!==CONSTANTS.GUEST_DISCOVER_LIST_BKG||(!s.destLatLng&&s.stateParams.destAddress&&(s.openInputModal(s.stateParams.destAddress),d.setSelectedField("to")),!s.srcLatLng&&s.stateParams.srcAddress&&(s.openInputModal(s.stateParams.srcAddress),d.setSelectedField("from"))),s.searchDisabled=!0,"discoverList"!==s.invokingState&&"discoverListBkng"!==s.invokingState&&s.invokingState!==CONSTANTS.GUEST_DISCOVERLIST&&s.invokingState!==CONSTANTS.GUEST_DISCOVER_LIST_BKG||(s.searchDisabled=!1),s.iosClass=ionic.Platform.isIOS()&&getContext("isMobileApp",!0)?"ios":"",screen.width>=768?s.backButtonClass="":s.backButtonClass=ionic.Platform.isIOS()?"ion-ios-arrow-back":"ion-android-arrow-back",s.fieldTap=function(e){l.startLoading(),d.setSelectedField(e),s.openInputModal(),r.discoverGenericSearchInputClicked(e)},s.getPlaceCoordinatesfromGoogleApi=function(e,t,n){s.placesService.getDetails({placeId:e},function(e,i){console.log(e.geometry.location.lat()),i===google.maps.places.PlacesServiceStatus.OK?("from"===n?(s.srcLatLng=e.geometry.location.lat()+","+e.geometry.location.lng(),s.srcName=t):(s.destLatLng=e.geometry.location.lat()+","+e.geometry.location.lng(),s.destName=t),"discoverListBkng"!==s.invokingState&&"discoverList"!==s.invokingState&&s.invokingState!==CONSTANTS.GUEST_DISCOVER_LIST_BKG&&s.invokingState!==CONSTANTS.GUEST_DISCOVERLIST||(s.stateParams.srcLatLng=s.srcLatLng,s.stateParams.destLatLng=s.destLatLng,s.stateParams.srcName=s.srcName,s.stateParams.destName=s.destName),s.closeInputModal()):console.warn("placesService.getDetails: something went wrong")})},s.setPlace=function(e){"from"===d.getSelectedField()&&(e.description?s.getPlaceCoordinatesfromGoogleApi(e.place_id,e.description,"from"):(s.srcLatLng=e.lat+","+e.lng,s.srcName=e.longName,s.closeInputModal())),"to"===d.getSelectedField()&&(e.description?s.getPlaceCoordinatesfromGoogleApi(e.place_id,e.description,"to"):(s.destLatLng=e.lat+","+e.lng,s.destName=e.longName,s.closeInputModal())),"discoverListBkng"!==s.invokingState&&"discoverList"!==s.invokingState&&s.invokingState!==CONSTANTS.GUEST_DISCOVERLIST&&s.invokingState!==CONSTANTS.GUEST_DISCOVER_LIST_BKG||e.description||(s.stateParams.srcLatLng=s.srcLatLng,
s.stateParams.destLatLng=s.destLatLng,s.stateParams.srcName=s.srcName,s.stateParams.destName=s.destName),r.discoverGenericSearchInputValueSelected(d.getSelectedField(),e.longName)},s.closeModal=function(){s.closeInputModal(),"discoverList"!==s.invokingState&&"discoverListBkng"!==s.invokingState&&s.invokingState!==CONSTANTS.GUEST_DISCOVERLIST&&s.invokingState!==CONSTANTS.GUEST_DISCOVER_LIST_BKG||(!s.destLatLng&&s.stateParams.destAddress||!s.srcLatLng&&s.stateParams.srcAddress)&&a.navigateBack()},s.closeInputModal=function(){l.removeModal(s.inputModal).then(function(){s.inputModal=null})},s.getAutoCompleteSuggestions=function(){s.inputModal.searchLabel.length>0?d.getSuggestions(s.autocompleteService,s.inputModal.searchLabel).then(function(e){if(isDefined(e)){if(isDefined(s.inputModal)&&0===s.inputModal.searchLabel.length)return;s.suggestions=e.data,s.hideCurrentLocation=!0,s.showNoResultsLabel=!1,0!==safeAccess(s.suggestions,"predictions.length")&&0!==safeAccess(s.suggestions,"places.length")||(s.hideCurrentLocation=!1,s.showNoResultsLabel=!0),l.loading(!1)}else i.translate("discover.results.error.noResults").then(function(e){l.toast(e)}),s.suggestions="",l.loading(!1)},function(t){e.error(t),l.loading(!1)}):(s.suggestions.places=[],s.suggestions.predictions=[],s.hideCurrentLocation=!1,s.showNoResultsLabel=!1)},s.openAutocomplete=function(){window.google&&window.google.maps&&window.google.maps.places?(s.autocompleteService=new google.maps.places.AutocompleteService,s.placesService=new google.maps.places.PlacesService(document.getElementById("hidden-google-places-div")),s.getAutoCompleteSuggestions()):d.loadGooglePlacesJsApi().then(function(){s.autocompleteService=new google.maps.places.AutocompleteService,s.placesService=new google.maps.places.PlacesService(document.getElementById("hidden-google-places-div")),s.getAutoCompleteSuggestions()},function(e){g.reject(),l.toastError("core.backendErrorCodes.000000")})},s.getLocation=function(){l.loading(!0),o.getGeolocationData().then(function(e){if(l.loading(!1),isDefined(e)&&isDefined(e.coords.latitude)&&isDefined(e.coords.longitude)){var t={lat:e.coords.latitude,lng:e.coords.longitude,longName:"Current Location"};s.setPlace(t)}else i.translate("discover.list.error.locationNotFound").then(function(e){l.toast(e)})},function(t){l.loading(!1),i.translate("gpsCheckin.label.gpsErrorMessage").then(function(i){e.info("Error in GPS Settings - "+t),n.alert({title:"",template:i})})})},s.swapLatLng=function(){var e=s.srcLatLng;s.srcLatLng=s.destLatLng,s.destLatLng=e},s.swapPlaceNames=function(){var e=s.srcName;s.srcName=s.destName,s.destName=e},s.reverseFromAndToLocation=function(){s.swapLatLng(),s.swapPlaceNames(),"discoverListBkng"!==s.invokingState&&"discoverList"!==s.invokingState&&s.invokingState!==CONSTANTS.GUEST_DISCOVER_LIST_BKG&&s.invokingState!==CONSTANTS.GUEST_DISCOVERLIST||(s.stateParams.srcLatLng=s.srcLatLng,s.stateParams.destLatLng=s.destLatLng,s.stateParams.srcName=s.srcName,s.stateParams.destName=s.destName),r.fromAndToLocationReversed("header")},s.noop=function(){}}]}}]),discoverModule.run(["$templateCache",function(e){e.put("discover/directives/HeaderGenericSearchView.html",'<div class="clearfix header-search-container mix-details-header-panel {{iosClass}}" debug-file-path="HeaderGenericSearchView.html"><div id="hidden-google-places-div" style="display:none"></div><div class="header-search-base-div"><div><span class="header-search-label" translate>discover.list.label.from</span> <span class="header-search-input-container"><input class="header-search-input truncate-text" ng-click="fieldTap(&apos;from&apos;)" ng-model="srcName" readonly="readonly"></span></div><div class="header-search-padding"><span class="header-search-label" translate>discover.list.label.to</span> <span class="header-search-input-container"><input class="header-search-input truncate-text" ng-click="fieldTap(&apos;to&apos;)" ng-model="destName" readonly="readonly"></span></div></div><div class="header-search-refresh"><i class="discover icon-reverse" ng-click="reverseFromAndToLocation()"></i></div></div>'),e.put("discover/templates/pages/DiscoverListView.html",'<ion-view debug-file-path="DiscoverListView.html"><ion-nav-title>Directions</ion-nav-title><ion-nav-buttons side="secondary"><a ng-click="goToSortPage()"><i class="discover icon-sort margin"></i> </a><a ng-click="goToFilters()"><i class="discover icon-filters"></i></a></ion-nav-buttons><ion-content class="has-header has-tabs"><header-generic-search dest-lat-lng="destLatLng" dest-name="toLocation" invoking-state="currState" ng-init="init()" src-lat-lng="srcLatLng" src-name="fromLocation" state-params="$stateParams"></header-generic-search><div class="addFont filter-label-margin" ng-if="routes.length === 0" translate>discover.list.error.noResults</div><div ng-repeat="route in routes"><div class="route-result-panel" ng-click="showResultsOnMap(route)"><div class="route-segment"><div ng-repeat="segment in route.segments"><div class="route-segment" ng-if="$index &lt; 4"><a href ng-if="($index &lt; 3 &amp;&amp; route.segments.length &gt; 4) || route.segments.length &lt; 5"><i class="discover icon-outer-circle icon-{{getVehicleIcon(results.vehicles[segment.vehicle].kind)}}"></i></a><div class="horizontal-line" ng-if="$index &lt; 3 &amp;&amp; $index &lt; route.segments.length -1"></div><p class="add-margin-to-text results-type-text" ng-if="route.segments.length &lt; 2">{{&apos;discover.vehicles.&apos; + results.vehicles[segment.vehicle].kind | translate}}</p><div class="icon-blank-circle" ng-if="$index &gt; 2 &amp;&amp; route.segments.length &gt; 4"><a href><span class="extra-mode-transfer-num">+{{route.segments.length - 3}}</span></a></div></div></div></div><div class="route-price-margin"><span class="route-price">{{route.indicativePrices[0].price}}</span> <span class="route-price-currency">{{route.indicativePrices[0].currency}}</span><div class="align-duration-text"><span class="route-duration">{{route.totalDurationInConvertedFormat.day.value}} </span><span class="route-duration-unit">{{route.totalDurationInConvertedFormat.day.displayName}}</span> <span class="route-duration">{{route.totalDurationInConvertedFormat.hour.value}} </span><span class="route-duration-unit">{{route.totalDurationInConvertedFormat.hour.displayName}}</span> <span class="route-duration">{{route.totalDurationInConvertedFormat.minute.value}} </span><span class="route-duration-unit">{{route.totalDurationInConvertedFormat.minute.displayName}}</span></div></div></div><div class="stretched-horizontal-line"></div></div></ion-content></ion-view>'),e.put("discover/templates/pages/DiscoverResultsView.html",'<ion-view cache-view="false" debug-file-path="DiscoverResultsView.html"><ion-nav-title>Directions</ion-nav-title><ion-content class="header-map-margin"><div class="align-zoom-icon map-zoom-icon segment-icon-size" ng-click="openExpandViewModal()"></div><cmt-leaflet-map height="40%" idtomap="{{idToMap}}" routes="path" source="source" zoom="{{zoomLevel}}"></cmt-leaflet-map><section class="route-map-panel"><div ng-repeat="segment in route.segments"><section ng-if="$first"><div class="vertical-line" style="height:1em;"></div><header><div class="nodes-align"><div class="node-circle"></div></div><p class="insert-left-margin move-element-up segment-primary-heading truncate-text" ng-attr-style="max-width: {{maxWidth}}">{{destLocation=places[segment.depPlace].shortName === &apos;Origin&apos;?fromLocation:places[segment.depPlace].shortName}}</p></header></section><section><div class="vertical-line"></div><div class="nodes-align"><div class ng-click="goToSegmentView(segment,$index)"><i class="discover icon-outer-circle icon-{{getVehicleIcon(vehicleKinds[segment.vehicle].kind)}}"></i></div></div><div class="insert-left-margin"><p class="result-page-vehicle-name" ng-click="goToSegmentView(segment,$index)">{{&apos;discover.vehicles.&apos; + vehicleKinds[segment.vehicle].kind | translate}}</p><p class="segment-secondary-heading">{{segment.transitDurationConvertedFormat.fullDisplayName}}</p></div></section><br><section ng-if="segment.indicativePrices[0].price&gt;0"><div class="vertical-line"></div><div class="nodes-align"><div class="node-small-circle-filled"></div></div><div class="insert-left-margin"><p class="move-element-up segment-primary-heading" translate>discover.results.price</p><p class="segment-secondary-heading">{{segment.indicativePrices[0].price}} {{segment.indicativePrices[0].currency}}</p></div></section><section><div class="vertical-line"></div><div class="nodes-align"><div class="node-circle"></div></div><div class="insert-left-margin"><p class="move-element-up segment-primary-heading truncate-text arr-loc-color" ng-attr-style="max-width: {{maxWidth}}">{{places[segment.arrPlace].shortName === &apos;Destination&apos;?toLocation:places[segment.arrPlace].shortName}}</p></div></section></div></section><script id="map-image-modal.html" type="text/ng-template"><div class="modal desktop-modal image-modal transparent">\n                <cmt-leaflet-map class="fullscreen-image ie-map-fix" source="source" idtomap="{{idToMapZoom}}" height="100%" routes="path" zoom="{{zoomLevel}}"></cmt-leaflet-map>\n                <div class="iconCloseMap icon-close ie-close-icon-fix" ng-click="closeExpandViewModal()"></div>\n            </div></script></ion-content><header-generic-search dest-lat-lng="destLatLng" dest-name="toLocation" invoking-state="currState" src-lat-lng="srcLatLng" src-name="fromLocation"></header-generic-search></ion-view>'),e.put("discover/templates/pages/GenericSearchView.html",'<ion-view cache-view="false" debug-file-path="GenericSearchView.html"><ion-nav-title>Directions</ion-nav-title><ion-content><div class="generic-search-bg-icon"><div id="hidden-google-places-div" style="display:none"></div><div class="contained-narrow spaced-layout-element stickToBottom" ng-init="init()"><form name="forms.discoverSearchForm" novalidate role="form"><span class="truncate-text input-wrap generic-search-space-element"><input class="truncate-text" name="From" ng-click="fieldTap(&apos;from&apos;)" ng-model="search.srcName" onfocus="blur();" placeholder="{{&apos;discover.list.label.from&apos; | translate}}" readonly="readonly" type="text"> </span><span class="truncate-text input-wrap"><input class="truncate-text" name="To" ng-click="fieldTap(&apos;to&apos;)" ng-model="search.destName" onfocus="blur();" placeholder="{{&apos;discover.list.label.to&apos; | translate}}" readonly="readonly" type="text"> </span><button class="btn-fullwidth spaced-element" name="search_button" ng-click="goToDiscoverList()" translate type="submit">discover.genericsearch.search</button></form></div></div></ion-content></ion-view>'),e.put("discover/templates/pages/SegmentResultsView.html",'<ion-view cache-view="false" debug-file-path="SegmentResultsView.html"><ion-nav-title>Directions</ion-nav-title><ion-content class="header-map-margin"><div class="align-zoom-icon map-zoom-icon segment-icon-size" ng-click="openExpandViewModal()"></div><cmt-leaflet-map height="40%" idtomap="{{idToMap}}" routes="path" source="source" zoom="{{zoomLevel}}"></cmt-leaflet-map><section class="route-map-panel"><div><section><div class="vertical-line" style="height:1em;"></div><header><div class="nodes-align"><div class="node-circle"></div></div><p class="insert-left-margin move-element-up segment-primary-heading truncate-text" ng-attr-style="max-width: {{maxWidth}}">{{fromLocation}}</p></header></section><section><div class="vertical-line"></div><div class="nodes-align"><i class="discover icon-outer-circle icon-{{getVehicleIcon(path[0].type)}}"></i></div><div class="insert-left-margin"><p class="result-page-vehicle-name">{{&apos;discover.vehicles.&apos; + path[0].type | translate}}</p><p class="segment-secondary-heading">{{segment.transitDurationConvertedFormat.fullDisplayName}}</p></div></section><br><section><div class="vertical-line"></div><div class="nodes-align"><div class="node-small-circle-filled"></div></div><div class="insert-left-margin"><p class="move-element-up segment-primary-heading" translate>discover.results.price</p><p class="segment-secondary-heading">{{segment.indicativePrices[0].price}} {{segment.indicativePrices[0].currency}}</p></div></section><section><div class="vertical-line"></div><div class="nodes-align"><div class="node-circle"></div></div><div class="insert-left-margin"><p class="move-element-up segment-primary-heading truncate-text arr-loc-color" ng-attr-style="max-width: {{maxWidth}}">{{place}}</p></div></section></div></section><script id="map-image-modal.html" type="text/ng-template"><div class="modal desktop-modal image-modal transparent">\n                <cmt-leaflet-map class="fullscreen-image ie-map-fix" source="source" idtomap="{{idToMapZoom}}" height="100%" routes="path" zoom="{{zoomLevel}}"></cmt-leaflet-map>\n                <div class="iconCloseMap icon-close ie-close-icon-fix" ng-click="closeExpandViewModal()"></div>\n            </div></script></ion-content><header-generic-search dest-lat-lng="destLatLng" dest-name="toLocation" invoking-state="currState" src-lat-lng="srcLatLng" src-name="fromLocation"></header-generic-search></ion-view>'),e.put("discover/templates/partial/FilterListView.html",'<ion-modal-view cache-view="false" debug-file-path="FilterListView.html"><ion-header-bar class="bar-stable"><h1 class="title" translate>discover.list.filterlist.filter</h1><span class="button button-clear icon {{::closeicon}}" ng-click="closeModal()"></span></ion-header-bar><ion-content class="discover has-footer"><p class="addFont filter-label-margin" translate>discover.list.filterlist.filterlabel</p><br><div class="align-filters" ng-repeat="vehicle_array in filters"><div ng-repeat="vehicle in vehicle_array"><div class="iconsBorderPanel" id="{{vehicle}}" ng-class="{&apos;addBkgrndAndColor&apos;:{{vehicle}}}" ng-click="addFilter(vehicle)"><div class="route-segment"><i class="discover icon-outer-circle icon-{{getVehicleIcon(vehicle)}}"></i></div><p class="filter-margin vehicle-name-color" translate>{{&apos;discover.vehicles.&apos; + vehicle | translate}}</p></div></div><div ng-if="vehicle_array.length &lt; 2 &amp;&amp; filters.length &gt; 1" style="visibility: hidden"><div class="iconsBorderPanel"></div></div></div></ion-content><footer class="contained-narrow filters spaced-layout-element stickToBottom"><button class="addFont btn-fullwidth button-custom-text-color filters-button-padding" name="filter_list_button" ng-click="applyFilter()" translate>discover.list.filterlist.apply</button></footer></ion-modal-view>'),e.put("discover/templates/partial/InputSearchView.html",'<ion-modal-view debug-file-path="InputSearchView.html"><ion-header-bar class="bar-stable"><h1 class="title" translate>discover.inputsearch.title</h1><span class="icon button button-clear {{::closeicon}}" ng-click="closeModal()"></span></ion-header-bar><div class="discover-input-search ion-place-tools-header"><div class="item ion-place-tools-autocomplete"><span class="input-wrap input-wrap-no-border input-wrap-with-icon"><input name="auto_complete_button" ng-change="openAutocomplete()" ng-model="inputModal.searchLabel" ng-model-options="{debounce: 200}" type="search"> <i class="icon-search-slim" ng-show="showSearchPlaceholder"></i></span></div></div><div class="discover-input-search-panel input-search-location-panel" ng-hide="hideCurrentLocation"><label class="item" ng-click="getLocation()"><i class="icon ion-android-locate"></i> <span class="content-margin" translate>discover.inputsearch.currentlocation</span></label></div><ion-content class="discover-input-results"><div class="item full-text" ng-class="{&apos;custom-suggestion-margin&apos;: $first}" ng-click="setPlace(place)" ng-if="suggestions.places" ng-repeat="place in suggestions.places">{{place.longName}}</div><div class="item full-text" ng-class="{&apos;custom-suggestion-margin&apos;: $first}" ng-click="setPlace(place)" ng-if="suggestions.predictions" ng-repeat="place in suggestions.predictions">{{place.description}}</div><div class="item noResult" ng-show="showNoResultsLabel" translate>discover.results.error.noResults</div></ion-content></ion-modal-view>')}]),window.faqModule=angular.module("FaqModule",["CoreModule","AccountModule","AnalyticsModule"]),window.faqModule.run(["$log",function(e){e=e.getInstance("Faq"),e.info("Module started")}]),window.faqModule.config(["$translatePartialLoaderProvider","$stateProvider",function(e,t){e.addPart("faq")}]);var helpMenuEnabledConfig="featureConfig.mainFeatures.isHelpMenuEnabled";window.faqModule.routes={faq:{url:"/faq",templateUrl:"faq/templates/pages/FAQView.html",controller:"FaqController",resolve:{analytics:["AnalyticsService",function(e){return e.screenView("FAQ").promise()}]},defaultBackState:getContext(helpMenuEnabledConfig,!1)?"help":"settings",ncyBreadcrumb:{label:"{{'faq.view.title.customerSupport'|translate}}",parent:["AuthenticationService",function(e){return e.isLogged()?getContext(helpMenuEnabledConfig,!1)?"help":"settings":getContext(helpMenuEnabledConfig,!1)?"guest-help":null}]}},"faq-ext":{url:"/faq-ext/:appVersion?",templateUrl:"faq/templates/pages/FAQView.html",controller:"FaqController"}},faqModule.directive("amFaqListItem",["$log","$sce","OrchestratorChiefService","$compile","$ionicScrollDelegate",function(e,t,n,i,a){return e=e.getInstance("AmFaqListItemDirective"),{type:"E",replace:!0,scope:{listItem:"=",isPageHashValid:"&isPageHashValid"},templateUrl:"faq/directives/AmFaqListItemView.html",link:function(t,r,o){t.selId=-1,t["goto"]=function(i){t.isPageHashValid({pageHash:i})?n.navigateTo(i):e.error("Page Hash: "+i+", not found.")},t.openAccordion=function(e){t.selId===e.index?t.selId=-1:t.selId=e.index,a.$getByHandle("sizing").resize()};var s=function(){if(t.listItem.link){var e=r[0].getElementsByClassName("dynamicElement"),n=i(t.listItem.description)(t);angular.element(e).parent().append(n)}if(isDefined(t.listItem.images)&&isDefined(t.listItem.support)){var a="";a=isDesktop()&&t.listItem.support.indexOf("web")>-1?"-web":a,t.listItem.images=t.listItem.images.map(function(e){return e.replace(/\.(\w{3,4})/,a+".$1")})}};s()}}}]),faqModule.directive("amFaqList",["$log",function(e){return{type:"E",replace:!0,scope:{faq:"=",isPageHashValid:"&isPageHashValid"},templateUrl:"faq/directives/AmFaqListView.html"}}]),faqModule.directive("amImageSwiper",["$log","$ionicModal","$rootScope","$stateParams","NetworkService",function(e,t,n,i,a){return{type:"E",replace:!0,scope:{images:"="},templateUrl:"faq/directives/AmImageSwiperDirectiveView.html",link:function(e,r,o){function s(t){e.sliderState.hasPrevious=0!==t,e.sliderState.hasNext=!(!e.images||t===e.images.length-1)}e.sliderState={slider:null,options:{loop:!1,effect:"slide",speed:300,pagination:!1}},e.openSwiperModal=function(i){var r=a.hasConnectivity(!0);r.isOnline&&(e.imageIndex=i,t.fromTemplateUrl("faq-image-modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t,e.modal.show(),s(e.imageIndex),e.$on("$ionicSlides.sliderInitialized",function(t,n){e.sliderState.slider=n.slider,e.sliderState.slider.slideTo(e.imageIndex)}),e.$on("$ionicSlides.slideChangeEnd",function(t,i){s(e.sliderState.slider.activeIndex),n.$apply()})}))},e.closeSwiperModal=function(){e.modal.remove().then(function(){e.modal=null})},e.$on("$destroy",function(){e.modal&&e.modal.remove().then(function(){e.modal=null})}),e.next=function(){e.sliderState.slider.slideNext()},e.previous=function(){e.sliderState.slider.slidePrev()};var l=function(){var t="";if(getContext("isB2b",!1))t=getContext("cdnHost")+getContext("SITECODE")+"/web_images/";else{var n=isDefined(i.os)?i.os+"_":"";t="images/"+n}e.host=t};l()}}}]),faqModule.controller("FaqController",["$scope","$log","LayoutService","$http","IONCMT_MODULES_LIST","IONCMT_DEFAULT_LANG","ContentService","AuthenticationService","$rootScope","$httpParamSerializerJQLike","$q","$ionicPopup","$translate","OrchestratorChiefService","$state","$stateParams","I18nConfig",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p,m,f,v){t=t.getInstance("FaqController"),t.info("FAQ Controller Started..."),e.faqs={},e.forms={};var h="faq",S="json",C=v.getCurrentApplicationLanguage(),T=[],b=f.appVersion,E=function(){for(var e={},t=0;t<a.length;t++){var n=angular.module(a[t]).routes;n&&angular.extend(e,n)}T=Object.keys(e)};e.isPageHashValid=function(e){for(var t=0;t<T.length;t++)if(T[t].match(e))return!0;return!1};var A=function(){if(e.isAdditionalQuestionsEnabled=getContext("featureConfig.mainFeatures.isAdditionalQuestionsEnabled",!1),e.isLogged=s.isLogged(),e.isAdditionalQuestionsEnabled){var t=s.getUser();safeAccess(t,"userId")&&(e.userEmail=t.userId,e.userquery={})}},y=null;e.$on("$ionicView.enter",function(){y=l.$on("paramsUpdates",function(e,t){A()})});var L=function(e){return-1!==safeAccess(e,"description","").toLowerCase().indexOf("data-link=")},D=function(e){return-1!==safeAccess(e,"description","").toLowerCase().indexOf("data-type='video'")},_=function(){return getContext("isMobileApp",!1)||getContext("isWebMobile",!1)},w=function(t){var n="",i=_();t.faqs.forEach(function(e,t){var a=t+1;e.list.forEach(function(e,t){e.index=a*t,e.link=!1,e.IsMobileForFaq=i,L(e)&&(e.link=!0,n="faq-link",D(e)&&(n="faq-video faq-link"),e.description="<div class='"+n+"'>"+e.description+"</div>")})}),e.faqs=t.faqs,e.queryTypes=t.queryTypes,e.queryHeader=t.queryHeader},I=function(e,n){var i=e.data;isDefined(i)?"object"==typeof i?n.resolve(i):(t.backendError(i),n.reject("Error occured")):n.reject("No data received")},M=function(e,n){t.httpError(e),n.reject("Error occurred")},k=function(e,t){var n=e.shift();getContext("isB2b")||(n.fileName=b?n.fileName+b:n.fileName);var a=o.createStaticUrlWithLocaleOfType(n.language,n.fileName,n.fileType);if(t=t?t:d.defer(),a){var r=i.get(a);r.then(function(e){I(e,t)},function(n){e.length>0?k(e,t):M(n,t)})}else t.reject("Error occurred");return t.promise},R=function(e){n.loading(!1),w(e)},P=function(){n.loading(!1)},x=function(e){for(var t=!1,n=m.get(),i=0;i<n.length;i++)"^"!=n[i].url&&n[i].name==e&&(t=!0);return t},N=function(e){return-1!=e.indexOf("http")?e:"http://"+e},O=function(e){if(e){var t=N(e);if(x(e))p.navigateTo(e);else{if(!getContext("isMobileApp"))return window.open(t,"_blank"),!1;window.open(t,"_system","location=yes")}}},F=function(){document.addEventListener("click",function(e){"[object HTMLAnchorElement]"==Object.prototype.toString.call(e.target)&&e.target.parentElement&&e.target.parentElement.classList.contains("faq-link")&&O(e.target.getAttribute("data-link"))})},U=function(t){var n=new Date,i={supOption:t.queryType,supQuery:t.query,appVersion:b,browserInfo:ionic.Platform.ua,mobileOS:"",mobileVersion:"",mobileModel:"",dateTimeZone:n,email:e.userEmail};return _()&&(i.mobileOS=ionic.Platform.platform(),i.mobileVersion=ionic.Platform.version()),i};e.onQuerySubmit=function(a){var r=U(a),o=d.defer();n.loading(!0);var s=i({url:"v1/account/sendQuery",data:r,method:"POST"});s.then(function(i){safeAccess(i,"data")&&i.data.success?(n.loading(!1),e.userquery={},e.forms.queryForm.$setPristine(),e.forms.queryForm.$setUntouched(),t.info("Email sent succesfully."),o.resolve(i.data),u.alert({title:e.successTitle,template:e.sendSuccess})):(n.loading(!1),t.error("Email cannot be sent"),o.reject("sendUserQueryFailed","User query mail failed due to error "),u.alert({title:e.errorTitle,template:e.sendFailure}))},function(i){n.loading(!1),t.error("Email cannot be sent"),o.reject("sendUserQueryFailed",i),u.alert({title:e.errorTitle,template:e.sendFailure})})};var B=function(){var t=["faq.view.message.sendSuccessBody","faq.view.message.sendFailureBody","faq.view.message.sendSuccessTitle","faq.view.message.sendFailureTitle"];g(t).then(function(n){e.sendSuccess=n[t[0]],e.sendFailure=n[t[1]],e.successTitle=n[t[2]],e.errorTitle=n[t[3]]}),A(),E(),n.loading(!0);var i=[{language:C,fileName:h,fileType:S},{language:r,fileName:h,fileType:S},{language:"",fileName:h,fileType:S}],a=k(i);a.then(R,P),F()};B()}]),faqModule.run(["$templateCache",function(e){e.put("faq/directives/AmFaqListItemView.html",'<li debug-file-path="AmFaqListItemView.html"><h3 class="faq-sub-header" ng-class="{active: selId === listItem.index}"><a ng-click="openAccordion(listItem)" href>{{listItem.title}} <i ng-class="{&apos;icon-plus&apos;: selId !== listItem.index,&apos;icon-minus&apos;: selId === listItem.index}"></i></a></h3><div class="faq-container"><p class="faq-content" ng-bind-html="listItem.description" ng-class="{faqshow: selId === listItem.index}" ng-show="!listItem.link &amp;&amp; listItem.description &amp;&amp; selId === listItem.index"></p><am-image-swiper images="listItem.images" ng-if="listItem.IsMobileForFaq" ng-show="listItem.images &amp;&amp; selId === listItem.index"></am-image-swiper><am-image-swiper images="listItem.Dimages" ng-if="!listItem.IsMobileForFaq &amp;&amp; listItem.Dimages" ng-show="listItem.Dimages &amp;&amp; selId === listItem.index"></am-image-swiper><am-image-swiper images="listItem.images" ng-if="!listItem.IsMobileForFaq &amp;&amp; !listItem.Dimages" ng-show="listItem.images &amp;&amp; selId === listItem.index"></am-image-swiper><div ng-show="listItem.link &amp;&amp; selId === listItem.index"><div class="dynamicElement"></div></div><div class="faq-link" ng-show="listItem.video &amp;&amp; selId === listItem.index"><a ng-click="openlink(listItem.video.url)" data-type="video">{{listItem.video.label}}</a></div></div></li>'),e.put("faq/directives/AmFaqListView.html",'<div class="faq-main" debug-file-path="AmFaqListView.html"><h2 class="faq-header">{{faq.title}}</h2><ul class="list-toexpand"><am-faq-list-item is-page-hash-valid="isPageHashValid(pageHash)" list-item="listItem" ng-repeat="listItem in faq.list"></am-faq-list-item></ul></div>'),e.put("faq/directives/AmImageSwiperDirectiveView.html",'<div debug-file-path="AmImageSwiperDirectiveView.html"><div class="faq-img-container" ng-repeat="image in images"><img class="faq-img" ng-click="openSwiperModal($index)" ng-src="{{host}}{{image}}"></div><script id="faq-image-modal.html" type="text/ng-template"><ion-modal-view class="faq-image-modal" ng-click="closeSwiperModal()">\n            <ion-header-bar>\n                <div class="closeFaqModal icon-close"></div>\n            </ion-header-bar>\n            <ion-content scroll="false">\n                <ion-slides options="options" activeSlide="imageIndex" slider="sliderState.slider" show-pager="false" auto-play="false" does-continue="false">\n                    <ion-slide-page ng-repeat="image in images">\n                        <img ng-src="{{host}}{{image}}" class="faq-fullscreen-image"/>\n                    </ion-slide-page>\n                </ion-slides>\n                <div ng-class="{\'icon-back\' : sliderState.hasPrevious , \'faqSwiperPrev\' : sliderState.hasPrevious }"\n                     ng-click="previous();$event.stopPropagation()"></div>\n                <div ng-class="{\'icon-chevron-right\' : sliderState.hasNext , \'faqSwiperNext\' : sliderState.hasNext }"\n                     ng-click="$event.stopPropagation();next()"></div>\n            </ion-content>\n        </ion-modal-view></script></div>'),e.put("faq/templates/pages/FAQView.html",'<ion-view debug-file-path="FAQView.html"><ion-nav-title translate>faq.view.title.customerSupport</ion-nav-title><ion-content delegate-handle="sizing"><article class="contained-pad contained-scrollable"><am-faq-list faq="faq" is-page-hash-valid="isPageHashValid(pageHash)" ng-repeat="faq in faqs"></am-faq-list></article><article class="contained-pad" ng-if="isAdditionalQuestionsEnabled &amp;&amp; isLogged"><h2 class="ng-binding faq-header">{{queryHeader}}</h2><form name="forms.queryForm" novalidate role="form"><cmt-select data="userquery.queryType" label name="query" options="queryTypes" placeholder="{{&apos;faq.view.label.topicSelect&apos; | translate}}" required></cmt-select><textarea class="input-wrap" ng-model="userquery.query" ng-required="true" placeholder="{{&apos;faq.view.label.typePlaceholder&apos; | translate}}" required rows="3" style="padding: 0 8px;"></textarea> <span class="input-wrap"><input name="emailInput" ng-disabled="true" placeholder="{{&apos;account.registration.label.email&apos;|translate}}" type="email" value="{{userEmail}}"></span><div class="contained-narrow spaced-layout-element"><button class="ng-binding btn-fullwidth" ng-click="onQuerySubmit(userquery)" ng-disabled="forms.queryForm.$invalid" translate type="submit">faq.view.button.send</button></div></form></article></ion-content></ion-view>')}]),window.currencyConverterModule=angular.module("CurrencyConverterModule",["ionic","CoreModule","AnalyticsModule"]),window.currencyConverterModule.run(["$log","CurrencyConverterService",function(e,t){e=e.getInstance("currency-converter"),e.info("Module started"),t.initCurrencyConverter()}]),window.currencyConverterModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("currency-converter")}]),window.currencyConverterModule.routes={},currencyConverterModule.service("CurrencyConverterService",["$log","$q","$http","DataManagerService","GloballistService","GloballistProcessor",function(e,t,n,i,a,r){e=e.getInstance("CurrencyConverterService"),e.info("Service Started...");var o={errorCodes:[],debugErrorMessages:[],data:null},s={},l={EXCHANGE_RATE_URL_PATH:"v1/tools/getCurrencyConversion",CURRENCY_LIST_GLOBAL:"LANG_CURRENCY_DESCRIPTION",CURRENCY_COUNTRY_MAPPING_GLOBAL_LIST:"NO_SL_COUNTRY",CURRENCY_LIST_KEY:"currencyList",LOCALE_CURRENCY_MAP_KEY:"localeCurrencyMap",COUNTRY_CALLING_CODE_GLOBAL_LIST:"SL_GET_COUNTRY_CALLING_CODE",COUNTRY_NAME_CODE_MAP_KEY:"countryNameCodeMap",CACHE_TTL:getContext("featureConfig.currencyConverter.cache","24h"),initCurrencyConverter:function(){var e=getContext("featureConfig.currencyConverter.enabled",!1);e&&(l.getCurrencyList(),l.getCurrencyCountryMappingList(),l.getCountryNameCodeMappingList())},getExchangeRateFromCache:function(e,t){var n=e+"_"+t,a=i.get(n,i.LOCALSTORAGE);return a},setExchangeRateToCache:function(e,t,n){var a=e+"_"+t;i.set(n,a,{storage:i.LOCALSTORAGE,belongsToUser:!1,ttl:l.CACHE_TTL})},getExchangeRate:function(i,a,r){var s=t.defer(),c=l.EXCHANGE_RATE_URL_PATH,d=l.generateCurrencyConversionRequest(i,a,r);l.setCurrencyConversionReq(d);var u=n({url:c,data:l.getCurrencyConversionReq(),method:"POST"}),g=l.getExchangeRateFromCache(i,a);return u.then(function(t){if(e.info("Currency Information fetched - Promise Call initiated"),safeAccess(t,"data.success")&&safeAccess(t,"data.currencyConversions[0].rate")){o.data=t.data;var n=safeAccess(o,"data.currencyConversions[0].rate");l.setExchangeRateToCache(i,a,n),s.resolve(n)}else isDefined(g)&&s.resolve(g),s.reject()},function(t){e.info("Currency Information fetched - Failure Call initiated"),isDefined(g)&&s.resolve(g),s.reject(t)}),s.promise},isCurrencyConversionValid:function(e,t){var n=e!=t,i=!(!e||!t);return n&&i},getCurrencyList:function(){var n=t.defer(),o=i.get(l.CURRENCY_LIST_KEY,i.LOCALSTORAGE);return isDefined(o)&&n.resolve(o),a.getGl(l.CURRENCY_LIST_GLOBAL).then(function(e){var t=r.matrixToObjectArray(e);t=l.sortCurrencyByCode(t),i.set(t,l.CURRENCY_LIST_KEY,{storage:i.LOCALSTORAGE,belongsToUser:!1,ttl:"7d"}),n.resolve(t)},function(t){e.error("getCurrencyList: rejecting promise due to backend error"),n.reject(t)}),n.promise},sortCurrencyByCode:function(e){var t=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};return e.sort(t)},getCurrencyCountryMappingList:function(){var n=t.defer(),r=i.get(l.LOCALE_CURRENCY_MAP_KEY,i.LOCALSTORAGE);return r&&n.resolve(r),a.getGl(l.CURRENCY_COUNTRY_MAPPING_GLOBAL_LIST).then(function(e){for(var t=e,a={},r=0;r<t.length;r++)a[t[r][0]]=t[r][1];i.set(a,l.LOCALE_CURRENCY_MAP_KEY,{storage:i.LOCALSTORAGE,belongsToUser:!1,ttl:"7d"}),n.resolve(a)},function(t){e.error("getCurrencyCountryMappingList: rejecting promise due to backend error"),n.reject(t)}),n.promise},getCountryNameCodeMappingList:function(){var n=t.defer(),r=i.get(l.COUNTRY_NAME_CODE_MAP_KEY,i.LOCALSTORAGE);
return r&&n.resolve(r),a.getGl(l.COUNTRY_CALLING_CODE_GLOBAL_LIST).then(function(e){for(var t={},a=0;a<e.length;a++)t[e[a][1]]=e[a][0];i.set(t,l.COUNTRY_NAME_CODE_MAP_KEY,{storage:i.LOCALSTORAGE,belongsToUser:!1,ttl:"7d"}),n.resolve(t)},function(t){e.error("getCountryNameCodeMappingList: rejecting promise due to backend error"),n.reject(t)}),n.promise},getCountryCodeFromDeviceLocale:function(){if(isDefined(l.getCountryCode()))return l.getCountryCode();var e=window.navigator,t="en-GB";if(!isDefined(e))return"GB";if(e.languages&&e.languages[0]){var n=e.languages,i=n[0],a=i.split("-"),r=i;if(1===a.length)for(var o=0;o<n.length;o++){var s=n[o],c=s.split("-");if(c.length>1&&c[0]===i){r=s;break}}t=r}else t=e.language||e.userLanguage||e.systemLanguage||"en-GB";var d=t.split("-")[1]||"GB";return l.setCountryCode(d),d},getDeviceLocaleCurrency:function(e){var n=t.defer(),i=l.getCountryCodeFromDeviceLocale().toUpperCase(),a=e[i];return getContext("isMobileApp",!1)&&safeAccess(window,"cordova.plugins.DeviceLocale.getDeviceLocale")?window.cordova.plugins.DeviceLocale.getDeviceLocale(function(e){isDefined(e)?n.resolve(e):n.resolve(a)},function(){n.resolve(a)}):n.resolve(a),n.promise},getCurrencyCodesforLocales:function(n){var i=t.defer();return l.getCurrencyCountryMappingList().then(function(t){var a=t;l.getDeviceLocaleCurrency(a).then(function(e){for(var t=[],r=0;r<n.length;r++)isDefined(n[r])&&""!==n[r]?t.push(a[n[r]]):t.push(e);i.resolve(t)},function(t){e.error("getDeviceLocaleCurrency: rejecting promise due to error"),i.reject(t)})},function(t){e.error("getCurrencyCodesforLocales: rejecting promise due to backend error"),i.reject(t)}),i.promise},getCountryCodeFromCountryName:function(n){var i=t.defer();return l.getCountryNameCodeMappingList().then(function(e){var t="";e&&e[n]&&(t=e[n]),i.resolve(t)},function(t){e.error("getCurrencyCodesforLocales: rejecting promise due to backend error"),i.reject(t)}),i.promise},calculatePrecisionCurrency:function(e){var t=Number(e),n=String(t).split(".")[1]||0,i=Number(n);if(0==i)return t;if(n.length===String(i).length)return t.toFixed(2);var a=n.length-String(i).length;return a&&a>1?t.toFixed(a+2):t.toFixed(2)},setCurrencyConversionReq:function(e){s=e},getCurrencyConversionReq:function(){return s},setCountryCode:function(e){l.countryCode=e},getCountryCode:function(){return l.countryCode},generateCurrencyConversionRequest:function(e,t,n){var i=[],a={sourceCurrencyCode:e,targetCurrencyCode:t};return n&&(a.amount=n),i.push(a),{currencyConversionRequests:i}},getObjectsForValue:function(e,t){return t.filter(function(t){return t.value==e})},toString:function(){return"CurrencyConverterService"}};return l}]),currencyConverterModule.service("CurrencyConverterAnalyticsService",["$log","AnalyticsService",function(e,t){e=e.getInstance("CurrencyConverterAnalyticsService"),e.info("Service Started...");var n={CATEGORY:"Currency Converter",EVENTS:{},toString:function(){return"CurrencyConverterAnalyticsService"}};return n}]),currencyConverterModule.directive("currencyConverter",["CurrencyConverterService","LayoutService","$rootScope","$timeout","$ionicScrollDelegate",function(e,t,n,i,a){return{restrict:"E",templateUrl:"currency-converter/directives/CurrencyConverterDirective.html",scope:{segmentLocation:"="},controller:["$scope",function(t){var i=function(){e.getCurrencyList().then(function(n){t.currencyOptions=n;var i=t.segmentLocation,a=[""],r=null,o=null;safeAccess(i,"currencyCode")?o=i.currencyCode:safeAccess(i,"countryCode")&&a.push(i.countryCode),e.getCurrencyCodesforLocales(a).then(function(i){if(isDefined(i[0])&&(r=i[0]),isDefined(i[1])&&(o=i[1]),t.isCurrencyConversionValid=e.isCurrencyConversionValid(r,o),t.isCurrencyConversionValid){var a=e.getObjectsForValue(r,n),s=e.getObjectsForValue(o,n),l=isDefined(a)&&isDefined(a[0])?a[0]:n[0],c=isDefined(s)&&isDefined(s[0])?s[0]:n[0];t.fromCurrency=l,t.toCurrency=c,t.fromCurrencyBackup=l,t.toCurrencyBackup=c,t.currencyOneValue=1,t.updateExchangeRate(!1)}},function(e){})},function(e){})},a=function(){n.$on("WeatherDetailsRefreshEvent",function(){t.updateExchangeRate(!0)})};i(),a()}],link:function(n,r,o,s){n.updateExchangeRate=function(i){isDefined(i)&&t.loading(i);var a=n.fromCurrency,r=n.toCurrency;e.getExchangeRate(a.value,r.value).then(function(e){n.exchangeRate=e,n.updateValues(!0),n.fromCurrencyBackup=a,n.toCurrencyBackup=r,t.loading(!1)},function(e){n.fromCurrency=n.fromCurrencyBackup,n.toCurrency=n.toCurrencyBackup,t.loading(!1),t.toast("currencyConverter.error.currencyInfoNotAvailable")})},n.updateValues=function(e){var t=Number(n.exchangeRate),i=Number(n.currencyOneValue),a=Number(n.currencyTwoValue);e?n.currencyTwoValue=Number((i*t).toFixed(2)):n.currencyOneValue=Number((a/t).toFixed(2))},n.onBlurResize=function(){i(function(){a.scrollBottom(),a.resize()},500)},n.onFocusScroll=function(e){ionic.Platform.isIOS()&&!getContext("isMobileApp",!1)&&e.target.scrollIntoView(!0)}},toString:function(){return"currencyConverterDirective"}}}]),currencyConverterModule.directive("currencySegment",["CurrencyConverterService","LayoutService","I18nService",function(e,t,n){return{restrict:"E",templateUrl:"currency-converter/directives/CurrencySegmentDirective.html",scope:{segmentLocation:"="},controller:["$scope",function(t){var i=function(i,a){var r=null;e.getCurrencyCodesforLocales(a).then(function(a){isDefined(a[0])&&(r=a[0]),isDefined(a[1])&&(i=a[1]),t.isCurrencyConversionValid=!0;var o=isDefined(r)&&r==i;if(o)return void(t.isCurrencyConversionValid=!1);var s=e.isCurrencyConversionValid(r,i);return s?void e.getExchangeRate(r,i).then(function(n){var a=e.calculatePrecisionCurrency(n),o=r+" 1 = "+i+" "+a;t.currencyInfo=o},function(e){n.translate(CONSTANTS.CURRENCYCONVERTER_ERROR_CURRENCYINFO_NOT_AVAILABLE).then(function(e){t.currencyInfo=e})}):void n.translate(CONSTANTS.CURRENCYCONVERTER_ERROR_CURRENCYINFO_NOT_AVAILABLE).then(function(e){t.currencyInfo=e})},function(e){n.translate(CONSTANTS.CURRENCYCONVERTER_ERROR_CURRENCYINFO_NOT_AVAILABLE).then(function(e){t.currencyInfo=e})})};t.initCurrencySegment=function(){var n=t.segmentLocation,a=[""],r=null;safeAccess(n,"currencyCode")?(r=n.currencyCode,i(r,a)):safeAccess(n,"countryCode")?(a.push(n.countryCode),i(r,a)):safeAccess(n,"countryName")?e.getCountryCodeFromCountryName(n.countryName).then(function(e){e&&a.push(e),i(r,a)},function(){i(r,a)}):i(r,a)},t.initCurrencySegment()}],link:function(e){e.$watch("segmentLocation",function(){e.initCurrencySegment()})},toString:function(){return"CurrencySegmentDirective"}}}]),currencyConverterModule.run(["$templateCache",function(e){e.put("currency-converter/directives/CurrencyConverterDirective.html",'<div class="card-pad contained-pad" debug-file-path="CurrencyConverterDirective.html" ng-show="isCurrencyConversionValid"><section class="currency-converter-panel"><div class="currency-converter-pad"><div class="currency-converter-label input-wrap"><select id="fromCurrency" ng-change="updateExchangeRate(true)" ng-model="fromCurrency" ng-options="item.value for item in currencyOptions track by item.value"></select> <i class="icon-select"></i></div><div class="currency-converter-value"><input class="currency-converter-text" ng-blur="onBlurResize()" ng-change="updateValues(true)" ng-focus="onFocusScroll($event)" ng-model="currencyOneValue" type="number"></div></div><div class="currency-converter-pad"><div class="currency-converter-label input-wrap"><select id="toCurrency" ng-change="updateExchangeRate(true)" ng-model="toCurrency" ng-options="item.value for item in currencyOptions track by item.value"></select> <i class="icon-select"></i></div><div class="currency-converter-value"><input class="currency-converter-text" ng-blur="onBlurResize()" ng-change="updateValues(false)" ng-focus="onFocusScroll($event)" ng-model="currencyTwoValue" type="number"></div></div></section></div>'),e.put("currency-converter/directives/CurrencySegmentDirective.html",'<div class="currency-segment-text" debug-file-path="CurrencySegmentDirective.html" ng-show="isCurrencyConversionValid"><p>{{currencyInfo}}</p></div>')}]),window.loungeModule=angular.module("LoungeModule",["ionic","CoreModule","AnalyticsModule"]),window.loungeModule.run(["$log",function(e){e=e.getInstance("Lounge"),e.info("Module started")}]),window.loungeModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("lounge")}]),window.loungeModule.routes={lounge:{url:"/lounge",templateUrl:"lounge/templates/pages/LoungeView.html",controller:"LoungeController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Lounge Booking",[],"CrossSell").promise()}]},ncyBreadcrumb:{label:"{{'lounge.title.lounge'|translate}}"}},"lounge-asb":{url:"/lounge/*payload?",templateUrl:"lounge/templates/pages/LoungeView.html",controller:"LoungeController",secured:!1,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Lounge Booking",[],"CrossSell").promise()}]}}},loungeModule.service("LoungeService",["$log","I18nConfig","StringService","ParameterService",function(e,t,n,i){e=e.getInstance("LoungeService"),e.info("Service Started...");var a={determineUrl:function(){var e=i.parse(),n=e.language||t.getCurrentDeviceLanguage();return getContext("featureConfig.loungeBooking.defaultUrl","https://www.loungepass.com/tp/ama-103")+"?isiframe=1&lang="+n},toString:function(){return"LoungeService"}};return a}]),loungeModule.controller("LoungeController",["$scope","$rootScope","$state","$log","$sce","LayoutService","$window","NetworkService","UrlService","LoungeService","$timeout","I18nService","$ionicHistory","OrchestratorChiefService",function(e,t,n,i,a,r,o,s,l,c,d,u,g,p){i=i.getInstance("LoungeController"),i.info("Controller Started..."),e.reloadLoungeBookingLandingPage=!1,e.loungeIframeUrl=null,e.hideLoungeFrame=!1,e.isIOSWebView=ionic.Platform.isIOS()&&ionic.Platform.isWebView(),e.isAndroidWebView=ionic.Platform.isAndroid()&&ionic.Platform.isWebView();var m=null;e.$on("$ionicView.enter",function(){e.reloadLoungeBookingLandingPage&&(e._loadLoungeBookingLandingPage(),e.reloadLoungeBookingLandingPage=!1),e.isIOSWebView&&e._loadLoungeBookingLandingPage()}),e.$on("$stateChangeStart",function(t,n,i,a,o,s){var l=["lounge","guest-lounge","more-lounge","more-guest-lounge"];-1!=l.indexOf(a.name)&&(r.unFocusActiveElement(),e.isIOSWebView&&e.webview&&(e.webview.removeEventListener("loadend",function(e){}),e.webview.close(),p.deregisterCustomBackAction()))}),o.onLoungeIframeLoad=function(t){i.info("onLoungeIframeLoad",t),s.hasConnectivity().isOnline?e._displayIframe(!0):e._displayIframe(!1),e.$apply()},o.onLoungeIframeError=function(e){i.info("onLoungeIframeError",e)},e._getIframeDom=function(){return document.getElementById("loungeBookingFrame")},e._displayIframe=function(t){e.hideLoungeFrame=!t},e.refreshButtonClick=function(){e._loadLoungeBookingLandingPage(!0)};var f=function(){p.registerCustomBackAction(e.goBack),r.showBackButton(!0)},v=function(){p.deregisterCustomBackAction(),r.showBackButton(!1)};e._loadLoungeBookingLandingPage=function(){if(e.isIOSWebView||e.isAndroidWebView){if(m=c.determineUrl(),m=l.addParameterToQueryString(m,"ts",(new Date).getTime()),!s.hasConnectivity().isOnline)return void e._displayIframe(!1);safeAccess(e,"webview",!1)&&(e.webview.close(),e.webview=null),i.info("Setting URL of WebView"),u.translate(["lounge.title.lounge"]).then(function(t){var a=t["lounge.title.lounge"];e.webview=o.cordova.plugins.AMWebview(m,{hasTabs:!0,hideHeader:!0,postMessageHandler:"PostMessageHandler",headerColor:o.getComputedHeaderColor(),headerText:a.toUpperCase()}),e.isAndroidWebView&&(r.loading(!0),e.webview.addEventListener("loaderror",function(t){r.loading(!1),e.webview.close(),e._displayIframe(!1),i.error(t.message+"-"+t.code+"-"+m)}),e.webview.addEventListener("loadstop",function(t){r.loading(!1),e.webview.show()}),e.webview.addEventListener("exit",function(t){e.webview=null,p.navigateBack()})),e.webview.addEventListener("loadend",function(t){e.webview.canGoBack(function(e){e?f():"more-lounge"!==n.current.name&&"more-guest-lounge"!==n.current.name&&v()},function(e){i.error(e)})})})}else{r.startLoading();var t=c.determineUrl();t=l.addParameterToQueryString(t,"ts",(new Date).getTime()),i.info("Will load lounge iframe:",t),e.pageLoaderTimeout=d(function(){r.stopLoading()},getContext("featureConfig.iframePageLoadTimeout",2500)),e.loungeIframeUrl=a.trustAsResourceUrl(t)}},e.goBack=function(){e.webview.canGoBack(function(t){t?e.webview.goBack():(p.deregisterCustomBackAction(),p.navigateBack())})},t.$on("onMoreMenuPopup",function(t,n){e.webview&&(n.modalDisplayed?e.webview.hide():e.webview.show())});var h=function(){e._loadLoungeBookingLandingPage()};h(),e.$on("$destroy",function(){o.onLoungeIframeLoad=void 0,o.onLoungeIframeError=void 0})}]),loungeModule.run(["$templateCache",function(e){e.put("lounge/templates/pages/LoungeView.html",'<ion-view debug-file-path="LoungeView.html"><ion-nav-title translate>lounge.title.lounge</ion-nav-title><ion-nav-buttons side="primary"><button class="icon button button-clear {{::refreshicon}}" ng-click="refreshButtonClick()"></button></ion-nav-buttons><ion-content><div class="loungeErrorContainer" ng-show="hideLoungeFrame"><p><i class="icon icon-alert-tri-outline space-rt"></i><br>{{&apos;lounge.error.iframeLoadingError&apos;|translate}}</p><button class="btn-small" ng-click="refreshButtonClick()" type="button"><i class="space-rt icon-refresh"></i> {{&apos;lounge.button.refresh&apos;|translate}}</button></div><div class="iframe-container" ng-if="!(isIOSWebView || isAndroidWebView)"><iframe class="loungeFrame" id="loungeBookingFrame" ng-class="{&apos;loungeFrameHidden&apos;: hideLoungeFrame}" ng-src="{{loungeIframeUrl}}" onerror="if(window.onLoungeIframeError) window.onLoungeIframeError(event);" onload="if(window.onLoungeIframeLoad) window.onLoungeIframeLoad(event);"></iframe></div></ion-content></ion-view>')}]),window.carRentalModule=angular.module("CarRentalModule",["ionic","CoreModule","AnalyticsModule"]),window.carRentalModule.run(["$log",function(e){e=e.getInstance("Car Rental"),e.info("Module started")}]),window.carRentalModule.config(["$translatePartialLoaderProvider",function(e){e.addPart("car-rental")}]),window.carRentalModule.routes={"car-rental":{url:"/car-rental",params:{touchPoint:null},templateUrl:"car-rental/templates/pages/CarRentalView.html",controller:"CarRentalController",secured:!0,resolve:{analytics:["AnalyticsService",function(e){return e.screenView("Car rental booking",[],"CrossSell").promise()}]},ncyBreadcrumb:{label:"{{'carRental.title.carRental'|translate}}"}}},carRentalModule.controller("CarRentalController",["$scope","$log","$sce","LayoutService","$window","NetworkService","UrlService","CarRentalService","$timeout","$stateParams",function(e,t,n,i,a,r,o,s,l,c){t=t.getInstance("CarRentalController"),t.info("Controller Started..."),e.carRentalIframeUrl=null,e.hideCarRentalFrame=!1,e.$on("$stateChangeStart",function(e,t,n,a,r,o){"car-rental"===a.name&&i.unFocusActiveElement()}),a.onCarRentalIframeLoad=function(n){t.info("onCarRentalIframeLoad",n),r.hasConnectivity().isOnline?e._displayIframe(!0):e._displayIframe(!1),e.$apply()},a.onCarRentalIframeError=function(e){t.info("onCarRentalIframeError",e)},e._getIframeDom=function(){return document.getElementById("carRentalFrame")},e._displayIframe=function(t){e.hideCarRentalFrame=!t},e.refreshButtonClick=function(){e._loadCarRentalBookingLandingPage(!0)},e._loadCarRentalBookingLandingPage=function(){i.startLoading();var a=s.determineUrl(c.touchPoint);a=o.addParameterToQueryString(a,"ts",(new Date).getTime()),t.info("Will load car rental iframe:",a),e.pageLoaderTimeout=l(function(){i.stopLoading()},getContext("featureConfig.iframePageLoadTimeout",2500)),e.carRentalIframeUrl=n.trustAsResourceUrl(a)};var d=function(){e._loadCarRentalBookingLandingPage()};d(),e.$on("$destroy",function(){a.onCarRentalIframeLoad=void 0,a.onCarRentalIframeError=void 0})}]),carRentalModule.service("CarRentalService",["$log","I18nConfig","StringService","ParameterService","UrlService",function(e,t,n,i,a){e=e.getInstance("CarRentalService"),e.info("Service Started...");var r={determineUrl:function(e){var n=i.parse(),o=n.language||t.getCurrentDeviceLanguage(),s=getContext("featureConfig.carRental.defaultUrl","https://cmt.carsbookingengine.com/")+r.toLocaleLanguage(o)+"/search?embedded=true";return e&&(s=a.addParameterToQueryString(s,"touchpoint",e)),s},toLocaleLanguage:function(e){switch(e){case"de":return"de_DE";case"en":return"en_GB";case"es":return"es_ES";case"fr":return"fr_FR";case"it":return"it_IT";case"ja":return"ja_JP";case"pt":return"pt_BR";case"ru":return"ru_RU";case"sv":return"sv_SE";case"zh":return"zh_TW";default:return"en_GB"}},toString:function(){return"CarRentalService"}};return r}]),carRentalModule.run(["$templateCache",function(e){e.put("car-rental/templates/pages/CarRentalView.html",'<ion-view debug-file-path="CarRentalView.html"><ion-nav-title translate>carRental.title.carRental</ion-nav-title><ion-nav-buttons side="primary"><button class="icon button button-clear {{::refreshicon}}" ng-click="refreshButtonClick()"></button></ion-nav-buttons><ion-content><div class="carRentalErrorContainer" ng-show="hideCarRentalFrame"><p><i class="icon icon-alert-tri-outline space-rt"></i><br>{{&apos;carRental.error.iframeLoadingError&apos;|translate}}</p><button class="btn-small" ng-click="refreshButtonClick()" type="button"><i class="space-rt icon-refresh"></i> {{&apos;carRental.button.refresh&apos;|translate}}</button></div><div class="iframe-container" ng-if="!(isIOSWebView || isAndroidWebView)"><iframe class="carRentalFrame" id="carRentalFrame" ng-class="{&apos;carRentalFrameHidden&apos;: hideCarRentalFrame}" ng-src="{{carRentalIframeUrl}}" onerror="if(window.onCarRentalIframeError) window.onCarRentalIframeError(event);" onload="if(window.onCarRentalIframeLoad) window.onCarRentalIframeLoad(event);"></iframe></div></ion-content></ion-view>')}]);