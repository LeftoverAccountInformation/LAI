window.macro||(window.macro=$("#page_config").text()?JSON.parse($("#page_config").text()):{});
$(function(){var A,q,v,w,B,C;function f(a,b){b?a.html(getText(b)).show():a.hide().html("")}function e(a,b){a.parent().addClass("input_error");b&&a.focus()}function o(a){a.parent().removeClass("input_error")}function r(){var a=c.val()||"",b=$.trim($("#id_input_setcode").val()),j=iu.promptareacode("#area_code","val"),j=j.match(/\d/g).join(""),a=a.replace("+"+j,""),a=$.trim(a);if(parseInt(j)){var D=(j==86?/^\d{11}$/:/^\d{6,14}$/).test(a)&&a!=0?0:1;a==""?(k.hide(),f(l,"cc_comm_phone_empty"),e(c,!0)):
D===1?(f(l,"cc_mobile_invalid"),e(c),k.hide(),c.focus()):b==""?(f(s,"cs_empty_setcode"),e(t),k.hide(),t.focus()):D===0?($("#btn_vcode_send").unbind("click"),isappAjax({url:"/user/register",data:{act:"get_vcode",area_code:j,mobile:a,language:isapp.getLangId(),setcode:b},type:"post"},function(){f(E);isapp.toastCommon("cc_moblie_vocde_sent",2);o(c);$("#get_vcode").hide();$("#set_passwd").show();$("#phone_vc_section").show();$("#phone_pwd_section").hide();$(".error_msg").hide();G();x.focus();o(x);x.val("").focus();
$("#btn_vcode_send").bind("click",r)},function(a){if(A==a)d="cs_err_setcode",e(t),f(s,d),$("#setcode_img").click(),$("#id_input_setcode").val("").focus();else{if(q==a)d="cc_comm_phone_used",e(c);else if(v==a)d="cc_usr_comm_phonereged_cc",e(c);else if(w==a)d="cc_comm_vcode_notok";else if(B==a)d="cc_comm_vcodetoomany";else if(C==a){isapp.toastCommon("cc_moblie_vocde_sent_failed",1);$("#btn_vcode_send").bind("click",r);return}else d="cc_msg_network_busy";f(E,d);k.hide();c.focus();s.hide()}$("#btn_vcode_send").bind("click",
r)})):(k.hide(),e(c,!0))}else k.hide(),e(c,!0)}function G(){$("#link_vcode_resend").unbind("click").removeClass("link_resend_active");sec=60;$("#id_m_resend_count").html("("+xss(sec)+getText("cc_usr_ok_sec")+")");window.clearInterval(y);y=setInterval(function(){sec?$("#id_m_resend_count").html("("+xss(--sec)+getText("cc_usr_ok_sec")+")"):(clearInterval(y),$("#id_m_resend_count").html(""),$("#link_vcode_resend").bind("click",function(){$("#btn_vcode_send").trigger("click");$(this).unbind("click").removeClass("link_resend_active")}).addClass("link_resend_active"))},
1E3)}var m="",z="",d="",F=$("#id_email_err"),g=$("#id_pwd_nok"),i=$("#id_mopwd_nok"),n=$("#id_pwd_repeat_nok"),h=$("#id_mopwd_repeat_nok"),c=$("#id_input_phone"),t=$("#id_input_setcode");$("#area_code");var x=$("#id_input_vcode"),p=$("#id_vc_err"),H=$("#id_input_pwd_phone"),I=$("#id_input_repwd_phone");$("id_mo_input_register");$("#id_phone_err");var E=$(".phone_err"),l=$("#id_phone_err"),s=$("#id_setcode_err"),k=$("#id_phone_ok");v="-203";q="-202";B="-211";w="-107";C="-100";A="-1000";$("#reuid").val(macro.REUID);
$("#redirect_uri").val(macro.REDIRECT_URI);$("#product").val(macro.PRODUCT);iu.promptemail("#id_input_email","zIndex",1E3);$("#id_input_email").bind("blur",function(){$(this).val()?isappFormValidator.single("id_input_email","email",function(a){a===1?(d="cc_comm_invalidemail_register",$("#id_email_err").html(getText(d)).show(),$("#id_email_ok").hide()):a==0&&isappAjax({url:"/user/emailexist",data:{account:$("#id_input_email").val().toLowerCase()},type:"post"},function(){$("#id_email_err").html("").hide()},
function(a){$("#id_email_ok").hide();"-204"==a?$("#id_email_err").html("").hide():(a=v==a?"cc_usr_comm_emailreged_cc":"cc_usr_comm_emailreged",$("#id_email_err").html(getText(a)).show())})}):$("#id_email_ok").hide()}).keyup(function(a){if(a.which==13){var b=this.value;setTimeout(function(){isappFormValidator.isEmail(b)===0&&$("#id_input_pwd").focus()})}}).focus();$(".select_type").bind("click",function(){var a=$(this);a.addClass("select").siblings(".select_type").removeClass("select");a.find(".box").addClass("select");
a.siblings(".select_type").find(".box").removeClass("select");$("#id_page_category").attr("value",a.data("value"))});macro.DEFAULT_CATEGORY==="team"?$(".select_type.team").trigger("click"):macro.DEFAULT_CATEGORY==="vip"&&$(".select_type.senior").trigger("click");iu.tool.input("#id_input_pwd",function(){checkPwdStrong(this.value,$("#id_pwd_level"))});$("#id_input_pwd").bind("keydown",function(a){this.key=a.which}).bind("keyup",function(a){a.which==13&&isappFormValidator.isLength(this.value,"6,100")===
0&&$("#id_input_repwd").focus()}).bind("blur",function(){this.value?this.value.indexOf(" ")>=0?($("#id_pwd_ok").hide(),g.html(getText("cs_pwd_no_blank")).show(),$("#id_pwd_repeat_ok").hide(),$("#id_pwd_repeat_nok").hide()):this.value.length>5?g.hide():($("#id_pwd_ok").hide(),g.html(getText("cc_comm_short_password")).show(),$("#id_pwd_repeat_ok").hide(),$("#id_pwd_repeat_nok").hide()):$("#id_pwd_ok").hide()});$("#id_input_repwd").bind("blur",function(){if($("#id_input_pwd").val())if(this.value)$("#id_input_pwd").val().length<
6?($("#id_pwd_ok").hide(),g.html(getText("cc_comm_short_password")).show()):$("#id_input_pwd").val()===$("#id_input_repwd").val()?n.hide():($("#id_pwd_repeat_ok").hide(),n.html(getText("cc_msg_cap_pwdnotmatch")).show());else{var a;n.html(getText("cc_msg_cap_pwdnotmatch")).show();$("#id_pwd_repeat_ok").hide()}}).bind("keyup",function(a){a.which==13&&$("#id_input_register").trigger("click")});$("#id_input_register").bind("click",function(){$("#id_form_register").submit()});var u=!1;$("#id_form_register").bind("submit",
function(){if(u)return!1;var a=$("input[name=email]"),b=$("#id_input_pwd"),c=$("#id_input_repwd");if(a[0].key==13&&a.val()&&!b.val())return b.focus(),a[0].key=0,!1;a[0].key=0;if(b[0].key==13&&b.val()){if(b.val().length<6)return d="cc_comm_short_password",$("#id_pwd_ok").hide(),g.html(getText(d)).show(),b.focus(),!1;if(!c.val())return c.focus(),b[0].key=0,!1}b[0].key=0;m=a.val();if((z=b.val())&&z.indexOf(" ")>=0)return $("#id_pwd_ok").hide(),g.html(getText("cs_pwd_no_blank")).show(),$("#id_pwd_repeat_ok").hide(),
$("#id_pwd_repeat_nok").hide(),!1;if(isappFormValidator("id_form_register",[{name:"email",rule:"email",fn:function(a){a!=0&&(a===1?F.html(getText("cc_comm_invalidemail_register")).show():a===2&&F.html(getText("cc_comm_enteremail")).show(),this.focus())}},{name:"password",rule:"length=6,100",fn:function(a){a!=0&&(a===1?g.html(getText("cc_comm_short_password")).show():a===2&&g.html(getText("cc_comm_enterpwd")).show(),this.focus())}},{name:"repassword",rule:"match=id_input_pwd",fn:function(a){a!=0?($("#id_pwd_repeat_ok").hide(),
a===1?n.html(getText("cc_msg_cap_pwdnotmatch")).show():a===2&&n.html(getText("cc_comm_confirmpwd")).show(),this.focus()):n.hide()}}]))if($("#id_email_err").css("display")!="none")$("#id_input_pwd").focus();else return $("#id_input_language").val(isapp.getLangId()),isappFormAjax("id_form_register",function(a){u=!1;$("#id_signupform").hide();$("#id_register_ok").show();$("#id_toemail").html(xss(m));m.indexOf("edu.")>0&&m.indexOf("@")<m.indexOf("edu.")?$("#id_edu").show():$("#id_edu").hide();a==="N/A"?
($("#id_check_email").hide(),$("#id_btn_email_check").hide()):$("#id_btn_email_check").bind("click",function(){location.href=a});var b=60;$("#id_btn_countdown").html(getText("cc_usr_ok_wait_for")+" "+xss(b)+" "+getText("cc_usr_ok_sec")).bind("countdown",function(){var a=setInterval(function(){b?$("#id_btn_countdown").html(getText("cc_usr_ok_wait_for")+" "+xss(--b)+" "+getText("cc_usr_ok_sec")):(clearInterval(a),$("#id_btn_countdown").hide(),$("#id_btn_resend").show())},1E3)}).trigger("countdown");
$("#id_btn_resend").bind("click",function(){var a=$(".select_type.select").data("value");isappAjax({url:"/user/register",data:{email:m,password:z,act:"submit",language:isapp.getLangId(),category:a},type:"post"},function(){$("#id_btn_resend").hide();b=60;$("#id_btn_countdown").html(getText("cc_usr_ok_wait_for")+" "+xss(b)+" "+getText("cc_usr_ok_sec")).show().trigger("countdown");isapp.toastCommon("cc_sys_email_resendok",2)},function(a){q==a?isapp.toastCommon("cc_usr_comm_emailreged",2):isapp.toastCommon("cc_sys_email_resendfail",
1)})});$("#id_signupform").hide();$("#id_register_ok").show();$("#register_left").hide()},function(a){u=!1;$("#btn_back").bind("click",function(){location="/user/register"});q===a?isapp.toastCommon("cc_usr_comm_emailreged",2):isapp.toastCommon("cc_usr_comm_errsendtoomany",1)}),u=!0,!1});c.bind("change",function(){var a=l.attr("langid")||"";this.value&&(a==""?o(c):a=="invalid_phone"?isappFormValidator.isMobile(this.value)===0&&(f(l),o(c)):a=="phone_reged"&&(f(l),o(c)))}).bind("keyup",function(a){a.which==
13&&$("#btn_vcode_send").trigger("click")}).bind("keydown",function(){l.hide()});$("#btn_vcode_send").bind("click",r);t.bind("keydown",function(){s.hide()});$("#btn_vcode_check").bind("click",function(){var a=c.val()||"",b=iu.promptareacode("#area_code","val"),b=b.match(/\d/g).join(""),a=a.replace("+"+b,""),a=$.trim(a),d=$("#id_input_vcode").val();parseInt(b)?isappFormValidator("id_form_register_mobile",[{name:"vcode",rule:"length=6,6",fn:function(a){a!=0&&(a===1?p.html(getText("cc_comm_vcode_notok")).show():
a===2&&p.html(getText("cc_comm_entervcode")).show(),this.focus())}}])?isappAjax({url:"/user/register",data:{act:"submit_vcode",area_code:b,mobile:a,vcode:d,language:isapp.getLangId()},type:"post"},function(a){$("#phone_vc_section").hide();$("#phone_pwd_section").show();$("#sms_token").attr("value",a);$("#id_input_repwd_phone").val("");$(".error_msg").hide();$(".icon_ok").hide();$("#id_input_pwd_phone").val("").trigger("keyup").focus()},function(a){p.html(getText(w==a?"cc_comm_vcode_notok":"cc_msg_network_busy")).show()}):
e(p):(p.hide(),e(c,!0))});$("#id_input_vcode").bind("keyup",function(a){a.which==13&&$("#btn_vcode_check").trigger("click")});iu.tool.input("#id_input_pwd_phone",function(){checkPwdStrong(this.value,$("#id_mopwd_level"))});$("#id_input_pwd_phone").bind("keydown",function(a){this.key=a.which}).bind("keyup",function(a){a.which==13&&isappFormValidator.isLength(this.value,"6,100")===0&&$("#id_input_repwd_phone").focus()}).bind("blur",function(){var a=this.value;a?a&&a.indexOf(" ")>=0?($("#id_mopwd_ok").hide(),
i.html(getText("cs_pwd_no_blank")).show(),$("#id_mopwd_repeat_ok").hide(),$("#id_mopwd_repeat_nok").hide()):a.length>5?(i.hide(),$("#id_mopwd_ok").show(),$("#id_input_repwd_phone").val()?a===$("#id_input_repwd_phone").val()?(h.hide(),$("#id_mopwd_repeat_ok").show()):($("#id_mopwd_repeat_ok").hide(),h.html(getText("cc_msg_cap_pwdnotmatch")).show()):(h.hide(),$("#id_pwd_repeat_ok").hide())):($("#id_mopwd_ok").hide(),i.html(getText("cc_comm_short_password")).show(),$("#id_mopwd_repeat_ok").hide(),$("#id_mopwd_repeat_nok").hide()):
($("#id_mopwd_ok").hide(),i.html(getText("cc_comm_enterpwd")).show())});$("#id_input_repwd_phone").bind("blur",function(){this.value?$("#id_input_pwd_phone").val()===$("#id_input_repwd_phone").val()?(h.hide(),$("#id_mopwd_repeat_ok").show()):($("#id_mopwd_repeat_ok").hide(),d="cc_msg_cap_pwdnotmatch",h.html(getText(d)).show()):$("#id_mopwd_repeat_ok").hide()}).keyup(function(a){a.which==13&&$("#id_mo_input_register").trigger("click")});$(".switch_btn").bind("click",function(){$(".switch_btn").removeClass("switch_selected");
$(this).addClass("switch_selected");var a=$(this).attr("id").slice(4);$(".reg_body").hide();$("#"+a).show();$(".error_msg").hide();a=="mobile_reg"?($("#id_input_setcode").val(""),$("#setcode_img").click(),$("#set_passwd").hide(),$("#get_vcode").show(),c.focus(),a=isapp.getLangId(),iu.promptareacode("#area_code",{langid:a,showtext:0,btnwidth:310,sltwidth:310})):$("#id_input_email").focus();$(".signup .error_msg").hide()});$("#id_mo_input_register").bind("click",function(){var a=H.val();I.val();var b=
$("#sms_token").val(),d=c.val()||"",e=iu.promptareacode("#area_code","val"),e=e.match(/\d/g).join(""),f=$("#id_input_vcode").val(),g=$(".select_type.select").data("value"),d=d.replace("+"+e,"");if(a&&a.indexOf(" ")>=0)return $("#id_mopwd_ok").hide(),i.html(getText("cs_pwd_no_blank")).show(),$("#id_mopwd_repeat_ok").hide(),$("#id_mopwd_repeat_nok").hide(),!1;isappFormValidator("id_form_register_mobile",[{name:"password",rule:"length=6,100",fn:function(a){a!=0&&(a===1?i.html(getText("cc_comm_short_password")).show():
a===2&&i.html(getText("cc_comm_enterpwd")).show(),this.focus())}},{name:"repassword",rule:"match=id_input_pwd_phone",fn:function(a){a!=0?($("#id_mopwd_repeat_ok").hide(),a===1?h.html(getText("cc_msg_cap_pwdnotmatch")).show():a===2&&h.html(getText("cc_comm_confirmpwd")).show(),this.focus()):(h.hide(),$("#id_mopwd_repeat_ok").show())}}])&&$("#id_email_err").css("display")!="block"&&isappAjax({url:"/user/register",data:{act:"submit_reg",sms_token:b,password:a,mobile:d,area_code:e,vcode:f,reuid:$("#reuid").val(),
category:g}},function(a){location.href=a.n},function(){isapp.toastCommon("cc_msg_network_busy",1)})});var y=null;$("#setcode_img").bind("click",function(){$(this).attr("src",xss_href("/user/setcode?"+Date.parse(new Date)))})});
