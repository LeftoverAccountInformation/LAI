var Pastease=function(){var TEST=!1,Base_url=TEST?"http://"+document.location.host:document.location.protocol+"//deploy.mopinion.com",Cookie_pro_active_days=365,LOG=!1,STREAM=!1,TRIGGERS=["passive","proactive","exit"],SERVICES=["mopinion"],USE_$=!1,AJAX_$=!1,SEPARATE_COOKIES=!0,CHECK_JOB=!0,MOPINION_VERSION="1.3",MOPINION_FILE="survey.min",USE_COLLECT=!1,SOCKET,EXIT=!1,EXIT_ACTIVATED=!1,DEBUG=!1,URL_DETECTION,ID,REPARSERS={},ACTIVE_RULES={},LOADED_SERVICES=[],LOCAL_FILE=null;return{load:function(e){ID=e,Pastease.debug(),Pastease.log("loading Pastea.se "+e),USE_$&&Pastease.jquery(),STREAM&&(Pastease.socketio(),SOCKET=Pastease.socket()),Pastease.config(e)},config:function(e){var t="/config/"+e,o={},a=Pastease.parse;USE_$||AJAX_$?Pastease.send(t,o,a,"get"):Pastease.sendXML(t,o,a,"get")},parse:function(o,e,t){try{o=JSON.parse(o)}catch(e){Pastease.log(e)}if(!o.OK)return Pastease.log("Status not OK!"),!1;if(o.code&&o.global&&(Pastease.log("Global settings:"),Pastease.log("service: "+o.global.service),Pastease.log("version: "+o.global.version),"mopinion"==o.global.service&&o.global.version&&(MOPINION_VERSION=o.global.version)),!("code"in o&&200==o.code&&"deployment"in o&&"rules"in o.deployment)){Pastease.log("code: "+o.code),Pastease.log(JSON.stringify(o)),ID="";a=[];return!1}var a=o.deployment.rules;if(void 0===o||null==o||"published"in o.deployment&&!o.deployment.published)return Pastease.log("Not published!"),!1;if("version"in o.deployment&&(MOPINION_VERSION=o.deployment.version,Pastease.log("MOPINION VERSION customized to "+MOPINION_VERSION)),"file"in o.deployment&&(MOPINION_FILE=o.deployment.file,Pastease.log("MOPINION FILE customized to "+MOPINION_FILE)),"local_file"in o.deployment&&(LOCAL_FILE=o.deployment.local_file,Pastease.log("MOPINION FILE local: "+LOCAL_FILE)),"use_collect"in o.deployment&&(USE_COLLECT=o.deployment.use_collect,Pastease.log("Use collect as survey host "+USE_COLLECT)),0==a.length)return!1;for(var n=0;n<a.length;n++){if(Pastease.log("============================"),Pastease.log("---RULE "+n),Pastease.log(JSON.stringify(a[n])),!("if"in a[n]&&"then"in a[n]))return!1;if("id"in a[n]&&null!=a[n].id&&SEPARATE_COOKIES)var s=a[n].id;if(Pastease.log("RULE ID: "+s),"show_form"in a[n])var i=a[n].show_form;else i=null;"debug"in a[n]&&a[n].debug&&(DEBUG=!0);for(var r=a[n].if,c=a[n].then,l=0;l<r.length;l++){Pastease.log("-----------------------"),Pastease.log("if rule "+l);var u=r[l];Pastease.log("condition: "+JSON.stringify(u));var d=!1,v=null;if("session"in u)try{v=Number(u.session)}catch(e){}Pastease.log("Condition session "+v+" days"),Pastease.testCondition(u,l,s,t,c).condition&&(d=!0);for(var f=[],m=0;m<c.length;m++){var g=c[m];if(!("service"in g&&"args"in g))return!1;-1==LOADED_SERVICES.indexOf(g.service)&&d?(LOADED_SERVICES.push(g.service),f.push(Pastease.services(g))):-1<LOADED_SERVICES.indexOf(g.service)&&d&&"mopinion"==g.service&&f.push(Pastease.services(g,!0))}if(d)if(e&&ACTIVE_RULES.hasOwnProperty(s))Pastease.log("Just updating... Rule id: "+s+" still ok.");else{ACTIVE_RULES.hasOwnProperty(s)||(ACTIVE_RULES[s]={}),ACTIVE_RULES[s]["rule_"+l]={rules:a[n]},Pastease.log("All OK!");var p=function(){for(var e=0;e<f.length;e++)f[e](),Pastease.log("basic code: "+f[e]);var t=Pastease.triggers(g[["service"]],g.args,r[l].trigger,r[l].percentage,r[l].time,v,i,r[l].time_in_session,!1,s,r[l],o,"rule_"+l);t(),Pastease.log("trigger code: "+t),Pastease.log("triggered!")}}else{p=function(){};if(Pastease.log("not all OK..."),Pastease.log("Rule id: "+s+" not ok"),ACTIVE_RULES.hasOwnProperty(s)&&ACTIVE_RULES[s]["rule_"+l]&&(ACTIVE_RULES[s]["rule_"+l].hasOwnProperty("timeout")&&clearTimeout(ACTIVE_RULES[s]["rule_"+l].timeout),ACTIVE_RULES[s]["rule_"+l].hasOwnProperty("scroll")&&"function"==typeof ACTIVE_RULES[s]["rule_"+l].scroll&&Pastease.listeners().removeListener(window,"scroll",ACTIVE_RULES[s]["rule_"+l].scroll),ACTIVE_RULES[s]["rule_"+l].hasOwnProperty("exit")&&"function"==typeof ACTIVE_RULES[s]["rule_"+l].exit&&Pastease.listeners().removeListener(document.getElementsByTagName("html")[0],"mouseleave",ACTIVE_RULES[s]["rule_"+l].exit),(!ACTIVE_RULES[s]["rule_"+l].triggered||t)&&(delete ACTIVE_RULES[s]["rule_"+l],!Object.keys(ACTIVE_RULES[s]).length))){var E=!0;for(var P in ACTIVE_RULES){var h=ACTIVE_RULES[P];for(var _ in h){var y=h[_];if(_!==s&&y.initialized&&!t){var I="";try{I=y.rules.then[0].args[0]}catch(e){}I==g.args[0]&&(E=!1)}}}E&&Pastease.clearService(g.service,g.args),delete ACTIVE_RULES[s]}}d&&Pastease.run(p,!0,!1)}}STREAM&&Pastease.streamInfo(),REPARSERS.set||Pastease.reparse(o)},reparse:function(t){REPARSERS.set=!0;var e=Pastease.debounce(function(e){Pastease.parse(t,!0,e)},500);REPARSERS.forceReparse=function(){e()},REPARSERS.mopinionShown=Pastease.listeners().addListener(document,"mopinion_shown",function(){e()}),REPARSERS.mopinionHidden=Pastease.listeners().addListener(document,"mopinion_hidden",function(){e()}),REPARSERS.mopinionLoaded=Pastease.listeners().addListener(document,"mopinion_loaded",function(){e()}),URL_DETECTION=URL_DETECTION||document.location.href;var o=setInterval(function(){document.location.href!==URL_DETECTION&&(URL_DETECTION=document.location.href,e(!0))},500);REPARSERS.pollURL=o},forceParse:function(){if(REPARSERS&&"function"==typeof REPARSERS.forceReparse)return REPARSERS.forceReparse()},testCondition:function(e,t,o,a,n){if(Pastease.log("-----------------------"),"trigger"in e&&!(TRIGGERS.indexOf(e.trigger)<0)||Pastease.log("WARNING: no trigger!"),"pause"in e&&e.pause)return Pastease.log("Condition paused"),!1;function s(e){var t=!1;try{document.querySelector(e)&&(t=!0)}catch(e){}return t}var i,r=!0;if(n&&n instanceof Array&&"object"==typeof n[0]&&n[0].disableMakeDiv&&n[0].args&&n[0].args[2]){var c=Pastease.getSelector(n[0].args[2]);(r=s(c))||REPARSERS[o]||(i=c,REPARSERS[o]=setInterval(function(){s(i)&&(clearInterval(REPARSERS[o]),Pastease.log(i+" found, rechecking rules"),Pastease.forceParse())},500))}Pastease.log("Render div: "+r);function l(e){if("string"==typeof e&&(e={value:e}),"object"==typeof e&&"value"in e){if("operator"in e&&-1<["exists","does not exist"].indexOf(e.operator))var t=e.operator;else t="exists";var o="boolean"!=typeof e.regex||e.regex;return Pastease.searchLocation(e.value,!1,t,o)}return!0}var u=!0;if("location"in e&&0<e.location.length){var d=e.location.every(function(e){return e instanceof Array?e.every(function(e){return"does not exist"===e.operator}):"object"==typeof e?"does not exist"===e.operator:void 0})?"every":"some";u=e.location[d](function(e){return e instanceof Array?e.every(function(e){return l(e)}):l(e)})}Pastease.log("location: "+u);var v=!0;if("referrer"in e&&0<e.referrer.length){v=!1,0==e.referrer.length&&(v=!0);for(var f=0;f<e.referrer.length;f++){if(Pastease.referrer(e.referrer[f],!1)){v=!0;break}}}Pastease.log("referrer: "+v);function m(e){if(!("name"in e&&("value"in e||"operator"in e)))return!0;if("operator"in e&&-1<["exists","does not exist","contains","matches exactly"].indexOf(e.operator))var t=e.operator;else t=null;return null==t?Pastease.getCookie(e.name,!0)==e.value:"exists"==t?""!=Pastease.getCookie(e.name,!0):"does not exist"==t?""==Pastease.getCookie(e.name,!0):"matches exactly"==t?Pastease.getCookie(e.name,!0)==e.value:"contains"==t?null!=Pastease.getCookie(e.name,!0).match(e.value):"does not contain"==t?null==Pastease.getCookie(e.name,!0).match(e.value):void 0}var g=!0;"cookie"in e&&0<e.cookie.length&&(g=e.cookie.some(function(e){return e instanceof Array?e.every(function(e){return m(e)}):m(e)})),Pastease.log("cookie: "+g);function p(e){if("name"in e&&("value"in e||"operator"in e)){if("operator"in e&&-1<["exists","does not exist","contains","matches exactly","does not contain"].indexOf(e.operator))var t=e.operator;else t=null;return Pastease.jsVar(e.name,e.value,t)}return!0}var E=!0;"js"in e&&0<e.js.length&&(E=e.js.some(function(e){return e instanceof Array?e.every(function(e){return p(e)}):p(e)})),Pastease.log("js: "+E);function P(e){if("name"in e&&("value"in e||"operator"in e)){if("operator"in e&&-1<["exists","does not exist","contains","matches exactly","does not contain"].indexOf(e.operator))var t=e.operator;else t=null;return Pastease.cssSelector(e.name,e.value,t)}return!0}var h=!0;"css_selector"in e&&0<e.css_selector.length&&(h=e.css_selector.some(function(e){return e instanceof Array?e.every(function(e){return P(e)}):P(e)})),Pastease.log("css_selector: "+h);var _=!0;_=!("number_of_pages"in e&&"check"in e.number_of_pages&&"amount"in e.number_of_pages)||Pastease.numberOfPages(e.number_of_pages.check,e.number_of_pages.amount,!1,o,"rule_"+t),Pastease.log("nr of pages: "+_+" for iteration "+t);var y=!0;if("devices"in e&&0<e.devices.length){for(var I=!1,S=Pastease.testDevice(),T=0;T<e.devices.length;T++)("desktop"!=e.devices[T]||S.phone||S.seven_inch||S.tablet)&&("tablet"!=e.devices[T]||!0!==S.tablet&&!0!==S.seven_inch)?"mobile"==e.devices[T]&&!0===S.phone&&(I=!0):I=!0;y=I}Pastease.log("device: "+y);var R=!0;R=!("type"in e&&-1<["new","returning"].indexOf(e.type))||Pastease.type(e.type,!1,o,"rule_"+t,e.session),Pastease.log("new/returning visitor: "+R);var A=!0;"date"in e&&"object"==typeof e.date&&(e.date.date&&-1<["earlier","exactly","later"].indexOf(e.date.operator)?A=Pastease.datetime("date",e.date.date,e.date.operator):e.date.date&&e.date.date2&&-1<["between"].indexOf(e.date.operator)&&(A=Pastease.datetime("date",e.date.date,e.date.operator,e.date.date2))),Pastease.log("Date: "+A);var C=!0;if("clock"in e&&"object"==typeof e.clock&&(e.clock.time&&-1<["earlier","exactly","later"].indexOf(e.clock.operator)?C=Pastease.datetime("time",e.clock.time,e.clock.operator):e.clock.time&&e.clock.time2&&-1<["between"].indexOf(e.clock.operator)&&(C=Pastease.datetime("time",e.clock.time,e.clock.operator,e.clock.time2))),Pastease.log("Clock: "+C),"scrollpos"in e&&"from"in e.scrollpos&&"px"in e.scrollpos)var O=!0;else O=!1;var b=r&&u&&v&&g&&E&&_&&y&&R&&h&&A&&C,L=!0;if(b&&"percentage"in e){var x=e.session,w=isNaN(parseInt(e.percentage,10))?100:parseInt(e.percentage,10),k=Math.floor(100/w);k=isFinite(k)?k:0;var V="proactive"===e.trigger?"pro_active":e.trigger;if(""==Pastease.getCookie("Pastease."+V+".chance",!1,o)){var N=Pastease.rnd(k);Pastease.setCookie("Pastease."+V+".chance",N,x,"/",void 0,!1,o),Pastease.setCookie("Pastease."+V+".activated",0,x,"/",void 0,!1,o),Pastease.log(V+" condition set: 1 in "+k+", random nr: "+N)}k==Pastease.getCookie("Pastease."+V+".chance",!1,o)&&1!=Pastease.getCookie("Pastease."+V+".activated",!1,o)||(L=!1)}return Pastease.log("Percentage: "+L),{condition:b&&L,scroll:O}},run:function(code,try_catch,return_code){if(DEBUG)Pastease.log("DEBUG MODE, code will not be executed");else if(try_catch=void 0!==try_catch&&try_catch,try_catch)try{return_code?(Pastease.log("code: "+code),eval(code)):code()}catch(e){Pastease.log(e)}else return_code?(Pastease.log("code: "+code),eval(code)):code()},searchLocation:function(e,t,o,a){return(t=void 0===t||t)?'(document.location.host+document.location.pathname+location.search+location.hash).match("'+e+'") != null':a?"exists"==o?null!=(document.location.host+document.location.pathname+location.search+location.hash).match(e):null==(document.location.host+document.location.pathname+location.search+location.hash).match(e):"exists"==o?-1<(document.location.host+document.location.pathname+location.search+location.hash).indexOf(e):(document.location.host+document.location.pathname+location.search+location.hash).indexOf(e)<0},referrer:function(e,t){return(t=void 0===t||t)?'(document.referrer).match("'+e+'") != null':null!=document.referrer.match(e)},jsVar:function(name,value,operator){if(-1<name.indexOf("[*]")&&null!=operator)var split=name.split("[*]"),array=split[0],key=split[1],found=window[array].some(function(el,index){var arrayString=array+"["+index+"]"+key,exists;try{exists=eval(arrayString)}catch(e){}return void 0!==exists&&(name=arrayString),void 0!==exists});var jsVar;try{jsVar=eval(name)}catch(e){}if(null==operator)return void 0!==jsVar&&jsVar==value;switch(operator){case"exists":return void 0!==jsVar;case"does not exist":return void 0===jsVar;case"matches exactly":return void 0!==jsVar&&jsVar==value;case"contains":return void 0!==jsVar&&null!=String(jsVar).match(value);case"does not contain":return void 0!==jsVar&&null==String(jsVar).match(value)}},cssSelector:function(e,t,o){if(!o)return!1;var a;try{a=document.querySelectorAll(e)}catch(e){}if("exists"===o){if(void 0!==a)return 0<a.length}else if("does not exist"===o){if(void 0!==a)return 0===a.length}else if("contains"===o){if(void 0!==a&&0<a.length)return t=t||"",((a=a[0]).textContent||a.innerText).match(new RegExp(t,"gi"))}else if("matches exactly"===o){if(void 0!==a&&0<a.length)return t==((a=a[0]).textContent||a.innerText).replace(/^\s+|\s+$/g,"")}else if("does not contain"===o){if(void 0!==a&&0<a.length)return t=t||"",!((a=a[0]).textContent||a.innerText).match(new RegExp(t,"gi"))}},numberOfPages:function(e,t,o,a,n){return o=void 0===o||o,a=void 0===a?null:a,t=Number(t),e="min"==e?">":"max"==e?"<":null,""!=Pastease.getCookie("page_count",!1,a+n)?count=Number(Pastease.getCookie("page_count",!1,a+n)):count=0,(""==Pastease.getCookie("last_page",!1,a+n)||""!=Pastease.getCookie("last_page",!1,a+n)&&Pastease.getCookie("last_page",!1,a+n)!=document.location.pathname)&&(count+=1),Pastease.setCookie("last_page",document.location.pathname+document.location.hash,0,"/",void 0,!1,a+n),Pastease.setCookie("page_count",count,0,"/",void 0,!1,a+n),null==e||(">"==e?count>=t:"<"==e?count<=t:void 0)},type:function(e,t,o,a,n){t=void 0===t||t,o=void 0===o?null:o;function s(e){return Math.floor(e/1e3)}function i(e){Pastease.setCookie("Pastease.session",e,n,"/",void 0,!1)}function r(){return s((new Date).getTime())-Number(Pastease.getCookie("Pastease.session"))<60}function c(){return Pastease.getCookie("Pastease.session")||i(s((new Date).getTime())),1!=Pastease.getCookie("Pastease.returning")&&1!=Pastease.getCookie("Pastease.returning",!1,o+a)&&(r()?!!r()||void 0:(Pastease.setCookie("Pastease.returning",1),!1))}return REPARSERS.sessionPoll||(REPARSERS.sessionPoll=setInterval(function(){i(s((new Date).getTime()))},1e4)),"new"===e?c():!c()},datetime:function(e,t,o,a){if(e&&t&&o){function n(e,t){if(t){var o=e.split("/"),a=o[0];o[0]=o[1],o[1]=a,e=o.join("-")}if(e)var n=new Date(e);else n=new Date;return new Date(n.setHours(0,0,0,0)).getTime()}var s={earlier:function(e,t){return t<e},exactly:function(e,t){return e==t},later:function(e,t){return e<t},between:function(e,t,o){return s.later(e,o)&&s.earlier(t,o)}};if("date"==e)return"between"===o?s[o](n(t,!0),n(a,!0),n()):s[o](n(t,!0),n());if("time"==e){var i=new Date;return i=("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2),"between"===o?s[o](t,a,i):s[o](t,i)}}},scroll:function(t,o,a,n,s){t="undefined"!==t?t:"top";var i=isNaN(o);i&&(o=o.replace("%","")),o=parseInt(o);var r=!1,c=USE_$?$(document).height():document.body.scrollHeight,l=USE_$?$(window).height():window.innerHeight;USE_$?$(window).scroll(function(){r=Pastease.onScroll(event,t,o,a,i,r,c,l,n)}):(ACTIVE_RULES[n][s].scroll=Pastease.debounce(function(e){Pastease.onScroll(e,t,o,a,i,r,c,l,n,s)},200),Pastease.listeners().addListener(window,"scroll",ACTIVE_RULES[n][s].scroll));return"true"},onScroll:function(e,t,o,a,n,s,i,r,c,l){var u=USE_$?$(window).scrollTop():(window.pageYOffset||document.scrollTop)-(document.clientTop||0),d=(u+r)/i*100,v=i-(u+r),f=100-d,m=Pastease.listeners();return Pastease.log("top: "+u),Pastease.log("top: "+d+" %"),Pastease.log("bottom: "+v),Pastease.log("bottom: "+f+" %"),Pastease.log("code loaded: "+s),"top"==t?!s&&(!n&&o<=u||n&&o<=d)&&(Pastease.run(a,!1),s=!0,m.removeListener(window,"scroll",ACTIVE_RULES[c][l].scroll)):"bottom"==t&&!s&&(!n&&v<=o||n&&f<=o)&&(Pastease.run(a,!1),s=!0,m.removeListener(window,"scroll",ACTIVE_RULES[c][l].scroll)),s},exit:function(e,o,t,a,n,s,i,r){t=void 0!==t&&null!=t?t:Cookie_pro_active_days,a=void 0!==a&&null!=a?a:"once",e=void 0!==e&&null!=e?e:0,n=void 0!==n?n:null,Pastease.log("Exit activated!");var c;if(!USE_$)var l=Pastease.listeners(),u=l.addListener,d=l.removeListener;if(USE_$)$(document).mousemove(function(e){e=e||window.event,IE=!!document.all,IE,mouseY=e.clientY,c=mouseY});else{var v=function(e){e=e||window.event,IE=!!document.all,IE,mouseY=e.clientY,Pastease.log("mouseY: "+mouseY),c=mouseY};u(document,"mousemove",v)}e=Pastease.outAtime(e,n,"Pastease.exit.timestamp",i),Pastease.log("trigger time: "+e);var f=setTimeout(function(){if(Pastease.log("waiting for exit..."),USE_$)$(document).mouseleave(function(e){c<=100&&Pastease.getExit()&&!EXIT_ACTIVATED&&(EXIT_ACTIVATED=!0,o(),Pastease.log("Oh no, left page...exit!"))});else{var t=document.getElementsByTagName("html")[0];ACTIVE_RULES[i][r].exit=function(e){Pastease.log("y : "+c),Pastease.log("y_min : 100"),Pastease.log("EXIT_ACTIVATED : "+EXIT_ACTIVATED),c<=100&&Pastease.getExit()&&!EXIT_ACTIVATED&&(EXIT_ACTIVATED=!0,Pastease.log("exit code:"),Pastease.log(o),o(),Pastease.log("Oh no, left page...exit!"),d(t,"mousemove",ACTIVE_RULES[i][r].exit),d(document,"mousemove",v))},u(t,"mouseleave",ACTIVE_RULES[i][r].exit)}try{ACTIVE_RULES[i][r].initialized=!0}catch(e){}},e);return ACTIVE_RULES[i][r].timeout=f,s?"Pastease.setExit();":Pastease.setExit},listeners:function(){var e,t;return t=document.addEventListener?(e=function(e,t,o){return e.addEventListener(t,o,!1)},function(e,t,o){return e.removeEventListener(t,o,!1)}):(e=function(e,t,o){return e.attachEvent("on"+t,o)},function(e,t,o){return e.detachEvent("on"+t,o)}),{addListener:e,removeListener:t}},setExit:function(e){void 0===e&&(e=!0),EXIT=!!e},getExit:function(){return EXIT},passive:function(t,o,e,a,n,s,i,r){e=void 0!==e&&null!=e?e:Cookie_pro_active_days,t=void 0!==t?t:null,n=void 0!==n?n:null,i=void 0===i?null:i;a=void 0!==a&&null!=a?a:"once";if(t=Pastease.outAtime(t,n,"Pastease.passive.timestamp",i),s)var c="var INIT_TIMER = setTimeout(function() { "+o+" }, "+t+"); ACTIVE_RULES[rule_id].timeout = INIT_TIMER;";else c=function(){var e=setTimeout(function(){o();try{ACTIVE_RULES[i][r].initialized=!0}catch(e){}},t);ACTIVE_RULES[i][r].timeout=e};return Pastease.log("service starting in "+t/1e3+" seconds..."),c},proActive:function(t,o,e,a,n,s,i,r){e=void 0!==e&&null!=e?e:Cookie_pro_active_days,t=void 0!==t?t:null,n=void 0!==n?n:null,i=void 0===i?null:i;a=void 0!==a&&null!=a?a:"once";if(t=Pastease.outAtime(t,n,"Pastease.pro_active.timestamp",i),s)var c="var INIT_TIMER = setTimeout(function() { "+o+' Pastease.setCookie( "Pastease.pro_active.activated", 1, '+e+', "/", undefined, false ); }, '+t+"); ACTIVE_RULES[rule_id].timeout = INIT_TIMER;";else c=function(){var e=setTimeout(function(){o();try{ACTIVE_RULES[i][r].initialized=!0}catch(e){}},t);ACTIVE_RULES[i][r].timeout=e};return Pastease.log("service starting in "+t/1e3+" seconds..."),c},clearService:function(e,t){if("mopinion"==e){Pastease.log("Clearing form key "+t[0]+" from service Mopinion.");try{srv.clearForm(t[0])}catch(e){}}},getActive:function(){return ACTIVE_RULES},getConfigID:function(){return ID},outAtime:function(e,t,o,a){if(a=void 0===a?null:a,null!=t&&0!=t){var n=Pastease.timestamp(),s=""!=Pastease.getCookie(o,!1,a)?Pastease.getCookie(o,!1,a):n,i=n-s;e=t-i;Pastease.log("timestamp: "+n),Pastease.log("prev_timestamp: "+s),Pastease.log("time_passed: "+i),Pastease.log("time: "+e),""==Pastease.getCookie(o,!1,a)&&Pastease.setCookie(o,n,0,"/",void 0,!1,a)}return 1e3*e},timestamp:function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Math.floor(Date.now()/1e3)},rnd:function(e){return Math.floor(Math.random()*e)+1},observer:function(){MutationObserver=window.MutationObserver||window.WebKitMutationObserver,new MutationObserver(function(e,t){Pastease.log(e,t),Pastease.stream("dom",{html:document.documentElement.innerHTML})}).observe(document,{subtree:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0,attributeFilter:!0})},streamInfo:function(){$(document).mousemove(function(e){e=e||window.event,IE=!!document.all,IE?(mouseX=event.clientX,mouseY=event.clientY+document.body.scrollTop):(mouseX=e.pageX,mouseY=e.pageY),Pastease.stream("mouse",{x:mouseX,y:mouseY})}),Pastease.observer(),Pastease.stream("dom",{html:document.documentElement.innerHTML})},stream:function(e,t){try{var o=SOCKET,a={id:Pastease.getId(),type:e,vars:t,agent:navigator.userAgent,host:document.location.host,protocol:document.location.protocol,resolution:{width:screen.width,height:screen.height},viewport:{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}};o.emit("json",a)}catch(e){Pastease.log("stream ERROR: "+e)}Pastease.log("stream: "+JSON.stringify(a))},getId:function(){var e=Pastease.getCookie("stream_id");if(e&&""!=e)return e;var t=Pastease.randomString(30);return Pastease.setCookie("stream_id",t),t},debounce:function(a,n,s){var i,r=null;return function(){var e=this,t=arguments,o=s&&!r;return clearTimeout(r),r=setTimeout(function(){r=null,s||(i=a.apply(e,t))},n),o&&(i=a.apply(e,t)),i}},randomString:function(e){return Math.round(Math.pow(36,e+1)-Math.random()*Math.pow(36,e)).toString(36).slice(1)},getCookie:function(e,t,o){o=void 0===o?null:o,void 0===t&&(t=!1);var a=document.cookie.split(";"),n="",s="",r=!1;for(SEPARATE_COOKIES&&null!=o&&!t&&(e+="."+o),i=0;i<a.length;i++){if((n=a[i].split("="))[0].replace(/^\s+|\s+$/g,"")==e)return r=!0,1<n.length&&(s=unescape(n[1].replace(/^\s+|\s+$/g,""))),s;n=null,""}if(!r)return""},setCookie:function(e,t,o,a,n,s,i){i=void 0===i?null:i;var r=new Date;r.setTime(r.getTime()),o=o&&1e3*o*60*60*24,SEPARATE_COOKIES&&null!=i&&(e+="."+i);var c=new Date(r.getTime()+o);document.cookie=e+"="+escape(t)+(o?";expires="+c.toGMTString():"")+(a?";path="+a:"")+(n?";domain="+n:"")+(s?";secure":"")},makeDiv:function(e){if(document.getElementById(e))Pastease.log("Div: "+e+" found, nothing inserted");else{var t=document.createElement("div");t.setAttribute("id",e),document.getElementsByTagName("body")[0].appendChild(t),Pastease.log("inserted div: "+e)}},triggers:function(e,t,o,a,n,s,i,r,c,l,u,d,v){c=void 0===c||c,l=void 0===l?null:l,n=null==n?0:n,r=null==r?0:r;function f(o,a,n,s,e,t,i){function r(){if(1!=Pastease.getCookie("Pastease."+a+".activated",!1,s)||e)var t=setInterval(function(){var e={key:o,trigger_method:a.replace("_",""),cookie_expire:n};"passive"===a&&(e.showButton=!0),"exit"!==a&&"proactive"!==a||(e.openForm=!0);try{srv.open(e),"passive"!==a&&0!==n&&Pastease.setCookie("Pastease."+a+".activated",1,n,"/",void 0,!1,s),clearInterval(t),ACTIVE_RULES[s][v].triggered=!0}catch(e){Pastease.log(e)}},150)}t?Pastease.scroll(t.from,t.px,r,s,v):r()}var m="",g="object"==typeof u&&"from"in u.scrollpos&&"px"in u.scrollpos&&u.scrollpos;if("mopinion"==e){if("passive"==o){if(Pastease.log("trigger: passive"),c)m="var try_code; try_code = setInterval(function() { try { "+(m='srv.open({key:"'+t[0]+'",trigger_method:"passive", cookie_expire:'+s+"});")+" clearInterval(try_code); } catch(e) { Pastease.log(e); }; }, 100);";else m=function(){f(t[0],"passive",s,l,i,g)};return-1<[null,0].indexOf(n)&&-1<[null,0].indexOf(r)?(Pastease.log("plain passive code"),m):(Pastease.log("passive code with timeout or %..."),Pastease.passive(n,m,s,i,r,c,l,v))}if("proactive"==o){if(Pastease.log("trigger: proactive"),c)m="var try_code; try_code = setInterval(function() { try { "+(m='srv.open({key:"'+t[0]+'", trigger_method:"proactive",cookie_expire:'+s+"});")+" clearInterval(try_code); } catch(e) { Pastease.log(e); }; }, 100);";else m=function(){f(t[0],"pro_active",s,l,i,g)};return Pastease.proActive(n,m,s,i,r,c,l,v)}if("exit"==o){if(Pastease.log("trigger: exit"),c)m="var try_code = setInterval(function() { try { "+(m='srv.open({key:"'+t[0]+'", trigger_method:"exit",cookie_expire:'+s+"});")+" clearInterval(try_code); } catch(e) { Pastease.log(e); }; }, 100);";else m=function(){f(t[0],"exit",s,l,i,g)};return Pastease.exit(n,m,s,i,r,c,l,v)}if("test"==o)return Pastease.log("test trigger"),c?"":function(){}}},testDevice:function(){function a(e,t){return e.test(t)}var n=/iPhone/i,s=/iPod/i,i=/iPad/i,r=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,c=/Android/i,l=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,u=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,d=/Windows Phone/i,v=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,f=/BlackBerry/i,m=/BB10/i,g=/Opera Mini/i,p=/(CriOS|Chrome)(?=.*\bMobile\b)/i,E=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,P=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i");return new function(e){var t=e||navigator.userAgent,o=t.split("[FBAN");if(void 0!==o[1]&&(t=o[0]),void 0!==(o=t.split("Twitter"))[1]&&(t=o[0]),this.apple={phone:a(n,t),ipod:a(s,t),tablet:!a(n,t)&&a(i,t),device:a(n,t)||a(s,t)||a(i,t)},this.amazon={phone:a(l,t),tablet:!a(l,t)&&a(u,t),device:a(l,t)||a(u,t)},this.android={phone:a(l,t)||a(r,t),tablet:!a(l,t)&&!a(r,t)&&(a(u,t)||a(c,t)),device:a(l,t)||a(u,t)||a(r,t)||a(c,t)},this.windows={phone:a(d,t),tablet:a(v,t),device:a(d,t)||a(v,t)},this.other={blackberry:a(f,t),blackberry10:a(m,t),opera:a(g,t),firefox:a(E,t),chrome:a(p,t),device:a(f,t)||a(m,t)||a(g,t)||a(E,t)||a(p,t)},this.seven_inch=a(P,t),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this}},services:function(serviceObj,init_more,return_code){return_code=void 0!==return_code&&return_code;var service=serviceObj.service||"",args=serviceObj.args||"",disableMakeDiv=serviceObj.disableMakeDiv||!1,useQuerySelectorAll=serviceObj.useQuerySelectorAll||!1,code="";if("mopinion"==service){if(init_more)init_more&&(code='(function() {var try_catch = setInterval(function() { try {srv.loadSurvey({key:"{0}", divName:"{2}", "use_collect": '+USE_COLLECT+', "useQuerySelectorAll": '+useQuerySelectorAll+"}); clearInterval(try_catch)} catch(e) {} },100)})()");else{var subdom=TEST?"accept":"collect",src=null!=LOCAL_FILE&&void 0!==LOCAL_FILE&&null!=LOCAL_FILE?LOCAL_FILE:"https://"+subdom+".mopinion.com/assets/surveys/"+MOPINION_VERSION+"/js/"+MOPINION_FILE+".js?d=02072019";code='(function(d, e, v) {var f = d.createElement(e),vars = {"key":"{0}","domain":"{1}","divName":"{2}","button":false, "use_collect": '+USE_COLLECT+', "useQuerySelectorAll": '+useQuerySelectorAll+'};f.async="async";f.src = "'+src+'";f.onload = f.onreadystatechange = function() {var r = this.readyState; if (r) if (r != "complete") if (r != "loaded") return;try {srv.loadSurvey(vars);} catch (x) {}};var s = d.getElementsByTagName(e)[0],p = s.parentNode;p.insertBefore(f, s);})(document, "script", "'+MOPINION_VERSION+'");'}3<=args.length&&!disableMakeDiv&&Pastease.makeDiv(args[2])}else"CFMS"==service&&(code='Mgo.loadMopinion("mopinion","{0}","none","{1}");');for(var j=0;j<args.length;j++){var match="{"+j+"}",token=args[j];code=code.replace(match,token)}return return_code?code:function(){eval(code)}},getSelector:function(e){var t=(e=e||"").charAt(0),o=e.split(" ");return t.match(/\#|\.|\*|\[|\:/g)||1<o.length?e:1<o.length?e:"#"+e},jquery:function(){var e=document.location.protocol+"//code.jquery.com/jquery-1.9.1.js";if(!1===Pastease.fileExists(e)){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}var o=function(){window.jQuery?Pastease.log("jQuery loaded!"):window.setTimeout(function(){o()},200)};o()},socketio:function(){var e=document.location.protocol+"//cdn.socket.io/socket.io-1.4.5.js";if(!1===Pastease.fileExists(e)){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}var o=function(){window.io?Pastease.log("Socket.io loaded!"):window.setTimeout(function(){o()},200)};o()},fileExists:function(e){for(var t=document.getElementsByTagName("script"),o=0;o<t.length;o++)if(Pastease.log("looking for: "+e),Pastease.log("found: "+t[o].src),t[o].src==e)return!0;return!1},socket:function(){var e="pastea.se"==document.location.host?"socket.pastea.se":"localhost:8585";return io.connect(document.location.protocol+"//"+e)},sendXML:function(e,t,o,a){var n=Base_url+e,s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState==XMLHttpRequest.DONE||4==s.readyState)if(200==s.status){var e=s.responseText;o(e,!1,!0)}else Pastease.log("Ajax ERROR "+s.status)},s.open(a,n,!0),s.send()},send:function(e,t,o,a){var n=Base_url+e,s={url:n,type:a,data:t,dataType:"json",success:function(e){o(e)},error:function(e){Pastease.log("AJAX ERROR: "+JSON.stringify(e)),Pastease.log("url: "+n),Pastease.log(e,!0)}};$.ajax(s)},use$:function(e){void 0===e&&(e=!1),USE_$=e},ajax$:function(e){void 0===e&&(e=!1),AJAX_$=e},debug:function(e){void 0===e&&(e=!1),LOG="true"==Pastease.getCookie("LOG")||e},log:function(e,t){if(void 0===t&&(t=!1),LOG)try{t?console.log(e):console.log("P> "+e)}catch(e){}}}}();