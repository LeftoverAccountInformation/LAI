(function(){var bt,f,ut,ot,ar,hi,ai,st,n,o;try{(function(){var n={L_microsoftcopyright_text:"© {year} Microsoft Corporation",L_DistanceUnitKm_Text:"km",L_DistanceUnitMeters_Text:"m",L_DistanceUnitMilesShortText_Text:"mi",L_DistanceUnitMilesLongText_Text:"miles",L_DistanceUnitFeetShort_Text:"ft",L_Distance_Format:"{0} {1}",L_LatLon_Format:"{0}, {1}",L_Duration:"{0} hr {1} min",L_Duration_NoMin:"{0} hr",L_Duration_Min:"{0} min",L_DistanceUnitFeetSquareShort_Text:"sq ft",L_DistanceUnitKmSquare_Text:"sq km",L_DistanceUnitMetersSquare_Text:"sq m",L_DistanceUnitMilesSquareShortText_Text:"sq mi",L_AreaFieldString:"Area",L_FormatFieldString:"{0}: {1}",L_IncorrectValue_text:"N/A",L_LengthFieldString:"Length",L_FocusDivDefaultLabel:"Bing Maps - Interact to see more"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("MapCore",n):window.$MicrosoftMaps8.ResourcesObject=n})();n=function(){function n(n){Array.prototype.push.apply(this,n)}function t(i,r){if(i&&i instanceof n)return i;var u=!i&&[]||(r||typeof i=="string")&&t.query(i,r)||i instanceof Array&&i||[i];return new n(u)}function i(n,t){for(var i in t)t.hasOwnProperty(i)&&(n.prototype[i]=t[i])}return i(n,{length:Array.prototype.length,entities:function(){return Array.prototype.slice.apply(this)},sort:function(n){return Array.prototype.sort.call(this,n),this},reverse:function(){return Array.prototype.reverse.call(this),this},push:function(){return Array.prototype.push.apply(this,arguments),this},pop:function(){var t=Array.prototype.pop.call(this);return new n([t])},shift:function(){var t=Array.prototype.shift.call(this);return new n([t])},unshift:function(){return Array.prototype.unshift.apply(this,arguments),this},slice:function(){return new n(Array.prototype.slice.apply(this,arguments))},splice:function(){return new n(Array.prototype.splice.apply(this,arguments))},concat:function(t){return new n(Array.prototype.concat.apply(this.entities(),t.entities&&t.entities()||arguments))}}),t.Helper={get_guid:function(){var n=0;return function(t){if(!t)return"";if(t===window)return"win";if(t===document)return"doc";if(t.uniqueID)return t.uniqueID;var i="__$gimme$_guid__";return typeof t[i]=="undefined"&&(t[i]=i+n++),t[i]}}()},t.Browser=function(){var n=navigator.userAgent.toLowerCase(),t=-1,i;navigator.appName==="Microsoft Internet Explorer"&&(n=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),i.exec(n)!==null&&(t=parseFloat(RegExp.$1)));var r=typeof ActiveXObject!="undefined"||typeof MSPointerEvent!="undefined",e=new RegExp("\\s+Edge/([0-9]+).[0-9]+"),u=e.exec(navigator.userAgent)!==null,f=n.indexOf("chrome")>-1&&!u,o=!f&&n.indexOf("safari")>-1;return{is_ie:r,is_edge:u,is_opera:typeof opera!="undefined",is_chrome:f,is_khtml:n.indexOf("khtml")!==-1,is_gecko:n.indexOf("khtml")===-1&&n.indexOf("gecko")!==-1&&!r,is_in_quirks_mode:document.compatMode==="BackCompat",ie_version:t,is_webkit:n.indexOf("applewebkit/")!==-1,is_safari:o}}(),t.undefined={}._$gimme$_undefined,t.ext=n.prototype,t}();n.ext.select=function(t){return n(t,this[0])};typeof g=="undefined"&&(window.g=n);n.Internals=new function(){function n(n){return function(t,i,r){this[n](t,i,r)}}return{addEventListener:n("addEventListener"),removeEventListener:n("removeEventListener"),attachEvent:n("attachEvent"),detachEvent:n("detachEvent")}};n.query=function(){return function(){function k(n,t,i){return r[t](n,i)}function d(n,t){var r=[],u=t.length,i;do i=h(n,t[--u]||t),i&&r.push(i);while(u);return r}function h(n,t){if(n===document||!t)return t;for(var i=t;(i=i.parentNode)&&i!==n;);return i===n&&t||null}function g(n,t){var i=n.document||document;return h(n,i.getElementById(t))}function c(n,t){var i,f,r,e;if(t=t||document,n.id)return a([g(t,n.id)],n);if(delete n.id,i=t.getElementsByTagName(n.tag||"*"),(!n.classes||n.classes.length<1)&&(!n.attributes||n.attributes.length<1)&&(!n.pseudos||n.pseudos.length<1))return l(i);for(f=[],e=i.length,r=0;r<e;r++)u(n,i[r])&&f.push(i[r]);return f}function u(n,t){if(!t)return!1;for(var u=n.propNames,f=u.length,i=0;i<f;i++)if(!r[u[i]](t,n[u[i]]))return!1;return!0}function l(n){for(var i=[],r=n.length,t=0;t<r;t++)i[t]=n[t];return i}function a(n,t){for(var r=[],f=n.length,i=0;i<f;i++)n[i]&&n[i].nodeType===1&&u(t,n[i])&&r.push(n[i]);return r}function y(n,t){return v(n,t)!==-1}function p(n){var r;t.inc();for(var u=t.name,f=[],e=n.length,i=0;i<e;i++)r=n[i],r[u]!==t.t&&(r[u]=t.t,f.push(r));return f}function w(n,t){if(!n)return!1;for(var r=" "+n+" ",i=t.length;i--;)if(r.indexOf(" "+t[i]+" ")===-1)return!1;return!0}function nt(n){var t=n.className;return typeof t!="string"&&(t=typeof n.getAttribute!="undefined"&&n.getAttribute("class")||""),t}function tt(n,t){typeof n.className=="string"?n.className=t:typeof n.setAttribute!="undefined"&&n.setAttribute("class",t)}function e(n){this.name=n;this.f=0;this.t=1;this.inc=function(){this.f=(this.t+=2)-1}}function it(n){this.parse=function(t){var u,i,o=n.preprocessInput,r,f,e;for(t=o&&o(t)||t,n.reset(),r=0,f=t.length;r<f;){if(u=t.charAt(r),i=i||n[u]||n["default"],i){if(e=i(t.substring(r,f)),!e)throw'No valid match found for "'+i.name+'" rule';r+=e}else throw'No suitable rule found to handle character "'+u+'"';i=null}return n.finish()}}function b(t,i){var w=i,r,u,h,o,a,y,v;if(i=i||document,n.inc(),typeof t!="string")return d(i||document,t);u=[];try{u=l(i.querySelectorAll(t))}catch(b){for(h=s.parse(t),a=h.length,o=0;o<a;o++){var f=h[o],p=f.length,e=p%2-1;for(r=e===0?c(f[e],i):[i||document];f[++e];)y=f[e++],v=f[e],v.root=i,r=k(r,y,v);u=a>1?u.concat(r):r}}return u}var t,i,n,r,o,s,v=function(){function n(n,t){return n.indexOf(t)}function t(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i]===t)return i;return-1}return typeof Array.prototype.indexOf!="undefined"?n:t}(),f=function(){function n(n,t){return n.getAttribute(t)}function t(n,t){switch(t.toLowerCase()){case"class":return n.className||null;case"id":return n.id||null;case"href":case"src":if(typeof n.getAttribute!="undefined")return n.getAttribute(t,2)}return n.attributes&&n.attributes[t]&&n.attributes[t].nodeValue||n.getAttribute(t)}return function(){var i=document.createElement("div"),r;return i.innerHTML='<a href="#test">test<\/a>',r=i.firstChild,r.getAttribute("href")==="#test"?n:t}()}();return t=new e("__$gimme$_unique__"),i=new e("__$gimme$_genSib__"),n=new e("__$gimme$_nth__"),r={id:function(n,t){return n.id===t},tag:function(n,t){return n.tagName===t||t==="*"},classes:function(n,t){var i=n.className;return typeof i!="string"&&(i=f(n,"class")),w(i,t)},attributes:function(){var n={},t={parse:function(t){var i=t.match(/^\[([\w-_]+)?(\=|\^=|\$=|\*=|\|=|~=|!=)?(.*)\]$/);return n[t]={name:i&&i[1],delim:i&&i[2],val:i&&i[3].replace(/^['"]|["']$/g,"")}},"=":function(n,t){return n===t},"^=":function(n,t){return n.indexOf(t)===0},"$=":function(n,t){var i=n.lastIndexOf(t);return i!==-1&&i+t.length===n.length},"*=":function(n,t){return n.indexOf(t)!==-1},"|=":function(n,t){return n===t||n.indexOf(t+"-")===0},"~=":function(n,t){return n===t||y(n.split(" "),t)},"!=":function(n,t){return n!==t},unknown:function(){return!1}};return function(i,r){for(var e=r.length,u,o;e--;){if(u=n[r[e]]||t.parse(r[e]),o=f(i,u.name),!o)return!1;if(u.delim&&!t[u.delim||"unknown"](o,u.val))return!1}return!0}}(),pseudos:function(){function r(n){var t=n+"Sibling";return function(n){for(var i=n[t];i&&i.nodeType!==1;)i=i[t];return!i}}var i={},t={parse:function(n){var t=n.match(/([\w-_]+)\b(\((((-?\d*)n)?([+-]?\d+)?|.*)\))?/),r={name:t&&t[1],param:{wholeValue:t&&t[3],a:t&&t[5]||0,b:t&&t[6]||0}};return r.param.wholeValue==="even"?(r.param.a=2,r.param.b=0):r.param.wholeValue==="odd"&&(r.param.a=2,r.param.b=1),i[n]=r},"first-child":r("previous"),"last-child":r("next"),"only-child":function(n){return t["first-child"](n)&&t["last-child"](n)},"nth-child":function(t,i){var s=n.t*1e4,u=n.name,r=t.parentNode,h=0,f;if(r){if(r[u+":parent"]!==n.t){r[u+":parent"]=n.t;for(var h=0,e=r.children||r.childNodes,o=-1,c=e.length;++o<c;)e[o].nodeType===1&&(h++,e[o][u]=s+h)}return f=t[u]-s-i.param.b,!i.param.a&&i.param.b?f===0:i.param.a*f>=0&&f%(i.param.a||1)==0}return!1},contains:function(n,t){return(n.textContent||n.innerText||n.innerHTML).indexOf(t.param.wholeValue)!==-1},not:function(){return!1}};return function(n,r){for(var u=r.length,f;u--;)if(f=i[r[u]]||t.parse(r[u]),!t[f.name](n,f))return!1;return!0}}()," ":function(n,t){for(var r=[],f=n.length,u,i=0;i<f;i++)if(u=c(t,n[i]),r=r.concat(u),t.id&&u.length===1)break;return p(r)},">":function(n,t){for(var r=[],u=n.length,i=0;i<u;i++)r=r.concat(a(n[i].childNodes,t));return r},"+":function(n,t){for(var f=[],o=n.length,e,i,r=0;r<o;r++){for(e=n[r],i=e.nextSibling;i&&i.nodeType!==1;)i=i.nextSibling;u(t,i)&&f.push(i)}return f},"~":function(n,t){var s,r;i.inc();for(var e=i.name,o=[],h=n.length,f=0;f<h;f++)for(s=n[f],r=s.nextSibling;r&&r[e]!==i.t;)r.nodeType===1&&(r[e]=i.t,u(t,r)&&o.push(r)),r=r.nextSibling;return o}},o=new function(){function i(){this.propNames=[]}var r,t,n;return i.prototype.propNames=[],i.prototype.storePropertyValue=function(n,t){this[n]=t;this.propNames[n]||(this.propNames.push(n),this.propNames[n]=!0)},i.prototype.storeArrayValue=function(n,t){this[n]||(this[n]=[]);this[n].push(t);this.propNames[n]||(this.propNames.push(n),this.propNames[n]=!0)},{preprocessInput:function(n){return n.replace(/\s*([ >+~,])\s*/g,"$1")},reset:function(){r=[];t=[];n=new i},finish:function(){return n&&n.propNames.length>0&&t.push(n),t.length>0&&r.push(t),r},"default":function(t){var r=t.match(/(\w+|\*)/),i;return r?(i=r[0].toUpperCase(),n.storePropertyValue("tag",i),i.length):null},"#":function(t){var i=t.match(/#([_\-\w]+)/),r;return i?(r=i[1],n.storePropertyValue("id",r),i[0].length):null},".":function(t){var i=t.match(/\.([_\-\w\d]+)/),r;if(i)return r=i[1],n.storeArrayValue("classes",r),i[0].length},"[":function(t){var r=t.match(/(\[.*"\]|.*?\])/),i;return r?(i=r[0],n.storeArrayValue("attributes",i),i.length):null},":":function(t){var r=t.match(/:[\w-_]+\b(\(.*\))?/),i;return r?(i=r[0],n.storeArrayValue("pseudos",i),i.length):null}," ":function(){return t.push(n," "),n=new i,1},">":function(){return n.propNames.length>0&&t.push(n),t.push(">"),n=new i,1},"~":function(){return t.push(n,"~"),n=new i,1},"+":function(){return t.push(n,"+"),n=new i,1},",":function(){return t.push(n),r.push(t),t=[],n=new i,1}}},s=new it(o),b.Internal={unique:p,index_of:v,contains:y,contains_class:w,has_class:r.classes,get_attr:f,get_class:nt,set_class:tt},b}()}();n.Helper.index_of=n.query.Internal.index_of;n.Helper.contains=n.query.Internal.contains;n.Helper.unique=n.query.Internal.unique;n.Helper.get_attr=n.query.Internal.get_attr;n.Helper.contains_class=n.query.Internal.contains_class;n.Helper.has_class=n.query.Internal.has_class;n.Helper.get_class=n.query.Internal.get_class;n.Helper.set_class=n.query.Internal.set_class;n.Effects={Animation:function(n){function s(n){for(var h=e(n),r=t.length,o,s;r--;){s={};for(o in u)s[o]=i[o][r]+u[o][r]*h;f(t[r],s,n)}}var t=n.elements||[],o=n.duration||1,i=n.from||{},r=n.to||{},u={},f,e;(function(){var f,n,s,e={},o={},h={};for(n in i)for(e[n]=[],o[n]=[],h[n]=[],f=t.length;f--;)s=t[f],e[n][f]=typeof i[n]=="function"?i[n](s,n):i[n],o[n][f]=typeof r[n]=="function"?r[n](s,n):r[n],h[n][f]=o[n][f]-e[n][f];i=e;r=o;u=h})();f=n.animate;e=n.easing||function(n){return n};this.startTime=n.startTime||0;this.duration=o;this.add_element=function(n){t.push(n)};this.remove_element=function(n){for(var i=t.length;i--;)if(t[i]===n){t.splice(i,1);break}};this.tick=s},Storyboard:function(t){function f(){e||(e=!0,s=Date.now(),o=n.Effects.Animation.requestAnimationFrame(v))}function p(){i=0;r=1;f()}function w(){c();a&&a(i)}function c(){n.Effects.Animation.cancelAnimationFrame(o);e=!1}function b(){f()}function k(){r=1;f()}function d(){r=-1;f()}function g(){r*=-1;f()}function nt(n){i=n;y()}function tt(){return i}function it(){return e}function rt(){return r}function ut(){return u}function ft(){return h}function v(){var t=Date.now();i+=(t-s)/h*r;s=t;i=i<0?0:i>1?1:i;y();r===-1&&i===0||r===1&&i===1?(c(),l&&l(i)):o=n.Effects.Animation.requestAnimationFrame(v)}function y(){for(var t=u.length,n;t--;)n=(h*i-u[t].startTime)/u[t].duration,n=r===-1&&n<0?0:r===1&&n>1?1:n,n>=0&&n<=1&&u[t].tick(n)}var o,s,i=0,r=1,e=!1,u=t.animations,h=t.duration||0,et=t.interval||1,l=t.completed,a=t.aborted;this.begin=p;this.abort=w;this.pause=c;this.resume=b;this.forward=k;this.backward=d;this.reverse=g;this.seek=nt;this.get_position=tt;this.is_running=it;this.get_direction=rt;this.get_animations=ut;this.get_duration=ft},Easing:{Back:new function(){function n(n,t,i,r){return t=.5,i=0,r=.5,Math.pow(1-n,i)*r*Math.sin(2*Math.PI*n*t)*-1+n}function t(){}function i(){}this.ease_in=n;this.ease_out=t;this.ease_in_out=i},Bounce:new function(){function t(n,t,i){return t=t||1.5,i=i||4,Math.abs(Math.pow(n,t)*Math.cos(Math.PI*n*i))}function i(t,i,r){return 1-n.Effects.Easing.Bounce.ease_in(1-t,i,r)}function r(t,i,r){var u=0,f=n.Effects.Easing.Bounce.ease_in;return t>.5&&(f=n.Effects.Easing.Bounce.ease_out,t-=.5,u=1/2),f(t,i,r)-u}this.ease_in=t;this.ease_out=i;this.ease_in_out=r},Elastic:new function(){function n(){}function t(n,t,i){return t=t||3.5,i=i||5,1-Math.pow(1-n,t)*Math.cos(2*Math.PI*n*i)}function i(){}this.ease_in=n;this.ease_out=t;this.ease_in_out=i},Exponential:new function(){function n(n,t){return Math.pow(n,t)}function t(n,t){return Math.pow(n,1/t)}function i(i,r){return i<=.5?n(i*2,r)*.5:t((i-.5)*2,r)*.5+.5}this.ease_in=n;this.ease_out=t;this.ease_in_out=i}},Enums:{Directions:{vertically:1,horizontally:2,both:3},Speeds:{quickly:500,slowly:1e3}},RunningAnimations:function(){var t={};return{add:function(n,i){t[n]=i},remove:function(n){delete t[n]},get:function(i){return t[i]||new n.Effects.Storyboard({animations:[]})},contains:function(n){return!!t[n]}}}()};n.Effects.Storyboard.create=function(t,i,r,u,f,e,o,s,h){f=Math.floor(f)||n.Effects.Enums.Speeds[f]||n.Effects.Enums.Speeds.quickly;var c=new n.Effects.Storyboard({duration:f,interval:h,completed:function(){o&&o.call(this);n.Effects.RunningAnimations.remove(e);c=null},aborted:function(){n.Effects.RunningAnimations.remove(e);c=null},animations:[new n.Effects.Animation({from:i,to:r,duration:f,animate:u,easing:s,elements:t})]});return e&&n.Effects.RunningAnimations.add(e,c),c},function(){var t=0,i={};n.Effects.Animation.requestAnimationFrame=function(){function u(n,t){return function(){try{i[t]&&n(Date.now());delete i[t]}catch(r){if(Microsoft.Maps.logger)Microsoft.Maps.logger.logCriticalError(r);else throw r;}}}function e(n,f){var e=i[++t]=u(n,t);return r(e,f),t}function o(n){var r=i[++t]=u(n,t);return Microsoft.Maps.setTimeout(r,f),t}var f=16,n=window,r=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame;return r?e:o}();n.Effects.Animation.cancelAnimationFrame=function(n){delete i[n]}}();n.Ajax=new function(){function t(t,i){n(t,i,!0)}function i(t,i){n(t,i,!1)}function r(){var n=u.Internal.originalXMLHttpRequest;if(typeof n!="undefined")return new n;if(typeof ActiveXObject!="undefined")try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){throw new Error("Error invoking XMLHTTP");}else throw new Error("XMLHttp is not supported");}function n(n,t,i){var u=r();u.onreadystatechange=function(){if(u.readyState===4){var n=u.responseText;i&&n&&(n=eval("("+u.responseText+")"));t.call(u,n,u.status);u=null;t=null}};u.open("GET",n,!0);u.send("")}this.request_json=t;this.request_ahah=i};n.Screen=new function(){function t(){return typeof innerWidth!="undefined"?{width:window.innerWidth,height:window.innerHeight}:typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.getElementsByTagName("body")[0].clientWidth,height:document.getElementsByTagName("body")[0].clientHeight}}function i(n){var t,i;return n=n||window.event,t={x:0,y:0},typeof n.pageX!="undefined"?(t.x=n.pageX,t.y=n.pageY):(i=this.get_scroll_pos(),t.x=n.clientX+i.x,t.y=n.clientY+i.y),t}function r(){return n(window).get_scroll_pos()}this.get_viewport_size=t;this.get_mouse_pos=i;this.get_scroll_pos=r};n.Util=new function(){function t(){return n(arguments,!1)}function i(){return n(arguments,!0)}function n(n,t){function u(){i.apply(this,Array.prototype.slice.call(n,2));t||(i=null)}var i=n[0],r=n[1];return t===!0?Microsoft.Maps.setInterval(u,r):Microsoft.Maps.setTimeout(u,r)}this.set_timeout=t;this.set_interval=i};n.Style=new function(){function o(i){var u=i.scrollTop&&i!==document.documentElement&&i!==document.body&&i.tagName!=="TEXTAREA"&&i.tagName!=="INPUT"?-1:0,r={x:i.scrollLeft*u,y:i.scrollTop*u},f;return n.Browser.is_ie&&t(i,"position")==="static"?(f=i.style.position,i.style.position="relative",r.x+=i.offsetLeft,r.y+=i.offsetTop,i.style.position=f):(r.x+=i.offsetLeft,r.y+=i.offsetTop),r}function l(u){var f={x:0,y:0},s;if(u.getBoundingClientRect){var e=u.getBoundingClientRect(),h=r(),c=n(window).get_scroll_pos();f.x=e.left-h.x+c.x;f.y=e.top-h.y+c.y;f.width=e.width;f.height=e.height}else while(u!==null)s=o(u),f.x+=s.x,f.y+=s.y,u=u.offsetParent,u&&!i()&&(f.x+=parseFloat(t(u,"borderLeftWidth"))||0,f.y+=parseFloat(t(u,"borderTopWidth"))||0);return f}function i(){var n,t;return typeof i.constantValue=="undefined"&&(n=document.createElement("div"),n.style.cssText="position:absolute;visibility:hidden;top:0;left:0;border:1px solid #000;",t=document.createElement("div"),n.appendChild(t),document.body.appendChild(n),i.constantValue=t.offsetTop===1,document.body.removeChild(n),n=t=null),i.constantValue}function r(){var i,u;if(typeof r.constantValue=="undefined"){var t=document.documentElement,f=t.style.position,e=t.style.margin,o=t.style.border;t.style.position="static";t.style.margin="0";t.style.border="1px solid transparent";i=t.getBoundingClientRect();u=n(window).get_scroll_pos();r.constantValue={x:i.left+u.x,y:i.top+u.y};t.style.position=f;t.style.margin=e;t.style.border=o;document.documentElement.className=document.documentElement.className}return r.constantValue}function t(n,t){var i="",r,e,f;return n.currentStyle&&(t==="right"||t==="bottom")?i=u(t,"auto","auto",n)+"px":(r=document.defaultView&&document.defaultView.getComputedStyle&&document.defaultView.getComputedStyle(n,null)||n.currentStyle,r&&(i=r[t]||"",e=i.match(/px$/),e||(f=i.match(/(em|ex|%|in|cm|mm|pt|pc|small|medium|large|thin|thick|auto)$/),f&&(i=u(t,i,f[0],n)+"px")))),i}function u(i,r,u,f){var s,h,a,o,c,v,y,p,l,e,w;if(r){if(u==="px")return parseFloat(r);if(r==="auto")switch(i){case"top":case"left":return 0;case"bottom":case"right":if(s={bottom:["top","offsetTop","height","offsetHeight"],right:["left","offsetLeft","width","offsetWidth"]},h=n(f),h.get_style("position")==="relative")return a=s[i][0],-parseInt(h.get_style(a));for(o=f.parentNode;o!==document&&n(o).get_style("position")==="static";)o=o.parentNode;return c=s[i][2],v=o===document?n.Screen.get_viewport_size()[c]:parseInt(n(o).get_style(c)),y=s[i][1],p=s[i][3],v-f[y]-f[p];case"height":return f.clientHeight||f.offsetHeight&&f.offsetHeight-parseFloat(t(f,"borderTopWidth"))-parseFloat(t(f,"borderBottomWidth"))||0;case"width":return f.clientWidth||f.offsetWidth&&f.offsetWidth-parseFloat(t(f,"borderLeftWidth"))-parseFloat(t(f,"borderRightWidth"))||0;default:return 0}else{switch(i){case"borderLeftWidth":case"borderRightWidth":case"borderTopWidth":case"borderBottomWidth":return i=i.replace("Width","Style"),l=t(f,i),l==="none"?0:parseFloat(l)}f=f||document.body;e=document.createElement("div");e.style.visbility="hidden";e.style.position="absolute";e.style.lineHeight="0";u==="%"?(f=f.parentNode,i==="height"||i==="top"?e.style.height=r:(i==="width"||i==="left")&&(e.style.width=r)):(e.style.borderStyle="solid",e.style.borderBottomWidth="0",e.style.borderTopWidth=r);try{f.appendChild(e)}catch(b){f=f.parentNode;f.appendChild(e)}return f.offsetWidth,f.offsetHeight,w=e.offsetHeight||e.offsetWidth,f.removeChild(e),w}}else return 0}function a(n,t){var r,i;return t=t||document.body,r=f[n],r||(i=c(n),t.style[i]===undefined&&(i=v(i,t)||n),r=f[n]=i),r}function v(n,t){for(var r=c("-"+n),i=e.length;i--;)if(n=e[i]+r,t.style[n]!==undefined)return n;return""}function c(n){return n.replace(/-(\w)/g,function(n,t){return t.toUpperCase()})}function y(n){return n.replace(/([A-Z])/g,function(n){return"-"+n.toLowerCase()})}var s,h,f,e;this.get_relative_pos=o;this.get_absolute_pos=l;this.offset_includes_borders=i;this.get_bounding_client_rect_offsets=r;s=function(){function t(n,t){n.style.opacity=t}function i(n,t){t*=100;var i;try{i=n.filters.item("DXImageTransform.Microsoft.Alpha");t<100?(i.Opacity=t,i.enabled||(i.enabled=!0)):i.enabled=!1}catch(r){t<100&&(n.style.filter=(n.currentStyle||n.runtimeStyle).filter+" progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")")}}var n=document.createElement("div");return typeof n.style.opacity!="undefined"&&t||typeof n.style.filter!="undefined"&&i||function(){}}();this.set_opacity=s;h=function(){function i(n){return parseFloat(n.style.opacity)||t(n,"opacity")}function r(n){var t=n.filters["DXIMageTransform.Microsoft.Alpha"];return t?t.Opacity/100:1}var n=document.createElement("div");return typeof n.style.opacity!="undefined"&&i||typeof n.style.filter!="undefined"&&r||function(){}}();this.get_opacity=h;this.get_rendered_style=t;this.normalize_style=u;f={};e=["O","ms","Moz","Webkit"];this.get_camelized_style_name=a;this.get_dasherized_style_name=y};n.Events=new function(){var i=n.Helper,r=null,t=null;this.capture_mouse=function(i,u){return n.Events.release_mouse(),r=i,u!==!1&&(u=!0),i.setCapture!==undefined?i.setCapture(u):(t=function(i){var e=i.target,f,o,s;try{f=new MouseEvent(i.type,i)}catch(h){f=document.createEvent("MouseEvents");f.initMouseEvent(i.type,i.bubbles,i.cancelable,window,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget)}f.originalWhich=i.which;f.originalButtons=i.buttons;f.__defineGetter__&&(o=n.Screen.get_scroll_pos(),f.__defineGetter__("pageX",function(){return this.clientX+o.x}),f.__defineGetter__("pageY",function(){return this.clientY+o.y}));document.removeEventListener(i.type,t,!0);f.captureTarget=e;s=r;u||n(r).has(e)&&(s=e);s.dispatchEvent(f);t!==null&&document.addEventListener(i.type,t,!0);delete f.captureTarget;i.stopPropagation()},document.addEventListener("mouseover",t,!0),document.addEventListener("mouseout",t,!0),document.addEventListener("mousemove",t,!0),document.addEventListener("mouseup",t,!0),document.addEventListener("mousedown",t,!0),document.addEventListener("click",t,!0),document.addEventListener("dblclick",t,!0)),this};this.release_mouse=function(){return r!==null&&(r.releaseCapture!==undefined?r.releaseCapture():(document.removeEventListener("mouseover",t,!0),document.removeEventListener("mouseout",t,!0),document.removeEventListener("mousemove",t,!0),document.removeEventListener("mouseup",t,!0),document.removeEventListener("mousedown",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("dblclick",t,!0)),r=t=null),this};this.get_capture_target=function(n){return n.captureTarget||n.srcElement||n.target};this.Pseudo=new function(){function r(n,t,i){this.pseudoName=n;this.getNativeName=t;this.getProxiedHandler=i}function l(n,t,i){if(n===t)return!1;for(var r=0;t&&t!=n;)r++,t=t.parentNode;return i=i||r,t===n&&i===r}function y(n){var u=i.get_guid(n),r=t[u];return r||(r=t[u]=function(t){var i=t.relatedTarget;i&&this!==i&&!l(this,i)&&n.call(this,t)}),r}function p(n){var u=i.get_guid(n),r=t[u];return r||(r=t[u]=function(t){var i=t.relatedTarget;i&&(this===i||l(this,i))||n.call(this,t)}),r}function w(r){if(!n.Browser.is_gecko)return r;var f=i.get_guid(r),u=t[f];return u||(u=t[f]=function(n){n.wheelDelta=-40*n.detail;r.call(this,n);n.wheelDelta=null}),u}function h(r){if(!(n.Browser.is_ie||n.Browser.is_edge))return r;var e=i.get_guid(r),u=t[e];return u||(u=t[e]=function(t){var o,u,s,h,e;if(t.pointerType===t.MSPOINTER_TYPE_TOUCH||t.pointerType==="touch"){t.type==="MSPointerUp"||t.type==="pointerup"||t.type==="MSPointerCancel"||t.type==="pointercancel"?delete f[t.pointerId]:(o=n.Screen.get_mouse_pos(t),f[t.pointerId]={_$targetId:i.get_guid(t.target),identifier:t.pointerId,pageX:o.x,pageY:o.y});s=[];h=[];for(u in f)f.hasOwnProperty(u)&&f[u]&&(e=f[u],s.push(e),e._$targetId===i.get_guid(t.target)&&h.push(e));t.touches=s;t.targetTouches=h;(t.type==="MSPointerDown"||t.type==="pointerdown")&&(t.preventDefault=b);r.call(this,t);t.touches=t.targetTouches=null}}),u}function b(){u[this.pointerId]=!0;var t=n.Browser.is_ie&&n.Browser.ie_version<11;return document.addEventListener(t?"MSPointerUp":"pointerup",a,!0),document.addEventListener("click",v,!0),(t?MSPointerEvent:PointerEvent).prototype.preventDefault.call(this)}function a(n){e=n.pointerId;u[e]&&(u[e]=!1)}function v(t){var i,r=0,f;for(i in u)i=parseInt(i),u[i]===!1&&delete u[i]||r++,i===e&&(t.stopPropagation()||t.preventDefault());r===0&&(f=n.Browser.is_ie&&n.Browser.ie_version<11,document.removeEventListener(f?"MSPointerUp":"pointerup",a,!0),document.removeEventListener("click",v,!0))}function c(){}var e=null,u={},t={},f={},o=n.Browser.is_ie&&n.Browser.ie_version<11,s={touchstart:o?"MSPointerDown":"pointerdown",touchend:o?"MSPointerUp":"pointerup",touchmove:o?"MSPointerMove":"pointermove",touchcancel:o?"MSPointerCancel":"pointercancel"};return r.prototype.add=function(n,t,i){n.add_event(this.getNativeName(this.pseudoName),this.getProxiedHandler(t,n),i,!0)},r.prototype.remove=function(r,u,f){r.remove_event(this.getNativeName(this.pseudoName),this.getProxiedHandler(u,r,!0),f,!0);var e=i.get_guid(u);e&&delete t[e];this.pseudoName==="touchstart"&&n(document).remove_event("touchend",c,!0).remove_event("touchcancel",c,!0)},{mouseenter:new r("mouseenter",function(){return"mouseover"},function(n){return y(n)}),mouseleave:new r("mouseleave",function(){return"mouseout"},function(n){return p(n)}),mousewheel:new r("mousewheel",function(t){return n.Browser.is_gecko?"DOMMouseScroll":t},function(n){return w(n)}),touchstart:new r("touchstart",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(t,i,r){return r||n(document).add_event("touchend",c,!0).add_event("touchcancel",c,!0),h(t)}),touchend:new r("touchend",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(n){return h(n)}),touchmove:new r("touchmove",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(n){return h(n)}),touchcancel:new r("touchcancel",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(n){return h(n)})}}},function(){var u=n.Helper,e=n.Internals,i,t,o={},f={},r={load:!1,unload:!1,focus:!1,blur:!1,beforeunload:!1,stop:!1,beforeprint:!1,afterprint:!1,propertychange:!1,filterchange:!1,readystatechange:!1,losecapture:!1};n.ext.add_event=function(){function s(t,i,r,u){for(var f,s=t?t.split(","):[],o=0;o<s.length;o++)f=s[o].trim(),!u&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[f]?n.Events.Pseudo[f].add(this,i,r):this.for_each(function(n){e.addEventListener.call(n,f,i,r)});return this}function h(s,h,c,l){function p(i,r){t=t||1;r.eventPhase=t;r.target=r.srcElement;r.currentTarget=i;var u=n.Screen.get_mouse_pos(r);r.pageX=u.x;r.pageY=u.y;switch(r.type){case"keyup":case"keydown":case"keypress":i.type!=="file"&&(r.keyCode===186?r.keyCode=59:r.keyCode===187?r.keyCode=61:r.keyCode===189?r.keyCode=109:null);r.which=r.keyCode;r.charCode=r.keyCode;break;case"mousedown":case"mouseup":case"click":case"dblclick":case"contextmenu":r.which=[1,1,3,r.button,2][r.button];break;case"mouseover":r.relatedTarget=r.fromElement;break;case"mouseout":r.relatedTarget=r.toElement}return r.preventDefault=function(){r.returnValue=!1},r.stopPropagation=function(){r.cancelBubble=!0},r}function w(n,t,i){var u=r[n],f;return u===!1?!1:(u||(u=r[n]={}),f=u[t],f||(f=u[t]=[]),f.push(i),!0)}function b(n,t){var r=f[n],i;r||(r=f[n]={});i=r[t];i||(i=r[t]={handlerCount:0,remainingHandlers:0});i.handlerCount++;i.remainingHandlers=i.handlerCount}function k(n,f){for(var l=[],h=n,o,e,s,v,c;h;)l.push(h),h=h.parentNode;while(o=l.pop())if(e=u.get_guid(o),r[a][e])for(i||(i=o),v=r[a][e].length,s=0;s<v;s++)f.cancelBubble||(o===f.target&&(f.eventPhase=t=2),c=r[a],c[e]&&c[e][s]&&c[e][s].call(o,f));return i}for(var a,y=s?s.split(","):[],v=0;v<y.length;v++)a=y[v].trim(),!l&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[a]?n.Events.Pseudo[a].add(this,h,c):this.for_each(function(n){var l=u.get_guid(n),y=u.get_guid(h)+(c||!1).toString(),v="{"+l+" / "+a+" / "+y+"}",s;c&&(c=w(a,l,h));s=o[v];s||(s=function(u){var e=f[a][l];e.remainingHandlers--;u=p(n,u);r[a]&&t===1&&(i=k(n,u));t=n===u.target?2:3;u.eventPhase=t;c||u.cancelBubble||h.call(n,u);(!i||u.cancelBubble||n==i&&e.remainingHandlers===0)&&(t=1,i=undefined,e.remainingHandlers=e.handlerCount);u.eventPhase=u.target=u.currentTarget=u.relatedTarget=u.which=u.preventDefault=u.stopPropagation=u.pageX=u.pageY=undefined},o[v]=s,e.attachEvent.call(n,"on"+a,s),b(a,l));v=null;s=null});return this}return document.addEventListener?s:document.attachEvent?h:function(){}}();n.ext.remove_event=function(){function t(t,i,r,u){for(var f,s=t?t.split(","):[],o=0;o<s.length;o++)f=s[o].trim(),!u&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[f]?n.Events.Pseudo[f].remove(this,i,r):this.for_each(function(n){e.removeEventListener.call(n,f,i,r)});return this}function i(t,i,s,h){function v(t,i,u){var e=r[t],f,o;e&&(f=e[i],f&&(o=n(f).index_of(u),o!==-1&&f.splice(o,1),f.length===0&&delete e[i]))}function y(n,t){var i=f[n]&&f[n][t];i&&(i.handlerCount>0&&i.handlerCount--,i.remainingHandlers=i.handlerCount)}for(var c,a=t?t.split(","):[],l=0;l<a.length;l++)c=a[l].trim(),!h&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[c]?n.Events.Pseudo[c].remove(this,i,s):this.for_each(function(n){var r=u.get_guid(n),h=u.get_guid(i)+(s||!1).toString(),f="{"+r+" / "+c+" / "+h+"}",t;s&&v(c,r,i);t=o[f];t&&(e.detachEvent.call(n,"on"+c,t),delete o[f],y(c,r));f=null;t=null});return this}return document.addEventListener?t:document.attachEvent?i:function(){}}()}(),function(){var t=n.Helper;n.ext.add_class=function(i){var r=i.split(/\s+/);return this.for_each(function(i){var u=t.get_class(i);n(r).for_each(function(n){t.contains_class(u,[n])||(u===""?u=n:u+=" "+n)});t.set_class(i,u)}),this}}();n.ext.remove_class=function(n){return this.swap_class(n,"$1")},function(){var t=n.Helper;n.ext.swap_class=function(i,r){r!=="$1"&&(r=" "+r+" ");var u=i.split(/\s+/);return this.for_each(function(i){var f=t.get_class(i);n(u).for_each(function(n){var t=new RegExp("(^| )"+n+"( |$)");f=f.replace(t,r)});t.set_class(i,f.replace(/^\s+|\s+$/g,""))}),this}}(),function(){var t=n.Helper;n.ext.has_class=function(n,i){var r=this[i||0];return r&&t.has_class(r,[n])||!1}}();n.ext.get_html=function(n){var t=this[n||0];return t&&t.innerHTML||""};n.ext.set_html=function(n){return this.for_each(function(t){t.innerHTML=n}),this};n.ext.get_val=function(n){var t=this[n||0];return t&&t.value||""};n.ext.set_val=function(n){return this.for_each(function(t){typeof t.value!="undefined"&&(t.value=n)}),this},function(){var t=n.Helper.get_attr;n.ext.get_attr=function(n,i){var r=this[i||0];return r&&t(r,n)||""}}();n.ext.set_attr=function(n,t){return this.for_each(function(i){var r;i.tagName.toUpperCase()==="INPUT"&&((r=n==="checked")||n==="value")?(i[n]=t,r&&(i.defaultChecked=t)):n.toUpperCase()==="CLASS"?i.className=t:i.setAttribute(n,t)}),this},function(){var t=n.Style.get_rendered_style,i=n.Style.get_opacity,r=n.Style.get_camelized_style_name;n.ext.get_style=function(n,u){var f=this[u||0];return f?n==="opacity"?i(f):t(f,r(n)):""}}(),function(){var t=n.Style.set_opacity,i=n.Style.get_camelized_style_name;n.ext.set_style=function(n){return this.for_each(function(r){var e,u,f;for(e in n){u=n[e];f=i(e);switch(f){case"height":case"maxHeight":case"minHeight":case"width":case"maxWidth":case"minWidth":case"top":case"right":case"bottom":case"left":case"marginTop":case"marginRight":case"marginBottom":case"marginLeft":case"paddingTop":case"paddingRight":case"paddingBottom":case"paddingLeft":r.style[f]=typeof u=="number"&&u+"px"||u;break;case"opacity":t(r,u);break;default:r.style[f]=u}}}),this}}();n.ext.get_native_prop=function(n,t){var i=this[t||0];return i?i[n]:""};n.ext.parent=function(t){var i=this[t||0];return n(i&&i.parentNode)};n.ext.element=function(n){return this[n||0]};n.ext.get_ancestor=function(t,i){for(var r=this[i||0],u=t;u-->0;)if(r)r=r.parentNode;else break;return n(r)};n.ext.get_sibling=function(t,i){var f=this[i||0],r=f;if(t!==0)for(var e=t>0?"nextSibling":"previousSibling",o=Math.abs(t),u=0;u<o;){if(r=r[e],!r)break;r.nodeType===1&&u++}return n(r)};n.ext.for_each=function(){function n(n,t){return this.entities().forEach(n,t),this}function t(n,t){for(var r=this.entities(),u=r.length,i=0;i<u;i++)n.call(t,r[i],i,r);return this}return typeof Array.prototype.forEach!="undefined"?n:t}();n.ext.iterate=function(t){for(var u=this.length,r,i=0;i<u;i++)r=n(this[i]),t.call(r,i);return t=null,this};n.ext.filter=function(t){for(var r=n(),i=this.length;i--;)t(this[i])&&r.unshift(this[i]);return r};n.ext.map=function(){function t(t,i){return n(this.entities().map(t,i))}function i(t,i){for(var r=n(),u=this.length;u--;)r.unshift(t.call(i,this[u]));return r}return typeof Array.prototype.map!="undefined"?t:i}(),function(){var t=n.Helper;n.ext.contains=function(n){return t.contains(this.entities(),n)}}(),function(){var t=n.Helper;n.ext.index_of=function(n){return t.index_of(this.entities(),n)}}();n.ext.select=function(t){return n(t,this[0])};n.ext.has=function(t,i){var r=this[i||0];return n(t,r).length>0},function(){var t=n.Helper;n.ext.unique=function(){return n(t.unique(this.entities()))}}(),function(){var t=n.Style.get_rendered_style;n.ext.get_style_pos=function(n){var i=this[n||0];return{x:parseFloat(t(i,"left")),y:parseFloat(t(i,"top"))}}}(),function(){var t=n.Style.get_absolute_pos;n.ext.get_absolute_pos=function(n){var i=this[n||0];return i&&t(i)||{x:0,y:0}}}(),function(){var t=n.Style.get_relative_pos;n.ext.get_relative_pos=function(n){var i=this[n||0];return i&&t(i)||{x:0,y:0}}}(),function(){n.ext.get_scroll_pos=function(t){var r=this[t||0],i={x:0,y:0};return r===window?typeof pageYOffset!="undefined"?(i.x=window.pageXOffset,i.y=window.pageYOffset):n.Browser.is_in_quirks_mode||typeof document.documentElement.scrollTop=="undefined"?typeof document.body.scrollTop!="undefined"&&(i.x=document.body.scrollLeft,i.y=document.body.scrollTop):(i.x=document.documentElement.scrollLeft,i.y=document.documentElement.scrollTop):(i.x=r.scrollLeft,i.y=r.scrollTop),i}}();n.ext.animate=function(t,i,r,u,f){function l(n,t,i){switch(n){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;default:return i}}function s(t,i){var r=n(t).get_style(i)+"",u=parseFloat(r);return e.units[i]=r.replace(u,""),u}function a(n,i){var e=s(n,i),r=t[i]+"",u=r.match(/^[+\-*\/]/),f=u&&u[0]||"noOp";return r=Number(r.replace(f,"")),l(f,e,r)}var e={units:{},ops:{}},h={},o,c;for(o in t)e[o]=s,h[o]=a;return c=n.Effects.Storyboard.create(this,e,h,function(t,i){var f=n(t),r,u;for(r in i)r!=="units"&&(u={},u[r]=i[r]+e.units[r],f.set_style(u))},i,r,u,f),c.begin(),this};n.ext.bounce=function(t,i,r,u,f){function e(t){return n(t).get_style_pos().y}t===null&&(t=e);var o=n.Effects.Storyboard.create(this,{top:t},{top:i},function(n,t){n.style.top=Math.ceil(t.top)+"px"},r,u,f,n.Effects.Easing.Bounce.ease_out);return o.begin(),this},function(){function t(t,i,r,u,f){this.set_style({zoom:1});t===null&&(t=function(t,i){return Number(n(t).get_style(i))});var e=n.Effects.Storyboard.create(this,{opacity:t},{opacity:i},function(t,i){n(t).set_style({opacity:i.opacity})},r,u,f,null);return e.begin(),this}n.ext.fade_to=t;n.ext.fade_in=function(n,i,r,u,f,e){return t.call(this,n,i,r,u,f,e)};n.ext.fade_out=function(n,i,r,u,f,e){return t.call(this,n,i,r,u,f,e)}}();n.ext.slide=function(t,i,r,u,f,e){function o(t,i){i=i==="left"?"x":"y";var r=t.__pos;return r||(r=t.__pos=n(t).get_style_pos()),i==="y"&&(t.__pos=n.undefined),r[i]}t===null&&(t={x:o,y:o});var s=Math.round,h=n.Effects.Easing.Exponential.ease_in_out,c=n.Effects.Storyboard.create(this,{left:t.x,top:t.y},{left:i.x,top:i.y},function(n,t){n.style.top=s(t.top)+"px";n.style.left=s(t.left)+"px"},r,u,f,e||function(n){return h(n,4)});return c.begin(),this};n.ext.scroll_to=function(t,i,r,u){var f=n.Screen.get_scroll_pos(),e=n(this[0]).get_absolute_pos(),o=Math.round,s=n.Effects.Easing.Exponential.ease_out,h=n.Effects.Storyboard.create([window],{scrollX:f.x,scrollY:f.y},{scrollX:e.x,scrollY:e.y},function(n,t){n.scrollTo(o(t.scrollX),o(t.scrollY))},t,i,r,u||function(n){return s(n,4)});return h.begin(),this};n.ext.veil=function(t,i,r,u,f){function l(t,i){var r=parseInt(n(t).get_style(i),10);return t[h]=t[h]||{},t[h][i]=r}var e=n.Effects.Enums.Directions,h,o,s,c;return t=Math.floor(t)||e[t]||e.vertically,h="_$gimme$_veil",o={},s={},(t&e.vertically)===e.vertically&&(s.height=s.paddingTop=s.paddingBottom=l,o.height=o.paddingTop=o.paddingBottom=0),(t&e.horizontally)===e.horizontally&&(s.width=s.paddingLeft=s.paddingRight=l,o.width=o.paddingLeft=o.paddingRight=0),c=n.Effects.Storyboard.create(this.filter(function(t){var i=t.style.display||n(t).get_style("display");return i!=="none"}),s,o,function(n,i){var r=n.style;(t&e.vertically)===e.vertically&&(r.height=i.height+"px",r.paddingTop=i.paddingTop+"px",r.paddingBottom=i.paddingBottom+"px");(t&e.horizontally)===e.horizontally&&(r.width=i.width+"px",r.paddingRight=i.paddingRight+"px",r.paddingLeft=i.paddingLeft+"px")},i,r,u,f||function(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}),c.get_animations().push(new n.Effects.Animation({startTime:0,elements:this,animate:function(n){n.style.overflow="hidden"}}),new n.Effects.Animation({startTime:c.get_duration(),elements:this,animate:function(n){n.style.display="none"}})),c.begin(),this};n.ext.unveil=function(t,i,r,u,f){function c(t,i){var r=t._$gimme$_veil;return r||(r=r||function(){var i=t.cloneNode(!0),r,u,f;return i.style.cssText="position:absolute;top:0;left:0;visibility:hidden;margin:0;padding:0;border:0;height:;width:;",i.style.display="block",t.parentNode.appendChild(i),i=n(i),r=parseInt(n(t).get_style("height"),10)||parseInt(i.get_style("height"),10),u=parseInt(n(t).get_style("width"),10)||parseInt(i.get_style("width"),10),i[0].style.padding=t.style.padding,f={height:r,width:u,paddingTop:parseInt(i.get_style("paddingTop"),10),paddingBottom:parseInt(i.get_style("paddingBottom"),10),paddingRight:parseInt(i.get_style("paddingRight"),10),paddingLeft:parseInt(i.get_style("paddingLeft"),10)},t.parentNode.removeChild(i[0]),t.style.overflow="hidden",f}()),r[i]}function l(){return document.fullscreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled}var e=n.Effects.Enums.Directions,o,s,h;return t=Math.floor(t)||e[t]||e.vertically,e=n.Effects.Enums.Directions,t=Math.floor(t)||e[t]||e.vertically,o={},s={},(t&e.vertically)===e.vertically&&(s.height=s.paddingTop=s.paddingBottom=0,o.height=o.paddingTop=o.paddingBottom=c),(t&e.horizontally)===e.horizontally&&(s.width=s.paddingLeft=s.paddingRight=0,o.width=o.paddingLeft=o.paddingRight=c),h=n.Effects.Storyboard.create(this.filter(function(t){var i=t.style.display||n(t).get_style("display");return i==="none"||i===null}),s,o,function(n,i){(t&e.vertically)===e.vertically&&(n.style.height=i.height+"px",n.style.paddingTop=i.paddingTop+"px",n.style.paddingBottom=i.paddingBottom+"px");(t&e.horizontally)===e.horizontally&&(n.style.width=i.width+"px",n.style.paddingRight=i.paddingRight+"px",n.style.paddingLeft=i.paddingLeft+"px")},i,r,u,f||function(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}),h.get_animations().push(new n.Effects.Animation({startTime:0,elements:this,animate:function(n){n.style.overflow="hidden";n.style.display="block"}}),new n.Effects.Animation({startTime:h.get_duration(),elements:this,animate:function(n){n.style.overflow=""}})),n.ext.exit_full_screen=function(){l()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen())},n.ext.set_full_screen=function(n){n&&l()&&(n.webkitRequestFullScreen?n.webkitRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.requestFullscreen())},h.begin(),this};n.toString=function(){return"Gimme v2.7.0 (Edmund) :: Thursday, June 28, 2012 3:44:28 PM"},function(){function o(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}function s(){return document.fullscreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled?!0:!1}var r=n.ext,e=300,h=new RegExp('["\\b\\f\\n\\r\\t\\\\\\x00-\\x1F]',"i"),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=new RegExp("/[^A-Za-z0-9+/=]","g"),u=64,l=63,f=n.Internals;r.append=function(t){var i=this,r=i[0];return r&&n(t).for_each(function(n){var t=n.parentNode;t!==r&&(n.getRootElement?(n=n.getRootElement(),i.append(n)):r.appendChild(n))}),i};r.insertBefore=function(t,i){var r=this[0];return i.length&&(i=i[0]),r&&n(t).for_each(function(n){r.insertBefore(n,i)}),this};r.appendTo=function(t){return t=n(t)[0],t&&this.for_each(function(n){n.parentNode!==t&&t.appendChild(n)}),this};r.getParent=r.parent;r.appendText=function(n){return this.for_each(function(t){t.appendChild(document.createTextNode(n))}),this};r.appendHTML=function(n){return this.for_each(function(t){sj_appHTML(t,n)}),this};r.fadeIn=function(t,i,r,u){function h(){r&&r()}var f=this[0],s;return t=n(t),s=t.get_style("opacity")||1,t.set_style({opacity:0}),u?f.insertBefore(t[0],f.firstChild):t.appendTo(f),t.fade_in(0,s,i||e,null,h,o),this};r.fadeOut=function(n,t,i){function f(){n&&r.removeFromParent();i&&i()}var r=this,u=this.get_style("opacity")||1;return r.fade_out(u,0,t||e,null,f,o),this};r.fadeToChild=function(t,i,r){function l(){t.set_style({zIndex:h});f.removeFromParent();r&&r()}var s=this[0],u;t=n(t);u=t.get_style("opacity")||1;t.set_style({opacity:0}).appendTo(s);var h=t.get_style("zIndex")||0,c=this.select(">*").set_style({position:"absolute",top:0,left:0,zIndex:0}),f=c.filter(function(n){return t.index_of(n)===-1});return f.length?t.fade_in(0,u,i||e,null,l,o):t.set_style({opacity:1}),this};r.removeFromParent=function(){return this.for_each(function(n){n.parentNode&&n.parentNode.removeChild(n)}),this};r.get_size=function(){return new nt(this[0].clientWidth,this[0].clientHeight)};r.clear=function(){return this.for_each(function(n){for(var t=n.lastChild;t;)n.removeChild(t),t=n.lastChild}),this};r.set_text=function(n){return this.clear(),this.for_each(function(t){t.appendChild(document.createTextNode(n))}),this};r.getOpacity=function(){return parseFloat(this.get_style("opacity"))};r.fireEvent=function(n){return this.for_each(function(t){var r,i;document.createEventObject?(r=document.createEventObject(),t.fireEvent("on"+n,r)):(i=document.createEvent("HTMLEvents"),i.initEvent(n,!0,!0),t.dispatchEvent(i))}),this};r.inlineDataSvgs=function(){var r=/^(?:url\(['"]?)?data:(.+);base64,([^'")]+)(?:['"]?\))?$/,u=new DOMParser,t=this;return t.iterate(function(f){var e=t[f],w=e.children&&e.children.length||e.textContent&&e.textContent.trim(),s,a,y,v,o,h,p,c,l;if(!w&&(s=n(e).get_style("background-image").match(r),s&&(a=s[1],y=s[2],a==="image/svg+xml")))try{if(v=u.parseFromString(atob(y),a),o=v&&v.rootElement,!o||o.tagName!=="svg")return;for(h=e.attributes,p=h&&h.length,c=0;c<p;c++)l=h[c],l.value&&o.setAttribute(l.name,l.value);o.setAttribute("focusable","false");o.style.backgroundImage="none";e.parentNode.replaceChild(o,e);t[f]=o}catch(b){i.assert(!1,"Error creating SVG: "+b)}}),this};r.remove_attr=function(n){return this.for_each(function(t){t.removeAttribute(n)}),this};r.is_element_inView=function(n,t){var i=this[0].getBoundingClientRect(),r=n?n:0,u=t?t:0;return i.top-r>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)-u&&i.right<=(window.innerWidth||document.documentElement.clientWidth)};r.exit_full_screen=function(){s()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen())};r.set_full_screen=function(n){n&&s()&&(n.webkitRequestFullScreen?n.webkitRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.requestFullscreen())};f.stringify=function(n,t){function i(n,t){var u,r,i;if(t=t+'"',h.test(n))for(u=n.length,r=0;r<u;r++)if(i=n.charAt(r),i>=" ")(i==="\\"||i==='"')&&(t=t+"\\"),t=t+i;else switch(i){case"\b":t=t+"\\b";break;case"\f":t=t+"\\f";break;case"\n":t=t+"\\n";break;case"\r":t=t+"\\r";break;case"\t":t=t+"\\t";break;default:t=t+"\\u00";i.charCodeAt()<16&&(t=t+"0");t=t+i.charCodeAt().toString(16)}else t=t+n;return t+'"'}function r(n,t){var f,u,e;switch(typeof n){case"object":if(n)if(n instanceof Number)t=t+n.toString();else if(n instanceof Boolean)t=t+n.toString();else if(n instanceof String)t=i(n,t);else if(n instanceof Array){for(t=t+"[",u=0;u<n.length;u++)u>0&&(t=t+","),t=r(n[u],t);t=t+"]"}else{t=t+"{";u=0;for(f in n)n.hasOwnProperty(f)&&(e=n[f],typeof e!="undefined"&&typeof e!="function"&&(u>0&&(t=t+","),u++,t=i(f,t),t=t+":",t=r(e,t)));t=t+"}"}else t=t+"null";break;case"number":case"boolean":t=t+n.toString();break;case"string":t=i(n,t);break;default:t=t+"null"}return t}function f(n){return r(n,"")}var u=window.JSON&&window.JSON.stringify;return u&&!t?u(n):f(n)};f.base64Encode=function(n){if(!n||n.length===0)return n;for(var s=n.length,h=s%3,c=s-h,i="",f,e,o,r=0;r<c;r+=3)f=n.charCodeAt(r),e=n.charCodeAt(r+1),o=n.charCodeAt(r+2),i+=t.charAt((f&252)>>2),i+=t.charAt((f&3)<<4|(e&240)>>4),i+=t.charAt((e&15)<<2|(o&192)>>6),i+=t.charAt(o&l);r=c;f=n.charCodeAt(r);e=n.charCodeAt(r+1);switch(h){case 1:i+=t.charAt((f&252)>>2);i+=t.charAt((f&3)<<4);i+=t.charAt(u);i+=t.charAt(u);break;case 2:i+=t.charAt((f&252)>>2);i+=t.charAt((f&3)<<4|(e&240)>>4);i+=t.charAt((e&15)<<2);i+=t.charAt(u)}return i};f.base64Decode=function(n){var h,l,r,i,s,e,f,o;if(!n||n.length===0)return n;if(h=n.length,h%4!=0||c.exec(n))throw"Not a valid base64 encoded string";for(l=h-4,r="",i=0;i<l;i+=4)s=n.charAt(i),e=n.charAt(i+1),f=n.charAt(i+2),o=n.charAt(i+3),r+=String.fromCharCode(t.indexOf(s)<<2|t.indexOf(e)>>4),r+=String.fromCharCode((t.indexOf(e)&15)<<4|t.indexOf(f)>>2),r+=String.fromCharCode((t.indexOf(f)&3)<<6|t.indexOf(o));return i=l,s=n.charAt(i),e=n.charAt(i+1),f=n.charAt(i+2),o=n.charAt(i+3),r+=String.fromCharCode(t.indexOf(s)<<2|t.indexOf(e)>>4),t.indexOf(f)!==u&&(r+=String.fromCharCode((t.indexOf(e)&15)<<4|t.indexOf(f)>>2)),t.indexOf(o)!==u&&(r+=String.fromCharCode((t.indexOf(f)&3)<<6|t.indexOf(o))),r};f.isTouchDevice=function(){var n=window.navigator&&(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)||window.PointerEvent,t=n&&window.MSGesture;return"ontouchstart"in window||t||window.DocumentTouch&&document instanceof DocumentTouch};f.HTMLEncode=function(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}(),function(n){var t=function(){var n,t,i;try{return n=(new Date).toString(),t=window.localStorage,t.setItem(n,n),i=t.getItem(n)===n,t.removeItem(n),i&&t}catch(r){}}(),i=function(){function n(){}return n.isEnabled=function(){return!!t},n.getItem=function(i){var r,u,f,e;return t?(r=t.getItem(i),r&&(u=n._generateExpirationKey(i),f=t.getItem(u),f&&(e=parseInt(f),Date.now()>e&&(r=null,t.removeItem(i),t.removeItem(u)))),r):null},n.setItem=function(i,r,u){t&&((!isFinite(u)||u>0)&&t.setItem(i,r),u>0&&t.setItem(n._generateExpirationKey(i),(Date.now()+u*864e5).toString()))},n.removeItem=function(i){if(t){var r=n._generateExpirationKey(i);t.removeItem(i);t.removeItem(r)}},n._generateExpirationKey=function(n){return"_$Maps_"+n+"_expiration"},n}();n.LocalStorageCache=i}(bt||(bt={}));var dr="MicrosoftMap",u=window.$MicrosoftMaps8,r=u.GlobalConfig,p=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),h=function(){function n(n,t,i){this.x=n;this.y=t;this.z=i}return n.prototype.add=function(t){return this.z&&t.z?new n(this.x+t.x,this.y+t.y,this.z+t.z):new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return this.z&&t.z?new n(this.x-t.x,this.y-t.y,this.z-t.z):new n(this.x-t.x,this.y-t.y)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.equals=function(t,i){return n.pointsEqual(this,t,i)},n.pointsEqual=function(n,t,i){return n&&t?i>0?Math.abs(n.x-t.x)<=i&&Math.abs(n.y-t.y)<=i:n.x===t.x&&n.y===t.y&&n.z===t.z:!1},n.prototype.toString=function(){return typeof this.z=="undefined"?"[Point ("+this.x+", "+this.y+")]":"[Point ("+this.x+", "+this.y+", "+this.z+")]"},n.prototype.scalarMultiply=function(t){return new n(this.x*t,this.y*t,this.z?this.z*t:null)},n.prototype.invert=function(){return new n(-this.x,-this.y,this.z?-this.z:null)},n}(),nt=function(){function n(n,t){this.width=n;this.height=t}return n.Auto=new n(-1,-1),n}(),gr=function(){function n(n,t,r){i.assertIsFunction(n,"handler");i.assert(isFinite(t)&&t>0,"Argument: interval should be a positive number.");this.handler=n;this._interval=t;this._eventFilter=r;this._nextScheduledEventId=null}return n.prototype.invoke=function(n){var i=this,t;this._isScheduled()?(this._eventFilter&&(n=this._eventFilter(this._nextScheduledEventArgs,n)),this._nextScheduledEventArgs=n):(t=Date.now(),this._lastRaisedTime&&this._lastRaisedTime<t+this._interval?(this._nextScheduledEventArgs=n,this._nextScheduledEventId=Microsoft.Maps.setTimeout(function(){i._raiseScheduledEvent()},this._lastRaisedTime+this._interval-t)):(this.handler(n),this._lastRaisedTime=t))},n.prototype.dispose=function(){this._clearScheduledEvent()},n.prototype._raiseScheduledEvent=function(){this.handler(this._nextScheduledEventArgs);this._lastRaisedTime=Date.now();this._clearScheduledEvent()},n.prototype._isScheduled=function(){return this._nextScheduledEventId!==null},n.prototype._clearScheduledEvent=function(){this._isScheduled()&&(clearTimeout(this._nextScheduledEventId),this._nextScheduledEventId=null)},n}(),t=function(){function n(){this._handlers=[];this._throttledEventInvokers=[];this.isPreviouslyInvoked=!1;this.lastInvokedArgs=null}return n.prototype.add=function(n,t){var r=this;return t===void 0&&(t=!1),i.assertIsFunction(n,"handler"),t?this._handlers.splice(0,0,n):this._handlers.push(n),{dispose:function(){return r.remove(n)}}},n.prototype.addOne=function(n){var t=this.add(function(i){t.dispose();n(i)});return t},n.prototype.addThrottled=function(n,t,r){var u=this;return i.assertIsFunction(n,"handler"),i.assert(isFinite(t)&&t>0,"Argument: throttleInterval should be a positive number."),this._throttledEventInvokers.push(new gr(n,t,r)),{dispose:function(){return u._removeThrottledEventHandler(n)}}},n.prototype.remove=function(n){var t;if(typeof n=="function"){for(t=this._handlers.length;t--;)if(this._handlers[t]===n){this._handlers.splice(t,1);return}}else for(t=this._throttledEventInvokers.length;t--;)if(this._throttledEventInvokers[t].handler===n){this._throttledEventInvokers[t].dispose();this._throttledEventInvokers.splice(t,1);return}},n.prototype.invoke=function(n){var i,t,u,r;for(this.lastInvokedArgs=n,this.isPreviouslyInvoked=!0,i=this._handlers.slice(0),t=0,u=i.length;t<u;t++)i[t](n);for(r=this._throttledEventInvokers.slice(0),t=0;t<r.length;t++)r[t].invoke(n)},n.prototype.hasHandlersRegistered=function(){return this._handlers.length+this._throttledEventInvokers.length>0},n.prototype.isHandlerRegistered=function(n){return this._handlers.some(function(t){return n===t})||this._throttledEventInvokers.some(function(t){return n===t.handler})},n.prototype.dispose=function(){this._handlers=[];for(var n=this._throttledEventInvokers.length;n--;)this._throttledEventInvokers[n].dispose();this._throttledEventInvokers=[];this.lastInvokedArgs=null},n.prototype._removeThrottledEventHandler=function(n){for(var t=this._throttledEventInvokers.length;t--;)if(this._throttledEventInvokers[t].handler===n){this._throttledEventInvokers[t].dispose();this._throttledEventInvokers.splice(t,1);return}},n}(),a=function(){function t(){}return t.getValue=function(n,r){if(i.assertNotNull(n,"object"),i.assertNotNullOrEmpty(r,"name"),n.hasOwnProperty(r))return n[r];var u=n["get"+t.capitalizeProp(r)];return u?u.call(n):n.get?n.get(r):n.length===1&&n.constructor===t._gimmeConstructor?t.getValue(n[0],r):n[r]},t.mergeProperties=function(n,t){var i,r;for(i in t)r=t[i],t.hasOwnProperty(i)&&r!==undefined&&(n[i]=r)},t.setValue=function(n,r,u,f){i.assertNotNull(n,"object");i.assertNotNullOrEmpty(r,"name");f||t.cancelAnimation(n,r);var e=n["set"+t.capitalizeProp(r)];e?e.call(n,u):n.set?n.set(r,u):n.set_attr?u===null&&n.remove_attr?n.remove_attr(r):n.set_attr(r,u):n[r]=u},t.capitalizeProp=function(n){return(typeof n=="string")?n.charAt(0).toUpperCase()+n.substring(1):n},t.areEqual=function(n,i){if(n===i)return!0;if(typeof n!=typeof i)return!1;if(n instanceof Array&&i instanceof Array&&!n.length&&!i.length)return!0;if(typeof n=="object"&&n&&i&&n.constructor===Object&&i.constructor===Object){for(var r in n)if(n.hasOwnProperty(r)&&!t.areEqual(n[r],i[r]))return!1;for(r in i)if(i.hasOwnProperty(r)&&!t.areEqual(n[r],i[r]))return!1;return!0}return n===i},t._lerp=function(n,i,r){if(typeof n==typeof i)switch(typeof n){case"object":var f={};for(var u in n)n.hasOwnProperty(u)&&(f[u]=t._lerp(n[u],i[u],r));return f;case"number":return n+(i-n)*r;case"boolean":return r<.5?n:i}},t.cancelAnimation=function(n,i){var r=n[t._animationPrefix+i];r&&(r.onStop&&r.onStop(),r.abort(),n[t._animationPrefix+i]=null)},t.hasAnimation=function(n,i){return!!n[t._animationPrefix+i]},t.animate=function(r,u,f){function w(n){for(var i,t=0;t<e.length;t++)if(i=e[t],i.time>=o*n){l=t===0?p:e[t-1];h=i;c=l.time/o;a=h.time/o;break}}function k(n,i){i=i.value;e&&(i<c||i>a)&&w(i);var o=(i-c)/(a-c),s;s=typeof h.value=="function"?h.value(o):t._lerp(l.value,h.value,o);t.setValue(r,u,s,!0);f.frameCallback&&f.frameCallback(i)}function d(){r[t._animationPrefix+u]=null;f.repeat?s.begin():f.autoReverse?s.reverse():(f.onStop&&f.onStop(),f.onComplete&&f.onComplete())}var y,s;i.assertNotNull(r,"obj");i.assertNotNullOrEmpty(u,"prop");i.assertNotNull(f,"options");i.assertNotNull(f.to===0||f.to||f.keyframes,"options.to or options.keyframes");var b=f.from||t.getValue(r,u),v=f.to,e=f.keyframes,o=f.duration>=0?f.duration:e&&e[e.length-1].time||300;if(t.cancelAnimation(r,u),o===0){t.setValue(r,u,v);return}y=f.easing&&t._easingFuncs[f.easing]||f.easing||t._easingFuncs.basic;s=n.Effects.Storyboard.create([r],{value:0},{value:1},k,o,null,d,y);r[t._animationPrefix+u]=s;s.begin();var p={time:0,value:b},l=p,h={time:o,value:v},c=0,a=1;e&&w(0)},t.addPropertyValue=function(n,i,r){var u=t.getValue(n,i)||"",o,f,s,e;if(r&&typeof u=="string"){for(o=r.split(/\s+/),f=0,s=o.length;f<s;f++)e=o[f],t._propertyContainsValues(u,[e])||(u===""?u=e:u+=" "+e);t.setValue(n,i,u)}},t.propertyHasValues=function(n,i,r){var u=t.getValue(n,i);return!r||!u||typeof u!="string"?!1:t._propertyContainsValues(u,r.split(/\s+/))},t.removePropertyValue=function(n,i,r){t.swapPropertyValue(n,i,r,"$1")},t.swapPropertyValue=function(n,i,r,u){var f=t.getValue(n,i),o,e,s,h;if(r&&u&&typeof f=="string"){for(u!=="$1"&&(u=" "+u+" "),o=r.split(/\s+/),e=0,s=o.length;e<s;e++)h=new RegExp("(^| )"+o[e]+"( |$)"),f=f.replace(h,u);t.setValue(n,i,f.replace(/^\s+|\s+$/g,""))}},t._propertyContainsValues=function(n,t){var r,i,u;if(!n)return!1;for(r=" "+n+" ",i=0,u=t.length;i<u;i++)if(r.indexOf(" "+t[i]+" ")===-1)return!1;return!0},t._animationPrefix="__animation_",t._gimmeConstructor=n("").constructor,t._easingFuncs={linear:function(n){return n},basic:function(n){return n},exponentialOut:function(t){return n.Effects.Easing.Exponential.ease_out(t,4)},exponentialInOut:function(t){return n.Effects.Easing.Exponential.ease_in_out(t,16)}},t}();String.prototype.endsWith||(String.prototype.endsWith=function(n,t){return(t===undefined||t>this.length)&&(t=this.length),this.substring(t-n.length,t)===n});String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return(!t||t<0)&&(t=0),this.substring(t,t+n.length)===n});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.replaceAll||(String.prototype.replaceAll=function(n,t){for(var i=this,r=i.indexOf(n);r!==-1;)i=i.replace(n,t),r=i.indexOf(n);return i}),function(f){function st(n,t,i){return Math.min(Math.max(n,t),i)}function ht(n){for(var i,r={},u=Object.keys(n),t=0,f=u.length;t<f;t++)i=u[t],r[i]=n[i];return r}function ct(t){var i=document.createElement(t);return n(i)}function lt(n){return typeof n=="string"?n.toLowerCase()==="true":!!n}function at(n){var t=n*720;return Math.ceil(t)}function vt(n){for(var i=0,t=n.length;t--;)n[t]=i+=n[t]}function yt(n){for(var i,r=["imageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","webkitImageSmoothingEnabled"],t=0,u=r.length;t<u;t++)if(i=r[t],n[i]){n[i]=!1;break}}function pt(i,u,f){var e,o,s;return f=f||{},e=new t,o=function(n){var t,c,l;if(f.preventDefault&&n.preventDefault(),f.stopPropagation&&n.stopPropagation(),t={},typeof n.pageX=="number"){var u=i.get_absolute_pos(),o=i[0],s=1,h=1;r.isJSEventScaleAware&&u.width&&u.height&&(s=o.offsetWidth/u.width,h=o.offsetHeight/u.height);c=(n.pageX-u.x)*s;l=(n.pageY-u.y)*h;t.point={x:c,y:l}}typeof n.wheelDelta=="number"?t.wheelDelta=n.wheelDelta/120:typeof n.detail=="number"&&(t.wheelDelta=-n.detail);typeof n.keyCode=="number"&&(t.keyCode=n.keyCode);t.target=n.target;f.argBuilder&&f.argBuilder(t,n);e.invoke(t)},i.add_event(u,o),s="jsEvent"+u+"_"+n.Helper.get_guid(o),i[0]&&(i[0][s]=o),e.id=s,e}function wt(n,t,i){var r=n[0];r&&(n.remove_event(t,r[i]),delete r[i])}function e(n){return typeof Array.isArray=="function"?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"}function bt(n,t){var r=[],i,u;if(!n)return r;for(i=0,u=n.length;i<u;i++)n[i]===t&&r.push(i);return r}function kt(n){return n}function dt(n,t){return typeof n=="number"&&isFinite(n)||(n=t),n}function nt(n,t,i,r){var u,o;r===void 0&&(r=a.getValue);for(var s=r(t,i),e=0,f=n.length-1,h=-1;e<=f;)u=(e+f)/2|0,o=r(n[u],i),o===s?(h=u,f=u-1):o>s?f=u-1:e=u+1;return h}function tt(n,t,i,r){var f,o;r===void 0&&(r=a.getValue);for(var s=r(t,i),u=0,e=n.length;e>u;)f=(u+e)/2|0,o=r(n[f],i),o<=s?u=f+1:e=f;return u}function gt(n,t,i,r){var u,f,e;if(r===void 0&&(r=a.getValue),u=nt(n,t,i,r),f=n.length,u>=0)for(e=r(t,i);u<f;)if(t===n[u])n.splice(u,1),f--;else if(r(n[u],i)!==e)break;else u++}function ni(n,t,i,r){r===void 0&&(r=a.getValue);var u=tt(n,t,i,r);return n.splice(u,0,t),u}function ti(n){for(var t,i,f=[],r=1;r<arguments.length;r++)f[r-1]=arguments[r];if(n&&f){var e=/\d+/g,u=n.match(/{\d+}/g);if(u)for(t=0;t<u.length;t++)i=f[Number(u[t].match(e)[0])],(i===null||typeof i=="undefined")&&(i=""),n=n.replace(u[t],i)}return n}function ii(n,t){var r=n,u,i,f;if(r&&t)for(u=Object.keys(t),i=0,f=u.length;i<f;i++)r=r.replace(u[i],t[u[i]]);return r}function ri(t){var i=f._createElement("img")[0],e=window.document.body,r,u,o;return e&&(i.className=t,i.style.display="none",e.appendChild(i),r=n(i).get_style("background-image"),e.removeChild(i),r==="none"&&(u=f._createElement("div")[0],u.className="MicrosoftMap",u.style.display="none",e.appendChild(u),u.appendChild(i),r=n(i).get_style("background-image"),e.removeChild(u)),r&&(o=r.substring(4,r.length-1),i.src=o.replace(/"/g,"")),i.className=""),i}function ui(n,t,i){var f=i||v.L_AreaFieldString,r=v.L_FormatFieldString.replace("{0}",f),u;return n<0?r.replace("{1}",v.L_IncorrectValue_text):(u=it(n,t),r.replace("{1}",u))}function it(n,t){var i=n/1e6;return t||(i*=.385641),rt(i,t)}function rt(n,t){var i,r=1;return t?n<.1?(n*=1e6,i=v.L_DistanceUnitMetersSquare_Text,r=0):i=v.L_DistanceUnitKmSquare_Text:n<.1?(n*=27878400,i=v.L_DistanceUnitFeetSquareShort_Text,r=0):i=v.L_DistanceUnitMilesSquareShortText_Text,f._formatString(v.L_Distance_Format,f._toFixed(n,r),i)}function fi(n,t,i){var f=i||v.L_LengthFieldString,r=v.L_FormatFieldString.replace("{0}",f),u;return n<0?r.replace("{1}",v.L_IncorrectValue_text):(u=ut(n,t),r.replace("{1}",u))}function ut(n,t){return n/=t?1e3:1609.34,ft(n,t)}function ft(n,t,i,r){var e,o=1,s=n>=50&&i;return n=n&&s?Math.round(n):n,t?n<.1?(n*=1e3,e=v.L_DistanceUnitMeters_Text,o=0):e=v.L_DistanceUnitKm_Text:n<.1?(n*=5280,e=v.L_DistanceUnitFeetShort_Text,o=0):e=u.GlobalConfig.features.directions.bestModeEnabled&&r?v.L_DistanceUnitMilesLongText_Text:v.L_DistanceUnitMilesShortText_Text,f._formatString(v.L_Distance_Format,f._toFixed(n,s?0:o),e)}function ei(n,t){return f._formatString(v.L_LatLon_Format,f._toFixed(n,6),f._toFixed(t,6))}function oi(n,t){return n.toFixed(t).replace(".",u.GlobalConfig.dynamicProperties.cultureData.numberDecimalSeparator)}function y(n,t,i){var r=t+t;return n.indexOf(r)<0?n.replace(t,i):n.replace(r,(i<10?"0":"")+i)}function si(n,t){return c(n,r.dynamicProperties.cultureData.shortDatePattern,t)}function hi(n){return c(n,r.dynamicProperties.cultureData.longDatePattern)}function ci(n){var t=r.dynamicProperties.cultureData.longDatePattern;return t=t.replace("dddd","ddd"),t=t.replace("MMMM","MMM"),c(n,t)}function li(n){return c(n,r.dynamicProperties.cultureData.yearMonthPattern,!1,!0)}function ai(n){return c(n,r.dynamicProperties.cultureData.weekMonthDayPattern)}function vi(n,t){t===void 0&&(t=!1);var u=t?Math.ceil(n/60):Math.round(n/60),i=u%60,r=Math.floor(u/60);return r===0?f._formatString(v.L_Duration_Min,i):i===0?f._formatString(v.L_Duration_NoMin,r):f._formatString(v.L_Duration,r,i)}function yi(n){return f._formatShortTimeString(n.getHours(),n.getMinutes(),n.getSeconds())}function pi(n){return f._formatShortTimeString(n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds())}function wi(n,t,i){var f=u.GlobalConfig.dynamicProperties.cultureData,e,o,r=f.shortTimePattern,s=r.indexOf("H")<0;return s?(o=n>=12,n=pu(n),e="h"):e="H",r=y(r,e,n),r=y(r,"m",t),r=y(r,"s",i),s&&(r=r.replace("tt",o?f.pmDesignator:f.amDesignator)),r.replace(/:/g,f.timeSeparator)}function bi(n){return f._formatUTCTimeString(new Date(f._getTime(n)))}function ki(n){var t=n.match(/\((\d+)([-,+]?)(\d{2})?(\d{2})?\)/),i;if(t&&t[1]&&(i=parseInt(t[1],10),t[2]&&t[3]&&t[4])){var f=t[2]==="-"?-1:1,r=parseInt(t[3],10),u=parseInt(t[4],10);isNaN(r)||isNaN(u)||(i+=f*(r*60+u)*6e4)}return i}function di(){function n(){return((1+Math.random())*65536|0).toString(16).substr(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function o(n,t,i){i===void 0&&(i=!0);var f=encodeURI(t).replace(/[\.\(\)\*\+]/g,"\\$&"),e="^(?:.*[&\\?]"+f+"=([^&]*))?.*$",r=new RegExp(e,"i").exec(n.search),u=r&&r[1]||"";return i?decodeURIComponent(u):u}function p(n){var t=n.bounds||n.b;return e(t)}function w(n){var t=n.bounds||n.b;return e(t)?e(n.x)?e(n.y)?!0:!1:!1:!1}function b(n){var u=n.bounds||n.b,t,i,r;if(!e(u)||(t=n.rings||n.r,!e(t)))return!1;for(i=t.length-1;i>=0;){if(r=t[i],!e(r.x)||!e(r.y))return!1;--i}return!0}function s(n,t){if(n===t)return!0;if(!n||!t||n.length!==t.length)return!1;for(var i=n.length-1;i>=0;){if(n[i]!==t[i])return!1;--i}return!0}function gi(n,t,r){var y,k,o,h,c,l,a,v,f,e,u,d,g,nt,tt;if(n===t)return!0;if(!n||!t||(y=n.bounds||n.b,k=t.bounds||t.b,!s(y,k)))return!1;switch(r){case 1:if(o=n,h=t,i.assert(p(o),"Invalid point geometry"),i.assert(p(h),"Invalid point geometry"),o.x!==h.x||o.y!==h.y)return!1;break;case 2:if((c=n,l=t,i.assert(w(c),"Invalid line geometry"),i.assert(w(l),"Invalid line geometry"),!s(c.x,l.x))||!s(c.y,l.y))return!1;break;case 3:if(a=n,v=t,i.assert(b(a),"Invalid area geometry"),i.assert(b(v),"Invalid area geometry"),f=a.rings||a.r,e=v.rings||v.r,!f||!e)throw Error("Invalid area geometry - no rings property");if(f.length!==e.length)return!1;for(u=f.length-1;u>=0;){if((d=f[u].x,g=e[u].x,!s(d,g))||(nt=f[u].y,tt=e[u].y,!s(nt,tt)))return!1;--u}break;case 0:default:throw Error("Cannot compare geometries - Invalid geometry type");}return!0}function nr(n,t){return n===t?!0:!n||!t?!1:n.id===t.id}function tr(n,t){return n===t}function ir(){return o(window.location,"stlVersion")}function rr(){var n=o(window.location,"perftest");return n==="true"||n==="1"}function ur(){var n=o(window.location,"lowmem");return n==="true"||n==="1"}function fr(){var n=o(window.location,"polygon");return n?parseInt(n):null}function er(){var n=parseFloat(o(window.location,"dpr"));return n||window.devicePixelRatio||1}function or(){return window.matchMedia("(-ms-high-contrast:active)").matches}function sr(n,t){if(n&&n!==16777215&&n!==4294967295){for(var i=n.toString(16);i.length<6;)i="0"+i;return i.length===8&&(i=i.substr(2)),"#"+i}return t||""}function hr(n){var t=(n&16711680)>>16,i=(n&65280)>>8,r=n&255;return(t*.299+i*.587+r*.114)/256}function cr(){var n=h();return n&&n.dynamicProperties?n.isMapsAnswer&&n.dynamicProperties.largeMapShownOnSerp:!1}function lr(){var n=h();return n&&n.dynamicProperties?n.isMapsAnswer&&!n.dynamicProperties.largeMapShownOnSerp:!1}function ar(){var n=h(),t=n&&n.dynamicProperties;return t?n.isMapsAnswer&&t.localOverlayOnSerp&&t.localOverlayOnSerp.visible:!1}function vr(){var n=h(),t=n&&n.dynamicProperties;return t?n.isMapsAnswer&&t.realEstateOverlayOnSerp&&t.realEstateOverlayOnSerp.visible:!1}function yr(){var n=h(),t=n&&n.dynamicProperties;return t?n.isMapsAnswer&&t.travelOverlayOnSerp&&t.travelOverlayOnSerp.visible:!1}function pr(){var n=h();return!n||n.isSDK}function wr(){return f._isLocalOverlayShownOnSerp()||f._isRealEstateOverlayShownOnSerp()}function br(n,t,i){var u=document.createElement("style"),r,f;return u.type="text/css",r=".MicrosoftMap .taskCard.focus .titleBar.",f=""+r+n+",\n                    "+r+"hover."+n+",\n                    "+r+n+" .catIcon,\n                    "+r+"hover."+n+" .catIcon,\n                    "+r+n+" ."+i+".titleIcon,\n                    "+r+"hover."+n+" ."+i+".titleIcon\n                    {background-color:"+t+" !important}",u.innerHTML=f,u}function kr(n){var r,f,t,u,i;if(n)if(Array.isArray(n)){for(r=n,t=0,u=r.length;t<u;t++)i=r[t],i&&i.dispose&&i.dispose();r.length=0}else for(f=Object.keys(n),t=0,u=f.length;t<u;t++)i=n[f[t]],i&&i.dispose&&i.dispose(),delete n[f[t]]}function dr(n){if(n)for(var i in n)n.hasOwnProperty(i)&&n[i]instanceof t&&(n[i].dispose&&n[i].dispose(),delete n[i])}function gr(n){var t,i,r;if(n)for(t in n)n.hasOwnProperty(t)&&(i=n[t],i&&(r=typeof i,r!=="function"&&(e(i)?n[t]=[]:r==="object"&&(n[t]=null))))}function nu(n){var t=n.charAt(n.length-1),i=parseInt(t)%2;return i!==NaN&&(t=i.toString()),t}function tu(){var t=Microsoft.Maps.GlobalConfig.features.taskFramework;return typeof f._isSlideCardEnabled=="undefined"&&(f._isSlideCardEnabled=t&&n("body")[0].clientWidth>=t.slideoutMinWidth),f._isSlideCardEnabled}function et(n){var t=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig;return t&&t.features[n]&&t.features[n].isEnabled}function iu(n){var i=Microsoft&&Microsoft.Maps&&Microsoft.Maps.Internal,t;return i?(t=i._CoreConfig(),n.replace("{protocol}",t.urlProtocol).replace("{tfeDomainDynamic}",t.tfeDomainDynamic).replace("{tfeDomainStatic}",t.tfeDomainStatic)):n}function ru(n,t){var i=n,r;return t&&(r=t.searchQueryCategory||t.selectedCategoryId||t.category,n==="LocalListingTask"?Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomHotelsExperience&&d(r)?i="HotelsListingTask":k(r)?i="HouseListingTask":Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomRestaurantsExperience&&g(r)?i="RestaurantsListingTask":et("verticalZipcode")&&ot(r)&&(i="PolygonListingTask"):n==="LocalDetailsTask"&&(Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomHotelsExperience&&d(r)?i="HotelsDetailsTask":k(r)?i="HouseDetailsTask":Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomRestaurantsExperience&&g(r)&&(i="RestaurantDetailsTask"))),i}function k(n){return l(n,["house"])}function d(n){return l(n,["91572","13344","hotel"])}function uu(n){return l(n,["attraction","90012"])}function g(n){return l(n,["90287","90232","restaurant","food & drink","food & dining"])}function ot(n){return l(n,["zipcode","ZipCode"])}function fu(n){var t=yu();return t&&t[n]}function eu(n){for(var t,r,u=e(n)?n:[n],f=[],i=0;i<u.length;i++)t=u[i],r=t&&t.entity&&t.entity.id,r&&f.push(r);return f}function ou(n){for(var r=0,t=0,i=0;i<n.length;i++)r+=n.charCodeAt(i)<<t,t++,t>6&&(t=0);return r.toString(16)}function su(){return r.isMapsAnswer&&!r.isMapsVertical?!1:r.features.labels.glLabelAndPoi}function hu(){var t=r.features.labels,n;t&&(t.glLabelAndPoi=!1);n=r.features.taskFramework;n&&(n.glMicroPoi=!1);r.glPolyline=!1}function cu(t){var i=n("#id_h"),r;i.length>0&&(r=i.get_style("display"),t&&r==="none"?i.set_style({display:""}):t||r==="none"||i.set_style({display:"none"}))}function lu(t){if(t.length>0){var i=n(t[t.length-1]).select(".dropdownEntry");i&&i.length>0&&(i[0].focus(),i[0].style.border="none")}}function au(n){var i=n,t;return n&&(t=document.createElement("textarea"),t.innerHTML=n,i=t.value),i}function vu(){var n=r.features.taskBar;return n&&(n.showAdditiveSearchOutsideSearchbox||n.showAdditiveSearchInsideSearchbox||n.showReplaceSearchInsideSearchbox||n.showReplaceSearchOutsideSearchbox)}function yu(){var n=Microsoft&&Microsoft.Maps&&Microsoft.Maps.Internal;return n&&n._CoreConfig&&n._CoreConfig()}function pu(n){return n>12?n-=12:n||(n=12),n}function c(n,t,i,u){for(var e,v=r.dynamicProperties.cultureData,o=[],s=-1,h=t.length,f=0;f<h;f++){var l=t.charAt(f),c="'/dMy".indexOf(l),a=c>=0;if(s<0&&!a&&(s=f),s>=0&&(a||f===h-1)&&(o.push(t.substring(s,a?f:f+1)),s=-1),c===0){for(e=f+1;e<h&&t.charAt(e)!=="'";e++);o.push(t.substring(f+1,e));f=e}else if(c===1)o.push(v.dateSeparator);else if(c>1){for(e=f+1;e<h&&t.charAt(e)===l;e++);o.push(wu(l,e-f,n,i,u));f=e-1}}return o.join("")}function h(){return Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig}function l(n,t){var i,r,u;if(n&&t&&(i=n.split("."),i&&i.length))for(r=0,u=i.length;r<u;r++)if(i[r]&&t.indexOf(i[r].toLowerCase())>-1)return!0;return!1}function wu(n,t,i,u,f){var o=r.dynamicProperties.cultureData,e,c,s,h;switch(n){case"d":t>3?e=o.dayNames[u?i.getUTCDay():i.getDay()]:t===3?e=o.abbreviatedDayNames[u?i.getUTCDay():i.getDay()]:(c=u?i.getUTCDate():i.getDate(),e=(c<10&&t>1?"0":"")+c);break;case"M":s=u?i.getUTCMonth():i.getMonth();t>3?(o.monthGenitiveNames&&!f&&(e=o.monthGenitiveNames[s]),e&&e.length||(e=o.monthNames[s])):t===3?(o.abbreviatedMonthGenitiveNames&&!f&&(e=o.abbreviatedMonthGenitiveNames[s]),e&&e.length||(e=o.abbreviatedMonthNames[s])):(++s,e=(s<10&&t>1?"0":"")+s);break;case"y":h=u?i.getUTCFullYear():i.getFullYear();t>2?e=h.toString():(h%=100,e=(h<10&&t>1?"0":"")+h);break;default:e=""}return e}f._clamp=st;f._copyObject=ht;f._createElement=ct;f._convertToBool=lt;f._distanceToWalkTime=at;f._deltaDecode=vt;f._disableSmoothing=yt;f._defineJSEventForDomEvent=pt;f._undefineJSEventForDomEvent=wt;f._isArray=e;f._allIndexesOf=bt;f._identityKey=kt;f._getFinite=dt;f._getFirstIndex=nt;f._getInsertionIndex=tt;f._orderedDelete=gt;f._orderedInsert=ni;f._formatString=ti;f._replaceValues=ii;f._getImageFromCss=ri;f._createAreaText=ui;f._readableTextFromArea=it;f._formatAreaString=rt;f._createLengthText=fi;f._readableTextFromDistance=ut;f._formatDistanceString=ft;f._formatLatLonString=ei;f._toFixed=oi;f._format2Digit=y;f._formatShortDateString=si;f._formatLongDateString=hi;f._formatAbbrevLongDateString=ci;f._formatYearMonthString=li;f._formatWeekMonthDayString=ai;f._formatDurationString=vi;f._formatTimeString=yi;f._formatUTCTimeString=pi;f._formatShortTimeString=wi;f._getTimeString=bi;f._getTime=ki;f._generateRandomKey=di;f._getUrlParam=o;f._isValidPointGeometry=p;f._isValidLineGeometry=w;f._isValidAreaGeometry=b;f._areArraysEqual=s;f._areGeometriesEqual=gi;f._areEntitiesEqual=nr;f._arePrimitivesEqual=tr;f._getStlVersion=ir;f._isPerformanceTest=rr;f._lowMem=ur;f._getPolygonId=fr;f._getDpr=er;f._isHighContrastMode=or;f._formatHexColorString=sr;f._calcLuminance=hr;f._isLargeMapShownOnSerp=cr;f._isSmallMapShownOnSerp=lr;f._isLocalOverlayShownOnSerp=ar;f._isRealEstateOverlayShownOnSerp=vr;f._isTravelOverlayShownOnSerp=yr;f._isMapsSDK=pr;f._isLocalOrRealEstateScenarioOverlayShownOnSerp=wr;f._getCssForTaskBackground=br;f._clearDisposables=kr;f._disposeEvents=dr;f._nullifyClass=gr;f._getTileSubDomain=nu;f._getIsSlideCardEnabled=tu;f._isFeatureEnabled=et;f._updateTfeUrlDomain=iu;f._overrideTasktypeBasedOnCategory=ru;f._isHouseCategory=k;f._isHotelsCategory=d;f._isAttractionCategory=uu;f._isRestaurantCategory=g;f._isZipCodeCategory=ot;f._isCoreConfigSettingEnabled=fu;f._getPrimitiveIds=eu;f._getHash=ou;f._renderAllPoiAndLabelsGL=su;f._disableRenderGL=hu;f._showOrHideOverlayMenu=cu;f._setFocusOnFirstMenuItem=lu;f._decodeHTML=au;f._isSearchPrototype=vu}(f||(f={}));var ct=function(){function n(n,t,i){this.position=n;this.value=t;this.tangentOutType=i}return n}(),lt=function(){function n(){this._CurveEpsilon=1192093e-13;this._keys=[]}return n.prototype.addKey=function(n){this._keys.push(n);this._tangentCalculated=!1},n.prototype.computeTangents=function(){if(!this._tangentCalculated){for(var n=0;n<this._keys.length;n++)this.computeTangent(n);this._tangentCalculated=!0}},n.prototype.computeTangent=function(n){var r,u,s,h;if(this._keys.length<=n||n<0)throw"Index out of range";var t=this._keys[n],c=t.tangentOutType,l=n>0?this._keys[n-1].tangentOutType:c,f=h=u=t.position,e,o=s=r=t.value,i;n>0&&(f=this._keys[n-1].position,o=this._keys[n-1].value);n+1<this._keys.length&&(u=this._keys[n+1].position,r=this._keys[n+1].value);l===1?(e=u-f,i=r-o,t.tangentInValue=Math.abs(i)<this._CurveEpsilon?0:i*Math.abs(f-h)/e):t.tangentInValue=l===0?s-o:0;c===1?(e=u-f,i=r-o,t.tangentOutValue=Math.abs(i)<this._CurveEpsilon?0:i*Math.abs(u-h)/e):t.tangentOutValue=c===0?r-s:0},n.prototype.evaluate=function(n){if(this._keys.length===0)return 0;if(this._keys.length===1)return this._keys[0].value;if(!this._tangentCalculated)throw"Curve tangents have not been precalculated.";if(this._lastValue&&this._lastValue.position===n)return this._lastValue.value;var i=this._keys[0],r=this._keys[this._keys.length-1],t;return t=n<i.position?i.value:r.position<n?r.value:0+this.hermite(n),this._lastValue={position:n,value:t},t},n.prototype.hasValueAt=function(n){return this._keys.length===0?!1:this._keys.length===1?this._keys[0].position===n:this._keys[0].position<=n&&n<=this._keys[this._keys.length-1].position},n.prototype.getHasValue=function(){return this._keys.length>0},n.prototype.hermite=function(n){var u,o,s;if(this._keys.length<2)throw"More than one value is required";var e=n,i=this._keys[0],t=null;for(u=1;u<this._keys.length;u++){if(t=this._keys[u],t.position>=n){o=i.position;s=t.position-o;e=0;s>1e-10&&(e=(n-o)/s);n=e;break}i=t}if(i.tangentOutType===2)return n>=1?t.value:i.value;var r=n*n,f=r*n,h=i.value,c=i.tangentOutValue,l=t.tangentInValue;return h*(2*f-3*r+1)+t.value*(-2*f+3*r)+c*(f-2*r+n)+l*(f-r)},n}(),kt=function(){function n(n,t){if(n instanceof Array)this._populateColorComponents(n);else switch(t){case 1:case 2:this._parseHex(n,t);break;case 0:this._parseRgba(n);break;case 3:this._unpackColor(n)}}return n.parse=function(t,i){var u,r=n._getColorFormat(t);return r!==undefined?(r===1&&i===2&&(r=2),u=new n(t,r)):u=n._parseViaBrowser(t),u},n.prototype.toRgba=function(){return this.alpha<1?"rgba("+this.red+","+this.green+","+this.blue+","+k.roundToInterval(this.alpha,.01)+")":"rgb("+this.red+","+this.green+","+this.blue+")"},n._getColorFormat=function(t){var i;return t=t||"",t[0]!=="#"||t.length!==7&&t.length!==9||isNaN(parseInt(t.slice(1),16))?t.match(n.rgbRegex)&&(i=0):i=1,i},n._parseViaBrowser=function(t){var u,i,r;return t&&(i=document.createElement("div"),r=document.body,i.style.display="none",i.style.color=t,i.style.color&&(r.appendChild(i),t=getComputedStyle(i).color,r.removeChild(i),t&&t.match(n.rgbRegex)&&(u=new n(t,0)))),u},n.prototype._parseHex=function(n,t){var r=parseInt(n.slice(1),16);n.length===9?t===2?this.alpha=(r>>24&255)/255:(this.alpha=(r&255)/255,r=r>>8):this.alpha=1;this.red=r>>16&255;this.green=r>>8&255;this.blue=r&255;i.assert(!isNaN(this.red),"red color is not as expected");i.assert(!isNaN(this.green),"green color is not as expected");i.assert(!isNaN(this.blue),"blue color is not as expected")},n.prototype._parseRgba=function(t){var i=t&&t.match&&t.match(n.rgbRegex);i&&i.length>4&&this._populateColorComponents(i.slice(1))},n.prototype._populateColorComponents=function(n){n&&n.length>=3&&(this.red=parseInt(n[0]),i.assert(!isNaN(this.red),"red color is not as expected"),this.green=parseInt(n[1]),i.assert(!isNaN(this.green),"green color is not as expected"),this.blue=parseInt(n[2]),i.assert(!isNaN(this.blue),"blue color is not as expected"),n.length>3&&n[3]!==undefined?(this.alpha=parseFloat(n[3]),i.assert(!isNaN(this.alpha),"alpha color is not as expected")):this.alpha=1)},n.prototype._unpackColor=function(n){var t=parseInt(n);this.red=t>>16&255;this.green=t>>8&255;this.blue=t&255;this.alpha=k.roundToInterval((t>>24&255)/255,.01)},n.transparent="rgba(255, 255, 255, 0.0)",n.white="rgb(255, 255, 255)",n.black="rgb(0, 0, 0)",n.rgbRegex=/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/,n}(),nu=function(){function n(n,t,i,r){this.x=n;this.y=t;this.z=i;this.w=r}return n}(),wi=function(){function n(){this._curveX=new lt;this._curveY=new lt;this._curveZ=new lt;this._curveW=new lt}return n.prototype.addKey=function(n,t,i,r,u,f){this._curveX.addKey(new ct(n,t,f));this._curveY.addKey(new ct(n,i,f));this._curveZ.addKey(new ct(n,r,f));this._curveW.addKey(new ct(n,u,f))},n.prototype.computeTangents=function(){this._curveX.computeTangents();this._curveY.computeTangents();this._curveZ.computeTangents();this._curveW.computeTangents()},n.prototype.evaluateCurve=function(n){return new nu(this._curveX.evaluate(n),this._curveY.evaluate(n),this._curveZ.evaluate(n),this._curveW.evaluate(n))},n}(),tu=function(n){function t(){return n.call(this)||this}return p(t,n),t.prototype.addKey=function(t,i,r,u,f,e){var l=i/255,h=r/255,c=u/255,p=f,a=0,y=0,v=0,o=Math.max(c,Math.max(l,h)),s=Math.min(c,Math.min(l,h));o===s?a=0:o===l&&h>=c?a=60*((h-c)/(o-s)):o===l&&h<c?a=60*((h-c)/(o-s))+360:o===h?a=60*((c-l)/(o-s))+120:o===c&&(a=60*((l-h)/(o-s))+240);v=.5*(o+s);o===s?y=0:v<=.5?y=(o-s)/(2*v):v>.5&&(y=(o-s)/(2-2*v));n.prototype.addKey.call(this,t,a/360,at.clamp(y,0,1),at.clamp(v,0,1),at.clamp(p,0,1),e)},t.prototype.evaluate=function(t){var i=n.prototype.evaluateCurve.call(this,t);return at.hslaTorgba(i.x,i.y,i.z,i.w)},t.prototype.evaluateHsla=function(t){return n.prototype.evaluateCurve.call(this,t)},t}(wi),at=function(){function n(){}return n.getComponent=function(n,t,i){return n<1/6?t+(i-t)*6*n:n<.5?i:n<2/3?t+(i-t)*6*(2/3-n):t},n.normalize=function(n){return n<0&&(n+=1),n>1&&(n-=1),n},n.clamp=function(n,t,i){return n<t?t:n>i?i:n},n.applyHslaTransform=function(t,i){var r=t.x+i.x;r>1&&(r-=1);var u=n.clamp(t.y+i.y,0,1),f=n.clamp(t.z+i.z,0,1),e=n.clamp(t.w+i.w,0,1);return{x:r,y:u,z:f,w:e}},n.hslaTorgba=function(t,i,r,u){var f=r<.5?r*(1+i):r+i-r*i;var e=2*r-f,o=n.getComponent(n.normalize(t+1/3),e,f),s=n.getComponent(n.normalize(t),e,f),h=n.getComponent(n.normalize(t-1/3),e,f);return new kt([n.clamp(Math.round(o*255),0,255),n.clamp(Math.round(s*255),0,255),n.clamp(Math.round(h*255),0,255),n.clamp(u,0,1)])},n.convertPackedTorgba=function(n){var t=new kt(n,3);return t.toRgba()},n}(),iu=function(){function n(n,t,i){this.start=n;this.end=t;this.value=i}return n}(),ru=function(){function n(){this._ranges=[]}return n.prototype.addRange=function(n,t,i){this._ranges.push(new iu(n,t,i))},n.prototype.evaluate=function(n){for(var i,t=0;t<this._ranges.length;t++)if(i=this._ranges[t],i.start<=n&&i.end>=n)return i.value;return null},n.prototype.hasValueAt=function(n){for(var i,t=0;t<this._ranges.length;t++)if(i=this._ranges[t],i.start<=n&&i.end>=n)return!0;return!1},n.prototype.getHasValue=function(){return this._ranges.length>0},n}(),bi=function(){function n(n,t,i,r,u,f){this._values=[n,t,i,r,u,f]}return n.prototype.invert=function(){var i=this._values,r=i[0],u=i[1],f=i[2],e=i[3],o=i[4],s=i[5],t=r*e-u*f;if(t===0)throw"Determinant is zero";return new n(e/t,-u/t,-f/t,r/t,(f*s-e*o)/t,(u*o-r*s)/t)},n.prototype.multiply=function(t){var i=this._values,r=i[0],u=i[1],f=i[2],e=i[3],v=i[4],y=i[5];i=t.getValues();var o=i[0],s=i[1],h=i[2],c=i[3],l=i[4],a=i[5];return new n(r*o+f*s,u*o+e*s,r*h+f*c,u*h+e*c,v+r*l+f*a,y+u*l+e*a)},n.prototype.transform=function(n){return new h(this.projectX(n.x,n.y),this.projectY(n.x,n.y))},n.prototype.projectX=function(n,t){var i=this._values;return n*i[0]+t*i[2]+i[4]},n.prototype.projectY=function(n,t){var i=this._values;return n*i[1]+t*i[3]+i[5]},n.prototype.scale=function(t,i){var r=this._values;return new n(r[0]*t,r[1]*i,r[2]*t,r[3]*i,r[4]*t,r[5]*i)},n.prototype.translate=function(t,i){var r=this._values;return new n(r[0],r[1],r[2],r[3],r[4]+t,r[5]+i)},n.prototype.rotate=function(t){if(t===0)return this;var i=this._values,r=Math.cos(t),u=Math.sin(t),f=i[0],e=i[2],o=i[4],s=f*r-i[1]*u,h=f*u+i[1]*r,c=e*r-i[3]*u,l=e*u+i[3]*r,a=o*r-i[5]*u,v=o*u+i[5]*r;return new n(s,h,c,l,a,v)},n.prototype.getValues=function(){var n=this._values;return[n[0],n[1],n[2],n[3],n[4],n[5]]},n.prototype.equals=function(n){var i=n&&n.getValues(),t;if(i&&i.length===6){for(t=0;t<6;t++)if(this._values[t]!==i[t])return!1;return!0}return!1},n.prototype.nearlyEquals=function(n,t){var r=n&&n.getValues(),i;if(r&&r.length===6){for(i=0;i<6;i++)if(Math.abs(this._values[i]-r[i])>t)return!1;return!0}return!1},n.prototype.getZoomDirection=function(){var n=this.getValues();return n[0]<.9999||n[3]<.9999?-1:n[0]>1.0001||n[3]>1.0001?1:0},n.identity=new n(1,0,0,1,0,0),n}(),it=function(){function n(n,i){i===void 0&&(i=!0);this.revision=0;this._allowDuplicates=i;this.changed=new t;n&&Array.prototype.push.apply(this,n)}return n.prototype._invokeChanged=function(n,t,i,r,u){this.revision++;this.changed&&this.changed.invoke({addedIndex:n,added:t,removedIndex:i,removed:r,reset:u===!0})},n.prototype.insert=function(n,t){this._allowDuplicates||this.indexOf(n)===-1?this.insertAll([n],t):(this.remove(n),this.insert(n,t))},n.prototype.insertAll=function(n,t){var r,i,u;if(n&&n.length){if((typeof t!="number"||t<0||t>=this.length)&&(t=this.length),r=[],this._allowDuplicates)r=n;else for(i=0;i<n.length;i++)this.indexOf(n[i])===-1&&n.indexOf(n[i])===i&&r.push(n[i]);r.length>0&&(u=[t,0],u=u.concat(r),Array.prototype.splice.apply(this,u),this._invokeChanged(t,r,null,null))}},n.prototype.remove=function(n){this.removeAt(this.indexOf(n))},n.prototype.removeAt=function(n,t){if(t===void 0&&(t=1),n>=0&&t>=1&&n+t<=this.length){var i=Array.prototype.splice.call(this,n,t);this._invokeChanged(null,null,n,i,this.length===0)}},n.prototype.clear=function(){var n=Array.prototype.splice.call(this,0,this.length);this._invokeChanged(null,null,0,n,!0)},n.prototype.indexOf=function(n,t){return t===void 0&&(t=0),Array.prototype.indexOf.call(this,n,t)},n.prototype.lastIndexOf=function(n,t){return t===void 0&&(t=this.length),Array.prototype.lastIndexOf.call(this,n,t)},n.prototype.slice=function(n,t){return n===void 0&&(n=0),t===void 0&&(t=this.length),Array.prototype.slice.call(this,n,t)},n.prototype.setValue=function(n,t){if(!(n<0)){var i=this[n];this[n]=t;this.length=Math.max(this.length,n+1);this._invokeChanged(n,[t],n,[i])}},n.prototype.find=function(n){for(var i,t=0;t<this.length;t++)if(i=this[t],n(i))return i;return null},n.prototype.dispose=function(){f._clearDisposables(this.slice());f._disposeEvents(this);this.clear()},n}();it.prototype.length=Array.prototype.length;var dt=function(){function n(n){function e(n,t){var i=u[n];u[n]=t;a.areEqual(i,t)||(r.revision++,f[n]&&f[n].call(r,i,t),r.changed&&r.changed.invoke(new vt(r,n,i,t)))}function o(t,o,s,h){function p(){return u[t]}function y(n){s&&(n=s(n,u[t]));e(t,n)}var c,v,l;i.assertNotNullOrEmpty(t,"name");o&&i.assertIsFunction(o,"onChanged");s&&i.assertIsFunction(s,"typeConverter");c=h&&h.defaultValue;v=h&&h.isPrivate?n:r;typeof c!="undefined"&&y(c);l=a.capitalizeProp(t);o&&(f[t]=o);r["get"+l]=p;v["set"+l]=y}function s(){function h(){return null}function c(){}var o=Object.keys(u),t,s,e,i;for(f={},t=0,s=o.length;t<s;t++)e=o[t],i=a.capitalizeProp(e),r["get"+i]=h,r["set"+i]=n["set"+i]=c,u[e]=null;r.changed&&r.changed.dispose()}var r=this,u,f;this.revision=0;n=n||this;this._privates=n;u={};this.changed=new t;f={};n.defineProperty=o;n.undefineProperties=s}return n.prototype.dispose=function(){this._privates&&this._privates.undefineProperties&&this._privates.undefineProperties();this._privates={}},n.fromObject=function(t){var f,r,i,u;if(t instanceof Array){for(f=new it,r=0;r<t.length;r++)f.insert(n.fromObject(t[r]));return f}if(!t||typeof t!="object"||t instanceof n)return t;u=new n;for(i in t)t.hasOwnProperty(i)&&(u.defineProperty(i),a.setValue(u,i,n.fromObject(t[i])));return u},n}(),vt=function(){function n(n,t,i,r){this.sender=n;this.name=t;this.oldValue=i;this.newValue=r}return n}(),ui=function(n){function i(r,u,f,e,o,s,h){s===void 0&&(s=!1);h===void 0&&(h="");var c=this,l={};return c=n.call(this,l)||this,c._internalId="UserLayer_"+i._id++,c._id=r?r:c._internalId,c.logWhenAddedOrRemoved=s,c.logId=h,c.isCritical=e,c._disposables=[],l.defineProperty("zIndex",null,null,{defaultValue:u||0}),l.defineProperty("visible",null,null,{defaultValue:typeof o=="boolean"?o:!0}),l.defineProperty("opacity",null,null,{defaultValue:typeof f=="number"?f:1}),l.defineProperty("renderTarget",null,null,{defaultValue:0}),l.defineProperty("iconOnlyLimit",null,null,{defaultValue:0}),l.defineProperty("highlighted"),l.defineProperty("templateSelector",null),c.defineProperty=l.defineProperty,c._disposables.push(c.primitiveTapped=new t,c.primitiveDoubleTapped=new t,c.primitiveHoverStarted=new t,c.primitiveHoverStopped=new t,c.primitiveMoveStarted=new t,c.primitiveMoveContinued=new t,c.primitiveMoveStopped=new t,c.primitiveManipulationStarted=new t,c.primitiveManipulationContinued=new t,c.primitiveManipulationStopped=new t,c.contextMenuInvoked=new t,c.primitivePointerPressed=new t,c.primitivePointerReleased=new t),c.setVisible(!0),c.overlayEvent=1,c}return p(i,n),i.prototype.getId=function(){return this._id},i.prototype.getFrameManager=function(){return this._frameManager},i.prototype.setFrameManager=function(n){this._frameManager=n;this._coreMap=n.getMap()},i.prototype.dispose=function(){this._coreMap&&(this._coreMap.getLayers().remove(this),this._coreMap=null);n.prototype.dispose.call(this);f._clearDisposables(this._disposables);this._frameManager=null;f._disposeEvents(this)},i._id=1,i}(dt),ki=function(){function n(t,i,r){var f,o,e,u;if(this._rect=t,this._rotation=i=i||0,this.corners=n._computeCorners(t,i),r)for(f=0,o=this.corners.length;f<o;f++)e=this.corners[f],e.x+=r.x,e.y+=r.y;this.bbox=c.computeBoundingBox(this.corners);u=[c.getVectorDifference2D(this.corners[1],this.corners[0]),c.getVectorDifference2D(this.corners[2],this.corners[1])];this._normals=[c.normalizeVector2D(new h(-u[0].y,u[0].x)),c.normalizeVector2D(new h(-u[1].y,u[1].x))];this._projections=[c.projectOntoAxis(this._normals[0],this.corners),c.projectOntoAxis(this._normals[1],this.corners)]}return n.prototype.intersects=function(n){return this.bbox.intersects(n.bbox)&&this._intersectsOneWay(n)&&n._intersectsOneWay(this)},n.prototype._intersectsOneWay=function(n){for(var i,r,t=0,u=this._normals.length;t<u;t++)if(i=this._projections[t],r=c.projectOntoAxis(this._normals[t],n.corners),i.min>r.max||i.max<r.min)return!1;return!0},n._computeCorners=function(n,t){var r=n.getCorners(),u,i,f;if(t!==0)for(u=bi.identity.rotate(t),i=0,f=r.length;i<f;i++)r[i]=u.transform(r[i]);return r},n}(),gt=function(){function n(n,t){this.minPoint=n;this.maxPoint=t}return n.empty=function(){return new n(null,null)},n.fromPoints=function(){for(var e,l,i,a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];var c=(f._isArray(arguments[0])?arguments[0]:arguments)||[],t=Number.MAX_VALUE,u=t,o=-t,s=-u;for(e=0,l=c.length;e<l;e++)(i=c[e],i)&&(t=Math.min(t,i.x),u=Math.min(u,i.y),o=Math.max(o,i.x),s=Math.max(s,i.y));return t===Number.MAX_VALUE?n.empty():new n(new h(t,u),new h(o,s))},n.fromSides=function(t,i,r,u){var f=Math.min(t,i),e=Math.max(t,i),o=Math.min(r,u),s=Math.max(r,u),c=new h(f,o),l=new h(e,s);return new n(c,l)},n.prototype.clone=function(){var t=this.minPoint&&this.minPoint.clone(),i=this.maxPoint&&this.maxPoint.clone();return new n(t,i)},n.prototype.equals=function(n,t){if(n){var i=this.isEmpty(),r=n.isEmpty();return i&&r?!0:i||r?!1:t>0?this.minPoint.equals(n.minPoint,t)&&this.maxPoint.equals(n.maxPoint,t):this.minPoint.equals(n.minPoint)&&this.maxPoint.equals(n.maxPoint)}return!1},n.prototype.getCorners=function(){i.assert(!this.isEmpty(),"Calling rect.corners on an empty rect is a coding error");var n=this.minPoint.x,t=this.maxPoint.x,r=this.minPoint.y,u=this.maxPoint.y;return[new h(n,r),new h(t,r),new h(t,u),new h(n,u)]},n.prototype.getSize=function(){return this.isEmpty()?new nt(0,0):new nt(this.maxPoint.x-this.minPoint.x,this.maxPoint.y-this.minPoint.y)},n.prototype.getCenter=function(){return this.isEmpty()?null:{x:(this.minPoint.x+this.maxPoint.x)/2,y:(this.minPoint.y+this.maxPoint.y)/2}},n.prototype.buffer=function(n,t){i.assert(!this.isEmpty(),"Calling rect.buffer on an empty rect is a coding error");this.minPoint.x=this.minPoint.x-n;this.minPoint.y=this.minPoint.y-t;this.maxPoint.x=this.maxPoint.x+n;this.maxPoint.y=this.maxPoint.y+t;var r;this.minPoint.x>this.maxPoint.x&&(r=this.minPoint.x,this.minPoint.x=this.maxPoint.x,this.maxPoint.x=r);this.minPoint.y>this.maxPoint.y&&(r=this.minPoint.y,this.minPoint.y=this.maxPoint.y,this.maxPoint.y=r)},n.prototype.intersect=function(n){return this.intersects(n)?(this.minPoint=new h(Math.max(this.minPoint.x,n.minPoint.x),Math.max(this.minPoint.y,n.minPoint.y)),this.maxPoint=new h(Math.min(this.maxPoint.x,n.maxPoint.x),Math.min(this.maxPoint.y,n.maxPoint.y))):this.minPoint=this.maxPoint=null,this},n.prototype.intersects=function(n){return!this.isEmpty()&&!n.isEmpty()&&this.minPoint.x<=n.maxPoint.x&&this.minPoint.y<=n.maxPoint.y&&this.maxPoint.x>=n.minPoint.x&&this.maxPoint.y>=n.minPoint.y},n.prototype.isEmpty=function(){return!this.minPoint||!this.maxPoint},n.prototype.isInside=function(n){return!this.isEmpty()&&!n.isEmpty()&&this.minPoint.x>=n.minPoint.x&&this.minPoint.y>=n.minPoint.y&&this.maxPoint.x<=n.maxPoint.x&&this.maxPoint.y<=n.maxPoint.y},n.prototype.pointInRect=function(n){return!this.isEmpty()&&n.x>=this.minPoint.x&&n.x<=this.maxPoint.x&&n.y>=this.minPoint.y&&n.y<=this.maxPoint.y},n.prototype.rotate=function(n){return i.assert(!this.isEmpty(),"Calling rect.rotate on an empty rect is a coding error"),new ki(this,n)},n.prototype.union=function(n){return n.isEmpty()||(this.isEmpty()?(this.minPoint=n.minPoint.clone(),this.maxPoint=n.maxPoint.clone()):(this.minPoint.x=Math.min(this.minPoint.x,n.minPoint.x),this.minPoint.y=Math.min(this.minPoint.y,n.minPoint.y),this.maxPoint.x=Math.max(this.maxPoint.x,n.maxPoint.x),this.maxPoint.y=Math.max(this.maxPoint.y,n.maxPoint.y))),this},n.prototype.unionPoint=function(n){return this.isEmpty()?(this.minPoint=n.clone(),this.maxPoint=n.clone()):(this.minPoint.x=Math.min(this.minPoint.x,n.x),this.minPoint.y=Math.min(this.minPoint.y,n.y),this.maxPoint.x=Math.max(this.maxPoint.x,n.x),this.maxPoint.y=Math.max(this.maxPoint.y,n.y)),this},n}(),c;(function(n){function t(n,t,i,r){var e=i-n,u,f;return e!==0?(u=(r-t)/(i-n),f=t-u*n,[u,f]):null}function i(t){return t*n.radiansPerDegree}function r(t){return t*n.degreesPerRadian}function u(t){while(t<0)t+=n.twoPI;while(t>=n.twoPI)t-=n.twoPI;return t}function f(n){return(360+n)%360}function e(t){return Math.log(t)/n.loge2}function o(n,t,i){var r=Math.cos(i),u=Math.sin(i);return new h(n*r-t*u,n*u+t*r)}function s(n,t){var i=Math.sin(n)*t,r=Math.cos(n)*t;return new h(i,r)}function c(n,t){var i=n*Math.cos(t),r=n*Math.sin(t);return new h(i,r)}function l(n){return Math.atan2(n.y,n.x)}function a(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function v(n){return Math.sqrt(n.x*n.x+n.y*n.y)}function y(n,t){var i=(n.x+t.x)/2,r=(n.y+t.y)/2;return new h(i,r)}function p(n,t){var i=n.x+t.x,r=n.y+t.y;return new h(i,r)}function w(n,t){var i=n.x-t.x,r=n.y-t.y;return new h(i,r)}function b(n,t){var i=t.x-n.x,r=t.y-n.y;return Math.sqrt(i*i+r*r)}function k(n,t){return t===0?n:t===n?0:n-Math.floor(n/t)*t}function d(n,t){return n.x*t.x+n.y*t.y}function g(t){var i=n.getMagnitudeOfVector2D(t),r=t.x,u=t.y;return i!==0&&(r/=i,u/=i),new h(r,u)}function nt(t,i){for(var r,u=Number.MAX_VALUE,f=-u,e=0,o=i.length;e<o;e++)r=n.dotProduct2D(t,i[e]),r<u&&(u=r),r>f&&(f=r);return{min:u,max:f}}function tt(n,t,i){if(i<=t)throw"invalid argument exception";for(var r=i-t;n<t;)n+=r;while(n>i)n-=r;return n}function it(t){return(t-1)/(n.MAX_ZOOM_LEVEL-1)}function rt(t){return t*(n.MAX_ZOOM_LEVEL-1)+1}function ut(n){var t,i,r;if(n&&n.length>0){var u=n[0].x,e=u,f=n[0].y,o=f;for(t=1;t<n.length;t++)i=n[t].x,r=n[t].y,i<u&&(u=i),i>e&&(e=i),r<f&&(f=r),r>o&&(o=r);return new gt(new h(u,f),new h(e,o))}return null}function ft(t,i,r){if(!t||!i||!r||h.pointsEqual(t,i)||h.pointsEqual(t,r))return NaN;var u=n.getAngleOfSegment2D(t,i),f=n.getAngleOfSegment2D(t,r);return f-u}function et(n,t,i,r){var f=i||180,e=r||360,u=Math.abs(n-t);return u>f&&(u=Math.abs(Math.min(n,t)+e-Math.max(n,t))),u}function ot(t,i){return n.getAngleDifference(t,i,Math.PI,n.twoPI)}function st(n,t,i){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))<i}function ht(n,t){var i,r,u;if(n&&t&&n[0].length===t.length){var e=n.length,o=t[0].length,f=new Array(e),s=t.length;for(i=0;i<e;i++)for(f[i]=new Array(o),r=0;r<o;r++)for(f[i][r]=0,u=0;u<s;u++)f[i][r]+=n[i][u]*t[u][r];return f}}function ct(n,t,i){var r,u;return n&&t&&i?(u=(i.y-n.y)*(t.x-n.x)-(t.y-n.y)*(i.x-n.x),r=u>0?1:u<0?2:0):r=-1,r}function lt(n,t,i,r){var u;if(n&&t&&i&&r){var f=t.y-n.y,e=n.x-t.x,o=r.y-i.y,s=i.x-r.x,c=f*s-o*e;if(c===0)u=null;else{var l=f*n.x+e*n.y,a=o*i.x+s*i.y,v=(s*l-e*a)/c,y=(f*a-o*l)/c;u=new h(v,y)}}else u=null;return u}function at(n){return new h(-n.y,n.x,n.z)}n.degreesPerRadian=180/Math.PI;n.radiansPerDegree=Math.PI/180;n.loge2=Math.log(2);n.twoPI=Math.PI*2;n.thirtyDegreesInRadians=Math.PI/6;n.MAX_ZOOM_LEVEL=23;n.zoomDeltaBetweenLods=1/(n.MAX_ZOOM_LEVEL-1);n.markupVisible=0;n.markupInvisible=255;n.trySolve=t;n.degreesToRadians=i;n.radiansToDegrees=r;n.normalizeRadian=u;n.normalizeDegrees=f;n.log2=e;n.rotatePoint=o;n.getPointFromAngleAndRadius=s;n.getVector2DFromMagnitudeAndDirection=c;n.getAngleOfVector2D=l;n.getAngleOfSegment2D=a;n.getMagnitudeOfVector2D=v;n.getMidpoint2D=y;n.getVectorSum2D=p;n.getVectorDifference2D=w;n.getEuclideanDistance2D=b;n.mod=k;n.dotProduct2D=d;n.normalizeVector2D=g;n.projectOntoAxis=nt;n.wrap=tt;n.calculateStyleScaleForLod=it;n.calculateZoomforStyleScale=rt;n.computeBoundingBox=ut;n.getAngleBetween=ft;n.getAngleDifference=et;n.getAngleDifferenceInRadians=ot;n.pointInCircle=st;n.matrixMultiply=ht;n.rotatingDirection=ct;n.intersect2D=lt;n.perpendicular2D=at})(c||(c={}));var k=function(){function n(){}return n.greatCircleDistance=function(t,i){var r=c.degreesToRadians(i.latitude),u=c.degreesToRadians(t.latitude),o=c.degreesToRadians(i.longitude),s=c.degreesToRadians(t.longitude),h=Math.abs(r-u),l=Math.abs(o-s),f=Math.sin(h/2),e=Math.sin(l/2),a=2*Math.asin(Math.sqrt(f*f+Math.cos(u)*Math.cos(r)*e*e));return n.earthRadiusMajorAxis*a},n.getMapLocationFromLocationHeadingAndDistance=function(t,i,r){if(!t||typeof i=="undefined"||i===null||typeof r=="undefined"||r===null)throw"location, headingInRadians and distanceInMeters must all be defined.";var u=r/n.earthRadiusMajorAxis,f=c.degreesToRadians(t.latitude),s=c.degreesToRadians(t.longitude),o=Math.asin(Math.sin(f)*Math.cos(u)+Math.cos(f)*Math.sin(u)*Math.cos(i)),h=s+Math.atan2(Math.sin(i)*Math.sin(u)*Math.cos(f),Math.cos(u)-Math.sin(f)*Math.sin(o));return new e(c.radiansToDegrees(o),e.normalizeLongitude(c.radiansToDegrees(h)))},n.isValidNumber=function(n){return typeof n=="number"&&isFinite(n)},n.isValidAltitudeReference=function(n){return n===-1||n===0},n.metersToDegrees=function(t){var i=t/n._metersPerMile,r=Math.PI/10800*i;return c.radiansToDegrees(r)},n.latitudeDegreesToMeters=function(n){return Math.sin(c.degreesToRadians(n))*this.earthRadiusMajorAxis},n.longitudeDegreesToMeters=function(n){return c.degreesToRadians(n)*this.earthRadiusMajorAxis},n.metersToLatitudeDegrees=function(n){return c.radiansToDegrees(Math.asin(n/this.earthRadiusMajorAxis))},n.metersToLongitudeDegrees=function(n){return c.radiansToDegrees(n/this.earthRadiusMajorAxis)},n.getAngleBetweenTwoLocations=function(n,t){return c.radiansToDegrees(c.normalizeRadian(Math.atan2(e.normalizeLongitude(t.longitude-n.longitude),t.latitude-n.latitude)))},n.roundToInterval=function(n,t){if(t){var i=1/t;n=Math.round(n*i)/i}return n},n.getMetersPerDegreeOfLatitude=function(n){var t=n*Math.PI/180;return 111132.92+-559.82*Math.cos(2*t)+1.175*Math.cos(4*t)+-.0023*Math.cos(6*t)},n.getMetersPerDegreeOfLongitude=function(n){var t=n*Math.PI/180;return 111412.84*Math.cos(t)+-93.5*Math.cos(3*t)+.118*Math.cos(5*t)},n.earthRadiusMajorAxis=6378137,n.earthRadiusMinorAxis=6356752.314245,n.earthCircumference=2*Math.PI*n.earthRadiusMajorAxis,n.metersPerLongtitudeDegree=111319.4908,n._metersPerMile=1852,n}(),e=function(){function n(n,t,i,r){var u=typeof n!="number"?parseFloat(n):n,f;if(isNaN(u)||u<-90||u>90)throw Error("Invalid latitude");if(this.latitude=u,f=typeof t!="number"?parseFloat(t):t,isNaN(f))throw Error("Invalid longitude");this.longitude=f;this.altitude=i||0;this.altitudeReference=k.isValidAltitudeReference(r)?r:-1}return n.prototype.clone=function(){return n.cloneFrom(this)},n.cloneFrom=function(t){return new n(t.latitude,t.longitude,t.altitude,t.altitudeReference)},n.prototype.toString=function(){return"[MapLocation ("+this.latitude+", "+this.longitude+")]"},n.normalizeLongitude=function(n){return n<-180||n>180?n-Math.floor((n+180)/360)*360:n},n.areEqual=function(n,t,i,r){return r=r||0,n&&t&&Math.abs(n.latitude-t.latitude)<=r&&Math.abs(n.longitude-t.longitude)<=r&&(i||n.altitudeReference===-1&&t.altitudeReference===-1||n.altitudeReference===t.altitudeReference&&Math.abs(n.altitude-t.altitude)<=r)},n.parseLatLong=function(t){var i,r,u;return t&&(i=t.split(","),i.length===2&&(r=parseFloat(i[0]),u=parseFloat(i[1]),isFinite(r)&&isFinite(u)))?new n(r,u):null},n}(),di=function(){function i(i,r){r===void 0&&(r=1e3);this._interval=r;this._elements=i;this._window=n(window);this.resize=new t;this.startMonitoring()}return i.prototype.getSize=function(){var n=this._elements[0];return new nt(n.offsetWidth,n.offsetHeight)},i.prototype.getSizes=function(){var n=[];return this._elements.for_each(function(t){return n.push(new nt(t.offsetWidth,t.offsetHeight))}),n},i.prototype.startMonitoring=function(n){var t=this;n&&(this._lastSizes=this.getSizes());this._pollSizeHandler||(this._pollSizeHandler=function(){return t.pollSize()},!this._intervalId&&this._interval>0&&(this._intervalId=Microsoft.Maps.setInterval(this._pollSizeHandler,this._interval)),this._window.add_event("resize",this._pollSizeHandler))},i.prototype.stopMonitoring=function(){this._pollSizeHandler&&(this._window.remove_event("resize",this._pollSizeHandler),this._pollSizeHandler=null);this._intervalId&&(window.clearInterval(this._intervalId),this._intervalId=null)},i.prototype.dispose=function(){this.stopMonitoring();this._elements&&this._elements.clear();this._window&&this._window.clear()},i.prototype.pollSize=function(){var i=this._lastSizes,t=this.getSizes(),r=!1,n,u;if(i&&i.length==t.length){for(n=0,u=i.length;n<u;n++)if(i[n].width!==t[n].width&&t[n].width>0||i[n].height!==t[n].height&&t[n].height>0){r=!0;break}}else r=!0;r&&(this._lastSizes=t,this.resize.invoke(t))},i}(),fi=function(){function n(n){this._activator=n}return n.prototype.getObjectAsync=function(n){var t=this;this._isObjectLoaded?n(this._object):this._workCallbacks?this._workCallbacks.push(n):(this._workCallbacks=[n],this._activator(function(n){return t._onObjectLoaded(n)}))},n.prototype._onObjectLoaded=function(n){this._object=n;for(var t=0;t<this._workCallbacks.length;t++)this._workCallbacks[t](n);this._activator=null;this._workCallbacks=null;this._isObjectLoaded=!0},n}(),uu=function(){function n(){this._logger=u.logger}return n.prototype.logObject=function(n,t,i){this._logger.logObject(n,t,i)},n.prototype.flush=function(){this._logger.flush()},n.prototype.clear=function(){this._logger.clear()},n}(),fu=function(){function n(n){this.duration=n}return n.prototype.interpolate=function(n,t,r){var o=this._lerp(n.cameraLocation.latitude,t.cameraLocation.latitude,r),s=this._lerp(n.cameraLocation.longitude,t.cameraLocation.longitude,r),c=this._lerp(n.cameraLocation.altitude,t.cameraLocation.altitude,r),u=n.heading,f=t.heading,h;return Math.abs(f-u)>180&&(f<u?f+=360:u+=360),i.log(null,"Interpolate to latitude: {0}, longitude: {1}",o.toString(),s.toString()),h=this._lerp(u,f,r),new y(new e(o,s,c,t.cameraLocation.altitudeReference),h)},n.prototype._lerp=function(n,t,i){return(t-n)*i+n},n.defaultAnimation=new n(300),n}(),eu=function(){function n(n){var i=this;this._userLayerZIndexChangedEventHandlers={};this.revision=0;this.length=0;this.changed=new t;this.layerChanged=new t;this._userLayers=n.getLayers();this._userLayersChangeHandler=this._userLayers.changed.add(function(n){return i._onLayersChanged(n,!0)});this.setBaseLayers(n.getBaseLayers())}return n.prototype.hasUserLayers=function(){return this._userLayers.length>=1},n.prototype.isBaseLayer=function(n){return this._baseLayers&&this._baseLayers.indexOf(n)!==-1},n.prototype.setBaseLayers=function(n){var t=this;this._baseLayersChangeHandler&&this._baseLayersChangeHandler.dispose();this._baseLayers=n;this._onLayersChanged({reset:!0});this._baseLayersChangeHandler=this._baseLayers&&this._baseLayers.changed.add(function(n){return t._onLayersChanged(n,!1)})},n.prototype.dispose=function(){this._baseLayersChangeHandler&&this._baseLayersChangeHandler.dispose();this._userLayerZIndexChangedEventHandlers&&this._userLayersChangeHandler.dispose();f._clearDisposables(this._userLayerZIndexChangedEventHandlers);f._disposeEvents(this);f._nullifyClass(this)},n.prototype._onLayersChanged=function(n,t){var h=this,e=t&&this._baseLayers?this._baseLayers.length:0,f,r,u,o,s;if(n.reset){if(Array.prototype.splice.call(this,0,this.length),this._baseLayers)for(r=0,u=this._baseLayers.length;r<u;r++)Array.prototype.push.call(this,this._baseLayers[r]);for(r=0,u=this._userLayers.length;r<u;r++)Array.prototype.push.call(this,this._userLayers[r]);this._invokeChanged(0,null,0,null,!0)}else{if(n.removed){if(t)for(r=0,u=n.removed.length;r<u;r++)f=n.removed[r],o=this._userLayerZIndexChangedEventHandlers[f.getId()],o&&(o.dispose(),o=null,delete this._userLayerZIndexChangedEventHandlers[f.getId()]);Array.prototype.splice.call(this,e+n.removedIndex,n.removed.length);this._invokeChanged(0,null,e+n.removedIndex,n.removed)}if(n.added){if(t)for(r=0,u=n.added.length;r<u;r++)f=n.added[r],this._userLayerZIndexChangedEventHandlers[f.getId()]=f.changed.add(function(n){h._onUserLayerChanged(n)});s=[e+n.addedIndex,0];s.push.apply(s,n.added);Array.prototype.splice.apply(this,s);this._invokeChanged(e+n.addedIndex,n.added)}}t&&i.logLayersChanged(n)},n.prototype._onUserLayerChanged=function(n){var t=n.name;(t==="zIndex"||t==="opacity"||t==="visible"||t==="iconOnlyLimit"||t==="highlighted")&&(this.revision++,this.layerChanged.invoke(n.sender))},n.prototype._invokeChanged=function(n,t,i,r,u){this.revision++;this.changed.invoke({addedIndex:n,added:t,removedIndex:i,removed:r,reset:u===!0})},n}(),ou=function(){function n(n,t){this.view=n;this.cancel=!1;this.cause=t}return n}(),gi=function(){function n(){this._sets=[]}return n.prototype.addSet=function(n){this._sets.push(n)},n.prototype.getSets=function(){return this._sets},n.prototype.getPrimitives=function(){var n,t;if(!this._allPrimitives)for(this._allPrimitives=[],n=0;n<this._sets.length;n++)t=this._sets[n].getPrimitives(),this._allPrimitives=Array.prototype.concat.apply(this._allPrimitives,t);return this._allPrimitives},n.prototype.dispose=function(){this._sets=[];this._allPrimitives=[]},n}(),nr=function(){function n(n,t,r){i.assertNotNull(n,"frame");i.assertNotNull(t,"layer");i.assertNotNull(r,"primitiveSet");this.frame=n;this.layer=t;this._unclippedPrimitiveSet=r}return n.prototype.getUnclippedPrimitiveSet=function(){return this._unclippedPrimitiveSet},n.prototype.getPrimitives=function(n,t){var i;if(n===1)return t?(this._exactlyScreenSpaceClippedPrimitives||(i=this._unclippedPrimitiveSet.getPrimitives(),this._exactlyScreenSpaceClippedPrimitives=this.frame.viewport?tr.clip(this._getScreenSpacePrimitives(i),this.frame.viewport,1):i),this._exactlyScreenSpaceClippedPrimitives):(this._exactlyWorldSpaceClippedPrimitives||(i=this._unclippedPrimitiveSet.getPrimitives(),this._exactlyWorldSpaceClippedPrimitives=this.frame.viewport?tr.clip(this._getWorldSpacePrimitives(i),this.frame.viewport,1):i),this._exactlyWorldSpaceClippedPrimitives);if(n===2)return this._unclippedPrimitiveSet.getPrimitives();throw"Unsupported clippingMode";},n.prototype.dispose=function(){this.frame=null;this.layer=null;this._unclippedPrimitiveSet&&this._unclippedPrimitiveSet.dispose();this._exactlyScreenSpaceClippedPrimitives=[];this._exactlyWorldSpaceClippedPrimitives=[]},n.prototype._getScreenSpacePrimitives=function(n){var u=[],i,t,r,f;if(this.layer.getRenderTarget()===1)return n;if(this.layer.getRenderTarget()===2)for(i=0;i<n.length;i++)t=n[i],t.geometryType===1||t.geometryType===0?u.push(t):t.entity&&(r=Microsoft.Maps.Internal._EntityHelper,f=r&&r.getDisplayName(t.entity),(!r||f)&&u.push(t));return u},n.prototype._getWorldSpacePrimitives=function(n){var u=this.layer.getRenderTarget(),i,t,r;if(u===1)return[];for(i=[],t=0;t<n.length;t++)r=n[t],(u===0||r.geometryType!==1)&&i.push(r);return i},n}(),tr=function(){function n(){}return n.clip=function(t,r,u){switch(u){case 1:t=n._clipExact(t,r);break;case 2:t=t;break;default:i.assert(!1,"Invalid ClippingMode")}return t},n._clipExact=function(n,t){for(var l=[],a={},f=b.fromRegionId(t).splitByInternationalDateLine(),o=[],s=[],h=[],c=[],i,e,r,u=0;u<f.length;u++)o.push(f[u].getNorth()),s.push(f[u].getSouth()),h.push(f[u].getEast()),c.push(f[u].getWest());for(u=0;u<n.length;++u)if(i=n[u],i.crs&&i.geometry){if(e=a[i.crs.id],!e){for(e=[],r=0;r<f.length;r++){var y=i.crs.projectToY(o[r],c[r]),p=i.crs.projectToY(s[r],h[r]),w=i.crs.projectToX(o[r],c[r]),k=i.crs.projectToX(s[r],h[r]);e.push(gt.fromSides(w,k,y,p))}a[i.crs.id]=e}if(i.geometry.bounds&&i.geometry.bounds.length>3){var d=i.geometry.bounds[0],g=i.geometry.bounds[1],nt=i.geometry.bounds[2],tt=i.geometry.bounds[3],it=gt.fromSides(tt,g,d,nt),v=!1;for(r=0;r<f.length;r++)if(it.intersects(e[r])){v=!0;break}v&&l.push(i)}}return l},n}(),su=function(){function n(n,t,r){i.assertNotNull(n,"id");i.assertNotNull(t,"primitives");this._id=n;this._primitives=t;r&&(this._revisions=this._primitives.map(function(n){return n.revision}))}return n.prototype.getId=function(){return this._id},n.prototype.getPrimitives=function(){return this._primitives},n.prototype.getRevisions=function(){return this._revisions},n}(),hu=function(){function n(n,r,u){i.assertNotNull(n,"layer");i.assertNotNull(u,"frame");this._layer=n;this._isBaseLayer=r;this._frame=u;this._state=1;this._compositeSet=new gi;this.completed=new t;this.cancelled=new t;this.failed=new t}return n.prototype.getLayer=function(){return this._layer},n.prototype.getFrame=function(){return this._frame},n.prototype.hasCompleted=function(){return this._state===3},n.prototype.hasFailed=function(){return this._state===5},n.prototype.getCompositeSet=function(){if(this._state!==3)throw"The 'getCompositeSet' may not be called until the 'completed' event is raised.";return this._compositeSet},n.prototype.beginLoad=function(){var t=this,n;if(this._state!==1)throw"The 'beginLoad' method has already been called on this object.";this._state=2;n=this._layer.getDataSource();n?this._loadOnDataSourceAvailability(n):this._layerChangeHandler=this._layer.changed.add(function(n){n.name==="dataSource"&&(t._layerChangeHandler.dispose(),t._loadOnDataSourceAvailability(n.newValue))})},n.prototype.cancelLoad=function(){this._state=4;this._cancelOutstandingRequests();this.cancelled.invoke()},n.prototype.dispose=function(){this._layer=null;this._frame=null;this._requestRegionIds=[];this._layerChangeHandler&&this._layerChangeHandler.dispose();this._compositeSet.dispose();this.completed.dispose();this.cancelled.dispose();this.failed.dispose()},n.prototype._loadOnDataSourceAvailability=function(t){var i,r,u,e,o,f;if(this._state!==4)for(i=this._frame.viewport,r=b.fromRegionId(i),t.spatialIndex?(u=i.crs,u.getScale?(e=u.getScale(i),this._requestRegionIds=t.spatialIndex.getRegionsInBounds(r,e)):(o=Math.max(n._minGroundResolution,u.getGroundResolution(i)),this._requestRegionIds=t.spatialIndex.getRegions(r,o))):this._requestRegionIds=[r],this._pendingSetCount=this._requestRegionIds.length,f=0;f<this._requestRegionIds.length;f++)this._requestPrimitives(this._requestRegionIds[f],t)},n.prototype._requestPrimitives=function(t,r){var o=this,e,f;i.assertNotNull(this.getFrame().view,"view");e=l.fromLocation(this.getFrame().view.cameraLocation,!0);try{r.getPrimitives(t,function(n){return o._onDataSourceResponse(t,n)},n._dataSourceRequestorId,e)}catch(s){f=u.logger;f&&f.logCriticalError(s,null,!0,!0);this._onDataSourceResponse(t,{primitives:[],requestFailed:!1})}},n.prototype._getSetId=function(n){var t=this._layer.getDataSource(),i=t.getDataUniquenessKey;return i?this._layer.getId()+"_"+i.call(t,n):this._layer.getId()+"_DV"+this._layer.dataVersion},n.prototype._cancelOutstandingRequests=function(){var i=this._layer.getDataSource(),r=this._requestRegionIds,t,u;if(r&&i&&i.cancelPrimitivesRequest)for(t=0;t<r.length;t++)u=r[t],i.cancelPrimitivesRequest(u,n._dataSourceRequestorId)},n.prototype._onDataSourceResponse=function(n,t){var f,i,r,e,u,s,o;if(this._state===2){if(t){if(f=this._getSetId(n),i=t.primitives||[],this._isBaseLayer)for(r=0,e=i.length;r<e;r++)u=i[r],s=u.entity,u.layer=this._layer;o=new su(f,i,!this._layer.getDataSource().getDataUniquenessKey);this._compositeSet.addSet(o);!t.requestFailed||t.requestAborted||this._isBaseLayer||(this._cancelOutstandingRequests(),this._state=5,this.failed.invoke())}this._pendingSetCount--;this._pendingSetCount===0&&(this._state=3,this.completed.invoke())}},n._dataSourceRequestorId="FrameManager",n._minGroundResolution=.01,n}(),ir=function(){function n(n,i,r){var u=this,e,f;this._map=n;this._layer=i;this._isBaseLayer=r;this._latestLayerFrameData=this._getFrameZeroData();this._disposables=[];e=i.getDataSource();f={layerId:i?i.getId():null};e&&e.invalidated&&this._disposables.push(i.getDataSource().invalidated.add(function(n){f.entityIds=n&&n.entityIds;u._onLayerInvalidated(f)}));this._disposables.push(i.changed.add(function(n){(n.name==="dataSource"&&n.oldValue!==undefined||n.name==="visible")&&(n.newValue&&n.newValue.invalidated&&u._disposables.push(n.newValue.invalidated.add(function(){return u._onLayerInvalidated(f)})),u._onLayerInvalidated(f))}));this._disposables.push(this._map.viewChanging.add(function(){u._isViewChanging||u._cancelPendingRequests();u._isViewChanging=!0}));this._disposables.push(this._map.viewChanged.add(function(){return u._isViewChanging=!1}));this.dataLoaded=new t;this.dataLoadFailed=new t;this.layerInvalidated=new t}return n.prototype.setFrame=function(n){var t=this,i;this._map.getMode()&&(this._lastViewChangeFrameNumber!==n.lastViewChangeFrameNumber||this._cachedDataVersion!==this._layer.dataVersion?(this._lastViewChangeFrameNumber=n.lastViewChangeFrameNumber,this._layer.dataVersion++,!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad(),this._currentFrame=n,this._currentDataLoaderCompletedHandler&&this._currentDataLoaderCompletedHandler.dispose(),this._currentDataLoaderFailedHandler&&this._currentDataLoaderFailedHandler.dispose(),this._currentDataLoader&&this._currentDataLoader.dispose(),this._currentDataLoader=new hu(this._layer,this._isBaseLayer,n),this._currentDataLoaderCompletedHandler=this._currentDataLoader.completed.addOne(function(){return t._onDataLoaderCompleted()}),this._currentDataLoaderFailedHandler=this._currentDataLoader.failed.addOne(function(){return t._onDataLoaderFailed()}),this._currentDataLoader.beginLoad()):(this._latestLayerFrameData.frame=n,i={frame:n},this.dataLoaded.invoke(i)))},n.prototype.getLatestFrameData=function(){return this._latestLayerFrameData},n.prototype._getFrameZeroData=function(){return new nr(ni.frameZero,this._layer,new gi)},n.prototype.dispose=function(){f._clearDisposables(this._disposables);!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad();this._currentDataLoaderCompletedHandler&&this._currentDataLoaderCompletedHandler.dispose();this._currentDataLoaderFailedHandler&&this._currentDataLoaderFailedHandler.dispose();this._currentDataLoader&&this._currentDataLoader.dispose();this._latestLayerFrameData&&this._latestLayerFrameData.dispose()},n.prototype._onDataLoaderCompleted=function(){var i=this._currentDataLoader.getFrame().frameNumber,n=this._currentDataLoader.getCompositeSet(),t;(this._cachedDataVersion=this._layer.dataVersion,i===this._currentFrame.frameNumber&&n)&&(this._latestLayerFrameData=new nr(this._currentFrame,this._layer,n),t={frame:this._latestLayerFrameData.frame},this.dataLoaded.invoke(t))},n.prototype._onDataLoaderFailed=function(){var i=this._currentDataLoader.getFrame().frameNumber,n=this._currentDataLoader.getFrame(),t={frame:n,layer:this._layer,reason:2,errorMessage:"Failed to get primitives for layer '"+this._layer.getId()+"'"};this.dataLoadFailed.invoke(t)},n.prototype._onLayerInvalidated=function(n){var t=this;this._layer.dataVersion++;Microsoft.Maps.setTimeout(function(){t._isViewChanging||t.layerInvalidated.invoke(n)},0)},n.prototype._cancelPendingRequests=function(){!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad()},n}(),rr=function(){function n(n,i,r){var u=this,f;this._map=n;this._layer=i;this._disposables=[];i instanceof ft?this._dataMonitor=i:(this._dataMonitor=new ir(n,i,r),this._disposables.push(this._dataMonitor));this._frame=ni.frameZero;this._disposables.push(n.changed.add(function(n){return u._onMapChanged(n)}));f=n.getMode();f&&(this._modeFrameRenderedHandler=f.onFrameRendered.add(function(n){return u._onModeFrameRendered(n)}),this._modeFrameFailedHandler=f.onFrameFailed&&f.onFrameFailed.add(function(n){return u._onModeFrameFailed(n)}));i instanceof ft?i.crsReady.add(function(n){return u._onDataMonitorDataLoaded(n)}):(this._disposables.push(this._dataMonitor.dataLoaded.add(function(n){return u._onDataMonitorDataLoaded(n)})),this._disposables.push(this._dataMonitor.dataLoadFailed.add(function(n){return u._onDataMonitorDataLoadFailed(n)})));this._disposables.push(this._dataMonitor.layerInvalidated.add(function(n){return u._onDataMonitorLayerInvalidated(n)}));r&&n.getConfig().clickBasemapPrimitives&&this._disposables.push(i.primitiveHoverStarted.add(function(n){return u._onPrimitiveHoverStarted(n)}),i.primitiveHoverStopped.add(function(n){return u._onPrimitiveHoverStopped(n)}),i.primitiveTapped.add(function(n){return u._onPrimitiveTapped(n)}));this.frameSet=new t;this.dataLoaded=new t;this.primitivesRendered=new t;this.labelsRendered=new t;this.frameRendered=new t;this.frameFailed=new t;this.layerInvalidated=new t}return n.prototype.getMap=function(){return this._map},n.prototype.getLayer=function(){return this._layer},n.prototype.getFrame=function(){return{frameNumber:this._frame.frameNumber,purpose:this._frame.purpose,view:this._frame.view,viewport:this._frame.viewport,lastViewChangeFrameNumber:this._frame.lastViewChangeFrameNumber,cause:this._frame.cause,causeEntityIds:this._frame.causeEntityIds,causeLayerIds:this._frame.causeLayerIds}},n.prototype.isCurrent=function(n){return n.frameNumber===this._frame.frameNumber},n.prototype.getFrameData=function(){return this._dataMonitor instanceof ir?this._dataMonitor.getLatestFrameData():null},n.prototype.setFrame=function(n){this._frame=n;this._loadingDataState=1;this._renderingPrimitivesState=1;this._renderingLabelsState=1;this._isFrameComplete=!1;this._hasFrameFailed=!1;this._dataMonitor.setFrame(n,this._map)},n.prototype.completeDataLoadingPhase=function(n){this.isCurrent(n)&&(i.assert(this._loadingDataState===1,"loadingDataState("+this._loadingDataState+"): Should be in 'awaiting' state."),this._loadingDataState=2,this._invokePendingEvents())},n.prototype.completePrimitiveRenderingPhase=function(n){this.isCurrent(n)&&(this._renderingPrimitivesState===1&&(this._renderingPrimitivesState=2),this._invokePendingEvents())},n.prototype.completeLabelRenderingPhase=function(n){this.isCurrent(n)&&this._renderingLabelsState===1&&(this._renderingLabelsState=2,this._invokePendingEvents())},n.prototype.failFrame=function(n,t,i){this.isCurrent(n)&&(this.frameFailed.invoke({frame:this.getFrame(),layer:this._layer,reason:t,errorMessage:i}),this._hasFrameFailed=!0)},n.prototype.dispose=function(){this._modeFrameRenderedHandler&&this._modeFrameRenderedHandler.dispose();this._modeFrameFailedHandler&&this._modeFrameFailedHandler.dispose();for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose()},n.prototype._invokePendingEvents=function(){this._hasFrameFailed||(this._loadingDataState===2?(this.dataLoaded.invoke({frame:this._frame,layer:this._layer}),this._loadingDataState=3,this._invokePendingEvents()):this._loadingDataState===3&&this._renderingPrimitivesState===2?(this._renderingPrimitivesState=3,this.primitivesRendered.invoke({frame:this._frame,layer:this._layer}),this._invokePendingEvents()):this._loadingDataState===3&&this._renderingLabelsState===2&&(this.labelsRendered.invoke({frame:this._frame,layer:this._layer}),this._renderingLabelsState=3,this._invokePendingEvents()),this._loadingDataState!==3||this._renderingPrimitivesState!==3||this._renderingLabelsState!==3||this._isFrameComplete||(this.frameRendered.invoke({frame:this._frame,layer:this._layer}),this._isFrameComplete=!0))},n.prototype._onMapChanged=function(n){var i=this,t;n.name==="mode"&&(this._modeFrameRenderedHandler&&this._modeFrameRenderedHandler.dispose(),this._modeFrameFailedHandler&&this._modeFrameFailedHandler.dispose(),t=n.newValue,this._modeFrameRenderedHandler=t.onFrameRendered.add(function(n){return i._onModeFrameRendered(n)}),this._modeFrameFailedHandler=t.onFrameFailed&&t.onFrameFailed.add(function(n){return i._onModeFrameFailed(n)}))},n.prototype._onModeFrameRendered=function(n){this.completePrimitiveRenderingPhase(n.frame)},n.prototype._onModeFrameFailed=function(n){this.failFrame(n.frame,n.reason,n.errorMessage)},n.prototype._onDataMonitorDataLoaded=function(n){this.completeDataLoadingPhase(n.frame)},n.prototype._onDataMonitorDataLoadFailed=function(n){this.failFrame(n.frame,n.reason,n.errorMessage)},n.prototype._onDataMonitorLayerInvalidated=function(n){this.layerInvalidated.invoke(n)},n.prototype._setPrimitiveViewState=function(n,t){var i=n.entity;n.viewState=t;i&&i.changed&&i.changed.invoke()},n.prototype._onPrimitiveHoverStarted=function(n){var t=n.primitive;t&&t.viewState!==2&&t.viewState!==3&&this._setPrimitiveViewState(t,1)},n.prototype._onPrimitiveHoverStopped=function(n){var t=n.primitive;t&&t.viewState===1&&this._setPrimitiveViewState(t,0)},n.prototype._onPrimitiveTapped=function(n){var r=n.primitive,t=r&&r.entity,f=u.GlobalDataEventHandler,o=u.DataHandlerKeys,s=u.TaskTypes,i,e;f&&t&&t.id&&(i=n&&n.location,e=i?[i.latitude,i.longitude]:null,f.invokeHandler(o.taskDataHandlerKey,{type:s.polygonEntityDetailsTask,state:{entryPoint:"BasemapPrimitive",id:"vdpid:"+t.id,taskTitle:t.name,point:e}}))},n}(),ei=function(){function n(){this._goal=0;this._count=0}return n.prototype.getGoal=function(){return this._goal},n.prototype.setGoal=function(n){this._goal=n},n.prototype.getCount=function(){return this._count},n.prototype.resetCount=function(){this._count=0},n.prototype.incrementCount=function(){this._count++},n.prototype.hasReachedGoal=function(){return this._count>=this._goal},n}(),cu=function(){function n(){this._dataLoadedGoalCounter=new ei;this._primitivesRenderedGoalCounter=new ei;this._labelsRenderedGoalCounter=new ei}return n.prototype.setLayerCount=function(n){this._dataLoadedGoalCounter.setGoal(n);this._primitivesRenderedGoalCounter.setGoal(n);this._labelsRenderedGoalCounter.setGoal(n)},n.prototype.resetEventCounts=function(){this._dataLoadedGoalCounter.resetCount();this._primitivesRenderedGoalCounter.resetCount();this._labelsRenderedGoalCounter.resetCount()},n.prototype.incrementDataLoadedCount=function(){this._dataLoadedGoalCounter.incrementCount()},n.prototype.incrementPrimitivesRenderedCount=function(){this._primitivesRenderedGoalCounter.incrementCount()},n.prototype.incrementLabelsRenderedCount=function(){this._labelsRenderedGoalCounter.incrementCount()},n.prototype.haveAllLayersLoadedData=function(){return this._dataLoadedGoalCounter.hasReachedGoal()},n.prototype.haveAllLayersRenderedPrimitives=function(){return this._primitivesRenderedGoalCounter.hasReachedGoal()},n.prototype.haveAllLayersRenderedLabels=function(){return this._labelsRenderedGoalCounter.hasReachedGoal()},n.prototype.haveAllLayersCompleted=function(){return this.haveAllLayersLoadedData()&&this.haveAllLayersRenderedPrimitives()&&this.haveAllLayersRenderedLabels()},n}(),ur=function(){function n(n,t){this.frame=n;this._layerData=t}return n.prototype.getLayerFrameData=function(){return this._layerData},n.prototype.getLayerFrameDataByLayer=function(n){for(var t=0;t<this._layerData.length;t++)if(this._layerData[t].layer===n)return this._layerData[t];return null},n.prototype.getPrimitives=function(n,t){return t?(this._allScreenSpacePrimitives||(this._allScreenSpacePrimitives=this._getFilteredPrimitives(n,t)),this._allScreenSpacePrimitives):(this._allWorldSpacePrimitives||(this._allWorldSpacePrimitives=this._getFilteredPrimitives(n,t)),this._allWorldSpacePrimitives)},n.prototype._getFilteredPrimitives=function(n,t){for(var i,u=[],e=this._layerData.length,r=0;r<e;r++){var o=this._layerData[r],f=o.getPrimitives(n,t),s=f.length;for(i=0;i<s;i++)u.push(f[i])}return u},n}(),ni=function(){function n(n,i){var r=this;this._map=n;this._allLayers=i;this._currentFrameNumber=this._lastViewChangeFrameNumber=0;this._currentFramePurpose=2;this._currentFrameView=null;this._currentFrameViewport=null;this._disposables=[];this._layerFrameManagers=[];this._layerFrameManagersDisposables=[];this._hiddenLayers=[];this._hiddenLayersDisposables=[];this._frameEventAggregator=new cu;this._layerInfoDictionary={};this._dataPendingLayersId={};this._disposables.push(n.changed.add(function(n){return r._onMapChanged(n)}));this._disposables.push(i.changed.add(function(n){return r._onMapLayersCollectionChanged(n)}));this._disposables.push(n.getAllLayers().layerChanged.add(function(n){var t=n?n.getId():null;r._setFrame(4,[t],null,2)}));n.getConfig().disableHachHackSetFrame?this._disposables.push(n.viewChanged.add(function(n){return r._onMapViewChanged(n)})):(this._disposables.push(n.mapPanStopped.add(function(n){return r._onMapPanStopped(n)})),this._disposables.push(n.mapZoomStopped.add(function(n){return r._onMapZoomStopped(n)})));this._disposables.push(this.frameSet=new t,this.dataLoaded=new t,this.primitivesRendered=new t,this.labelsRendered=new t,this.frameRendered=new t,this.frameFailed=new t,this.mapReady=new t,this.layerDataLoaded=new t,this.layerPrimitivesRendered=new t,this.layerLabelsRendered=new t,this.layerFrameRendered=new t,this.layerFrameFailed=new t,this.onDisabled=new t)}return n.prototype.disable=function(){this._disabled=!0;this.onDisabled.invoke()},n.prototype.enable=function(){this._disabled&&(this._disabled=!1,this._setFrame(0))},n.prototype.initializeLayers=function(){for(var t,n=0;n<this._allLayers.length;n++)this._addLayer(this._allLayers[n]);t=this._map.getMode();t&&this._setFrame(0,null,null,2)},n.prototype.getFrame=function(){return this._currentFrameNumber===0?null:{frameNumber:this._currentFrameNumber,purpose:this._currentFramePurpose,view:this._currentFrameView,viewport:this._currentFrameViewport,lastViewChangeFrameNumber:this._lastViewChangeFrameNumber,cause:this._lastFrameChangeCause,causeEntityIds:this._lastFrameChangeEntityIds,causeLayerIds:this._lastFrameChangeLayerIds}},n.prototype.getFrameData=function(){var i,n,t;if(this._currentFrameNumber===0)return null;if(!this._currentFrameData){for(i=[],n=0;n<this._layerFrameManagers.length;n++)t=this._layerInfoDictionary[this._layerFrameManagers[n].getLayer().getId()],t&&t.currentFrameData&&i.push(t.currentFrameData);this._currentFrameData=new ur(this.getFrame(),i)}return this._currentFrameData},n.prototype.isCurrent=function(n){return n.frameNumber===this._currentFrameNumber},n.prototype.hasCurrentFrameCompletedDataLoadingPhase=function(){return this._frameEventAggregator.haveAllLayersLoadedData()},n.prototype.hasCurrentFrameCompletedPrimitiveRenderingPhase=function(){return this._frameEventAggregator.haveAllLayersRenderedPrimitives()},n.prototype.hasCurrentFrameCompletedLabelRenderingPhase=function(){return this._frameEventAggregator.haveAllLayersRenderedLabels()},n.prototype.hasCurrentFrameRendered=function(){return this._frameEventAggregator.haveAllLayersCompleted()},n.prototype.hasCurrentFrameFailed=function(){return!this._isCurrentFramePending()&&!this._frameEventAggregator.haveAllLayersCompleted()},n.prototype.isMapReady=function(){return this._isMapReady},n.prototype.completePrimitiveRenderingPhase=function(n){if(this.isCurrent(n))for(var t=0;t<this._layerFrameManagers.length;t++)this._layerFrameManagers[t].completePrimitiveRenderingPhase(n)},n.prototype.completeLabelRenderingPhase=function(n){if(this.isCurrent(n))for(var t=0;t<this._layerFrameManagers.length;t++)this._layerFrameManagers[t].completeLabelRenderingPhase(n)},n.prototype.dispose=function(){var n,t,i;for(this._stopTimeoutTimer(),f._clearDisposables(this._disposables),n=0,t=this._layerFrameManagersDisposables.length;n<t;n++)i=this._layerFrameManagersDisposables[n],f._clearDisposables(i);f._clearDisposables(this._layerFrameManagers);this._map=null;this._layerInfoDictionary=null;this._currentFrameViewport=null;this._frameEventAggregator=null;this._currentFrameView=null;this._lastUpdatedView=null;this._lastUpdatedViewport=null},n.prototype.hackHackSetFrame=function(){this._setFrame(99)},n.prototype._setFrame=function(n,t,i,r){var f,e,u;if(!this._disabled&&this._map&&!this._map.isDisposed()&&this._map.getMode()&&this._map.getActualSize().width!==0&&this._map.getActualSize().height!==0){for(f=this.getFrame(),this._isCurrentFramePending()&&this._failFrame(f,1,null),this._lastFrameChangeCause=n,this._lastFrameChangeEntityIds=i,this._lastFrameChangeLayerIds=t,this._currentFrameNumber++,this._currentFramePurpose=r?r:this._currentFramePurpose,this._currentFrameView=this._map.getView(),this._currentFrameViewport=this._map.getViewport(),y.areEqual(this._currentFrameView,this._lastUpdatedView)?this._currentFrameViewport.areEqual(this._lastUpdatedViewport)||(this._lastUpdatedViewport=this._currentFrameViewport,this._lastViewChangeFrameNumber=this._currentFrameNumber):(this._lastUpdatedView=this._currentFrameView,this._lastViewChangeFrameNumber=this._currentFrameNumber),this._currentFrameData=null,this._dataPendingLayersId={},this._frameEventAggregator.resetEventCounts(),this._startTimeoutTimer(),f=this.getFrame(),u=0;u<this._layerFrameManagers.length;u++)e=this._layerFrameManagers[u].getLayer(),this._dataPendingLayersId[e.getId()]=!0,!e.isBaseLayer||e instanceof ft||this._layerFrameManagers[u].setFrame(f);for(u=0;u<this._layerFrameManagers.length;u++)e=this._layerFrameManagers[u].getLayer(),e.isBaseLayer&&e instanceof ft&&this._layerFrameManagers[u].setFrame(f);for(u=0;u<this._layerFrameManagers.length;u++)this._layerFrameManagers[u].getLayer().isBaseLayer||this._layerFrameManagers[u].setFrame(f);this.frameSet.invoke({frame:f});this._map.frameManagerLoaded.invoke(this);this._layerFrameManagers.length===0&&(this.dataLoaded.invoke({frame:f}),this.primitivesRendered.invoke({frame:f}),this.labelsRendered.invoke({frame:f}),this._checkIfFrameIsFullyRendered())}},n.prototype._failFrame=function(n,t,i){this.isCurrent(n)&&(this._stopTimeoutTimer(),this.frameFailed.invoke({frame:n,reason:t,errorMessage:i}),this._isMapReady||t!==1&&(this._isMapReady=!0,this.mapReady.invoke()),t===5&&this._setFrame(8))},n.prototype._addLayer=function(n){var r=this,t=new rr(this._map,n,this._allLayers.isBaseLayer(n)),i;n.setFrameManager(t);this._layerFrameManagers.push(t);this._layerInfoDictionary[n.getId()]={layer:n,currentFrameData:null,previousFrameData:null,previousTargetFrameData:null};this._frameEventAggregator.setLayerCount(this._layerFrameManagers.length);i=[];i.push(t.dataLoaded.add(function(n){return r._onLayerDataLoaded(n)}));i.push(t.primitivesRendered.add(function(n){return r._onLayerPrimitivesRendered(n)}));i.push(t.labelsRendered.add(function(n){return r._onLayerLabelsRendered(n)}));i.push(t.frameFailed.add(function(n){return r._onLayerFailed(n)}));i.push(t.layerInvalidated.add(function(n){return r._onLayerInvalidated(n)}));this._layerFrameManagersDisposables.push(i)},n.prototype._removeLayer=function(n){var r=n.getFrameManager(),t,u,i;if(r)for(r.dispose(),t=this._layerFrameManagers.indexOf(r),this._layerFrameManagers.splice(t,1),this._frameEventAggregator.setLayerCount(this._layerFrameManagers.length),u=this._layerFrameManagersDisposables[t],this._layerFrameManagersDisposables.splice(t,1),i=0;i<u.length;i++)u[i].dispose();delete this._layerInfoDictionary[n.getId()]},n.prototype._checkIfFrameIsFullyRendered=function(){this._frameEventAggregator.haveAllLayersCompleted()&&(this._stopTimeoutTimer(),this.frameRendered.invoke({frame:this.getFrame()}),this._isMapReady||(this._isMapReady=!0,this.mapReady.invoke()))},n.prototype._updateMapFrameData=function(){for(var n,r,i=Object.keys(this._layerInfoDictionary),t=0,u=i.length;t<u;t++)n=this._layerInfoDictionary[i[t]],r=n.layer.getFrameManager(),n.previousFrameData=n.currentFrameData,n.currentFrameData&&n.currentFrameData.frame.purpose===2&&(n.previousTargetFrameData=n.currentFrameData),n.currentFrameData=r.getFrameData();this._currentFrameData=null},n.prototype._startTimeoutTimer=function(){var t=this;this._intervalId&&window.clearInterval(this._intervalId);this._intervalId=Microsoft.Maps.setInterval(function(){t._onFrameTimedOut()},n._timeoutDuration)},n.prototype._stopTimeoutTimer=function(){this._intervalId&&window.clearInterval(this._intervalId);this._intervalId=0},n.prototype._isCurrentFramePending=function(){return!!this._intervalId},n.prototype._onMapChanged=function(n){var i=this,t=null;n.name==="actualSize"?t=3:n.name==="mode"&&(t=5);t!==null&&Microsoft.Maps.setTimeout(function(){return i._setFrame(t)},0)},n.prototype._onMapLayersCollectionChanged=function(n){var r=[],i,t;if(n.reset){for(t=this._layerFrameManagers.length;t--;)i=this._layerFrameManagers[t].getLayer(),r.push(i.getId()),this._removeLayer(i);for(t=0;t<this._allLayers.length;t++)i=this._allLayers[t],r.push(i.getId()),this._addLayer(i)}if(n.added)for(t=0;t<n.added.length;t++)i=n.added[t],r.push(i.getId()),this._addLayer(i);if(n.removed)for(t=0;t<n.removed.length;t++)i=n.removed[t],r.push(i.getId()),this._removeLayer(i);this._setFrame(4,r)},n.prototype._onMapViewChanged=function(){this._setFrame(6,null,null,2)},n.prototype._onMapPanStopped=function(){this._setFrame(1,null,null,2)},n.prototype._onMapZoomStopped=function(){this._setFrame(1,null,null,2)},n.prototype._onLayerDataLoaded=function(n){(this.layerDataLoaded.invoke(n),n.layer&&delete this._dataPendingLayersId[n.layer.getId()],this.isCurrent(n.frame))&&(this._frameEventAggregator.incrementDataLoadedCount(),this._frameEventAggregator.haveAllLayersLoadedData()&&(this._updateMapFrameData(),this.dataLoaded.invoke({frame:n.frame})),this._checkIfFrameIsFullyRendered())},n.prototype._onLayerPrimitivesRendered=function(n){(this.layerPrimitivesRendered.invoke(n),this.isCurrent(n.frame))&&(this._frameEventAggregator.incrementPrimitivesRenderedCount(),this._frameEventAggregator.haveAllLayersRenderedPrimitives()&&this.primitivesRendered.invoke({frame:n.frame}),this._checkIfFrameIsFullyRendered())},n.prototype._onLayerLabelsRendered=function(n){(this.layerLabelsRendered.invoke(n),this.isCurrent(n.frame))&&(this._frameEventAggregator.incrementLabelsRenderedCount(),this._frameEventAggregator.haveAllLayersRenderedLabels()&&this.labelsRendered.invoke({frame:n.frame}),this._checkIfFrameIsFullyRendered())},n.prototype._onLayerFailed=function(n){var t,i;(this.layerFrameFailed.invoke(n),this._isCurrentFramePending())&&(t=u.logger,t&&(i={feature:rt.MapControl,action:d.Error,data:{}},n&&(i.data={layerId:n.layer?n.layer.getId():"",reason:n.reason,errorMessage:"Layer failed; "+n.errorMessage}),t.logCriticalError(null,i,!0)),this._failFrame(n.frame,n.reason,n.errorMessage),this._stopTimeoutTimer())},n.prototype._onLayerInvalidated=function(n){var t,i;n&&(t=n.entityIds,i=[n.layerId]);this._setFrame(4,i,t)},n.prototype._onFrameTimedOut=function(){var f,n,t,r,e;i.assert(this._isCurrentFramePending(),"A timeout cannot occur unless the current frame is pending.");this._stopTimeoutTimer();f=this.getFrame();n=u.logger;n&&(t=Object.keys(this._dataPendingLayersId),r="",t.length>0&&(r=" Layers failed to download data: "+t.join(",").replace(/\d+/gi,"***")),e={feature:rt.MapControl,action:d.Error,data:{errorMessage:"Frame timed out."+r}},n.logCriticalError(null,e,!0));this._failFrame(f,5,null)},n.frameZero={frameNumber:0,purpose:2,view:null,viewport:null,lastViewChangeFrameNumber:0,cause:0},n._timeoutDuration=2e4,n}(),lu=function(){function n(n,t,i){this._key=n;this._timestamp=t;this._perfManager=i}return n.prototype.end=function(n){this._logged||(this._perfManager.end(this,n),this._logged=!0)},n.prototype.timestamp=function(){return this._timestamp},n.prototype.key=function(){return this._key},n}(),d=function(){function n(){}return n.Activated="A",n.CenterPoint="CP",n.Deactivated="D",n.Clicked="C",n.Reactivated="RE",n.Removed="R",n.Focused="F",n.Hovered="H",n.Collapsed="CL",n.ClientInstNamespace="CI",n.Submitted="S",n.Selected="SE",n.EntryPoint="EP",n.Expanded="EX",n.Impression="I",n.Error="ERR",n.Warning="WRN",n.Perf="PRF",n}(),au=function(){function n(){}return n.ContextMenu="ContextMenu",n.LocalSearch="LocalSearch",n.LocalListing="LocalListing",n.LocalListingAlongRoute="LocalListingAlongRoute",n.LocalDetails="LocalDetails",n.Collections="Collections",n.MyPlacesNew="MyPlacesNew",n.POI="POI",n.POIAlongRoute="POIAlongRoute",n.Landmarks="Landmarks",n.SearchBox="SearchBox",n.SearchButton="SearchButton",n.TaskBar="TaskBar",n.CategoriesBar="CategoriesBar",n.Autosuggest="Autosuggest",n.Feedback="Feedback",n.DirectionsWaypointSearch="DirectionsWaypointSearch",n.DirectionsRouteList="DirectionsRouteList",n.TaskCard="TaskCard",n.TransitStop="TransitStop",n.TransitLine="TransitLine",n.NearbyParking="NearbyParking",n.Geochain="Geochain",n.Permalink="Permalink",n.FallbackRequery="FallbackRequery",n.ItineraryListings="ItineraryListings",n.ItineraryDetails="ItineraryDetails",n.ItineraryPOI="ItineraryPOI",n.TravelL2="TravelL2",n.VenueMap="VenueMap",n.SerpAnswer="SerpAnswer",n.ServerPagination="ServerPagination",n.Infobox="Infobox",n.MapsTour="MapsTour",n.QuerySwitch="QuerySwitch",n}(),rt=function(){function n(){}return n.ContextMenu="CM",n.TaskManager="TM",n.TaskBar="TB",n.CategoriesBar="CB",n.FiltersBar="FSB",n.MapControl="MC",n.POI="POI",n.LayerPOI="LMPOI",n.DetailsCard="DC",n.ListingCard="LC",n.Landmarks="L",n.CardModel="CD",n.NearbyControl="NBC",n.NearbySearch="NBS",n.RecommendedSearch="RS",n.ISDK="IS",n.Network="NW",n.BaseMapData="BD",n.ShowMeCategoryLayers="SMC",n.SDK="SDK",n}(),vu=function(){function n(){}return n.Autosuggest="AS",n.Collections="CX",n.Directions="DD",n.Embed="EMB",n.Print="PRT",n.Share="SH",n.Search="SR",n.Streetside="SS",n.Traffic="T",n.LocateMe="LM",n.Feedback="FB",n.TaskManager="TM",n.Tips="TP",n.Fullscreen="FS",n.Overlay="OV",n.BirdseyeV2="B2",n.VenueMap="VM",n.Commutability="CMT",n}(),yu=function(n){function t(t){return n.call(this,"Event.ClientPerf",t)||this}return p(t,n),t.prototype.log=function(i,r){i&&r&&n.prototype.logObject.call(this,t.getPerfLogDataObject(i,r))},t.prototype.start=function(n){return n?new lu(n,this._getTimestamp(),this):null},t.prototype.end=function(n,i){if(n){var r=n.key(),u=i?r+t.KeySeparator+i:r;this.logObject(t.getPerfLogDataObject(u,this._getTimestamp().getTime()-n.timestamp().getTime()))}},t.prototype.checkpoint=function(n){n&&this.logObject(t.getPerfLogDataObject(n,this._getTimestamp()))},t.prototype._getTimestamp=function(){return new Date},t.getPerfLogDataObject=function(n,t){return{T:"CI.ClientPerf",FID:d.ClientInstNamespace,key:n,value:t}},t.KeySeparator=".",t}(InstrumentationBase),y=function(){function n(n,t){this.cameraLocation=n;this.heading=((t||0)%360+360)%360;this.heading=this.heading>315?this.heading-360:this.heading}return n.prototype.clone=function(){var t=new n(this.cameraLocation.clone(),this.heading);return t.pitch=this.pitch,t.verticalFov=this.verticalFov,t},n.areEqual=function(t,i){return t===i?!0:!t||!i?!1:n.areNumbersEqual(t.heading,i.heading)?n.areNumbersEqual(t.pitch,i.pitch)?n.areNumbersEqual(t.verticalFov,i.verticalFov)?e.areEqual(t.cameraLocation,i.cameraLocation)?!0:!1:!1:!1:!1},n.areCameraAltitudesEqual=function(n,t){return n.cameraLocation.altitude===t.cameraLocation.altitude&&n.cameraLocation.altitudeReference===t.cameraLocation.altitudeReference},n.areNumbersEqual=function(n,t){if(n===t)return!0;if(n===undefined||n===null||t===undefined||t===null)return!1;return Math.abs(n-t)<=1e-6},n}(),fr=function(){function n(){}return n.zoomIn="ZoomIn",n.zoomOut="ZoomOut",n}(),w=function(){function n(){}return n.mapZoomActionName="MapZoom",n.mapLayerAdded="MapLayerAdded",n.mapLayerRemoved="MapLayerRemoved",n.mapPanActionName="MapPan",n.mapSetViewActionName="SetView",n.mapTypeChangedActionName="MapTypeChanged",n.mapControlSDKPageNameKey="sdk",n.oneMapOverlayPageNameKey="omo",n.osMapsFeatureKey="os",n}(),pu=function(){function t(n,t,i){var u=this,f;this._disposables=[];this._map=n;this._logger=t;(r.enableInstrumentation||r.perfSDKInclusions)&&this._disposables.push(new wr(this._map,i));f=this._map.getMapOptions().parentPageIG;f&&(r.dynamicProperties.mapsIG=r.dynamicProperties.impressionGuid=f);this._disposables.push(this._map.frameManagerLoaded.addOne(function(){return u._onMapFrameManagerLoaded()}));this._disposables.push(this._map.labelControllerLoaded.add(function(){return u._onMapLabelControllerLoaded()}));this._disposables.push(this._map.mapZoomStarted.add(function(n){return u._onMapZoomStarted(n)}));this._disposables.push(this._map.mapPanStarted.add(function(n){return u._onMapPanStarted(n)}));this._disposables.push(this._map.getAllLayers().changed.add(function(n){return u._onMapLayersChanged(n)}));this._disposables.push(this._map.mapTypeChanged.add(function(n){return u._onMapTypeChanged(n)}));this._mapViewChangingHandler=this._map.viewChanging.add(function(n){return u._onMapViewChanging(n)});this._map.getConfig().enableClientInstrumentationIG&&!r.isMapsVertical&&this._logSnrPageNameForMapControl(r.isSDK?w.mapControlSDKPageNameKey:w.oneMapOverlayPageNameKey,!0)}return t.prototype._onMapFrameManagerLoaded=function(){var n=this;this._disposables.push(this._map.getFrameManager().frameSet.add(function(t){return n._onFrameManagerFrameSet(t)}));this._disposables.push(this._map.getFrameManager().frameRendered.add(function(t){return n._onFrameRendered(t)}))},t.prototype._onMapLabelControllerLoaded=function(){var n=this;this._disposables.push(this._map.getLabelController().instrumentLabelingPass.add(function(t){return n._onInstrumentLabelingPass(t)}))},t.prototype.setMapMode=function(n){if(n.mapModeType===0){var t=this._map.getMapType().id;t===s.ordnanceSurvey&&this._logMapTypeChangedInst(t)}},t.prototype._onInstrumentLabelingPass=function(n){if(n.landmarksCount){var t={feature:rt.Landmarks,action:d.Activated,data:{CT:n.landmarksCount}};this._logger.logObject(t,null,!0)}},t.prototype._onFrameManagerFrameSet=function(){i.log(null,"Frame set {0}",Date.now());i.logResourceLoadOrder(null,"FrameSet")},t.prototype._onMapLayersChanged=function(n){var t=[],u=!0,i,r;for(n.added?t=n.added:n.removed&&(t=n.removed,u=!1),i=0;i<t.length;i++)r=t[i],r.logWhenAddedOrRemoved&&this._logLayerChangedInst(u,r.logId)},t.prototype._onMapViewChanging=function(n){n.cause===3&&(this._state=3,this._mapViewChangingHandler.dispose())},t.prototype._onMapTypeChanged=function(n){n&&this._logMapTypeChangedInst(n.newMapTypeId)},t.prototype._onMapPanStarted=function(){this._state=2},t.prototype._onMapZoomStarted=function(){this._state=1},t.prototype._onFrameRendered=function(){i.log(null,"Frame Rendered {0}",Date.now());i.logResourceLoadOrder(null,"FrameRendered");var n=null;switch(this._state){case 3:n=d.Activated;break;case 2:n=w.mapPanActionName;break;case 1:n=w.mapZoomActionName;break;default:n=w.mapSetViewActionName}this._state=0;n&&this._logClientInst(n);this._lastZoomLevel=this._map.getMercatorZoomLevel()},t.prototype._constructMapInstrumentationData=function(n){var i=this._map,u=i.isDisposed(),t=!u&&i.getView(),f=!u&&i.getMode(),r={CP:t&&t.cameraLocation,H:t&&t.heading,A:t&&t.cameraLocation.altitude,MM:f&&f.getDisplayName()},e;return(n===d.Activated||n===d.Deactivated)&&(r.T=Date.now()),n===w.mapZoomActionName&&this._lastZoomLevel&&(e=this._map.getMercatorZoomLevel(),r.ZD=e>this._lastZoomLevel?fr.zoomIn:fr.zoomOut),r},t.prototype._logLayerChangedInst=function(n,t){var r=n?w.mapLayerAdded:w.mapLayerRemoved,i=this._createLogData(r);i.data.ID=t;this._logger.logObject(i,null,!1)},t.prototype._logMapTypeChangedInst=function(n){var t=this._createLogData(w.mapTypeChangedActionName),i=r.dynamicProperties,u;t.data.MS=n;this._logger.logObject(t,null,!1);r.features.localSearch.sendMoreInstrumentationForOverlay&&i.serpIG&&this._logger.logObject(t,i.serpIG,!1);n===s.ordnanceSurvey&&(this._map.getMapOptions().sessionKey||i.sessionKey?this._logSnrPageNameForMapControl(w.osMapsFeatureKey,!1):(u=this._map.getConfig().logServiceUrlFormat.replace(/{credentials}/,this._map.getMapOptions().credentials).replace(/{name}/,"imageryOS").replace(/{mkt}/,r.dynamicProperties.market),tt.downloadJsonp(u,"ordnanceSurvey",null,null,null,null,null,3)))},t.prototype._logClientInst=function(n){if(r.enableInstrumentation){var i=n===d.Activated||n===w.mapSetViewActionName,t=this._createLogData(n);this._logger.logObject(t,null,i);r.features.localSearch.sendMoreInstrumentationForOverlay&&r.dynamicProperties.serpIG&&(n===w.mapZoomActionName||n===w.mapPanActionName)&&this._logger.logObject(t,r.dynamicProperties.serpIG,!1)}},t.prototype._createLogData=function(n){var t=this._constructMapInstrumentationData(n);return{feature:rt.MapControl,action:n,data:t}},t.prototype._logSnrPageNameForMapControl=function(t,i){if(r.enableInstrumentation||r.enableErrorInstrumentation||r.perfSDKInclusions){var u=r.dynamicProperties,f=this._map.getConfig().serverInstrumentationUrlFormat.replace("{origin}",u.origin).replace("{q}","").replace("{f}",t),e="MONITR";window.location.href.toUpperCase().indexOf(e)>-1&&(f+="&FORM="+e);tt.downloadGeneric(f,"pagename",function(t){if(i&&typeof t=="object"){var f=n(t).select("div[id=ImpressionGuid]").get_attr("name");f&&(u.mapsIG=f,r.isMapsAnswer||(u.impressionGuid=f))}},i?"document":null,null,null,3)}},t.prototype.dispose=function(){this._logger&&this._logClientInst(d.Deactivated);f._clearDisposables(this._disposables);this._mapViewChangingHandler.dispose();this._map=null;this._logger=null},t}(),l=function(){function n(){}return n.fromScaleMarker=function(n){if(n<this.scaleMarkers[this.maxZoom-1])return this.maxZoom;if(n>this.scaleMarkers[0])return 1;for(var t=0;t<this.maxZoom;t++)if(n>=this.scaleMarkers[t])return t+1;throw"Invalid operation exception";},n.fromLocation=function(t,i){var r=t.altitude*n._tanHalfFieldOfView;return n._getZoomFromMetersPerPixel(i?0:t.latitude,r/n._halfViewportWidth)},n.toLocation=function(t,i,r){var u=n.toAltitude(t,i,r);return new e(t.latitude,t.longitude,u,0)},n.toAltitude=function(t,i,r){var u=n._getMetersPerPixel(r?0:t.latitude,i)*n._halfViewportWidth;return u/n._tanHalfFieldOfView},n.toScale=function(t,i,r){return n._getMetersPerPixel(r?0:t.latitude,i)},n.fromScale=function(t,i,r){return n._getZoomFromMetersPerPixel(r?0:t.latitude,i)},n._getMetersPerPixel=function(t,i){return Math.cos(c.degreesToRadians(t))*k.earthCircumference/(n._tileSize*Math.pow(2,i))},n._getZoomFromMetersPerPixel=function(t,i){return c.log2(Math.cos(c.degreesToRadians(t))*k.earthCircumference/(n._tileSize*i))},n._tileSize=256,n._halfViewportWidth=500,n._tanHalfFieldOfView=Math.tan(c.degreesToRadians(25)),n.maxZoom=23,n.scaleMarkers=[295824261.1,147912130.6,73956065.28,36978032.64,18489016.32,9244508.16,4622254.08,2311127.04,1155563.52,577781.76,288890.88,144445.44,72222.72,36111.36,18055.68,9027.84,4513.92,2256.96,1128.48,564.24,282.12,141.06,70.53],n}(),wu=function(){function n(n,t,i,r,u,f,e){this.priority=n;this._scene=t;this._minHeading=i||0;this._maxHeading=r||0;this._minScale=u||l.toScale(null,23,!0);this._maxScale=f||l.toScale(null,1,!0);this._bounds=e}return n.prototype.getSceneBounds=function(){return this._bounds},n.prototype.getScene=function(n,t,i,r){var u;return n?n===this._scene.crs&&(!this._bounds||this._isIntersecting(this._bounds,t))&&r>=this._minHeading&&r<=this._maxHeading&&(i>=this._minScale||n.sceneMetadata)&&i<=this._maxScale&&(u=this._scene):(!this._bounds||this._isIntersecting(this._bounds,t))&&r>=this._minHeading&&r<=this._maxHeading&&i>=this._minScale&&i<=this._maxScale&&(u=this._scene),u},n.prototype.dispose=function(){this._scene&&this._scene.dispose();this._bounds=null},n.prototype._isIntersecting=function(n,t){return t instanceof e?n.contains(t):n.intersects(t)},n}(),ft=function(n){function i(i,u,e,o,s,h,c,l,a,v){c===void 0&&(c=18e5);a===void 0&&(a=!1);v===void 0&&(v="");var y=n.call(this,i,u,e,o,s,a,v)||this;return y._minCriticalDataLoadedPercentage=80,y._networkPriority=h,y._sceneContributors=[],y._pendingCriticalDataLoadedResolves=[],y._cacheDuration=c,y.setRenderTarget(0),y._rasterTiles=[],y._disposables.push(y.tileDownloaded=new t),y._disposables.push(y.dataLoaded=new t),y._disposables.push(y.crsReady=new t),y._disposables.push(y.crsUpdateCompleted=new t),y._disposables.push(y.dataLoadFailed=new t),y._disposables.push(y.layerInvalidated=new t),l===undefined&&(l=(r.isMapsVertical||r.isMapsAnswer)&&!f._isFeatureEnabled("disableImageCORS")),y._enableCORS=l,y}return p(i,n),i.prototype.addScene=function(n,t,i,r,u,f,e){var o=this;this._disposables.push(t.tileUrlTemplateChanged.add(function(n){o._currentScene===n&&(o._lastViewChangeFrameNumber=-1,o.layerInvalidated.invoke({layerId:o.getId()}))}));this.addSceneContributor(new wu(n,t,i,r,u,f,e))},i.prototype.addSceneContributor=function(n){this._sceneContributors.push(n);this._sceneContributors.sort(function(n,t){return t.priority-n.priority})},i.prototype.getScene=function(n,t,i,r){var u,o,e,f;for(this._currentSceneContributer=null,u=0,o=this._sceneContributors.length;u<o;u++)if(e=this._sceneContributors[u],f=e.getScene(n,t,i,r),f&&(!n||f.crs===n))return this._currentSceneContributer=e,f;return null},i.prototype.getAvailableRasterTiles=function(){if(this._currentScene&&this._currentScene.getPercentCompleted()<100){var n=[];return n.push.apply(n,this._currentScene.getAllPendingRequestsBackgroundTiles(this._coreMap.getMapOptions().liteMode)),n.push.apply(n,this._rasterTiles),n}return this._rasterTiles},i.prototype.getPercentComplete=function(){return this._currentScene?this._currentScene.getPercentCompleted():100},i.prototype.getCurrentCrs=function(){return this._currentScene?this._currentScene.crs:null},i.prototype.getCurrentScene=function(){return this._currentScene},i.prototype.getTileSize=function(){return this._currentScene?this._currentScene.getTileSize():TileSystemHelper.tileLength},i.prototype.getLastViewChangeFrameNumber=function(){return this._lastViewChangeFrameNumber},i.prototype.setFrame=function(n,t){var i=this;this._currentFrame=n;var u=n.view,f=l.fromLocation(u.cameraLocation,!0),e=l.toScale(u.cameraLocation,f,!0),r=this.getVisible()&&this.getScene(null,t.getBounds(),e,u.heading);this._currentScene&&this._currentScene!==r&&this._currentScene.cancelAllPendingRequests();this._currentScene=r;r&&(this._lastViewChangeFrameNumber!==n.lastViewChangeFrameNumber||t.getMapType().id===s.birdseyeV2||r.getPercentCompleted()<100)?(this._lastViewChangeFrameNumber=n.lastViewChangeFrameNumber,this._rasterTiles=[],r.setFrame(n),r.crs.update?r.crs.update(t,function(){i._currentFrame.frameNumber===n.frameNumber&&(i.crsUpdateCompleted.invoke({layer:i,state:0}),n.view.cameraLocation=t.getView().cameraLocation,i._getAllTiles(i._currentFrame))},function(){i._currentFrame.frameNumber===n.frameNumber&&(i.crsUpdateCompleted.invoke({layer:i,state:1}),n.view.cameraLocation=t.getView().cameraLocation,i._getAllTiles(i._currentFrame))},function(){i._currentFrame.frameNumber===n.frameNumber&&i.crsUpdateCompleted.invoke({layer:i,state:2})}):this._getAllTiles(n)):(r||(this._rasterTiles=null),this.crsReady.invoke({frame:n}),this._raiseEventsOnDataLoad())},i.prototype.onCriticalDataLoaded=function(){var n=this;return new Promise(function(t){if(n._currentScene){var i=n._currentScene.getPercentCompleted();i>n._minCriticalDataLoadedPercentage?t(i):n._pendingCriticalDataLoadedResolves.push(t)}else n._pendingCriticalDataLoadedResolves.push(t)})},i.prototype.dispose=function(){f._clearDisposables(this._sceneContributors);this._pendingCriticalDataLoadedResolves=[];this._rasterTiles=null;n.prototype.dispose.call(this)},i.prototype._raiseEventsOnDataLoad=function(){var n=this._currentScene?this._currentScene.getPercentCompleted():100,t=this._currentScene?this._currentScene.getPercentFailed():0;n>this._minCriticalDataLoadedPercentage&&(this._pendingCriticalDataLoadedResolves.forEach(function(t){t(n)}),this._pendingCriticalDataLoadedResolves=[]);n===100&&(t===100?this.dataLoadFailed.invoke():this.dataLoaded.invoke({frame:this._currentFrame}))},i.prototype.getAllTilesForAnimation=function(n,t,i,r){this._currentScene.getAllTiles(n,[t],r,this.isCritical,!0,!1,i,this._coreMap.getDpiScale(),this._coreMap.getMapOptions().liteMode,this._networkPriority,this._enableCORS,this._useCredentialsForCORS,this._downloadTimeoutInMS)},i.prototype.refreshBackgroundTiles=function(n,t){this._currentScene.getAllTiles(n,t,null,this.isCritical,!1,!0,!0,this._coreMap.getDpiScale(),this._coreMap.getMapOptions().liteMode,this._networkPriority,this._enableCORS,this._useCredentialsForCORS,this._downloadTimeoutInMS)},i.prototype._getAllTiles=function(n){var t=this,i;this._lastViewChangeFrameNumber===n.lastViewChangeFrameNumber&&(this._currentCrs=this._currentScene.crs,this.crsReady.invoke({frame:n}),i=this._currentScene.getAllTiles(this._currentFrame.viewport,[this._currentFrame.view],function(n){t.tileDownloaded.invoke(n);t._rasterTiles.push(n);t._raiseEventsOnDataLoad()},this.isCritical,!1,!1,!0,this._coreMap.getDpiScale(),this._coreMap.getMapOptions().liteMode,this._networkPriority,this._enableCORS,this._useCredentialsForCORS,this._downloadTimeoutInMS,-1,this._currentSceneContributer.getSceneBounds()),i===0&&this._raiseEventsOnDataLoad())},i}(ui),er=function(){function n(t,r,u,f,e,o){var h=this,s;if(i.assertNotNullOrEmpty(r,"fromExpression"),i.assertNotNull(u,"toObj"),i.assertNotNullOrEmpty(f,"toProperty"),o=o||"OneWay",s=r.split("."),this._source=null,this._sourceChangedHandler=null,this._destChangedHandler=null,this._sourceProperty=s[0],this._value=null,this._childBinding=null,this._paused=!1,this._twoWay=!1,this._converter=e,this._toObj=u,this._toProperty=f,this._isIdentity=r===n._identityMarker,s.length>1)s.splice(0,1),this._childBinding=new n(null,s.join("."),u,f,e,o);else if(o==="TwoWay"){if(this._isIdentity)throw"Two-way binding on entire data context is not allowed.";this._twoWay=!0;this._destChangedHandler=this._attachChangeHandler(u,function(){return h._updateSourceFromDest()})}this._setSource(t)}return n.prototype._setSource=function(n){var t=this;this._sourceChangedHandler&&this._sourceChangedHandler.dispose();this._source=n;this._sourceChangedHandler=this._source&&this._attachChangeHandler(this._source,function(){return t._checkForValueChange()});this._checkForValueChange();this._twoWay&&this._updateSourceFromDest()},n.prototype._attachChangeHandler=function(n,t){if(n.changed)return n.changed.add(t);if(n.add_event){n.add_event("change",t);var i=n[0];return i.tagName.toUpperCase()==="INPUT"&&i.type.toUpperCase()==="TEXT"&&n.add_event("keyup",t),{dispose:function(){n.remove_event("change",t);n.remove_event("keyup",t)}}}},n.prototype._checkForValueChange=function(){var n=this._getValue();!this._childBinding&&this._converter&&(n=this._converter(n));n===undefined&&(n=null);a.areEqual(this._value,n)||(this._value=n,this._updateDestination())},n.prototype._getValue=function(){return this._source?this._isIdentity?this._source:a.getValue(this._source,this._sourceProperty):null},n.prototype._updateSourceFromDest=function(){this._source&&(this._paused=!0,a.setValue(this._source,this._sourceProperty,a.getValue(this._toObj,this._toProperty)),this._paused=!1)},n.prototype._updateDestination=function(){this._paused||(this._paused=!0,this._childBinding?this._childBinding._setSource(this._value):a.setValue(this._toObj,this._toProperty,this._value),this._paused=!1)},n.prototype.dispose=function(){this._sourceChangedHandler&&this._sourceChangedHandler.dispose();this._sourceChangedHandler=null;this._source=null;this._childBinding&&this._childBinding.dispose();this._childBinding=null;this._destChangedHandler&&this._destChangedHandler.dispose();this._destChangedHandler=null;this._value=null},n._identityMarker="$self$",n}(),bu=function(){function n(n,t,r){i.assertNotNull(n,"fromObj");i.assertNotNullOrEmpty(t,"fromExpression");i.assertIsFunction(r,"handler");this._eventHandle=null;this._handler=r;this._binding=new er(n,t,this,"value")}return n.prototype.setValue=function(n){this._eventHandle&&this._eventHandle.dispose();n&&(i.assertInstanceOf(n,t,"jsEvent"),this._eventHandle=n.add(this._handler))},n.prototype.dispose=function(){this._eventHandle&&this._eventHandle.dispose();this._binding&&this._binding.dispose()},n}(),or=function(n){function t(t,i,r,u){var f=n.call(this,t,u)||this;return f.defineProperty("dataSource",function(n,t){return f._onDataSourceChanged(n,t)}),i&&f.setDataSource(i),r&&f.setTemplateSelector(r),f.dataVersion=0,f}return p(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this._dataSourceInvalidatedHandler&&(this._dataSourceInvalidatedHandler.dispose(),this._dataSourceInvalidatedHandler=null)},t.prototype._onDataSourceChanged=function(n,t){n!==t&&(this._dataSourceInvalidatedHandler&&(this._dataSourceInvalidatedHandler.dispose(),this._dataSourceInvalidatedHandler=null),t&&t.invalidated&&(this._dataSourceInvalidatedHandler=t.invalidated.add(function(){return i.clearTestHooksLog(i.TileLogTag)})))},t}(ui),sr=function(n){function t(t,i,r){var u=n.call(this)||this;u.id=t.mapType;u.minZoom=t.minZoom;u.maxZoom=t.maxZoom-r;u.cstl=i.enableBingStyle&&t.cstlBing||t.cstl||"";u._templateSelectorPromise=new Promise(function(n){u._resolveBaseMapTemplateSelector=n});u.backgroundTileColor="#f3f2ed";switch(u.id){case"be":case"be2":u.displayName="BirdsEye";u.backgroundTileColor="#626963";break;case"r":u.displayName="Road";break;case"a":u.displayName="Aerial";u.backgroundTileColor="#011422";break;case"os":u.displayName="OrdnanceSurvey"}return u}return p(t,n),t.prototype.getTemplateSelector=function(){return this._templateSelectorPromise},t.prototype.setTemplateSelector=function(n){this._resolveBaseMapTemplateSelector&&this._resolveBaseMapTemplateSelector(n)},t.prototype.dispose=function(){this.clear();this._templateSelectorPromise.then(function(n){n.dispose()})},t}(it),hr=function(){function n(n,t){this._objectPool=[];this._objectConstructor=n;this._constructorArguments=t}return n.prototype._create=function(){function n(n,t){n.apply(this,t)}n.prototype=this._objectConstructor.prototype;this._objectPool.push(new n(this._objectConstructor,this._constructorArguments))},n.prototype.acquire=function(){return this._objectPool.length===0&&this._create(),this._objectPool.pop()},n.prototype.release=function(n){this._objectPool.push(n)},n.prototype.dispose=function(){for(var t=this._objectPool.length,n;t--;)n=this._objectPool[t],n.dispose&&n.dispose();this._objectPool=null},n}(),et=function(){function n(){if(n.instance)return n.instance;this.id="LatLon";this.bounds=[90,180,-90,-180]}return n.prototype.toLatitude=function(n,t){return t},n.prototype.toLongitude=function(n){return n},n.prototype.projectToX=function(n,t){return t},n.prototype.projectToY=function(n){return n},n.prototype.getScale=function(n){var t=b.fromRegionId(n),f=t.height,r=t.width,i=k.greatCircleDistance(new e(0,t.getWest()),new e(0,t.getEast())),u;return r>=360?i=k.earthCircumference:r>180&&(i=k.earthCircumference-i),u=n.pixelWidth,i/u},n.prototype.getGroundResolution=function(n){var t=b.fromRegionId(n),f=t.height,r=t.width,i=k.greatCircleDistance(t.getNorthwest(),t.getSoutheast()),u;return r>=360?i=k.earthCircumference:r>180&&t.getNorth()>0&&t.getSouth()<0&&(i=k.earthCircumference-i),u=Math.sqrt(n.pixelWidth*n.pixelWidth+n.pixelHeight*n.pixelHeight),i/u},n.instance=new n,n}(),b=function(){function n(n,t,i,r){this.center=n;this.width=t;this.height=i;this.crs=et.instance;this.bounds=[this.getNorth(),this.getEast(),this.getSouth(),this.getWest()];this.originalBounds=r&&r.slice()}return n.prototype.buffer=function(n){n===void 0&&(n=.1);this._northWest=this._southEast=null;this.width+=n*this.width;this.height+=n*this.height;this.bounds=[this.getNorth(),this.getEast(),this.getSouth(),this.getWest()]},n.prototype.getNorthwest=function(){return this._northWest||(this._northWest=new e(this.getNorth(),this.getWest(),this.center.altitude)),this._northWest},n.prototype.getSoutheast=function(){return this._southEast||(this._southEast=new e(this.getSouth(),this.getEast(),this.center.altitude)),this._southEast},n.prototype.getNorth=function(){return this.center.latitude+this.height/2},n.prototype.getSouth=function(){return this.center.latitude-this.height/2},n.prototype.getWest=function(){return this.width>=360?-180:e.normalizeLongitude(this.center.longitude-this.width/2)},n.prototype.getEast=function(){return this.width>=360?180:e.normalizeLongitude(this.center.longitude+this.width/2)},n.prototype.toString=function(){return this.getNorth()+","+this.getWest()+","+this.getSouth()+","+this.getEast()},n.prototype.clone=function(){return new n(this.center.clone(),this.width,this.height)},n.prototype.containsLatLong=function(n,t){var r=1e-8,u,i;return t=e.normalizeLongitude(t),u=Math.abs(this.center.latitude-n),i=Math.abs(this.center.longitude-t),i>180&&(i=360-i),u<=this.height/2+r&&i<=this.width/2+r},n.prototype.contains=function(n){return this.containsLatLong(n.latitude,n.longitude)},n.prototype.intersects=function(n,t){t===void 0&&(t=0);var r=Math.abs(this.center.latitude-n.center.latitude),i=Math.abs(this.center.longitude-n.center.longitude);return i>180&&(i=360-i),r<=this.height*(1+t)/2+n.height/2&&i<=this.width*(1+t)/2+n.width/2},n.prototype.crossesInternationalDateLine=function(){return this.getEast()<this.getWest()||this.originalBounds&&Math.abs(this.originalBounds[1]-this.originalBounds[3])>360},n.prototype.splitByInternationalDateLine=function(){var t;if(this.crossesInternationalDateLine()){var i=this.getNorth(),u=this.getWest(),r=this.getSouth(),f=this.getEast(),e=n.fromEdges(i,u,r,180),o=n.fromEdges(i,-180,r,f);t=[e,o]}else t=[this];return t},n.merge=function(t,i){var s=null,o,u,e,h,a;if(t&&i){for(var f=[],p=Math.max(t.getNorth(),i.getNorth()),w=Math.min(t.getSouth(),i.getSouth()),r=0,v=[t,i],r=0;r<v.length;r++)o=v[r],o.crossesInternationalDateLine()?(f.push([o.getWest(),180]),f.push([-180,o.getEast()])):f.push([o.getWest(),o.getEast()]);for(f.sort(function(n,t){return n[0]===t[0]?n[1]-t[1]:n[0]-t[0]}),u=[],e=f[0],r=1;r<f.length;)h=f[r],e[1]>=h[0]?e[1]=Math.max(e[1],h[1]):(u.push(e),e=h),r++;u.push(e);var c=u.length,y=u[0][0]+360-u[c-1][1],l=[u[c-1][1],u[0][0]];for(r=1;r<c;r++)a=u[r][0]-u[r-1][1],a>y&&(y=a,l=[u[r-1][1],u[r][0]]);s=n.fromEdges(p,l[1],w,l[0])}else t?i||(s=t):s=i;return s},n.fromEdges=function(t,i,r,u,f,o,s){var c,h;return s&&(c=[t,u,r,i]),Math.abs(u-i)>360&&(i=-180,u=180),i=e.normalizeLongitude(i),u=e.normalizeLongitude(u),i>u&&(u+=360),h=(i+u)/2,h=e.normalizeLongitude(h),new n(new e((r+t)/2,h,f,o),u-i,t-r,c)},n.fromCorners=function(t,i){return n.fromEdges(t.latitude,t.longitude,i.latitude,i.longitude,t.altitude)},n.fromLocations=function(){for(var c,b,p,k,nt=[],a=0;a<arguments.length;a++)nt[a]=arguments[a];c=f._isArray(arguments[0])?arguments[0]:arguments;c=c||[];for(var v,y,r,u,d,g,o,t=c.length,i=new Array(t),s=0,l,h,w;t--;)o=c[t],h=o.latitude,w=o.longitude,isFinite(h)&&isFinite(w)&&(v=v===undefined?h:Math.max(v,h),y=y===undefined?h:Math.min(y,h),i[s++]=l=e.normalizeLongitude(w),u=u===undefined?l:Math.max(u,l),r=r===undefined?l:Math.min(r,l),o.altitudeReference!==-1&&(d=o.altitude,g=o.altitudeReference));if(s&&u-r>180){for(i.length=s,i.sort(function(n,t){return n-t}),b=i[0]+360-i[s-1],p=0,t=1;t<s;t++)k=i[t]-i[t-1],k>b&&(b=k,p=t);r=i[p];u=i[(p||s)-1]}return n.fromEdges(v,r,y,u,d,g)},n.fromShapes=function(t){var i=null,f,r,e,u;if(t)if(t instanceof Array)for(r=0,e=t.length;r<e;r++)f=n.fromShapes(t[r]),i=n.merge(i,f);else t instanceof vi?i=new n(t.getLocation(),0,0):t instanceof br?(u=t.getRings(),u&&u.length>=1&&(i=n.fromLocations(u[0]))):t instanceof pi?i=n.fromLocations(t.getLocations()):t.geometry&&t.geometry.boundingBox&&(i=t.geometry.boundingBox);return i},n.fromString=function(t){var r=null,i=t.split(",");if(i&&i.length===4){var u=parseFloat(i[0]),f=parseFloat(i[1]),e=parseFloat(i[2]),o=parseFloat(i[3]);r=n.fromEdges(u,f,e,o)}return r},n.fromRegionId=function(t,r){var h,u,c,l;if(i.assert(t&&t.bounds&&t.bounds.length===4,"Invalid regionId"),h=t.boundingBox,h)r||(h=h.clone());else{u=t.crs;n._createMapLocationObjectPool();var f=n._mapLocationObjectPool.acquire(),e=n._mapLocationObjectPool.acquire(),o=n._mapLocationObjectPool.acquire(),s=n._mapLocationObjectPool.acquire();f.latitude=u.toLatitude(t.bounds[3],t.bounds[0]);f.longitude=u.toLongitude(t.bounds[3],t.bounds[0]);e.latitude=u.toLatitude(t.bounds[1],t.bounds[0]);e.longitude=u.toLongitude(t.bounds[1],t.bounds[0]);o.latitude=u.toLatitude(t.bounds[1],t.bounds[2]);o.longitude=u.toLongitude(t.bounds[1],t.bounds[2]);s.latitude=u.toLatitude(t.bounds[3],t.bounds[2]);s.longitude=u.toLongitude(t.bounds[3],t.bounds[2]);try{if(c=f,l=o,t.crs&&t.crs.heading)switch(t.crs.heading){case 0:break;case 90:c=s;l=e;break;case 180:c=o;l=f;break;case 270:c=e;l=s;break;default:i.assert(!1,"custom crs heading not implemented")}u.sceneMetadata&&(c.latitude=Math.max(f.latitude,e.latitude,o.latitude,s.latitude),c.longitude=Math.min(f.longitude,e.longitude,o.longitude,s.longitude),l.latitude=Math.min(f.latitude,e.latitude,o.latitude,s.latitude),l.longitude=Math.max(f.longitude,e.longitude,o.longitude,s.longitude));h=n.fromCorners(c,l);t.boundingBox=h}finally{n._mapLocationObjectPool.release(f);n._mapLocationObjectPool.release(e);n._mapLocationObjectPool.release(o);n._mapLocationObjectPool.release(s)}}return h},n.areEqual=function(n,t,i){var r=!1;if(n&&t){var u=n.getNorthwest(),f=n.getSoutheast(),o=t.getNorthwest(),s=t.getSoutheast();r=e.areEqual(u,o,!0,i)&&e.areEqual(f,s,!0,i)}return r},n._createMapLocationObjectPool=function(){n._mapLocationObjectPool||(n._mapLocationObjectPool=new vf(4,e,[0,0]))},n}(),tt=function(){function t(){}return t._setTimeoutWatch=function(n){t._timeoutTimerId===-1&&(t._timeoutTimerId=Microsoft.Maps.setTimeout(function(){var r,n,u;t._timeoutTimerId=-1;var e=Date.now(),f=!1,i=t._requestTimeoutPeriodinMs;for(r in t._requests)t._requests.hasOwnProperty(r)&&(n=t._requests[r],n.status===1&&(u=n.timeoutDuration-(e-n.startTime),u<=0?n.abortCallback(null,5):(i=Math.min(i,u),f=!0)));f&&t._setTimeoutWatch(Math.min(i,t._minImageRequestTimeoutPeriodinMs))},Math.max(t._minTimeoutWatchDuration,n)))},t._downloadGeneric=function(n,i,r,u,f,e,o,s,h,c,l,a,v){i=i.replace("{credentials}",t.credentials);i=t._appendClientApiParameter(i);var y=v&&a?t._requests[a]:t._requests[i];return t._setTimeoutWatch(Math.min(t._minImageRequestTimeoutPeriodinMs,t._requestTimeoutPeriodinMs)),y||(y={sourceUrl:n,url:i,status:0,successCallbacks:{},errorCallbacks:{},parseResponseCallback:e,callbackStates:{},executor:f,priority:s,hostname:t._getHostname(i),jsonso:a,callerId:h,startTime:Date.now(),timeoutDuration:l},a&&(t._requests[a]=y),v||(t._requests[i]=y)),y.successCallbacks[c]=r,u&&(y.errorCallbacks[c]=u),o&&(y.callbackStates[c]=o),s===0?t._initiateRequest():Microsoft.Maps.setTimeout(function(){return t._initiateRequest()},t._minRequestStartWaitTimeinMs),y},t.downloadGeneric=function(n,i,r,u,f,e,o,s){var h=(t._uniqueCallbackId++).toString(),c=t._getDispatchKey(h,n);return t._downloadGeneric(n,n,r,f,function(n){t._createXHR(n,u?u:"text",null,null,s).send()},null,e,o?o:1,i,h,t._requestTimeoutPeriodinMs),t._requests[n].abortCallback=function(i,r){t._networkCallback(null,n,null,r)},c},t.downloadImage=function(n,i,r,u,f,e,o,s,h){h===void 0&&(h=t._imageRequestTimeoutPeriodinMs);t._minImageRequestTimeoutPeriodinMs=Math.min(t._minImageRequestTimeoutPeriodinMs,h);var c=(t._uniqueImageRequestId++).toString(),l=(t._uniqueCallbackId++).toString(),a=t._getDispatchKey(l,c);return t._downloadGeneric(n,n,r,u,function(n){var i=t._getPooledImage(o,s),r=i.image;r.onload=function(){var n=t._requests[c];n&&n.status===1&&t._onImageRequestComplete(2,c,i)};r.onerror=function(){var n=t._requests[c],u;n&&n.status===1&&(u=!r.complete||r.naturalWidth===0,t._onImageRequestComplete(u?3:2,c,i))};n.abortCallback=function(n,r){t._onImageRequestComplete(r,c,i)};r.onabort=function(){n.abortCallback&&n.abortCallback(null,3)};i.image.src=n.url},null,f,e?e:0,i,l,h,c,!0),t._requests[c].abortCallback=function(n,i){t._onImageRequestComplete(i,c,null)},a},t.downloadJson=function(i,r,u,f,e,o,s,h,c){h===void 0&&(h=!0);var l=(t._uniqueCallbackId++).toString(),a=t._getDispatchKey(l,i);return c=c||{},h&&!c["Content-Type"]&&(c["Content-Type"]="application/json; charset=utf-8"),t._downloadGeneric(i,i,u,f,function(n){t._createXHR(n,null,c,o).send()},function(t){var i={succeeded:!1};try{i.response=n.Internals.parseJSON(t);i.succeeded=!0}catch(r){}return i},e,s?s:1,r,l,t._requestTimeoutPeriodinMs),t._requests[i].abortCallback=function(n,r){t._networkCallback(null,i,null,r)},a},t.downloadJsonp=function(n,r,u,f,e,o,s,h){var y=!0,d=(t._uniqueCallbackId++).toString(),g=n,nt,c,p,w,b,l,a,tt,v,k;return e=e||t._getJsonStateObject(g),nt=t._getDispatchKey(d,e),n.indexOf(t._callbackReplacementString)<0&&(y=!1),p=!1,/\{jsonso}/ig.test(n)?(c=o?t._reverseCallbackName:t._normalCallbackName,n=n.replace(/\{jsonso}/ig,e)):n.indexOf(t._mockJsonsoString)>=0?(w=n.indexOf(t._mockJsonsoString),w>=0&&(l=n.indexOf("&",w),l<0&&(l=n.length),a=w+t._mockJsonsoString.length,e=n.substr(a,l-a))):(y||(b=n.indexOf("jsonp="),b>=0&&(l=n.indexOf("&",b),l<0&&(l=n.length),a=b+6,c=n.substr(a,l-a))),c||(c="f"+e),p=!0),y&&(tt=t._callbacksPrefix+c,n=n.replace(t._callbackReplacementString,tt)),v=t._downloadGeneric(g,n,u,f,function(n){t._downloadScript(n)},null,s,h?h:1,r,d,t._requestTimeoutPeriodinMs,e),p&&(t._jsonpRequestsCounts[e]?t._jsonpRequestsCounts[e]++:t._jsonpRequestsCounts[e]=1,k=t._requests[e],y?t.callbacks[c]=function(n,r,u,f){i.assert(r===e||!r,"If specified, the jsonsoInner parameter must equal jsonso.");f!==4&&f!==3&&(t._jsonpRequestsCounts[e]-=Object.keys(k.successCallbacks).length);t._networkCallback(n,e,u,f);t._jsonpRequestsCounts[e]===0&&(delete t.callbacks[c],delete t._jsonpRequestsCounts[e])}:window[c]=function(n,i,r,u){u!==4&&u!==3&&(t._jsonpRequestsCounts[e]-=Object.keys(k.successCallbacks).length);t._networkCallback(n,e,r,u);t._jsonpRequestsCounts[e]===0&&(delete window[c],delete t._jsonpRequestsCounts[e])}),v&&v===t._requests[e]?v.abortCallback=function(r,u){var f=window[c]?window[c]:t.callbacks[p?c:t._normalCallbackName];f&&f(null,e,u===3?500:504,u);i.logNetworkData(n,u===3?"error":"aborted")}:t._logNetworkError(v,0,"downloadJsonp mismatch"),nt},t.abortRequest=function(n){var f,r,e,u;n&&(f=t._getParsedDispatchedKey(n),r=t._requests[f.requestId],r&&(e=Object.keys(r.successCallbacks).length,u=f.callbackId,i.assert(!!u,"Abort request should return back valid dispatchKey"),r.successCallbacks[u]&&(e>1?(r.errorCallbacks[u]&&r.errorCallbacks[u](r.callbackStates[u],4),delete r.errorCallbacks[u],delete r.callbackStates[u],delete r.successCallbacks[u]):r.abortCallback&&r.abortCallback(null,4))))},t._createXHR=function(n,i,r,u,f){var e=t._createBareXHRObject(),s,o,h;if(n.abortCallback=function(){e.abort()},e.onreadystatechange=function(){if(f&&f(e),e.readyState===4){var i=e.response||e.responseText;t._networkCallback(i,n.sourceUrl,e.status,2)}},e.open("GET",n.url),u&&(e.withCredentials=!0),r)for(s=Object.keys(r),o=0,h=s.length;o<h;o++)e.setRequestHeader(s[o],r[s[o]]);return i&&(e.responseType=i),e},t._createBareXHRObject=function(){var n=null,t=u.Internal.originalXMLHttpRequest;return typeof t!="undefined"?n=new t:typeof ActiveXObject!="undefined"&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n},t._downloadScript=function(n){var t=document.createElement("script");t.type="text/javascript";t.src=n.url;t.async=!0;t.onerror=function(){Microsoft.Maps.setTimeout(function(){n.abortCallback&&n.abortCallback(null,3)},0)};n.scriptElement=t;document.getElementsByTagName("head")[0].appendChild(t)},t._networkCallback=function(n,i,r,u){var f=t._requests[i],c,o,l,a,e,s;if(!f){window[i]===i&&(c="XsrPrefetchCallback",window[c]?window[c](n,i):window[i]=n);return}f.abortCallback=null;f.status===1&&(t._currentActiveRequests--,t._currentActiveRequestsByHostname[f.hostname]--);f.status=u||2;f.scriptElement&&f.scriptElement.parentNode&&f.scriptElement.parentNode.removeChild(f.scriptElement);f.scriptElement=null;i!==f.url&&delete t._requests[i];delete t._requests[f.url];o=f.status===2;o&&typeof r!="undefined"&&(o=r>=200&&r<300,o||(f.status=3));o&&f.parseResponseCallback&&r!==204&&(l=f.parseResponseCallback(n),o=l.succeeded,o||(f.status=3),n=l.response);var v=f.successCallbacks,y=f.callbackStates,p=f.errorCallbacks;if(f.successCallbacks={},f.callbackStates={},f.errorCallbacks={},o)try{for(e=0,s=Object.keys(v);e<s.length;e++)a=v[s[e]],a&&a(n,y[s[e]])}catch(h){if(Microsoft.Maps.logger)Microsoft.Maps.logger.logCriticalError(h);else throw h;}else try{for(t._logNetworkError(f,r),e=0,s=Object.keys(p);e<s.length;e++)p[s[e]](y[s[e]],f.status)}catch(h){if(Microsoft.Maps.logger)Microsoft.Maps.logger.logCriticalError(h);else throw h;}t._initiateRequest()},t._logNetworkError=function(n,t,r){var f=u.logger,e;n=n||{};f&&(r||n.status===3||n.status===5)&&(i.logNetworkData(n.url,"error"),e={feature:rt.Network,action:d.Error,data:{httpStatus:""+(t||""),status:""+n.status,cid:n.callerId||"",url:n.url||"",msg:r||""}},f.logCriticalError(null,e))},t._networkCallbackReverse=function(n,i){t._networkCallback(i,n)},t.doPost=function(n,i,r){var u=t._createBareXHRObject(),s=r.headers||{},f=r.onError||function(){},h=r.onSuccess||function(){},c=n,e,o;if(r.queryParameters){n.indexOf("?")<0&&(n+="?");for(e in r.queryParameters)r.queryParameters.hasOwnProperty(e)&&(n+="&"+encodeURIComponent(e)+"="+encodeURIComponent(r.queryParameters[e]))}u.open("POST",n,!0);u.timeout=t._requestTimeoutPeriodinMs;u.ontimeout=f;for(o in s)s.hasOwnProperty(o)&&u.setRequestHeader(o,s[o]);u.onabort=f;u.onerror=f;u.onreadystatechange=function(){u.readyState==4&&(u.status==200?h(u.responseText):f(u.responseText,u.status,u.statusText))};u.send(i)},t._getHostname=function(n){return n?(t._anchorElement||(t._anchorElement=document.createElement("a")),t._anchorElement.href=n,t._anchorElement.hostname):""},t._getNextRequest=function(){var r=-1,f=null,o=Date.now(),e,n,i,u;for(e in t._requests)n=t._requests[e],n.status===0&&(i=n.priority*1e3,u=t._currentActiveRequestsByHostname[n.hostname]?t._currentActiveRequestsByHostname[n.hostname]:0,i+=u>=t._maxConcurrentRequestPerDomain?1e4:u,(i<r||r===-1)&&(r=i,f=n));return f},t._initiateRequest=function(){var i,n;for(t._maxConcurrentRequest===-1&&(i=u.Internal._CoreConfig(),t._maxConcurrentRequest=i.maxConcurrentNetworkRequest,t._maxConcurrentRequestPerDomain=i.maxConcurrentNetworkRequestPerDomain);t._currentActiveRequests<t._maxConcurrentRequest;){if(n=t._getNextRequest(),!n)break;t._currentActiveRequests++;t._currentActiveRequestsByHostname[n.hostname]||(t._currentActiveRequestsByHostname[n.hostname]=0);t._currentActiveRequestsByHostname[n.hostname]++;n.status=1;n.executor(n)}},t._onImageRequestComplete=function(n,i,r){var u,f;r&&(u=r.image,u&&(u.onload=u.onerror=u.onabort=null),(n===4||n===5)&&(f=t._requests[i],f&&(f.isAborted=!0),r.release(),r=null));t._networkCallback(r,i,n===2?200:n===5?504:n===3?500:null,n)},t._getPooledImage=function(n,t){return vr.getPooledImage(n,t)},t._getJsonStateObject=function(n){for(var i=parseInt(f._getHash(n),16),r=t._requests[i.toString(16)];r&&r.sourceUrl!==n;)i++,r=t._requests[i.toString(16)];return i.toString(16)},t._getDispatchKey=function(n,i){return n+t._dispatchKeySeparator+i},t._getParsedDispatchedKey=function(n){var r,u,i;return n&&(i=n.toString().split(t._dispatchKeySeparator),i.length===1?r=i[0]:(u=i[0],r=i[1])),{requestId:r,callbackId:u}},t._appendClientApiParameter=function(n){var i=n.toLowerCase(),t=n;return u.ClientApi&&u.ClientApi.length>0&&(i.indexOf("dev.virtualearth.net/rest")>-1||i.indexOf("dev.ditu.live.com/rest")>-1)&&(t+=n.indexOf("?")>-1?"&":"?",t+="clientApi="+encodeURIComponent(u.ClientApi)),t},t._requests={},t._jsonpRequestsCounts={},t._currentActiveRequests=0,t._uniqueImageRequestId=0,t._uniqueCallbackId=0,t._timeoutTimerId=-1,t._currentActiveRequestsByHostname={},t._callbacksPrefix=window.$MicrosoftMaps8.toString()+".NetworkCallbacks.",t._callbackReplacementString="{callback}",t._dispatchKeySeparator="~DispatchKey~",t._mockJsonsoString="jsonso=",t._normalCallbackName="normal",t._reverseCallbackName="reverse",t._requestTimeoutPeriodinMs=25e3,t._imageRequestTimeoutPeriodinMs=15e3,t._minImageRequestTimeoutPeriodinMs=15e3,t._minRequestStartWaitTimeinMs=5,t._minTimeoutWatchDuration=1e3,t._maxConcurrentRequestPerDomain=-1,t._maxConcurrentRequest=-1,t.credentials="",t.callbacks={normal:t._networkCallback,reverse:t._networkCallbackReverse},t}(),ku=function(){function n(){if(n.instance)return n.instance}return n.prototype.getCopyrights=function(n,t,u,f,e,o,s,h,c){if(i.assertNotNull(t,"imageryId"),o=o||0,e=Math.round(e),t&&f&&e&&s){var l=n.replace(/{imagerySet}/,t).replace(/{productId}/,u).replace(/{zoom}/,e.toString()).replace(/{minLat}/,f[2].toString()).replace(/{minLon}/,f[3].toString()).replace(/{maxLat}/,f[0].toString()).replace(/{maxLon}/,f[1].toString()).replace(/{heading}/,o.toString()).replace(/{credentials}/,s).replace(/{mkt}/,r.dynamicProperties.market).replace(/{ml}/,h.getConfig().copyrightMapLayers);this._downloadCopyright(l,h,c)}},n.prototype._copyrightServiceCallback=function(n,t,i,u){var e,f;if(!t.isDisposed()){if(e=[],n)if(f=n.resourceSets&&n.resourceSets.length>0&&n.resourceSets[0]&&n.resourceSets[0].resources[0]&&n.resourceSets[0].resources[0].imageryProviders,f&&f.length>0&&f[0]!=="")Array.prototype.push.apply(e,f);else if(u&&t.getMapType().id===s.ordnanceSurvey&&u.indexOf("OrdnanceSurvey")>-1){u=u.replace("OrdnanceSurvey","RoadOnDemand");this._downloadCopyright(u,t,i);return}r.isMapsVertical||r.isMapsAnswer||e.push(this._getDefaultCopyright());i(e)}},n.prototype._downloadCopyright=function(n,t,i){var r=this,u=Math.floor(Math.random()*1e6).toString();tt.downloadJsonp(n,"copyright",function(u){return r._copyrightServiceCallback(u,t,i,n)},function(){return r._copyrightServiceCallback(null,t,i)},u.toString(),null,null,3)},n.prototype._getDefaultCopyright=function(){return String.fromCharCode(169)+" "+(new Date).getFullYear()+" Microsoft Corporation"},n.instance=new n,n}(),oi=function(){function n(n,t,i){this._imageryId=n;this._map=t;this._imageryCopyrightUrlFormat=i}return n.prototype.getCopyrights=function(n,t,i,r,u){var f=this;ti.instance.authenticateClientAndRetrieveSessionId(function(e){!f._map.isDisposed()&&e&&e.sessionId&&ku.instance.getCopyrights(f._imageryCopyrightUrlFormat,f._getImageryId(i),n,t,i,r,e.sessionId,f._map,u)})},n.prototype._getImageryId=function(n){var t=this._imageryId,i=this._map.getLabelController();return t==="Aerial"&&i&&i.getIsLabelsEnabled()&&(t+="WithLabels"),(t==="AerialWithLabels"||t==="Road")&&(t+="OnDemand"),t==="OrdnanceSurvey"&&(n>18||n<12)&&(t="RoadOnDemand"),t},n}(),du=function(n){function t(t,i,u,e,o,h){var c=n.call(this)||this,tt,v,it,k,rt,l,y,ut,d,p,w,a,g,ft,nt,et,ot;c._map=t;c._mapTemplateUrlFormat=i.mapTemplateUrlFormat;c._mapLiteTemplateUrlFormat=i.mapLiteTemplateUrlFormat;c._container=u;c._coreConfig=i;c._templateSelectorCache=new ci(50);c._miscCache=new ci(25);c._completionCallback=h;c._tileDomainName=o;c._pendingCount=i.mapTypeDefinitions.length;tt=c._customMapStyleManager=u.instance("CustomMapStyleManager");v=c._map.getMapOptions();v.customMapStyle&&(tt.update(v.customMapStyle),tt.useLiteMode&&(v.liteMode=!0));it=!!v.liteMode;c._dpiParam=t.getDpiScale()===2?"d2":"";var st=t.getZoomOffset(),ht=f._getUrlParam(window.location,"loadallstyles")==="1",b=i.mapTypeDefinitions;for(f._isFeatureEnabled("supportedMaps")&&(b=c._getSupportedMapTypeDefs(b,e)),k=0,rt=b.length;k<rt;k++)if(l=b[k],l&&l.mapTypeEnabled&&c._isMapTypeAvailable(l.mapType)){if(y=l.data,ut=l.liteModeAware,!r.isMapsAnswer&&!r.isMapsVertical&&!r.isMobile&&l.mapType===s.aerial)for(l.maxZoom=20,d=0;d<y.length;d++)if(p=y[d],p.imageryScenes)for(w=0;w<p.imageryScenes.length;w++)p.imageryScenes[w].imageryId==="Aerial"&&(p.imageryScenes[w].maxZoom=20);for(a=new sr(l,v,st),g=0,ft=y.length;g<ft;g++)(nt=y[g],et=!!nt.liteMode,nt.tilePrimer)||ut&&it!==et||a.insert(c._loadLayer(nt,a));ot=ht||a.id===e;c._loadTemplateAsync(v.enableBingStyle&&l.templateNameBing||l.templateName,it,a,ot);c[a.id]=a;c.insert(a)}return c}return p(t,n),t.prototype.dispose=function(){for(var n=0,t=this.length;n<t;n++)this[n].dispose();this._miscCache.clear();this._templateSelectorCache.clear();window.clearTimeout(this._timerId);this.clear();this._map=null},t.prototype.updateCustomMapStyle=function(n){this._customMapStyleManager.update(n)},t.prototype._getSupportedMapTypeDefs=function(n,t){var h=this._map.getMapOptions(),i=h.supportedMapTypes,c=[],l,a,u,v,e,y,o,p,f,r;if(i&&i.length!==0){if(l=[s.birdseye,s.birdseyeV2,s.streetside],a=i.length,l.indexOf(i[0])>-1){for(u=1;u<a;){if(f=i[u],l.indexOf(f)===-1){i[u]=i[0];i[0]=f;break}u++}u>=a&&(i=[s.road].concat(i))}for(this._coreConfig.defaultMapType=i[0],t&&h.mapType===t&&i.indexOf(t)<0&&(h.mapType=i[0]),v={},e=0,y=n;e<y.length;e++)r=y[e],r.mapTypeEnabled&&i.indexOf(r.mapType)>=0&&(v[r.mapType]=r);for(o=0,p=i;o<p.length;o++)f=p[o],r=v[f],r&&c.push(r)}else c=n;return c},t.prototype._isMapTypeAvailable=function(n){var i=this._map.getMapOptions(),t;switch(n){case s.birdseye:case s.birdseyeV2:return!i.disableBirdseye;case s.streetside:return t=r.features.streetside,!i.disableStreetside&&t&&t.isEnabled&&t.isCoverageLayerEntryPointEnabled;case s.ordnanceSurvey:return r.features.ordnanceSurvey.isEnabled;case s.grayscale:case s.canvasDark:case s.canvasLight:case s.getTilePrimerId(s.grayscale):case s.getTilePrimerId(s.canvasDark):case s.getTilePrimerId(s.canvasLight):return!r.isMapsVertical;case s.symbolicNight:return r.features.symbolicNight.isEnabled&&(r.isMapsVertical||r.isMapsAnswer);default:return!0}},t.prototype._loadLayer=function(n,t){var i,e,r,f,o,u;if(n.imageryScenes&&n.imageryScenes.length>0)for(e=i=new ft(n.id,n.zIndex,1,!0,undefined,undefined,undefined,this._map.getMapOptions().enableCORS),r=0,f=n.imageryScenes.length;r<f;r++)o=n.imageryScenes[r],this._addScene(f-r,e,o,t);else u=i=new or(n.id,null,null,n.zIndex),n.id.indexOf("Microsoft.Maps.OS")===0?this._getDelayLoadedDataSource("BaseMapOSDataSource").getObjectAsync(function(t){u.setDataSource(t.getLayerDataSource(n.vectorLayerId))}):t.id===s.streetside?this._getDelayLoadedDataSource("BaseMapStreetsideDataSource").getObjectAsync(function(t){u.setDataSource(t.getLayerDataSource(n.vectorLayerId))}):this._getDelayLoadedDataSource("BaseMapDataSource").getObjectAsync(function(t){u.setDataSource(t.getLayerDataSource(n.vectorLayerId))});return i.setVisible(n.visible?!0:!1),i.setRenderTarget(1),i.isBaseLayer=!0,i},t.prototype._addScene=function(n,t,i,u){var s=this,o=this._map,w=o.getMapOptions(),a=this._coreConfig,k={"{domain}":this._tileDomainName,"{protocol}":a.urlProtocol,"{tfeDomainDynamic}":a.tfeDomainDynamic,"{tfeDomainStatic}":a.tfeDomainStatic,"{tileUrlParam}":i.tileUrlParam,"{tileUrlWithoutLabelParam}":i.tileUrlWithoutLabelParam,"{cstl}":u.cstl,"{dpi}":this._dpiParam},v=w.allTileFeatures||r.isMapsVertical?i.tileFeaturesMapsVertical:i.tileFeaturesSDK,p=i.tileFeaturesWithoutLabel,h=f._replaceValues(i.tileUrl,k),d=w.backgroundColor,c;i.imageryId==="Mercator"&&d&&(h=this._getMercatorBackgroundTileUrl(d));c=f._replaceValues(i.tileUrlWithoutLabel,k);this._container.instanceAsyncAll([{name:"RasterImageryScene"},{name:"BirdseyeV2ImageryScene"},{name:"BirdseyeV2Crs"},{name:"EnhancedBirdseyeCrs"}],function(r){var a,k=i.maxZoom&&l.toScale(null,i.maxZoom,!0),d=i.minZoom&&l.toScale(null,i.minZoom,!0),w,g,u,it,rt,ut,ft;switch(i.imageryId){case"Synth":case"SynthWithLabels":for(g=["dir_n","dir_e","dir_s","dir_w"],u=0;u<4;u++){var f=u*90,nt=f-45,tt=f+45;w=new oi(i.imageryId,o,s._coreConfig.imageryCopyrightUrlFormat);it=h.replace("{dir}",g[u]);rt=c.replace("{dir}",g[u]);a=new r.RasterImageryScene(o,new y(l.toLocation(new e(0,0),0,!0)),new r.EnhancedBirdseyeCrs(f,s._coreConfig.elevationServiceUrl),i.imageryId,it,v,w,rt,p);t.addScene(n,a,nt,tt,k,d,i.bounds&&b.fromString(i.bounds))}break;case"BirdseyeV2":for(ut=["N","E","S","W"],ft=o.getMapOptions().birdseyeTransitionPaddingPtg,u=0;u<4;u++)f=u*90,nt=f-45,tt=f+45,w=new oi(i.imageryId,o,s._coreConfig.beV2ImageryCopyrightUrlFormat),a=new r.BirdseyeV2ImageryScene(o,new y(l.toLocation(new e(0,0),0,!0)),new r.BirdseyeV2Crs(f,s._coreConfig.birdseyeV2MetadataUrl.replace("{dir}",ut[u]),ft),i.imageryId,h,v,w,c,p),t.addScene(n,a,nt,tt,k,d,i.bounds&&b.fromString(i.bounds));break;default:w=new oi(i.imageryId,o,s._coreConfig.imageryCopyrightUrlFormat);a=r.RasterImageryScene.createMercatorImageryScene(i.imageryId,h,v,w,o,c,p,s._customMapStyleManager);t.addScene(n,a,0,360,k,d,i.bounds&&b.fromString(i.bounds))}},!r.isMapsVertical)},t.prototype._getDelayLoadedBaseMapTemplateSelector=function(n,t){var r=this,u=n,f=t?this._mapLiteTemplateUrlFormat:this._mapTemplateUrlFormat,i=this._templateSelectorCache.getItem(u);return i||(i=new fi(function(t){r._container.instanceAsync("BaseMapTemplateSelector",t,{mapTemplateUrlFormat:f,stlVersion:r._map.getConfig().stlVersion,templateName:n,hitTest:r._map.getIsMapHitTestable()})}),this._templateSelectorCache.addItem(u,i)),i},t.prototype._getDelayLoadedDataSource=function(n){var i=this,t=this._miscCache.getItem(n);return t||(t=new fi(function(t){i._container.instanceAsync(n,t,i._coreConfig)}),this._miscCache.addItem(n,t)),t},t.prototype._loadTemplateAsync=function(n,t,i,r){var u=this;if(!n)throw"_loadTemplateAsync called with null templateName";this._getDelayLoadedBaseMapTemplateSelector(n,t).getObjectAsync(function(n){r&&n.selectorReady();u._setTemplateSelector(n,i)})},t.prototype._setTemplateSelector=function(n,t){if(!n)throw"MapTypeCollection._setTemplateSelector called with null templateSelector";t.setTemplateSelector(n);for(var i=0;i<t.length;i++)t[i].setTemplateSelector(n);--this._pendingCount==0&&this._completionCallback&&(this._timerId=Microsoft.Maps.setTimeout(this._completionCallback,0,this))},t.prototype._getMercatorBackgroundTileUrl=function(n){var i=256,t=document.createElement("canvas"),r;return t.width=t.height=i,r=t.getContext("2d"),r.fillStyle=n,r.fillRect(0,0,i,i),t.toDataURL()},t}(it),gu=function(){function n(){}return n.prototype.attach=function(n){var t=this;i.assert(!this._eventHandlers,"A map has already been attached to this overlay behavior");this._map=n;this._eventHandlers=[];this._eventHandlers.push(n.primitiveTapped.add(function(n){return t._onPrimitiveTapped(n)}));this._eventHandlers.push(n.primitiveHoverStarted.add(function(n){return t._onPrimitiveHoverStarted(n)}));this._eventHandlers.push(n.primitiveHoverStopped.add(function(n){return t._onPrimitiveHoverStopped(n)}));this._eventHandlers.push(n.mapTapped.add(function(){return t._hideOverlay()}));this._eventHandlers.push(n.mapZoomStarted.add(function(){return t._hideOverlay()}));this._eventHandlers.push(n.mapZoomChanged.add(function(){return t._hideOverlay()}));this._eventHandlers.push(n.mapModeChanged.add(function(){return t._hideOverlay()}));this._eventHandlers.push(n.contextMenuInvoked.add(function(){return t._hideOverlay()}))},n.prototype.detach=function(){i.assertNotNull(this._eventHandlers,"This overlay behavior is not currently attached to a map");this._hideOverlay();this._eventHandlers.forEach(function(n){n.dispose();n=null});this._eventHandlers=null;this._map=null},n.prototype._onPrimitiveHoverStarted=function(n){var t=n.layer;t&&2===t.overlayEvent&&this._showOverlay(t,n.primitive)},n.prototype._onPrimitiveHoverStopped=function(n){var t=n.layer;t&&2===t.overlayEvent&&this._hideOverlay()},n.prototype._onPrimitiveTapped=function(n){var t=n.layer;t&&1===t.overlayEvent&&(this._overlayPrimitive&&this._hideOverlay(),this._showOverlay(t,n.primitive))},n.prototype._showOverlay=function(n,t){yi.showOverlay(this._map,n,t);this._overlayPrimitive=t},n.prototype._hideOverlay=function(){yi.hideOverlay(this._map,this._overlayPrimitive);this._overlayPrimitive=null},n}(),nf=function(){function n(n,t){this.cause=n;this.animation=t}return n}(),cr=function(){function n(n,t){this.oldMapTypeId=n;this.newMapTypeId=t}return n}(),yt=function(){function n(n,t){this.cause=n;this.isInAnimation=t||!1}return n}(),lr=function(){function n(n,t,i,r){this._map=n;this._location=t;this._point=i;this.duration=r?r:225}return n.prototype.getLocation=function(){return this._location},n.prototype.getPoint=function(){return this._point},n.prototype.interpolate=function(n,t,r){var e;i.assert(n.cameraLocation.altitudeReference===t.cameraLocation.altitudeReference,"Can't interpolate between different altitude references");var o=n.cameraLocation.altitude,h=t.cameraLocation.altitude,s=(h-o)*r+o,u,f=this._map.getMode();return f.mapModeType===0?(e=f.getTileSize(),this._updateMapView(f.getCurrentCrs(),e.width,e.height,this._map.getActualSize(),t.heading,s,t.cameraLocation.altitudeReference)):(u=this._map.getMode().getCameraForLocationToPoint(this._location,this._point,s,t.cameraLocation.altitudeReference),this._mapView?(this._mapView.cameraLocation=u,this._mapView.heading=t.heading):this._mapView=new y(u,t.heading)),this._mapView},n.prototype._updateMapView=function(n,t,i,r,u,f,o){var a;this._location.altitude=f;var c=Math.pow(2,l.fromLocation(this._location,!0)),v=c*t,p=c*i,w=n.projectToX(this._location.latitude,this._location.longitude),b=n.projectToY(this._location.latitude,this._location.longitude),s=w-(this._point.x-r.width/2)/v,h=b-(this._point.y-r.height/2)/p;this._mapView?(this._mapView.cameraLocation.latitude=n.toLatitude(s,h),this._mapView.cameraLocation.longitude=n.toLongitude(s,h),this._mapView.cameraLocation.altitude=f,this._mapView.cameraLocation.altitudeReference=o,this._mapView.heading=u):(a=new e(n.toLatitude(s,h),n.toLongitude(s,h),f,o),this._mapView=new y(a,u))},n}(),si=function(){function n(n,t){this.zoom=l.fromLocation(n.getView().cameraLocation,!0);this.location=t.getLocation();this.point=t.getPoint()}return n}(),ti=function(){function n(t,i,u,f,e){var o,h,c,s;return this._validAuthenticationResultCode="ValidCredentials",this._invalidCredentialsMessage="The specified credentials are invalid. You can sign up for a free developer account at ",this._devSignUpUrl="http://www.bingmapsportal.com",n.instance?(o=n.instance,t&&o._hasValidCredentials===!1&&(o._map=e,o._credentials=t,o._logServiceResponse=null,o._hasValidCredentials=undefined)):(h=r.dynamicProperties,this._map=e,c=e&&e.getMapOptions(),s=h.sessionKey||c&&c.sessionKey,this._credentials=s||h.credentials||t,this._logServiceUriFormat=i,this._logger=u,this._callbackPool=[],this._logServiceResponse=s?{authenticationResultCode:this._validAuthenticationResultCode,sessionId:this._credentials}:null,this._hasValidCredentials=s?!0:undefined,s&&(tt.credentials=s),this._authFailureCount=0,n.instance=o=this),this._hasValidCredentials||(f?o._credentials||(o._hasValidCredentials=!1):o.authenticateClientAndRetrieveSessionId(null,e)),o}return n.prototype.authenticateClientAndRetrieveSessionId=function(t,i){var u=this,f;this._logServiceResponse?t&&t(this._logServiceResponse):this._credentials?this._authFailureCount<=n._maxAuthenticationRetries&&(this._callbackPool.push(t),(this._callbackPool.length===1||this._authenticationFailed)&&(this._authenticationFailed=!1,f=this._logServiceUriFormat.replace(/{credentials}/,this._credentials).replace(/{mkt}/,r.dynamicProperties.market).replace(/{name}/,"MVC"),tt.downloadJsonp(f,"auth",function(n){return u._logServiceSuccessCallback(n,i)},function(){return u._logServiceErrorCallback(i)},"_logCallbackRequest"))):(this._hasValidCredentials=!1,this._showInvalidCredentialsError(i))},n.prototype.getInvalidCredentialsMessage=function(){return this._invalidCredentialsMessage+this._devSignUpUrl},n.prototype.getSessionId=function(){var n;return this._logServiceResponse&&this._logServiceResponse.authenticationResultCode===this._validAuthenticationResultCode&&(n=this._logServiceResponse.sessionId),n||this._credentials},n.prototype.hasValidCredentials=function(){return this._hasValidCredentials!==!1},n.prototype._logServiceSuccessCallback=function(n,t){i.assertNotNull(n,"response");this._hasValidCredentials=n.authenticationResultCode===this._validAuthenticationResultCode;this._hasValidCredentials&&(tt.credentials=n.sessionId);this._logServiceResponse=n;this._hasValidCredentials||this._showInvalidCredentialsError(t);this._callbackPool.forEach(function(t){try{t&&t(n)}catch(i){}});this._callbackPool=[]},n.prototype._logServiceErrorCallback=function(t){var r=this,f,i,e;this._authFailureCount++<n._maxAuthenticationRetries?Microsoft.Maps.setTimeout(function(){r._authenticationFailed=!0;r.authenticateClientAndRetrieveSessionId(null,t)},this._authFailureCount*100):(f={authenticationResultCode:this._validAuthenticationResultCode,sessionId:this._credentials},this._logServiceSuccessCallback(f,this._map),i=u.logger,i&&(e={feature:rt.MapControl,action:d.Error,data:{errorMessage:"MapAuthentication failed after "+n._maxAuthenticationRetries+" tries."}},i.logCriticalError(null,e)))},n.prototype._showInvalidCredentialsError=function(n){var i=n||this._map;if(i){var t=f._createElement("div").set_attr("aria-label",this.getInvalidCredentialsMessage()),u=f._createElement("div").appendTo(t).set_text(this._invalidCredentialsMessage).set_style({background:"#f8f7f5",padding:"10px",color:"#000",fontSize:"14px"}),e=f._createElement("a").appendTo(u).set_attr("href",this._devSignUpUrl).set_text(this._devSignUpUrl),r=i.getRootElement();r[0].insertBefore(t[0],r[0].firstChild);t.set_style({position:"absolute",overflow:"hidden",width:"100%",top:"50%",textAlign:"center",zIndex:9999}).set_attr("tabindex","0").set_attr("role","alert")}else console.error(this.getInvalidCredentialsMessage())},n._maxAuthenticationRetries=5,n}(),tf=function(){function n(){}return n.getMercatorZoomLevel=function(n){return n.getMercatorZoomLevel()},n.getMapBounds=function(n,t){return n.getBounds(t)},n.getViewportCenter=function(n,t,i){var r=t||n.getViewportPadding(),i=i||n.getActualSize();return new h(r.left+(i.width-r.left-r.right)/2,r.top+(i.height-r.top-r.bottom)/2)},n.getViewportCenterOffset=function(t){var i=n.getViewportCenter(t),r=t.getActualSize();return new nt(i.x-r.width/2,i.y-r.height/2)},n.getMapCenter=function(t){var i=n.getViewportCenter(t);return t.getMode().tryPointToLocation(i)},n.setMapCenter=function(t,i,r,u,f,e,o,s,h){var c=n.constructView(t,i,r,u,o,s,h);return t.setView(c,f,e),c},n.constructView=function(t,i,r,u,f,e,o){typeof r!="number"&&(r=n.getMercatorZoomLevel(t));f!==!0&&(r=Math.floor(r));(typeof u=="undefined"||u===null)&&(u=t.getView().heading);var s=t.getMode(),h=n.getViewportCenter(t,e,o),c=s.getCameraForLocationToPoint(i,h,l.toAltitude(i,r,!0),0,o);return new y(c,u)},n.setZoomLevel=function(t,i,r,u){var f=n.getMapCenter(t);n.setMapCenter(t,f,i,null,r,u)},n.zoomAroundLocation=function(n,t,i,r,u,f){var e=n.getMapOptions().navigationOptions;if((!e||!e.lockCameraAltitude)&&n.canZoom(i)){var o=n.getMode(),s=o.tryLocationToPoint(t),h=o.getMapViewZoomedAboutLocation(n.getTargetView(),t,i,f),c=r?new lr(n,t,s):null;n.setView(h,c,u)}},n.centerMapIfPrimitiveOutOfView=function(t,i){var f=n.getMapBounds(t,!0),r=i.geometry,u=new e(r.y,r.x);f.contains(u)||n.setMapCenter(t,u,t.getMercatorZoomLevel())},n.getZoomLevelForLocationsToBecomeVisible=function(t,i,r,u){var h,v;if(!i||i.length===0)return null;var o=0,s=0,c,a,f=r||n.getMapCenter(t);for(h=0,v=i.length;h<v;h++)c=Math.abs(f.latitude-i[h].latitude),c>o&&(o=c),a=Math.abs(f.longitude-i[h].longitude),a>s&&(s=a);try{var p=new e(f.latitude-o,f.longitude+s),w=new e(f.latitude+o,f.longitude+s),b=new e(f.latitude+o,f.longitude-s),k=new e(f.latitude-o,f.longitude-s),d=t.getMode().getMapViewForLocationsInView([b,k,p,w],u),y=l.fromLocation(d.cameraLocation,!0);return y<3?NaN:y}catch(g){return NaN}},n._getColorMapping=function(n){switch(n){case 1:case 2:case 3:return n-1;case 7:return 3;case 4:return 4;case 8:return 5;default:return 0}},n}(),rf=function(o){function a(u,e,h,c,v,p,w){var b=this,ht={},rt,ct,g,ut,d,ft,et,k,yt,pt,ot;b=o.call(this,ht)||this;b._mapOptions=e=a._initializeMapOptions(e,c);r.isMapsVertical||(c.clickBasemapPrimitives=!1);e.disableInstrumentation&&(r.enableInstrumentation=!1,r.enableErrorInstrumentation=!1,r.perfSDKInclusions=null);rt={position:"absolute",overflow:"hidden",width:"100%",height:"100%",top:"0",left:"0"};b._privates=ht;b._disposables=[];b._disposables.push(b._workDispatcher=w);f._getUrlParam(window.location,"labelTest")&&(ct=f._createElement("div").set_attr("id","labelTestHook").appendTo(u),i.setLabelLogElement(ct));tt.credentials=e.credentials;b._id=a._nextMapId++;b._container=h;b._disposables.push(b._container);b._coreConfig=c;b._processDpiOptions();u=b._parentElement=n(u);g=b._rootElement=f._createElement("div").appendTo(u).add_class(dr).set_style({"-ms-touch-action":"none"});b._sizeHelper=new di(g);b._disposables.push(b._sizeHelper);b._disposables.push(b._sizeHelper.resize.add(function(n){b._privates.setActualSize(n[0]);b.mapResized.invoke()}));b._modeElement=f._createElement("div").appendTo(g).set_style(rt);b._overlayElement=f._createElement("div").appendTo(g).set_style(rt).set_style({pointerEvents:"none",transform:"scale(1)"});b._overlayElement.set_style({"z-Index":100});e.allowInfoboxOverflow&&b._overlayElement.set_style({overflow:"visible"});b._disposables.push(b.copyrightControlLoaded=new t,b.frameManagerLoaded=new t,b.labelControllerLoaded=new t,b.navigationBarLoaded=new t,b.mapTypeButtonClicked=new t,b.constrainView=new t,b.viewChanging=new t,b.viewChanged=new t,b.targetViewChanged=new t,b.mapResized=new t,b.primitiveTapped=new t,b.primitiveDoubleTapped=new t,b.primitiveHoverStarted=new t,b.primitiveHoverStopped=new t,b.primitiveMoveStarted=new t,b.primitiveMoveContinued=new t,b.primitiveMoveStopped=new t,b.primitiveManipulationStarted=new t,b.primitiveManipulationContinued=new t,b.primitiveManipulationStopped=new t,b.boxZoomStarted=new t,b.boxZoomContinued=new t,b.boxZoomStopped=new t,b.boxZoomCancelled=new t,b.mapPanStarted=new t,b.mapPanContinued=new t,b.mapPanStopped=new t,b.mapZoomStarted=new t,b.mapZoomContinued=new t,b.mapZoomStopped=new t,b.mapManipulationStarted=new t,b.mapManipulationContinued=new t,b.mapManipulationStopped=new t,b.mapTapped=new t,b.mapDoubleTapped=new t,b.keyPressed=new t,b.keyReleased=new t,b.pointerMoved=new t,b.pointerEntered=new t,b.pointerExited=new t,b.pointerWheelChanged=new t,b.pointerPressed=new t,b.pointerReleased=new t,b.contextMenuInvoked=new t,b.copyrightChanged=new t,b.mapTypeChanged=new t,b.mapTypeChangeStarted=new t,b.mapModeChanged=new t,b.actualSizeChanged=new t,b.mapZoomChanged=new t,b.mapRadialMenuChanged=new t,b.setViewInvoked=new t,b.interactionModeUpdated=new t,b.mapOptionsChanged=new t,b.viewChangingAfterPaint=new t,b.birdseyeV2SceneTransitioned=new t,b.modeDOMsMounted=new t);b._disposables.push(b.mapOptionsChanged.add(function(n){b.updateMapOptions(b._mapOptions,n)}),b.mapPanStarted.add(function(){b._isPanning=!0}),b.mapPanStopped.add(function(){b._isPanning=!1}));ut=null;e.testHooksOptions&&(e.testHooksOptions.perfRun&&i.setPerfRun(!0,!0),e.testHooksOptions.debugRun&&i.setDebugRun(!0),e.testHooksOptions.enableFunctionalTestHooks&&i.setTestHook(u,c,b),e.testHooksOptions.perfTest&&(ut="perfTest"));b._mapOverlayBehavior=new gu;b._mapOverlayBehavior.attach(b);var lt=b._getDefaultSize(u),at=lt.width,vt=lt.height;return b._privates.defineProperty("baseLayers",function(n,t){return b._onMapTypeChanged(n,t)},function(n,t){return b._resolveMapType(n,t)}),b._privates.defineProperty("mode",function(n,t){return b._onModeChanged(n,t)}),b._privates.defineProperty("actualSize",function(n,t){return b._onActualSizeChanged(n,t)},null,{isPrivate:!0}),b._privates.defineProperty("desiredSize",function(n,t){return b._onDesiredSizeChanged(n,t)},null,{defaultValue:new nt(at,vt)}),b._privates.defineProperty("viewportPadding",null,function(n){return b._setViewportPadding(n)},{defaultValue:{left:0,top:0,right:0,bottom:0}}),b._disposables.push(b._mapTypes=new du(b,c,h,e.mapType,e.tileDomainName),b._layers=new it),e.center?(d={center:e.center,zoom:undefined},e.center.altitude&&(d.zoom=l.fromLocation(e.center,!0))):d=a._getBootstrapLocation(),i.assert(c.defaultZoomLevel>0,"defaultZoomLevel in config is set to incorrect value. coreConfig.defaultZoomLevel = "+c.defaultZoomLevel),(!c.defaultZoomLevel||c.defaultZoomLevel<=0)&&(c.defaultZoomLevel=11),ft=typeof e.zoom=="number"?e.zoom:d.zoom||c.defaultZoomLevel,et=c.defaultMapType||s.road,k=e&&e.mapType||et,k===s.birdseye&&(b.getMapOptions().disableBirdseye||ft<=b._coreConfig.aerialCutOffZoom)&&(k=s.aerial),e.disableStreetside&&(k===s.streetside&&(k=et),e.disableStreetsideAutoCoverage=!0),b._disposables.push(b._allLayers=new eu(b)),b.setBaseLayers(b._resolveMapType(k,b.getMapTypes()[s.road])),h.registerInstance("Map",b),h.registerInstance("allLayers",b._allLayers),yt=new ti(b._mapOptions&&b._mapOptions.credentials,b._coreConfig.logServiceUrlFormat,v,!1,b),yt.authenticateClientAndRetrieveSessionId(null,b),b._instrumentationManager=new pu(b,v,p,ut),b._landmarksManagerPromise=new st,b._overlayManager=new st,b._cityPolygonManagerPromise=new st,b._birdseyeV2ManagerPromise=new st,b._disposables.push(b._instrumentationManager),pt=e.heading||0,b.setMinZoom(b._mapOptions.minZoom,!1),b.setMaxZoom(b._mapOptions.maxZoom,!1),b.setDesiredSize(new nt(at,vt)),b._bootstrapState=0,ot=b.getView()||new y(l.toLocation(d.center,ft,!0),pt),k===s.streetside?b._instantiateMapInStreetsideMapMode(ot):b._instantiateMapInCompositeMapMode(ot),b._processNavigationBarMapOptions(),r.disposeMapOnPageHide&&(b._pageHideHandler=function(){b.dispose()},n(window).add_event("pagehide",b._pageHideHandler)),(n.Browser.is_ie||n.Browser.is_edge)&&n(window).add_event("beforeunload",b._beforeUnloadDummyHandler),b}return p(a,o),a.prototype.getCopyrightControl=function(){return this._coreConfig.useOverlayQuadrants&&this._mapOverlayManager?this._mapOverlayManager.getCopyrightControl():this._copyrightControl},a.prototype.getLogoControl=function(){return this._coreConfig.useOverlayQuadrants&&this._mapOverlayManager?this._mapOverlayManager.getLogoControl():this._logoControl},a.prototype.getSizeHelper=function(){return this._sizeHelper},a.prototype.getDefaultAerialZoomCutOffForBirdsEyeMode=function(){return this._coreConfig.aerialCutOffZoom},a.prototype.getId=function(){return this._id},a.prototype.getConfig=function(){return this._coreConfig},a.prototype.getDpiScale=function(){return this._tileDpiScale},a.prototype.getLabelDpiScale=function(){return this._labelDpiScale},a.prototype.getZoomOffset=function(){var n=this.getDpiScale();return n>1?Math.floor(c.log2(n)):0},a.prototype.getLabelController=function(){return this._labelController},a.prototype.getNavigationBar=function(){return this._navigationBar},a.prototype.getScaleBar=function(){return this._coreConfig.useOverlayQuadrants&&this._mapOverlayManager?this._mapOverlayManager.getScaleBar():this._scaleBarControl},a.prototype.getMapOptions=function(){return this._mapOptions},a.prototype.getLayers=function(){return this._layers},a.prototype.getAllLayers=function(){return this._allLayers},a.prototype.getOverlays=function(){return this._overlayCollection},a.prototype.getMapOverlayManager=function(){return this._mapOverlayManager},a.prototype.getRootElement=function(){return this._rootElement},a.prototype.getContainer=function(){return this._container},a.prototype.getMapTypes=function(){return this._mapTypes},a.prototype.getLandmarksManager=function(){return this._landmarksManagerPromise},a.prototype.getOverlayManager=function(){return this._overlayManager},a.prototype.getCityPolygonManager=function(){return this._cityPolygonManagerPromise},a.prototype.getBirdseyeV2Manager=function(){return this._birdseyeV2ManagerPromise},a.prototype.isLocationInView=function(n){var i=this.getMode(),t;return n&&i?(t=i.tryLocationToPoint(n),t&&t.x>=0&&t.x<=this.getActualSize().width&&t.y>=0&&t.y<=this.getActualSize().height):!1},a.prototype.getFrameManager=function(){return this._frameManager},a.prototype.isDisposed=function(){return this._isDisposed},a.prototype.isPanning=function(){return this._isPanning},a.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,o.prototype.dispose.call(this),this._viewStoryboard&&this._viewStoryboard.abort(),this._mapOverlayBehavior&&this._mapOverlayBehavior.detach(),this._overlayElement.clear()&&this._overlayElement.removeFromParent(),this._modeElement.clear()&&this._modeElement.removeFromParent(),this._rootElement.clear()&&this._rootElement.removeFromParent(),this._parentElement.clear(),(n.Browser.is_ie||n.Browser.is_edge)&&n(window).remove_event("beforeunload",this._beforeUnloadDummyHandler),this._pageHideHandler&&n(window).remove_event("pagehide",this._pageHideHandler),f._clearDisposables(this._disposables),f._nullifyClass(this))},a.prototype.getSessionId=function(){return ti.instance.getSessionId()},a.prototype.getAuthKey=function(){return this.getSessionId()||this._mapOptions&&this._mapOptions.credentials},a.prototype.getView=function(){return this._view},a.prototype.getTargetView=function(){return this._targetView},a.prototype.getViewport=function(){var n=this.getBounds(),t=this.getActualSize()||{width:0,height:0},i=t.width,r=t.height;return new u.Viewport(i,r,n.bounds,n.crs)},a.prototype.getMercatorZoomLevel=function(){return this._view?l.fromLocation(this._view.cameraLocation,!0):0},a.prototype.getBounds=function(n,t){var u=t?t:this.getView(),r,l,a,v,y;if(!u)return new b(new e(0,0),0,0);r=n?this.getViewportPadding():{left:0,right:0,top:0,bottom:0};var o=this.getActualSize(),s=new h(r.left,r.top),p=new h(o.width-r.right,r.top),c=new h(o.width-r.right,o.height-r.bottom),w=new h(r.left,o.height-r.bottom),i,f=this.getMode();if(u.heading===0?(l=f.tryPointToLocation(s,u),a=f.tryPointToLocation(c,u),i=b.fromCorners(l,a)):(v=new ri,i=v.accumulateLocations([f.tryPointToLocation(s,u),f.tryPointToLocation(p,u),f.tryPointToLocation(c,u),f.tryPointToLocation(w,u)])),f.getTileSize){var k=this.getMercatorZoomLevel(),d=Math.pow(2,k),g=d*f.getTileSize().width;o.width>g&&(i=b.fromEdges(i.getNorth(),-180,i.getSouth(),180))}return y=1e-9,i.width<=y&&(i=b.fromEdges(i.getNorth(),-180,i.getSouth(),180)),i},a.prototype.getCopyrights=function(n){var t=this.getMode();t&&t.getCopyrights(n)},a.prototype.getIsMapHitTestable=function(){return this._mapOptions&&this._mapOptions.testHooksOptions&&this._mapOptions.testHooksOptions.hitTest},a._getBootstrapLocation=function(){var t=r.dynamicProperties,n=t.location,o,h;if((!n||n==="0,0")&&(n=t.reverseIPLocation,!n)){var s=ii,u=parseFloat(s.getItem("centerLatitude")),f=parseFloat(s.getItem("centerLongitude"));if(isFinite(u)&&isFinite(f)){if(o=parseFloat(s.getItem("zoom")),isFinite(o))return h=l.toAltitude(new e(u,f),o,!0),{center:new e(u,f,h),zoom:o};n=u+","+f}else n=t.marketLocation,i.assert(!!n,"unable to determine bootstrap location"),n||(n="47.603569,-122.329453")}return{center:e.parseLatLong(n),zoom:t.zoom}},a.prototype.setView=function(t,r,f,e){function ut(n,t){i.groupCollapsed(null,"Animation frame: {0}",t.percent.toString());var u=r.interpolate(h,s,t.percent),e=o._view;o._view=u;o._raiseViewChangingEvent(new yt(f,!0));tt(r)&&o.mapZoomContinued.hasHandlersRegistered()&&o.mapZoomContinued.invoke(new si(o,r));i.groupEnd()}function ft(){var n=function(){var t=o._view,n;o._view=o._targetView;o._saveView();o.changed.invoke(new vt(o,"view",t,o._view));o.viewChanged.invoke(new yt(f));tt(r)&&o.mapZoomStopped.hasHandlersRegistered()?o.mapZoomStopped.invoke(new si(o,r)):(n=o.getFrameManager(),n&&n.hackHackSetFrame());o.copyrightChanged&&o.copyrightChanged.invoke()};o._workDispatcher.dispatch(n,a._animationFrameWorkDispatcherKey,0)}function tt(n){return u.ZoomAroundLocationAnimator?n instanceof u.ZoomAroundLocationAnimator:!1}var o,w,b,h,s,k,c,v,d,g,rt,nt;if(!this._isDisposed&&(i.assertNotNull(t,"mapView"),i.assertNotNull(t.cameraLocation,"mapView.cameraLocation"),i.assert(t.cameraLocation.altitudeReference!==-1,"Invalid AltitudeReference"),o=this,f=f||0,(f===1||f===2)&&this._mapOptions&&this._mapOptions.navigationOptions&&(w=this._mapOptions.navigationOptions,w.lockCameraAltitude&&(t.cameraLocation.altitude=this._targetView.cameraLocation.altitude,t.cameraLocation.altitudeReference=this._targetView.cameraLocation.altitudeReference),this._enforceMinMaxAltitude(t),w.lockCameraHeading&&(t.heading=this._targetView.heading)),e||!y.areEqual(t,this._targetView))&&(this._view=this._view||t,b=this._getConstrainViewArgs(t,f),!b.cancel)){h=this._view;s=t;r&&(this._workDispatcher&&this._workDispatcher.cancelAllDispatch(),h=h.clone(),s=s.clone(),k=h.cameraLocation.longitude,c=s.cameraLocation.longitude,Math.abs(k-c)>180&&(k<0?c-=360:c+=360,s.cameraLocation.longitude=c));this._workDispatcher&&this._workDispatcher.cancelDispatchWithKey(a._animationFrameWorkDispatcherKey,0);var p=this._viewStoryboard,it=0,l=0;p&&(l=p.get_duration(),it=(1-p.get_position())*l,p.abort(),this._viewStoryboard=null);t=b.view;v=this._targetView;this._targetView=t;v&&t&&v.cameraLocation&&t.cameraLocation&&(y.areCameraAltitudesEqual(v,t)||this.mapZoomChanged.invoke());this.changed.invoke(new vt(this,"targetView",v,t));this.targetViewChanged.invoke(new nf(f,r));d=r?r.duration:0;l=Math.max(l,a._viewChangeMaxPercent*d);g=Math.min(it+d,l);r&&g>0?(this._viewStoryboard=n.Effects.Storyboard.create([this],{percent:0},{percent:1},ut,g,null,ft,function(n){return n},a._animationInterval),this._viewStoryboard.begin(),tt(r)&&this.mapZoomStarted.hasHandlersRegistered()&&this.mapZoomStarted.invoke(new si(this,r))):(rt=this._view,this._view=t,this.changed.invoke(new vt(this,"view",rt,t)),this._raiseViewChangingEvent(new yt(f,!0)),f!==2&&(this.viewChanged.invoke(new yt(f)),this.copyrightChanged&&this.copyrightChanged.invoke(),this._saveView(),this._coreConfig.disableHachHackSetFrame||(nt=this.getFrameManager(),nt&&nt.hackHackSetFrame())))}},a.prototype.canZoom=function(n){if(this._isDisposed)return!1;var r=this.getMode(),i=this.getTargetView(),u=i.cameraLocation,t=r.getMapViewZoomedAboutLocation(i,u,n);return t=this._getConstrainViewArgs(t).view,this._enforceMinMaxAltitude(t),!y.areCameraAltitudesEqual(i,t)},a.prototype.getMapType=function(){return this._mapType},a.prototype.setMapType=function(n){if(typeof n=="string"&&(n=this._resolveMapType(n)),!this._isDisposed&&n!==this._mapType){var t=this._mapType;this.setBaseLayers(this._resolveMapType(n))}},a.prototype.createMapType=function(n){return this._resolveMapType(n)},a.prototype.getTemplateSelector=function(){return this._mapType&&this._mapType.getTemplateSelector()},a.prototype.setMinZoom=function(n,t,i){var r,u,f;if(typeof n=="number"){if(t!==!1&&(t=!0),n=Math.round(n),r=l.toAltitude(new e(0,0),n,!0),u=this._mapOptions.navigationOptions.minCameraAltitude,typeof u=="number"&&r<u)throw"minZoom to set is greater than map's currently allowed maximum zoom level";i!==!1&&(this._mapOptions.minZoom=n);this._mapOptions.navigationOptions.maxCameraAltitude=r;t&&this._targetView.cameraLocation.altitude>r&&(f=this._targetView.cameraLocation.clone(),f.altitude=r,this.setView(new y(f)))}},a.prototype.setMaxZoom=function(n,t){var i,r,u;if(typeof n=="number"){if(t!==!1&&(t=!0),n=Math.round(n),i=l.toAltitude(new e(0,0),n,!0),r=this._mapOptions.navigationOptions.maxCameraAltitude,typeof r=="number"&&i>r)throw"maxZoom to set is smaller than map's currently allowed minimal zoom level";this._mapOptions.maxZoom=n;this._mapOptions.navigationOptions.minCameraAltitude=i;t&&this._targetView.cameraLocation.altitude<i&&(u=this._targetView.cameraLocation.clone(),u.altitude=i,this.setView(new y(u)))}},a.prototype.setMaxBounds=function(n,t){var i,r;t!==!1&&(t=!0);i=this.getMode().getMapViewForLocationsInView([new e(n.getNorth(),n.getEast()),new e(n.getSouth(),n.getWest())]);typeof this._mapOptions.minZoom!="number"&&this.setMinZoom(l.fromLocation(i.cameraLocation,!0),!1,!1);this._mapOptions.maxBounds=n;t&&(this._view?(r=this._getConstrainViewArgs(this._view.clone(),0),this.setView(r.view)):this.setView(i))},a.prototype.setMapLayerHighlight=function(n,t){for(var r,u=!1,i=0;i<this._layers.length;i++)if(r=this._layers[i],r.getId()===n){u=!0;r.setHighlighted(t);break}return u},a._initializeMapOptions=function(n,t){n=n||{credentials:null};var r=n.labelOptions=n.labelOptions||{},i=n.navigationOptions=n.navigationOptions||{};if(n.trafficOptions=n.trafficOptions||{},n.showCopyright=typeof n.showCopyright=="boolean"?n.showCopyright:!0,n.liteMode=typeof n.liteMode=="boolean"?n.liteMode:t.liteMode,typeof i.minZoomFraming=="number"||(i.minZoomFraming=3),typeof i.lockCameraHeading!="boolean"&&(i.lockCameraHeading=!0),(typeof n.disableStreetside=="undefined"||n.supportedMapTypes===null)&&(n.disableStreetside=!1),n.showDashboard=typeof n.showDashboard=="boolean"?n.showDashboard:!0,n.showScalebar=typeof n.showScalebar=="boolean"?n.showScalebar:!0,n.mapType&&!s.isValid(n.mapType))throw"Invalid map type";return typeof r.labelVisibility=="undefined"&&(r.labelVisibility=pt.visible),n.liteMode||(r.testRenderStyles=!1),n.tileDomainName=n.tileDomainName||t.tfeDomainDynamic,n.supportedMapTypes||(n.supportedMapTypes=[s.road,s.aerial,s.birdseye,s.streetside,s.ordnanceSurvey],f._isFeatureEnabled("birdseyeV2UI")&&n.supportedMapTypes.splice(2,1,s.birdseyeV2)),n.liteMode&&(n.showLandmarks=!1),n},a.prototype._raiseViewChangingEvent=function(n){this.viewChanging.invoke(n);this._previousViewChangeArg=n;this._onPaintEventHandler||this._raiseViewChangingAfterPaintEvent()},a.prototype._raiseViewChangingAfterPaintEvent=function(){this._previousViewChangeArg&&(this.viewChangingAfterPaint.invoke(this._previousViewChangeArg),this._previousViewChangeArg=null)},a.prototype._getDefaultSize=function(n){var i,u,t,e,o,f;if(r.isMapsVertical)return new nt(-1,-1);for(t=n;t.length>0;){if(t[0].tagName==="HTML"||i===-1&&u===-1)break;typeof Element=="function"&&t[0]instanceof Element?(e=parseFloat(t.get_style("width")),o=parseFloat(t.get_style("height")),e>0&&(i=-1),o>0&&(u=-1)):(f=t.get_size(),f.width>0&&(i=-1),f.height>0&&(u=-1));t=t.parent()}return i=i===-1?i:-2,u=u===-1?u:-2,new nt(i,u)},a.prototype._resolveMapType=function(n,t){var i,u;return this._isDisposed?null:(t||(t=this.getMapTypes()[s.road]),i=t,typeof n=="string"?(u=this._mapTypes[n],u&&((n!==s.ordnanceSurvey||!r.features.ordnanceSurvey.isEnabled)&&n===s.ordnanceSurvey||(i=u))):i=n,i)},a.prototype._setViewportPadding=function(n){n=n||{};return{left:n.left||0,top:n.top||0,right:n.right||0,bottom:n.bottom||0}},a.prototype._saveView=function(){if(!this._isDisposed){var t=this.getView().cameraLocation,n=this._coreConfig.locateMeViewExpirationDays;ii.setItem("centerLatitude",t.latitude.toString(),n);ii.setItem("centerLongitude",t.longitude.toString(),n);ii.setItem("zoom",this.getMercatorZoomLevel().toString(),n)}},a.prototype._onMapTypeChanged=function(n,t){var u,h,c;if(!t||!s.isValid(t.id))throw"Map._onMapTypeChanged trying to set map type to unsupported value";if(t.id===s.road&&f._isHighContrastMode()&&(u=this.getMapTypes().find(function(n){return n.id===s.highContrast}),u&&(t=u)),this._mapType=t,n&&t&&n.id&&t.id&&this.mapTypeChangeStarted.invoke(new cr(n.id,t.id)),this._allLayers.setBaseLayers(t),n&&t&&n.id&&t.id&&this.mapTypeChanged.invoke(new cr(n.id,t.id)),this._view){var o=this.getMercatorZoomLevel(),r=null,i=this._view.cameraLocation;o<this._mapType.minZoom?r=l.toAltitude(i,this._mapType.minZoom,!0):o>this._mapType.maxZoom&&(r=l.toAltitude(i,this._mapType.maxZoom,!0));r&&(h=new e(i.latitude,i.longitude,r,i.altitudeReference),c=new y(h,this._view.heading),this.setView(c))}},a.prototype._onMapModePaint=function(){var n=this,t;i.logDebugData("Map - onMapModePaint");t=function(){n._modePaintHandler&&(n._modeElement.fadeToChild(n.getMode().getRootElement()),n.modeDOMsMounted.invoke(n.getMode().mapModeType),n._modePaintHandler.dispose(),n._modePaintHandler=null,n._frameRenderedHandler&&n._frameRenderedHandler.dispose(),n._frameFailedHandler&&n._frameFailedHandler.dispose())};this._frameManager&&(this._frameManager.frameRendered.isPreviouslyInvoked||this._frameManager.frameFailed.isPreviouslyInvoked?t():this._frameRenderedHandler||(this._frameRenderedHandler=this._frameManager.frameRendered.addOne(t),this._frameFailedHandler=this._frameManager.frameFailed.addOne(t)))},a.prototype._instantiateMapInCompositeMapMode=function(n){var t=this;this.getContainer().instanceAsync("CompositeMapMode",function(r){t._instrumentationManager.setMapMode(r);i.logDebugData("Map - Composite Map mode ctor: mapMode.onPaint "+r.onPaint);t.setMode(r);t._view=t._view||n;var u=new Microsoft.Maps.BirdseyeV2Manager(t);if(t._disposables.push(t._birdseyeV2Manager=u),t._birdseyeV2ManagerPromise.resolve(u),t.getMapType().id===s.birdseyeV2)u.onMapTypeChanged({oldMapTypeId:null,newMapTypeId:s.birdseyeV2});t._instantiateFrameManager();t._disposables.push(t._modePaintHandler=r.onFrameRendered.addOne(function(){return t._onMapModePaint()}));t._targetView||t.setView(n,null,3)},undefined,!r.isMapsVertical)},a.prototype._instantiateMapInStreetsideMapMode=function(n){var t=this;this._view=this._targetView=n;this.getContainer().instanceAsync("StreetsideModeBootstrapper",function(i){var u=t._mapOptions.streetsideOptions||{},f=function(){t._mapOptions.mapTypeId=s.road;t.setBaseLayers(t._resolveMapType(s.road,t.getMapTypes()[s.road]));t._instantiateMapInCompositeMapMode(n);u.onErrorLoading&&u.onErrorLoading()},e=t._mapOptions.streetsideOptions&&t._mapOptions.streetsideOptions.panoramaInfo;i.isAvailable(e||t.getView().cameraLocation,function(n){var u=t._mapOptions.streetsideOptions||{},f=new sr({mapType:s.streetside,templateName:"097A0D85-2585-425A-8471-60BDD3C5B7C3",data:[],minZoom:18,maxZoom:23,mapTypeEnabled:!0},t._mapOptions,0);t._disposables.push(f);t._mapType=f;t._instantiateFrameManager();u.zoomIn=!0;u.entryPoint=r.isMapsVertical?"Permalink":"SDK";u.perfClickToImmersionTimeSource="SS_PCI";u.heading=t._mapOptions.heading;u.pitch=t._mapOptions.pitch;i.show(n,u)},f,u)},undefined,!r.isMapsVertical)},a.prototype._instantiateFrameManager=function(){var n=this,t;this._bootstrapState===0&&(this._onFrameManagerLoaded(new ni(this,this._allLayers)),t=r.features.labels.glLabelAndPoi?"LabelControllerGL":"LabelController",this._container.instanceAsync(t,function(t){var r,u;n._isDisposed||(n._labelController=t,n._disposables.push(n._labelController),n._labelController.attach(n),n.labelControllerLoaded.invoke(),r=n._mapOptions.labelOptions.labelVisibility===pt.visible||n.getMapType().id===s.road&&!n._mapOptions.allowHidingLabelsOfRoad?!0:!1,n._labelController.setIsLabelsEnabled(r),u=n.getNavigationBar(),u?u.getHelper().setLabelVisible(r):n.navigationBarLoaded.addOne(function(){return n.getNavigationBar().getHelper().setLabelVisible(r)}),i.logDebugData("Map - onMapModePaint - LabelController created"))},{CoreConfig:this._coreConfig},!1,function(n,t){console.log(t)}),this._bootstrapState=1)},a.prototype._onFrameManagerLoaded=function(n){var t=this;this._isDisposed||(this._frameManager=n,this._disposables.push(this._frameManager),this.frameManagerLoaded.invoke(this._frameManager),this._disposables.push(this._frameManager.frameRendered.addOne(function(){return t._postInit()})),this._disposables.push(this._frameManager.frameFailed.addOne(function(){return t._postInit()})),this._frameManager.initializeLayers(),i.logDebugData("Map - onMapModePaint - MapFrameManager created"),r.isMapsVertical?this._container.downloadDependencyAsync("TransientLens"):this._disposables.push(this._frameManager.dataLoaded.addOne(function(){t._container.downloadDependencyAsync("MapInteraction")})))},a.prototype._postInit=function(){var n=this;i.logDebugData("Map - postInit");this._bootstrapState!==2&&(this._container.instanceAsync("BrowserKeyProvider",function(t){n._disposables.push(t)}),this._container.instanceAsync("BrowserPointerProvider",function(t){n._disposables.push(t)}),this._container.instanceAsync("GlobalDataEventHandler",function(){var t=r.features.streetside;!n.getMapOptions().disableStreetsideAutoCoverage&&t&&t.isEnabled&&t.isCoverageLayerEntryPointEnabled&&n._container.instanceAsync("StreetsideAutoEntryBehavior",null,{Map:n})}),this._overlayCollection=new it,this._container.instanceAsync("OverlayManager",function(t){t.getRootElement().appendTo(n._overlayElement);i.logDebugData("Map - postInit - Overlay Manager created");n._overlayManager.resolve(t)}),this._mapOptions&&this._mapOptions.showLandmarks!==!1&&this._container.instanceAsync("LandmarksManager",function(t){n._isDisposed||(t.selectorReady(),n._disposables.push(n._landmarksManager=t),n._landmarksManagerPromise.resolve(t))},{map:this,coreConfig:this._coreConfig,container:this._container}),this._bootstrapState=2,this.getMode().mapModeType===0&&this._postInitForCompositeMode(),this._container.instanceAsync("CityPolygonManager",function(t){if(!n._isDisposed){n._disposables.push(n._cityPolygonManager=t);n._cityPolygonManagerPromise.resolve(t);var i=f._getPolygonId();i&&n._cityPolygonManager.addLayer(i,7,17);n._disposables.push(t)}},{map:this,coreConfig:this._coreConfig}))},a.prototype._postInitForCompositeMode=function(){var n=this,t;this._haveCalledPostInitForCompositeMode||(this._haveCalledPostInitForCompositeMode=!0,this._mapOptions.maxBounds&&this.setMaxBounds(this._mapOptions.maxBounds),typeof this._mapOptions.hideNavBar=="boolean"&&this._mapOptions.hideNavBar||this._createNavigationBar(),this._coreConfig.useOverlayQuadrants?this._container.instanceAsync("MapOverlayManager",function(t){n._disposables.push(n._mapOverlayManager=t)},{Map:this,RootElement:this._overlayElement}):(this._mapOptions&&this._mapOptions.showLogo&&(t=typeof this._mapOptions.enableClickableLogo!="undefined"?this._mapOptions.enableClickableLogo:!0,this._container.instanceAsync("LogoControl",function(t){n._logoControl=t;n._disposables.push(t);n._container.instanceAsync("LogoOverlay",function(t){n.getOverlays().insert(t)},{LogoControl:t})},{Map:this,Clickable:t})),this._createCopyrightControl(),this._createScaleBar()))},a.prototype._createNavigationBar=function(){var n=this;this._container.instanceAsync("NavigationBar",function(t){i.logDebugData("Map - postInit - Navigation Bar created");n._navigationBar=t;n._disposables.push(n._navigationBar,t.mapTypeButtonClicked.add(function(t){return n.mapTypeButtonClicked.invoke(t)}));n.navigationBarLoaded.invoke();n._container.instanceAsync("NavigationBarOverlay",function(t){n.getOverlays().insert(t)},{NavigationBar:t})},{Map:this,CoreConfig:this._coreConfig,DragonflyContainer:this._container})},a.prototype._createCopyrightControl=function(){var n=this,t;this._mapOptions.showCopyright&&(t=this._mapOptions&&this._mapOptions.showTermsLink?this._mapOptions.showTermsLink:!1,this._container.instanceAsync("CopyrightControl",function(t){n._copyrightControl=t;n._disposables.push(t);n._container.instanceAsync("CopyrightOverlay",function(t){n.getOverlays().insert(t);n.copyrightControlLoaded.invoke(n._copyrightControl)},{CopyrightControl:t})},{Map:this,CoreConfig:this._coreConfig,ShowTermsLink:t}))},a.prototype._createScaleBar=function(){var n=this;this._mapOptions.showScalebar&&this._container.instanceAsync("ScaleBar",function(t){n._scaleBarControl=t;n._disposables.push(n._scaleBarControl);n._container.instanceAsync("ScaleBarOverlay",function(t){n.getOverlays().insert(t)},{ScaleBar:t})},{Map:this})},a.prototype._onModeChanged=function(n,t){var e=this,r=null,u=n&&n.mapModeType,f=t&&t.mapModeType;u!==f&&(r={oldMode:u,newMode:f},this._disposables.indexOf(t)<0&&this._disposables.push(t));r&&this.mapModeChanged.invoke(r);n&&n.deactivated&&n.deactivated();i.logDebugData("Map - onModeChanged event");this._bootstrapState!==0&&(this._modeElement.fadeToChild(t.getRootElement()),this.modeDOMsMounted.invoke(t.mapModeType));t&&t.activated&&t.activated();this.copyrightChanged&&this.copyrightChanged.invoke();this._onPaintEventHandler&&(this._onPaintEventHandler.dispose(),this._onPaintEventHandler=null);t&&t.onPaint&&(this._onPaintEventHandler=t.onPaint.add(function(){return e._raiseViewChangingAfterPaintEvent()}));t.mapModeType===0&&this._bootstrapState===2&&this._postInitForCompositeMode();t.mapModeType===2?this._overlayElement&&this._overlayElement.set_style({transform:""}):this._overlayElement&&this._overlayElement.set_style({transform:"scale(1)"})},a.prototype._onActualSizeChanged=function(n,t){var i=this,r=t&&t.width,u=t&&t.height;r>0&&u>0&&Microsoft.Maps.setAsync(function(){if(i._targetView){i._mapOptions.maxBounds&&i.setMaxBounds(i._mapOptions.maxBounds,!1);var n=i._getConstrainViewArgs(i._targetView,1);i.setView(n.view);i.actualSizeChanged.invoke()}})},a.prototype._onDesiredSizeChanged=function(n,t){var i=t&&t.width,u=t&&t.height,s,h,e,o,f;if(r.isMapsVertical||(this._parentElement.length>0&&typeof Element=="function"&&this._parentElement[0]instanceof Element?(s=parseFloat(this._parentElement.get_style("width")),h=parseFloat(this._parentElement.get_style("height")),s===0&&this._parentElement.set_style({width:"100%"}),h===0&&this._parentElement.set_style({height:"100%"})):(e=this._parentElement.get_size(),e.width===0&&this._parentElement.set_style({width:"100%"}),e.height===0&&this._parentElement.set_style({height:"100%"}))),o=i===-1||u===-1,f={position:o?"absolute":"relative",width:i===-1?"100%":i===-2?"100vw":i+"px",height:u===-1?"100%":u===-2?"100vh":u+"px"},o){switch(this._parentElement.get_style("position")){case"relative":case"absolute":break;default:this._parentElement.set_style({position:"relative"})}f.top=f.left=0}this._rootElement.set_style(f);this._sizeHelper.pollSize()},a.prototype._getConstrainViewArgs=function(n,t){var i=new ou(n,t);return this.constrainView.invoke(i),i},a.prototype._enforceMinMaxAltitude=function(n){var t=this._mapOptions.navigationOptions;typeof t.minCameraAltitude=="number"&&(n.cameraLocation.altitude=Math.max(t.minCameraAltitude,n.cameraLocation.altitude));typeof t.maxCameraAltitude=="number"&&(n.cameraLocation.altitude=Math.min(t.maxCameraAltitude,n.cameraLocation.altitude))},a.prototype._onDisplayTileBoundariesChanged=function(){var n=this},a.prototype.getLogoEnd=function(){var t=0,n;return this._logoControl&&(n=this._logoControl.getRootElement(),n&&(t=n.get_relative_pos().x+n.get_size().width)),t},a.prototype.updateMapOptions=function(n,t){for(var i,r,o,e=Object.keys(t),u=0,l=e.length;u<l;u++)(i=e[u],r=t[i],i==="disableStreetside"&&this._containsOption(n,i))||(r&&typeof r=="object"?(n[i]||(n[i]={}),this.updateMapOptions(n[i],r)):n[i]=t[i],i==="customMapStyle"&&(this._mapTypes.updateCustomMapStyle(r),n[i]=t[i],o=this.getMode(),o&&this.setView(new y(this._view.cameraLocation),null,0,!0)));if(this._navigationBar){var f=!1,h=!1,c=!1;n.showDashboard!==!1&&(f=!n.disableZooming&&n.showZoomButtons!==!1,h=n.showMapTypeSelector!==!1,c=this._mapType.id!==s.birdseyeV2&&n.showLocateMeButton!==!1);this._navigationBar.setZoomInButtonVisible(f);this._navigationBar.setZoomOutButtonVisible(f);this._navigationBar.setMapStyleSelectorControlVisible(h);this._navigationBar.setLocateMeButtonVisible(c)}(typeof t.disableScrollWheelZoom=="boolean"||typeof t.disableKeyboardInput=="boolean")&&this.interactionModeUpdated.invoke()},a.prototype._containsOption=function(n,t){return typeof n[t]!="undefined"},a.prototype._processNavigationBarMapOptions=function(){var n=this.getMapOptions();n.navigationBarMode=typeof n.navigationBarMode=="undefined"?r.isMobile?ut.compact:ut["default"]:n.navigationBarMode;n.showMapTypeSelector=typeof n.showMapTypeSelector=="undefined"?!0:n.showMapTypeSelector;n.showZoomButtons=typeof n.showZoomButtons=="undefined"?!0:n.showZoomButtons;var t=typeof n.showLocateMeButton=="undefined",i=typeof n.showTrafficButton=="undefined",u=typeof n.navigationBarOrientation=="undefined";switch(n.navigationBarMode){case ut.compact:n.showLocateMeButton=t?!1:n.showLocateMeButton;n.showTrafficButton=i?!1:n.showTrafficButton;n.navigationBarOrientation=u?ot.horizontal:n.navigationBarOrientation;break;case ut.minified:n.showLocateMeButton=t?!1:n.showLocateMeButton;n.showTrafficButton=i?!0:n.showTrafficButton;n.navigationBarOrientation=u?ot.vertical:n.navigationBarOrientation;break;default:n.showLocateMeButton=t?!0:n.showLocateMeButton;n.showTrafficButton=i?!1:n.showTrafficButton;n.navigationBarOrientation=u?ot.vertical:n.navigationBarOrientation}n.disableBirdseye=typeof n.disableBirdseye=="undefined"?!1:n.disableBirdseye;this._processTrafficOptions()},a.prototype._processTrafficOptions=function(){var n=this.getMapOptions().trafficOptions,t=r.features.traffic;n&&t&&(n.opacity=typeof n.opacity=="undefined"?this.getConfig().liteMode?t.defaultTrafficLayerOpacityLiteMode:t.defaultTrafficLayerOpacity:n.opacity,n.incidentsVisible=typeof n.incidentsVisible=="undefined"?!0:n.incidentsVisible,n.flowVisible=typeof n.flowVisible=="undefined"?!0:n.flowVisible,n.legendVisible=typeof n.legendVisible=="undefined"?!1:n.legendVisible)},a.prototype._processDpiOptions=function(){var t=1,i=1,n;(this._coreConfig.allowHighDpi||this._coreConfig.allowHybridHighDpi)&&(n=this._mapOptions.enableHighDpi,typeof n!="boolean"&&(n=f._getDpr()>=1.5),n&&(i=this._coreConfig.allowHighDpi?t=2:2));this._tileDpiScale=t;this._labelDpiScale=1},a.prototype._beforeUnloadDummyHandler=function(){},a.DEFAULT_ZOOM_CUT_OFF_FOR_AERIAL_MODE=21,a._nextMapId=1,a._animationInterval=15,a._animationFrameWorkDispatcherKey="animationFrame",a._viewChangeMaxPercent=1.5,a}(dt),pt;(function(n){n[n.hidden=0]="hidden";n[n.visible=1]="visible"})(pt||(pt={})),function(n){n[n["default"]=0]="default";n[n.compact=1]="compact";n[n.minified=2]="minified";n[n.square=3]="square"}(ut||(ut={})),function(n){n[n.vertical=0]="vertical";n[n.horizontal=1]="horizontal"}(ot||(ot={}));ar=function(){function n(){}return n.minimized=0,n.expanded=1,n.hidden=2,n}(),function(n){n[n.topLeft=0]="topLeft";n[n.TopLeft=0]="TopLeft";n[n.bottomLeft=1]="bottomLeft";n[n.BottomLeft=1]="BottomLeft";n[n.topRight=2]="topRight";n[n.TopRight=2]="TopRight";n[n.bottomRight=3]="bottomRight";n[n.BottomRight=3]="BottomRight";n[n.none=4]="none";n[n.None=4]="None"}(hi||(hi={}));var uf=function(){function n(n){this._multiplier=n}return n.prototype.hasValueAt=function(n){return this._multiplier.hasValueAt(n)},n.prototype.getHasValue=function(){return this._multiplier.getHasValue()},n.prototype.evaluate=function(n){return this._multiplier.evaluate(n)},n}(),ff=function(){function n(n,t,i,r){this._hue=n;this._saturation=t;this._luminance=i;this._alpha=r}return n.prototype.hasValueAt=function(n){return this.getHasValue()&&(this._hue.hasValueAt(n)||this._saturation.hasValueAt(n)||this._luminance.hasValueAt(n)||this._alpha.hasValueAt(n))},n.prototype.getHasValue=function(){return this._hue&&this._hue.getHasValue()||this._saturation&&this._saturation.getHasValue()||this._luminance&&this._luminance.getHasValue()||this._alpha&&this._alpha.getHasValue()},n.prototype.evaluate=function(n){return{x:this._hue?this._hue.evaluate(n)/360:0,y:this._saturation?this._saturation.evaluate(n):0,z:this._luminance?this._luminance.evaluate(n):0,w:this._alpha?this._alpha.evaluate(n):0}},n}(),i=function(){function t(){}return t.assertNotNull=function(n,i){t.assert(n===0||n||n===!1,i+" cannot be null")},t.assertNotNullOrEmpty=function(n,i){t.assertNotNull(n,i);t.assertIsString(n,i);t.assert(n.length>0,i+" cannot be an empty string")},t.assertInstanceOf=function(n,i,r){t.assertNotNull(i,"ctor");t.assert(n instanceof i,r+" must be an instance of "+t.getName(i))},t.assertIsString=function(n,i){t.assert(typeof n=="string",i+" must be a string")},t.assertIsFunction=function(n,i){t.assert(typeof n=="function",i+" must be a function")},t.assertIsInteger=function(n,i){t.assert(typeof n=="number"&&n%1==0,i+" must be an integer")},t.assert=function(){},t.logObject=function(n,i,r){var f,u,e;if(t.isDebugRun)try{console&&typeof console.log!="undefined"&&(u=i,u+=": %O",console.log.apply(console,[u,r]))}catch(o){}window.perfRun&&(f=t._getCurrentGroupinMainStack(),f&&(u=null,u=window.verbose?t._formatLogString(i):t._formatLogString(n),e=t._getLogKey(f),f[e+"__"+u]=r))},t.log=function(n){for(var r,i,e,o=[],u=2;u<arguments.length;u++)o[u-2]=arguments[u];if(t.isDebugRun)try{console&&typeof console.log!="undefined"&&(i=f._formatString.apply(null,Array.prototype.slice.call(arguments,1)),console.log.apply(console,[i]))}catch(s){}window.perfRun&&(r=t._getCurrentGroupinMainStack(),r&&(i=null,window.verbose?(i=f._formatString.apply(null,Array.prototype.slice.call(arguments,1)),i=t._formatLogString(i),e=t._getLogKey(r),r[e]=i):n&&(Array.prototype.splice.call(arguments,1,1),i=f._formatString.apply(null,arguments),i=t._formatLogString(i),e=t._getLogKey(r),r[e]=i)))},t.throwException=function(n){throw n;},t.trace=function(){if(t.isDebugRun)try{var n=window.console;n&&typeof n.trace!="undefined"&&n.trace.apply(n)}catch(i){}},t.profile=function(n){if(t.isDebugRun||window.perfRun)try{console&&typeof console.profile!="undefined"&&console.profile.apply(console,[n])}catch(i){}},t.profileEnd=function(){if(t.isDebugRun||window.perfRun)try{console&&typeof console.profileEnd!="undefined"&&console.profileEnd.apply(console)}catch(n){}},t.time=function(n){if(t.isDebugRun||window.perfRun)try{var i=window.console;(i&&typeof i.time=="undefined"||window.perfRun)&&(i.time=function(r){var u,f;n&&(u=t._getEpochTime(),i.timeHash||(i.timeHash={}),f="timeKey_"+r.toString(),i.timeHash[f]=u)});i.time.apply(i,[n])}catch(r){}},t.timeEnd=function(n){if(t.isDebugRun||window.perfRun)try{var i=window.console;(i&&typeof i.timeEnd=="undefined"||window.perfRun)&&(i.timeEnd=function(n){var o=t._getEpochTime(),u,r,f,e;i.timeHash&&(u="timeKey_"+n.toString(),r=i.timeHash[u],r&&(f=o-r,e=n+": "+f+"ms",t.logString(e)))});i.timeEnd.apply(i,[n])}catch(r){}},t.timeStamp=function(n){if(t.isDebugRun||window.perfRun)try{var i=window.console;i&&typeof i.timeStamp!="undefined"&&i.timeStamp.apply(i,[n])}catch(r){}},t.group=function(n){for(var s,u,i,h,e,c=[],o=2;o<arguments.length;o++)c[o-2]=arguments[o];if(t.isDebugRun)try{var r=window.console,l=t._getEpochTime().toString(),i=f._formatString.call(null,Array.prototype.slice.call(arguments,1));r&&typeof r.group!="undefined"?(r.group.apply(r,[i]),t.logString("Group start Timestamp: "+l)):r.log.apply(r,[i])}catch(a){}window.perfRun&&(s=t._getMainPerfStack(),u=t._getCurrentGroupinMainStack(),u&&(i=null,window.verbose?(i=f._formatString.apply(null,Array.prototype.slice.call(arguments,1)),i=t._formatLogString(i),h=t._getLogKey(u),i=h+"__"+i,e={},u[i]=e,s.push(e)):n?(Array.prototype.splice.call(arguments,1,1),i=f._formatString.apply(null,arguments),i=t._formatLogString(i),h=t._getLogKey(u),i=h+"__"+i,e={},u[i]=e,s.push(e)):s.push(null)))},t.groupEnd=function(){var n,r,i;if(t.isDebugRun)try{i=t._getEpochTime().toString();n=window.console;n&&typeof n.groupEnd!="undefined"&&(t.logString("Group End Timestamp: "+i),n.groupEnd.apply(n))}catch(u){}window.perfRun&&(r=t._getMainPerfStack(),r&&t._getLastElement(r)&&window.verbose&&(i=t._getEpochTime().toString(),t.logString("Group End Timestamp: "+i)),r.pop())},t.groupCollapsed=function(n){for(var c,e,s,r,i,h,u,l=[],o=2;o<arguments.length;o++)l[o-2]=arguments[o];if(t.isDebugRun)try{c=t._getEpochTime().toString();e=window.console;e&&typeof e.groupCollapsed!="undefined"&&(i=f._formatString.apply(null,Array.prototype.slice.call(arguments,1)),e.groupCollapsed.apply(e,[i]),t.logString("Group start Timestamp: "+c))}catch(a){}window.perfRun&&(s=t._getMainPerfStack(),r=t._getCurrentGroupinMainStack(),r&&(i=null,window.verbose?(i=f._formatString.apply(null,Array.prototype.slice.call(arguments,1)),i=t._formatLogString(i),h=t._getLogKey(r),i=h+"__"+i,u={},r[i]=u,s.push(u)):n?(Array.prototype.splice.call(arguments,1,1),i=f._formatString.apply(null,arguments),i=t._formatLogString(i),h=t._getLogKey(r),i=h+"__"+i,u={},r[i]=u,s.push(u)):s.push(null)))},t.setPerfRun=function(n,i){window.perfRun=n;window.verbose=i;t.setupPerfObject()},t.setDebugRun=function(n){t.isDebugRun=n},t.getName=function(n){var t=/function (.{1,})\(/.exec(n.toString());return t&&t.length>1?t[1]:"Unknown"},t.setTestHook=function(n,i,r){this._logElement=f._createElement("div").set_attr("id","testHook").appendTo(n);this._debugElement=f._createElement("div").set_attr("id","debugHook").appendTo(n);this._perfTestHookElement=f._createElement("div").set_attr("id","perfTestHook").appendTo(n);this.enableFunctionalTestHooks=!0;t._setMap(r);FunctionalTestHooks.setTestHookSettings(u,i,f._getUrlParam,yr.fromString)},t._setMap=function(n){this.enableFunctionalTestHooks&&(!window.$map||window.$map.isDisposed?(t._map=window.$map=n,window.$map.frameManagerLoaded.addOne(function(){var n=window.$map.getFrameManager();n.primitivesRendered.addOne(function(){window.$mapLoaded=!0})})):n.getMapOptions().navigationOptions&&n.getMapOptions().navigationOptions.lockCameraAltitude&&(window.$overviewMap=n))},t.setLabelLogElement=function(n){this._labelLogElement=n},t.logPoiLayerStyleStart=function(){this.enableFunctionalTestHooks&&(this._poiLayerStyle=t._poiLayerStyleStart)},t.logPoiLayerStyleEnd=function(n){if(this.enableFunctionalTestHooks&&n){var i=this._poiLayerStyle;i!==t._poiLayerStyleStart&&(i+="}",this.logTestData(n,i));this._poiLayerStyle=""}},t.logVectorImageTemplate=function(n,t){function r(n){var t=n&&n.vectorType,i="";if(typeof t=="number"){var r=n.style||{},u=r.fillStyle||"nofill",f=r.strokeStyle||"nostroke";i="VR{Type: "+t+", FillStyle: "+u+", StrokeStyle: "+f+"}"}return i}var i,u;this.enableFunctionalTestHooks&&this._poiLayerStyle&&(i=[],n&&(i=i.concat(n.map(r))),t&&(i=i.concat(t.map(r))),u="VT{"+i.join("")+"}",this._poiLayerStyle+=u)},t.logLabelData=function(n){var u,r,f,i;if(n&&(this.enableFunctionalTestHooks||this._labelLogElement))for(u=Object.keys(n),r=0,f=u.length;r<f;r++)if(i=n[u[r]],i&&i.region&&i.region.anchor&&i.region.bounds&&i.region.bounds.bbox&&i.region.bounds.bbox.minPoint&&i.region.bounds.bbox.maxPoint){var e=i.region.bounds.bbox.minPoint,o=i.region.bounds.bbox.maxPoint,s=i.region.anchor,h=i.style&&i.style.styleStatic.showBackground,c="Label::text:"+i.text+(i.secondaryText?" secondaryText:"+i.secondaryText:"")+" type:"+i.type+" minPoint:("+e.x+","+e.y+") maxPoint:("+o.x+","+o.y+") anchorPoint:("+s.x+","+s.y+") showBackground:"+(h?1:0);this.enableFunctionalTestHooks&&this.logTestData(t.UserLogTag,c);this._labelLogElement&&this.logLabelText(i.text)}},t.logResourceLoadOrder=function(n,i){if(this.enableFunctionalTestHooks){n||(n=t.LoadOrderTag);var r;r=i;this.logPerfTestData(n,r)}},t.logPerfInstrumentation=function(n,i){if(this.enableFunctionalTestHooks){n||(n=t.PerfLogTag);var r="PerfLog::";r+=i;this.logPerfTestData(n,r)}},t.logPushpinPrimitive=function(n,i){var u,o,l,r,s;if(this.enableFunctionalTestHooks&&n&&i){var v=i.entity?a.getValue(i.entity,"name"):null,y=i.entity?a.getValue(i.entity,"title")||"":"",c=i.entity?i.entity.id:null,p=a.getValue(i,"taskDisplayState"),f=-1;if(p&&(f=a.getValue(i,"viewState"),f||(f=0)),u=i.geometry,u&&i.geometryType===1){if(o=new e(i.crs.toLatitude(u.x,u.y),i.crs.toLongitude(u.x,u.y)),!t._map||!t._map.getMode||!t._map.getMode()||!t._map.getMode().tryLocationToPoint)return;l=t._map.getMode();l.mapModeType!==2?(r=l.tryLocationToPoint(o),r.x=Math.ceil(r.x),r.y=Math.ceil(r.y)):r=new h(0,0);s=v&&c&&c.indexOf("rs")===0?"RoadShield::name:"+v:"Pushpin::title:"+y+" id:"+c;i.entity&&a.getValue(i.entity,"tj")&&(s+=" [TRANSIT]");s+=" viewState:"+f+" location:("+o.latitude+","+o.longitude+")"+(r?" Point:("+r.x+","+r.y+")":"");this.logTestData(n,s)}}},t.logLayersChanged=function(n){var i;this.enableFunctionalTestHooks&&n&&(n.added&&(i=n.added[0],this.logTestData(t.TileLogTag,"UserLayer::"+i.getId()+"::added")),n.removed&&(i=n.removed[0],this.logTestData(t.TileLogTag,"UserLayer::"+i.getId()+"::removed")))},t.logVectorRenderingData=function(n,i,r,u){if(this.enableFunctionalTestHooks){var f="[p"+n+"_gc"+u+"_tc"+r+"_v"+i+"]",e="data-"+t.VectorDataRenderLogTag;this._logElement.set_attr(e,f)}},t.logShapePrimitive=function(n){var r,i,e,o,f,u;if(this.enableFunctionalTestHooks&&n){if(r="",n.geometryType==2&&n._options)i=n.geometry,r="Directions::Geometry::Line length: "+i.y.length+" locations:[("+i.y[0]+","+i.x[0]+") ("+i.y[i.y.length-1]+","+i.x[i.x.length-1]+")]";else if(n.geometryType==2)i=n.geometry,e=n.entity?a.getValue(n.entity,"title"):"",r="Polyline::title:"+e+"Line length: "+i.y.length+" locations:[("+i.y[0]+","+i.x[0]+")]";else if(n.geometryType==3)for(o=n.geometry,f=o.rings,r="Geometry::Area::Rings Count: "+f.length,u=0;u<f.length;u++)r+=" [Ring #:"+(u+1).toString()+", X vertex length:"+f[u].x.length+",Y vertex length:"+f[u].y.length+"]";this.logTestData(t.TileLogTag,r)}},t.logNetworkData=function(n,i){t.enableFunctionalTestHooks&&n&&t.logTestData(t.NetworkLogTag,n+":"+i)},t.clearTestHooksLog=function(n){this.enableFunctionalTestHooks&&this._logElement.set_attr("data-"+n,"");this._labelLogElement&&n===t.UserLogTag&&this._labelLogElement.set_attr("data-label","")},t.getFunctionalTestHooksEnabled=function(){return this.enableFunctionalTestHooks},t.addDataTag=function(n,t){n.set_attr("data-tag",t)},t.addStreetsideArrowTesthook=function(n,t,i,r){if(this.enableFunctionalTestHooks&&n&&t&&i){var u=f._createElement("a");u.set_attr("href","#");u.set_attr("class",t);u.set_attr("data-tag",t);n.append(u);i&&u.set_text(i);r&&u.add_event("click",r);u.set_style({pointerEvents:"auto",position:"relative",opacity:0})}},t.removeStreetsideArrowTesthooks=function(t){if(this.enableFunctionalTestHooks)for(var i=0;i<t.length;i++)n("."+t[i].replace(".","\\.")).removeFromParent()},t.logDebugData=function(n){this.enableFunctionalTestHooks&&this.logDataToTestElement(this._debugElement,"tag",n)},t.logLabelDrawOrder=function(n){t.enableFunctionalTestHooks&&n&&t.logTestData(t.LabelDrawOrderTag,n)},t.logTestData=function(n,t){this.logDataToTestElement(this._logElement,n,t)},t.logLabelText=function(n){this.logDataToTestElement(this._labelLogElement,"label",n)},t.logPerfTestData=function(n,t){this.logDataToTestElement(this._perfTestHookElement,n,t)},t.logDataToTestElement=function(n,t,i){var u="data-"+t,r=n.get_attr(u);r.indexOf(i)==-1&&(r=r?r+","+i:i);n.set_attr(u,r)},t.logString=function(n){var i,r;if(t.isDebugRun)try{console&&typeof console.log!="undefined"&&console.log.apply(console,[n])}catch(u){}window.perfRun&&(i=t._getCurrentGroupinMainStack(),i&&(n=t._formatLogString(n),r=t._getLogKey(i),i[r]=n))},t.setupPerfObject=function(){window.perf={};var n=[];n.push(window.perf);window.mainPerfStack=n},t._getEpochTime=function(){return Date.now()},t._getPropertyCount=function(n){var t=0,i;if(n)for(i in n)n.hasOwnProperty(i)&&++t;return t},t._formatLogString=function(n){if(n)return n=n.replaceAll(" ","_"),n=n.replaceAll(":","$"),n=n.replaceAll(",","_"),n.replaceAll(".","#")},t._getLogKey=function(n){var i=t._getEpochTime().toString(),r=t._getPropertyCount(n);return"__"+i+"__"+(r+1).toString()},t._getCurrentGroupinMainStack=function(){var n=t._getMainPerfStack();return t._getLastElement(n)},t._getMainPerfStack=function(){return window.mainPerfStack},t._getLastElement=function(n){if(n){var t=n.length;if(t>0)return n[t-1]}return null},t.TileLogTag="tile",t.VectorDataRenderLogTag="vectorDataRender",t.UserLogTag="user",t.NetworkLogTag="network",t.LoadOrderTag="loadOrder",t.LabelDrawOrderTag="LabelDrawOrder",t.PerfLogTag="perfLogs",t._poiLayerStyleStart="PLS{",t}(),ci=function(){function n(n){this._capacity=n;this._count=0;this._dictionary={}}return n.prototype.addItem=function(n,t){if(t){var i=this._dictionary[n];i?a.areEqual(i.item,t)||(this._dictionary[n].item=t,this._moveNodeToHead(i)):this._addNewItem(n,t)}},n.prototype.convertToArray=function(){for(var t=[],n=this._headNode;n;)t.push(n.item),n=n.next;return t},n.prototype.getItem=function(n){var t,i=this._dictionary[n];return i?(t=i.item,this._moveNodeToHead(i)):t=null,t},n.prototype.clear=function(){while(this._count>0)this._deleteTailNode()},n.prototype.getCount=function(){return this._count},n.prototype.getInternalDictionary=function(){return this._dictionary},n.prototype.setCapacity=function(n){var i,t;if(n>0){if(this._capacity>n&&this._count>n)for(i=this._count-n,t=0;t<i;t++)this._deleteTailNode();this._capacity=n}},n.prototype._addNewItem=function(n,t){this._count===this._capacity&&this._deleteTailNode();var i={key:n,item:t};this._count===0?this._headNode=this._tailNode=i:(i.next=this._headNode,this._headNode.previous=i,this._headNode=i);this._dictionary[n]=i;this._count++},n.prototype._removeNode=function(n){if(this._count===1){i.assert(n===this._headNode,"The only node must be the head node.");i.assert(n===this._tailNode,"The only node must be the tail node.");this._headNode=null;this._tailNode=null;return}var t=n.previous,r=n.next;t?t.next=r:(i.assert(n===this._headNode,"Only the head node can have null previous."),this._headNode=r);r?r.previous=t:(i.assert(n===this._tailNode,"Only the tail node can have null next."),this._tailNode=t)},n.prototype._moveNodeToHead=function(n){n!==this._headNode&&(this._removeNode(n),this._headNode&&(this._headNode.previous=n),n.previous=null,n.next=this._headNode,this._headNode=n)},n.prototype._deleteTailNode=function(){var n,t;this._tailNode&&(n=this._tailNode,this._removeNode(n),delete this._dictionary[n.key],this._count--,t=n.item,t.dispose&&t.dispose())},n}(),ef=function(n){function t(t,i,r){r===void 0&&(r=1);var u=n.call(this,t,i)||this;return u.units=r,u}return p(t,n),t}(h),of=function(){function r(){this._dispatchedQuery=[];this._runningQuery=[];this.tickRaised=new t}return r.prototype.dispatch=function(n,t,u){if(!this._disposed){i.assertIsFunction(n,"f");n[r._orderAttributeKey]=u||0;n[r._dispatchKey]=t||"";for(var f=this._dispatchedQuery.length;f--;)if(this._dispatchedQuery[f]===n)return;this._dispatchedQuery.push(n);this._ensureTimer()}},r.prototype.cancelDispatch=function(n){for(var t=this._dispatchedQuery.length;t--;)this._dispatchedQuery[t]===n&&this._dispatchedQuery.splice(t,1);for(t=this._runningQuery.length;t--;)this._runningQuery[t]===n&&this._runningQuery.splice(t,1)},r.prototype.cancelDispatchWithKey=function(n){i.assertNotNullOrEmpty(n,"Key cannot be empty or null");for(var t=this._dispatchedQuery.length;t--;)this._dispatchedQuery[t]&&this._dispatchedQuery[t][r._dispatchKey]===n&&this._dispatchedQuery.splice(t,1);for(t=this._runningQuery.length;t--;)this._runningQuery[t]&&this._runningQuery[t][r._dispatchKey]===n&&this._runningQuery.splice(t,1)},r.prototype.dispose=function(){this.tickRaised.dispose();this._runningQuery=[];this._dispatchedQuery=[];this._disposed=!0},r.prototype._tick=function(){var t,u,n;if(!this._disposed)for(this.tickRaised.invoke(),t=Date.now(),this._tickTimeoutId=null,this._dispatchedQuery.length&&this._ensureTimer(),u=this._dispatchedQuery,this._dispatchedQuery=this._runningQuery,this._runningQuery=u,this._runningQuery.sort(this._sortByOrder),n=!1;this._runningQuery.length;)n?this._dispatchedQuery.push(this._runningQuery.shift()):(i.groupCollapsed(null,"Dispatcher Tick"),this._runningQuery.shift()(),i.groupEnd(),Date.now()-t>r.MaxDispatchTime&&(n=!0))},r.prototype._sortByOrder=function(n,t){return n[r._orderAttributeKey]-t[r._orderAttributeKey]},r.prototype._ensureTimer=function(){var n=this;this._tickTimeoutId||(this._tickTimeoutId=r._requestAnimFrame(function(){try{n._tick()}catch(t){if(u.logger)u.logger.logCriticalError(t);else throw t;}}))},r.MaxDispatchTime=50,r._orderAttributeKey="$mm$dispatchOrder",r._dispatchKey="$mm$dispatchkey",r._requestAnimFrame=n.Effects.Animation.requestAnimationFrame,r}(),sf=function(n){function t(i,r,u){u===void 0&&(u=t._defaultCapacity);var f=n.call(this,i,r)||this;return f._capacity=u,f}return p(t,n),t.prototype.release=function(t){if(this._objectPool.length===this._capacity){var i=t;i.dispose&&i.dispose()}else n.prototype.release.call(this,t)},t._defaultCapacity=256,t}(hr),hf=function(){function n(){this._dispatchedQueryWithPriority={}}return n.prototype.dispatch=function(n,t,r){var u,f;if(r===void 0&&(r=5),!this._disposed){for(i.assertIsFunction(n,"f"),u=this._dispatchedQueryWithPriority[r],u||(u=[],this._dispatchedQueryWithPriority[r]=u),f=u.length;f--;)if(u[f].action===n)return;u.push({action:n,dispatchGroupKey:t});this._ensureTimer()}},n.prototype.cancelDispatch=function(n,t){i.assertNotNull(n,"f:action cannot be empty");this._cancel(n,null,t)},n.prototype.cancelAllDispatch=function(){this._dispatchedQueryWithPriority={}},n.prototype.cancelDispatchWithKey=function(n,t){i.assertNotNullOrEmpty(n,"Key cannot be empty or null");this._cancel(null,n,t)},n.prototype.dispose=function(){this._disposed=!0;this._dispatchedQueryWithPriority={}},n.prototype._cancel=function(n,t,i){var r,u;if(typeof i!="undefined"&&i>=0)r=this._dispatchedQueryWithPriority[i],this._cancelActionInWorkCollection(r,n,t);else for(u=0;u<=5;u++)r=this._dispatchedQueryWithPriority[u],this._cancelActionInWorkCollection(r,n,t)},n.prototype._cancelActionInWorkCollection=function(n,t,i){for(var r=n&&n.length||0;r--;)n[r]&&(i?n[r].dispatchGroupKey===i&&n.splice(r,1):t&&n[r].action===t&&n.splice(r,1))},n.prototype._tick=function(){var i,u;this._tickTimeoutId=null;var r=0,f=Date.now(),t=null;for(i=0;i<=5;i++){for(t=this._dispatchedQueryWithPriority[i];r<n._throttleElapseTime&&t&&t.length>0;)u=t.shift(),u.action(),r=Date.now()-f;if(t&&t.length>0){this._ensureTimer();break}}},n.prototype._ensureTimer=function(){var n=this;this._tickTimeoutId||(this._tickTimeoutId=Microsoft.Maps.setTimeout(function(){n._tick()},0))},n._throttleElapseTime=5,n}(),cf=function(){function n(n,t,i,r,u){var f=this;this._workDispatcher=n;this._index=0;this._items=t;this._iterationCallback=i;this._completionCallback=r;this._priority=u;this._action=function(){f._iterate()}}return n.prototype._next=function(){return this._items[this._index++]},n.prototype.hasNext=function(){return this._index<this._items.length},n.prototype.isRunning=function(){return this._isRunning},n.prototype.run=function(){this._isRunning||(this._isRunning=!0,this._totalRunningTime=0,this._iterate())},n.prototype.stop=function(){this._workDispatcher&&this._workDispatcher.cancelDispatch(this._action,this._priority);this._isRunning=!1},n.prototype.reset=function(){this.stop();this._index=0},n.prototype._iterate=function(){for(var t=Date.now(),i;this._isRunning&&this.hasNext()&&Date.now()-t<n._yieldThreshold;)i=this._next(),this._iterationCallback(i,this._index-1);this._totalRunningTime+=Date.now()-t;this.hasNext()?this._isRunning&&this._workDispatcher&&this._workDispatcher.dispatch(this._action,null,this._priority):(this._completionCallback&&this._completionCallback(this._index,this._totalRunningTime),this._isRunning=!1)},n._yieldThreshold=30,n}(),lf=function(){function n(){this.id=(n._idCounter++).toString()}return n._idCounter=0,n}(),af=function(){function n(){this.clear()}return n.prototype.clear=function(){this._dictionary={};this._order=[]},n.prototype.getCount=function(){return this._order.length},n.prototype.addItem=function(n,t){this._dictionary[n]||this._order.push(n);this._dictionary[n]=t},n.prototype.getAt=function(n){var t;return n>=0&&n<this.getCount()&&(t=this.getItem(this._order[n])),t},n.prototype.getItem=function(n){return this._dictionary[n]},n.prototype.removeItem=function(n){this._dictionary[n]&&(delete this._dictionary[n],this._order.splice(this._order.indexOf(n),1))},n}(),vr=function(){function t(){this.image=document.createElement("img")}return t.getPooledImage=function(n,i){t._imagePool||(t._imagePool=new sf(t));var r=t._imagePool.acquire();return r.image||(r.image=document.createElement("img")),n?r.image.crossOrigin=i?"use-credentials":"anonymous":delete r.image.crossOrigin,r},t.prototype.release=function(){var i=this;this.image&&(this.image.src="");n.Browser.is_ie?Microsoft.Maps.setTimeout(function(){t._imagePool.release(i)},1e3):t._imagePool.release(this)},t}(),li=function(){function n(){}return n.init=function(t,i){n[t]||(n[t]=new n);var u=n[t];for(var r in i)i.hasOwnProperty(r)&&(u[r]=i[r])},n}();li.init("MapCore",u.ResourcesObject);u.ResourcesObject=null;var v=li.MapCore,ii=bt.LocalStorageCache,vf=function(n){function t(t,i,r){var u=n.call(this,i,r)||this,f;for(u._capacity=t,f=0;f<t;f++)n.prototype._create.call(u);return u}return p(t,n),t.prototype.acquire=function(){if(this._objectPool.length===0)throw"Pooled objects have been allocated already";return n.prototype.acquire.call(this)},t.prototype.release=function(t){if(this._objectPool.length===this._capacity)throw"Object pool is already full";n.prototype.release.call(this,t)},t}(hr),yr=function(){function n(){}return n.prototype.toString=function(n,t){var i="",e,o,r,s,u,f;if(this.protocol&&(i+=this.protocol+":",(this.protocol==="http"||this.protocol==="https"||this.protocol==="ftp")&&(i+="//")),this.host&&(i+=this.host),this.port&&(i+=":"+this.port),this.path&&(i+="/"+this.path),this.queryStringParameters)for(e=!0,o=Object.keys(this.queryStringParameters),r=0,s=o.length;r<s;r++)(u=o[r],f=this.queryStringParameters[u],!t||f)&&(e?(i+="?",e=!1):i+="&",i+=n?u+"="+f:encodeURIComponent(u)+"="+encodeURIComponent(f));return this.fragment&&(i+="#"+encodeURI(this.fragment)),i},n.fromString=function(t){var h,f,e,o,c,l,s;if(!t)throw"Input should be a well-formed url";var u=new n,r=t,i=r.split("#");if(i.length>2)throw"More than one fragment is found in the input";if(i.length===2&&(r=i[0],u.fragment=decodeURIComponent(i[1])),i=r.split("?"),i.length>2)throw"More than one query param identifier ('?') is found in the input";if(i.length===2)for(r=i[0],u.queryStringParameters={},h=i[1],i=h.split("&"),f=0;f<i.length;f++)e=i[f],o=e.indexOf("="),o>0&&(c=decodeURIComponent(e.substring(0,o)),l=decodeURIComponent(e.substring(o+1)),u.queryStringParameters[c]=l);if(i=r.split("://"),i.length>2)throw"More than one protocol identifier ('://') is found in the input";if(i.length===2&&(r=i[1],u.protocol=i[0]),i=r.split("/"),i.length>1&&(r=i[0],u.path=i.slice(1).join("/")),r.indexOf("@")>=0)throw"Unsupported url";if(i=r.split(":"),i.length>2)throw"More than one port identifier (':') is found in the input";if(u.host=i[0],i.length===2){if(s=parseInt(i[1]),isNaN(s))throw"port number should be an integer";u.port=s}return u},n.prototype.protocolAndDomain=function(){return(this.protocol+"://"+this.host+(typeof this.port=="undefined"?"":":"+this.port)).toLowerCase()},n}();function wt(){}ai=function(){function n(n){var t=this;this._state=0;this._continuations=[];try{n(function(n){t._resolve(n)},function(n){t._reject(n)})}catch(i){this._reject(i)}}return n.prototype.then=function(t,i){typeof t!="function"&&(t=null);typeof i!="function"&&(i=null);var r=new n(wt);return this._addContinuation({child:r,fulfill:t,reject:i}),r},n.resolve=function(t){if(t instanceof n)return t;var i=new n(wt);return i._resolve(t),i},n.reject=function(t){var i=new n(wt);return i._reject(t),i},n.all=function(t){var u=t.length,r=[],i=new n(wt);return t.length?t.forEach(function(t,f){n.resolve(t).then(function(n){r[f]=n;--u==0&&i._fulfill(r)},function(t){n._isSettled(i._state)||i._reject(t)})}):i._fulfill(r),i},n.race=function(t){var r=t.length,i=new n(wt);return t.length?t.forEach(function(t){n.resolve(t).then(function(t){n._isSettled(i._state)||i._fulfill(t)},function(t){n._isSettled(i._state)||i._reject(t)})}):i._fulfill(null),i},n._dispatchQueue=function(){var i=n._asyncQueue,t,r;for(n._asyncQueue=[],n._asyncTimerId=0,t=0,r=i.length;t<r;t++)i[t]()},n._queueAction=function(t){n._asyncQueue.push(t);n._asyncTimerId||(n._asyncTimerId=Microsoft.Maps.setTimeout(n._dispatchQueue,0))},n._isSettled=function(n){return n!==0},n.prototype._fulfill=function(t){n._isSettled(this._state)||(this._value=t,this._state=1,this._execContinuations())},n.prototype._reject=function(t){n._isSettled(this._state)||(this._value=t,this._state=2,this._execContinuations())},n.prototype._addContinuation=function(t){var i=this;this._continuations?this._continuations.push(t):n._queueAction(function(){return i._execContinuation(t)})},n.prototype._execContinuations=function(){var t=this;n._isSettled(this._state)&&n._queueAction(function(){var i=t._continuations,n,r;for(t._continuations=null,n=0,r=i.length;n<r;n++)t._execContinuation(i[n])})},n.prototype._isObjectOrFunction=function(n){return n&&(typeof n=="function"||typeof n=="object")},n.prototype._isObject=function(n){return n&&typeof n=="object"},n.prototype._isFunction=function(n){return typeof n=="function"},n.prototype._resolve=function(n){var r=this,t,i;if(n===this)this._reject(new TypeError);else if(this._isObjectOrFunction(n))if(t=n,t.constructor===this.constructor)t.then(function(n){return r._resolve(n)},function(n){return r._reject(n)});else{try{i=t.then}catch(u){this._reject(u)}this._isFunction(i)?this._resolveThenable(t,i):this._fulfill(n)}else this._fulfill(n)},n.prototype._resolveThenable=function(n,t){var u=this,i,r;try{t.call(n,function(n){i||r||(i=!0,u._resolve(n))},function(n){i||r||(r=!0,u._reject(n))})}catch(f){i||r||this._reject(f)}},n.prototype._resolveOrReject=function(n,t){try{this._resolve(n(t))}catch(i){this._reject(i)}},n.prototype._execContinuation=function(t){var i,r,u,f;if(n._isSettled(this._state)){i=t.child;r=this._value;switch(this._state){case 1:u=t.fulfill;u?i._resolveOrReject(u,r):i._fulfill(r);break;case 2:f=t.reject;f?i._resolveOrReject(f,r):i._reject(r)}}},n._asyncQueue=[],n}(),function(){var n=ai.prototype;n["catch"]=function(n){return this.then(null,n)}}(),function(){var i=typeof global!="undefined"?global:self,r=i.Promise,u=["resolve","reject","all","race"],t=!!r,n,f;if(t)for(n=0,f=u.length;n<f;n++)if(!(u[n]in r)){t=!1;break}t||(i.Promise=ai)}();st=function(){function n(){var n=this;this._promise=new Promise(function(t,i){n.resolve=t;n.reject=i})}return n.prototype.then=function(n,t){return this._promise.then(n,t)},n}(),function(){function l(n,t,r){for(var f,b,l={},v={},y=[],k={},o=0,h=0,d=t.length;h<d;h++){var u=t[h],c=u.property,p=u.from,e=u.duration,w=u.delay||0;e===undefined&&(e=s);p&&(l[c]=p);v[c]=u.to;a(y,k,c,e,w,u.ease);o=Math.max(o,e+w)}f={};f[i]=y.join(",");n.set_style(l);n.get_native_prop("offsetHeight");b=function(){f[i]="";n.set_style(f);r&&r()};n.set_style(f).set_style(v);Microsoft.Maps.setTimeout(b,o)}function a(n,i,e,s,c,l){if(!i[e]){typeof l=="undefined"&&(l=h);l in u&&(l=u[l]);e=o(r(e,t));var a=e+" "+f(s,"ms")+" "+l;c>0&&(a=a+" "+f(c,"ms"));i[e]=!0;n.push(a)}}function f(n,t){return(typeof n!="string"||n.match(/^[\-\.0-9]+$/))&&(n=""+n+t),n}function v(t,i){n(t).set_style(i)}function y(t,i,r){for(var h,c,w,b,l=[],e=0,o=0,k=i.length;o<k;o++){var u=i[o],a=u.delay||0,y=u.duration||0,s=u.property,f=u.from,p=u.to;(f===undefined&&(f=t.get_style(s)),typeof f=="number"&&typeof p=="number")&&(h={},h[s]=f,c={},c[s]=p,w=new n.Effects.Animation({elements:t,duration:y,startTime:a,from:h,to:c,animate:v,easing:null}),l.push(w),e=Math.max(e,a+y))}b=new n.Effects.Storyboard({duration:e,completed:r,animations:l});b.begin()}var e=n.Transition=n.Transition||{},r=n.Style.get_camelized_style_name,o=n.Style.get_dasherized_style_name,s=500,u={"default":"ease",line:"linear","in":"ease-in",out:"ease-out","in-out":"ease-in-out","in-sine":"cubic-bezier(0.47,0,0.745,0.715)","out-sine":"cubic-bezier(0.39,0.575,0.565,1)","in-out-sine":"cubic-bezier(0.445,0.05,0.55,0.95)","in-quad":"cubic-bezier(0.55,0.085,0.68,0.53)","out-quad":"cubic-bezier(0.25,0.46,0.45,0.94)","in-out-quad":"cubic-bezier(0.455,0.03,0.515,0.955)","in-cubic":"cubic-bezier(0.55,0.055,0.675,0.19)","out-cubic":"cubic-bezier(0.215,0.61,0.355,1)","in-out-cubic":"cubic-bezier(0.645,0.045,0.355,1)","in-quart":"cubic-bezier(0.895,0.03,0.685,0.22)","out-quart":"cubic-bezier(0.165,0.84,0.44,1)","in-out-quart":"cubic-bezier(0.77,0,0.175,1)","in-back":"cubic-bezier(0.6,-0.28,0.735,0.045)","out-back":"cubic-bezier(0.175,0.885,0.32,1.275)","in-out-back":"cubic-bezier(0.68,-0.55,0.265,1.55)"},h="ease",t=document.createElement("div"),i=r("transition",t),c=t.style[i]!==undefined;e.run=function(n,t,i){if(!n||!n.length||!t||!t.length){i&&i();return}c?l(n,t,i):y(n,t,i)}}(),function(){var t=n.Internals;t.parseJSON=function(n){var t=JSON&&JSON.parse||(n="("+n+")")&&eval;return t(n)}}();var yf=function(){function n(n){this._value=n}return n.prototype.then=function(t){typeof t!="function"&&(t=null);var i=this._value;if(t)try{i=t(i)}catch(r){}return new n(i)},n}(),ri=function(){function n(){}return n.prototype.accumulate=function(n,t){var u,r;for(i.assertNotNull(n,"bounds"),i.assert(n.length===4,"The 'bounds' parameter must always be of length 4."),i.assertNotNull(t,"crs"),u=this._getCorners(t,n),r=0;r<u.length;r++)this._accumulateLocation(u[r].latitude,u[r].longitude)},n.prototype.accumulateLocations=function(n){for(var t=0;t<n.length;t++)this._accumulateLocation(n[t].latitude,n[t].longitude);return this.getBounds()},n.prototype.accumulateLocationRect=function(n){for(var t,i=0;i<n.length;i++)t=n[i],this._accumulateLocation(t.getNorth(),t.getWest()),this._accumulateLocation(t.getSouth(),t.getEast());return this.getBounds()},n.prototype.accumulateLatLon=function(n,t){for(var i=0;i<n.length;i++)this._accumulateLocation(n[i],t[i]);return this.getBounds()},n.prototype.getBounds=function(){var n=this._bounds;return n?b.fromEdges(n[0],n[1],n[2],n[3],null,null,!0):null},n.prototype._getCorners=function(n,t){if(t[0]===t[2]&&t[1]===t[3])return[new e(n.toLatitude(t[1],t[0]),n.toLongitude(t[1],t[0]))];var i=[];return i[0]=new e(n.toLatitude(t[3],t[0]),n.toLongitude(t[3],t[0])),i[1]=new e(n.toLatitude(t[1],t[0]),n.toLongitude(t[1],t[0])),i[2]=new e(n.toLatitude(t[3],t[2]),n.toLongitude(t[3],t[2])),i[3]=new e(n.toLatitude(t[1],t[2]),n.toLongitude(t[1],t[2])),i},n.prototype._accumulateLocation=function(n,t){this._bounds?(this._bounds[0]=Math.max(this._bounds[0],n),this._bounds[1]=Math.min(this._bounds[1],t),this._bounds[2]=Math.min(this._bounds[2],n),this._bounds[3]=Math.max(this._bounds[3],t)):this._bounds=[n,t,n,t]},n}(),pf=function(){function n(n){n=n||{};this._customMapStylesEnabled=n.customMapStylesEnabled;this._customClientStylesEnabled=this._customMapStylesEnabled&&n.customClientStylesEnabled;this.customMapStyleVersion=0;this.changed=new t;this.update(null)}return n._camelCase=function(n){return typeof n!="string"?n:n.charAt(0).toLowerCase()+n.substring(1)},n.initialize=function(t,i){var r,u;if(!n._elementHierarchy)for(n._elementHierarchy={},r=0,u=t.length;r<u;r++){var f=t[r]||{},e=i[f.nameId],o=t[f.parentId]||{},s=i[o.nameId];e&&(n._elementHierarchy[n._camelCase(e)]=n._camelCase(s))}},n.prototype.update=function(n){n&&this._customMapStylesEnabled?this._initiate(n):(this._customSettings=null,this._elementStyles=null,this._hasClientRenderedStyles=!1,this.useLiteMode=!1,this.styleString="",this.buildingVisible=!0);this.customMapStyleVersion++;this.changed.invoke()},n.prototype.settingHasValue=function(n,t){return this._customSettings&&this._customSettings[n]===t},n.prototype.getElementStyle=function(t,i){var r,f,u;if(this._customClientStylesEnabled&&this._hasClientRenderedStyles&&t&&i)for(t=n._camelCase(t),i=n._camelCase(i);t;){if(f=n._elementMapping[t],u=this._elementStyles[f],r=u&&u[i],r!==undefined)break;t=n._elementHierarchy[t]}return typeof r=="object"?r&&r.value:r},n.prototype._initiate=function(n){n=n||{};n.elements=n.elements||{};n.settings=n.settings||{};this._customSettings=n.settings;this._elementStyles={};this._hasClientRenderedStyles=!1;this.buildingVisible=!0;this._parseCustomMapStyle(n);this.useLiteMode=this._hasClientRenderedStyles&&!this._customClientStylesEnabled},n.prototype._parseCustomMapStyle=function(t){var u,f,i,r;for(this.styleString="",u=t.elements,f=Object.keys(u),r=0;r<f.length;r++){var s=f[r],e=n._elementMapping[s],o=u[s];e&&o&&(this._elementStyles[e]=o,i=this._parseProperties(e,o),i&&(this.styleString+=i+"_"))}i=this._parseProperties("g",t.settings);i&&(this.styleString+=i);this.styleString.charAt(this.styleString.length-1)==="_"&&(this.styleString=this.styleString.substring(0,this.styleString.length-1))},n.prototype._parseProperties=function(t,i){var o,s,h,e,l,u,a,c;if(!i||!t)return"";var r,f="",v=!1,y=Object.keys(i);for(o=0;o<y.length;o++)if(s=y[o],h=n._propertyMapping[s],r=i[s],h&&typeof r!="undefined"&&r!==null){e=void 0;l=n._clientRenderedProperties[h];this._hasClientRenderedStyles=this._hasClientRenderedStyles||!!l;u=void 0;a=!1;typeof r=="object"?(u=r.value,a=r.ignoreTransform):u=r;switch(typeof u){case"boolean":e=u?"1":"0";break;case"string":c=kt.parse(u,2);c&&(e=this._convertColorToHex(c).slice(1),l&&(i[s]=c.toRgba()))}e&&(f+=v?";":t+"|",f+=h+":"+e,a&&(f+=",it:1"),v=!0)}return t==="bld"&&f.indexOf("v:0")>=0&&(this.buildingVisible=!1),f},n.prototype._convertColorToHex=function(n){var t="";return n.alpha<1&&(t=this._convertNumberToHex(Math.round(n.alpha*255))),"#"+t+this._convertNumberToHex(n.red)+this._convertNumberToHex(n.green)+this._convertNumberToHex(n.blue)},n.prototype._convertNumberToHex=function(n){var t=n.toString(16);return t.length<2?"0"+t:t},n._elementMapping={activityZone:"az",adminDistrict:"ad",adminDistrictCapital:"adc",airport:"ap",archipelago:"arc",area:"ar",arterialRoad:"ard",bare:"br",building:"bld",buildingLine:"bl",business:"bs",camera:"cmr",capital:"cp",cemetery:"cm",continent:"ct",contour:"cn",controlledAccessHighway:"cah",countryRegion:"cr",countryRegionCapital:"crc",district:"ds",education:"ed",educationBuilding:"eb",foodPoint:"fp",foodZone:"fz",forest:"fr",golfCourse:"gc",highSpeedRailway:"hsr",highSpeedRamp:"hsrp",highway:"hg",incident:"in",indigenousPeoplesReserve:"ipr",indoorPoint:"ip",island:"is",military:"ima",majorRoad:"mr",mapElement:"me",mapLine:"ml",medical:"md",medicalBuilding:"mb",metro:"mt",naturalPoint:"np",nautical:"nt",neighborhood:"nh",park:"pr",peak:"pk",playingField:"pf",point:"pt",pointOfInterest:"poi",political:"pl",populatedPlace:"pp",railway:"rl",ramp:"rm",reserve:"rsv",river:"rv",road:"rd",roadExit:"re",roadShield:"rs",runway:"rw",sand:"sn",secureZone:"szn",securityLine:"sl",serviceZone:"sz",settings:"g",shoppingCenter:"sct",stadium:"sta",street:"st",structure:"str",tollRoad:"tr",track:"trk",trail:"trl",transit:"trn",transitBuilding:"tb",transportation:"trs",underground:"ug",unpavedStreet:"us",vegetation:"vg",venueFootprint:"vf",volcanicPeak:"vp",walkway:"wlk",wall:"wl",water:"wt",waterPoint:"wp",waterRoute:"wr",zone:"zn"},n._propertyMapping={borderOutlineColor:"boc",borderStrokeColor:"bsc",borderVisible:"bv",fillColor:"fc",iconColor:"ic",labelColor:"lbc",labelOutlineColor:"loc",labelVisible:"lv",landColor:"lc",shadedReliefVisible:"srv",strokeColor:"sc",visible:"v"},n._clientRenderedProperties={lbc:!0,loc:!0,lv:!0},n}(),wf=function(){function n(){if(n.instance)return n.instance}return n.prototype.getGeneralizations=function(t,i,r){var s=t.generalizable&&t.x.length>n._minimumGeneralizationCoordinates&&i&&i<=n._maximumGeneralizationZoom,f,o,e,u;if(s&&(o=n._getGeneralizationBucketKey(i),f=this._initializeGeneralization(t,o,i,r),f.length===0&&r))for(f.push(0),r.calculateProjectedCoordinates(0,t,0),this._lastRenderableX=r.lastProjectedX,this._lastRenderableY=r.lastProjectedY,e=t.x.length,this._hasNextProjectedCoordinates=!1,u=1;u<e;u++)this._hasNextProjectedCoordinates?(this._currentProjectedX=this._nextProjectedX,this._currentProjectedY=this._nextProjectedY,this._hasNextProjectedCoordinates=!1):(r.calculateProjectedCoordinates(u,t,0),this._currentProjectedX=r.lastProjectedX,this._currentProjectedY=r.lastProjectedY),this._isCoordinateIgnorable(u,u===e-1,t,r)||(f.push(u),this._lastRenderableX=this._currentProjectedX,this._lastRenderableY=this._currentProjectedY);return f},n.prototype._isCoordinateIgnorable=function(t,i,r,u){var y;if(!i){if(this._consecutiveIgnoredCoordinatesCount<n._maxConsecutiveSkippedCoordinates){var s=this._currentProjectedX-this._lastRenderableX,h=this._currentProjectedY-this._lastRenderableY,p=Math.sqrt(s*s+h*h),f=this._totalPerpendicularDistance===0&&p<this._tolerance;if(!f){u.calculateProjectedCoordinates(t+1,r,0);this._nextProjectedX=u.lastProjectedX;this._nextProjectedY=u.lastProjectedY;this._hasNextProjectedCoordinates=!0;var e=this._nextProjectedX-this._lastRenderableX,o=this._nextProjectedY-this._lastRenderableY,a=e*e+o*o,v=(s*e+h*o)/a,c=this._lastRenderableX+v*e,l=this._lastRenderableY+v*o;f=!(c<this._lastRenderableX&&c<this._nextProjectedX||c>this._lastRenderableX&&c>this._nextProjectedX||l<this._lastRenderableY&&l<this._nextProjectedY||l>this._lastRenderableY&&l>this._nextProjectedY);f&&(y=Math.sqrt(a),this._totalPerpendicularDistance+=Math.abs(s*o-h*e)/y,f=this._totalPerpendicularDistance<this._tolerance)}if(f)return this._consecutiveIgnoredCoordinatesCount++,!0}this._consecutiveIgnoredCoordinatesCount=0;this._totalPerpendicularDistance=0}return!1},n.prototype._initializeGeneralization=function(t,i,r,u){u&&t.generalizationCrs!==u.destinationCrs&&(t.generalizations=null,t.generalizationCrs=u.destinationCrs);t.generalizations||(t.generalizations={});var f=t.generalizations[i];return f&&f.length!==0||(t.generalizations[i]=[],f=t.generalizations[i],this._totalPerpendicularDistance=0,this._consecutiveIgnoredCoordinatesCount=0,this._tolerance=n._getPixelTolerance(r)),f},n._getPixelTolerance=function(t){return n._maximumPixelToleranceLimit/Math.pow(2,n._zoomLevelGeneralizationBucketSize-t%n._zoomLevelGeneralizationBucketSize-1)},n._getGeneralizationBucketKey=function(t){return"z"+Math.floor(t/n._zoomLevelGeneralizationBucketSize)},n.instance=new n,n._maximumGeneralizationZoom=17,n._minimumGeneralizationCoordinates=20,n._maximumPixelToleranceLimit=1,n._zoomLevelGeneralizationBucketSize=3,n._maxConsecutiveSkippedCoordinates=100,n}(),s=function(){function n(){this.collinsBart="cb"}return n.getTilePrimerId=function(n){return"tp"+n},n.isValid=function(t){switch(t){case n.aerial:case n.birdseye:case n.road:case n.streetside:case n.ordnanceSurvey:case n.mercator:case n.grayscale:case n.canvasDark:case n.canvasLight:case n.highContrast:case n.birdseyeV2:return!0;case n.symbolicNight:var i=r.features.symbolicNight;return i&&i.isEnabled}return!1},n.aerial="a",n.birdseye="be",n.none="",n.ordnanceSurvey="os",n.road="r",n.streetside="x",n.mercator="m",n.grayscale="cg",n.canvasDark="wd",n.canvasLight="wl",n.highContrast="hc",n.symbolicNight="sn",n.birdseyeV2="be2",n}(),bf=function(){function n(t,i,r,e){var a,v,o,s,h,p;if(r===void 0&&(r=2e3),e===void 0&&(e=1200),this.duration=0,this.zoomDelta=0,a=parseInt(f._getUrlParam(window.location,"maxDuration")),e=a?a:e,this._maxAnimationDuration=e,v=parseInt(f._getUrlParam(window.location,"velocity")),r=v?v:r,o=u.Internal.TileSystemHelper,o){s=l.fromLocation(i.cameraLocation,!0);h=l.fromLocation(t.cameraLocation,!0);this.zoomDelta=s-h;var y=Math.min(s,h),w=o.latLongToPixelXY(i.cameraLocation,y),b=o.latLongToPixelXY(t.cameraLocation,y),c=Math.sqrt(Math.pow(w.x-b.x,2)+Math.pow(w.y-b.y,2))+Math.abs(s-h)*n._pixelDistancePerZoom+Math.abs(i.heading-t.heading)*n._pixelDistanceFactorPerHeadingDegree,k=o.getMapSize(y);c>k/2&&(c=Math.max(0,k-c));p=c/r*1e3;this.duration=p>e?0:p;this.duration>0&&this.duration<n._slowAnimationThresholdDuration&&(this.duration=Math.min(this.duration*n._durationMultiplierDuringShortPan,n._slowAnimationThresholdDuration))}}return n.prototype.interpolate=function(n,t,i){var o=this._interpolateProgress(n.cameraLocation.latitude,t.cameraLocation.latitude,i),s=this._interpolateProgress(n.cameraLocation.longitude,t.cameraLocation.longitude,i),h=this._interpolateProgress(n.cameraLocation.altitude,t.cameraLocation.altitude,i,!0),r=n.heading,u=t.heading,f;return Math.abs(u-r)>180&&(u<r?u+=360:r+=360),f=this._interpolateProgress(r,u,i),new y(new e(o,s,h,t.cameraLocation.altitudeReference),f)},n.prototype._interpolateProgress=function(t,i,r,u){if(u===void 0&&(u=!1),this.zoomDelta<0)r=Math.pow(r,2);else if(this.zoomDelta>0)r=1-Math.pow(1-r,2);else if(this.duration>n._minDurationForZoomEffectDuringPan&&u)return Math.sin(r*Math.PI)*t*n._zoomAnimationFactorDuringLongPan*(1+Math.log(this.duration/n._minDurationForZoomEffectDuringPan))+t;return(i-t)*r+t},n._pixelDistancePerZoom=500,n._pixelDistanceFactorPerHeadingDegree=4,n._slowAnimationThresholdDuration=225,n._minDurationForZoomEffectDuringPan=500,n._zoomAnimationFactorDuringLongPan=.4,n._durationMultiplierDuringShortPan=10,n}(),vi=function(){function n(n,t,i,r,u){this.crs=et.instance;this.geometryType=1;this.setLocation(n);this.entity=t;this.anchor=r;this.image=i;this.imageSize=u}return n.getLocation=function(n,t){var i,r,u;return n&&t&&(r=n.toLatitude(t.x,t.y),u=n.toLongitude(t.x,t.y),i=new e(r,u)),i},n.prototype.getLocation=function(){return n.getLocation(this.crs,this.geometry)},n.prototype.isTapEnabled=function(){return!0},n.prototype.setLocation=function(n){this.geometry={x:n.longitude,y:n.latitude,bounds:[n.latitude,n.longitude,n.latitude,n.longitude]}},n.prototype.dispose=function(){this.isDisposed||(f._nullifyClass(this),this.isDisposed=!0)},n}(),kf=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u)||this}return p(t,n),t.prototype.isHoverEnabled=function(){return!0},t.prototype.isMoveEnabled=function(){return!0},t}(vi),pr=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.defineProperty("overlayElement"),f.defineProperty("alignment"),f.defineProperty("anchor"),f.defineProperty("primitive"),f.setOverlayElement(t),f.setAlignment(i),f.setAnchor(r),u&&f.setPrimitive(u),f}return p(t,n),t}(dt),yi=function(){function n(){}return n.showOverlay=function(t,i,r){if(!n._primitive){var u=i.overlayTemplate;r.getOverlayTemplate&&(u=r.getOverlayTemplate());n._createOverlay(t,u,r,i)}},n.hideOverlay=function(t,i){if(n._overlay&&n._primitive&&n._primitive===i&&(!i||i===n._overlay.getPrimitive())){var r=t.getOverlays();r&&r.indexOf(n._overlay)!==-1&&(r.remove(n._overlay),n._overlay=null,n._primitive=null)}},n.getOverlay=function(){return n._overlay},n._createOverlay=function(t,i,r,u){if(i&&r.geometryType===1){var o=i.applyDataTemplate({primitive:r}),f=r.geometry,s=typeof u.overlayAlignment=="number"?u.overlayAlignment:new e(r.crs.toLatitude(f.x,f.y),r.crs.toLongitude(f.x,f.y));n._overlay=new pr(o,s,u.overlayAnchor,r);n._primitive=r;t.getOverlays().insert(n._overlay)}},n}(),ht;(function(n){function h(){s&&u===-1&&(u=Microsoft.Maps.setTimeout(e,c))}function l(n,t){(r.enableInstrumentation||f&&f[n.toLowerCase()])&&(i.push(n+":"+t),h())}function a(n,i){(r.enableInstrumentation||f&&f[n.toLowerCase()])&&(i||(i=Date.now()-o._PerfV2STime),t.push(n+":"+i.toString(36)),h())}function e(){if(t.length>0||i.length>0){var n=Date.now(),e="id:"+Math.round(Math.random()*1e4)+","+(t.length>0?'P:"'+t.join(",")+'",':"")+(i.length>0?'S:"'+i.join(",")+'",':"")+'v: 1.1, T: "CI.Perf", FID: "CI", Name: "PerfV2"',f=r.dynamicProperties,o=f.impressionGuid,h=f.origin+"/fd/ls/lsp.aspx",c="<E><T>Event.ClientInst<\/T><IG>"+o+"<\/IG><TS>"+n+"<\/TS><D><![CDATA[{"+e+"}]\]><\/D><\/E>",l="<ClientInstRequest><Events>"+c+"<\/Events><STS>"+n+"<\/STS><\/ClientInstRequest>";tt.doPost(h,l,{headers:{"Content-Type":"text/plain;charset=UTF-8"}});t=[];i=[];s=!0;clearTimeout(u);u=-1}}function v(){e();clearTimeout(u)}var c=1e3,t=[],i=[],u=-1,s=!1,f=r.perfSDKInclusions;n.record=l;n.mark=a;n.flush=e;n.dispose=v})(ht||(ht={}));var wr=function(){function n(t){var i=this,e,u,f;this._disposables=[];this._map=t;this._totalTicks=0;this._framesetStartTime=-1;this._disposables.push(this._map.frameManagerLoaded.addOne(function(){return i._onMapFrameManagerLoaded()}));this._disposables.push(this._map.mapZoomStarted.add(function(){return i._onMapZoomStarted()}));this._disposables.push(this._map.mapZoomStopped.add(function(){return i._onMapZoomStopped()}));this._disposables.push(this._map.mapPanStarted.add(function(){return i._onMapPanStarted()}));this._disposables.push(this._map.mapPanStopped.add(function(){return i._onMapPanStopped()}));e=function(){i._totalTicks++};this._disposables.push(this._map.viewChanging.add(e));this._disposables.push(this._map.viewChanging.addOne(function(){return i._onMapControlInitialized()}));this._disposables.push(this._map.navigationBarLoaded.addOne(function(){return i._onNavigationBarLoaded()}));typeof performance!="undefined"&&(performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(250),u=performance.timing,r.isMapsVertical&&u&&(f=u.responseEnd-u.responseStart,f>0&&!n._logStatus.Maps_CS&&(n.record("Maps_CS",Math.floor(72e4/f)),n._logStatus.Maps_CS=!0)))}return n.prototype._onMapFrameManagerLoaded=function(){var n=this,t=this._map.getFrameManager(),i=function(){n._currentFrameDataLoadTime+=Date.now()-n._lastFramesetStartTime},r=function(){n._currentFrameLabelsRenderedTime=Date.now()-n._framesetStartTime},u=function(){n._currentFramePrimitivesRenderedTime=Date.now()-n._framesetStartTime};this._disposables.push(t.frameFailed.add(function(t){return n._onFrameFailed(t)}));this._disposables.push(t.frameSet.add(function(t){return n._onFrameManagerFrameSet(t)}));this._disposables.push(t.frameRendered.add(function(){return n._onFrameRendered()}));this._disposables.push(t.primitivesRendered.add(u));this._disposables.push(t.labelsRendered.add(r));this._disposables.push(t.dataLoaded.add(i))},n.prototype._onMapControlInitialized=function(){if(n._logStatus.Maps_BST||(n.mark("Maps_BST"),n._logStatus.Maps_BST=!0),window.$bsperf){var t=window.$bsperf.TPPLT;t&&!n._logStatus.Maps_PPLT&&(n.record("Maps_PPLT",Math.round(t)),n._logStatus.Maps_PPLT=!0)}},n.prototype._onNavigationBarLoaded=function(){this._navigationBarLoaded=!0;this._tryLogPLT()},n.prototype._tryLogPLT=function(){var ot=this,u,i,t,f;if(!n._logStatus.Maps_PLT&&this._navigationBarLoaded&&this._frameRendered){if(n._logStatus.Maps_PLT=!0,n.mark("Maps_PLT"),typeof performance!="undefined")if(r.isSDK){if(performance.getEntriesByType&&performance.timing)for(u=performance.getEntriesByType("resource"),i=0;i<u.length;i++)if(t=u[i],f=t.name?t.name.toLowerCase():"",f.indexOf("/mapcontrol")>-1){o._PerfV2STime=performance.timing.navigationStart+t.requestStart;break}}else{if(performance.getEntriesByType){var u=performance.getEntriesByType("resource"),it=0,rt=0,e=0,s=0,h=0,c=0,l=0,a=0,v=0,y=0,p=0,w=0,b=0,k=0,d=0,g=0,st=r.isOnChina?"tiles.ditu.":"tiles.virtualearth.net";for(i=0;i<u.length;i++){var t=u[i],f=t.name?t.name.toLowerCase():"",ut=Math.floor(t.domainLookupEnd-t.domainLookupStart),ft=Math.floor(t.connectEnd-t.connectStart),et=Math.floor(t.secureConnectionStart>0?t.connectEnd-t.secureConnectionStart:0),nt=Math.floor(t.responseStart-t.requestStart),tt=t.responseStart>0?Math.floor(t.responseEnd-t.responseStart):0;f.indexOf(st)>-1?(v=Math.max(ut,v),y=Math.max(ft,y),p=Math.max(et,p),w=Math.max(nt,w),k=Math.max(tt,k)):n.rmsUrlIdentifier.test(f)?(h=Math.max(ut,h),c=Math.max(ft,c),l=Math.max(et,l),a=Math.max(nt,a),g=Math.max(tt,g),t.encodedBodySize&&(e++,rt+=t.encodedBodySize),t.transferSize&&t.transferSize>0&&(s++,it+=t.transferSize)):f.indexOf("/stl?")>-1&&(b=Math.max(nt,b),d=Math.max(tt,d))}e>0&&(n.record("Maps_CM",Math.round(s/e*100)),n.record("Maps_ERS",rt),n.record("Maps_TRS",it),s===0&&n.mark("Maps_PLT2"),s===e&&n.mark("Maps_PLT1"));h&&n.record("Maps_BDNST",h);c&&n.record("Maps_BCT",c);l&&n.record("Maps_BSSLT",l);a&&n.record("Maps_BTTFB",a);g&&n.record("Maps_BDT",g);v&&n.record("Maps_TSDNST",v);y&&n.record("Maps_TSCT",y);p&&n.record("Maps_TSSSLT",p);w&&n.record("Maps_TSTTFB",w);b&&n.record("Maps_XSRTTFB",b);d&&n.record("Maps_XSRDT",d);k&&n.record("Maps_TSDT",k)}this._logMemory("Maps_MEM");this._timerId=Microsoft.Maps.setTimeout(function(){ot._logMemory("Maps_LMEM")},126e4)}n.flush()}},n.prototype._logMemory=function(t){if(typeof performance!="undefined"){var i=performance.memory;i&&i.usedJSHeapSize&&n.record(t,i.usedJSHeapSize)}},n.prototype._onMapPanStarted=function(){this._panStartTime=Date.now();this._totalTicks=0;this._isPanning=!0},n.prototype._onMapPanStopped=function(){if(this._totalTicks>0){var t=(Date.now()-this._panStartTime)/1e3;n.record("Maps_PFPS",Math.round(this._totalTicks/t))}},n.prototype._onMapZoomStarted=function(){this._zoomStartTime=Date.now();this._totalTicks=0;this._isZooming=!0},n.prototype._onMapZoomStopped=function(){if(this._totalTicks>0){var t=Math.round(this._totalTicks/((Date.now()-this._zoomStartTime)/1e3));n.record("Maps_ZFPS",t)}},n.prototype._onFrameFailed=function(t){t.reason!==1&&(this._framesetStartTime=-1,this._frameRendered||(this._frameRendered=!0,this._tryLogPLT()));n.record("Maps_FFAIL",t.reason)},n.prototype._onFrameManagerFrameSet=function(n){this._lastFramesetStartTime=Date.now();(this._framesetStartTime===-1||n.frame.cause===1)&&(this._currentFrameDataLoadTime=0,this._framesetStartTime=Date.now())},n.prototype._onFrameRendered=function(){this._frameRendered||(this._frameRendered=!0,this._tryLogPLT());var t=this._isPanning?"Maps_PTTG":this._isZooming?"Maps_ZTTG":"Maps_VCTTG";n.record(t,Date.now()-this._framesetStartTime);n.record("Maps_FDL",this._currentFrameDataLoadTime);n.record("Maps_PRT",this._currentFramePrimitivesRenderedTime);n.record("Maps_LRT",this._currentFrameLabelsRenderedTime);this._isPanning=this._isZooming=!1;this._framesetStartTime=-1},n.prototype.dispose=function(){n.flush();ht.dispose();f._clearDisposables(this._disposables);clearTimeout(this._timerId);clearTimeout(n._keyExpiredTimerId);n._keyExpiredTimerId=-1;this._map=null},n.flush=function(){(r.enableInstrumentation||r.perfSDKInclusions)&&(r.isSDK||typeof perf=="undefined"||!perf.flush?ht.flush():perf.flush())},n.record=function(n,t){(r.enableInstrumentation||r.perfSDKInclusions)&&(r.isSDK||typeof perf=="undefined"||!perf.record?ht.record(n,t):perf.record(n,t))},n.mark=function(n,t){(r.enableInstrumentation||r.perfSDKInclusions)&&(r.isSDK||typeof perf=="undefined"||!perf.mark?ht.mark(n,t):perf.mark(n,t))},n.logStart=function(t){n._startWatchForActiveKeys();n._logStartKey[t]=Date.now()},n.logStartTime=function(t){return typeof n._logStartKey[t]=="number"?n._logStartKey[t]:-1},n.log=function(t,i){if(typeof perf!="undefined"&&!!perf.record&&(i=i||n.logStartTime(t),delete n._logStartKey[t],i>=0)){var r=Math.round(Date.now()-i);n.record(t,r);t==="Maps_SOPLT"&&sj_evt.fire("v8OverlayPLT",r)}},n._startWatchForActiveKeys=function(){n._keyExpiredTimerId===-1&&(n._keyExpiredTimerId=Microsoft.Maps.setTimeout(function(){var r,i,t;for(n._keyExpiredTimerId=-1,r=Date.now(),i=Object.keys(n._logStartKey),t=0;t<i.length;t++)r-n._logStartKey[i[t]]>25e3&&delete n._logStartKey[i[t]];Object.keys(n._logStartKey).length>0&&n._startWatchForActiveKeys()},5e3))},n._logStatus={},n._logStartKey={},n._keyExpiredTimerId=-1,n.rmsUrlIdentifier=/bing.com\/(\w|\/|,)+\.(css|js)/ig,n}(),br=function(){function n(n,t,i,r){this.crs=et.instance;this.geometryType=3;this.setArea(n,r);this.entity=t;this._template=i}return n.prototype.isTapEnabled=function(){return!0},n.getRings=function(n,t){var f,u,s,r,o,i,h,c,l;if(!n||!t||t.rings.length<1)return null;for(f=[],u=0,s=t.rings.length;u<s;u++){for(r=t.rings[u],o=[],i=0,h=r.x.length;i<h;i++)c=n.toLatitude(r.x[i],r.y[i]),l=n.toLongitude(r.x[i],r.y[i]),o.push(new e(c,e.normalizeLongitude(l)));f.push(o)}return f},n.prototype.getRings=function(){return n.getRings(this.crs,this.geometry)},n.prototype.setRings=function(n,t){this.setArea(n,t)},n.prototype.getTemplate=function(){return this._template},n.prototype.setTemplate=function(n){this._template=n},n.prototype.setArea=function(n,t){var i,f,r,u,e,c,o,l,h,s;if(n.rings)this.geometry=n;else{for(e=n,e[0]instanceof Array||(e=[e]),r=[],i=0,f=e.length;i<f;i++)c=e[i],r.push(this._getRing(c));this.geometry={rings:r,bounds:null}}for(o=this.geometry,r=o.rings,i=0,f=r.length;i<f;i++)u=r[i],this._closeRing(u),u.generalizable=t,l=pi.worldWrapLongitudes(u.x),l&&(o.bounds=null);if(!o.bounds){for(h=new ri,i=0,f=r.length;i<f;i++)u=r[i],h.accumulateLatLon(u.y,u.x);s=h.getBounds();o.boundingBox=s;o.bounds=s?s.bounds:null}},n.prototype.dispose=function(){this.isDisposed||(f._nullifyClass(this),this.isDisposed=!0)},n.prototype._getRing=function(n){for(var i=[],r=[],t=0;t<n.length;t++)i.push(n[t].longitude),r.push(n[t].latitude);return{x:i,y:r}},n.prototype._closeRing=function(n){var i,t;n&&(n instanceof Array?(i=n,i.length&&(i[0].latitude!==i[i.length-1].latitude||i[0].longitude!==i[i.length-1].longitude)&&i.push(new e(i[0].latitude,i[0].longitude))):(t=n,t.x.length&&t.y.length&&(t.x[0]!==t.x[t.x.length-1]||t.y[0]!==t.y[t.y.length-1])&&(t.x.push(t.x[0]),t.y.push(t.y[0]))))},n}(),pi=function(){function n(n,t,i,r){this.crs=et.instance;this.geometryType=2;this.entity=t;this.disposables=[];this.setLine(n,r);this._template=i}return n.getLocations=function(n,t){var r=[],i,u,f;if(n&&t)for(i=0;i<t.x.length;i++)u=n.toLatitude(t.x[i],t.y[i]),f=n.toLongitude(t.x[i],t.y[i]),r.push(new e(u,e.normalizeLongitude(f)));return r},n.prototype.getLocations=function(){return n.getLocations(this.crs,this.geometry)},n.prototype.getTemplate=function(){return this._template},n.prototype.setTemplate=function(n){this._template=n},n.prototype.setLine=function(t,i){var o=new ri,e;if(t instanceof Array){for(var s=t,r=s.length,u=new Array(r),f=new Array(r);r--;)f[r]=t[r].longitude,u[r]=t[r].latitude;this.geometry={x:f,y:u,bounds:null}}else this.geometry=t;e=n.worldWrapLongitudes(this.geometry.x);(e||!this.geometry.bounds)&&(this.geometry.boundingBox=o.accumulateLatLon(this.geometry.y,this.geometry.x),this.geometry.bounds=this.geometry.boundingBox?this.geometry.boundingBox.bounds:null);this.geometry.generalizable=i},n.prototype.dispose=function(){this.isDisposed||(f._disposeEvents(this),f._nullifyClass(this),this.isDisposed=!0)},n.worldWrapLongitudes=function(n){var r=!1,i,s,t,f;n=n||[];var o=e.normalizeLongitude(n[0]),u=0,h=n.length>1&&n[0]===n[n.length-1];for(i=0,s=n.length;i<s;i++)t=u+e.normalizeLongitude(n[i]),f=t-o,f>180?(u-=360,t-=360):f<-180&&(u+=360,t+=360),t!==n[i]&&(n[i]=t,r=!0),o=t;return r&&h&&(n[n.length-1]=n[0]),r},n}(),df=function(){function n(n,t){this._weight=1;this.location=n;this.setWeight(t)}return n.prototype.getWeight=function(){return this._weight},n.prototype.setWeight=function(n){typeof n=="number"&&isFinite(n)&&(this._weight=n<0?0:n)},n}(),u=window.$MicrosoftMaps8;u.Anchor=ef;u.BasicMapAnimation=fu;u.ClientPerf=yu;u.ImageryMapLayer=ft;u.LatLonCrs=et;u.Location=e;u.LocationRect=b;u.LabelVisibility=pt;u.NetworkCallbacks=tt.callbacks;u.Matrix2D=bi;u.CoreMap=rf;u.MapLayer=ui;u.MapMath=k;u.MapTypeId=s;u.MapQuadrant=hi;u.NavigationBarMode=ut;u.NavigationBarOrientation=ot;u.OverviewMapMode=ar;u.MapView=y;u.MapViewAnimator=bf;u.MoveableSimplePointPrimitive=kf;u.Point=h;u.PooledImage=vr;u.PrimitiveOverlayHelper=yi;u.Rectangle=gt;u.SimplePointPrimitive=vi;u.SimpleLinePrimitive=pi;u.SimpleAreaPrimitive=br;u.Size=nt;u.ResourceManager=li;u.VectorMapLayer=or;u.WeightedLocation=df;u.ZoomLevel=l;u.ZoomAroundLocationAnimator=lr;o=u.Internal=u.Internal||{};o._BoundsAccumulator=ri;o._ComponentNames=rt;o._CurveKey=ct;o._Curve=lt;o._Color=kt;o._CurveVector4=wi;o._CurveColor=tu;o._CurveColorHelper=at;o.CustomMapStyleManager=pf;o._DiscreteRangeCollectionSpline=ru;o._ElementSizeHelper=di;o._ExternalPromise=st;o._EntryPoints=au;o._FeatureNames=vu;o._Helper=f;o._InstrumentationBase=InstrumentationBase;o.Iterator=cf;o._LayerFrameManager=rr;o._LocalStorageCache=bt.LocalStorageCache;o._LoggingWrapper=uu;o._LoggerConstants=d;o._MapFrameData=ur;o._ObjectWithId=lf;o._Overlay=pr;o._ObservableObject=dt;o._ObservableCollection=it;o._Observable=a;o._ObservableObjectChangedArgs=vt;o._JSEvent=t;o._Binding=er;o._EventBinding=bu;o._NAARectangle=ki;o._VectorMath=c;o._Dispatcher=of;o._WorkDispatcher=hf;o._Network=tt;o._Gimme=n;o._Debug=i;o._LatLonCrs=et;o._LruCache=ci;o._TransformCurve=uf;o._HslaTransformCurve=ff;o._Url=yr;o.MapFrameManager=ni;o.MapHelper=tf;o.OrderedDictionary=af;o.DelayLoadedObject=fi;o.StaticPromise=yf;o._GeometryGeneralizer=wf;o._MapAuthentication=ti;o.ViewChangeArgs=yt;o._PerfV2Logger=wr}catch(kr){if(u.logger)u.logger.logCriticalError(kr);else throw kr;}}).call(window)