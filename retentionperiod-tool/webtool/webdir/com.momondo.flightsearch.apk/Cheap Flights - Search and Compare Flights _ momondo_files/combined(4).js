(new R9.logger).time("combined");(function(c){function k(){var a=c('\x3cdiv class\x3d"scroll-bar"\x3e\x3cdiv class\x3d"gutter"\x3e\x3c/div\x3e\x3cdiv class\x3d"handle"\x3e\x3c/div\x3e\x3c/div\x3e').insertAfter(this);this.data("scrollbar",a);a.find(".handle").height(this[0].offsetHeight/this[0].scrollHeight*100+"%")}function l(){var a=this.data("scrollbar"),b=a.find(".handle");a.find(".gutter");var d=this,g=0;this.on("touchstart",function(a){g=a.touches[0].pageY});this.on("touchmove",function(a){var b=this.scrollTop+10*(0<g-a.touches[0].pageY?
1:-1);e.bind(c(this))(b);a.preventDefault()});this.on("wheel",function(a){var b=a.originalEvent,b=this.scrollTop+10*(0>(-b.deltaY||-b.detail)?1:-1);e.bind(c(this))(b);a.preventDefault()});a.on("click",".gutter",function(a){a=a.pageY||a.clientY;e.bind(d)(h.bind(d)(a),!0)});b.on("mousedown",function(){window.getSelection&&window.getSelection().removeAllRanges();b.addClass("hover");c(document).on("mousemove.scrollhandle",function(a){var b=a.pageY||a.clientY;a.preventDefault();e.bind(d)(h.bind(d)(b))});
c(document).on("mouseup.scrollhandle",function(a){b.removeClass("hover");c(document).off(".scrollhandle")});var a=m();if(a.changeEvt)c(document).on(a.changeEvt,function(){document[a.hiddenProp]&&(b.removeClass("hover"),c(document).off(".scrollhandle"))})})}function m(){var a,b;"undefined"!==typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!==typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange");
return{hiddenProp:a,changeEvt:b}}function h(a){var b=this.data("scrollbar"),d=b.find(".handle"),b=b.find(".gutter");a=a-b.offset().top-d.outerHeight()/2;var c=this[0].scrollHeight-this[0].offsetHeight,d=b.height()-d.outerHeight();return c/d*a}function e(a,b){b?this.animate({scrollTop:a},{duration:100,step:f.bind(this),complete:f.bind(this)}):(this[0].scrollTop=a,f.bind(this)())}function f(){var a=this.data("scrollbar");if(a){var b=a.find(".handle"),a=a.find(".gutter"),c=this[0].scrollTop,e=this[0].scrollHeight-
this[0].offsetHeight,a=(a.height()-b.outerHeight())/e*c+b.outerHeight()/2-b.outerHeight()/2+5;b.css("top",a)}}function n(a){a&&"undefined"!==typeof a.scrollTo&&e.bind(this)(a.scrollTo);a&&a.reset&&e.bind(this)(0)}c.fn.scroller=function(a){var b=this.data("scrollbar");if(b)this[0].offsetHeight>=this[0].scrollHeight?b.hide():b.show();else{if(this[0].offsetHeight>=this[0].scrollHeight)return;k.bind(this)();l.bind(this)()}n.bind(this)(a);return this}})(jQuery);(function(c,e){var l=c.config.getBoolean("ui.horizon.widgets.styleJamSelect.scrollLock",!1),k=function(a){c.dom.toggleOneClass(document.body,"scroll-locked",a)};c.createWidgetClass("select.StyleJamSelect",{input:null,inputStatus:null,display:null,displayStatus:null,content:null,background:null,listWrapper:null,list:null,container:null,inlineElementName:null,isOpen:!1,isOpening:!1,options:{modal:!1,container:"",onOpen:null,onClose:null,change:null,onChange:null,alignment:"left",minWidth:300,modalBelowDisplay:!1,
showLabel:!0,showFocusIndication:!1,selectOnFocus:!0,focusModeHighlight:"",showInfoItem:!1,infoItemEnabledClass:"",infoItemDisabledClass:"",infoItemOptionValues:null,infoItemOptionTooltips:null,repositionOnScroll:!1,enableFocusAccessibility:!1},init:function(){this.input=this.getChildElement("input");this.inputStatus=this.getChildElement("input-status");this.content=this.getChildElement("content");this.list=this.getChildElement("list");this.listWrapper=this.getChildElement("list-wrapper");this.options.container&&
(this.container=e(this.options.container),this.container.length||(this.container=null));this.options.modal?(this.display=this.getChildElement("display"),this.displayStatus=this.getChildElement("display-status"),this.background=this.getChildElement("bg"),this.inlineElementName="display"):this.inlineElementName="input";this.options.showInfoItem&&this.setupInfoOptionItem()},addEventHandlers:function(){var a=this;this.registerEvent("click",this[this.inlineElementName],function(){a.toggleContent()});this.registerEvent("keydown.select",
this[this.inlineElementName],function(b){a.handleKeyboardNavigation(b,a.inlineElementName)});this.registerEvent("focus",this[this.inlineElementName],this.onFocus.bind(this,this.inlineElementName));this.registerEvent("keydown.select",document,function(b){a.handleDocumentKeyboardNavigation(b,a.inlineElementName)});this.inputStatus.on("change",function(b){if(a.options.change){var c,d;d=e(this);c=d.attr("data-value");d=d.html();a.options.change.call(a,b,c,d)}});this.subscribe("select.force.close",this.close.bind(this));
this.list.on("click","li",function(){a.updateValue(e(this),!0);a.close()});l&&(this.registerEvent("mouseenter",this.list,k.bind(window,!0)),this.registerEvent("mouseleave",this.list,k.bind(window,!1)));this.registerEvent("click.select touchstart.select",e(document),function(b){0===e(b.target).closest("#"+a.id("content")+", #"+a.id()).length&&(a.close(),a.onBlur(a.options.modal?"display":"input"))});this.options.repositionOnScroll&&this.registerEvent("scroll",e(window),function(){c.dom.schedule(a.position.bind(a))});
this.registerEvent("resize",e(window),function(){c.dom.schedule(a.position.bind(a))});this.options.enableFocusAccessibility&&(this.element.focusin(function(){c.dom.swapClasses(a[a.inlineElementName],"",a.options.focusModeHighlight)}),this.element.focusout(function(){c.dom.swapClasses(a[a.inlineElementName],a.options.focusModeHighlight,"")}));this.options.showFocusIndication&&this.subscribe("body.accessibilityMode.enabled",function(b){b?c.dom.swapClasses(a[a.inlineElementName],"",a.options.focusModeHighlight):
c.dom.swapClasses(a[a.inlineElementName],a.options.focusModeHighlight,"")});this.subscribe("common.widgets.select.close",this.close.bind(this))},handleKeyboardNavigation:function(a,b){switch(a.which){case c.globals.keyCodes.SPACE:case c.globals.keyCodes.RETURN:this.isOpen||(this.isOpening=!0,this.open(),a.preventDefault());break;case c.globals.keyCodes.DOWN:case c.globals.keyCodes.UP:a.preventDefault();this.isOpen||(this.isOpening=!0,this.open());break;case c.globals.keyCodes.TAB:this.isOpen&&this.close(),
this.onBlur(b)}},handleDocumentKeyboardNavigation:function(a,b){switch(a.which){case c.globals.keyCodes.SPACE:case c.globals.keyCodes.RETURN:this.isOpen&&!this.isOpening?(this.updateValue(this.getHighlightedItems().first(),!1),this.triggerChange(),this.close(),a.preventDefault()):this.isOpening&&(this.isOpening=!1);break;case c.globals.keyCodes.DOWN:this.isOpen&&!this.isOpening?(a.preventDefault(),a=this.list.find("li.js-focus").next(),a.length||(a=this.list.children("li[data-selected\x3dtrue]"),
a.length||(a=this.list.children().eq(0))),this.focusItem(a)):this.isOpening&&(this.isOpening=!1);break;case c.globals.keyCodes.UP:this.isOpen&&!this.isOpening&&(a.preventDefault(),a=this.list.find("li.js-focus").prev(),a.length||(a=this.list.children("li[data-selected\x3dtrue]"),a.length||(a=this.list.children().eq(0))),this.focusItem(a));break;case c.globals.keyCodes.TAB:this.isOpen&&(this.close(),this.focusInlineElement(),this.onBlur(b));break;case c.globals.keyCodes.ESC:this.isOpen&&(this.updateSelection(this.getSelectedItem()),
this.close(),this.focusInlineElement())}},isValidElement:function(){return!0},focusInlineElement:function(){this[this.inlineElementName].focus()},onFocus:function(a){c.dom.swapChildrenClasses(this[a],this.options.sjstate[a],"blurred","focused")},onBlur:function(a){c.dom.swapChildrenClasses(this[a],this.options.sjstate[a],"focused","blurred")},toggleContent:function(){this.isOpen?this.close():this.open()},open:function(){if(!this.isOpen){this.position();var a=this;this.isOpen=!0;if(this.container)this.container.off("scroll."+
a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.position()});this.list.scroller();setTimeout(function(){a.ensureVisible(a.getSelectedItem(),!0)},200);c.dom.swapChildrenClasses(this.content,this.options.sjstate.content,"closed","open");c.dom.swapChildrenClasses(this.input,this.options.sjstate.input,"closed","open");c.dom.swapChildrenClasses(this.display,this.options.sjstate.display,"closed","open");if("function"===typeof this.options.onOpen)this.options.onOpen(this);this.display&&this.display.attr("aria-expanded",
!0);c.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);c.events.publish("Select.opened",{id:this.id()})}},close:function(){if(this.isOpen){l&&k(!1);var a=this.isOpen;this.isOpen=!1;c.dom.swapChildrenClasses(this.content,this.options.sjstate.content,"open","closed");c.dom.swapChildrenClasses(this.input,this.options.sjstate.input,"open","closed");c.dom.swapChildrenClasses(this.display,this.options.sjstate.display,"open","closed");if("function"===typeof this.options.onClose)this.options.onClose(a,
this);this.display&&this.display.attr("aria-expanded",!1);c.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1);this.options.selectOnFocus&&this.focusInlineElement();c.events.publish("Select.closed",{id:this.id()})}},position:function(){var a=this.getPositionElement(),b=a.offset(),c=a.outerWidth(),d=e(window).outerWidth(),g={};if(this.container)var f=this.container.offset(),b={top:this.options.modalBelowDisplay?1:b.top-f.top+container.scrollTop(),left:this.options.modalBelowDisplay?
0:b.left-f.left};this.options.modal?(this.background.css({width:c-16,height:this.display.outerHeight()-16}),f=Math.max(c,this.options.minWidth),this.content.css({minWidth:f>d?d:f,maxWidth:d}),a=this.options.modalBelowDisplay?Math.floor(b.top+a.outerHeight()+1):Math.floor(b.top)):(a=Math.floor(b.top+a.outerHeight()),g.minWidth=c);f=this.content.outerWidth();b="right"===this.options.alignment?Math.ceil(b.left-(f-c)):Math.floor(b.left);b+f>d&&(d=d-f-10,b=0<d?d:0);g.transform="translate("+b+"px, "+a+
"px)";g.msTransform=g.transform;this.content.css(g)},getPositionElement:function(){return this.options.modal?this.display:this.input},ensureVisible:function(a,b){if(a.position()){var c=a.position().top;a=a.outerHeight(!0);var d=this.listWrapper.scrollTop(),g=this.listWrapper.height(),f=this.list.scrollTop();if(b){b=this.list[0].scrollHeight;var e=c+this.list.scrollTop(),h=(g-a)/2;if(e>h&&b-e>h){this.list.scroller({scrollTo:d+f+c-h});return}e<h?this.list.scroller({scrollTo:0}):this.list.scroller({scrollTo:b-
g})}0>c?this.list.scroller({scrollTo:d+f+c}):c+a>g&&this.list.scroller({scrollTo:d+f+(c+a-g)})}},getSelectedItem:function(){var a=this.list.find("li"),b=a.filter("[data-value\x3d'"+this.val()+"']");return b.length?b:a.first()},getHighlightedItems:function(){return this.list.children("li.js-focus")},focusItem:function(a){if(this.options.selectOnFocus)this.updateSelection(a);else{var b=this.list.children(".js-focus");b.removeClass("js-focus").attr("aria-selected",!1);a.addClass("js-focus").attr("aria-selected",
!0);var e=this.getStlBlock("item-focused");c.dom.swapClasses(b,e,"");c.dom.swapClasses(a,"",e);(this.display||this.element).attr("aria-activedescendant",a.attr("id"));this.isOpen&&this.ensureVisible(a,!0)}},toggleItemSelection:function(a,b){a.toggleClass("js-focus",b).attr("aria-selected",b);c.dom.swapChildrenClasses(a,this.options.sjstate.listItem,b?"deselected":"selected",b?"selected":"deselected")},updateSelection:function(a){(this.display||this.element).attr("aria-activedescendant",a.attr("id"));
this.toggleItemSelection(this.getHighlightedItems(),!1);this.toggleItemSelection(a,!0);this.options.selectOnFocus&&a.focus()},updateValue:function(a,b){this.isNodeDisabled(a)||(this.isOpen&&this.ensureVisible(a,!0),this.updateSelection(a),this.setInputValue(a),this.options.showInfoItem&&this.setupInfoOptionItem(),b&&this.triggerChange())},triggerChange:function(){"function"===typeof this.options.change&&this.inputStatus.trigger("change")},setInputValue:function(a){var b=a.attr("data-value");a=a.attr("data-labelText")||
a.attr("data-title");this.inputStatus.text(a);this.inputStatus.attr("data-value",b);this.inputStatus.attr("data-title",a);this.options.modal&&this.options.showLabel&&(this.displayStatus.html(a),this.displayStatus.attr("data-value",b),this.displayStatus.attr("data-title",a));this.options.modal&&this.getChildElement("display-text").attr("aria-label",a);this.element.hasValue=!!b},setupInfoOptionItem:function(){var a=this.options.infoItemOptionValues;if(a&&0<a.length){var b=this.getChildElement("post-info"),
a=a.indexOf(this.getValue());-1<a?((a=this.options.infoItemOptionTooltips[a])&&b.toolTip({content:a,extraClass:"halfWidth"}),c.dom.swapClasses(b,this.options.infoItemDisabledClass,this.options.infoItemEnabledClass)):c.dom.swapClasses(b,this.options.infoItemEnabledClass,this.options.infoItemDisabledClass)}},_getItemByValue:function(a){return this.list.find("li[data-value\x3d'"+a+"']")},val:function(){return this.inputStatus.attr("data-value")},getValue:function(){return this.val()},dataVal:function(){return this.inputStatus.attr("data-value")},
getDataValue:function(){return this.dataVal()},getText:function(){return this.inputStatus.html()||this.inputStatus.text()},setText:function(a){this.inputStatus.html(a)},setValue:function(a,b){a=this._getItemByValue(a);this.updateValue(a,b)},setValueOrDefault:function(a,b){a=this._getItemByValue(a);a.length?this.updateValue(a,b):this.setValue("",b)},getItemText:function(a){a=this._getItemByValue(a);if(a.length)return a.html()},updateItemText:function(a,b){var c=this._getItemByValue(a);c.length&&(c.attr("data-title",
b),c.html(b));a===this.getDataValue()&&this.setInputValue(c)},updateItemValue:function(a,b,c){a=this._getItemByValue(a);a.length&&a.attr("data-value",b);c&&(this.setInputValue(a),this.updateSelection(a))},selectItem:function(a,b){a=this._getItemByValue(a);b&&(this.setInputValue(a),this.updateSelection(a))},isNodeSelected:function(a){return a.length&&"true"===a.attr("data-selected")},isNodeDisabled:function(a){return a.length&&a.attr("disabled")},getNodeDataValue:function(a){return a.length?a.attr("data-value"):
""},disableValue:function(a){a=this._getItemByValue(a);a.length&&a.attr("disabled","disabled")},enableValue:function(a){a=this._getItemByValue(a);a.length&&a.removeAttr("disabled")},hideNode:function(a){a=this._getItemByValue(a);a.length&&(this.swapClasses(a,"","Select__content__list__list-item--hidden"),a.attr("hidden","hidden"))},showNode:function(a){a=this._getItemByValue(a);a.length&&(this.swapClasses(a,"Select__content__list__list-item--hidden",""),a.removeAttr("hidden"))},hasVisibleNodes:function(){var a=
this.list.find("li");return a.length>a.filter("[hidden\x3d'hidden']").length}})})(window.R9,window.jq||window.jQuery);(function(d,e){d.createComponentClass("common.search.SearchFormDisplaySwitch",{options:{isRadiobuttonSet:!1,isSelect:!1,isCheckbox:!1,options:null,baseEvent:"",namespace:null},switch:null,switchElement:null,checkOptions:null,init:function(){var a=this;this.switchElement=this.getChildElement("switch");this.checkOptions={};e.each(this.options.options,function(b,c){a.checkOptions[c.displayOption?"checked":"unchecked"]=c})},addEventHandlers:function(){},inlineComponentsReady:function(){this.switch=this.switchElement.getWidget();
this.options.isRadiobuttonSet?this.switch.options.change=this.onRadioChange.bind(this):this.options.isSelect?this.switch.options.change=this.onSelectChange.bind(this):this.options.isCheckbox&&(this.switch=e.fn.styleJamCheckBox?this.switchElement.styleJamCheckbox({change:this.onCheckChange.bind(this)}).getWidget():this.switchElement.checkbox({change:this.onCheckChange.bind(this)}).getWidget());this.options.sync&&(this.subscribe(this.options.baseEvent+".set",this.setDisplay.bind(this)),this.subscribe(this.options.baseEvent+
".focus",this.focus.bind(this)),this.subscribe(this.options.baseEvent+".trigger",this.triggerBy.bind(this)))},triggerBy:function(a){(a=this.getChildElement(a))&&a.trigger("click")},onRadioChange:function(a,b,c){this.publishChangeEvent(a.value,b.title)},onSelectChange:function(a,b,c){this.publishChangeEvent(b,c)},onCheckChange:function(a){a=this.checkOptions[a.checked?"checked":"unchecked"];this.publishChangeEvent(a.value,a.text)},publishChangeEvent:function(a,b){d.events.publish(this.options.baseEvent+
".change",{value:a,text:b,namespace:this.options.namespace})},setDisplay:function(a){this.options.isRadiobuttonSet?this.switch.setButtonCheckedByValue(a):this.options.isSelect?this.switch.setValue(a,!1):this.options.isCheckbox&&(this.switch.setChecked(this.checkOptions.checked.value===a),this.switch.refresh&&this.switch.refresh(this.switch.element))},focus:function(){this.switchElement.focus()}})})(window.R9,window.jQuery);(function(a,e){a.createWidgetClass("dropdown.StyleJamDropdownDialogTrigger",{options:{states:null,showFocusIndication:!1,useValueLabel:!1},isFocused:!1,isOpen:!1,cover:null,init:function(){this.options.useCover&&(this.cover=this.getChildElement("cover"))},addEventHandlers:function(){var d=this,c=this.options.states||{};this.element.on("focus",this.onFocus.bind(this));this.element.on("blur",this.onBlur.bind(this));this.options.showFocusIndication&&this.subscribe("body.accessibilityMode.enabled",function(b){b?
a.dom.swapClasses(d.element,"",c.focusModeHighlight):a.dom.swapClasses(d.element,c.focusModeHighlight,"")});this.subscribe("hotels.detailsv2.sticky.toggle",function(b){b?a.dom.swapClasses(this.element,this.options.styles.dropdownTrigger,this.options.styles.dropdownTriggerSticky):a.dom.swapClasses(this.element,this.options.styles.dropdownTriggerSticky,this.options.styles.dropdownTrigger)}.bind(this))},onFocus:function(){this.isFocused||(this.setView("focused"),this.isFocused=!0)},onBlur:function(a){if(a||
this.isFocused&&!this.isOpen)this.setView("blurred"),this.isFocused=!1},focus:function(){this.element.focus()},blur:function(){this.element.blur()},open:function(){this.isOpen=!0;this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!0);this.element.attr("aria-expanded",!0);this.setView("opened");this.onFocus()},close:function(){this.isOpen=!1;this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!1);this.element.attr("aria-expanded",!1);this.setView("closed");if(!this.element.is(":focus"))this.onBlur()},
setView:function(d){var c=this,b=this.options.states||{};a.dom.schedule(function(){switch(d){case "opened":a.dom.swapClasses(c.element,b.closed,b.opened);c.options.useCover&&(a.dom.swapClasses(c.cover,b.coverClosed,b.coverOpened),c.getChildElement("cover-inner").css("transform","scale("+(c.cover.outerWidth()+2)/c.element.outerWidth()+", 1.333)"));break;case "closed":a.dom.swapClasses(c.element,b.opened,b.closed);c.options.useCover&&(a.dom.swapClasses(c.cover,b.coverOpened,b.coverClosed),c.getChildElement("cover-inner").css("transform",
"scale(1)"));break;case "focused":a.dom.swapClasses(c.element,b.notFocused,b.focused);break;case "blurred":a.dom.swapClasses(c.element,b.focused,b.notFocused)}})},removeHasValue:function(){},addHasValue:function(){},hasValue:function(){return!0},enabled:e.noop,disable:e.noop,isVisible:function(){return this.element.is(":visible")},updateValueText:function(a){this.options.useValueLabel&&this.getChildElement("display-text").attr("aria-label",a)}})})(R9,jQuery);(function(b,c){b.createWidgetClass("button.StyleJamButton",{options:{inactiveStlBlock:"",activeStlBlock:"",canPulse:!1},init:function(){},addEventHandlers:function(){this.options.inactiveStlBlock&&this.options.activeStlBlock&&(this.subscribe("button.deactivate",{id:this.id()},this.toggleActivation.bind(this,!1)),this.subscribe("button.activate",{id:this.id()},this.toggleActivation.bind(this,!0)));this.options.canPulse&&(this.subscribe("button.pulse",{id:this.id()},this.pulse.bind(this,!0)),this.subscribe("button.pulse.reset",
{id:this.id()},this.pulse.bind(this,!1)))},toggleActivation:function(a){this.swapClassesToggle(this.element,this.options.inactiveStlBlock,this.options.activeStlBlock,!a)},pulse:function(a){this.swapClassesToggle(this.element,"","Button--pulse",!a)}})})(R9,jQuery);(function(b){R9.extend("Widgets",{TextInput:function(a,c){this.elementNode=a;this.element=b(this.elementNode);this.validateElement()&&(this.options=b.extend({},this.options,c),this.init())}});R9.extend("Widgets.TextInput",{isTextInput:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"text"==a.type.toLowerCase()},isWidgetControlled:function(a){return"undefined"==typeof document.createElement("input").placeholder}});R9.extend("Widgets.TextInput.prototype",{widgetName:"textinput",
widgetBaseClass:"r9-textinput",widgetPlaceholderClass:"r9-textinput-placeholder-active",elementNode:null,element:null,options:{click:null,change:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("smartyfocus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindFormSubmission();this.element.data(this.widgetName,this);this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode)},validateElement:function(){return R9.Widgets.TextInput.isTextInput(this.elementNode)&&
R9.Widgets.TextInput.isWidgetControlled(this.elementNode)&&void 0===this.element.data(this.widgetName)},bindInputEvent:function(a,b){var c=this;a+="."+this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,a)})},bindFormSubmission:function(){var a=this,b="submit."+a.widgetName+a.element.attr("id"),d="form-pre-submit."+a.widgetName+a.element.attr("id");this.element.parents("form").off(b).on(b,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)});
this.element.parents("form").off(d).on(d,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)})},handleElementFocusEvent:function(a,c){a.disabled||(b(a).val()==b(a).attr("placeholder")&&this.clearPlaceholderText(b(a)),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,c){a.disabled||(0==b.trim(b(a).val()).length&&this.setPlaceholderText(a),this.options.blur&&this.options.blur.apply(this,arguments))},clearPlaceholderText:function(a){a.removeClass(this.widgetPlaceholderClass).val("")},
setPlaceholderText:function(a){b(a).addClass(this.widgetPlaceholderClass).val(b(a).attr("placeholder"))}})})(jq||jQuery);
(function(b){R9.createWidgetClass("text.StyleJamTextInput",b.extend({},R9.Widgets.TextInput.prototype,{widgetPlaceholderClass:"vs-placeholder",inputElement:null,inputState:null,options:{needsPlaceholderSupport:!1,selectOnFocus:!1,inputValidationEnabled:!1,presentationStates:{}},init:function(){this.inputElement=this.inputElement||this.element;this.elementNode=this.inputElement.get(0);this.options.inputValidationEnabled&&(this.inputState=this.getChildElement("inputState"),this.inputError=this.getChildElement("inputError"),
this.inputSuccess=this.getChildElement("inputSuccess"))},addEventHandlers:function(){var a=this;(this.options.needsPlaceholderSupport||this.options.presentationStates)&&this.bindInputEvent("focus",this.handleElementFocusEvent);this.options.needsPlaceholderSupport&&(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));if(this.options.selectOnFocus)a.inputElement.on("focus",
function(){a.inputElement.on("mouseup.a keyup.a",function(b){a.elementNode.setSelectionRange(0,9999);a.inputElement.off("mouseup.a keyup.a").select()})});this.options.inputValidationEnabled&&null!==this.inputState&&this.subscribe("input.validation",a.handleValidation.bind(this));this.options.presentationStates&&this.styleInvalidState()},getValue:function(){return b(this.inputElement).val()},handleElementFocusEvent:function(a,b){this.options.presentationStates&&this.styleInvalidState(!1);R9.Widgets.TextInput.prototype.handleElementFocusEvent.call(this,
a,b)},styleInvalidState:function(a){a?R9.dom.swapClasses(b(this.elementNode),this.options.presentationStates.regular,this.options.presentationStates.invalid):R9.dom.swapClasses(b(this.elementNode),this.options.presentationStates.invalid,this.options.presentationStates.regular)},handleValidation:function(a){a&&a.state&&a.inputEl===this.element.id()&&("error"===a.state&&this.swapClasses(this.inputError,"TextInput__State--hidden","TextInput__State--visible"),"success"===a.state&&this.swapClasses(this.inputSuccess,
"TextInput__State--hidden","TextInput__State--visible"))}}))})(jq||jQuery);(function(c){R9.extend("Widgets",{NumberBox:function(b,a){this.inputNode=c(b).find("input")[0];this.jqNode=c(b);if(!this.isValidElement())return this;this.options=c.extend({},this.options,a);this.init()}});R9.extend("Widgets.NumberBox.prototype",{widgetName:"r9NumberBox",inputNode:null,jqNode:null,options:{min:0,max:6,defaultValue:0,callback:c.noop,validator:null,onlyDecorateDisabledButtons:!1},boxValue:0,incrButton:null,decrButton:null,styleJamButton:null,isValidElement:function(){return this.jqNode&&
this.jqNode.children().hasClass("incrementor")&&this.jqNode.children().hasClass("decrementor")&&this.jqNode.children().hasClass("numberHolder")},canChange:function(b){return"function"===typeof this.options.validator?this.options.validator.call(this,b,this.boxValue):!0},getStyleJamButton:function(){return R9.stylejam&&R9.stylejam.common&&R9.stylejam.common.widgets&&R9.stylejam.common.widgets.button?R9.stylejam.common.widgets.button.StyleJamButton:null},increment:function(){if(this.boxValue<this.options.max&&
this.canChange(1))return this.boxValue+=1,this.updateView(),this.options.callback.call(this,1,this.boxValue),!0;this.disableButton(this.incrButton);return!1},decrement:function(){if(this.boxValue>this.options.min&&this.canChange(-1))return--this.boxValue,this.updateView(),this.options.callback.call(this,-1,this.boxValue),!0;this.disableButton(this.decrButton);return!1},updateView:function(){c(this.inputNode).val(this.boxValue);c(this.inputNode).trigger("change");c(this.jqNode).attr("aria-valuenow",
this.boxValue);this.boxValue===this.options.max?(this.enableButton(this.decrButton),this.disableButton(this.incrButton)):(this.boxValue===this.options.min?this.disableButton(this.decrButton):this.enableButton(this.decrButton),this.enableButton(this.incrButton));this.ariaLabel&&this.ariaLabel.length&&this.ariaLabelMessage&&this.updateAriaLabel()},updateAriaLabel:function(){this.ariaLabelUpdateId&&(window.clearTimeout(this.ariaLabelUpdateId),this.ariaLabelUpdateId=null);this.ariaLabelUpdateId=window.setTimeout(function(){var b;
b=-1<this.ariaLabelMessage.indexOf("|")?R9.Common.Utils.String.formatChoice(this.ariaLabelMessage,this.boxValue,this.boxValue):R9.Common.Utils.String.formatString(this.ariaLabelMessage,this.boxValue);this.ariaLabel.html(b)}.bind(this),200)},getValue:function(){return this.boxValue},setValue:function(b,a){b=parseInt(b);if(isNaN(b)||this.boxValue===b)return!1;var c=b-this.boxValue;if(!a&&!this.canChange(c))return!1;this.boxValue=b;this.updateView();this.options.callback&&this.options.callback.call(this,
c);return!0},init:function(){this.styleJamButton=this.getStyleJamButton();this.boxValue=""!=this.inputNode.value?parseInt(this.inputNode.value,10):0;this.incrButton=this.jqNode.find(".incrementor");this.decrButton=this.jqNode.find(".decrementor");this.jqNode.data(this.widgetName,this);0<this.options.defaultValue?this.setValue(this.options.defaultValue):!isNaN(this.options.max)&&this.boxValue>this.options.max&&(this.boxValue=this.options.max);c(this.inputNode).prop("readonly","readonly");this.inputNode.value=
this.boxValue;var b=this;this.incrButton.unbind("click").click(function(a){b.increment();jq(b.jqNode).trigger("increment");return!1});this.decrButton.unbind("click").click(function(a){b.decrement();jq(b.jqNode).trigger("decrement");return!1});this.updateView()},enableButton:function(b){b.removeClass("NumberBox-disabled").prop("disabled",!1).attr("aria-disabled","false");this.styleJamButton&&R9.dom.swapClasses(b,this.styleJamButton.plusMinusButtonDisabled,this.styleJamButton.plusMinusButtonEnabled)},
disableButton:function(b){b.addClass("NumberBox-disabled");this.options.onlyDecorateDisabledButtons||b.prop("disabled",!0).attr("aria-disabled","true");this.styleJamButton&&R9.dom.swapClasses(b,this.styleJamButton.plusMinusButtonEnabled,this.styleJamButton.plusMinusButtonDisabled)},disableDecrement:function(){this.disableButton(this.decrButton)},enableDecrement:function(){this.enableButton(this.decrButton)},disableIncrement:function(){this.disableButton(this.incrButton)},enableIncrement:function(){this.enableButton(this.incrButton)}})})(jq||
jQuery);
(function(c,b){c.createWidgetClass("number.StyleJamNumberBox",b.extend({},c.Widgets.NumberBox.prototype,{init:function(a,c){this.styleJamButton=this.getStyleJamButton();this.inputNode=b(a).find("input")[0];this.jqNode=b(a);this.styleJamButton&&this.jqNode.data("presentation")&&(a=this.jqNode.data("presentation"),this.styleJamButton.hasOwnProperty(a)&&(this.styleJamButton=this.styleJamButton[a]));if(!this.isValidElement())return this;this.inputNode&&(this.boxValue=""!==this.inputNode.value?parseInt(this.inputNode.value,
10):0);this.incrButton=this.jqNode.find(".incrementor-js");this.decrButton=this.jqNode.find(".decrementor-js");this.ariaLabel=this.getChildElement("ariaLabel");this.ariaLabelMessage=this.ariaLabel.data("msg");this.ariaLabel.attr("data-msg",null);0<this.options.defaultValue&&0===this.boxValue&&this.setValue(this.options.defaultValue,!0);this.options.withConstant&&(this.options=b.extend({withConstant:!1,descriptionWords:[]},this.options,c),this.index=0,this.countWord=this.jqNode.find(".count-word-js"),
this.options.min=0,this.options.max=this.options.descriptionWords.length-1,this.updateConstantValue(0));b(this.inputNode).prop("readonly","readonly");this.updateView()},isValidElement:function(){return!0},canChange:function(a){return"function"===typeof this.options.validator?this.options.validator.call(this,a,this.boxValue):!0},addEventHandlers:function(a){var d=this;this.incrButton.unbind("click").click(function(a){d.options.withConstant?(d.updateConstantValue(1),d.options.callback.call(d)):d.increment();
jq(d.jqNode).trigger("increment");c.globals.keyboardNav||b(this).blur();return!1});this.decrButton.unbind("click").click(function(a){d.options.withConstant?(d.updateConstantValue(-1),d.options.callback.call(d)):d.decrement();jq(d.jqNode).trigger("decrement");c.globals.keyboardNav||b(this).blur();return!1});this.element.keyup(function(a){if(a.altKey||a.ctrlKey||a.shiftKey)return!0;switch(a.keyCode){case c.globals.keyCodes.DOWN:case c.globals.keyCodes.LEFT:case c.globals.keyCodes.PAGE_DOWN:return d.decrement(),
jq(d.jqNode).trigger("decrement"),a.preventDefault(),a.stopPropagation(),!1;case c.globals.keyCodes.UP:case c.globals.keyCodes.RIGHT:case c.globals.keyCodes.PAGE_UP:return d.increment(),jq(d.jqNode).trigger("increment"),a.preventDefault(),a.stopPropagation(),!1}});this.element.on("keydown",function(a){if(a.altKey||a.ctrlKey||a.shiftKey)return!0;switch(a.keyCode){case c.globals.keyCodes.PAGE_UP:case c.globals.keyCodes.PAGE_DOWN:case c.globals.keyCodes.HOME:case c.globals.keyCodes.END:case c.globals.keyCodes.LEFT:case c.globals.keyCodes.UP:case c.globals.keyCodes.RIGHT:case c.globals.keyCodes.DOWN:return a.preventDefault(),
a.stopPropagation(),!1}})},setValue:function(a,b){a=parseInt(a);if(isNaN(a)||this.boxValue===a)return!1;var c=this.boxValue>a?0===a?a:this.boxValue-a:a-this.boxValue;if(b||this.canChange(c))this.boxValue=a,this.updateView(),this.options.callback&&!b&&this.options.callback.call(this,c)},getIndex:function(){return this.index},setIndex:function(a,b){a=parseInt(a);if(isNaN(a)||this.index===a)return!1;a-=this.index;b&&(this.updateConstantValue(a),this.options.callback&&!b&&this.options.callback.call(this,
a))},updateConstantValue:function(a){a=this.index+a;0<=a&&a<this.options.descriptionWords.length&&(this.index=a,this.countWord.text(this.options.descriptionWords[this.index]));this.index===this.options.max?(this.enableButton(this.decrButton),this.disableButton(this.incrButton)):(this.index===this.options.min?this.disableButton(this.decrButton):this.enableButton(this.decrButton),this.enableButton(this.incrButton))}}))})(window.R9,window.jQuery);(function(h,e){h.createWidgetClass("dropdown.StyleJamDropdownDialog",{element:null,trigger:null,triggerObj:void 0,elementNode:null,content:null,label:null,value:null,icon:null,isOpen:!1,leftOffset:0,ajaxLoadFailed:!1,eventSuffix:null,subValue:null,animationDuration:200,options:{autoOpen:!1,alignment:null,direction:"down",isPopover:!1,showIcon:!0,matchWidth:!1,isFixedWidth:!1,loadWithAjaxOnInit:!1,ajaxUrl:"",ajaxData:{},iconClass:"",contentClass:"",triggerElemId:null,content:null,onInit:null,onOpen:null,
onClose:null,text:"",coverTrigger:!1,topOffset:0,topOffsetFromTrigger:0,leftOffset:0,removeZIndex:!1,flippable:!0,delayShowDropdown:e.noop,showDropdownDelay:200,hasSubValue:!1,animateClose:null,expandTo:null,forceTriggerWidth:!1,openDisabled:!1,staticPosition:!1,subtractContainerOffset:!1},states:null,init:function(){!this.options.alignment&&this.element&&this.element.data("alignment")&&(this.options.alignment=this.element.data("alignment"));!this.options.expandTo&&this.element&&this.element.data("expandto")&&
(this.options.expandTo=this.element.data("expandto"));this.options.alignment||(this.options.alignment="left");this.eventSuffix=".DropdownDialog."+this.id();this.options.autoOpen?this.open():this.element.addClass(this.options.closedStateClzs);this.options.coverTrigger&&(this.cover=this.getChildElement("cover"),this.innerContent=this.getChildElement("inner"));if(this.options.onInit)this.options.onInit(this);this.options.target?this.trigger=this.options.target:this.createTrigger();this.trigger.attr("data-test-popover-trigger",
"");this.elementNode=this.element[0];this.createContent();this.popoverArrow=this.getChildElement("popover-arrow");this.options.loadWithAjaxOnInit&&this.options.ajaxUrl&&this.loadAjax();this.options.alignment||(this.options.alignment="left");if(this.options.coverTrigger)this.trigger.one("mouseover",this.reposition.bind(this))},addEventHandlers:function(){function a(a){b.isOpen&&(a=e(a.target).closest(".StyleJamDropdownDialog"),b.content[0]!=a[0]&&b.isOpen&&b.close())}var b=this,c=e("body"),d=this.trigger;
c.on("click"+this.eventSuffix,a);c.on("touchstart"+this.eventSuffix,a);this.subscribe("trips.menu.open",e.proxy(this.close,this));this.subscribe("authentication.showLogin",this.close.bind(this,null,!0));this.registerEvent("click",d,function(d){c.off("click",a);b.toggleContent();setTimeout(function(){c.on("click",a)},10)});this.registerEvent("keydown",d,function(d){if(13===d.which||32===d.which)b.toggleContent(),setTimeout(function(){c.on("click",a)},10),d.preventDefault(),d.stopImmediatePropagation(),
d.stopPropagation()});this.registerEvent("keydown"+this.eventSuffix,e(document),function(a){27===a.which&&b.close(a,null,!0)});this.registerEvent("resize"+this.eventSuffix,e(window),function(){b.isOpen&&b.reposition(!0)});this.registerEvent("scroll"+this.eventSuffix,e(document),function(){b.isOpen&&b.reposition(!0)});this.registerEvent("scroll"+this.eventSuffix,e(".viewport"),function(){b.isOpen&&b.reposition(!0)});var g=null,d=function(){b.triggerObj&&!b.triggerObj.isVisible()||g||h.Common.Utils.Browsers.isIE(11)||
(g=setTimeout(function(){b.reposition(!0);g=null},25))};this.registerEvent("click",this.content.find(".close"),this.close.bind(this));this.subscribe("common.dropdown.closeAll",this.close.bind(this));this.registerEvent("mouseup touchend",this.content,d);this.subscribe("horizon.dropdownDialog.reposition",d)},destroy:function(){this.base();this.trigger.off("mouseover");e(".viewport").off("scroll"+this.eventSuffix);e(window).off("resize"+this.eventSuffix);e(document).off("scroll"+this.eventSuffix).off("keydown"+
this.eventSuffix);e(document.body).off("click"+this.eventSuffix).off("touchstart"+this.eventSuffix);this.content.off("keydown")},createContent:function(){this.content=this.options.content&&this.options.content.length?e(this.options.content):e("#"+this.element.attr("id")+"_content");this.options.isFixedWidth&&this.content.css("width",this.getTriggerWidth()+"px")},createTrigger:function(){if(null!=this.options.triggerElemId)this.trigger=e("#"+this.options.triggerElemId);else{var a=this.element.data("trigger-id");
null!=a&&""!==a&&(this.trigger=e("#"+a))}null!=this.trigger&&this.trigger.length?this.triggerObj=this.trigger.getWidget():this.trigger=this.element;this.label=this.trigger.find(".js-label");this.options.showIcon&&(this.icon=this.trigger.find(".js-icon"));this.options.hasSubValue&&(this.subValue=this.label.find(".js-subValue"));if(this.options.text)this[this.options.hasSubValue?"updateValue":"updateLabel"](this.options.text);else this.options.hasSubValue||(a=this.label.html())&&a.trim()&&this.updateLabel(a.trim())},
open:function(){if(!this.options.openDisabled){this.isOpen=!0;var a=this,b="body";if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.open.bind(this),this.options.showDropdownDelay);else{null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);this.options.container&&""!==this.options.container&&(b=this.options.container,e(a.options.container).off("scroll."+
a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.reposition()}));this.options.isPopover&&this.popoverArrow.show();this.content.appendTo(b);if(this.options.onOpen)this.options.onOpen(this);a.triggerObj&&a.triggerObj.open();this.reposition();h.dom.swapClasses(a.content,this.getStateClasses("closed"),this.getStateClasses("open"));this.options.coverTrigger&&(this.content.removeClass("closed").addClass("open"),h.dom.swapClasses(this.cover,this.getStateClasses("coverClosed"),this.getStateClasses("coverOpened")),
h.dom.swapClasses(this.innerContent,this.getStateClasses("contentClosed"),this.getStateClasses("contentOpened")));this.content.attr("aria-expanded",!0);h.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);h.events.publish("DropdownDialog.open",{id:a.id()});this.setupTabKeyHandling()}}},setupTabKeyHandling:function(){var a=this,b=this.getFocusableElements();b.length&&(b.first().focus(),this.content.off("keydown").on("keydown",function(b){var d=a.getFocusableElements(),
c=e(b.target),k=d.first().is(c)&&b.shiftKey,c=d.last().is(c)&&!b.shiftKey;b.which===h.globals.keyCodes.TAB&&(1===d.length||k||c)&&a.close(b,!1,!0)}))},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible").not("[tabindex\x3d-1],[disabled]")},_close:function(a,b,c){var d=this.isOpen,e=this;this.isOpen=!1;this.options.isPopover&&this.popoverArrow.hide();this.triggerObj&&this.triggerObj.close();h.dom.swapClasses(this.content,this.getStateClasses("open"),this.getStateClasses("closed"));
this.options.coverTrigger&&(this.content.removeClass("open").addClass("closed"),h.dom.swapClasses(this.cover,this.getStateClasses("coverOpened"),this.getStateClasses("coverClosed")),h.dom.swapClasses(this.innerContent,this.getStateClasses("contentOpened"),this.getStateClasses("contentClosed")));this.content.css({top:"",right:"",left:"",bottom:""});this.options.coverTrigger?setTimeout(function(){e.element.append(e.content)},200):this.element.append(this.content);this.content.off("keydown");c&&e.triggerObj&&
e.triggerObj.focus();if(this.options.onClose)this.options.onClose(d,this,a);h.events.publish("DropdownDialog.close",{id:this.id(),silent:!!b});this.content.attr("aria-expanded",!1);h.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1)},close:function(a,b,c){if(this.options.animateClose){var d=this;this.animateClose(function(){d._close(a,b,c)})}else this.isOpen&&this._close(a,b,c)},toggleContent:function(){this.isOpen?this.close(null,null,!0):this.open()},updateLabel:function(a,
b,c){var d=a;b&&(d+=(c||"")+b);this.label.html(d);"0"==d+""||d?this.triggerObj&&this.triggerObj.addHasValue():this.triggerObj&&this.triggerObj.removeHasValue();this.triggerObj&&a&&this.triggerObj.updateValueText(a)},updateValue:function(a){a=a||"";this.value.html(a);"0"==a+""||a?this.triggerObj&&this.triggerObj.addHasValue():this.triggerObj&&this.triggerObj.removeHasValue()},hasValue:function(){return this.triggerObj?this.triggerObj.hasValue():!1},reposition:function(a){if(this.options.staticPosition)this.content.css(this.options.staticPosition);
else{var b=this.options.direction,c=this.options.alignment,d=this.trigger.offset(),g=e(this.options.container),k=e(this.options.expandTo),m=k.length&&k.is(":visible"),f=e(window).outerWidth(),n=m?k.offset():null;if(g.length)var l=g.offset(),d={top:d.top-l.top+g.scrollTop(),left:d.left-l.left};else g=e(window);l=d.top+this.trigger.outerHeight();l+=this.options.topOffsetFromTrigger;0===this.trigger.width()&&0!==this.trigger.position().top&&(l+=window.scrollY);if(this.options.coverTrigger)m=0,k=e(this.options.container),
this.options.subtractContainerOffset&&k.length&&(m=k.offset().left),k=this.content.outerWidth(),c=this.trigger.offset().left,m="rtl"===document.dir?-1*Math.floor(window.innerWidth-(c+this.getTriggerWidth())-m):Math.floor(this.trigger.offset().left-m),l=Math.floor(l)-this.trigger.outerHeight(),c=m+"px",m+k>f&&(k=f-k-10,c=(0<k?k:0)+"px"),this.options.newSearchHeaderDesign&&568>f&&(c=0),this.content.css({transform:"translate("+c+","+(l+"px")+")",top:0,right:"inherit !important"}),this.cover.css({width:this.trigger.outerWidth()-
16,height:this.trigger.outerHeight()-16});else{this.shouldFlipDirection(b)&&(b=this.getReversedDirection(b));this.shouldFlipAlignment(c)&&(c=this.getReversedDirection(c));this.updateAnimationClass(b,c);this.content.toggleClass("noAnimation",!!a);"up"===b?(h.dom.swapClasses(this.content,this.getStateClasses("default"),this.getStateClasses("up")),l=d.top-this.content.outerHeight()):h.dom.swapClasses(this.content,this.getStateClasses("up"),this.getStateClasses("default"));if("left"===b||"right"===b)l=
"up"===this.options.alignment?d.top-this.trigger.outerHeight()/2:"down"===this.options.alignment?d.top-this.content.outerHeight()+this.trigger.outerHeight():d.top+this.trigger.outerHeight()/2-this.content.outerHeight()/2;f={top:Math.floor(l)+"px"};m?"right"===c?f.right=Math.floor(g.width()-k.width()-n.left)+"px":f.left=Math.floor(n.left)+"px":"left"===b?f.right=Math.floor(g.width()-d.left)+"px":"right"===b?f.left=Math.floor(d.left+this.trigger.width())+"px":"right"===c?(b=this.getTriggerWidth(),38>
b&&!this.options.forceTriggerWidth&&(b=38),f.right=Math.floor(g.width()-(d.left+b))+"px"):f.left="center"===c?Math.floor(d.left-this.content.outerWidth()/2)+this.getTriggerWidth()/2+"px":Math.floor(d.left)+"px";this.options.topOffset&&0!==this.options.topOffset&&(f.marginTop=this.options.topOffset+"px");this.options.leftOffset&&0!==this.options.leftOffset&&(f.right?f.right=parseInt(f.right.replace("px",""))-this.options.leftOffset+"px":f.left&&(f.left=parseInt(f.left.replace("px",""))+this.options.leftOffset+
"px"));this.leftOffset&&(f.marginLeft=this.leftOffset+"px");this.options.isPopover&&"right"===c&&(f.left=Math.floor(d.left+this.getTriggerWidth()+22)+"px",f.top=Math.floor(l-45)+"px");l=this.options.isFixedWidth?"width":"minWidth";this.options.matchWidth?f[l]=this.getTriggerWidth()+"px":m?f[l]=k.outerWidth()+"px":f.minWidth="";this.options.removeZIndex||(f.zIndex=this.trigger.zIndex()+9999);this.content.css(f)}}},shouldFlipDirection:function(a){if(this.options.flippable){var b=e(window).scrollTop(),
c=b+e(window).outerHeight(),d=this.content.outerHeight(),g=this.trigger.offset().top,c=g+this.trigger.outerHeight()+d>c,b=g-d<b;if("down"===a)return c&&!b;if("up"===a)return b&&!c}return!1},shouldFlipAlignment:function(a){if(this.options.flippable){var b=e(window).width(),c=this.content.width(),d=this.trigger.offset().left,g=this.trigger.width(),g=0>=d+("left"===a?0:g)-c,b=d+("left"===a?c:0)>=b;if("left"===a)return!g&&b;if("right"===a)return g&&!b}return!1},getReversedDirection:function(a){switch(a){case "down":return"up";
case "up":return"down";case "left":return"right";case "right":return"left";case "bottom":return"top";case "top":return"bottom";case "center":return"center"}return a},updateAnimationClass:function(a,b){a=this.getDirectionClass(a,b);this.content.hasClass(a)||this.content.removeClass(function(a,b){return(b.match(/\banimate-\S+/g)||[]).join(" ")}).addClass(a).removeAttr("style")},getDirectionClass:function(a,b){var c;"left"===a||"right"===a?(c="down"===b?"top":"bottom",a="center"===a?"right":this.getReversedDirection(a)):
(c="down"===a?"top":"bottom",a="center"===b?"right":b);return"animate-"+c+"-"+a},loadAjax:function(){var a=this;return h.ajax.execute(this.options.ajaxUrl,{data:this.options.ajaxData,customUpdate:function(b){b.innerHTML&&""!==b.innerHTML?a.content.html(b.innerHTML):(a.element.remove(),a.ajaxLoadFailed=!0);return!0}})},getTriggerWidth:function(){if(null!=this.trigger){var a=this.trigger[0].getBoundingClientRect();return a?a.right-a.left:this.trigger.outerWidth()}return 0},disableDropdown:function(){this.options.openDisabled=
!0;this.element.addClass("disabled");this.triggerObj&&this.triggerObj.disable()},enableDropdown:function(){this.options.openDisabled=!1;this.element.removeClass("disabled");this.triggerObj&&this.triggerObj.enable()},animateClose:function(a){var b=this,c=this.content.attr("class").match(/\banimate-\S+/);c&&c.length&&(this.content.removeClass(c[0]),window.setTimeout(function(){b.content.addClass(c[0]+" close-animation")},1),window.setTimeout(function(){a();b.content.removeClass("close-animation")},
this.animationDuration))},getStateClasses:function(a){null===this.states&&(this.states=h.question.ask("dropdown.dialog.states"));if(this.states)return this.states[a]}})})(R9,jQuery);(function(c,k){var g="adults seniors youth child seatInfant lapInfant".split(" ");c.createComponentClass("flights.search.StyleJamFlightTravelerDropdown",{travelerSelect:null,travelerTypes:null,cabinDisplay:null,numBoxes:null,cabinWidget:null,hasErrorMessage:null,errorMessageElement:null,options:{namespace:null,maxTravelers:16,maxAdults:9,maxChildren:7,includeCabin:!0,msg:{singleAdult:"",singleSenior:"",singleChild:"",travelersChoice:""},errorMsg:{minimumTravelers:"",maximumTravelers:"",lapInfantsExceedAdults:"",
unaccompaniedMinors:""},dataQuestion:"flights.search.travelers",collapsedStickyFormEnabled:!1},numTravelers:1,init:function(){var a=this;this.numBoxes=[];this.travelerTypes=g.filter(function(b){return a.getChildElement(b).length});this.travelerTypes.forEach(this.bindNumberBox.bind(this));this.calculateTravelers();this.element.data("component",this)},addEventHandlers:function(){var a=this;this.getChildElement("close").click(function(){a.travelerSelect.close()});this.options.collapsedStickyFormEnabled&&
(this.getChildElement("close-traveler-btn").click(function(){a.travelerSelect.close()}),this.getChildElement("save-travelers-btn").click(function(){a.saveTravelers();a.travelerSelect.close()}))},saveTravelers:function(){this.updateDisplay();c.events.publish("flights.search.travelers.change",{data:this.serialize(),namespace:this.options.namespace});this.numBoxes.forEach(function(a){c.Analytics.api.trackEvent({category:"Search-Form",action:"select-passengers",label:a.obj._id})})},inlineComponentsReady:function(){this.options.includeCabin&&
(this.cabinWidget=this.getChildElement("cabinType").getWidget());if(this.travelerSelect=this.getChildElement("dialog").getWidget())this.subscribe("flights.inline.travelers.open",this.travelerSelect.open.bind(this.travelerSelect)),this.subscribe("flights.search.travelers.close",{namespace:this.options.namespace},this.travelerSelect.close.bind(this.travelerSelect));this.options.includeCabin&&this.subscribe("flights.search.cabinType.change",{namespace:this.options.namespace},this.onCabinTypeChange.bind(this));
this.answer(this.options.dataQuestion,this.serialize.bind(this));this.subscribe(["flights.search.travelers.init.from.state","flights.search.travelers.set"],this.load.bind(this));this.subscribe("flights.search.travelers.refresh",{namespace:this.options.namespace},this.updateDisplay.bind(this));c.events.publish("flights.search.travelers.init."+(this.options.namespace||""));c.dom.schedule(this.updateNumberBoxes.bind(this));this.errorMessageElement=this.getChildElement("errorMessage")},isMobileTraverlersDropdown:function(){return this.options.collapsedStickyFormEnabled&&
c.utils.presentation.isMobile()},load:function(a){!a||a.hasOwnProperty("namespace")&&a.namespace!==this.options.namespace||(a.type&&this[a.type]?this[a.type].setValue(a.count,!0):this.travelerTypes.forEach(function(b){a.hasOwnProperty(b)&&this.hasOwnProperty(b)&&this[b].setValue(a[b],!0)},this),this.calculateTravelers(),c.events.publish("flights.search.travelers.lapInfant",{count:this.lapInfant.getValue()}),this.updateDisplay())},bindNumberBox:function(a){var b=this,d=this.isEligibleAdult(a);(d=this.getChildElement(a).styleJamNumberBox({validator:function(d){return b.validate(this,
d,a)},callback:function(d){if(b.isMobileTraverlersDropdown())b.updateTravelersDialog(),c.events.publish("flights.search.travelers.lapInfant",{count:b.lapInfant.getValue(),namespace:b.options.namespace});else b.onTravelersChange(this,d,a)},max:(d?this.options.maxAdults:this.options.maxChildren)+1,onlyDecorateDisabledButtons:!0}).getWidget())&&this.numBoxes.push({id:a,obj:d});this[a]=d},calculateTravelers:function(){var a=this;this.numTravelers=this.travelerTypes.reduce(function(b,d){return b+a[d].getValue()},
0)},validate:function(a,b,d){var c=this.isEligibleAdult(d),f=this.totalAdultCount(),e=this.options.errorMsg;if(0<b){if("lapInfant"===d&&a.getValue()>=f)return this.showErrorMessage(e.lapInfantsExceedAdults),!1;if(this.atMaxTotalTravelers())return this.showErrorMessage(e.maximumTravelers),!1;if(this.atMaxAdults()&&c)return this.showErrorMessage(e.maximumAdults),!1;if(this.atMaxMinors()&&!c)return this.showErrorMessage(e.maximumChildren),!1}else{if(this.atMinTotalTravelers())return this.showErrorMessage(e.minimumTravelers),
!1;if(c&&this.atMinEligibleInfantHolders())return this.showErrorMessage(e.lapInfantsExceedAdults),!1;if(c&&1>=f&&0<this.totalMinorCount())return this.showErrorMessage(e.unaccompaniedMinors),!1}this.hideErrorMessage();return!0},atMaxAdults:function(){return this.totalAdultCount()>=this.options.maxAdults},atMaxMinors:function(){return this.totalMinorCount()>=this.options.maxChildren},atMaxTotalTravelers:function(){return this.numTravelers>=this.options.maxTravelers},atMinTotalTravelers:function(){return 1>=
this.numTravelers},atMinEligibleInfantHolders:function(a,b){a=a||this.lapInfant.getValue();b=b||this.totalAdultCount();return a>=b},totalAdultCount:function(){var a=this.seniors?this.seniors.getValue():0;return this.adults.getValue()+a},totalMinorCount:function(){return[this.youth,this.child,this.lapInfant,this.seatInfant].reduce(function(a,b){return a+(b?b.getValue():0)},0)},isEligibleAdult:function(a){return"adults"===a||"seniors"===a},updateNumberBoxes:function(){var a=this.totalAdultCount(),b=
this.atMaxTotalTravelers();this.travelerTypes.forEach(function(d){var c=this.isEligibleAdult(d),f=this[d],e=f.getValue(),g=c&&0===a;d="lapInfant"===d&&e>=a;var h=c&&this.atMinEligibleInfantHolders(),c=c?this.atMaxAdults():this.atMaxMinors();0===e||g||this.atMinTotalTravelers()||h?f.disableDecrement():f.enableDecrement();b||d||c?f.disableIncrement():f.enableIncrement()},this)},onTravelersChange:function(a,b,d){this.updateTravelersDialog();c.events.publish("flights.search.travelers.lapInfant",{count:this.lapInfant.getValue(),
namespace:this.options.namespace});this.updateDisplay();c.events.publish("flights.search.travelers.change",{data:this.serialize(),namespace:this.options.namespace,travelerType:d});c.Analytics.api.trackEvent({category:"Search-Form",action:"select-passengers",label:a._id})},updateTravelersDialog:function(){this.calculateTravelers();this.updateNumberBoxes()},onCabinTypeChange:function(){this.updateDisplay()},updateDisplay:function(){this.travelerSelect.updateLabel(this.getDisplaySummary())},getDisplaySummary:function(){var a=
this.options.includeCabin?this.cabinWidget.getDisplay():null;return 1===this.adults.getValue()&&1===this.numTravelers?c.Common.Utils.String.formatString(this.options.msg.singleAdult,a):this.seniors&&1===this.seniors.getValue()&&1===this.numTravelers?c.Common.Utils.String.formatString(this.options.msg.singleSenior,a):1===this.child.getValue()&&1===this.numTravelers?c.Common.Utils.String.formatString(this.options.msg.singleChild,a):c.Common.Utils.String.formatChoice(this.options.msg.travelersChoice,
this.numTravelers,this.numTravelers+"",a)},showErrorMessage:function(a){var b=this.errorMessageElement;b&&a&&(b.text(a),this.hasErrorMessage=!0)},hideErrorMessage:function(){var a=this.errorMessageElement;a&&this.hasErrorMessage&&(a.text(""),this.hasErrorMessage=!1)},serialize:function(){return{adults:this.adults.getValue(),seniors:this.seniors?this.seniors.getValue():0,youth:this.youth.getValue(),child:this.child.getValue(),seatInfant:this.seatInfant.getValue(),lapInfant:this.lapInfant.getValue(),
travelers:this.numTravelers,displaySummary:this.getDisplaySummary()}}})})(R9,jQuery);(function(b,c){b.createComponentClass("flights.search.FlightCabinSelect",{options:{namespace:null,cabinDisplayMap:null},widget:null,init:function(){this.element.data("widget",this)},inlineComponentsReady:function(){var a=this;(this.widget=this.getChildElement("widget").getWidget())||this.log.error("No widget instance attached to CabinType element");this.widget.setOption("change",this.onChange.bind(this));this.answer("flights.search.cabinType."+this.options.namespace+".get",function(){return{value:a.getValue(),
display:a.options.cabinDisplayMap[a.getValue()]}});this.subscribe("flights.search.cabinType.set",{namespace:this.options.namespace},function(b){a.setValue(b.value)});b.events.ready("flights.search.cabinType.init."+this.options.namespace||"")},onChange:function(){var a=this.widget.getValue();b.events.publish("flights.search.cabinType.change",{id:this.id(),namespace:this.options.namespace,value:a,display:this.options.cabinDisplayMap[a]});b.Analytics.api.trackEvent({category:"Search-Form",action:"select-cabin",
label:a})},destroy:function(){this.base();this.element.data("widget",null)},getValue:function(){return this.widget.getValue()},getDisplay:function(){return this.options.cabinDisplayMap[this.getValue()]},setValue:function(a){this.widget.setValue(a)}})})(R9,jQuery);(function(e,f){e.publish("SmartyLogger",{loggingCategory:"Smarty",inputDefault:"destination",selectedIndex:"",subscribedLogSearchId:void 0,locationTypeIdLookupMap:{ap:"lmid",lm:"lmid",hotel:"hid",freereg:"frid",hood:"nhid",ctry:"cid"},_save:function(a){this.setStorage(a)},_log:function(a){a&&(this.logData(a,"origin"),this.logData(a,"destination"))},logData:function(a,c){var b=this;a=this.getLoggingObj(a,c);f.isEmptyObject(a)||e.Analytics.api.trackEvent(a,function(){b.cleanUpSmartyLogger(c)})},makeOptionsStr:function(a,
c){var b=this,d,f,k,g=[],l=!1;a.each(function(h){d=e.common.widgets.smarty.FlareSmarty.prototype.translateItem.call(this,a[h]);null==c||l||d.id!==c.id||d.type!==c.type||(b.selectedIndex=h+1,l=!0);f=d.id.split("/");1<f.length&&(d.idCode=f[1],d.apCode=f[0]);k="ap"===d.type?"airport":d.type;g.push("pos: "+(h+1));g.push("text: "+b.cleanString(d.short_str||d.str));g.push("locid: "+b.getBestItemId.call(b,d));g.push("loc_type: "+k)});return g.join("|")},getBestItemId:function(a){return a&&a.type?this.cleanString(a[this.locationTypeIdLookupMap[a.type]||
"id"]||a.id||""):""},getLoggingObj:function(a,c){var b=this.getStorage(c),d={};f.isEmptyObject(b)||(d={searchid:a,category:this.loggingCategory,params:{point:c}},b.hasOwnProperty("vertical")&&(d.params.vertical=b.vertical),b.hasOwnProperty("prefix")&&(d.params.prefix=b.prefix),b.hasOwnProperty("selected")&&(d.params.selected=b.selected),b.hasOwnProperty("options")&&(d.params.options=b.options));return d},setStorage:function(a){if(a&&e.storage.isAvailable()){var c=(a.inputType||this.inputDefault)+
"SmartyLogging",b=this.getStorageObj(a.inputType);a.hasOwnProperty("vertical")&&(b.vertical=a.vertical);a.hasOwnProperty("prefix")&&(b.prefix=this.cleanString(a.prefix));a.hasOwnProperty("options")&&(b.options=this.makeOptionsStr(a.options,a.selectedElem||null),b.selected=this.selectedIndex,this.selectedIndex="");e.storage.set(c,b)}},getStorageObj:function(a){a=(a||this.inputDefault)+"SmartyLogging";var c={};e.storage.isAvailable()&&(c=e.storage.get(a),f.isEmptyObject(c)&&(e.storage.set(a,{}),c=e.storage.get(a)));
return c},getStorage:function(a){var c={};e.storage.isAvailable()&&(c=e.storage.get(a+"SmartyLogging"));return c},cleanString:function(a){return"string"===typeof a?a.trim().replace(/&/g,"\\\x26"):""},cleanUpSmartyLogger:function(a){e.storage.remove(a+"SmartyLogging");this.selectedIndex=""},onLogSearchId:function(a){a&&this._log(a)}});e.SmartyLogger.subscribedLogSearchId||(e.SmartyLogger.subscribedLogSearchId=1,e.events.subscribe("smartylogger.log.searchId",f.proxy(e.SmartyLogger.onLogSearchId,e.SmartyLogger)))})(R9,
jQuery);(function(e,k){e.createWidgetClass("checkbox.StyleJamCheckbox",{widgetName:"checkbox",isToggle:!1,showLabel:!0,options:{click:k.noop,change:k.noop,keydown:k.noop,focus:k.noop,blur:k.noop},init:function(){this.elementNode=this.element.get(0);if(this.slider=this.getChildElement("slider"))this.isToggle=!0;this.label=this.getChildElement("label");this.showLabel=!!this.label.text().trim()},addEventHandlers:function(){this.bindInputEvent("click",this._handleElementClickEvent);this.bindInputEvent("change",
this._handleElementChangeEvent);this.bindInputEvent("keydown",this._handleKeydownEvent);this.bindInputEvent("focus",this._handleElementFocusEvent);this.bindInputEvent("blur",this._handleElementBlurEvent);if(!this.showLabel){var a=this;this.bindInputEvent("click",function(c){a.element.trigger("click."+this.widgetName,c)},this.getChildElement("icon"))}},bindInputEvent:function(a,c,d){var b=this;a+="."+this.widgetName;d=d||this.element;d.off(a).on(a,function(a){c.call(b,this,null,a)})},_handleElementClickEvent:function(){this.options.click.apply(this,
arguments)},_handleElementChangeEvent:function(a,c,d){e.common.widgets.checkbox.StyleJamCheckbox.refresh(a);this.options.change.apply(this,arguments);var b=k(a).prop("checked");a.setAttribute("aria-checked",b)},_handleKeydownEvent:function(a,c,d){this.options.keydown.apply(this,arguments)},_handleElementFocusEvent:function(a,c,d){a.disabled||(this.options.useFocusOutlines&&this.toggleFocusOutline(!0),this.isToggle&&e.common.widgets.checkbox.StyleJamCheckbox.refresh(this.elementNode),this.options.focus.apply(this,
arguments))},_handleElementBlurEvent:function(a,c,d){a.disabled||(this.options.useFocusOutlines&&this.toggleFocusOutline(!1),this.isToggle&&e.common.widgets.checkbox.StyleJamCheckbox.refresh(this.elementNode),this.options.blur.apply(this,arguments))},toggleFocusOutline:function(a){this.swapClassesToggle(this.element.closest(".js-checkbox-wrapper"),"","Checkbox--focused",!a)},setEnabled:function(a){a?this.element.removeAttr("disabled"):this.element.attr("disabled","disabled");this.element.attr("aria-disabled",
!a);e.common.widgets.checkbox.StyleJamCheckbox.refresh(this.element)},getValue:function(){return this.element.prop("checked")},setChecked:function(a){this.element.prop("checked",a)},setLabel:function(a){this.label.text(a)}});e.extend("common.widgets.checkbox.StyleJamCheckbox",{isCheckbox:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"checkbox"==a.type.toLowerCase()},refresh:function(a){var c=e.question.ask("checkbox.StyleJamCheckbox.states");this.reflectState(a,c)},reflectState:function(a,
c){var d=k(a),b=d.data("switchInfo"),h=d.attr("id"),g=k("#"+h+"-label"),d=k("#"+h+"-icon"),h=k("#"+h+"-slider");if(g.length){var f=c.label;f[b.presentation]||(new e.logger(this.prototype._logPath)).error("Label States not defined for "+b.presentation+". Set them in StyleJamCheckbox.java#getLabelStates");l=f[b.presentation].checked||f.VANILLA.checked;m=f[b.presentation].unchecked||f.VANILLA.unchecked;f=f[b.presentation].disabled||f.VANILLA.disabled;a.checked?e.dom.swapClasses(g,m,l):e.dom.swapClasses(g,
l,m);a.disabled||a.prop&&a.prop("disabled")?e.dom.swapClasses(g,"",f):e.dom.swapClasses(g,f,"")}if(d.length){var g=c.icon,n=g.VANILLA;g[b.presentation]||(new e.logger(this.prototype._logPath)).error("Icon states not defined for "+b.presentation+". Presentations with icons must have states defined, set them in StyleJamCheckbox.java#getIconStates");b.disableMouseOutAnimation?(l=g.disableMouseOutAnimation.checked||n.checked,m=g.disableMouseOutAnimation.unchecked||n.unchecked,f=g.disableMouseOutAnimation.disabled||
n.disabled):(l=g[b.presentation].checked||n.checked,m=g[b.presentation].unchecked||n.unchecked,f=g[b.presentation].disabled||n.disabled,p=g[b.presentation].checkedFocus||n.checkedFocus,q=g[b.presentation].uncheckedFocus||n.uncheckedFocus);d.removeClass(l+" "+p+" "+m+" "+q);a.checked?a===document.activeElement?d.addClass(p):d.addClass(l):a===document.activeElement?d.addClass(q):d.addClass(m);a.disabled||a.prop&&a.prop("disabled")?e.dom.swapClasses(d,"",f):e.dom.swapClasses(d,f,"")}if(h.length){c=c.slider;
var l=c[b.presentation].checked||"",m=c[b.presentation].unchecked||"",f=c[b.presentation].disabled||"",p=c[b.presentation].checkedFocus||"",q=c[b.presentation].uncheckedFocus||"";c[b.presentation]||(new e.logger(this.prototype._logPath)).error("Slider states not defined for "+b.presentation+". Presentations with sliders must have states defined, set them in StyleJamCheckbox.java#getSliderStates");h.removeClass(l+" "+p+" "+m+" "+q);a.checked?a===document.activeElement?h.addClass(p):h.addClass(l):a===
document.activeElement?h.addClass(q):h.addClass(m);a.disabled?e.dom.swapClasses(h,"",f):e.dom.swapClasses(h,f,"")}if("TOGGLE_WITH_CHECK_MARK"===b.presentation||"TOGGLE"===b.presentation)b=k(a).getWidget(),p=k(a).parent().find(".toggle"),a.checked?b.swapClasses(p,"Checkbox--unchecked--toggle__slider__toggle","Checkbox--checked--toggle-with-checkmark__slider__toggle"):b.swapClasses(p,"Checkbox--checked--toggle-with-checkmark__slider__toggle","Checkbox--unchecked--toggle__slider__toggle")}});(function(a){var c=
a.fn.prop;a.fn.prop=function(d,b){var h=c.apply(this,arguments);"undefined"==typeof b||"checked"!=d&&"disabled"!=d||this.each(function(){e.common.widgets.checkbox.StyleJamCheckbox.isCheckbox(this)&&a(this).parent().is(".StyleJamCheckbox")&&e.common.widgets.checkbox.StyleJamCheckbox.refresh(this)});return h}})(k)})(R9,jQuery);(function(b){R9.extend("Widgets.Smarty",{Smarty:function(a,c){this.elementNode=a;this.element=b(this.elementNode);this.validateElement()&&(this.options=b.extend({},this.options,c),this.init())}});R9.extend("Widgets.Smarty.Smarty",{isInput:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()},isWidgetControlled:function(a){return b(a).hasClass(R9.Widgets.Smarty.Smarty.prototype.widgetBaseClass+"-input")},getDropdownEl:function(a){return jq(a).find("#smartbox")},getDropdownId:function(a){return"smartbox"}});
R9.extend("Widgets.Smarty.Smarty.prototype",{widgetName:"smarty",widgetBaseClass:"r9-smarty",elementNode:null,element:null,dropdown:null,lastValue:null,aria:!1,trimInputElements:"span.nearbyHotels, span.nearbyRentals, span.showRank",lastClickOnScrollbar:!1,keyTimeout:null,isHighlightKeyPressed:!1,isItemSet:!1,backgroundAutocomplete:null,activeAnimation:!0,options:{minLength:0,appendTo:"body",dropdown:null,fixedDropdown:!1,initialData:null,initialDataLoadWithCallback:null,searchOnFocus:!1,showDropdownWhenEmpty:!1,
dataSource:null,dataType:"text",minWidth:10,maxWidth:1024,noAutoWidth:!1,position:"left",dropdownClass:null,setItem:null,beforeStart:null,afterDone:null,dropdownListSelector:"ul li[class!\x3d'separator']",keyDelay:200,forceSelection:!1,makeHTML:null,translateItem:null,display:"inline",showBackgroundAutocomplete:!1,backgroundAutocompleteMinLength:3,getBackgroundAutocompletePositionProps:null,delayShowDropdown:null,showDropdownDelay:200,enableRemoteHide:!1,zIndex:9999,continents:[],showContinents:!1,
onInputValueChange:function(a){},forceSelectionOfHighlightedItem:!0},init:function(){var a=this;this.aria=R9.config&&R9.config.getBoolean("ui.smarty.aria",!0);R9.config&&(this.options.zIndex=R9.config.getInt("ui.smarty.zIndex",9999));this.initDropdown();R9.globals.browserCapabilities.scrollbarRetainsInputFocus&&"false"!==R9.globals.browserCapabilities.scrollbarRetainsInputFocus||this.trackScrollbarClick();this.bindInputEvent("focus",this.handleInputFocusEvent);this.bindInputEvent("blur",this.handleInputBlurEvent);
this.bindInputEvent("keydown",this.handleInputKeydownEvent);this.bindInputEvent("textchange",this.handleInputChangeEvent);b(window).on("scroll.smarty",function(){a.position()});b(window).resize(this.handleWindowResize.bind(a));this.element.attr({autocomplete:"off",autocapitalize:"off",autocorrect:"off"});this.aria&&this.element.attr({role:"combobox","aria-autocomplete":this.options.showBackgroundAutocomplete?"both":"list"});this.element.data(this.widgetName,this);this.element.is(":focus")&&this.element.focus();
this.initBackgroundAutocomplete()},unInit:function(){this.unbindInputEvent("focus");this.unbindInputEvent("blur");this.unbindInputEvent("keydown");this.unbindInputEvent("textchange");b(window).off("scroll.smarty");this.dropdown.off("mousedown.trackScrollbarClick");jq("body").off("click.trackScrollbarClick")},initDropdown:function(){var a=R9.Widgets.Smarty.Smarty.getDropdownEl(this.element),c=R9.Widgets.Smarty.Smarty.getDropdownId(this.element),a=jq(a)[0];if(null==a){var b=R9.Widgets.Smarty.Smarty.prototype.widgetBaseClass;
this.options.dropdownClass&&(b=b+" "+this.options.dropdownClass);a=jq("\x3cdiv\x3e\x3c/div\x3e",{id:c,css:{display:"none",position:"absolute",width:"auto",zIndex:1E4},role:"dialog",tabindex:"0"}).appendTo(this.options.appendTo)[0];jq(a).addClass(b)}this.dropdown=jq(a)},validateElement:function(){return R9.Widgets.Smarty.Smarty.isInput(this.elementNode)&&R9.Widgets.Smarty.Smarty.isWidgetControlled(this.element)},trackScrollbarClick:function(){var a=this;a.dropdown.on("mousedown.trackScrollbarClick",
function(b){a.lastClickOnScrollbar=!0;b.stopPropagation();jq("body").trigger("event",[b])});jq("body").on("click.trackScrollbarClick",function(b){R9.Common.Utils.Browsers.isIE()&&a.lastClickOnScrollbar&&(a.lastClickOnScrollbar=!1,a.element.blur());a.lastClickOnScrollbar=!1})},bindInputEvent:function(a,b){var c=this;a+="."+this.widgetName;this.element.off(a).on(a,function(a){return b.call(c,this,a)})},unbindInputEvent:function(a){a+="."+this.widgetName;this.element.off(a)},bindDropdownEvent:function(a,
b){var c=this;this.dropdown.off(a,this.options.dropdownListSelector).on(a,this.options.dropdownListSelector,function(a){b.call(c,this,a)})},handleInputKeydownEvent:function(a,b){this.activeAnimation=this.focusEventHandled=!1;var c=b.keyCode?b.keyCode:b.which;switch(c){case 38:return this.highlitePrevItem(),!1;case 40:return this.highliteNextItem(),!1;case 27:return!this.hideDropdown();case 13:return this.selectHighlightedItemWhenSearchCompleted(c);case 9:if(this.canItemBeActivatedByTab()){if(R9.config.getBoolean("ui.common.smarty.anywhere-on-tab-check.enabled",
!1)&&this.isItAnywhereItem())return this.selectHighlightedItemWhenSearchCompleted(c);this.options.forceSelectionOfHighlightedItem&&this.selectHighlitedItem(c)}break;default:this.handleKeydownBeforeAutocomplete(a,b),this.abortSearchCompletedEventListeners()}},isItAnywhereItem:function(){var a=this.getItemList(),b=this.getHighlitedItemIndex();return(a=a[b])?"anywhere"==a.getAttribute("data-short-name")?!0:!1:!1},canItemBeActivatedByTab:function(){var a=this.getItemList(),c=this.getHighlitedItemIndex();
return(a=b(a[c]))?!(a.hasClass("signupnow")||a.hasClass("signup")||a.hasClass("showHistory")||a.hasClass("js-not-selectable")):!1},handleInputChangeEvent:function(a,b){if(this.focusEventHandled)this.focusEventHandled=!1;else{if(!R9.Common.Utils.Browsers.isIE(10)&&!R9.Common.Utils.Browsers.isIE(11)||this.element.is(":focus")){this.abortKeyTimeout();this.abortRequest();this.onInputChange();var c=this;this.keyTimeout=setTimeout(function(){c.keyTimeout=null;c.handleInputValue()},this.options.keyDelay)}this.activeAnimation=
!1}},onInputChange:function(){this.isItemSet=!1;var a=this.getHighlitedItem();a&&!this.itemMatches(a,this.element.val())&&this.removeItemHighlight();"function"===typeof this.options.clearItem&&this.options.clearItem(this);try{this.element&&(jq(this.element).removeClass("smarty-complete"),jq(this.element).removeClass("four-twenty"),jq(this.element).addClass("smarty-incomplete"),R9.events.publish("smarty.setitem.incomplete",{id:this.element.attr("id")}))}catch(c){}},handleInputValue:function(){var a=
this.element.val();this.options.onInputValueChange(a);this.element.length&&0<a.length?(this.abortRequest(),this.runSearch(!0)):this.options.showDropdownWhenEmpty?(this.abortRequest(),this.showInitialDropdown()):(this.dropdown[0].innerHTML="",this.hideDropdown())},handleInputFocusEvent:function(a,b){jq(a).trigger("smartyfocus");var c=this;if(!c.lastClickOnScrollbar){var e=function(){c.checkAlive()&&setTimeout(e,250)};setTimeout(e,250);this.onBeforeStart(b);this.runSearchOnFocus()&&(this.focusEventHandled=
!0,0!=this.element.val().length||this.runNoQuerySearch()?this.runSearch(!!b):null!==this.options.initialDataLoadWithCallback?this.options.initialDataLoadWithCallback(function(a){c.showInitialDropdownForData(a)}):this.showInitialDropdown())}},runSearchOnFocus:function(){return this.options.searchOnFocus},runNoQuerySearch:function(){return this.options.searchNoQuery},onBeforeStart:function(a){"function"===typeof this.options.beforeStart&&this.options.beforeStart(this,a)},handleInputBlurEvent:function(a,
b){this.focusEventHandled=!1;var c=this;setTimeout(function(){if(c.lastClickOnScrollbar)R9.Common.Utils.Browsers.isIE()||(c.element.focus(),c.lastClickOnScrollbar=!1);else{c.stopInputProcessing();if(c.hideDropdown()&&c.options.forceSelection)c.onForceSelection();c.onAfterDone()}},10)},stopInputProcessing:function(){this.isUpdateInProgress()&&(this.abortKeyTimeout(),this.abortRequest(),this.removeItemHighlight())},isUpdateInProgress:function(){return this.keyTimeout||this.request},onForceSelection:function(){if(!this.isItemSet&&
""!==this.element.val()){var a=this.getHighlitedItem();a&&this.selectItem(a,null)}},onAfterDone:function(){"function"===typeof this.options.afterDone&&this.options.afterDone(this)},handleItemMouseoverEvent:function(a,b){this.getItemList().removeClass("selected");jq(a).not(".js-not-selectable").addClass("selected")},handleItemMouseoutEvent:function(a,b){jq(a).removeClass("selected")},handleItemMousedownEvent:function(a,b){b.stopPropagation();jq("body").trigger("event",[b]);this.selectItem(a,null);
this.hideDropdown()},selectHighlitedItem:function(a){var b=this.getItemList();if(b){var d=this.getHighlitedItemIndex();0>d?13==a&&this.noItemToSelect():(b=b[d])&&this.selectItem(b,a)}else 13==a&&this.noItemToSelect()},selectHighlightedItemWhenSearchCompleted:function(a){var b=this;if(this.isItemSet&&!this.isHighlightKeyPressed){if(this.isDropdownHidden()&&13===a)return!0;this.hideDropdown();return!1}this.selectHighlitedItem(a);this.hideDropdown(!this.isItemSet);if(this.isItemSet)return!1;this.element.one("searchCompleted",
function(){b.selectHighlitedItem(a);b.hideDropdown()});return!1},noItemToSelect:function(){},selectItem:function(a,b){a=this.translateItem(a);this.setItem(a,b)},translateItem:function(a){return"function"===typeof this.options.translateItem?this.options.translateItem(a):a},setItem:function(a,b){if(this.element)try{if(a){jq(this.element).addClass("smarty-complete");jq(this.element).removeClass("smarty-incomplete");jq(this.element).removeClass("four-twenty");if(R9.config.getBoolean("ui.four-twenty.enabled",
!1)&&"string"===typeof a.str){var c=!1,e=R9.config.getString("ui.four-twenty.states","").split(";"),f=a.str.match(/^[^,]+,\s+([A-Z]{2})(\s|$)/);(f=f?f[1]:null)&&-1!==e.indexOf(f)&&(c=!0);for(var g=R9.config.getString("ui.four-twenty.cities","").split(";"),e=0;e<g.length;e++)""!==g[e]&&-1!==a.str.indexOf(g[e])&&(c=!0);c&&jq(this.element).addClass("four-twenty")}R9.events&&R9.events.publish("smarty.setitem.complete",{id:this.element.attr("id")})}else jq(this.element).addClass("smarty-incomplete"),jq(this.element).removeClass("smarty-complete"),
jq(this.element).removeClass("four-twenty"),R9.events&&R9.events.publish("smarty.setitem.incomplete",{id:this.element.attr("id")})}catch(h){}"function"===typeof this.options.setItem?(this.isItemSet=!0,this.options.setItem(this,a,b)):a?(this.isItemSet=!0,this.element.val(jq(a).text())):(this.isItemSet=!1,this.element.val(""))},showInitialDropdown:function(){this.showInitialDropdownForData(this.onInitialData())},showInitialDropdownForData:function(a){a&&this.searchCompleted(a,!1)},onInitialData:function(){return"function"===
typeof this.options.initialData?this.options.initialData(this):this.options.initialData},runSearch:function(a){var b=this.element.val();if(!(b.length<this.options.minLength||this.lastValue==b)){var d=this.getRequestData(),d=this.preprocessRequest(d),e=this,f=function(c){e.request=null;e.lastValue=b;c=e.postprocessResponse(c,a);e.searchCompleted(c,a)};if("function"===typeof this.options.dataSource)this.options.dataSource(d,f,this,a);else if(R9.config.getBoolean("ui.common.smarty.get.enabled",!1)){var g=
this.getDataSource();d.cv=R9.config.getString("ui.common.smarty.get.version","1");this.request=jq.ajax({type:"GET",url:g,data:d,dataType:this.options.dataType,cache:!0,success:f})}else this.request=jq.post(this.getDataSource(),d,f,this.options.dataType)}},getDataSource:function(){return this.options.dataSource},preprocessRequest:function(a){return a},getRequestData:function(){return{value:this.element.val(),formtoken:R9.globals.formtoken}},searchCompleted:function(a,b){(a=this.canShowDropdown(a))?
this.showDropdown(a,b):(this.dropdown[0].innerHTML="",this.hideDropdown());this.element.trigger("searchCompleted",!!a)},canShowDropdown:function(a){return a},abortSearchCompletedEventListeners:function(){this.element.off("searchCompleted")},postprocessResponse:function(a,b){return a},makeHTML:function(a){return"function"===typeof this.options.makeHTML?this.options.makeHTML(a):a},animateSmartyV2:function(a){var b=this;this.dropdown.addClass("smarty-animation-v2");a?this.activeAnimation?(this.dropdown.addClass("open-animation"),
this.dropdown.removeClass("close-animation"),setTimeout(function(){b.dropdown.show()},480)):b.dropdown.show():this.activeAnimation?(this.dropdown.addClass("close-animation"),this.dropdown.removeClass("open-animation"),setTimeout(function(){b.dropdown.hide()},480)):b.dropdown.hide()},showDropdown:function(a,b){if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.showDropdown.bind(this,a,b),this.options.showDropdownDelay);
else{null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);b=this.dropdown[0].style;var c=this.makeHTML(a);this.dropdown[0].innerHTML=c;c=R9.Widgets.Smarty.Smarty.prototype.widgetBaseClass;this.options.dropdownClass&&(c=c+" "+this.options.dropdownClass);this.dropdown.attr("class",c);a.length?this.dropdown.removeClass("empty"):this.dropdown.addClass("empty");this.position();this.aria&&(this.element.attr({"aria-expanded":!0}),this.dropdown.find("ul").attr("role",
"listbox"),this.dropdown.find("li").not(".js-not-option").attr("role","option"));R9.config.getBoolean("ui.smarty.animate",!1)&&this.dropdown.slideDown(R9.config.getInt("ui.smarty.animation.ms",250));b.visibility="visible";b.display=this.options.display;jq.fn.zIndex&&(b.zIndex=jq(this.element).zIndex()+this.options.zIndex);this.bindDropdownEvent("mousedown",this.handleItemMousedownEvent);this.bindDropdownEvent("mouseover",this.handleItemMouseoverEvent);this.bindDropdownEvent("mouseout",this.handleItemMouseoutEvent);
this.removeItemHighlight();""!==this.element.val()&&this.highlightFirstSelectableItem();R9.config.getBoolean("ui.smarty.animation.v2",!1)&&this.animateSmartyV2(!0)}},position:function(){var a=this.dropdown[0].style,b=0;this.dropdown.parent()[0]===jq(document.body)[0]&&(b=parseInt((jq(document.body).css("top")||"0").replace("-",""))||0);this.dropdown.css("width","auto");var d=this.dropdown.outerWidth(!0),e=!1;this.options.minWidth&&d<=this.options.minWidth&&(d=Math.max(this.options.minWidth,d),e=!0);
this.options.maxWidth&&d>=this.options.maxWidth&&(d=Math.min(this.options.maxWidth,d),e=!0);a.width=e||this.options.noAutoWidth?d+"px":"auto";var e=this.element.offset(),f=jq(this.options.appendTo).offset(),g=e.left-f.left;"right"===this.options.position&&(g+=this.element.width()-d-2);a.left=g+"px";a.top=b+e.top+this.element.outerHeight()-f.top+"px"},isDropdownHidden:function(){return"none"==this.dropdown.css("display")||"hidden"==this.dropdown.css("visibility")},hideDropdown:function(a){a||(this.abortKeyTimeout(),
this.abortRequest());this.isHighlightKeyPressed=!1;this.lastValue=null;if(this.isDropdownHidden())return!1;R9.config.getBoolean("ui.smarty.animation.v2",!1)?this.animateSmartyV2(!1):this.dropdown.hide();this.aria&&this.element.attr({"aria-expanded":!1});this.setBackgroundAutocomplete();return!0},abortRequest:function(){if(this.request){try{this.request.abort()}catch(a){}this.request=null}},abortKeyTimeout:function(){this.keyTimeout&&(clearTimeout(this.keyTimeout),this.keyTimeout=null)},highliteNextItem:function(){var a=
this.getItemList(),b=nsel=this.getHighlitedItemIndex();-1==b?nsel=0:b<a.length-1&&(nsel=b+1);b!=nsel&&(jq(a[b]).removeClass("selected"),jq(a[b]).trigger("mouseout"),jq(a[nsel]).addClass("selected"),jq(a[nsel]).trigger("mouseover"),this.isHighlightKeyPressed=!0,this.setBackgroundAutocomplete(a[nsel]))},highlitePrevItem:function(){var a=this.getItemList(),b=nsel=this.getHighlitedItemIndex();-1==b?nsel=0:0<b&&(nsel=b-1);b!=nsel&&(jq(a[b]).removeClass("selected"),jq(a[b]).trigger("mouseout"),jq(a[nsel]).addClass("selected"),
jq(a[nsel]).trigger("mouseover"),this.isHighlightKeyPressed=!0,this.setBackgroundAutocomplete(a[nsel]))},highlightFirstSelectableItem:function(){for(var a=this.getItemList(),b=0;b<a.length;b++){var d=jq(a[b]);if(!d.hasClass("hist")&&!d.hasClass("js-not-selectable")){d.addClass("selected");this.setBackgroundAutocomplete(a[b]);return}}jq(a[0]).addClass("selected");this.setBackgroundAutocomplete(a[0])},removeItemHighlight:function(){jq(this.getItemList()).removeClass("selected")},getHighlitedItemIndex:function(){for(var a=
this.getItemList(),b=a.length,d=0;d<b;d++)if(jq(a[d]).hasClass("selected"))return d;return R9.config.getBoolean("ui.smarty.auto.select.1st",!1)&&0<b?0:-1},getHighlitedItem:function(){for(var a=this.getItemList(),b=a.length,d=0;d<b;d++)if(jq(a[d]).hasClass("selected"))return a[d];return R9.config.getBoolean("ui.smarty.auto.select.1st",!1)&&0<b?a[0]:null},getItemList:function(){return this.dropdown.find(this.options.dropdownListSelector)},itemMatches:function(a,b){return a?0<=jq(a).text().toLowerCase().indexOf(b.toLowerCase()):
!1},checkAlive:function(){return this.element.closest("html").length?this.element.is(":visible")?!0:(this.hideDropdown(),!1):(this.hideDropdown(),this.unInit(),!1)},initBackgroundAutocomplete:function(){!this.backgroundAutocomplete&&this.options.showBackgroundAutocomplete&&(this.options.backgroundAutocompleteMinLength=R9.config.getInt("ui.common.smarty.background.autocomplete.min.length",3),this.backgroundAutocomplete=jq("\x3cinput/\x3e",{id:this.element.attr("id")+"-bg-autocomplete","class":this.element.attr("class"),
type:"text",tabindex:"-1"}).insertBefore(this.element),this.updateBackgroundAutocompletePosition(),this.backgroundAutocomplete.css("color",this.element.css("color").replace(")",", 0.27)").replace("rgb","rgba")),this.backgroundAutocomplete.addClass("smarty-bg-autocomplete"),this.element.addClass("smarty-with-bg-autocomplete"))},updateBackgroundAutocompletePosition:function(){if(this.options.showBackgroundAutocomplete)if("function"===typeof this.options.getBackgroundAutocompletePositionProps)this.backgroundAutocomplete.css(this.options.getBackgroundAutocompletePositionProps());
else{var a=this.element.is(":visible")?this.element.outerHeight():this.element.height();this.backgroundAutocomplete.css({"margin-bottom":"-"+a+"px"})}},handleKeydownBeforeAutocomplete:function(a,b){if(this.options.showBackgroundAutocomplete){var c=this;setTimeout(function(){var a=c.backgroundAutocomplete.val(),b=c.element.val();b.length>=c.options.backgroundAutocompleteMinLength&&b.length<a.length&&!c.isDropdownHidden()?c.backgroundAutocomplete.val(b+a.substr(b.length)):c.backgroundAutocomplete.val("")},
1)}},setBackgroundAutocomplete:function(a){if(this.options.showBackgroundAutocomplete){var b=this.element.val();if(a&&b.length>=this.options.backgroundAutocompleteMinLength){var d=this.getBackgroundAutocompleteText(a);if(0<d.length){a=d.toUpperCase().indexOf(b.toUpperCase());this.backgroundAutocomplete.val(-1===a?"":b+d.substr(a+b.length));return}}this.backgroundAutocomplete.val("")}this.aria&&a&&a.attributes.id&&(b=jq(a).find(this.trimInputElements).filter(function(){return jq(this).is(":visible")}),
0<b.length&&(d=jq(a).clone(),d.find(this.trimInputElements).remove(),jq(a).attr("aria-label",d.text()+" "+b.text())),this.element.attr({"aria-activedescendant":a.attributes.id.value}))},getBackgroundAutocompleteText:function(a){a=this.translateItem(a);return"string"===typeof a.str?a.str:""},handleWindowResize:function(){this.updateBackgroundAutocompletePosition()}})})(jq||jQuery);
R9.extend("Widgets.Smarty",{FlareSmarty:function(b,a){R9.Widgets.Smarty.Smarty.call(this,b,jq.extend({dataSource:"/mv/marvel"},a));var c=this;jq(".mapViewOuter .filterWrapper").scroll(function(){R9.Widgets.Smarty.Smarty.prototype.handleInputBlurEvent.call(c)})}});R9.extend("Widgets.Smarty.FlareSmarty",!0,{setRunSearchNextFocus:function(b){R9.Widgets.Smarty.FlareSmarty.runSearchNextFocus=b},runSearchNextFocus:!0});
R9.extend("Widgets.Smarty.FlareSmarty.prototype",!0,R9.Widgets.Smarty.Smarty.prototype,{translateItem:function(b){if(!b)return null;var a=jq(b).clone()[0];b=a.id.split("-");var c="";1<b.length&&0>b[1].indexOf(" ")&&(c=b[1]);jq(a).find("span.airportCode, span.region-label, span.nearbyHotels, span.nearbyRentals, span.smarty-emoji, span.smarty-label, span.smarty-popular, span.smarty-city-popular, span.smarty-air-popular, span.showRank").remove();var d=jq(a).attr("data-text-to-select"),d=d&&0<jq.trim(d).length?
d:jq(a).text(),a={type:b[0],id:c,str:d,name:d,short_str:jq(a).attr("data-short-name"),cc:jq(a).attr("data-cc")||"",apicode:a.getAttribute("data-apicode")};"isl"===a.type&&1<b.length&&(c=b[1].split("/"),a.str=c[0]);2<b.length&&(a.hc=b[2]);3<b.length&&("hotel"===a.type?a.hid=b[3]:"rest"===a.type?a.rtid=b[3]:"freereg"===a.type?a.frid=b[3]:"reg"===a.type?a.rid=b[3]:"ctry"===a.type?a.cid=b[3]:"ctgroup"===a.type?a.cgid=b[3]:"hood"===a.type?a.nhid=b[3]:a.lmid=b[3]);return a},preprocessRequest:function(b){var a=
{};this.options.extendRequest&&(a="function"===typeof this.options.extendRequest?this.options.extendRequest(this,b):this.options.extendRequest);var c={};this.options.v&&(c.v=this.options.v);c.f="h";this.options.f&&(c.f=this.options.f);c.where=b.value;c.s=this.getFlareSmartyType()||-1;c.lc_cc=R9.globals.locale.lc_cc;c.lc=R9.globals.locale.lc;return jq.extend(c,a)},runSearchOnFocus:function(){var b=R9.Widgets.Smarty.FlareSmarty.runSearchNextFocus;R9.Widgets.Smarty.FlareSmarty.runSearchNextFocus=!0;
return R9.Widgets.Smarty.Smarty.prototype.runSearchOnFocus.call(this)&&b},onInitialData:function(){var b=this.generateTopDestinations()||R9.Widgets.Smarty.Smarty.prototype.onInitialData.call(this)||this.makeRecentList(null,!0),a=this.generateAnywhereMarkup(),c=this.generateLoginBar(b||a),d=this.generateContinentsMarkup();if(b)return this.placeAnywhereMarkup(b,(a?a:"")+c);b=[];this.appendToInitialData(b);a&&b.push(a);d&&b.push(d);this.options.smartyControlGroup&&R9.globals.canLogin&&"undefined"!==
typeof c&&b.push(c);return b.length?"\x3cul\x3e"+b.join("")+"\x3c/ul\x3e":""},appendToInitialData:function(b){},generateTopDestinations:function(){if(this.options.smartyControlGroup){var b=this.options.smartyControlGroup.getTopDestinations();if(b){var a=b.getItems(),c=b.getMaxItems();return(b=a&&a.filter(function(a,b){return b<c}).map(this.createTopDestinationItem.bind(this)).join(""))&&""!==b?"\x3cul\x3e"+b+"\x3c/ul\x3e":null}}},createTopDestinationItem:function(b){return""},generateAnywhereMarkup:function(b){},
generateContinentsMarkup:function(){},placeAnywhereMarkup:function(b,a){return b?R9.config.getBoolean("ui.smarty.anywhereFirst",!1)?b.replace("\x3cul\x3e","\x3cul\x3e"+a):b.replace("\x3c/ul\x3e",a+"\x3c/ul\x3e"):b},placeContinentsMarkup:function(b,a){return b?b.replace("\x3c/ul\x3e",a+"\x3c/ul\x3e"):b},postprocessResponse:function(b,a){var c=b&&/<li/i.test(b),d=this.makeRecentList(a?this.element.val().toUpperCase():null,!c),e=this.generateOtherMarkup(c);a=this.generateAnywhereMarkup(c);var f=this.generateContinentsMarkup();
if(!d&&!c&&!a)return null;if(!c)return b=d?d:"\x3cul\x3e\x3c/ul\x3e",b=e?b.replace("\x3c/ul\x3e",e+"\x3c/ul\x3e"):b,b=this.placeAnywhereMarkup(b,a?a:""),b=this.placeContinentsMarkup(b,f),b+this.generateLoginBar(!1);b=e?b.replace("\x3c/ul\x3e",e+"\x3c/ul\x3e"):b;b=this.placeAnywhereMarkup(b,a?a:"");d&&(b=b.replace("\x3c/ul\x3e",d+"\x3c/ul\x3e"));return b.replace("\x3c/ul\x3e",this.generateLoginBar(!0)+"\x3c/ul\x3e")},generateOtherMarkup:function(b){return null},selectItem:function(b,a){jq(b).hasClass("hist")&&
this.options.smartyControlGroup?(b=jq(b).data("history-idx"),a=this.options.smartyControlGroup.getHistory(),this.options.smartyControlGroup.setFieldsFromHistoryItem(a.history[b],!1),"undefined"!==typeof this.tempState&&delete this.tempState,R9.Analytics.api.trackEvent("smartyHistory/click/historyItem")):jq(b).hasClass("showHistory")?(window.location.assign("/history"),R9.Analytics.api.trackEvent("smartyHistory/click/seeAllHistory")):jq(b).hasClass("signup")?(AjaxReg.ui.register({promoType:"smarty"}),
R9.Analytics.api.trackEvent("smartyHistory/click/signUp")):jq(b).hasClass("signupnow")?(R9.config.getBoolean("ui.login.staticSignUp")?R9.authentication.showDefault({promoType:"smarty"}):R9.authentication.showSignup(),R9.Analytics.api.trackEvent("smartyHistory/click/signUp"),R9.events.publish("smarty.setitem.complete",{id:this.element.attr("id")})):(b=this.translateItem(b),this.setItem(b,a))},makeRecentList:function(b,a){var c=this.options.recentList,d=null;if(c&&0<c.length){for(var d="",e=0;e<c.length;e++)if(!b||
-1!=c[e].display.toUpperCase().indexOf(b)){var f=c[e].display;b&&(f=this.highliteText(f,b));d+="\x3cli id\x3d'"+c[e].code+"' class\x3d'"+c[e].className+"' data-short-name\x3d'"+c[e].shortName+"'\x3e"+f+"\x3c/li\x3e"}d=""!=d?(a?"\x3cul\x3e":"")+"\x3cli class\x3d'separator'\x3e\x3cb\x3eRecently searched:\x3c/b\x3e\x3c/li\x3e"+d+(a?"\x3c/ul\x3e":""):null}return d},highliteText:function(b,a){a&&(a=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$\x26"),b=b.replace(new RegExp("("+a+")","ig"),"\x3cb\x3e$1\x3c/b\x3e"));
return b},getFlareSmartyType:function(){return this.options.flareSmartyType},setFlareSmartyType:function(b){this.options.flareSmartyType=b},matchAndBold:function(b,a,c,d){if(!b||!a)return a;c=c||"\x3cb\x3e";d=d||"\x3c/b\x3e";var e=0,f=0,g="",h=a,k=b.length;for(b=b.toUpperCase();;){if(0!==e||0!==(f=a.toUpperCase().indexOf(b,e)))if(-1<(f=a.toUpperCase().indexOf(" "+b,e)))f++;else break;e=a.substring(e,f);h=a.substring(f,f+k);g+=e+c+h+d;h=a.substring(f+k,a.length);e=f+k}return g+h},handleItemMouseoverEvent:function(b,
a){this.getItemList().removeClass("selected");jq(b).addClass("selected");!this.isDisabledHistoryPreview()&&jq(b).hasClass("hist")&&this.options.smartyControlGroup&&"undefined"===typeof this.tempState&&(this.tempState=this.options.smartyControlGroup.saveFieldsToHistoryItem(),b=jq(b).data("history-idx"),a=this.options.smartyControlGroup.getHistory(),this.options.smartyControlGroup.setFieldsFromHistoryItem(a.history[b],!0))},handleItemMouseoutEvent:function(b,a){jq(b).removeClass("selected");this.isDisabledHistoryPreview()||
"undefined"===typeof this.tempState||(this.options.smartyControlGroup.setFieldsFromHistoryItem(this.tempState,!0),delete this.tempState)},isDisabledHistoryPreview:function(){return!1},generateLoginBar:function(b){if(!this.options.smartyControlGroup||!R9.globals.canLogin)return"";var a="admin";b&&(a+=" addSeparation");return"undefined"!==typeof R9Anon&&R9Anon?"\x3cli class\x3d'signup "+a+"'\x3eSign up to access recent searches anywhere\x3c/li\x3e":"\x3cli class\x3d'showHistory "+a+"'\x3e See all search history\x3c/li\x3e"},
generateRecentHeader:function(){R9.Common.SmartyHistory.currentSmarty=this;R9.Common.SmartyHistory.currentSmartyHistory=this.options.smartyControlGroup.getHistory();this.hasClearRecentEvent||(this.hasClearRecentEvent=!0,this.dropdown.on("click","ul li.searchHistorySeparator",function(b){b.stopPropagation();b.stopImmediatePropagation()}),this.dropdown.on("mousedown","ul li .clearRecent",function(b){b.stopPropagation();jq("body").trigger("event",[b]);R9.Common.SmartyHistory.SmartyClearHistory()}));
return"\x3cli class\x3d'separator searchHistorySeparator'\x3e\x3cspan class\x3d'separatorLabel'\x3eRecent Searches\x3c/span\x3e\x3ca class\x3d'clearRecent'\x3eclear\x3c/a\x3e\x3c/li\x3e"}});
(function(b,a){b.createWidgetClass("smarty.SmartyBaseLoader",a.extend({},b.Widgets.Smarty.Smarty.prototype));b.createWidgetClass("smarty.FlareSmartyBaseLoader","common.widgets.smarty.Smarty",a.extend({},b.Widgets.Smarty.FlareSmarty.prototype,{constructor:function(c,d){this.base(c,a.extend({},b.Widgets.Smarty.FlareSmarty.prototype.options,d))}}))})(window.R9,window.jq||window.jQuery);(function(e,f){e.createWidgetClass("smarty.Smarty","common.widgets.smarty.SmartyBaseLoader",{loggingPrefix:"smarty",setItemTriggered:!1,activeAnimation:!0,focusEventHandled:!1,updateDropdownTop:!0,options:{flippable:!0,direction:"down",repositionDropdownOnResize:e.config.getBoolean("ui.smarty.repositionDropdownOnResize",!0),messages:{SMARTY_HOTELS_NEAR_CITY:"",SMARTY_RENTALS_NEAR_CITY:"",SMARTY_LOCATION_TYPE_HOTEL:"",SMARTY_LOCATION_TYPE_AIRPORT:"",SMARTY_LOCATION_TYPE_NEIGHBORHOOD:"",SMARTY_LOCATION_TYPE_CITY:"",
SMARTY_LOCATION_TYPE_LANDMARK:"",SMARTY_LOCATION_TYPE_COUNTRY:"",SMARTY_LOCATION_TYPE_COUNTRY_GROUP:"",SMARTY_LOCATION_TYPE_REGION:"",SMARTY_LOCATION_TYPE_FREE_REGION:"",SMARTY_LOCATION_TYPE_RAIL:"",SMARTY_LOCATION_TYPE_RESTAURANT:"",SMARTY_LOCATION_TYPE_AIRLINE:"",SMARTY_LOCATION_TYPE_BRAND:"",SMARTY_LOCATION_TYPE_BRAND_GROUP:"",SMARTY_LOCATION_TYPE_AIRPORT_NEAR_CITY:"",SMARTY_LOCATION_TYPE_PLACE:"",SMARTY_LOCATION_TYPE_POI:"",SMARTY_LOCATION_TYPE_WORLD:"",SMARTY_CONTINENTS_LABEL:""}},locationTypeMessages:{},
constructor:function(a,b){this.base(a,b);this.applyJsonOptions();this.locationTypeMessages={ap:this.options.messages.SMARTY_LOCATION_TYPE_AIRPORT,hood:this.options.messages.SMARTY_LOCATION_TYPE_NEIGHBORHOOD,lm:this.options.messages.SMARTY_LOCATION_TYPE_LANDMARK,ctry:this.options.messages.SMARTY_LOCATION_TYPE_COUNTRY,cg:this.options.messages.SMARTY_LOCATION_TYPE_REGION,ctgroup:this.options.messages.SMARTY_LOCATION_TYPE_REGION,reg:this.options.messages.SMARTY_LOCATION_TYPE_REGION,freereg:this.options.messages.SMARTY_LOCATION_TYPE_FREE_REGION,
city:this.options.messages.SMARTY_LOCATION_TYPE_CITY,hotel:this.options.messages.SMARTY_LOCATION_TYPE_HOTEL,rail:this.options.messages.SMARTY_LOCATION_TYPE_RAIL,rest:this.options.messages.SMARTY_LOCATION_TYPE_RESTAURANT,addr:this.options.messages.SMARTY_LOCATION_TYPE_PLACE}},init:function(){this.aria=e.config&&e.config.getBoolean("ui.smarty.aria",!0);e.config&&(this.options.zIndex=e.config.getInt("ui.smarty.zIndex",9999));this.dropdown=this.options.dropdown;this.initSmartyDropdown();this.element.attr("smarty",
!0);!0===this.options.enableRemoteHide&&this.id()&&e.events.subscribe("Smarty.hide",f.proxy(this.hideSmartyById,this));this.subscribe("Smarty.change.style",this.changeSmartyStyle.bind(this))},changeSmartyStyle:function(a){var b=this.dropdown[0].id;b.includes(a.id)&&(this.updateDropdownTop=a.updateDropdownTop,b.includes("origin")?this.dropdown.css(a.originCss):b.includes("destination")&&this.dropdown.css(a.destinationCss))},hideSmartyById:function(a){this.id()!==a&&this.hideDropdown(!1)},inlineComponentsReady:function(){var a=
this;setTimeout(function(){a.element.attr({autocomplete:"off",autocapitalize:"off",autocorrect:"off"});a.aria&&a.element.attr({role:"combobox","aria-autocomplete":a.options.showBackgroundAutocomplete?"both":"list"});a.element.is(":focus")?a.element.focus():a.element.attr("autofocus")&&a.element.focus();a.options.showBackgroundAutocomplete&&(a.options.getBackgroundAutocompletePositionProps=function(){return{"margin-bottom":"-"+a.element.outerHeight(!0)+"px"}});a.initBackgroundAutocomplete();e.config.getBoolean("ui.smarty.animation.v2",
!1)&&a.animateSmartyV2(!1);a.initialVal=a.element.val();a.initialCode=a.element.next(".aircode").val();""!==a.initialVal&&(a.isItemSet=!0)},1)},concatExtraDropdownClasses:function(a,b){if(f.isArray(a)&&b)for(var c=0;c<a.length;c++)a[c]&&a[c].dropdownClass&&(a[c].dropdownClass+=b)},extraIconClasses:function(a){return a?" "+e.config.getString("ui.smarty.iconClasses","greyIcons")+" ":""},extraLabelClasses:function(){return e.config.getBoolean("ui.smarty.labels",!1)&&this.options.extendRequest&&"v2"===
this.options.extendRequest.v?e.config.getString("ui.smarty.labelsClasses","greyLabels"):""},addEventHandlers:function(){this.bindInputEvent("keydown",this.handleInputKeydownEvent);this.addDelegateEventHandlers()},addDelegateEventHandlers:e.Common.Utils.limit(1,function(){var a=[e.globals.keyCodes.TAB,e.globals.keyCodes.RETURN,e.globals.keyCodes.ESC];this.bindDelegateInputEvent("focus",this.handleInputFocusEvent);this.bindDelegateInputEvent("mousedown touchstart",this.handleInputFocusEvent);this.bindDelegateInputEvent("blur",
this.handleSmartyInputBlurEvent);this.bindDelegateInputEvent("textchange",this.handleInputChangeEvent);this.bindDelegateInputEvent("keyup",function(b){0<=a.indexOf(b.keyCode?b.keyCode:b.which)||this.dropdown&&this.dropdown.is(":visible")&&this.handleInputFocusEvent(this.element,b)})}),bindDelegateInputEvent:function(a,b){f("body").off(a,'input[smarty\x3d"true"]').on(a,'input[smarty\x3d"true"]',function(a){var c=f(this).getWidget();return c?b.call(c,a):!1})},initDropdown:function(){this.initSmartyDropdown()},
initSmartyDropdown:function(){if(!this.dropdown){var a={id:this.id("smartbox-dropdown"),css:{display:"none",position:"absolute",width:"auto"},role:"dialog",tabindex:"0"},b=this.widgetBaseClass||"";this.options.dropdownClass&&(b=b+" "+this.options.dropdownClass);this.dropdown=f("\x3cdiv\x3e\x3c/div\x3e",a).addClass(b);this.dropdown.addClass("R9-Overlay");this.dropdown.addClass(this.extraIconClasses());this.dropdown.addClass(this.extraLabelClasses())}},setDropdownContent:function(a){this.dropdown[0].innerHTML=
a},setDropdownPosition:function(){var a=this.widgetBaseClass;this.options.dropdownClass&&(a=a+" "+this.options.dropdownClass);a=a+" "+this.extraIconClasses()+" "+this.extraLabelClasses();this.dropdown.attr("class",a);var a=this.dropdown[0].style,b=this.dropdown.outerWidth(!0),c=!1;this.options.minWidth&&b<this.options.minWidth&&(b=Math.max(this.options.minWidth,b),c=!0);this.options.maxWidth&&b>this.options.maxWidth&&(b=Math.min(this.options.maxWidth,b),c=!0);a.width=c?b+"px":"auto";if(this.options.fixedDropdown)a.position=
"relative";else{var c=this.options.positionTarget||this.element,d=c.offset(),e=f(this.options.appendTo).offset(),h=0,l=d.left-e.left,k=this.options.direction;this.dropdown.parent()[0]===f(document.body)[0]&&(h=parseInt((f(document.body).css("top")||"0").replace("-",""))||0);"right"===this.options.position&&(l+=c.width()-b-2);this.shouldFlipDirection(k)&&(k="down"===k?"up":"down");"up"===k?this.updateDropdownTop&&(this.element.addClass("up"),a.top=d.top-this.dropdown.outerHeight()-h+"px"):this.updateDropdownTop&&
(this.element.removeClass("up"),a.top=h+d.top+c.outerHeight()-e.top+"px");"rtl"===document.dir?(b=f(window).width()-(d.left+c.outerWidth()),a.right=b+"px"):a.left=l+"px"}this.isAnimated()||(a.display="inline");this.aria&&(this.element.attr({"aria-expanded":!0}),this.dropdown.find("ul").attr("role","listbox"),this.dropdown.find("li").attr("role","option"));a.zIndex=this.element.zIndex()+this.options.zIndex;this.options.boundToScreen&&(this.dropdown.css("height","auto"),b=f(window).height(),c=f(window).scrollTop(),
d=this.dropdown.outerHeight(),a=parseInt(a.top),d+a+10-c>b&&(this.dropdown.height(b+c-a-10),this.dropdown.css("overflow-y","auto")))},shouldFlipDirection:function(a){if(this.options.flippable){var b=f(window).scrollTop(),c=b+f(window).outerHeight(),d=this.dropdown.outerHeight(),e=this.element.offset().top,c=e+this.element.outerHeight()+d>c,b=e-d<b;if("down"===a)return c&&!b;if("up"===a)return b&&!c}return!1},showDropdown:function(a,b){this.options.enableRemoteHide&&e.events.publish("Smarty.hide",
this.id());this.deferredSmartyAppend||(this.deferredSmartyAppend=1,this.dropdown.appendTo(this.options.appendTo));var c=this;this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()){var d=this.showDropdownLast?Date.now()-this.showDropdownLast:null;if(!this.showDropdownLast||0===d||d&&0<d&&d<this.options.showDropdownDelay){this.showDropdownLast=this.showDropdownLast||Date.now();
this.showDropdownTimeout=setTimeout(this.showDropdown.bind(this,a,b),d||this.options.showDropdownDelay);return}}this.showDropdownLast=null;this.setDropdownContent(this.makeHTML(a));this.setDropdownPosition();this.bindDropdownEvent("click",this.handleItemClickEvent);this.bindDropdownEvent("mouseover",this.handleItemMouseoverEvent);this.bindDropdownEvent("mouseout",this.handleItemMouseoutEvent);if(this.options.repositionDropdownOnResize)f(window).off("resize.smarty").on("resize.smarty",this.handleWindowResizeSmarty.bind(this));
clearTimeout(this.clickDropdownSetID);this.clickDropdownSetID=setTimeout(function(){if(c.isSmartyActiveElement())f(document).off("click.Smarty"+c.id()).on("click.Smarty"+c.id(),function(){c.onDocumentClicked()})},400);this.removeItemHighlight();""!==this.element.val()&&this.highlightFirstSelectableItem();this.options.positionOnScroll&&(a=function(){c.position()},f(window).off("scroll.smarty",a).on("scroll.smarty",a),f(".col-left-rail").off("scroll.colSmarty").on("scroll.colSmarty",a),f(".filterList").off("scroll.colSmarty").on("scroll.colSmarty",
a),f(".Common-Widgets-Dialog-Dialog.visible\x3e.viewport").off("scroll.dialogSmarty").on("scroll.dialogSmarty",a));e.config.getBoolean("ui.smarty.animation.v2",!1)&&this.animateSmartyV2(!0)},hideDropdown:function(a){f(window).off("resize.smarty");this.base(a);if(e.config.getBoolean("ui.smarty.auto.select.1st",!1))return!0},toggleAnywhere:function(a){this.options.showAnywhere=a},stopInputProcessing:function(){this.setItemTriggered||this.smartyLoggerSave();this.setItemTriggered=!1;this.base()},handleItemClickEvent:function(a){this.selectItem(a,
null);this.hideDropdown()},handleInputBlurEvent:function(a,b){this.handleSmartyInputBlurEvent(a,b)},handleSmartyInputBlurEvent:function(){var a=this;this.focusEventHandled=!1;setTimeout(function(){if(!a.isSmartyActiveElement()){a.stopInputProcessing();if(a.hideDropdown()&&a.options.forceSelection)a.onForceSelection();a.onAfterDone()}},10)},onDocumentClicked:function(){if(!this.isSmartyActiveElement())if(f(document).off("click.Smarty"+this.id()),this.options.cleanUpInputFieldOnFocus){if(this.lastValue&&
!this.element.val()&&this.element.val(this.lastValue),!this.isSmartyActiveElement()){this.stopInputProcessing();if(this.hideDropdown()&&this.options.forceSelection)this.onForceSelection();this.onAfterDone()}}else this.hideDropdown()},isSmartyActiveElement:function(){return this.dropdown&&this.element?document.activeElement===this.dropdown.get(0)||document.activeElement===this.element.get(0)||0<this.dropdown.find(f(document.activeElement)).length:!1},setItem:function(a,b){this.smartyLoggerSave(a);
this.setItemTriggered=!0;this.base(a,b)},smartyLoggerSave:function(a){if(e.config.getBoolean("ui.smarty.r9LogOptions",!0)){var b={vertical:this._logPath,inputType:this.element.attr("name")||"destination",prefix:this.isItemSet||!this.setItemTriggered&&this.initialVal&&this.initialVal===this.element.val()?"":this.element.val()||"",options:this.getSmartyLoggerItems()||[]};a&&(b.selectedElem=a);e.SmartyLogger._save(b)}},getSmartyLoggerItems:function(){return this.dropdown&&this.dropdown.children&&this.dropdown.children("ul").children("li")},
handleWindowResize:function(){this.handleWindowResizeSmarty()},handleWindowResizeSmarty:function(){if(!this.isDropdownHidden()){var a=this.options.positionTarget||this.element,b=a.offset().left-f(this.options.appendTo).offset().left,c=a.offset().top+a.outerHeight()-f(this.options.appendTo).offset().top;"right"===this.options.position&&(b+=a.width()-2);this.dropdown.css("left",b+"px");this.dropdown.css("top",c+"px")}this.updateBackgroundAutocompletePosition()},destroy:function(){this.base();this.hideDropdown();
this.abortSearchCompletedEventListeners();this.unInit();this.unbindInputEvent("mousedown touchstart");this.unbindInputEvent("keyup");this.element.removeData("widget");this.element.attr("smarty",!1);f(document).off("click.Smarty"+this.id());f(window).off("resize.smarty");!0===this.options.enableRemoteHide&&this.id()&&e.events.unsubscribe("Smarty.hide",this.hideSmartyById)},animateSmarty:function(a,b){this.isAnimated()&&(a?this.dropdown.slideDown(250):this.dropdown.slideUp(250,b))},isAnimated:function(){return this.options.animateSmarty},
isJSON:function(){var a=this.options.extendRequest;return a&&"j"===a.f},isJsonResponse:function(a){return this.isJSON()&&"string"!==typeof a},applyJsonOptions:function(){this.isJSON()&&(this.options.dataType="json",this.options.extendRequest=f.extend({},this.options.extendRequest,{v:"v1"}),this.options.dropdownClass+=" smartbox-js")},postprocessResponse:function(a,b){return this.isJsonResponse(a)?a:this.base(a,b)},makeHTML:function(a){if(!this.isJsonResponse(a))return this.base(a);var b=this,c=this.getRequestData(),
d=c&&c.value||"",e=this.getMaxItemsToShow();return'\x3cul role\x3d"listbox"\x3e'+a.map(function(a,c){return 0<e&&c>=e?null:b.formatItem(a,d)}).filter(function(a){return!!a}).join("")+"\x3c/ul\x3e"},getMaxItemsToShow:function(){return-1},formatItem:function(a,b){var c=a.cc&&"ctry"===a.loctype&&e.config&&e.config.getBoolean("ui.smarty.hideCountryFeatures."+a.cc,!1);if(!a||!a.loctype)return"";var d=this.getDisplayName(a),g=this.getNearbyHotels(a),h=this.getNearbyRentals(a),d=f.extend({},a,{id:this.getItemId(a),
name:d,label:[d,g,h].filter(function(a){return!!a}).join(" "),highlighting:this.highlight(d,b),parentPath:a.parentPath||a.rc||"",nearbyHotels:g,nearbyRentals:h}),g='\x3cdiv class\x3d"smarty-city"\x3e'+d.highlighting+"\x3c/div\x3e";"ap"===a.loctype?(d.shortName=a.shortdisplayname||"",g+='\x3cspan class\x3d"airportCode"\x3e'+this.highlight(a.ap,b)+"\x3c/span\x3e"):"city"===a.loctype?d.shortName=a.cityonly||"":"ctry"===a.loctype&&a.cc&&!c&&(d.icon="/images/flags/a-small-flag."+a.cc.toLowerCase()+".png");
(b=this.locationTypeMessages[a.loctype]||"")&&!c&&(g+='\x3cspan class\x3d"smarty-label '+a.loctype+'"\x3e'+b+"\x3c/span\x3e");"ap"!==a.loctype&&"hotel"!==a.loctype&&(g+=this.formatNearbyDetails(a,d));b=a.loctype||"city";"cg"===b&&(b="ctgroup");c&&(b+=" noBackgroundIcon");c=['id\x3d"'+this.formatListItemId(a,d)+'"','class\x3d"'+b+'"','role\x3d"option"','tabindex\x3d"0"'];a.cc&&c.push('data-cc\x3d"'+a.cc+'"');a.rc&&c.push('data-rc\x3d"'+a.rc+'"');d.shortName&&c.push('data-short-name\x3d"'+d.shortName+
'"');d.label&&c.push('aria-label\x3d"'+d.label+'"');d.icon&&c.push('style\x3d"background-image:url('+d.icon+')"');c.push('data-attr\x3d"'+this.htmlEscape(JSON.stringify(d))+'"');return"\x3cli "+c.join(" ")+"\x3e"+g+"\x3c/li\x3e"},getDisplayName:function(a){var b=a.displayname||"";if(a.ap){a="("+a.ap+")";var c=b.length,d=c-a.length;b&&b.substring(d,c)===a&&(b=b.substring(0,d).trim())}return b},getNearbyHotelsCount:function(a){return a.hotelCount||a.nearbyHotels||0},getNearbyHotels:function(a){return""},
getNearbyRentalsCount:function(a){return a.rentalCount||a.nearbyRentals||0},getNearbyRentals:function(a){return""},formatNearbyDetails:function(a,b){a="";b.nearbyHotels&&(a+='\x3cspan class\x3d"smarty-label hotels"\x3e'+b.nearbyHotels+"\x3c/span\x3e");b.nearbyRentals&&(a+='\x3cspan class\x3d"smarty-label rentals"\x3e'+b.nearbyRentals+"\x3c/span\x3e");return a},getItemId:function(a){return""+(("ap"===a.loctype?a.ap:"city"===a.loctype?a.ctid:"ctry"===a.loctype?a.cid:"hotel"===a.loctype?a.hid:"reg"===
a.loctype?a.rid:"freereg"===a.loctype?a.frid:"cg"===a.loctype?a.cgid:"hood"===a.loctype?a.sid:"lm"===a.loctype?a.lmid:a.id)||"")},formatListItemId:function(a,b){return a.loctype+"-"+b.id},htmlEscape:function(a){var b={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#39;"};return a.replace(/[&<>"']/g,function(a){return b[a]})},highlight:function(a,b){var c=a.toLowerCase().indexOf(b.toLowerCase());b=c+b.length;return 0>c?a:a.substring(0,c)+"\x3cb\x3e"+a.substring(c,b)+"\x3c/b\x3e"+
a.substring(b)}})})(window.R9,window.jq||window.jQuery);(function(d,e){d.createWidgetClass("smarty.PopularDestinationsSmarty","common.widgets.smarty.FlareSmarty",{currentOrigin:null,constructor:function(a,b){d.config.getBoolean("ui.smarty.auto.select.1st.item.on.close",!1)&&e.extend(b,{dropdownList1stItemSelector:"ul[role\x3dlistbox] li:first-child:visible",dropdownListItemsSelector:"ul[role\x3dlistbox] li"});this.base(a,b)},showDropdown:function(a,b){this.base(a,b);d.config.getBoolean("ui.smarty.animation.v2",!1)&&this.activeAnimation?(this.animateSmartyV2(!0),
this.base(a,b)):this.isAnimated()&&this.animateSmarty(!0)},searchCompleted:function(a,b){d.config.getBoolean("ui.smarty.auto.select.1st.item.on.close",!1)?((a=this.canShowDropdown(a))?this.showDropdown(a,b):this.hideDropdown(!0),this.element.trigger("searchCompleted",!!a)):this.base(a,b)},hideDropdown:function(a){var b="undefined"==typeof a;if(d.config.getBoolean("ui.smarty.auto.select.1st.item.on.close",!1)&&""!==this.element[0].value&&this.isSelectOnCloseSupported()){var c=this.dropdown.find(this.options.dropdownList1stItemSelector);
a=this.dropdown.find(this.options.dropdownListItemsSelector);if("undefined"!==typeof c&&0<c.length&&c.hasClass("selected"))(a=this.extractFirstListItemData(c))&&this.setItem(a);else if(b){b=!1;for(c=0;c<a.length;c++)e(a[c]).hasClass("selected")&&(b=a[c]);b||(1<c&&(e(a[0]).hasClass("anywhere")&&"undefined"!==typeof a[1]?e(a[1]).addClass("selected"):e(a[0]).addClass("selected")),a.each(this.checkAndSetItem.bind(this)))}}if(d.config.getBoolean("ui.smarty.animation.v2",!1)&&this.activeAnimation){if(!this.dropdown||
"none"===this.dropdown.css("display"))return!1;this.animateSmartyV2(!1);this.base()}else this.isAnimated()?this.animateSmarty(!1,this.base.bind(this)):this.base();if(d.config.getBoolean("ui.smarty.auto.select.1st",!1))return!0},checkAndSetItem:function(a,b){a=e(b);if(a.hasClass("anywhere")&&a.hasClass("selected")&&a.is(":visible"))return a={id:"",short_str:"anywhere",str:a[0].innerText,type:""},this.setItem(a),!1;if("undefined"!==a.attr("id")&&a.is(":visible")&&(a=this.extractFirstListItemData(a)))return this.setItem(a),
!1},extractFirstListItemData:function(a){if(a.hasClass("anywhere")&&a.hasClass("selected")&&a.is(":visible"))return{id:"",short_str:"anywhere",str:a[0].innerText,type:""};if(d.config.getBoolean("ui.smarty.populardestinations.1st.translate",!0))return(a=this.translateItem(a))?a:!1;var b=a[0].id.split("-"),c=a[0].id;return c.startsWith("ap")?{id:b[1],short_str:a.attr("data-short-name"),str:a.clone().find("span").remove().end().text(),type:"ap"}:c.startsWith("freereg")?{frid:b[3],hc:b[2],id:b[1],str:a.children("div")[0].innerText,
type:"freereg"}:c.startsWith("ctry")?{cid:b[3],hc:b[2],id:b[1],str:a.children("div")[0].innerText,type:"ctry"}:c.startsWith("reg")?{rid:b[3],hc:b[2],id:b[1],str:a.children("div")[0].innerText,type:"reg"}:c.startsWith("city")?{hc:b[2],id:b[1],str:a.children("div")[0].innerText,type:"city"}:c.startsWith("lm")?{hc:b[2],lmid:b[3],id:b[1],str:a.children("div")[0].innerText,type:"lm"}:!1},isSelectOnCloseSupported:function(){return 51===this.options.flareSmartyType||50===this.options.flareSmartyType||58===
this.options.flareSmartyType},drawDestinationsContent:function(a){this.lastValue=null;this.currentOrigin&&this.currentOrigin===a||(this.currentOrigin=a,this.dropdown[0].innerHTML="");this.hideDropdown()}})})(window.R9,window.jq||window.jQuery);(function(e,l){var r=function(a){return 3===a.trim().length};e.createWidgetClass("smarty.FlightSmarty","common.widgets.smarty.PopularDestinationsSmarty",{isDirty:!1,constructor:function(a,b){var c={dropdownClass:" smartbox smartbox-air smartbox-air-regions smartbox-v2 R9-Overlay ",templatePresentationSuffix:"",flareSmartyType:1,forceSelection:!0,minWidth:250,searchOnFocus:!0,useNearby:!1,allowMultipleAirports:e.config.getBoolean("ui.smarty.flights.allowMultipleAirports",!0),airportMultiSelectEnabled:!1,
useApiAirportCode:e.config.getBoolean("ui.smarty.flights.useApiAirportCode",!1),nearbyChecked:!1,extendRequest:{v:"v2"},alwaysShowAnywhere:!1,disableAnywhereDirtyCheck:e.config.getBoolean("ui.smarty.disableAnywhereDirtyCheck",!1),disableHistoryPreview:e.config.getBoolean("ui.smarty.disableHistoryPreview",!1),repositionDropdownOnResize:e.config.getBoolean("ui.smarty.flights.repositionDropdownOnResize",!1),onInputChange:function(){},onAddAirportMultiSelection:function(a,b,c,e){},onRemoveAirportMultiSelection:function(a,
b){},getAirportMultiSelections:function(){return[]},hasAirportMultiSelectionCode:function(){},allowAddAirportMultiSelection:function(){}};c.isBusinessMode=e.question.ask("common.business.BusinessIsBusinessMode");c.isBusinessMode&&(c.businessOffices=e.question.ask("common.business.BusinessOffices"),c.businessOfficesHeader=e.question.ask("common.business.BusinessOfficesHeader"),c.businessSmartyMatchOffices=e.question.ask("common.business.BusinessSmartyMatchOffices"));this.concatExtraDropdownClasses([c,
b],this.extraIconClasses(e.config.getBoolean("ui.smarty.flights.greyIcons",!1)));b&&b.extraDropdownClasses&&(c.dropdownClass+=" "+b.extraDropdownClasses+" ");this.base(a,l.extend(c,b))},setOptions:function(a){l.extend(this.options,a)},showDropdown:function(a,b){this.base(a,b);!this.options.useNearby||!l.trim(this.element.val()).length&&this.options.smartyControlGroup&&this.options.smartyControlGroup.getTopDestinations()||this.addNearby()},addNearby:function(){if(this.dropdown){var a=this.id("nearby"),
b=this.id("nearbyCheck"),c,d=!!this.isNearbyChecked||void 0===this.isNearbyChecked&&this.options.nearbyChecked,h=this;if(!(0<this.dropdown.find("#"+a).length)){c=0<this.dropdown.find("li").map(function(){return this.id.split("-")[0]}).toArray().filter(function(a){return"ap"===a||"apnc"===a}).length;var g=this.airportMultiSelectActive&&!!this.dropdown.find("li.js-selection").length;if(c||g)c=e.template.render("nearbySmartyCheck"+this.options.templatePresentationSuffix,{id:b}),a=e.template.renderElement("nearbySmartyWrapper"+
this.options.templatePresentationSuffix,{id:a,nearbySmartyCheck:c}),this.dropdown.prepend(a),b=this.dropdown.find("#"+b),a=b.parent().is(".StyleJamCheckbox")?"styleJamCheckbox":"checkbox",b[a]({change:function(a){h.isNearbyChecked=a.checked;"function"===typeof h.options.nearbyCallback&&h.options.nearbyCallback.call(null,{enabled:h.isNearbyChecked})}}).prop("checked",d?"checked":""),this.isNearbyChecked=d}}},getIsNearbyChecked:function(){return this.isNearbyChecked},postprocessResponse:function(a,
b){var c=this,d=this.base(a,b);if(this.options.allowMultipleAirports&&1<this.element.val().split(",").filter(r).length){d="\x3cli id\x3d'custom' class\x3d'no-icon'\x3e\x3cb\x3e"+this.element.val()+"\x3c/b\x3e\x3c/li\x3e";if("string"===typeof a){var h=a.indexOf("\x3cli");if(0<h)return a.slice(0,h)+d+a.slice(h)}return"\x3cul\x3e"+d+"\x3c/ul\x3e"}!a&&e.config.getBoolean("ui.flight.smarty-addresses",!0)&&e.Maps&&e.Maps.Google&&e.Maps.Google.load&&e.Maps.Google.load(function(){if(c.lastValue){var d=c.getAddressSuggestions(c.lastValue),
h=c.searchCompleted,f=c.base,l=c.matchAndBold,m=c.lastValue;d.done(function(a){if(a&&0<a.length){for(var d="\x3cul\x3e",g=0;g<a.length;g++){var k=a[g],n=!1,q=!1;if(k.types)for(var p=0;p<k.types.length;p++)if("street_address"===k.types[p]||"route"===k.types[p]||"premise"===k.types[p]){q=!0;break}q&&(n=!0,d+=e.template.render("smartyAddressItem",{index:g,value:l.call(c,m,k.description)}))}d=d.replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e").replace(/&#x2F;/g,"/");d+="\x3c/ul\x3e";!n&&c.isProbablyAddress(m)&&
(d=c.getAddressPlaceholder(m));h.call(c,f.call(c,d,b),b)}else c.isProbablyAddress(m)&&h.call(c,f.call(c,c.getAddressPlaceholder(m),b),b)}).fail(function(){c.isProbablyAddress(m)&&h.call(c,f.call(c,c.getAddressPlaceholder(m),b),b)});return a}},c.widgetName);return d},getAddressSuggestions:function(a){var b=l.Deferred();e.config.getBoolean("ui.flight.smarty-addresses",!0)&&window.google&&google.maps&&google.maps.places&&google.maps.places.AutocompleteService&&(new google.maps.places.AutocompleteService).getPlacePredictions({input:a},
function(a,d){d===google.maps.places.PlacesServiceStatus.OK?b.resolve(a):b.reject(d)});return b.promise()},getAddressPlaceholder:function(a){},isProbablyAddress:function(a){return!1},setIsNearbyChecked:function(a){this.isNearbyChecked!==a&&(this.isNearbyChecked=!!a,this.dropdown&&this.dropdown.find("#"+this.id("nearbyCheck")).prop("checked",this.isNearbyChecked?"checked":""))},createTopDestinationItem:function(a){var b=[],c="%s (%s)".format(a.name,a.cityCode);b.push(a.name);a.stateCode&&""!==a.stateCode?
b.push(a.stateCode):a.state&&b.push(a.state);a.country&&b.push(a.country);return('\x3cli id\x3d"ap-%s" class\x3d"ap" data-short-name\x3d"%s" data-cc\x3d"%s" data-apicode\x3d"%s" role\x3d"option"\x3e\x3cspan class\x3d"airportCode"\x3e%s\x3c/span\x3e%s\x3cspan class\x3d"smarty-label ap"\x3e'+this.options.messages.SMARTY_LOCATION_TYPE_AIRPORT+"\x3c/span\x3e\x3c/li\x3e").format(a.cityCode+"/"+a.ctId,c,a.cid,a.cityCode,a.cityCode,b.join(", "))},translateItem:function(a){var b=this.base(a);if(this.options.useApiAirportCode&&
"ap"===b.type&&b.apicode){var c=b.id.split("/");b.id=1<c.length?b.apicode+"/"+c[1]:b.apicode}this.options.airportMultiSelectEnabled&&(b.isMetroCode=l(a).hasClass("aap"));b.lat=l(a).attr("data-lat");b.long=l(a).attr("data-long");return b},makeBusinessOfficeList:function(){if(this.options.isBusinessMode){var a;a=null===this.lastValue?this.options.businessOffices:this.options.businessSmartyMatchOffices(this.lastValue);return 0<a.length?e.template.render("flightBusinessOffices",{businessOfficesHeader:this.options.businessOfficesHeader,
offices:a}):""}},isDisabledHistoryPreview:function(){return this.options.disableHistoryPreview},makeRecentList:function(a,b){if(this.options.isBusinessMode)return"";if(this.options.smartyControlGroup){var c=this.options.smartyControlGroup.getHistory();if(c){var d=this.options.smartyControlGroup.getMaxHistory(),e="origin"===this.elementNode.name,g="destination"===this.elementNode.name,k=this.options.smartyControlGroup.isRoundTrip();a=l.trim(a);var d=""===a?d:3,f;g&&(f=l(this.options.smartyControlGroup.options.originCode).val());
c=c.filter(a,e,d,k,f);g="";for(k=0;k<c.length;k++){f=c[k];var d=this.isSmartyUIV1()?f.departAirportName:f.departShortName,n=this.isSmartyUIV1()?f.destAirportName:f.destShortName,m=!1;k===c.length-1&&(m=!0);g=e?g+this.generateSmartyItem(this.matchAndBold(a,d),n,f.startDate,f.endDate,f.idx,f.isRoundTrip,f.isPast,m):g+this.generateSmartyItem(d,this.matchAndBold(a,n),f.startDate,f.endDate,f.idx,f.isRoundTrip,f.isPast,m)}return g=""!==g?(b?"\x3cul\x3e":"")+this.generateRecentHeader()+g+(b?"\x3c/ul\x3e":
""):null}}},generateSmartyItem:function(a,b,c,d,h,g,k,f){c=new moment(c);d=new moment(d);k=k?"past":"";f=f?" last":"";var l=g?"doubleArrow":"singleArrow";g=g?" - "+d.format(this.options.smartyControlGroup.options.endFormat):"";d='\x3cli tabindex\x3d"0" class\x3d"hist '+f+'" data-history-idx\x3d"'+h+'"\x3e\x3cspan class\x3d"smartyRecentAirports"\x3e'+a+'\x3cspan class\x3d"arrow '+l+'"\x3e\x3c/span\x3e'+b+'\x3c/span\x3e\x3cspan class\x3d"smartyRecentDate '+k+'"\x3e'+c.format(this.options.smartyControlGroup.options.startFormat)+
g+"\x3c/span\x3e\x3c/li\x3e";this.isSmartyUIV1()&&(a="\x3cdiv class\x3d'airports'\x3e%s\x3c/div\x3e".format('\x3cspan class\x3d"smartyRecentAirports"\x3e'+a+'\x3cspan class\x3d"arrow '+l+'"\x3e\x3c/span\x3e'+b+"\x3c/span\x3e"),b="\x3cdiv class\x3d'dates'\x3e%s\x3c/div\x3e".format('\x3cspan class\x3d"smartyRecentDate '+k+'"\x3e'+c.format(this.options.smartyControlGroup.options.startFormat)+g+"\x3c/span\x3e"),d='\x3cli tabindex\x3d"0" class\x3d"hist '+f+'" data-history-idx\x3d"'+h+'"\x3e\x3cdiv class\x3d"icon-wrapper"\x3e'+
e.template.render("smartyFlightHistorySVG")+'\x3c/div\x3e\x3cdiv class\x3d"search-info"\x3e%s\x3c/div\x3e\x3c/li\x3e'.format(a+b));return d},generateLoginBar:function(a){if(this.options.isBusinessMode)return"";var b="";if(!this.options.smartyControlGroup||this.isSmartyUIV1()&&a)return"";var c="admin";a&&(c+=" addSeparation");"notloggedin"===e.globals.analytics.loginState?(b+="\x3cli tabindex\x3d'0' class\x3d'signupnow "+c+"'\x3e"+this.options.messages.loginForSearchHistory+"\x3c/li\x3e",this.isSmartyUIV1()&&
(b=e.template.render("smartySignUpIn",{extraClasses:c}))):b+="\x3cli tabindex\x3d'0' class\x3d'showHistory "+c+"'\x3e"+(this.isSmartyUIV1()?'\x3cdiv class\x3d"icon-wrapper"\x3e'+e.template.render("smartyHistorySVG")+"\x3c/div\x3e":"")+this.options.messages.seeAllSearchHistory+"\x3c/li\x3e";return b},selectItem:function(a,b){l(a).is(".sign-up-in")||this.base(a,b)},generateAnywhereMarkup:function(a){if(this.options.isBusinessMode)return"";var b="",c=this.element.val().trim().toLocaleLowerCase(),d=this.options.messages?
this.options.messages.anywhere:null,h="",c=this.options.showAnywhere&&(this.options.disableAnywhereDirtyCheck||!this.isDirty||""===c||d&&0===d.toLocaleLowerCase().indexOf(c)&&2<c.length),g=this.options.smartyControlGroup&&!this.options.smartyControlGroup.isRoundTrip(),k=e.config.getBoolean("ui.smarty.anywhere.oneWay",!1);if(c||this.options.alwaysShowAnywhere){if(g&&!k)return b;e.config.getBoolean("ui.smarty.anywhereFirst",!1)&&/ - /.test(d)&&[].map&&(d=d.split(" - ").map(function(a){return"\x3cdiv\x3e"+
a+"\x3c/div\x3e"}).join(""),h+=" split ");b+="\x3cli tabindex\x3d'0' data-short-name\x3d'anywhere' class\x3d'anywhere admin "+h+(a?"addSeparation":"")+"'\x3e"+d+"\x3c/li\x3e";this.isSmartyUIV1()&&(this.isDestinationImagesEnabled()&&(h+=" dimg"),b=e.template.render("anywhereMarkUp",{extraClasses:h+(a?" addSeparation":"")}))}return b},generateAirportMultiSelectHeader:function(a){return e.template.render("airportMultiSelectHeader",{id:this.id("airportMultiSelectHeader"),maxMessageVisible:!this.options.allowAddAirportMultiSelection(),
selectedTitle:a,suggestedTitle:!a})},generateAirportMultiSelections:function(){var a=this,b=this.options.getAirportMultiSelections();if(!b||!b.length)return"";var c=this.generateAirportMultiSelectHeader(!0),b=b.map(function(b){var c={loctype:"ap",locationname:b.description||b.display,ap:b.code,airportname:"",shortdisplayname:b.display,smartyDisplay:b.description};return e.template.render("airportMultiSelectItem",{ariaLabel:b.display,iconHtml:a.getSvgIcon({loctype:"ap"}),displayNameHtml:a.getDisplayNameHtml(c),
airportCodeCheckboxHtml:a.getAirportCodeHtml(c,!0)})}).join("");return[c,'\x3cul role\x3d"listbox"\x3e',b,"\x3c/ul\x3e"].join("")},handleInputValue:function(){this.isDirty=!0;this.options.onInputChange();this.base()},setItem:function(a,b){if("custom"===a.type)e.events.publish("smarty.setitem.complete",{id:this.element.attr("id")});else if(a&&"easter"===a.type)e.events.publish("smarty.easteregg.found",l.extend(a,{vertical:"flights"})),this.element.val(""),this.element.trigger("textchange");else{if(e.config.getBoolean("ui.smarty.flights.logCityVsAp",
!0)){var c=a.hasOwnProperty("type")&&"city"===a.type?"city":"airport";e.Analytics.api.trackEvent({category:this.loggingPrefix,action:"click",label:c,value:(a.short_str||a.str||"").replace(/\s+/g,"-")})}this.airportMultiSelectActive&&a.isMetroCode&&this.toggleSubAirportMultiCheckboxes(!0);a.lat&&a.long&&(this.element.attr("data-lat",a.lat),this.element.attr("data-long",a.long));this.base(a,b)}},stopInputProcessing:function(){e.common.widgets.smarty.Smarty.prototype.stopInputProcessing.apply(this,arguments)},
makeHTML:function(a){if(!this.isJsonResponse(a))return this.options.isBusinessMode&&(a='\x3cul role\x3d"listbox" class\x3d"flight-smarty"\x3e'+this.makeBusinessOfficeList()+"\x3c/ul\x3e"),this.base(a);var b=this,c=this.getRequestData(),d=c&&c.value||"",h=e.config.getInt("ui.smarty.json.itemLimit",-1),g=this.makeRecentList(d,!0),k="function"===typeof a.map&&a.length,c=this.airportMultiSelectActive?this.generateAirportMultiSelectHeader(!1):"",f="";if(k)var l=a.some(function(a){return a&&"ap"===a.loctype&&
b.isCheckedMetroCode(a.ap||a.airportcode,a.airportname)}),f=f+a.map(function(a,c){if(0<h&&c>=h)return null;l&&a&&"ap"===a.loctype&&a.sub&&(a.selectedMetroCodeMember=!0);return b.formatItem(a,d)}).filter(function(a){return!!a}).join("");this.options.isBusinessMode?(a=this.makeBusinessOfficeList(),f+=a||""):(f=f+(g||"")+(this.isSmartyUIV1()?this.generateAnywhereMarkup(k?a.length:0):""),f+=this.generateLoginBar(!0));return""!==f?c+'\x3cul role\x3d"listbox" class\x3d"flight-smarty"\x3e'+f+"\x3c/ul\x3e":
""},canShowDropdown:function(a){var b=a;this.options.showAnywhere&&this.isSmartyUIV1()&&(b=a||[]);return b},getDestinationImages:function(a){if(!this.isDestinationImagesEnabled())return null;switch(a.loctype){case "ap":case "apnc":return this.createDestinationImageNode(a);default:return this.base(a)}},originalUseNearby:null,toggleNearbyAllowed:function(a){null===this.originalUseNearby&&(this.originalUseNearby=!!this.options.useNearby);this.options.useNearby=a?this.originalUseNearby:!1},isNearbyEnabled:function(){return this.options.useNearby},
hideNearbyCheckbox:function(){this.getChildElement("nearby").remove()},toggleMultiCheckboxEnabled:function(a){this.dropdown.find(".js-multi-select-message").prop("hidden",a).removeClass("multiAirportSelectionsHeader__message--error");this.dropdown.find(".js-multi-select-checkbox-input").not(":checked").prop("disabled",!a)},highlightMultiCheckboxMessage:function(){this.dropdown.find(".js-multi-select-message").addClass("multiAirportSelectionsHeader__message--error")},toggleMultiCheckbox:function(a,
b){a=this.dropdown.find('.js-multi-select-checkbox-input[data-value\x3d"'+a+'"]');a.prop("checked",b);this.isMetroCodeCheckbox(a)&&this.toggleSubAirportMultiCheckboxes(!1)},showAirportMultiSelections:function(){this.showInitialDropdownForData(this.generateAirportMultiSelections());this.isNearbyEnabled()&&this.addNearby()},runSearchOnFocus:function(){return this.airportMultiSelectActive?!1:this.base()},handleItemClickEvent:function(a,b){var c=l(b.target);c.is(".js-multi-select-container, .js-not-selectable")?
b.stopPropagation():c.is(".js-multi-select-checkbox")?(b.preventDefault(),b.stopPropagation(),this.handleAirportMultiCheckboxToggle(c)):this.base(a,b)},getAirportCodeHtml:function(a,b){if(!this.options.airportMultiSelectEnabled)return this.base(a);if("ap"!==a.loctype&&"apnc"!==a.loctype)return"";var c=a.ap||a.airportCode,d=["multiAirportCheckbox",c,Math.floor(100*Math.random())].join("-");a.shortdisplayname&&a.smartyDisplay||this.log.errorInternal("AirportMultiSelect checkbox is missing destination metadata");
return e.template.render("airportMultiSelectCol",{value:c,uniqueId:this.id(d),checked:b||a.selectedMetroCodeMember||this.options.hasAirportMultiSelectionCode(a.ap||a.airportCode),disabled:a.selectedMetroCodeMember,display:a.shortdisplayname,description:a.smartyDisplay})},airportMultiSelectActive:!1,getAirportMultiSelectActive:function(){return this.airportMultiSelectActive},originalForceSelection:null,originalForceSelectionOfHighlightedItem:null,setAirportMultiSelectActive:function(a){this.airportMultiSelectActive=
a;null===this.originalForceSelection&&(this.originalForceSelection=this.options.forceSelection);null===this.originalForceSelectionOfHighlightedItem&&(this.originalForceSelectionOfHighlightedItem=this.options.forceSelectionOfHighlightedItem);a?(a=this.generateAirportMultiSelectHeader(!0),this.getChildElement("nearby").replaceWith(a),this.dropdown.find("li").not(".ap, .apnc").remove(),this.options.forceSelection=!1,this.options.forceSelectionOfHighlightedItem=!1):this.options.useNearby&&(this.getChildElement("airportMultiSelectHeader").remove(),
this.addNearby(),this.options.forceSelection=this.originalForceSelection,this.options.forceSelectionOfHighlightedItem=this.originalForceSelectionOfHighlightedItem)},isMetroCodeCheckbox:function(a){return a.parentsUntil("ul","li.aap").length},toggleSubAirportMultiCheckboxes:function(a){var b=this,c=this.dropdown.find("li.sub .js-multi-select-checkbox-input");c.each(function(){var a=l(this).data("value");b.options.onRemoveAirportMultiSelection(a)});c.prop("checked",a).prop("disabled",a)},handleAirportMultiCheckboxToggle:function(a){var b=
a.siblings("input");if(b.prop("disabled"))this.highlightMultiCheckboxMessage();else{var c=!b.prop("checked");b.prop("checked",c);b.off("click").on("click",function(){return!1});b=a.data("value");if(c)this.options.onAddAirportMultiSelection(b,a.data("display"),a.data("description"),"checkbox");else this.options.onRemoveAirportMultiSelection(b,"checkbox");this.isMetroCodeCheckbox(a)&&this.toggleSubAirportMultiCheckboxes(c);this.element.focus()}},isCheckedMetroCode:function(a,b){return this.options.airportMultiSelectEnabled&&
this.options.allAirportsLocalizedText===b&&this.options.hasAirportMultiSelectionCode(a)},onDocumentClicked:function(){if(!this.isSmartyActiveElement()){if(this.options.forceSelection)this.onForceSelection();this.base()}}})})(window.R9,window.jq||window.jQuery);(function(d,h){d.createWidgetClass("smarty.FlareSmarty","common.widgets.smarty.FlareSmartyBaseLoader",{constructor:function(a,b){this.base(a,h.extend({dataSource:"/f/smarty",appendTo:"body"},b))},init:function(){d.common.widgets.smarty.Smarty.prototype.init.apply(this,arguments)},showDropdown:function(){d.common.widgets.smarty.Smarty.prototype.showDropdown.apply(this,arguments)},translateItem:function(a){var b=d.Widgets.Smarty.FlareSmarty.prototype.translateItem.call(this,a);(a=h(a).data("attr"))&&
(b=h.extend(b,a));return b},setItem:function(){d.common.widgets.smarty.Smarty.prototype.setItem.apply(this,arguments)},handleItemClickEvent:function(a,b){this.isSmartyUIV1()?h(a).hasClass("sign-up-in")?(this.openSignUpInPopup(h(b.target).hasClass("sign-up")),this.hideDropdown()):this.base(a,b):this.base(a,b)},getDataSource:function(){return this.isSmartyUIV1()?d.config.getString("ui.common.smarty.get.url",this.options.dataSource):this.base()},postprocessResponse:function(a,b){return this.isJsonResponse(a)?
d.common.widgets.smarty.Smarty.prototype.postprocessResponse.call(this,a,b):this.base(a,b)},makeHTML:function(a){return this.isJsonResponse(a)?d.common.widgets.smarty.Smarty.prototype.makeHTML.call(this,a):this.base(a)},getMaxItemsToShow:function(){return d.config.getInt("ui.smarty.json.itemLimit",-1)},openSignUpInPopup:function(a){a?d.authentication.showSignup():d.authentication.showLogin()},isSmartyUIV1:function(){return this.isJSON()&&this.options.smartyUIUpdateEnabled},isDestinationImagesEnabled:function(){return this.isSmartyUIV1()&&
d.config.getBoolean("ui.smarty.destinationimages.enabled",!1)},formatItem:function(a,b){if(!this.isSmartyUIV1())return this.base(a,b);var c=a.cc&&"ctry"===a.loctype&&d.config&&d.config.getBoolean("ui.smarty.hideCountryFeatures."+a.cc,!1);if(!a||!a.loctype)return"";b=this.getItemAttrs(a);var g=this.getDisplayNameHtml(a),e=this.getAirportCodeHtml(a),g=g+e,e=a.loctype||"city";"cg"===e&&(e="ctgroup");c&&(e+=" noBackgroundIcon");"ap"!==a.loctype&&"apnc"!==a.loctype||this.options.allAirportsLocalizedText!==
a.airportname||(e+=" aap");c=['role\x3d"option"','tabindex\x3d"0"','data-short-name\x3d"'+(b.shortName||"")+'"','data-text-to-select\x3d"'+(b.displayName||"")+'"'];b.hasOwnProperty("apicode")?c.push("data-apicode\x3d"+b.apicode):"rail"===a.loctype&&b.hasOwnProperty("ap")&&c.push("data-apicode\x3d"+b.ap);var l=this.getDestinationImages(a);"ctry"===a.loctype&&b.icon?(c.push('style\x3d"background-image:url('+b.icon+')"'),e+=" with-icon"):g=l&&!a.sub?l+g:b.svgIcon+g;c.push('class\x3d"'+e+(a.sub?" sub":
"")+'"');e=this.formatListItemId(a);this.addItemAttributes(a,c);e&&c.push('id\x3d"'+e+'"');a.cc&&c.push('data-cc\x3d"'+a.cc+'"');a.rc&&c.push('data-rc\x3d"'+a.rc+'"');b.shortName&&c.push('data-short-name\x3d"'+b.shortName+'"');"addr"===a.loctype&&c.push('data-ctid\x3d"'+a.ctid+'"');b.label&&(e=this.locationTypeMessages[a.loctype],c.push('aria-label\x3d"'+(e?b.label+" - "+e:b.label)+'"'));c.push('data-attr\x3d"'+this.htmlEscape(JSON.stringify({entityKey:a.entityKey,objectID:a.objectID}))+'"');return"\x3cli "+
c.join(" ")+"\x3e"+g+"\x3c/li\x3e"},addItemAttributes:function(a,b){},formatListItemId:function(a){var b=this.getItemId(a);switch(a.loctype){case "ap":case "apnc":return[a.loctype,[a.ap||a.airportcode,a.ctid].join("/")].join("-");case "freereg":case "reg":case "ctry":return[a.loctype,0,a.nearbyHotels,b].join("-");case "hood":case "lm":return[a.loctype,a.ctid,a.nearbyHotels,b].join("-");case "ctgroup":return[a.loctype,0,0,a.cg].join("-");default:return b?[a.loctype,b].join("-"):null}},getItemAttrs:function(a){var b=
a.cc&&"ctry"===a.loctype&&d.config&&d.config.getBoolean("ui.smarty.hideCountryFeatures."+a.cc,!1),c=this.getDisplayName(a),g=this.getNearbyHotels(a),e=this.getNearbyRentals(a),c=h.extend({},a,{id:this.getItemId(a),displayName:c,label:[c,g,e].filter(function(a){return!!a}).join(" "),parentPath:a.parentPath||a.rc||"",nearbyHotels:g,nearbyRentals:e});"ap"===a.loctype||"apnc"===a.loctype?c.shortName=a.shortdisplayname||"":"city"===a.loctype?c.shortName=a.cityonly||"":"geocode"===a.loctype&&(c.shortName=
a.structured_formatting.main_text);"ctry"===a.loctype&&a.cc&&!b&&(c.icon="/images/flags/a-small-flag."+a.cc.toLowerCase()+".png");c.svgIcon=this.getSvgIcon(a);return c},getDisplayName:function(a){return"geocode"===a.loctype?a.description:this.base(a)},getItemId:function(a){if(this.isSmartyUIV1())switch(a.loctype){case "hotel":case "hood":case "lm":case "freereg":return a.id;case "addr":return a.displayname;case "rest":return a.rtid}return this.base(a)},getDisplayNameHtml:function(a){var b=a.locationname||
a.searchFormSecondary,c=a.airportname,g=a.cityname,e=a.smartyDisplay,h=a.displayname,m=a.nearbyInfo,k=this.getItemId(a),k=d.config.getBoolean("ui.smarty.hideTypeFeatures."+a.loctype+"."+k,!1),n=a.cc&&"ctry"===a.loctype&&d.config&&d.config.getBoolean("ui.smarty.hideCountryFeatures."+a.cc,!1);if("ap"===a.loctype||"apnc"===a.loctype){var f=[];"apnc"!==a.loctype&&c===this.options.allAirportsLocalizedText?f.push("\x3cdiv\x3e%s\x3c/div\x3e".format([g,c].join(", "))):(f.push("\x3cdiv\x3e%s\x3c/div\x3e".format("apnc"===
a.loctype?e||c:a.sub?c:b)),f.push("\x3cdiv\x3e%s\x3c/div\x3e".format("apnc"===a.loctype?m||b:a.sub?b:c)));return"\x3cdiv class\x3d'item-info'\x3e%s\x3c/div\x3e".format(f.join(""))}if("ctgroup"===a.loctype)return"\x3cdiv class\x3d'item-info'\x3e\x3cdiv\x3e%s\x3c/div\x3e\x3c/div\x3e".format(h);"hotel"===a.loctype?(f=[],f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(a.hotelname||a.name)),f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(g))):"geocode"===a.loctype?(f=[],f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(a.structured_formatting.main_text)),
f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(a.structured_formatting.secondary_text))):"addr"===a.loctype?(f=[],f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(a.searchFormPrimary)),f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(a.searchFormSecondary))):"rail"===a.loctype?f=["\x3cdiv\x3e%s\x3c/div\x3e".format(this.getDisplayName(a)),"\x3cdiv\x3e%s\x3c/div\x3e".format(this.locationTypeMessages[a.loctype])]:(f=[],f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(h)),n||k||f.push("\x3cdiv\x3e%s\x3c/div\x3e".format(this.locationTypeMessages[a.loctype])));
return"\x3cdiv class\x3d'item-info'\x3e%s\x3c/div\x3e".format(f.join(""))},getAirportCodeHtml:function(a,b){return"ap"===a.loctype||"apnc"===a.loctype?"\x3cdiv class\x3d'ap-code'\x3e\x3cspan\x3e"+(a.ap||a.airportcode)+"\x3c/span\x3e\x3c/div\x3e":""},getSvgIcon:function(a){var b;switch(a.loctype){case "ap":case "apnc":b="smartyFlightSVG";this.options.allAirportsLocalizedText&&a.airportname===this.options.allAirportsLocalizedText&&(b="smartyCitySVG");break;case "hotel":b="smartyHotelSVG";break;case "rail":b=
"smartyTrainSVG";break;case "city":b="smartyCitySVG";break;case "ctgroup":b=this.getCtGroupIcon(a);break;default:b="smartyMapSVG"}return"\x3cdiv class\x3d'smarty-icon-wrapper'\x3e"+d.template.render(b)+"\x3c/div\x3e"},getDestinationImages:function(a){if(!this.isDestinationImagesEnabled())return null;switch(a.loctype){case "city":case "ctry":case "reg":case "freereg":case "lm":case "hood":return this.createDestinationImageNode(a)}return null},createDestinationImageNode:function(a){a=a.destination_images;
return a.image_jpeg?a.image_webp?'\x3cdiv class\x3d"destination-images"\x3e\x3cdiv class\x3d"img-wrapper"\x3e\x3cpicture\x3e'+'\x3csource srcset\x3d"%s" type\x3d"image/webp"\x3e'.format(a.image_webp)+'\x3csource srcset\x3d"%s" type\x3d"image/jpeg"\x3e'.format(a.image_jpeg)+'\x3cimg src\x3d"%s" onerror\x3d"this.style.display\x3d\'none\'" onload\x3d"this.style.opacity\x3d1" alt\x3d""/\x3e'.format(a.image_jpeg)+"\x3c/picture\x3e\x3c/div\x3e\x3c/div\x3e":'\x3cdiv class\x3d"destination-images"\x3e\x3cdiv class\x3d"img-wrapper"\x3e'+
'\x3cimg src\x3d"%s" onerror\x3d"this.style.display\x3d\'none\'" onload\x3d"this.style.opacity\x3d1" alt\x3d""/\x3e'.format(a.image_jpeg)+"\x3c/div\x3e\x3c/div\x3e":null},getCtGroupIcon:function(a){switch(a.cg){case "AS":case "AF":case "EU":case "NA":case "SA":case "SP":case "CB":case "ME":return"smartyCtGroup"+a.cg;default:return"smartyCtGroup"}},generateContinentsMarkup:function(){var a="",b=this.options.continents;0<b.length&&this.options.showContinents&&(a+='\x3cdiv class\x3d"separator continents-separator"\x3e\x3cspan class\x3d"separatorLabel"\x3e'+
this.options.messages.SMARTY_CONTINENTS_LABEL+"\x3c/span\x3e\x3c/div\x3e",b.forEach(function(b){a+='\x3cli  id\x3d"continent-'+b.id+'" class\x3d"continent '+b.id+'" tabindex\x3d"0" \x3e'+b.message+"\x3c/li\x3e"}));return a}})})(window.R9,window.jq||window.jQuery);(function(g,k){function h(a){return/[A-Z]{3}/.test(a)}function l(a){if(!a)return[];a=a.split(",").map(function(a){return a.trim()});return 1<a.length&&a.every(h)?a:[]}function e(a){return a.trim().toUpperCase().split("/")[0]}g.createComponentClass("flights.search.FlightAirportField",{options:{airportMultiSelectEnabled:!1,airportFlareSmartyType:13,initialAirportMultiSelections:[],onChangeAirportMultiSelection:function(a,b){},onDisableNearbyToggle:function(){}},inputEl:null,codeEl:null,smarty:null,
inputModal:null,airportMultiSelections:[],airportMultiSelectVisible:!1,init:function(){this.inputEl=this.getChildElement("airport");this.codeEl=this.getChildElement("code")},addEventHandlers:function(){},inlineComponentsReady:function(){this.inputModal=this.inputEl.data("inputModal");this.smarty=this.inputEl.getWidget();this.options.airportMultiSelectEnabled&&(this.inputModal&&this.initAirportMultiSelectInput(),this.smarty&&this.bindAirportMultiSelectSmarty())},setOptions:function(a){k.extend(this.options,
a)},val:function(){if(arguments.length&&void 0!==arguments[0]&&null!==arguments[0]&&!this.airportMultiSelectVisible)this.setValue(arguments[0]);else return this.getValue()},code:function(){if(arguments.length&&void 0!==arguments[0]&&null!==arguments[0]&&!this.airportMultiSelectVisible)this.setCode(arguments[0]);else return this.getCode()},getSmarty:function(){return this.smarty||this.inputEl.getWidget()},getValue:function(){return this.airportMultiSelectVisible?this.getAirportMultiSelectValue():this.inputEl.val()},
setValue:function(a){this.inputEl.val(a)},getCode:function(){return this.codeEl.val()},setCode:function(a){this.codeEl.val(a)},initAirportMultiSelectInput:function(){this.inputModal.onRemoveMultiSelection=this.removeAirportMultiSelection.bind(this);this.inputModal.onToggleMultiSelectVisibility=this.toggleAirportMultiSelectVisible.bind(this);if(this.options.initialAirportMultiSelections.length)this.addAirportMultiSelections(this.options.initialAirportMultiSelections);else{var a=l(this.getValue()),
b=e(this.getCode());a.length?a.forEach(function(a){this.addAirportMultiSelection(a)},this):h(b)&&this.addAirportMultiSelection(b,this.getValue())}},bindAirportMultiSelectSmarty:function(){this.smarty.setOptions({onAddAirportMultiSelection:this.addAirportMultiSelection.bind(this),onRemoveAirportMultiSelection:this.removeAirportMultiSelection.bind(this),getAirportMultiSelections:this.getAirportMultiSelections.bind(this),hasAirportMultiSelectionCode:this.hasAirportMultiSelectionCode.bind(this),allowAddAirportMultiSelection:this.allowAddAirportMultiSelection.bind(this),
onInputValueChange:this.onInputValueChange.bind(this),airportMultiSelectEnabled:!0})},originalFlareSmartyType:null,toggleAirportMultiSelectVisible:function(a){(this.airportMultiSelectVisible=a)?(this.originalFlareSmartyType=this.smarty.getFlareSmartyType(),this.smarty.setFlareSmartyType(this.options.airportFlareSmartyType),this.smarty.setAirportMultiSelectActive(!0)):(this.smarty.setFlareSmartyType(this.originalFlareSmartyType),this.smarty.setAirportMultiSelectActive(!1),this.setValue(""));this.toggleNearbyAllowed(!a||
2>this.airportMultiSelections.length)},onInputValueChange:function(a){if(this.airportMultiSelectVisible&&this.smarty){var b=1===this.airportMultiSelections.length,c=this.smarty.isNearbyEnabled();b&&c&&a.length?this.smarty.toggleNearbyAllowed(!1):!b||c||a.length||this.smarty.toggleNearbyAllowed(!0)}},toggleNearbyAllowed:function(a){this.smarty&&(this.smarty.toggleNearbyAllowed(a),a||(this.smarty.setIsNearbyChecked(!1),this.smarty.hideNearbyCheckbox(),this.options.onDisableNearbyToggle()))},getAirportMultiSelectValue:function(){return this.getAirportMultiSelectionCodes().join(",")},
refreshAirportMultiSelectValue:function(){this.setValue("");this.setCode(this.getAirportMultiSelectValue())},allowAddAirportMultiSelection:function(){return 3>this.airportMultiSelections.length},pendingMultiSelectAdditions:0,addAirportMultiSelections:function(a){a&&(this.pendingMultiSelectAdditions=a.length,a.forEach(function(a){this.addAirportMultiSelection(a.code,a.display,a.description)},this))},addAirportMultiSelection:function(a,b,c,d){if(a&&this.allowAddAirportMultiSelection()){var f=e(a);this.getAirportMultiSelectionCodes().some(function(a){return a===
f})||(a=this.airportMultiSelections.length?"multi":"single",b=b||f,this.airportMultiSelections.push({code:f,display:b,description:c}),0<this.pendingMultiSelectAdditions&&--this.pendingMultiSelectAdditions,this.refreshAirportMultiSelectValue(),this.options.onChangeAirportMultiSelection(this.getAirportMultiSelectValue(),d),this.toggleNearbyAllowed(2>this.airportMultiSelections.length),this.inputModal&&(this.inputModal.toggleMultiSelectionCompactLayout(1<this.airportMultiSelections.length+this.pendingMultiSelectAdditions),
this.inputModal.addMultiSelection(f,b),this.allowAddAirportMultiSelection()||this.inputModal.toggleInputVisibility(!1)),this.smarty&&!this.allowAddAirportMultiSelection()&&this.smarty.toggleMultiCheckboxEnabled(!1),d&&this.trackAirportMultiSelect("add",d,a))}},removeAirportMultiSelection:function(a,b){var c=e(a),d=this.getAirportMultiSelectionCodes().findIndex(function(a){return a===c});0>d||(a=1>=this.airportMultiSelections.length?"single":"multi",this.airportMultiSelections.splice(d,1),this.refreshAirportMultiSelectValue(),
this.options.onChangeAirportMultiSelection(this.getAirportMultiSelectValue(),b),this.toggleNearbyAllowed(2>this.airportMultiSelections.length),this.inputModal&&(d=2===this.airportMultiSelections.length,this.inputModal.removeMultiSelection(c,d),this.inputModal.toggleMultiSelectionCompactLayout(1<this.airportMultiSelections.length),this.allowAddAirportMultiSelection()&&this.inputModal.toggleInputVisibility(!0,d&&250)),this.smarty&&this.allowAddAirportMultiSelection()&&(this.smarty.toggleMultiCheckboxEnabled(!0),
this.smarty.toggleMultiCheckbox(c,!1)),b&&this.trackAirportMultiSelect("remove",b,a))},resetAirportMultiSelect:function(){this.airportMultiSelections.length&&(this.airportMultiSelections=[],this.inputModal&&this.inputModal.resetMultiSelection())},getAirportMultiSelections:function(){return this.airportMultiSelections.slice()},getAirportMultiSelectionCodes:function(){return this.airportMultiSelections.map(function(a){return a.code})},hasAirportMultiSelectionCode:function(a){var b=e(a);return this.airportMultiSelections.some(function(a){return a.code===
b})},trackAirportMultiSelect:function(a,b,c){g.Analytics.api.trackEvent({category:"airportMultiSelect",action:a,label:b,value:c})},focusInput:function(){this.inputModal&&this.inputModal.focus()}})})(window.R9,window.jQuery);(function(a,e){a.createComponentClass("flights.search.OdSwitch",{options:{animated:!1,showFocusIndication:!1,focusedElementClass:""},arrowDirection:1,init:function(){this.arrows=this.element.find("svg")},flipArrows:function(){var a=0<this.arrowDirection?"rotate(180deg)":"none";this.arrowDirection*=-1;this.arrows.css("transform",a)},addEventHandlers:function(){var c=this,d=function(){a.Analytics.api.trackEvent({category:"od-switch",action:"click"});a.events.publish("flights.search.swapLocations",{id:this._id});
this.options.animated&&a.dom.schedule(this.flipArrows.bind(this))}.bind(this);this.registerEvent("click",function(a){e(this).blur();d()});this.registerEvent("keypress",function(b){switch(b.which){case a.globals.keyCodes.SPACE:case a.globals.keyCodes.RETURN:b.preventDefault(),d()}});this.subscribe("flights.search.form.sticky.toggle",function(b){this.options.isStickyEnabled&&(b?a.dom.swapClasses(this.element,this.options.styleJamParams.defaultOdResponsive,this.options.styleJamParams.stickyOdResponsive):
a.dom.swapClasses(this.element,this.options.styleJamParams.stickyOdResponsive,this.options.styleJamParams.defaultOdResponsive))}.bind(this));this.options.showFocusIndication&&this.subscribe("body.accessibilityMode.enabled",function(b){b?a.dom.swapClasses(c.element,"",c.options.focusedElementClass):a.dom.swapClasses(c.element,c.options.focusedElementClass,"")})}})})(R9,jQuery);(function(b,c){b.createWidgetClass("datepicker.FlexDateDisplay",{options:{group:"",updateGroup:"",msg:{OPEN_FLEX_DURATION_FORMAT:""},rising:!1},input:null,init:function(){this.input=this.getChildElement("input")},addEventHandlers:function(){var a=this;this.subscribe("DatePicker.update",{updateGroup:this.options.updateGroup},this.onDatePickerUpdate.bind(this));this.input.click(function(){b.events.publish("DateInput.startDate.focus",a.options.group)});this.options.rising&&(this.subscribe("DateRangeInput.opened",
this.options.group,function(){a.element.addClass("parentFocused")}),this.subscribe("DateRangeInput.closed",this.options.group,function(){a.element.removeClass("parentFocused")}))},onDatePickerUpdate:function(a){if(a.flex&&a.group&&a.group===this.options.group)switch(a=a.data,this.element.removeClass("empty"),a.flex_category){case "weekend":this.input.html("%s \x26ndash; %s".format(a.weekend_depart_time_display,a.weekend_return_time_display));break;case "openflex":a.openflex_length_of_stay?this.input.html(b.Common.Utils.String.formatChoice(this.options.msg.OPEN_FLEX_DURATION_FORMAT,
"1"==a.openflex_length_of_stay?1:2,a.openflex_length_of_stay)):(this.element.addClass("empty"),this.input.html(this.options.msg.OPEN_FLEX_DURATION_PLACEHOLDER));break;default:this.input.html("")}}})})(R9,jQuery);(function(c,e){c.createWidgetClass("datepicker.StyleJamDateInput",{options:{placeholder:"",displayFormat:"ddd M/D",inputFormat:"MM/DD/YYYY",field:"startDate",group:"",updateGroup:"",isoDate:"",rising:!1,change:null,wrapper:null,minDateFunc:null,flexDisplayEnabled:!1,responsive:!1,responsiveMobileOnly:!0,optional:!1,elementFocused:null,elementBlurred:null,inputFull:null,inputEmpty:null,spinners:!1,showFocusIndication:!1,showToolTipImmediately:!1,focusedElementClass:"",mwebOrTweb:!1,noDateSetup:!1,
isValid:null},inputElement:null,date:null,previewDate:null,now:null,maxDate:null,minDate:null,tempDate:null,inModal:!1,inSticky:!1,flexDisplay:null,clearIcon:null,focusData:null,Keys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,RETURN:13,PAGE_UP:33,PAGE_DOWN:34,SPACE:32,HOME:36,SHIFT:16,END:35,ESC:27},currentEvent:null,focusTriggered:!1,init:function(){this.focusData={data:null,triggering:!1};this.inputElement=this.getChildElement("input");this.inModal=1===this.element.closest(".R9-Overlay").length;this.inSticky=
1===this.element.closest(".R9-Sticky").length;this.now=moment().startOf("day");this.maxDate=moment().add(1,"year");this.flexDisplay=this.getChildElement("flexDisplay");if(!this.options.noDateSetup){var a=moment(this.options.isoDate);this.validateDate(a)?this.setDate(a.valueOf()):this.showPlaceholder()}this.options.spinners&&(this.decSpinner=this.getChildElement("spinner-dec"),this.incSpinner=this.getChildElement("spinner-inc"));this.options.optional&&(this.clearIcon=this.getChildElement("clear"))},
inlineComponentsReady:function(){var a=moment(this.options.isoDate);!this.options.noDateSetup&&this.validateDate(a)&&this.afterSetDate(a.valueOf());this.options.optional&&(a=this.clearIcon.data("message"))&&this.clearIcon.toolTip({content:a,showImmediately:this.options.showToolTipImmediately,position:"bottom",size:"s",delay:1E3})},addEventHandlers:function(){var a=this;this.subscribe("DatePicker.update",{updateGroup:this.options.updateGroup},this.onDatePickerUpdate.bind(this));this.subscribe("DateInput.%s.focus".format(this.options.field),
this.options.group,function(){a.focus()});this.registerEvent("focus",this.inputElement,this.handleFocusEvent.bind(this));this.registerEvent("blur",this.inputElement,function(b){a.onBlur.call(a,this,b)});this.registerEvent("keydown",this.inputElement,function(b){a.onKeydown.call(a,this,b)});this.registerEvent("keyup",this.inputElement,function(b){a.onKeyup(this,b)});this.registerEvent("click",this.element,function(b){e(b.target).is("#"+a.id("input"))||a.inputElement.focus()});this.answer("DateInput.%s.%s".format(this.options.group,
this.options.field),this.getInputData.bind(this));this.options.optional&&this.clearIcon&&this.registerEvent("click",this.clearIcon,function(){a.onClearIconClick()});this.options.spinners&&(this.bindSpinners(),this.options.showFocusIndication&&this.subscribe("body.accessibilityMode.enabled",function(b){b?(c.dom.swapClasses(a.decSpinner,"",a.options.focusedElementClass),c.dom.swapClasses(a.incSpinner,"",a.options.focusedElementClass)):(c.dom.swapClasses(a.decSpinner,a.options.focusedElementClass,""),
c.dom.swapClasses(a.incSpinner,a.options.focusedElementClass,""))}))},bindSpinners:function(){var a=function(a){this.publishUpdate({action:"change",currentValue:this.getDate(),delta:a,field:this.options.field,picking:this.options.field,spinner:!0,force:!0});c.Analytics.api.trackEvent({category:this.options.field,label:"arrow",action:"click",value:0<a?"inc":"dec"})};this.incSpinner&&(this.registerEvent("click",this.incSpinner,a.bind(this,1)),this.registerEvent("keydown",this.incSpinner,this.handleKeyboardSpinner.bind(this,
this.incSpinner)));this.decSpinner&&(this.registerEvent("click",this.decSpinner,a.bind(this,-1)),this.registerEvent("keydown",this.decSpinner,this.handleKeyboardSpinner.bind(this,this.decSpinner)))},handleKeyboardSpinner:function(a,b){switch(a.which){case this.Keys.SPACE:case this.Keys.RETURN:a.preventDefault();b.click();break;case this.Keys.TAB:this.onKeydown.call(this,b,a)}},handleFocusEvent:function(a){this.focusTriggered=!0;this.focusData.refocus||this.onFocus.call(this,this.inputElement[0],a,
this.focusData.data);this.focusData.triggering=!1;this.focusData.data=null;delete this.focusData.refocus},getInputData:function(){var a={offset:this.element.offset(),height:this.element.outerHeight(),value:this.getValue()};this.options.wrapper&&(a.wrapper="#%s".format(this.options.wrapper));return a},onDatePickerUpdate:function(a){if(a&&a.group===this.options.group&&a.fields&&a.fields.hasOwnProperty(this.options.field))switch(a.action){case "change":this.receiveDateChange(a);break;case "preview":this.receiveDatePreview(a);
break;case "focus":this.options.group===a.group&&(this.focusData={data:a,triggering:!0},this.focus());this.toggleInputFocused(!0);break;case "blur":this.showDate();this.toggleInputFocused(!1);c.events.publish("DateInput.%s.onBlur".format(this.options.field),this.options.group);a.tabForward&&(this.focusData={refocus:!0},this.options.spinners?this.incSpinner.focus():this.focus());break;case "flex":this.options.flexDisplayEnabled&&this.receiveFlexChange(a)}},focus:function(){var a=this;this.focusTriggered=
!1;this.isTouchDevice()?window.setTimeout(function(){a.inputElement.trigger("focus")},200):(this.inputElement.trigger("focus"),!1===this.focusTriggered&&this.options.phoenixRising&&c.globals.isSeo&&this.handleFocusEvent())},isTouchDevice:function(){return"ontouchstart"in window||navigator&&0<navigator.maxTouchPoints},onFocus:function(a,b,d){var g=this;this.options.mwebOrTweb&&g.hideKeyboard(this.inputElement);b="input";d&&d.format&&(b=d.format);"function"===typeof this.options.minDateFunc&&this.options.minDateFunc.call(this,
this);this.focusData.triggering||setTimeout(function(){g.summonDatePicker()},100);(d=this.getValue())&&this.showDate(d,b);"input"!==b||this.isPlaceholder||this.selectAll(a);this.toggleInputFocused(!0);c.dom.swapClasses(this.inputElement,this.options.inputEmpty,this.options.inputFull);c.events.publish("DateInput.%s.onFocus".format(this.options.field),this.options.group)},hideKeyboard:function(a){a.attr("contenteditable","false");setTimeout(function(){a.blur();a.attr("contenteditable","true")},100)},
toggleInputFocused:function(a){a?c.dom.swapClasses(this.element,this.options.elementBlurred,this.options.elementFocused):c.dom.swapClasses(this.element,this.options.elementFocused,this.options.elementBlurred)},onBlur:function(a,b){},onKeydown:function(a,b){a=moment(this.inputElement.html(),this.options.inputFormat);this.currentEvent=null;switch(b.which){case this.Keys.RETURN:this.handleKeyboardNavigationReturn(b,a);break;case this.Keys.TAB:this.handleKeyboardNavigationTab(b,a);break;case this.Keys.ESC:this.dismissDatePicker(!1,
!1,!1,!0);this.inputElement.trigger("blur");break;case this.Keys.UP:case this.Keys.RIGHT:this.handleKeyboardIncrementDate(b,a,1);break;case this.Keys.DOWN:case this.Keys.LEFT:this.handleKeyboardIncrementDate(b,a,-1)}this.isPlaceholder&&this.hidePlaceholder()},handleKeyboardNavigationTab:function(a,b){this.validateDate(b)?(this.currentEvent=a,a.shiftKey||!this.options.spinners||this.incSpinner.is(a.target)?this.publishUpdate({action:"tab",value:b.valueOf(),field:this.options.field,focused:!0,tabForward:!a.shiftKey,
tabBackward:a.shiftKey,event:a}):this.decSpinner.focus()):a.shiftKey&&"startDate"===this.options.field&&this.dismissDatePicker(!0,!0,!1,!1)},handleKeyboardNavigationReturn:function(a,b){this.currentEvent=a;a.preventDefault();this.validateDate(b)&&this.sendDateChange(b,!1,!1);this.dismissDatePicker(!1,!1,!0)},handleKeyboardIncrementDate:function(a,b,c){b=moment(b).add(c,"d");this.validateDate(b)&&(this.sendDateChange(b,!0),a.preventDefault())},onKeyup:function(a,b){b.which!==this.Keys.TAB&&b.which!==
this.Keys.SHIFT&&(a=moment(this.inputElement.html(),this.options.inputFormat,!0),this.validateDate(a)&&b.which!==this.Keys.TAB&&b.which!==this.Keys.RETURN&&this.sendDateChange(a,!0))},setDate:function(a,b){var c=moment(a);a&&this.validateDate(c)?this.date=c:null!==a&&""!==a||this.clearDate();this.afterSetDate(a,b)},afterSetDate:function(a,b){if(this.date&&this.validateDate(this.date))c.events.publish("DateInput.%s.%s.setDate".format(this.options.group,this.options.field),{date:this.date}),this.options.optional&&
this.toggleClearIcon(!1);else if(null===a||""===a)c.events.publish("DateInput.%s.%s.clearDate".format(this.options.group,this.options.field)),"endDate"===this.options.field&&this.options.optional&&this.toggleClearIcon(!0);b||this.showDate()},setMinDate:function(a){a&&this.validateDate(moment(a))&&(this.minDate=a)},clearDate:function(){this.date=null},getValue:function(){return this.date?this.date.valueOf():0},getDate:function(){return this.date?this.date.clone():null},validateDate:function(a){return a.isValid()&&
(a.isSame(this.now)||a.isAfter(this.now))&&a.isBefore(this.maxDate)&&(!this.options.isValid||this.options.isValid(a))},receiveDatePreview:function(a){var b=a.fields[this.options.field];a=this.options.field===a.picking&&!a.clear;b?this.showDate(b,"input"):this.getValue()?this.showDate(this.getValue(),a?"input":"display"):this.showPlaceholder()},receiveDateChange:function(a){var b=a.fields[this.options.field],c=this.options.field===a.picking;a.tabForward&&(this.focusData={refocus:!0},this.focus());
this.setDate(b,!0);"function"===typeof this.options.change&&this.date&&this.options.change.call(this,{field:this.options.field,date:this.date.format("YYYY-MM-DD")});this.showDate(c?"input":"display")},sendDatePreview:function(a,b,c){var d={action:"preview",date:0,field:this.options.field};a&&(d.value=a.valueOf(),b&&e.extend(d,{previous:b.valueOf()}),e.extend(d,c));this.publishUpdate(d)},receiveFlexChange:function(a){var b=a.data;switch(a.flex){case "plusminusthree":case "weekend":case "openflex":case "duration":b.inputDisplay&&
b.inputDisplay.hasOwnProperty(this.options.field)?(this.element.addClass("show-flex-display"),this.flexDisplay.html(b.inputDisplay[this.options.field]).show()):(this.element.removeClass("show-flex-display"),this.flexDisplay.html("").hide());break;default:this.element.removeClass("show-flex-display"),this.flexDisplay.html("").hide()}c.events.publish("DateInput."+this.options.group+"."+this.options.field+".flexChange",this.flexDisplay.html())},sendDateChange:function(a,b,c){this.publishUpdate({action:"change",
value:a.valueOf(),field:this.options.field,focused:!!b,tabForward:!!c,event:this.currentEvent})},publishUpdate:function(a){e.extend(a,{updateGroup:this.options.updateGroup,group:this.options.group});c.events.publish("DateInput.update",a)},summonDatePicker:function(){var a={modal:this.inModal,sticky:this.inSticky,updateGroup:this.options.updateGroup,group:this.options.group,field:this.options.field,rising:this.options.rising};this.minDate&&e.extend(a,{minDate:this.minDate});c.events.publish("DateInput.summon",
a)},dismissDatePicker:function(a,b,d,e){var f={updateGroup:this.options.updateGroup,group:this.options.group,field:this.options.field};a&&!b?(f.tabForward=!0,f.event=this.currentEvent):a&&b&&(f.tabBackward=!0);d&&(f.returnEvent=d);e&&(f.focusDisplay=!0);c.events.publish("DateInput.dismiss",f)},showDate:function(a,b){0===arguments.length?(b="display",a=this.getValue()):"string"===typeof arguments[0]?(b=a,a=this.getValue()):"undefined"===typeof b&&(b="display");a?(this.hidePlaceholder(),"input"===b?
this.inputElement.html(moment(a).format(this.options.inputFormat)):"display"===b&&this.inputElement.html(moment(a).format(this.options.displayFormat))):this.showPlaceholder()},showPlaceholder:function(){this.inputElement.html(this.options.placeholder);this.isPlaceholder=!0;c.dom.swapClasses(this.inputElement,this.options.inputFull,this.options.inputEmpty)},hidePlaceholder:function(){this.inputElement.html("");this.isPlaceholder=!1;c.dom.swapClasses(this.inputElement,this.options.inputEmpty,this.options.inputFull)},
selectAll:function(a){var b=document.createRange();b.selectNodeContents(a);a=window.getSelection();a.removeAllRanges();try{a.addRange(b)}catch(d){}},clearOptional:function(){this.clearIcon.trigger("click")},onClearIconClick:function(){var a={updateGroup:this.options.updateGroup,group:this.options.group,field:this.options.field};this.clearDate();this.dismissDatePicker();this.toggleClearIcon(!0);c.events.publish("DateInput.clear",a);c.Analytics.api.trackEvent({category:"Date-Input",action:"click",label:"clear-optional"})},
toggleClearIcon:function(a){null==this.clearIcon&&(this.clearIcon=this.getChildElement("clear"));this.clearIcon.toggleClass("hidden",a)},destroy:function(){this.base();c.events.publish("DateInput.destroy",{group:this.options.group})}})})(R9,jQuery);(function(e,f){e.createWidgetClass("datepicker.DateInput",{options:{placeholder:"",displayFormat:"ddd M/D",inputFormat:"MM/DD/YYYY",field:"startDate",group:"",updateGroup:"",isoDate:"",change:null,wrapper:null,minDateFunc:null,flexDisplayEnabled:!1,responsive:!1,responsiveMobileOnly:!1,optional:!1,notEditableInputInMobile:!1,isMobileOrTablet:!1,noDateSetup:!1},inputElement:null,date:null,previewDate:null,now:null,maxDate:null,minDate:null,tempDate:null,inModal:!1,inSticky:!1,flexDisplay:null,clearIcon:null,
focusData:null,Keys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,RETURN:13,PAGE_UP:33,PAGE_DOWN:34,SPACE:32,HOME:36,SHIFT:16,END:35,ESC:27},currentEvent:null,init:function(){this.focusData={data:null,triggering:!1};this.inputElement=this.getChildElement("input");this.inModal=1===this.element.closest(".R9-Overlay").length;this.inSticky=1===this.element.closest(".R9-Sticky").length;this.now=moment().startOf("day");this.maxDate=moment().add(1,"year");this.flexDisplay=this.getChildElement("flexDisplay");this.options.optional&&
(this.clearIcon=this.getChildElement("clear"))},inlineComponentsReady:function(){this.options.noDateSetup||(this.validateDate(moment(this.options.isoDate))?this.setDate(moment(this.options.isoDate).valueOf()):this.showPlaceholder());if(this.options.optional){var a=this.clearIcon.data("message");if(a){var b=this.clearIcon.is(":visible")&&this.options.showToolTipImmediately;this.clearIcon.toolTip({content:a,showImmediately:b,position:"bottom",size:"s",delay:b?1E3:200})}}},addEventHandlers:function(){var a=
this;this.subscribe("DatePicker.update",{updateGroup:this.options.updateGroup},this.onDatePickerUpdate.bind(this));this.subscribe("DateInput.%s.focus".format(this.options.field),this.options.group,function(){a.focus()});this.inputElement.on("focus",function(b,c){a.focusData.refocus||a.onFocus.call(a,this,b,a.focusData.data);a.focusData.triggering=!1;a.focusData.data=null;delete a.focusData.refocus});this.inputElement.on("blur",function(b){a.onBlur.call(a,this,b)});this.inputElement.on("keydown",function(b){a.onKeydown.call(a,
this,b)});this.inputElement.on("keyup",function(b){a.onKeyup.call(a,this,b)});this.element.find("[data-proxy-click]").click(function(){a.inputElement.trigger("click")});this.answer("DateInput.%s.%s".format(this.options.group,this.options.field),this.getInputData.bind(this));if(this.options.optional)this.clearIcon.on("click",function(b){a.onClearIconClick(a,this,b)})},getInputData:function(){var a={offset:this.element.offset(),height:this.element.outerHeight(),value:this.getValue()};this.options.wrapper&&
(a.wrapper="#%s".format(this.options.wrapper));return a},onDatePickerUpdate:function(a){if(a&&a.fields&&a.fields.hasOwnProperty(this.options.field)&&a.group&&a.group===this.options.group)switch(a.action){case "change":this.receiveDateChange(a);break;case "preview":this.receiveDatePreview(a);break;case "focus":this.options.group===a.group&&(this.focusData={data:a,triggering:!0},this.focus());break;case "blur":this.showDate();this.element.removeClass("focused");e.events.publish("DateInput.%s.onBlur".format(this.options.field),
this.options.group);a.tabForward&&(this.focusData={refocus:!0},this.focus());break;case "flex":this.options.flexDisplayEnabled&&this.receiveFlexChange(a)}},focus:function(){this.inputElement.trigger("focus")},onFocus:function(a,b,c){var d=this;!0===this.options.isMobileOrTablet&&!0===this.options.notEditableInputInMobile&&d.hideKeyboard(a);b="input";c&&c.format&&(b=c.format);"function"===typeof this.options.minDateFunc&&this.options.minDateFunc.call(this,this);this.focusData.triggering||setTimeout(function(){d.summonDatePicker()},
100);(c=this.getValue())&&this.showDate(c,b);"input"!==b||this.isPlaceholder||this.selectAll(a);this.element.addClass("focused");e.events.publish("DateInput.%s.onFocus".format(this.options.field),this.options.group)},hideKeyboard:function(a){a.setAttribute("contenteditable","false");setTimeout(function(){a.blur();a.setAttribute("contenteditable","true")},100)},onBlur:function(a,b){},onKeydown:function(a,b){var c=a=!1;switch(b.which){case this.Keys.RETURN:c=a=!0;this.currentEvent=b;break;case this.Keys.TAB:c=
!0;this.currentEvent=b;b.shiftKey||(a=!0);break;case this.Keys.ESC:c=!0}this.isPlaceholder&&this.hidePlaceholder();var d=moment(this.inputElement.html(),this.options.inputFormat);if(this.validateDate(d)||c)this.handleKeyboardNavigation(b,d),a&&b.preventDefault()},handleKeyboardNavigation:function(a,b){var c,d=b.clone();switch(a.which){case this.Keys.TAB:c=!1;a.shiftKey?"startDate"===this.options.field&&this.dismissDatePicker(!0,!0):this.publishUpdate({field:this.options.field,action:"tab",tabForward:!0});
break;case this.Keys.RETURN:c=!1;this.validateDate(b)?this.sendDateChange(b):this.dismissDatePicker(!1,!1,!0);break;case this.Keys.ESC:c=!1;this.dismissDatePicker(!1,!1,!0);this.inputElement.trigger("blur");break;default:c=!1}c&&this.sendDatePreview(b,d)},onKeyup:function(a,b){a=moment(this.inputElement.html(),this.options.inputFormat);this.validateDate(a)&&b.which!==this.Keys.TAB&&b.which!==this.Keys.RETURN&&this.sendDatePreview(a,this.date?this.date.clone():null,{preventUpdate:!0})},setDate:function(a,
b){if(a&&this.validateDate(moment(a)))this.date=moment(a),e.events.publish("DateInput.%s.%s.setDate".format(this.options.group,this.options.field),{date:this.date}),this.options.optional&&this.toggleClearIcon(!1);else if(null===a||""===a)this.clearDate(),"endDate"===this.options.field&&this.options.optional&&this.toggleClearIcon(!0);b||this.showDate()},setMinDate:function(a){a&&this.validateDate(moment(a))&&(this.minDate=a)},clearDate:function(){this.date=null},getValue:function(){return this.date?
this.date.valueOf():0},getDate:function(){return this.date?this.date.clone():null},validateDate:function(a){return this.hasFunctions(a,"isValid","isSameOrAfter","isBefore")?a.isValid()&&a.isSameOrAfter(this.now)&&a.isBefore(this.maxDate):!1},hasFunctions:function(){var a=Array.prototype.slice.call(arguments);return a.slice(1).reduce(function(b,c){return b&&a[0][c]&&"function"===typeof a[0][c]},!!a[0])},receiveDatePreview:function(a){var b=a.fields[this.options.field];a=this.options.field===a.picking&&
!a.clear;b?this.showDate(b,"input"):this.getValue()?this.showDate(this.getValue(),a?"input":"display"):this.showPlaceholder()},receiveDateChange:function(a){var b=a.fields[this.options.field],c=this.options.field===a.picking;a.tabForward&&(this.focusData={refocus:!0},this.focus());this.setDate(b,!0);"function"===typeof this.options.change&&this.options.change.call(this,{field:this.options.field,date:this.date.format("YYYY-MM-DD")});this.showDate(c?"input":"display")},sendDatePreview:function(a,b,
c){var d={action:"preview",date:0,field:this.options.field};a&&(d.value=a.valueOf(),b&&f.extend(d,{previous:b.valueOf()}),f.extend(d,c));this.publishUpdate(d)},receiveFlexChange:function(a){var b=a.data;switch(a.flex){case "plusminusthree":case "weekend":case "openflex":b.inputDisplay&&b.inputDisplay.hasOwnProperty(this.options.field)?(this.element.addClass("show-flex-display"),this.flexDisplay.html(b.inputDisplay[this.options.field])):(this.element.removeClass("show-flex-display"),this.flexDisplay.html(""));
break;default:this.element.removeClass("show-flex-display"),this.flexDisplay.html("")}},sendDateChange:function(a,b,c){this.publishUpdate({action:"change",value:a.valueOf(),field:this.options.field,focused:!!b,tabForward:!!c,event:this.currentEvent})},publishUpdate:function(a){f.extend(a,{updateGroup:this.options.updateGroup,group:this.options.group});e.events.publish("DateInput.update",a)},summonDatePicker:function(){var a={modal:this.inModal,sticky:this.inSticky,updateGroup:this.options.updateGroup,
group:this.options.group,field:this.options.field};this.minDate&&f.extend(a,{minDate:this.minDate});e.events.publish("DateInput.summon",a)},dismissDatePicker:function(a,b,c){var d={updateGroup:this.options.updateGroup,group:this.options.group,field:this.options.field};a&&!b?(d.tabForward=!0,d.event=this.currentEvent):a&&b&&(d.tabBackward=!0);c&&(d.focusDisplay=!0);e.events.publish("DateInput.dismiss",d)},showDate:function(a,b){0===arguments.length?(b="display",a=this.getValue()):"string"===typeof arguments[0]?
(b=a,a=this.getValue()):"undefined"===typeof b&&(b="display");0!==a?(this.hidePlaceholder(),"input"===b?this.inputElement.html(moment(a).format(this.options.inputFormat)):"display"===b&&this.inputElement.html(moment(a).format(this.options.displayFormat))):this.showPlaceholder()},showPlaceholder:function(){this.inputElement.html(this.options.placeholder);this.isPlaceholder=!0;this.element.addClass("Placeholder")},hidePlaceholder:function(){this.inputElement.html("");this.isPlaceholder=!1;this.element.removeClass("Placeholder")},
selectAll:function(a){var b=document.createRange();b.selectNodeContents(a);a=window.getSelection();a.removeAllRanges();try{a.addRange(b)}catch(c){}},clearOptional:function(){this.clearIcon.trigger("click")},onClearIconClick:function(a,b){a={updateGroup:this.options.updateGroup,group:this.options.group,field:this.options.field};this.clearDate();this.dismissDatePicker();this.toggleClearIcon(!0);e.events.publish("DateInput.clear",a);e.Analytics.api.trackEvent({category:"Date-Input",action:"click",label:"clear-optional"})},
toggleClearIcon:function(a){null==this.clearIcon&&(this.clearIcon=this.getChildElement("clear"));this.clearIcon.toggleClass("hidden",a)},destroy:function(){this.base();e.events.publish("DateInput.destroy",{group:this.options.group})}})})(R9,jQuery);(function(d,f){d.createWidgetClass("datepicker.StyleJamCalendar",{aboveCalendarContainer:null,belowCalendarContainer:null,backToTodayHeader:null,backToTodayBtn:null,months:null,currentPickerId:null,animating:!1,isOpen:!1,calId:"",monthApproxHeight:260,showOnlyOneMonth:!1,DateMode:{SINGLE:"single",RANGE:"range",WEEKEND:"weekend",OPENFLEX:"openflex"},now:null,maxDate:null,pickers:{},options:{monthTitleFormat:"MMMM YYYY",allowPastDates:!1,fullCssClass:"Common-Widgets-Datepicker-SingletonCalendar",shortDayNameLen:1,
mobileBreakpoint:568,presentationClasses:{},backToTodayHeader:!1,messages:{greatPrice:""}},daysSelector:".col.day[data-val]:not([disabled])",appended:null,addFixedClass:!1,calendarElementCss:{},isDialogRight:!1,addPicker:function(a){var b=a.dateMode,c=a.group;if("undefined"===typeof a.id||"undefined"===typeof b||"undefined"===typeof c)throw Error("id, dateMode and group should not be empty.");this.pickers[a.id]=f.extend({},a,{state:{currentDate:this.getInitDate(a.initDate),minDate:null}})},init:function(){this.now=
moment().startOf("day");this.maxDate=moment().add(1,"year");this.createCalendar();d.events.ready("common.widgets.datepicker.stylejamcalendar.initialized",{instance:this})},createCalendar:function(){this.element=d.template.renderElement("styleJamCalendarTemplate");this._id=this.element.attr("id");this.aboveCalendarContainer=this.element.find("#"+this.id("aboveCalendar"));this.belowCalendarContainer=this.element.find("#"+this.id("belowCalendar"));this.tabContainer=this.element.find("#"+this.id("tabContainer"));
this.months=this.element.find("#"+this.id("monthsGrid"));this.title=this.element.find("#"+this.id("title"));this.animation=this.element.find("#"+this.id("animationWrapper"));this.displayWrapper=this.element.find("#"+this.id("displayWrapper"));this.defaultView=this.element.find("#"+this.id("defaultView"));this.next=this.element.find("#"+this.id("nextMonth"));this.prev=this.element.find("#"+this.id("prevMonth"));this.pointer=this.element.find("#"+this.id("pointer"));this.curtain=this.element.find("#"+
this.id("curtain"));this.options.backToTodayHeader&&(this.backToTodayHeader=this.element.find("#"+this.id("backToTodayHeader")),this.backToTodayBtn=this.element.find("#"+this.id("backToTodayBtn")))},addEventHandlers:function(){var a=this,b=function(b){return function(c){b.call(a,this,c)}};this.subscribe("StyleJamDateInput.change.element.style",this.changeElementStyle.bind(this));this.next.on("click.next",this.onNextClick.bind(this));this.prev.on("click.prev",this.onPrevClick.bind(this));this.next.on("keypress.next",
this.proxyClick.bind(this));this.prev.on("keypress.prev",this.proxyClick.bind(this));this.prev.add(this.next).on("keydown.taborder",this.onPrevNextTab.bind(this));this.element.on("click.day",this.daysSelector,b(this.onDayClick));this.element.on("mouseenter.day",this.daysSelector,b(this.onDayOver));this.element.on("mouseleave.day",this.daysSelector,b(this.onDayOut));this.element.on("keydown.day",this.daysSelector,b(this.onDayKeydown));this.options.backToTodayHeader&&(this.backToTodayBtn.on("click",
this.onBackToTodayClick.bind(this)),this.backToTodayBtn.on("keypress",function(b){if(b.which===d.globals.keyCodes.SPACE||b.which===d.globals.keyCodes.RETURN)b.preventDefault(),a.onBackToTodayClick.bind(a)}));f(window).resize(function(){a.ariaHideHiddenMonths()})},changeElementStyle:function(a){this.addFixedClass=a.addFixedClass;this.calendarElementCss=a.calendarElementCss;this.isDialogRight=a.isDialogRight},onPrevNextTab:function(a){d.events.publish("Calendar.prevNextTabbed",{event:a})},proxyClick:function(a){32!=
a.which&&13!=a.which||f(a.target).trigger("click")},ariaHideHiddenMonths:function(){var a=this;d.utils.presentation.isSmallTablet()?a.months.children().each(function(b){f(this).hasClass(a.getStyles({child:"colMonth",state:"hidden-on-small-tablet"}))&&f(this).attr("aria-hidden","true")}):a.months.children().each(function(b){f(this).hasClass(a.getStyles({child:"colMonth",state:"hidden-on-small-tablet"}))&&f(this).attr("aria-hidden","false")})},changeMonth:function(a){var b=this,c=this.getCurrentDate(),
e=c.add(a,"month");1!==Math.abs(a)||500>this.animation.outerWidth()?(this.update(e),this.onMonthChange()):(this.animating=!0,this.animation.addClass(this.getStyles({child:"animationWrapper",state:"animating"})).css("transform","translateX(%spx)".format(-260*a)),this.months.children().addClass(this.getStyles({child:"colMonth",state:"animating"})),setTimeout(function(){b.animating=!1;b.animation.removeClass(b.getStyles({child:"animationWrapper",state:"animating"})).css("transform","translateX(0px)");
b.months.children().removeClass(b.getStyles({child:"colMonth",state:"animating"}));-1==a?(b.removeMonth(b.months.children().last()),b.addMonth(b.makeMonthHTML(c.clone(),-1,!0),!0),b.months.children().eq(1).attr("aria-hidden","false"),d.dom.swapClasses(b.months.children().eq(1),b.getStyles({child:"colMonth",state:"hidden"}),b.getStyles({child:"colMonth",state:"base"})),b.months.children().eq(3).attr("aria-hidden","true"),d.dom.swapClasses(b.months.children().eq(3),b.getStyles({child:"colMonth",state:"base"}),
b.getStyles({child:"colMonth",state:"hidden"}))):1==a&&(b.removeMonth(b.months.children().first()),b.addMonth(b.makeMonthHTML(c.clone(),2,this.showOnlyOneMonth),!1),b.months.children().eq(2).attr("aria-hidden","false"),d.dom.swapClasses(b.months.children().eq(2),b.getStyles({child:"colMonth",state:"hidden"}),b.getStyles({child:"colMonth",state:"base"})),b.months.children().eq(0).attr("aria-hidden","true"),d.dom.swapClasses(b.months.children().eq(0),b.getStyles({child:"colMonth",state:"base"}),b.getStyles({child:"colMonth",
state:"hidden"})));b.setDisplayHeight();b.onMonthChange()},200),this.updateNav())},removeMonth:function(a){a.remove()},addMonth:function(a,b){b?this.months.prepend(a):this.months.append(a)},onNextClick:function(a){f(a.currentTarget).is("[disabled]")||this.animating?a.preventDefault():this.changeMonth(1)},onPrevClick:function(a){f(a.currentTarget).is("[disabled]")||this.animating?a.preventDefault():this.changeMonth(-1)},onBackToTodayClick:function(){var a=this.now.clone().startOf("month").diff(this.getCurrentDate(),
"months");-1<a&&1>a||(this.changeMonth(a),this.updateBackToTodayDisplay(!1))},updateBackToTodayDisplay:function(a){null==a&&(a=this.now.clone().startOf("month").diff(this.getCurrentDate(),"months"),a=1<=a||-1>=a);a?this.swapClasses(this.backToTodayBtn,"Calendar__NavBtn--hidden",""):this.swapClasses(this.backToTodayBtn,"","Calendar__NavBtn--hidden")},onDayClick:function(a,b){var c=this.getCurrentPicker();if(c.onDayClick)c.onDayClick(a,b);b.preventDefault();b.stopPropagation()},onDayOver:function(a,
b){var c=this.getCurrentPicker();if(c&&c.onDayOver)c.onDayOver(a,b)},onDayOut:function(a,b){var c=this.getCurrentPicker();if(c&&c.onDayOut)c.onDayOut(a,b)},onDayKeydown:function(a,b){var c=this.getCurrentPicker();if(c&&c.onDayKeydown)c.onDayKeydown(a,b)},setMinDate:function(a,b){if(b=this.pickers[b]){var c=b.state.currentDate,e=b.state.minDate;null!=e&&e.isSame(a,"d")||(e=moment(a),b.state.minDate=e,a=e.clone().startOf("month"),a.isAfter(c)&&(b.state.currentDate=a))}},getMinDate:function(a){return a&&
this.pickers[a]?this.pickers[a].state.minDate:this.getCurrentPicker()?this.getCurrentPicker().state.minDate:null},setCurrentDate:function(a){this.getCurrentPicker().state.currentDate=a},getCurrentDate:function(){return this.getCurrentPicker().state.currentDate},checkDate:function(a){return!this.options.allowPastDates&&a.isBefore(this.now)||a.isAfter(this.maxDate)||null!==this.getMinDate()&&a.isBefore(this.getMinDate())?!1:!0},makeWeekHeaderHTML:function(){for(var a={},b=moment().startOf("week"),c=
1;7>=c;c++)a["day-"+c]=b.format("dd").substr(0,this.options.shortDayNameLen),a["ariaLabel-"+c]=b.format("dddd"),b.add(1,"day");return d.template.render("styleJamCalendarWeekDayGrid",a)},makeCalendarHTML:function(a){var b=[];b.push(this.makeMonthHTML(a.clone(),-1,!0));b.push(this.makeMonthHTML(a.clone(),0));b.push(this.makeMonthHTML(a.clone(),1,this.showOnlyOneMonth));b.push(this.makeMonthHTML(a.clone(),2,!0));return b.join("")},makeMonthHTML:function(a,b,c){var e=a.clone().add(b,"month").startOf("month"),
f=e.month();a=this.id(e.format("YYYYMM"));var g=e.format(this.options.monthTitleFormat),n=!1;if(-1===b||2===b)n=!0;b=[];for(var l=[],h=0;h<e.weekday();h++)l.push(this.makeDayHTML(a));for(;e.month()==f;)l.push(this.makeDayHTML(a,e)),6===e.weekday()&&(b.push(d.template.render("styleJamCalendarWeekGrid",{weekDays:l.join("")})),l=[]),e.add(1,"day");l.length&&b.push(d.template.render("styleJamCalendarWeekGrid",{weekDays:l.join("")}));e=this.animating?this.getStyles({child:"colMonth",state:"animating"}):
"";e=c?e+(" "+this.getStyles({child:"colMonth",state:"hidden"})):e+(" "+this.getStyles({child:"colMonth",state:"base"}));return d.template.render("styleJamCalendarMonthTemplate",{monthId:a,ariaHidden:n,monthTitle:g,weeksGrids:b.join(""),weekDayGrid:this.makeWeekHeaderHTML(),classes:e})},makeDayHTML:function(a,b){a=-1;var c=b?b.date():"",e=b?"data-val\x3d"+b.valueOf():"",f=b?' aria-label\x3d"'+b.format("MMMM D")+'"':"",g="";b?this.checkDate(b)?(b=b.isSame(this.now)?this.getStyles({child:"colDay",state:"today"}):
this.getStyles({child:"colDay",state:"active"}),a=0):(b=this.getStyles({child:"colDay",state:"disabled"}),g="disabled"):b=this.getStyles({child:"colDay",state:"empty"});return d.template.render("styleJamCalendarWeekDay",{classes:b,tabindex:a,dataVal:e,dayInner:c,disabled:g,dayLabel:f})},getCurrentPicker:function(){return this.pickers[this.currentPickerId]},setTitle:function(){var a=this.getCurrentPicker().title;"undefined"===typeof a||""===a?this.title.addClass("hidden"):this.title.text(a)},populateMonthsGrid:function(a){a=
a||this.getCurrentPicker().initDate||this.now;var b=this.makeCalendarHTML(a);this.setCurrentDate(a.clone());this.months.html(b)},switchPicker:function(a){if(null!==this.currentPickerId){var b=this.pickers[this.currentPickerId];if(b.onUnload)b.onUnload(this.element)}if(b=this.pickers[a]){this.currentPickerId=a;this.setTitle();0===this.element.closest("body").length&&this.element.appendTo("body");if(b.onLoad)b.onLoad(this);this.update(b.state.minDate);this.element.attr("data-date-group",b.group)}},
update:function(a){d.utils.presentation.isSmallTablet()&&this.displayWrapper.height()<1.9*this.monthApproxHeight?this.showOnlyOneMonth=!0:this.showOnlyOneMonth=!1;this.populateMonthsGrid(a);this.updateNav();this.setDisplayHeight()},updateNav:function(){var a=this.getStyles({child:"navItemSVG",state:"active"}),b=this.getStyles({child:"navItemSVG",state:"disabled"});this.checkDate(this.getMonthDate(-1,!0))?(this.prev.removeAttr("disabled"),d.dom.swapClasses(this.prev.children("svg"),b,a)):(this.prev.attr("disabled",
"disabled"),d.dom.swapClasses(this.prev.children("svg"),a,b));this.checkDate(this.getMonthDate(2))?(this.next.removeAttr("disabled"),d.dom.swapClasses(this.next.children("svg"),b,a)):(this.next.attr("disabled","disabled"),d.dom.swapClasses(this.next.children("svg"),a,b))},setDisplayHeight:function(){if(this.defaultView.is(":visible")){var a=0;this.months.children().each(function(b){if(1==b||2==b)a=Math.max(a,f(this).find(".month").outerHeight())});this.options.backToTodayHeader&&this.backToTodayHeader&&
(a+=this.backToTodayHeader.height());this.displayWrapper.height(a)}},position:function(a,b){if(this.isOpen){var c=this.getCurrentPicker(),e=c.dateMode,q=c.group,c=c.hasPointer,g={},n=0,l=0,h=0,m=Math.round(f(window).outerWidth()),k=d.question.ask("DateInput.%s.startDate".format(q));if(m<=this.options.mobileBreakpoint)this.isOpen&&this.element.removeAttr("style");else{if(e===this.DateMode.RANGE){var t=d.question.ask("DateInput.%s.endDate".format(q)),r,p;t||console.error('Missing end input field, if this is a single date, set the dateMode parameter to "single"');
var u=t.offset.left-k.offset.left;k.wrapper&&k.wrapper===t.wrapper&&f(k.wrapper).length&&(r=f(k.wrapper),p=r.offset());r?(g.left=p.left,n=p.top,l=r.outerHeight(),h="endDate"===a?t.offset.left-p.left:k.offset.left-p.left):k.height===t.height&&k.offset.top===t.offset.top&&this.element.outerWidth()-60>u&&(g.left=k.offset.left,n=k.offset.top,l=k.height,h="endDate"===a?u:0)}else k.wrapper&&f(k.wrapper).length&&(r=f(k.wrapper),p=r.offset()),r&&(g.left=p.left,n=p.top,l=r.outerHeight(),h=k.offset.left-p.left);
g.hasOwnProperty("left")&&"undefined"!==typeof l||(a=d.question.ask("DateInput.%s.%s".format(q,e===this.DateMode.RANGE?a:"startDate")),n=a.offset.top,l=a.height,g.left=a.offset.left);this.shouldFlipDirection(n,l)?(g.top=n-this.element.outerHeight(),this.element.addClass("up")):(g.top=n+l,this.element.removeClass("up"));a=Math.round(g.left);g=Math.round(g.top);h=Math.round(h);m=Math.round(this.element.outerWidth())+a-m;0<m&&(a-=m,h+=m);m=0;this.element.parent()[0]===jq(document.body)[0]&&(m=parseInt((jq(document.body).css("top")||
"0").replace("-",""))||0);m="translateX(%spx) translateY(%spx)".format(a,g+m);h="translateX(%spx)".format(h);m={transform:m,msTransform:m};h={transform:h,msTransform:h};b||this.element.css(m);c?this.pointer.css(h).removeClass("hidden"):this.pointer.addClass("hidden");this.addFixedClass?(b=this.calendarElementCss.left-(this.isDialogRight?this.element.width():0),this.element.addClass("calendar-fixed"),this.element.attr("style","top: "+this.calendarElementCss.top+" !important; left: "+b+"px !important")):
(this.element.removeClass("calendar-fixed"),this.element.css(this.calendarElementCss))}}},shouldFlipDirection:function(a,b){var c=f(window).scrollTop(),e=c+f(window).outerHeight(),d=this.element.outerHeight();return a+b+d>e&&!(a-d<c)},getMonthDate:function(a,b){a=this.getCurrentDate().clone().add(a,"month");return b?a.endOf("month"):a.startOf("month")},onMonthChange:function(){d.events.publish("Calendar.monthchange",{group:this.getCurrentPicker().group});this.options.backToTodayHeader&&this.updateBackToTodayDisplay()},
open:function(a){var b=this;if("undefined"===typeof this.pickers[a])throw Error('Picker %s not attached to the calendar. Please use "addPicker" to attach it to the calendar',a);this.isOpen&&a===this.currentPickerId||this.switchPicker(a);this.element.attr("aria-hidden",!1);d.dom.swapClasses(this.element,this.getStyles({state:"hidden"}),this.getStyles({state:"summon"}));setTimeout(function(){b.element.addClass(b.getStyles({state:"animate"}))},1);this.isOpen=!0},close:function(a){if(this.isOpen&&this.currentPickerId===
a){this.element.attr("aria-hidden",!0);d.dom.swapClasses(this.element,this.getStyles({state:"summon"}),this.getStyles({state:"hidden"}));this.element.removeClass(this.getStyles({state:"animate"}));if(null!==this.currentPickerId&&(a=this.pickers[this.currentPickerId],a.onUnload))a.onUnload(this.element);this.isOpen=!1}},getInitDate:function(a){a=a?moment(a):this.now.clone();a.isBefore(this.now)&&!this.options.allowPastDates&&(a=this.now.clone());return a},getSelectableDays:function(a){var b=this.months.children().find(".col.day[data-val]").not("[disabled]");
return a&&0>a.indexOf("%s")?b.filter(a):b},getDayElement:function(a){a=moment(a).valueOf();return this.element.find(".col.day[data-val\x3d%s]".format(a))},hideTooltip:function(){this.element.find(".dayTip").hide()},highlightDates:function(a,b){"function"===typeof b?this.getSelectableDays(a.join(",")).addClass("highlighted "+b()):this.getSelectableDays(a.join(",")).addClass("highlighted "+this.getStyles({child:"colDay",state:"highlighted"}))},markFlex:function(a){this.getSelectableDays(a.join(",")).addClass("flex")},
markStartDate:function(a,b){"function"===typeof b?this.selectDate(a).addClass("startDate "+b()):this.selectDate(a).addClass("startDate "+this.getStyles({child:"colDay",state:"startDate"}))},selectDates:function(a,b,c){return"function"===typeof b||"function"===typeof c?(b="function"===typeof b?b():" ",c="function"===typeof c?c():" ",this.getSelectableDays(a.join(",")).removeClass(c).addClass("selected "+b).attr("aria-selected","true")):this.getSelectableDays(a.join(",")).addClass("selected "+this.getStyles({child:"colDay",
state:"selected"})).attr("aria-selected","true")},selectDate:function(a,b,c){a=this.getDayElement(a);"function"===typeof b||"function"===typeof c?(b="function"===typeof b?b():" ",c="function"===typeof c?c():" ",a.removeClass("highlighted hover "+c).addClass("selected "+b).attr("aria-selected","true")):a.addClass("selected "+this.getStyles({child:"colDay",state:"selected"})).attr("aria-selected","true").removeClass("highlighted hover "+this.getStyles({child:"colDay",state:"highlighted"})+" "+this.getStyles({child:"colDay",
state:"hover"}));return a},markEndDate:function(a,b){"function"===typeof b?this.selectDate(a).addClass("endDate "+b()):this.selectDate(a).addClass("endDate "+this.getStyles({child:"colDay",state:"endDate"}))},markPreviewDates:function(a,b,c){"function"===typeof b||"function"===typeof c?(b="function"===typeof b?b():" ",c="function"===typeof c?c():" ",this.getSelectableDays(a.join(",")).filter(":not(.startDate)").filter(":not(.endDate)").removeClass(c).addClass("preview "+b)):(this.getSelectableDays(a.join(",")).filter(":not(.startDate)").filter(":not(.endDate)").addClass("preview "+
this.getStyles({child:"colDay",state:"preview"})),this.getSelectableDays(".highlighted").addClass(this.getStyles({child:"colDay",state:"highlighted"})))},hoverDay:function(a,b,c){a=this.getDayElement(a);a.is(":not(.startDate, .endDate)")&&("function"===typeof b||"function"===typeof c?(b="function"===typeof b?b():" ",c="function"===typeof c?c():" ",a.removeClass("preview "+c).addClass("hover "+b)):a.addClass("hover "+this.getStyles({child:"colDay",state:"hover"})).removeClass(["preview",this.getStyles({child:"colDay",
state:"preview"}),this.getStyles({child:"colDay",state:"highlighted"})].join(" ")))},showTooltip:function(a){},isDifferentPicker:function(a){return this.currentPickerId!==a},calculateMonthOffset:function(a){a=moment(a).startOf("month").diff(this.getCurrentDate().startOf("month"));a=Math.round(moment.duration(a).asMonths());0<a&&--a;return a},clearDayState:function(a,b,c){if(""!==a.trim()){var d=this,q=this.getSelectableDays("%s".format(a.split(" ").map(function(a){return"."+a}).join()));"function"===
typeof b||"function"===typeof c?(c="function"===typeof c?c():" ",q.removeClass(c+" "+a),"function"===typeof b&&q.each(function(a,c){a=f(c);a.addClass(b(a))})):q.removeClass(a.split(" ").map(function(a){return d.getStyles({child:"colDay",state:a})}).join(" ")+" "+a);0<=a.indexOf("selected")&&(q.removeAttr("aria-selected"),this.getSelectableDays(".flex").removeClass("flex"))}},getStyles:function(a){return a.child?this.options.presentationClasses[a.child][a.state]:this.options.presentationClasses.main[a.state]},
handleBuzzUpdate:function(a){var b=this,c=[];window.subData&&(a=window.subData);if("object"===typeof a.dates)for(var e in a.dates)a.dates.hasOwnProperty(e)&&"LOW"===a.dates[e]&&c.push(moment(e).valueOf());this.removeBuzzFlaggedItems();f.each(c,function(a,c){a=b.getDayElement(c).attr("data-tip","BUZZ_LOW");var e=a.children("div");a.length&&(a.attr("aria-label",d.Common.Utils.String.formatString(b.options.messages.greatPrice,moment(c).format(d.globals.dateFormats.short))),d.dom.swapClasses(e,b.getStyles({child:"day",
state:"default"}),b.getStyles({child:"day",state:"buzz"})),a.is(".highlighted")?e.addClass(b.getStyles({child:"day",state:"previewBuzz"})):a.is(".selected")?e.addClass(b.getStyles({child:"day",state:"selectedBuzz"})):e.addClass(b.getStyles({child:"day",state:"defaultBuzz"})))})},removeBuzzFlaggedItems:function(){var a=this.months.find("[data-tip\x3dBUZZ_LOW]");d.dom.swapClasses(a.removeAttr("data-tip").children("div"),this.getStyles({child:"day",state:"buzz"}),this.getStyles({child:"day",state:"default"}));
a.children("div").removeClass(this.getStyles({child:"day",state:"defaultBuzz"})+" "+this.getStyles({child:"day",state:"previewBuzz"})+" "+this.getStyles({child:"day",state:"selectedBuzz"}));a.each(function(a,c){a=f(c);c=a.attr("data-val");c=moment(parseInt(c));a.attr("aria-label",c.format(d.globals.dateFormats.short))})},handlePriceUpdate:function(){this.removeBuzzFlaggedItems()},append:function(a){var b=this.getAppendElement(a);return null!==b&&this.appended!==a?(b.append(this.element.detach()),
this.appended=a,!0):!1},buffer:function(a){return null!==this.getAppendElement(a)&&this.appended===a?(f("body").append(this.element.detach()),this.appended=null,!0):!1},getAppendElement:function(a){return a&&f(a).length?f(a):null},toggleDefaultView:function(a){a?this.swapClasses(this.defaultView,"Calendar__defaultView--hidden",""):this.swapClasses(this.defaultView,"","Calendar__defaultView--hidden")}})})(R9,jQuery);(function(a,c){a.createWidgetClass("dropdown.StyleJamDropdown",{status:null,select:null,selectEl:null,refreshTimer:null,lastSelectedIndex:-1,options:{click:null,change:null,statusClientTemplate:"",presentationStates:{},showFocusOutline:!1},init:function(){this.status=this.getChildElement("status");this.status.length||(this.status=this.element.find(".status"));this.select=this.getChildElement("select");this.select.length||(this.select=this.element.find("select"));this.selectEl=this.select.get(0)},
addEventHandlers:function(){this.select.click(this.handleSelectClickEvent.bind(this));this.select.keydown(this.handleSelectKeydownEvent.bind(this));this.select.keyup(this.handleSelectKeyupEvent.bind(this));this.select.focus(this.handleSelectFocusEvent.bind(this));this.select.blur(this.handleSelectBlurEvent.bind(this));this.select.change(this.handleSelectChangeEvent.bind(this));this.options.presentationStates&&this.styleInvalidState()},refresh:function(){this.select.is(":disabled")?this.element.addClass("disabled"):
this.element.removeClass("disabled");var b=this.selectEl.selectedIndex;0>b&&(b=0);b=this.selectEl.options[b];"undefined"!==typeof b&&(this.options.statusClientTemplate?this.status.html(a.template.render(this.options.statusClientTemplate,b)):(this.status.html(a.utils.escapeHTML(b.title||b.text||b.value)),this.selectEl.title=b.title||b.text||b.value))},startRefreshLoop:function(){var b=this;this.lastSelectedIndex=this.selectEl.selectedIndex;this.refreshTimer=setInterval(function(){b.doRefresh()},100)},
stopRefreshLoop:function(){null!=this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null,this.lastSelectedIndex=-1)},doRefresh:function(){this.selectEl.selectedIndex!=this.lastSelectedIndex&&(this.lastSelectedIndex=this.selectEl.selectedIndex,this.refresh())},handleSelectClickEvent:function(){"function"===typeof this.options.click&&this.options.click(this);this.stopRefreshLoop()},handleSelectKeydownEvent:function(){this.startRefreshLoop()},handleSelectKeyupEvent:function(){this.refresh();
this.stopRefreshLoop()},handleSelectFocusEvent:function(){this.selectEl.disabled||(this.element.addClass("focused"),this.options.showFocusOutline&&this.element.addClass(this.getStlBlock("Dropdown--focused")),this.options.presentationStates?(this.element.removeClass(this.options.presentationStates.invalid),a.dom.swapClasses(this.element,this.options.presentationStates.regular,this.options.presentationStates.focus)):this.element.is(".TEXT")?(a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextBlurred,
a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextFocused),a.dom.swapClasses(this.element.children(".icon"),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconText,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconTextFocused)):a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownBlurred,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownFocused))},handleSelectBlurEvent:function(){this.selectEl.disabled||(this.element.removeClass("focused"),
this.options.showFocusOutline&&this.element.removeClass(this.getStlBlock("Dropdown--focused")),this.options.presentationStates?a.dom.swapClasses(this.element,this.options.presentationStates.focus,this.options.presentationStates.regular):(this.element.is(".TEXT")?(a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextFocused,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownTextBlurred),a.dom.swapClasses(this.element.children(".icon"),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconTextFocused,
a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownIconText)):a.dom.swapClasses(c(this.element),a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownFocused,a.stylejam.common.widgets.dropdown.StyleJamDropdown.dropdownBlurred),this.refresh(),this.stopRefreshLoop()))},handleSelectChangeEvent:function(b){"function"===typeof this.options.change&&this.options.change.call(this,b);this.refresh();this.stopRefreshLoop()},styleInvalidState:function(b){b?a.dom.swapClasses(this.element,this.options.presentationStates.regular,
this.options.presentationStates.invalid):a.dom.swapClasses(this.element,this.options.presentationStates.invalid,this.options.presentationStates.regular)},getSelectedElement:function(){return this.selectEl.options[0<=this.selectEl.selectedIndex?this.selectEl.selectedIndex:0]},getName:function(){return this.selectEl.name},hasOptions:function(){return 0!==this.selectEl.options.length},getValue:function(){return this.hasOptions()?this.getSelectedElement().value:null},val:function(b){if("undefined"!==
typeof b)this.setValue(b);else return this.getValue()},getText:function(){return c(this.getSelectedElement()).text()},setText:function(b){this.status.text(b)},setValue:function(b,a){this.select.val(b);a?this.select.trigger("change"):this.refresh()},setOptions:function(a,e){var b=c("\x3cselect\x3e");c.each(a,function(a,d){d.value===e&&(d.selected=!0);b.append(c("\x3coption\x3e",d))});this.select.html(b.html());this.refresh()}})})(R9,jQuery);(function(c,b){c.createWidgetClass("dropdown.Dropdown",{status:null,select:null,selectEl:null,refreshTimer:null,lastSelectedIndex:-1,options:{click:null,change:null,statusClientTemplate:""},init:function(){this.status=this.getChildElement("status");this.status.length||(this.status=this.element.find(".status"));this.select=this.getChildElement("select");this.select.length||(this.select=this.element.find("select"));this.selectEl=this.select.get(0)},addEventHandlers:function(){this.select.click(this.handleSelectClickEvent.bind(this));
this.select.keydown(this.handleSelectKeydownEvent.bind(this));this.select.keyup(this.handleSelectKeyupEvent.bind(this));this.select.focus(this.handleSelectFocusEvent.bind(this));this.select.blur(this.handleSelectBlurEvent.bind(this));this.select.change(this.handleSelectChangeEvent.bind(this))},refresh:function(){this.select.is(":disabled")?this.element.addClass("disabled"):this.element.removeClass("disabled");var a=this.selectEl.selectedIndex;0>a&&(a=0);a=this.selectEl.options[a];"undefined"!==typeof a&&
(this.options.statusClientTemplate?this.status.html(c.template.render(this.options.statusClientTemplate,a)):(this.status.html(c.utils.escapeHTML(a.title||a.text||a.value)),this.selectEl.title=a.title||a.text||a.value))},startRefreshLoop:function(){var a=this;this.lastSelectedIndex=this.selectEl.selectedIndex;this.refreshTimer=setInterval(function(){a.doRefresh()},100)},stopRefreshLoop:function(){null!=this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null,this.lastSelectedIndex=
-1)},doRefresh:function(){this.selectEl.selectedIndex!=this.lastSelectedIndex&&(this.lastSelectedIndex=this.selectEl.selectedIndex,this.refresh())},handleSelectClickEvent:function(){"function"===typeof this.options.click&&this.options.click(this);this.stopRefreshLoop()},handleSelectKeydownEvent:function(){this.startRefreshLoop()},handleSelectKeyupEvent:function(){this.refresh();this.stopRefreshLoop()},handleSelectFocusEvent:function(){this.selectEl.disabled||this.element.addClass("focused")},handleSelectBlurEvent:function(){this.selectEl.disabled||
(this.element.removeClass("focused"),this.refresh(),this.stopRefreshLoop())},handleSelectChangeEvent:function(a){"function"===typeof this.options.change&&this.options.change.call(this,a);this.refresh();this.stopRefreshLoop()},getSelectedElement:function(){return this.selectEl.options[0<=this.selectEl.selectedIndex?this.selectEl.selectedIndex:0]},getName:function(){return this.selectEl.name},hasOptions:function(){return 0!==this.selectEl.options.length},getValue:function(){return this.hasOptions()?
this.getSelectedElement().value:null},val:function(a){if("undefined"!==typeof a)this.setValue(a);else return this.getValue()},getText:function(){return b(this.getSelectedElement()).text()},setText:function(a){this.status.text(a)},setValue:function(a,b){this.select.val(a);b?this.select.trigger("change"):this.refresh()},setOptions:function(a,c){var e=b("\x3cselect\x3e");b.each(a,function(a,d){d.value===c&&(d.selected=!0);e.append(b("\x3coption\x3e",d))});this.select.html(e.html());this.refresh()}})})(R9,
jQuery);(function(d,c){d.extend("DatePicker.BuzzData",{});var a={},b=null,e=null,g=d.DatePicker.BuzzData=function(){if(e)return e;e=this;return this};g.prototype={constructor:g,datePicker:null,form:null,vertical:"",update:function(a,b){this.datePicker=a;this.form=b;this.vertical=b.vertical;a=d.config.getBoolean("ui.calendar.buzz.hotels.enabled",!1);b=d.config.getBoolean("ui.calendar.buzz.flights.enabled",!1);a&&"hotels"===this.vertical&&this.updatePickerAccordingData(this.form.cityId,this.updateDatePicker.bind(this));
b&&"flights"===this.vertical&&this.updatePickerAccordingData(this.getFlightUrl(),this.updateDatePicker.bind(this))},fetch:function(a,b){this.form=a;this.vertical=a.vertical;a=d.config.getBoolean("ui.calendar.buzz.hotels.enabled",!1);var e=d.config.getBoolean("ui.calendar.buzz.flights.enabled",!1);a&&"hotels"===this.vertical&&this.updatePickerAccordingData(this.form.cityId,b);e&&"flights"===this.vertical&&this.updatePickerAccordingData(this.getFlightUrl(),b)},getFlightUrl:function(){var a=this.form,
b=this.getAirportCode(a.origin),e=this.getAirportCode(a.destination),c=a.departDate,a=a.isOneWay,g="";if(this.isEmpty(b))return null;g+=b+"/";if(this.isEmpty(e))return null;g=g+(e+"")+("?oneWay\x3d"+(a?"true":"false"));c&&(g+="\x26departDate\x3d"+c);return g},isEmpty:function(a){return!a||0===a.length},getAirportCode:function(a){if("undefined"!==typeof a){var b=/(([A-Z]{3}))/g,e=a.substr(0,3);if(""==e||0==e.indexOf("C-"))e=a.value+"",e=e.replace(/ /g,""),-1!=e.indexOf("(")&&(a=b.exec(e),null!=a&&
(e=a[0]));return c.trim(e)}return null},updatePickerAccordingData:function(a,e){if(a){var g=this.getCacheData(a),f=this;null!==g?e(g):(b&&4!==b.readyState&&b.abort(),b=c.ajax({type:"GET",url:"/api/search/buzzCalendar/"+this.vertical+"/"+a,dataType:"json"}).done(function(b){b.success&&(f.putCacheData(a,b),e(b))}))}},getCacheData:function(b){b=this.getKey(b);return a.hasOwnProperty(b)?a[b]:null},putCacheData:function(b,e){b=this.getKey(b);a[b]=e},getKey:function(a){return this.vertical+"_"+a},updateDatePicker:function(a){var b=
d.config.getBoolean("ui.calendar.buzz.prices",!1),e=d.config.getBoolean("ui.calendar.buzz.prices.low",!1),g="buzz-date-low";b&&(g="buzz-prices-low");c(".r9-datepicker-item",this.datePicker).each(function(){var f=c(this);f.removeClass(g);b&&c(".buzz-price",f).html("");var d=f.data("val");"undefined"!==typeof d&&(d=moment(d).format("YYYY-MM-DD"),a.dates&&a.dates.hasOwnProperty(d)&&"LOW"===a.dates[d]&&f.addClass("buzz-date-low"),b&&a.prices&&a.prices.hasOwnProperty(d)&&(d=a.prices[d],c(".buzz-price",
f).html(d.price),e&&"LOW"===d.rate&&f.addClass("buzz-prices-low")))})}}})(window.R9,window.jq||window.jQuery);
(function(d){R9.extend("Widgets.BaseCalendarWidget",{});(R9.Widgets.BaseCalendarWidget=function(){this.updateSettings()}).prototype={advanceStyling:!0,loadBuzzData:!1,buzzDataClass:"",buzzPrices:!1,updateSettings:function(){this.advanceStyling=R9.config.getBoolean("ui.calendar.advanceStyling",!0);this.loadBuzzData=R9.config.getBoolean("ui.calendar.loadBuzzData",!1);this.buzzDataClass=(this.buzzPrices=R9.config.getBoolean("ui.calendar.buzz.prices",!1))?"datepicker-buzz-prices":"datepicker-buzz-data";
this.wholeMonthSearch=!1;jq("body").hasClass("FlightsSearch")&&0<jq(".flexOpenflex").length&&0<jq(".Flights-Search-FlightSearchPage.vm-fd").length&&(this.wholeMonthSearch=R9.config.getBoolean("ui.flights.whole-month-search.enabled",!1),this.daterangePickerDefaultNavTab="specificDate",this.noOfNightsValue="6-8",this.flexSelectedYear=this.flexSelectedMonth="",this.flexPlusMinusChecked=!1)},buzzGraph:jq("\x3cdiv\x3e",{"class":"r9-datepicker-buzz-graph"}),buzzGraphFooter:jq("\x3cdiv\x3e",{"class":"r9-datepicker-buzz-graph-footer"}),
buzzGraphFooterInner1:jq("\x3cdiv\x3e",{"class":"noairports hidden"}),buzzGraphFooterInner2:jq("\x3cdiv\x3e",{"class":"duration hidden"}),buzzGraphFooterInner3:jq("\x3cdiv\x3e",{"class":"fixedstart hidden"}),buzzGraphFooterInner4:jq("\x3cdiv\x3e",{"class":"oneway hidden"}),buzzGraphFooterDetail:jq("\x3cspan\x3e",{"class":"detail"}),buzzGraphPriceRule:jq("\x3cdiv\x3e",{id:"graphpricebar","class":"r9-datepicker-buzz-graph-price"}),buzzGraphLowestPriceRule:jq("\x3cdiv\x3e",{id:"graphlowpricebar","class":"r9-datepicker-buzz-graph-price"}),
buzzGraphPriceValue:jq("\x3cdiv\x3e",{id:"graphprice","class":"r9-datepicker-buzz-graph-price-value"}),makeCalendarHTML:function(c){var a=function(){var a=this.makeBelowCalendarHTML();a&&0<a.length&&(b.push("\x3cdiv id\x3d'%s' class\x3d'belowCalendar'\x3e".format("below")),b.push(a),b.push("\x3c/div\x3e"))},b=[];this.options.showBuzzGraph&&(this.buzzGraph.html(this.buzzGraphPriceRule.prop("outerHTML")+this.buzzGraphLowestPriceRule.prop("outerHTML")+this.buzzGraphPriceValue.prop("outerHTML")),this.buzzGraphFooterInner1.html("Select airports to see recent best prices. \x3cspan class\x3d'detail'\x3e\x3c/span\x3e"),
this.buzzGraphFooterInner2.html("Best prices for \x3cspan id\x3d\"durationNumber\"\x3e\x3c/span\x3e day trips. \x3cspan class\x3d'detail'\x3e\x3c/span\x3e"),this.buzzGraphFooterInner3.html("Best prices for trips departing on \x3cspan id\x3d\"flexDepartDate\"\x3e\x3c/span\x3e. \x3cspan class\x3d'detail'\x3e\x3c/span\x3e"),this.buzzGraphFooterInner4.html("Best prices for one-way trips \x3cspan class\x3d'detail'\x3e\x3c/span\x3e"),this.buzzGraphFooter.html(this.buzzGraphFooterInner1.prop("outerHTML")+
this.buzzGraphFooterInner2.prop("outerHTML")+this.buzzGraphFooterInner3.prop("outerHTML")+this.buzzGraphFooterInner4.prop("outerHTML")));b.push("\x3cdiv class\x3d'r9-datepicker-pointer'\x3e\x3c/div\x3e");b.push("\x3cspan role\x3d'button' class\x3d'r9-datepicker-close'\x3e\x26times;\x3c/span\x3e");!0===this.options.belowContentOnTop&&a.call(this);b.push(this.makeTitleHTML(this.options.title));this.wholeMonthSearch&&b.push(this.makeCalendarTabNavHTML());var e=moment().startOf("day"),g=this.minDate,
g=g?moment(g):e;c=c?moment(c):g;if(null==c||!this.isPastDateAllowed()&&c<e)c=e;e=moment(c).subtract(1,"months");g=moment(c).add(1,"months");b.push(this.makeMonthCalendarHTML(c,e,"r9-datepicker-month-first",this.options.prevTitle));c.add(1,"months");b.push(this.makeMonthCalendarHTML(c,g,"r9-datepicker-month-last",this.options.nextTitle));b.push("\x3cdiv class\x3d'r9-datepicker-month-break'\x3e\x3c/div\x3e");this.options.showBuzzGraph&&(b.push(this.buzzGraph.prop("outerHTML")),b.push(this.buzzGraphFooter.prop("outerHTML")));
this.wholeMonthSearch&&b.push(this.makeCalendarSelectMonthHTML());this.options.belowContentOnTop||a.call(this);return b.join("")},makeTitleHTML:function(c){return'\x3cdiv class\x3d"r9-datepicker-title"\x3e\x3cspan\x3e'+c+'\x3c/span\x3e\x3ca class\x3d"r9-datepicker-title-close"\x3eX\x3c/a\x3e\x3c/div\x3e'},makeCalendarTabNavHTML:function(){var c=jq(document.createElement("div")),a=jq(document.createElement("div")).addClass("CalendarWidget-TabNav"),b=jq(document.createElement("div")).addClass("keel-grid distribute mainGrid"),
e=jq(document.createElement("div")).addClass("col-auto leftNavItems"),g=jq(document.createElement("div")).addClass("col-auto rightNavItems"),f=jq(document.createElement("div")).addClass("keel-grid leftNavItemsGrid"),d=jq(document.createElement("div")).addClass("keel-grid rightNavItemsGrid"),h=jq(document.createElement("div")).addClass("tabWrapper specificDate"),n=jq(document.createElement("div")).addClass("col-auto dateCol"),m=jq(document.createElement("span")).addClass("icon calendar").html('\x3csvg viewBox\x3d"0 0 13 14" xmlns\x3d"http://www.w3.org/2000/svg"\x3e\x3cpath d\x3d"M9.75 1.647h1.247c1.106 0 2.003.888 2.003 1.999v8.356A1.999 1.999 0 0 1 10.997 14H2.003A1.997 1.997 0 0 1 0 12.002V3.646a2 2 0 0 1 2.003-1.999H3.25V0h.813v1.647h4.875V0h.812v1.647zm0 .824h1.428c.558 0 1.01.446 1.01 1.007v8.691c0 .557-.446 1.007-1.01 1.007H1.822c-.558 0-1.01-.446-1.01-1.007V3.478c0-.556.446-1.007 1.01-1.007H3.25v.823h.813v-.823h4.875v.823h.812v-.823zM.812 4.94h11.376v.824H.812V4.94zM2.6 6.364h2v2h-2v-2z" fill\x3d"currentColor" fill-rule\x3d"evenodd"/\x3e\x3c/svg\x3e'),
l=jq(document.createElement("div")).addClass("tabWrapper wholeMonth"),r=jq(document.createElement("div")).addClass("col-auto dateMonth"),w=jq(document.createElement("span")).addClass("icon trend").html('\x3csvg viewBox\x3d"0 0 15 12" xmlns\x3d"http://www.w3.org/2000/svg"\x3e\x3cpath d\x3d"M0 12V5h3v7H0zm4 0V0h3v12H4zm4 0V5h3v7H8zm4 0V8h3v4h-3z" fill\x3d"currentColor" fill-rule\x3d"evenodd"/\x3e\x3c/svg\x3e'),p=jq(document.createElement("div")).addClass("col-auto plusMinus"),q=jq(document.createElement("span")).addClass("input flexPlusMinus"),
u=jq(document.createElement("div")).addClass("tabUnderlay no-transition");"undefined"!==typeof R9.storage&&(null!==R9.storage.get("daterangePickerDefaultNavTab")&&"wholeMonth"!==R9.storage.get("daterangePickerDefaultNavTab")||R9.storage.set("daterangePickerDefaultNavTab","specificDate"),this.daterangePickerDefaultNavTab=R9.storage.get("daterangePickerDefaultNavTab"),null===R9.storage.get("flexPlusMinusChecked")&&R9.storage.set("flexPlusMinusChecked",!1),this.flexPlusMinusChecked=R9.storage.get("flexPlusMinusChecked"));
"wholeMonthSearch"==this.daterangePickerDefaultNavTab?(l.addClass("selected"),u.addClass("wholeMonth"),p.hide()):(h.addClass("selected"),u.addClass("specificDate"));this.flexPlusMinusChecked&&q.addClass("checked");c.append(a.append(b.append(e.append(f.append(n.append(h.text("Date").addClass("v-c-p").prepend(m)),r.append(l.text("Flex Month").prepend(w).append(jq(document.createElement("span")).addClass("newTag").text("new"))))),g.append(d.append(p.append(jq(document.createElement("div")).addClass("likeTabWrapper").append(q.text("\u00b1 3 days")))))),
u));return c.html()},makeCalendarSelectMonthHTML:function(){"undefined"!==typeof R9.storage&&(null===R9.storage.get("flexNoOfNights")&&R9.storage.set("flexNoOfNights","6-8"),this.noOfNightsValue=R9.storage.get("flexNoOfNights"));var c=jq(document.createElement("div")),a=jq(document.createElement("div")).addClass("CalendarWidget-MonthSelect"),b=jq(document.createElement("div")).addClass("keel-grid mainGrid"),e=jq(document.createElement("div")).addClass("col"),g=jq(document.createElement("div")).addClass("col"),
f=jq(document.createElement("div")).addClass("keel-grid keel-form topColGrid"),d=jq(document.createElement("div")).addClass("keel-grid bottomColGrid"),h=jq(document.createElement("div")).addClass("col"),n=jq(document.createElement("div")).addClass("col noOfNightsInputCol"),m=jq(document.createElement("input")).addClass("Common-Widgets-Text-TextInput selectTextOnFocus noOfNightsInput").attr({type:"text",id:"noOfNightsInput",name:"noOfNightsInput",value:this.noOfNightsValue}),l=jq(document.createElement("label")).addClass("nightsAtDestination").text("nights"),
r=jq(document.createElement("div")).addClass("col subTextCol"),w=jq(document.createElement("div")).addClass("col"),p=jq(document.createElement("div")).addClass("keel-grid monthSelectGrid");c.append(a.append(b.append(e.append(f.append(h.text("Number of nights:"),n.append(m,l),r.text("Not sure how long? Use a range, like 10-12 nights."))),g.append(d.append(w.append(p))))));for(a=0;12>a;a++)"undefined"!==typeof R9.storage&&(null===R9.storage.get("flexSelectedMonth")&&R9.storage.set("flexSelectedMonth",
moment().format("M")),null===R9.storage.get("flexSelectedYear")&&R9.storage.set("flexSelectedYear",moment().format("Y")),this.flexSelectedMonth=R9.storage.get("flexSelectedMonth"),this.flexSelectedYear=R9.storage.get("flexSelectedYear")),b=jq(document.createElement("div")).addClass("col-1-3 col-1-4-l centre"),e=jq(document.createElement("div")).addClass("monthWrapper"),g=moment().add(a,"M").format("M"),f=moment().add(a,"M").daysInMonth(),d=moment().add(a,"M").format("Y"),h=jq(document.createElement("div")).addClass("monthName").text(moment().add(a,
"M").format("MMMM")),n=jq(document.createElement("div")).addClass("shortMonthName").text(moment().add(a,"M").format("MMM")),m=jq(document.createElement("div")).addClass("monthYear").text(moment().add(a,"M").format("Y")),this.flexSelectedMonth==g&&this.flexSelectedYear==d&&e.addClass("selected"),p.append(b.append(e.append(h,n,m).attr("data-month",g).attr("data-year",d).attr("data-end-of-month",f)));return c.html()},makeBelowCalendarHTML:function(){return""},runBelowCalendarCallback:function(){},makeMonthCalendarHTML:function(c,
a,b,e){var g=[];g.push("\x3cdiv class\x3d'r9-datepicker-month "+b+"'\x3e");g.push(this.makeMonthHeaderHTML(c,a,e));g.push(this.makeMonthBodyHTML(c,e));g.push("\x3c/div\x3e");return g.join("")},showMonth:function(c){var a=[];a.push("\x3cspan class\x3d'r9-datepicker-month-name'\x3e");a.push(c.format(this.options.titleMonthFormat).substring(0,1).toUpperCase()+c.format(this.options.titleMonthFormat).substring(1,this.options.titleMonthFormatLen));a.push("\x3c/span\x3e");return a.join("")},showYearWithSpecialSymbol:function(c){var a=
[],b;R9&&R9.globals&&(b=R9.globals.reverseDatePickerMonthAndYear);a.push("\x3cspan class\x3d'r9-datepicker-year'\x3e");a.push(c.format(this.options.titleYearFormat)+b+" ");a.push("\x3c/span\x3e");return a.join("")},showMonthAndYear:function(c){var a=[];a.push(this.showMonth(c));a.push(this.showYearWithSpecialSymbol(c));return a.join("")},makeMonthHeaderHTML:function(c,a,b){var e=[],g=moment().startOf("month"),f=moment().add(11,"months"),d=moment(a).startOf("month"),h=moment(a).endOf("month"),n=this.maxDate,
m=this.minDate,l=this.getStartDate&&moment(this.getStartDate()),r=this.getEndDate&&moment(this.getEndDate()),l=l&&h.isBefore(l)&&this.isPastDateAllowed(),r=r&&h.isBefore(r),m=m&&h.isBefore(m),n=n&&d.isAfter(n),g=!l&&!r&&(m||n||!this.isPastDateAllowed()&&h.isBefore(g)||d.isAfter(f));e.push("\x3cspan class\x3d'r9-datepicker-month-header'\x3e");e.push("\x3ca title\x3d'"+b+"' class\x3d'r9-datepicker-switch-month "+(g?"r9-datepicker-disabled":"r9-datepicker-enabled")+"' data-val\x3d'"+a.valueOf()+"'\x3e");
e.push(this.makeMonthHeaderPickerHTML(b));e.push("\x3c/a\x3e");e.push("\x3cspan class\x3d'r9-datepicker-month-title'\x3e");e.push(this.showMonthAndYear(c));e.push("\x3c/span\x3e");e.push("\x3c/span\x3e");return e.join("")},makeMonthHeaderPickerHTML:function(c){var a=[];a.push("\x3cspan\x3e");a.push(c);a.push("\x3c/span\x3e");return a},makeMonthBodyHTML:function(c,a){var b=[];b.push("\x3cspan class\x3d'r9-datepicker-month-body'\x3e");b.push(this.makeWeekDaysHTML(c));b.push(this.makeMonthDatesHTML(c,
a));b.push("\x3c/span\x3e");return b.join("")},makeWeekDaysHTML:function(c){c=[];c.push("\x3cspan class\x3d'r9-datepicker-month-days'\x3e");for(var a=0+this.getFirstWeekDay();a<7+this.getFirstWeekDay();a++){var b=a%7;c.push("\x3cspan class\x3d'r9-datepicker-day'\x3e");c.push(this.getVeryShortDayName(b));c.push("\x3c/span\x3e")}c.push("\x3c/span\x3e");return c.join("")},makeMonthDatesHTML:function(c,a){var b=[];b.push("\x3cspan class\x3d'r9-datepicker-month-dates'\x3e");var e=this.getMonthLeadDays(c),
g=this.getDaysInMonth(c),f=moment().startOf("day"),d=moment(c).subtract(1,"months").startOf("month"),h=d.daysInMonth(),n=moment(c).add(1,"months").startOf("month"),m=moment(f).add(1,"year"),l=this.maxDate,r,w,p,q,u=this.minDate,t=1;a=a.toLowerCase();this.getStartDate&&this.getStartDate();for(var v=0;42>v;v++){r=v-e+1;q=moment([c.year(),c.month(),r]);w=v%7;p=Math.ceil((v+1)/7);0==w&&b.push("\x3cspan class\x3d'r9-datepicker-month-row "+(this.loadBuzzData?this.buzzDataClass:"")+"' aria-label\x3d'Week "+
p+"' role\x3d'week'\x3e");if(v<e&&"prev"===a&&!this.advanceStyling){var x=moment([d.year(),d.month(),h+v-e+1]);p="r9-datepicker-item r9-datepicker-othermonth-item";p=(q.isBefore(f)||q.isAfter(m))&&!this.isPastDateAllowed()||u&&q.isBefore(u)||l&&q.isAfter(l)?p+" r9-datepicker-disabled":p+" r9-datepicker-enabled";this.addGraphBar(!1,x.valueOf());b.push("\x3cspan role\x3d'gridcell' class\x3d'"+p+"' data-val\x3d'"+x.valueOf()+"'\x3e");b.push("\x3cspan\x3e"+(h+v-e+1));this.loadBuzzData&&(this.buzzPrices?
b.push("\x3cspan class\x3d'buzz-price'\x3e\x3c/span\x3e"):(b.push("\x3cspan class\x3d'buzz-message'\x3eGreat price\x3c/span\x3e"),b.push("\x3ci\x3e\x3c/i\x3e")));b.push("\x3c/span\x3e\x3c/span\x3e")}else if(v>=e+g&&"next"===a&&!this.advanceStyling)x=moment([n.year(),n.month(),t]),p="r9-datepicker-othermonth-item r9-datepicker-item",p=(q.isBefore(f)||q.isAfter(m))&&!this.isPastDateAllowed()||u&&q.isBefore(u)||l&&q.isAfter(l)?p+" r9-datepicker-disabled":p+" r9-datepicker-enabled",b.push("\x3cspan role\x3d'gridcell' class\x3d'"+
p+"' data-val\x3d'"+x.valueOf()+"'\x3e"),b.push("\x3cspan\x3e"+t++),this.loadBuzzData&&(this.buzzPrices?b.push("\x3cspan class\x3d'buzz-price'\x3e\x3c/span\x3e"):(b.push("\x3cspan class\x3d'buzz-message'\x3eGreat price\x3c/span\x3e"),b.push("\x3ci\x3e\x3c/i\x3e"))),b.push("\x3c/span\x3e\x3c/span\x3e"),this.addGraphBar(!1,x.valueOf());else if(v>=e+g&&("next"!==a||this.advanceStyling))break;else v<e&&("Prev"!==a||this.advanceStyling)?b.push("\x3cspan role\x3d'gridcell' class\x3d'r9-datepicker-item r9-datepicker-disabled'\x3e\x3cspan\x3e\x26nbsp;\x3c/span\x3e\x3c/span\x3e"):
(p="r9-datepicker-item",(q.isBefore(f)||q.isAfter(m))&&!this.isPastDateAllowed()||u&&q.isBefore(u)||l&&q.isAfter(l)?(p+=" r9-datepicker-disabled",x=!1):(p+=" r9-datepicker-enabled",x=!0),q.isSame(f)&&(p+=" r9-datepicker-today"),b.push("\x3cspan role\x3d'gridcell' class\x3d'"+p+"' "),this.addGraphBar(x,q.valueOf()),b.push("data-val\x3d'"+q.valueOf()+"'"),b.push("\x3e\x3cspan\x3e"),b.push(r),this.loadBuzzData&&(this.buzzPrices?b.push("\x3cspan class\x3d'buzz-price'\x3e\x3c/span\x3e"):(b.push("\x3cspan class\x3d'buzz-message'\x3eGreat price\x3c/span\x3e"),
b.push("\x3ci\x3e\x3c/i\x3e"))),b.push("\x3c/span\x3e\x3c/span\x3e"));if(6==w&&(b.push("\x3c/span\x3e"),r===g||1<t))break}b.push("\x3c/span\x3e");return b.join("")},getFirstWeekDay:function(){return moment().startOf("week").day()},getVeryShortDayName:function(c){return moment().day(c).format("dd").substring(0,this.options.shortDayNameLen)},getMonthLeadDays:function(c){c=this.getFirstMonthDay(c)-this.getFirstWeekDay();0>c&&(c=6);return c},getFirstMonthDay:function(c){c=moment(c);c.startOf("month");
return c.day()},getDaysInMonth:function(c){return c.daysInMonth()},insideLastCalendar:function(c){return!!this.dropdown.find(".r9-datepicker-item-"+c).closest(".r9-datepicker-month").hasClass("r9-datepicker-month-last")},isPastDateAllowed:function(){return"undefined"!=this.options.allowPastDate?this.options.allowPastDate:!1},addGraphBar:function(c,a){this.options.showBuzzGraph&&(c=jq("\x3cdiv\x3e",{"class":"r9-datepicker-buzz-day "+(c?"r9-datepicker-enabled":"r9-datepicker-disabled"),"data-val":a}),
c.append(jq("\x3cdiv\x3e",{"class":"r9-datepicker-buzz-bar"})),this.buzzGraph.append(c))}}})(jq||jQuery);
(function(d){function c(a,b,e){var c,f,d,h,n,m=Date.now||function(){return(new Date).getTime()},l=function(){var g=m()-h;g<b&&0<=g?c=setTimeout(l,b-g):(c=null,e||(n=a.apply(d,f),c||(d=f=null)))};return function(){d=this;f=arguments;h=m();var g=e&&!c;c||(c=setTimeout(l,b));g&&(n=a.apply(d,f),d=f=null);return n}}R9.extend("Widgets",{DaterangePicker:function(a,b){R9.Widgets.BaseCalendarWidget.apply(this);this.elementNode=a;this.element=d(this.elementNode);this.validateElement()&&(this.startSection=d(R9.Widgets.DaterangePicker.findStartSection(this.elementNode)),
this.startDisplay=d(R9.Widgets.DaterangePicker.findStartDisplay(this.elementNode)),this.startPlaceholderDisplay=d(R9.Widgets.DaterangePicker.findStartPlaceholderDisplay(this.elementNode)),this.endSection=d(R9.Widgets.DaterangePicker.findEndSection(this.elementNode)),this.endDisplay=d(R9.Widgets.DaterangePicker.findEndDisplay(this.elementNode)),this.endPlaceholderDisplay=d(R9.Widgets.DaterangePicker.findEndPlaceholderDisplay(this.elementNode)),this.summaryDisplay=d(R9.Widgets.DaterangePicker.findSummaryDisplay(this.elementNode)),
this.clearDisplay=d(R9.Widgets.DaterangePicker.findClearDisplay(this.elementNode)),this.closeLink=d(R9.Widgets.DaterangePicker.findCloseLink(this.elementNode)),this.tabInput=d(R9.Widgets.DaterangePicker.findTabInput(this.elementNode)),this.startInput=d(R9.Widgets.DaterangePicker.findStartInput(this.elementNode)),this.endInput=d(R9.Widgets.DaterangePicker.findEndInput(this.elementNode)),this.options=d.extend({},this.options,b),this.init())}});R9.extend("Widgets.DaterangePicker",{isDatepicker:function(a){return a&&
a.nodeName&&"div"==a.nodeName.toLowerCase()},isWidgetControlled:function(a){return d(a).hasClass(R9.Widgets.DaterangePicker.prototype.widgetBaseClass+"-wrapper")},findStartSection:function(a){return d(a).closest("form").find("#"+a.id+"-start")},findStartDisplay:function(a){return d(a).closest("form").find("#"+a.id+"-start-display")},findStartPlaceholderDisplay:function(a){return d(a).closest("form").find("#"+a.id+"-start-placeholder")},findEndSection:function(a){return d(a).closest("form").find("#"+
a.id+"-end")},findEndDisplay:function(a){return d(a).closest("form").find("#"+a.id+"-end-display")},findEndPlaceholderDisplay:function(a){return d(a).closest("form").find("#"+a.id+"-end-placeholder")},findSummaryDisplay:function(a){return d(a).closest("form").find("#"+a.id+"-summary-display")},findClearDisplay:function(a){return d(a).closest("form").find("#"+a.id+"-clear")},findCloseLink:function(a){return d(a).closest("form").find("#"+a.id+" .r9-datepicker-title-close")[0]},findStartInput:function(a){return d(a).closest("form").find("#"+
a.id+" .r9-datepicker-input.r9-datepicker-start")[0]},findEndInput:function(a){return d(a).closest("form").find("#"+a.id+" .r9-datepicker-input.r9-datepicker-end")[0]},findTabInput:function(a){return d(a).closest("form").find("#"+a.id+"-tab")},getDropdownId:function(a){return"datepicker"},getDropdownEl:function(a){return jq(a).find("#datepicker")}});R9.extend("Widgets.DaterangePicker.prototype",!0,R9.Widgets.BaseCalendarWidget.prototype,{widgetName:"datepicker",widgetId:"datepicker",widgetBaseClass:"r9-datepicker",
accessibilityBreakpoint:768,elementNode:null,element:null,startSection:null,startDisplay:null,startPlaceholderDisplay:null,endSection:null,endDisplay:null,endPlaceholderDisplay:null,summaryDisplay:null,clearDisplay:null,closeLink:null,startInput:null,endInput:null,tabInput:null,clicks:[],timers:null,hideTimeoutValue:100,unitFormat:null,unitAdjustment:0,preventBlur:!1,actOnStart:!0,buzzCall:!1,canShowCalendar:!0,canCloseCalendar:!0,options:{initAccessibility:!1,accessible:!0,appendTo:"body",dateItemsSelector:"span.r9-datepicker-item",
shortDayNameLen:1,title:"Prev",prevTitle:"Prev",nextTitle:"Next",offsetWidth:0,titleMonthFormat:"MMMM",titleYearFormat:"YYYY",startFormat:"ddd MMM D",startInputFormat:"YYYY/M/D",endFormat:"ddd MMM D",endInputFormat:"YYYY/M/D",nightsFormat:"0#same day|1#{0} night|2#{0} nights",daysFormat:"0#same day|1#{0} day|2#{0} days",useDaysFormat:!1,secondClickHideDelay:200,minRangeDays:0,change:null,show:null,hide:null,minDateFunc:null,focusAfterClick:!0,allowPastDate:!1,widgetId:null,useLongDisplayFormat:!1,
singlePickerWithSingleField:!1,showBuzzGraph:!1,originControl:!1,destControl:!1,isOneWay:!1,skipForceSetDefaultStartOnFocusBlur:!1,skipForceSetDefaultEndOnFocusBlur:!1,doNotFillWhenEmpty:!1,datepickerWrapperSelector:".r9-datepicker-wrapper",handleNegativeSummary:!0,delayShowDropdown:null,showDropdownDelay:200},getWidgetId:function(){this.options&&this.options.widgetId&&(this.widgetId=this.options.widgetId);return this.widgetId},getDropdownId:function(a){return this.options&&this.options.widgetId?
this.options.widgetId:R9.Widgets.DaterangePicker.getDropdownId(a)},getDropdownEl:function(a){return this.options&&this.options.widgetId?jq(a).find("#"+this.options.widgetId):R9.Widgets.DaterangePicker.getDropdownEl(a)},isAccessibilityEnabled:function(){return this.options.initAccessibility},init:function(){this.options.useDaysFormat?(this.unitFormat=this.options.daysFormat,this.unitAdjustment=1):(this.unitFormat=this.options.nightsFormat,this.unitAdjustment=0);this.options.useLongDisplayFormat&&(this.options.startFormat=
this.options.startInputFormat,this.options.endFormat=this.options.endInputFormat);this.advanceStyling&&(this.options.skipForceSetDefaultStartOnFocusBlur=!0,this.options.skipForceSetDefaultEndOnFocusBlur=!0,this.options.doNotFillWhenEmpty=!0);this.options.offsetWidth=2;this.initDropdown();this.timers={};this.bindEvent(this.tabInput,"focus",this.handleInputFocusEvent);this.bindEvent(this.tabInput,"blur",this.handleInputBlurEvent);this.bindEvent(this.tabInput,"keydown",this.handleInputKeydownEvent);
this.bindEvent(this.element,"mousedown",this.handleElementClickEvent);this.endStartIsSameField()||this.bindEvent(this.endSection,"mousedown",this.handleEndClickEvent);this.bindEvent(this.startSection,"mousedown",this.handleStartClickEvent);this.bindEvent(this.clearDisplay,"mousedown",this.handleClearClickEvent);this.bindEvent(this.closeLink,"mousedown",this.handleClearClickEvent);this.bindEvent(this.dropdown,"mousedown",this.handleDropdownClickEvent);this.bindEvent(this.overlay,"mousedown",this.handleItemClickEvent);
this.element.data(this.widgetName,this);this.update();var a=this.element.find(".r9-datepicker-display");void 0!==a&&1<a.length||(this.element.off("mousedown focus").on("mousedown focus",function(a){a.preventDefault();a.stopPropagation();jq(this).find(".r9-datepicker-display").focus();jq("body").trigger("event",[a])}),this.bindCommandUtilities(),this.start_custom_value=this.end_custom_value="",this.utils=this.options.commands.utilities,this.today=moment().startOf("day").toDate(),this.bindAccessibilityEvents(),
this.updateClicks(),this.updateDOM())},validateElement:function(){return R9.Widgets.DaterangePicker.isDatepicker(this.elementNode)&&R9.Widgets.DaterangePicker.isWidgetControlled(this.elementNode)&&void 0===this.element.data(this.widgetName)},bindEvent:function(a,b,e){var c=this;b+="."+this.getWidgetId();a.off(b).on(b,function(a){return e.call(c,this,a)})},bindCommandUtilities:function(){var a=this;this.options.commands={keys:{TAB:9,ENTER:13,UP:38,DOWN:40,LEFT:37,RIGHT:39,DOLLAR:52,CARAT:54,ESC:27},
utilities:{changeCalendar:function(b,e){e=e||1;var c=a.dropdown.find(".r9-datepicker-switch-month.r9-datepicker-enabled"),c="prev"===b?c.first():c.last();for(b=Math.abs(e);0<b;b--)a.handleNextPrevClickEvent(c);return a},isCharacterKeyPress:function(b){var e=a.options.commands.keys;return"undefined"==typeof b.which?!0:"number"==typeof b.which&&0<b.which?!b.ctrlKey&&!b.metaKey&&!b.altKey&&b.keyCode!=e.TAB&&b.keyCode!=e.ENTER&&16!=b.keyCode&&b.keyCode!=e.UP&&b.keyCode!=e.DOWN&&b.keyCode!=e.LEFT&&b.keyCode!=
e.RIGHT:!1},getRowInfo:function(b){b=a.dropdown.find(".r9-datepicker-item-"+b);var e=b.parent().children().not(".r9-datepicker-disabled");return{len:e.length-1,index:e.index(b)}},isValidDateObject:function(a){return a instanceof Date?!isNaN(a.getTime()):this.isValidDate(new Date(a))},isValidDatePair:function(a,e){return moment(a).isBefore(moment(e))},isValidDate:function(b){return this.isValidDateObject(b)&&(this.isValidDatePair(moment().subtract(1,"d"),moment(b))||a.isPastDateAllowed())},applyEndVal:function(){if(""!==
a.end_custom_value&&moment(a.end_custom_value,a.options.endInputFormat).isValid()){var b=this.formatLocaleDate(a.end_custom_value,a.options.endInputFormat);if(b&&this.isValidDate(b)){var e=a.getStartDate()||a.today;this.isValidDatePair(e,b)&&a.setEndDate(b);a.fetchBuzzData();a.options.change&&a.options.change.call(a);a.end_custom_value=""}}},applyStartVal:function(){if(""!==a.start_custom_value&&moment(a.start_custom_value,a.options.startInputFormat).isValid()){var b=this.formatLocaleDate(a.start_custom_value,
a.options.startInputFormat);if(b&&this.isValidDate(b)){a.setStartDate(b);var e=a.getEndDate()||a.today;this.isValidDatePair(b,e)||a.setEndDate(b);a.start_custom_value="";a.fetchBuzzData();a.options.change&&a.options.change.call(a)}}},validate:function(b){b=b||moment().startOf("day").toDate();return!a.isPastDateAllowed()&&b.getTime()<=a.today.getTime()?a.today:b},formatLocaleDate:function(b,e){e=e||a.options.startInputFormat;try{var c=b.split(/\D+/g)[2];4!==c.length&&(b=b.substr(0,b.length-2)+"20"+
c);return moment(b,e).toDate()}catch(f){return new Date}},incrementDay:function(b,e,c){c=c||jq.noop;b=moment(b).add(e||1,"days");c.call(a,this.validate(b.toDate()));return b},decrementDay:function(b,e,c){c=c||jq.noop;b=moment(b).subtract(e||1,"days");c.call(a,this.validate(b.toDate()));return b},dateDiff:function(a,e){return(a.getTime()-e.getTime())/864E5}}};this.utils=this.options.commands.utilities;return this},bindAccessibilityEvents:function(){var a=this;this.options.accessible="true"===jq(this.startDisplay).attr("contenteditable");
jq(this.startDisplay).attr("aria-label")||jq(this.startDisplay).attr({"aria-label":this.options.startLabel||"Start Date"});jq(this.endDisplay).attr("aria-label")||jq(this.endDisplay).attr({"aria-label":this.options.endLabel||"End Date"});this.clickTarget=this.blurTarget=null;jq(document).mousedown(function(b){a.clickTarget=jq(b.target);a.isDropdownVisible()&&jq(a.blurTarget).blur()}).mouseup(function(b){a.clickTarget=null});this.endStartIsSameField()||(this.bindEvent(this.endDisplay,"focus",this.handleEndDisplayFocusEvent),
this.bindEvent(this.endDisplay,"blur",this.handleEndDisplayBlurEvent),this.bindEvent(this.endDisplay,"keydown",this.handleEndDisplayKeydownEvent),this.bindEvent(this.endDisplay,"keyup",this.handleEndDisplayKeyupEvent));this.bindEvent(this.startDisplay,"focus",this.handleStartDisplayFocusEvent);this.bindEvent(this.startDisplay,"blur",this.handleStartDisplayBlurEvent);this.bindEvent(this.startDisplay,"keydown",this.handleStartDisplayKeydownEvent);this.bindEvent(this.startDisplay,"keyup",this.handleStartDisplayKeyupEvent);
this.isAccessibilityEnabled()&&(this.bindEvent(jq(document),"keypress",this.handleItemKeypressEvent),this.bindEvent(jq(document),"click",this.handleOutsideClickEvent))},handleClearClickEvent:function(a,b){this.clearDaterange();b.stopPropagation();this.fetchBuzzData();this.options.change&&this.options.change.apply(this,arguments);jq("body").trigger("event",[b]);return!this.element.hasClass("r9-datepicker-focus")},handleElementClickEvent:function(a,b){return this.isDropdownVisible()?this.handleClickEvent(a,
b,this.actOnStart):this.handleStartClickEvent(a,b)},handleStartClickEvent:function(a,b){return this.handleClickEvent(a,b,!0)},handleEndClickEvent:function(a,b){return this.handleClickEvent(a,b,!1)},handleClickEvent:function(a,b,e){this.actOnStart=e;var c=this.getWrapperElement(),f=this;!this.isDropdownVisible()&&this.options.focusAfterClick?setTimeout(function(){f.isDropdownVisible()||c.find(".r9-datepicker-tab").focus()},1):(this.markDropdownElements(),this.preventBlur=!0);b.stopPropagation();jq("body").trigger("event",
[b]);return!0},getWrapperElement:function(){return this.element},getStartWrapperElement:function(){return this.element},getEndWrapperElement:function(){return this.element},handleDropdownClickEvent:function(a,b){return!1},handleInputKeydownEvent:function(a,b){if(!a.disabled){var e=b.keyCode?b.keyCode:b.which,c=jq(a).parent();switch(e){case 9:return!0;case 27:this.isDropdownVisible()&&this.hideDropdown(c);break;case 32:this.isDropdownVisible()?this.hideDropdown(c):(this.actOnStart=!0,this.showDropdown(c));
break;case 8:this.clearDaterange(),this.fetchBuzzData(),this.options.change&&this.options.change.apply(this,arguments)}return!1}},handleInputFocusEvent:function(a,b){if(!a.disabled){this.preventBlur=!1;var e=jq(a).parent();this.addFocusClass(e);this.isDropdownVisible()||this.showDropdown(e);this.options.focus&&this.options.focus.apply(this,arguments)}},handleInputBlurEvent:function(a,b){if(this.preventBlur)return this.preventBlur=!1,setTimeout(function(){a.focus()},1),!1;if(a.disabled)return!0;this.hideDropdown(jq(a).parent());
this.options.blur&&this.options.blur.apply(this,arguments);return!0},handleItemHoverEvent:function(a,b){a=jq(a);a.hasClass("r9-datepicker-enabled")&&this.updateDropdownSelection(a);jq(".r9-datepicker-buzz-day[data-val\x3d%s]".format(a.attr("data-val"))).addClass("hover");return!1},handleItemHoverEndEvent:function(a,b){this.updateDropdownSelection(null);jq(".r9-datepicker-buzz-day[data-val\x3d%s]".format(jq(a).attr("data-val"))).removeClass("hover");return!1},handleItemKeypressEvent:function(a,b){if(13===
b.which&&jq(b.target).is(this.options.dateItemsSelector))return a=jq(b.target).closest(this.options.dateItemsSelector),b.stopPropagation(),b.preventDefault(),b.cancelBubble=!0,this.clickTarget=a,this.handleItemClickEvent(a,b),!1;if(13===b.which&&jq(b.target).is(".r9-datepicker-switch-month.r9-datepicker-enabled"))return a=jq(b.target).closest(".r9-datepicker-switch-month.r9-datepicker-enabled"),b.stopPropagation(),b.preventDefault(),b.cancelBubble=!0,this.clickTarget=a,this.handleNextPrevClickEvent(a,
b),!1},handleOutsideClickEvent:function(a,b){this.clickTarget=d(b.target);this.isDropdownVisible()&&!this.clickTarget.closest(".r9-datepicker, .r9-datepicker-wrapper").length&&(this.clickTarget=null,b.stopPropagation(),this.hideDropdown())},focusSelectedDay:function(a){var b=this;this.isAccessibilityEnabled()&&a&&a.length&&(this.clickTarget=null,this.dropdown.attr("tabindex",-1),this.dropdown.removeClass("r9-calendar-no-outline").addClass("r9-calendar-no-outline"),this.setTabIndexes(this.dropdown.find(".r9-datepicker-switch-month.r9-datepicker-enabled, .r9-datepicker-item.r9-datepicker-enabled")),
this.timers.focusTimeout&&clearTimeout(this.timers.focusTimeout),b.setCanClose(!1),this.timers.focusTimeout=window.setTimeout(function(){var e=b.isEndWrapper(a)?b.dropdown.find(".r9-datepicker-item-end"):b.dropdown.find(".r9-datepicker-item-start");e.length||(e=b.dropdown.find(".r9-datepicker-item.r9-datepicker-enabled").first()||null);e&&e.length&&e.focus();b.timers.setCanClose&&clearTimeout(b.timers.setCanClose);b.timers.setCanClose=setTimeout(function(){b.setCanClose(!0)},200)},300))},isEndWrapper:function(a){return a&&
this.isEndWrapperId(a.attr("id"))},isEndWrapperId:function(a){return a&&"travel_dates-end-wrapper"==a},setTabIndexes:function(a){(a=jq(a))&&0!==a.length&&a.each(function(){jq(this).attr("tabindex","0")})},focusDisplay:function(a){var b=this;if(this.isAccessibilityEnabled()){var e=jq("#"+a);e&&0!==e.length&&(this.timers.focusDisplayTimeout&&clearTimeout(this.timers.focusDisplayTimeout),!this.isDropdownVisible()&&this.clickTarget&&this.clickTarget.closest(".r9-datepicker").length&&(this.clickTarget=
null,this.addFocusClass(e),this.setCanShow(!1),this.setCanClose(!1),this.timers.focusDisplayTimeout=window.setTimeout(function(){e.find(".r9-datepicker-tab").focus();b.timers.setCanShow&&clearTimeout(b.timers.setCanShow);b.timers.setCanShow=setTimeout(function(){b.setCanShow(!0);b.setCanClose(!0)},200)},1)))}},canShow:function(){return!this.isAccessibilityEnabled()||this.canShowCalendar},setCanShow:function(a){this.canShowCalendar=a},canClose:function(){return!this.isAccessibilityEnabled()||this.canCloseCalendar},
setCanClose:function(a){this.canCloseCalendar=a},clearFocusClass:function(){this.removeFocusClass(jq(".r9-datepicker-focus"))},removeFocusClass:function(a){a.removeClass("r9-datepicker-focus")},addFocusClass:function(a){this.clearFocusClass();a.addClass("r9-datepicker-focus")},handleItemClickEvent:function(a,b){if(!0===this.isBeforeStart(a)&&!1===this.actOnStart)return this.preventBlur=!0,b.preventDefault(),this;var e=this,c=jq(a),f,d;if(c.hasClass("r9-datepicker-enabled")){f=parseInt(c.attr("data-val"));
var h=this.actOnStart;d=h?1:0;this.clicks[h?0:1]=f;this.clicks[0]&&this.clicks[1]&&(c=moment(this.clicks[1]).diff(this.clicks[0],"days"),c<this.options.minRangeDays&&(this.clicks[d]=0));this.updateDropdownSelection(null);this.clicks[0]&&this.clicks[1]?setTimeout(function(){e.hideDropdown(e.element);e.options.change&&e.options.change.apply(e,[f,h]);e.options.nextFieldSelector&&jq(e.options.nextFieldSelector).focus()},this.options.secondClickHideDelay):this.switchActOn()}this.updateDOM();jq(a).trigger("daterangepicker.itemclicked");
jq("body").trigger("event",[b]);return!1},switchActOn:function(){this.actOnStart=!this.actOnStart;this.markDropdownElements()},computeHighlitedRange:function(a){var b=[this.clicks[0],this.clicks[1]];return b[0]&&b[1]?b:0==a?[0,0]:this.actOnStart?[a,this.clicks[1]]:this.clicks[0]?[this.clicks[0],a]:[0,0]},computeItemState:function(a,b,e,c,f){var g=!1;this.advanceStyling||(a==b?this.actOnStart?(c.hover=!0,c.start=!0):(c.hover=!0,c.end=!0,c.highlighted=f&&f.highlighted):(c.beforeStart=a<this.clicks[0]&&
!this.actOnStart,a==this.clicks[0]?(c.start=!0,c.selected=!0):a==this.clicks[1]&&(c.selected=!0,c.end=!0,c.highlighted=f&&f.highlighted,f&&f.selected&&(c.tight=!0,g=f.tight=!0)),a>e[0]&&a<e[1]&&(c.highlighted=!0,f&&f.start&&(g=f.highlighted=!0))));this.advanceStyling&&(delete c.beforeStart,delete c.hover,a>e[0]&&a<e[1]&&(c.highlighted=!0),a===this.clicks[0]&&(c.start=!0,c.selected=!0),a===this.clicks[1]&&(c.selected=!0,c.end=!0),0<b&&(e=this.getStateStartPoint(b),(this.actOnStart&&e===this.clicks[0]||
!this.actOnStart&&e===this.clicks[1])&&e&&(f=Math.max(e,b),a>Math.min(e,b)&&a<f&&(c.tempHighlight=!0))));return g},getStateStartPoint:function(a){var b=[],e=!0,c=!0,f=this.clicks[0];0<f&&(e=e&&f<a,c=c&&f>a,b.push(f));f=this.clicks[1];0<f&&(e=e&&f<a,c=c&&f>a,b.push(f));a=e?Math.max.apply(null,b):Math.min.apply(null,b);e=!(!1===c&&!1===e);return isFinite(a)?e?a:0:null},updateItem:function(a,b){var e,c;e=[];c=[];b.highlighted?e.push("r9-datepicker-item-highlighted"):c.push("r9-datepicker-item-highlighted");
b.hover?e.push("r9-datepicker-item-hover"):c.push("r9-datepicker-item-hover");b.selected?(e.push("r9-datepicker-item-selected"),a.attr("aria-selected",!0)):(c.push("r9-datepicker-item-selected"),a.attr("aria-selected",!1));b.start?e.push("r9-datepicker-item-start"):c.push("r9-datepicker-item-start");b.beforeStart?e.push("r9-datepicker-before-start"):c.push("r9-datepicker-before-start");b.end?e.push("r9-datepicker-item-end"):c.push("r9-datepicker-item-end");b.tight?e.push("r9-datepicker-item-tight"):
c.push("r9-datepicker-item-tight");this.advanceStyling&&(b.tempHighlight?e.push("r9-datepicker-item-tempHighlight"):c.push("r9-datepicker-item-tempHighlight"));a.removeClass(c.join(" "));a.addClass(e.join(" "))},updateDropdownSelection:function(a){if(!this.advanceStyling&&!0===this.isBeforeStart(a)&&!1===this.actOnStart)return this;var b=this,c=[0,0],g=null,f=null,d=this.dropdown.find(this.options.dateItemsSelector),h=0;a&&(h=parseInt(jq(a).attr("data-val")));c=this.computeHighlitedRange(h);d.each(function(a,
e){e=jq(e);a=parseInt(e.attr("data-val"));var d={};b.computeItemState(a,h,c,d,f)&&b.updateItem(g,f);b.updateItem(e,d);g=e;f=d});this.updateHoverDOM(a)},clearDaterange:function(a){"undefined"!=typeof a?this.clicks[a]=0:this.clicks=[0,0];this.isDropdownVisible()&&this.updateDropdownSelection();this.updateDOM()},updateHoverDOM:function(a){var b,c,d,f;c=this.clicks[0];d=this.clicks[1];a&&(b=parseInt(a.attr("data-val")),this.actOnStart?c=b:d=b);c?(f=moment(c),this.startDisplay.text(f.format(this.options.startFormat)),
this.getStartWrapperElement().removeClass("r9-datepicker-start-empty")):this.getStartWrapperElement().addClass("r9-datepicker-start-empty");d?(b=moment(d),this.endDisplay.text(b.format(this.options.endFormat)),this.summaryDisplay&&(f=b.diff(f,"days"),(b=this.options.handleNegativeSummary&&0>f)&&a&&this.actOnStart?(this.endDisplay.text(this.endPlaceholderDisplay.text()),this.summaryDisplay.text("")):b||this.summaryDisplay.text(R9.Common.Utils.String.formatChoice(this.unitFormat,f+this.unitAdjustment,
f+this.unitAdjustment))),this.getEndWrapperElement().removeClass("r9-datepicker-end-empty")):this.getEndWrapperElement().addClass("r9-datepicker-end-empty")},updateDOM:function(){var a,b,c;if(0!=this.clicks[0]){if(a=moment(this.clicks[0]),this.startDisplay.text(a.format(this.options.startFormat)),this.startInput.val(a.format(this.options.startInputFormat)),this.wholeMonthSearch){var d,f;"wholeMonthSearch"==("undefined"!==typeof R9.storage.get("daterangePickerDefaultNavTab")?R9.storage.get("daterangePickerDefaultNavTab"):
"specificDate")&&jq(".searchform.rtow").hasClass("roundtrip")&&("undefined"!==typeof R9.storage&&(null===R9.storage.get("flexSelectedMonth")&&R9.storage.set("flexSelectedMonth",moment(this.clicks[0]).format("M")),null===R9.storage.get("flexSelectedYear")&&R9.storage.set("flexSelectedYear",moment(this.clicks[0]).format("Y")),null===R9.storage.get("flexNoOfNights")&&R9.storage.set("flexNoOfNights","6-8"),d=R9.storage.get("flexSelectedMonth"),f=R9.storage.get("flexSelectedYear"),c=R9.storage.get("flexNoOfNights")),
a=moment(new Date(f,d-1,1)),a.isBefore(moment())&&(a=moment().add(1,"d")),d="string"===typeof c?c.replace("-"," to "):c,c=1==c?"night":"nights",this.startDisplay.text(a.format("MMMM")+" "+a.format("Y")+", "+d+" "+c),this.startInput.val(a.format(this.options.startInputFormat)))}}else this.startDisplay.text(""),this.startInput.val("");this.endStartIsSameField()||(0!=this.clicks[1]?(b=moment(this.clicks[1]),this.endDisplay.text(b.format(this.options.endFormat)),this.endInput.val(b.format(this.options.endInputFormat))):
(this.endDisplay.text(""),this.endInput.val("")));this.summaryDisplay&&(null!=a&&null!=b?(c=b.diff(a,"days"),this.summaryDisplay.text(R9.Common.Utils.String.formatChoice(this.unitFormat,c+this.unitAdjustment,c+this.unitAdjustment))):this.summaryDisplay.text(""));null==a?this.getStartWrapperElement().addClass("r9-datepicker-start-empty"):this.getStartWrapperElement().removeClass("r9-datepicker-start-empty");this.endStartIsSameField()||(null==b?this.getEndWrapperElement().addClass("r9-datepicker-end-empty"):
this.getEndWrapperElement().removeClass("r9-datepicker-end-empty"))},endStartIsSameField:function(){var a=this.getStartWrapperElement().get(0).id,b=this.getEndWrapperElement().get(0).id;return a===b&&!0===this.options.singlePickerWithSingleField},updateClicks:function(){this.clicks=[0,0];var a;this.startInput.val()&&(a=moment(this.startInput.val(),this.options.startInputFormat),null!=a&&a.isValid()&&(this.clicks[0]=a.valueOf()));this.endInput.val()&&(a=moment(this.endInput.val(),this.options.endInputFormat),
null!=a&&a.isValid()&&(this.clicks[1]=a.valueOf()))},handleNextPrevClickEvent:function(a,b){a=moment(parseInt(jq(a).attr("data-val")));this.dropdown[0].innerHTML=this.makeCalendarHTML(a);this.runBelowCalendarCallback();this.options.showBuzzGraph&&(this.bindBuzzGraphEvents(),this.displayBuzzGraph());this.updateDropdownSelection(null);this.loadBuzzData&&this.displayBuzzData();this.focusSelectedDay(jq("#"+this.dropdown.prop("data-owner")));return!1},bindItemEvent:function(a,b){var c=this;this.dropdown.off(a,
this.options.dateItemsSelector).on(a,this.options.dateItemsSelector,function(a){return b.call(c,this,a)})},bindOverlayEvent:function(a,b){var c=this;this.overlay.off(a).on(a,function(a){return b.call(c,this,a)})},bindNextPrevEvent:function(a,b){var c=this;this.dropdown.off(a,".r9-datepicker-switch-month.r9-datepicker-enabled").on(a,".r9-datepicker-switch-month.r9-datepicker-enabled",function(a){return b.call(c,this,a)})},bindCloseEvent:function(a,b){var c=this;this.dropdown.off(a,".r9-datepicker-close").on(a,
".r9-datepicker-close",function(a){return b.call(c,this,a)})},initDropdown:function(){var a=this.getDropdownId(this.element),b=this.getDropdownEl(this.element).get(0);if(null==b){var c=R9.Widgets.DaterangePicker.prototype.widgetBaseClass;this.options.dropdownClass&&(c=c+" "+this.options.dropdownClass);b=jq("\x3cdiv\x3e\x3c/div\x3e",{id:a,css:{display:"none",position:"absolute",zIndex:10009}}).appendTo(this.options.appendTo)[0];jq(b).addClass(c);this.advanceStyling&&jq(b).addClass("r9-advance-styling");
this.wholeMonthSearch&&jq(b).addClass("CalendarWidget-WholeMonthSearch")}this.dropdown=jq(b);this.overlay=jq("#"+this.widgetBaseClass+"-overlay");this.overlay.length||(this.overlay=jq('\x3cdiv id\x3d"'+this.widgetBaseClass+'-overlay" class\x3d"'+this.widgetBaseClass+'-overlay"\x3e\x3c/div\x3e').appendTo(this.options.appendTo))},debounceChangeFn:function(){this._debouncedChange&&this._debouncedChange.apply(this,arguments);this._debouncedChange=c(this.options.change||function(){},20);this._debouncedChange.apply(this,
arguments)},isDropdownVisible:function(){return"none"!=this.dropdown.css("display")},markDropdownElements:function(){this.unmarkDropdownElements();this.element.addClass("r9-datepicker-dropdown");this.actOnStart?this.element.addClass("r9-datepicker-dropdown-start"):this.element.addClass("r9-datepicker-dropdown-end")},unmarkDropdownElements:function(){this.element.removeClass("r9-datepicker-dropdown r9-datepicker-dropdown-start r9-datepicker-dropdown-end")},positionDropdown:function(a){var b=a.offset(),
c=jq(this.options.appendTo).offset(),d=0,f=this.dropdown[0].style;this.dropdown.parent()[0]===jq(document.body)[0]&&(d=parseInt((jq(document.body).css("top")||"0").replace("-",""))||0);jq("#datepicker").removeClass("r9-datepicker-responsive-right-position");if(606>jq(window).width()&&jq(".fdSearchForm-hotel").length&&jq("#travel_dates-end-wrapper").hasClass("r9-datepicker-focus")){jq("#datepicker").addClass("r9-datepicker-responsive-right-position");var k=b.left-c.left-144}else{var k=b.left-c.left,
h=k+this.dropdown.outerWidth();h>window.innerWidth&&(h-=window.innerWidth,k=k-h-15,this.dropdown.find(".r9-datepicker-pointer").css("left",h+36+"px"))}f.left=k+"px";f.top=d+b.top+a.outerHeight()-c.top+"px"},_hideDropdown:function(a){if("none"==this.dropdown.css("display")||null!=a&&this.dropdown.prop("data-owner")!=a.attr("id"))return!1;this.clearFocusClass();this.options.hide&&this.options.hide.apply(this,arguments);this.hideOverlay();this.preventBlur=!1;this.updateDOM();this.unmarkDropdownElements();
this.dropdown.hide();this.actOnStart=!0;this.focusDisplay(this.dropdown.prop("data-owner"));jq(window).unbind("resize",this.resizeHandler);return!0},hideDropdown:function(a){var b=this;if(!this.canClose())return!1;this.clearFocusClass();if("none"==this.dropdown.css("display")||null!=a&&this.dropdown.prop("data-owner")!=a.attr("id")||this.preventBlur)return this.preventBlur=!1;this.options.hide&&this.options.hide.apply(this,arguments);this.preventBlur=!1;this.updateDOM();this.unmarkDropdownElements();
this.actOnStart=!0;this.timers.hideTimeout&&clearTimeout(this.timers.hideTimeout);this.timers.hideTimeout=setTimeout(function(){b._hideDropdown.call(b,a)},this.hideTimeoutValue)},hideMultipleDropdowns:function(){this.options.datepickerWrapperSelector&&jq(this.options.datepickerWrapperSelector).not(this.getStartWrapperElement()).not(this.getEndWrapperElement()).each(function(a,b){jq(b).daterangePickerTwoFields("hideDropdown")})},showDropdown:function(a){this.timers.hideTimeout&&clearTimeout(this.timers.hideTimeout);
if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.showDropdown.bind(this,a),this.options.showDropdownDelay);else if(null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null),this.canShow()){this.options.show&&this.options.show.apply(this,arguments);this.hideMultipleDropdowns();this.showOverlay();this.markDropdownElements();this.updateClicks();"function"===
typeof this.options.minDateFunc&&this.options.minDateFunc(this);this.dropdown[0].innerHTML=this.makeCalendarHTML(!this.actOnStart&&this.clicks[1]?this.clicks[1]:this.clicks[0]);this.updateDropdownSelection(null);var b=R9.Widgets.DaterangePicker.prototype.widgetBaseClass;this.options.dropdownClass&&(b=b+" "+this.options.dropdownClass);this.addFocusClass(a);this.dropdown.addClass(b);b=this.dropdown[0].style;this.runBelowCalendarCallback();this.positionDropdown(a);var c=this,d=jq(window).width();this.resizeHandler=
function(){var b=jq(window).width();10<Math.abs(b-d)&&(d=b,c.positionDropdown(a))};jq(window).on("resize",this.resizeHandler);this.bindItemEvent("mousedown",this.handleItemClickEvent);if(R9.globals.isTouch){var f=this;this.bindOverlayEvent("mousedown",function(){f.hideDropdown(f.element)})}else this.bindItemEvent("mouseover",this.handleItemHoverEvent),this.bindItemEvent("mouseout",this.handleItemHoverEndEvent);this.options.showBuzzGraph&&(this.bindBuzzGraphEvents(),this.displayBuzzGraph());this.bindNextPrevEvent("mousedown",
this.handleNextPrevClickEvent);this.bindCloseEvent("mousedown",function(){c.hideDropdown(c.element)});this.dropdown.prop("data-owner",a.attr("id"));this.loadBuzzData&&this.displayBuzzData();b.display="inline";this.focusSelectedDay(a)}},showOverlay:function(){this.overlay.show()},displayBuzzData:function(){"function"===typeof this.options.getFormData&&(new R9.DatePicker.BuzzData).update(this.dropdown,this.options.getFormData(this.actOnStart))},hideOverlay:function(){this.overlay.hide()},getStartDate:function(){this.updateClicks();
return 0!=this.clicks[0]?new Date(this.clicks[0]):null},getEndDate:function(){this.updateClicks();return 0!=this.clicks[1]?new Date(this.clicks[1]):null},parseDateString:function(a,b){try{return moment(a,b||this.options.startInputFormat)._d}catch(e){return""}},setFocusAfterClick:function(a){this.options.focusAfterClick=a},setStartDate:function(a){a?("string"===typeof a?a=this.parseDateString(a,this.options.startInputFormat):"number"===typeof a?a=new Date(a):"object"===typeof a?moment.isMoment(a)?
a.isValid()&&(a=a.toDate()):moment(a).isValid()&&(a="toDate"in a?a.toDate():a):a=new Date(0),void 0!=a.getTime&&(this.clicks[0]=a.getTime())):this.clicks[0]=0;this.updateDOM()},setEndDate:function(a){a?("string"===typeof a?a=this.parseDateString(a,this.options.endInputFormat):"number"===typeof a?a=new Date(a):"object"===typeof a?moment.isMoment(a)?a.isValid()&&(a=a.toDate()):moment(a).isValid()&&(a="toDate"in a?a.toDate():a):a=new Date(0),void 0!=a.getTime&&(this.clicks[1]=a.getTime())):this.clicks[1]=
0;this.updateDOM()},setUseDaysFormat:function(a){this.options.useDaysFormat=a;this.options.useDaysFormat?(this.unitFormat=this.options.daysFormat,this.unitAdjustment=1):(this.unitFormat=this.options.nightsFormat,this.unitAdjustment=0)},update:function(){this.updateClicks();this.updateDOM()},isBeforeStart:function(a){a instanceof jq&&(a=jq(a).attr("data-val"));return a&&null!==this.getStartDate()&&moment(parseInt(a)).isBefore(this.getStartDate())?!0:!1},decrementEndDay:function(a){var b=this.insideLastCalendar("end"),
c=this.getEndDate()||this.today,d=this.getStartDate()||this.today;a=this.utils.decrementDay(c,a);a.date()!==a.daysInMonth()||b||this.prevCalendar();d&&moment(c)>moment(d)&&this.setEndDate(a.toDate());this.fetchBuzzData();this.debounceChangeFn();this.updateDropdownSelection();return this.getEndDate()},decrementStartDay:function(a){var b=this.insideLastCalendar("start");a=this.utils.decrementDay(this.utils.validate(this.getStartDate()),a,this.setStartDate);a.date()!==a.daysInMonth()||b||this.prevCalendar();
this.fetchBuzzData();this.debounceChangeFn();this.updateDropdownSelection();return this.getEndDate()},incrementEndDay:function(a){var b=this.insideLastCalendar("end"),c=this.getEndDate();a=this.utils.incrementDay(c||this.today,a,this.setEndDate);1<=a.date()&&a.month()!==c.getMonth()&&b&&this.nextCalendar();this.fetchBuzzData();this.debounceChangeFn();this.updateDropdownSelection();return this.getEndDate()},incrementStartDay:function(a){var b=this.insideLastCalendar("start"),c=this.getStartDate()||
this.today,d=this.getEndDate();1===this.utils.incrementDay(c,a,this.setStartDate).date()&&b&&this.nextCalendar();(!d||moment(c)>=moment(d))&&this.setEndDate(this.getStartDate());this.fetchBuzzData();this.debounceChangeFn();this.updateDropdownSelection();return this.getStartDate()},handleStartDisplayFocusEvent:function(a,b){var c="",d=this.getStartWrapperElement(),f=this;this.markDropdownElements();this.addFocusClass(d);var k=jq(a);k.text()||!0!==this.options.skipForceSetDefaultStartOnFocusBlur&&this.setStartDate(this.today);
null!==(startdate=this.getStartDate())&&(c=jq(this.startInput).val()||moment(startdate).format(this.options.startInputFormat));this.actOnStart=!0;this.hideDropdown(this.getEndWrapperElement());this.showDropdown(d);this.options.accessible&&setTimeout(function(){k.text(c);f.selectDisplayBox(a)},1);b.stopPropagation();b.stopImmediatePropagation();jq("body").trigger("event",[b]);return this},handleStartDisplayBlurEvent:function(a,b){if(null!==this.clickTarget&&0<this.clickTarget.closest(".r9-datepicker").length)this.blurTarget=
a;else{var c=this.getStartWrapperElement(),d=this.getStartDate();this.hideDropdown(c);a=jq(a);""===a.text()&&!0===this.options.doNotFillWhenEmpty&&(this.setStartDate(null),this.options.change&&this.options.change.apply(this,arguments));""===a.text()&&null===d?!0!==this.options.skipForceSetDefaultStartOnFocusBlur&&this.setStartDate(this.today):""!==this.start_custom_value&&this.utils.applyStartVal();this.updateDropdownSelection();this.updateClicks();return this}},callNTimes:function(a,b){for(var c=
0;c<b;c++)a.call(this)},handleStartDisplayKeydownEvent:function(a,b){var c=b.keyCode||b.which,g=this.options.commands.keys,f=jq(this.endDisplay);a=jq(a);var k=0!==f.length&&!f.is(":hidden");if((c===g.TAB&&k||c===g.ENTER)&&!b.shiftKey){if(!1===f.is(":hidden")){var k=d(this.options.nextFieldAfterStartDateSelector),h=d(".gridCellFlexDepartPlusMinus").first();k.length?k.focus():0===h.length||!1===h.is(":visible")?(b.preventDefault(),b.stopPropagation(),setTimeout(function(){f.focus()},1)):0<h.length&&
h.find("select").focus()}if(c===g.ENTER&&f.is(":hidden"))return a.closest("form").find("[type\x3dsubmit]").trigger("click"),b.preventDefault(),b.stopPropagation(),!1;this.utils.applyStartVal();this.updateDropdownSelection();return!1}a=this.options.commands.keys;switch(c){case a.UP:this.callNTimes(this.decrementStartDay,7);b.preventDefault();b.stopPropagation();break;case a.RIGHT:this.incrementStartDay();b.preventDefault();b.stopPropagation();break;case a.LEFT:this.decrementStartDay();b.preventDefault();
b.stopPropagation();break;case a.DOWN:this.callNTimes(this.incrementStartDay,7);b.preventDefault();b.stopPropagation();break;case a.ESC:this.isDropdownVisible()&&this.hideDropdown(this.getStartWrapperElement())}this.vim(b,"start");jq("body").trigger("event",[b]);return this},handleEndDisplayFocusEvent:function(a,b){var c="",d=this.getEndWrapperElement(),f=this;f.markDropdownElements();this.addFocusClass(jq(d));var k=jq(a),h=f.clicks[0]||f.today.getTime();(!k.text()||f.clicks[1]<=h)&&!0!==this.options.skipForceSetDefaultEndOnFocusBlur&&
f.setEndDate(moment(h).toDate());null!==(enddate=f.getEndDate())&&(c=jq(f.endInput).val()||moment(enddate).format(f.options.endInputFormat));f.actOnStart=!1;f.showDropdown(d);f.options.accessible&&(jq(f.endDisplay).attr("contenteditable","true"),setTimeout(function(){k.text(c);f.selectDisplayBox(a)},1));b.stopPropagation();b.stopImmediatePropagation();jq("body").trigger("event",[b]);return this},handleEndDisplayBlurEvent:function(a,b){var c=this.getEndWrapperElement();this.options.accessible&&jq(this.endDisplay).attr("contenteditable",
"false");if(null!==this.clickTarget&&0<this.clickTarget.closest(".r9-datepicker").length)this.blurTarget=a;else return this.hideDropdown(c),a=jq(a),""===a.text()&&!0===this.options.doNotFillWhenEmpty&&(this.setEndDate(null),this.options.change&&this.options.change.apply(this,arguments)),""==a.text()&&null===this.getEndDate()?!0!==this.options.skipForceSetDefaultEndOnFocusBlur&&(null!==this.getStartDate()?this.setEndDate(moment(this.getStartDate()).add(1,"days")):this.setEndDate(moment().toDate())):
this.utils.applyEndVal(),this.updateDropdownSelection(),this},handleEndDisplayKeydownEvent:function(a,b){var c=b.keyCode||b.which;a=jq(a);a.text();var g=this.options.commands.keys;if(c===g.TAB&&!0===b.shiftKey){var f=d(this.options.nextFieldAfterStartDateSelector),k=d(".gridCellFlexDepartPlusMinus").first(),h=jq(this.startDisplay);f.length?setTimeout(function(){f.focus()}):k.is(":visible")?setTimeout(function(){k.children(".flexPlusMinusChoices").focus()}):!1===h.is(":hidden")&&(b.preventDefault(),
b.stopPropagation(),setTimeout(function(){h.focus()}))}else{if(c===g.ENTER)return this.utils.applyEndVal(),a.closest("form").find("[type\x3dsubmit]").trigger("click"),this.updateDropdownSelection(),b.preventDefault(),b.stopPropagation(),this.hideDropdown(this.getEndWrapperElement()),!1;a=this.options.commands.keys||{};switch(c){case a.UP:this.callNTimes(this.decrementEndDay,7);b.preventDefault();b.stopPropagation();break;case a.RIGHT:this.incrementEndDay();b.preventDefault();b.stopPropagation();break;
case a.LEFT:this.decrementEndDay();b.preventDefault();b.stopPropagation();break;case a.DOWN:this.callNTimes(this.incrementEndDay,7);b.preventDefault();b.stopPropagation();break;case a.ESC:this.isDropdownVisible()&&this.hideDropdown(this.getEndWrapperElement())}this.vim(b,"end")}jq("body").trigger("event",[b]);return this},handleStartDisplayKeyupEvent:function(a,b){this.utils.isCharacterKeyPress(b)&&(this.start_custom_value=jq(a).text());return this},handleEndDisplayKeyupEvent:function(a,b){this.utils.isCharacterKeyPress(b)&&
(this.end_custom_value=jq(a).text());return this},nextCalendar:function(a){return this.utils.changeCalendar("next",a)},prevCalendar:function(a){return this.utils.changeCalendar("prev",a)},selectDisplayBox:function(a){clearTimeout(this.timers.selectDisplayBox);this.timers.selectDisplayBox=window.setTimeout(function(){var b,c;window.getSelection&&document.createRange?(b=window.getSelection(),b.removeAllRanges(),c=document.createRange(),c.selectNodeContents(a),b.addRange(c)):document.body.createTextRange&&
(c=document.body.createTextRange(),c.moveToElementText(a),R9.Common.Utils.Browsers.isIE(8)||c.select())},1)},vim:function(a,b){var c=this.options.commands.keys||{};switch(a.keyCode||a.which){case c.DOLLAR:a.shiftKey&&(this.endOfLine(b),a.preventDefault());break;case c.CARAT:a.shiftKey&&(this.startOfLine(b),a.preventDefault())}return this},startOfLine:function(a){var b=this.utils.getRowInfo(a);"start"==a?this.decrementStartDay(b.index):this.decrementEndDay(b.index)},endOfLine:function(a){var b=this.utils.getRowInfo(a),
b=b.len-b.index;"start"==a?this.incrementStartDay(b):this.incrementEndDay(b)},bindBuzzGraphEvents:function(){var a=this;jq(".r9-datepicker-buzz-day").hover(function(){jq(".r9-datepicker-item[data-val\x3d%s]".format(jq(this).attr("data-val"))).addClass("r9-datepicker-item-hover");jq(".r9-datepicker-buzz-graph-footer \x3e div \x3e .detail").html(jq(this).children(".r9-datepicker-buzz-bar").attr("footertitle"))},function(){jq(".r9-datepicker-item[data-val\x3d%s]".format(jq(this).attr("data-val"))).removeClass("r9-datepicker-item-hover");
jq(".r9-datepicker-buzz-graph-footer \x3e div \x3e .detail").html("")});jq(".r9-datepicker-buzz-day").click(function(){var b=Number(jq(this).children(".r9-datepicker-buzz-bar").attr("dtstart"));if(a.actOnStart){var c=Number(jq(this).children(".r9-datepicker-buzz-bar").attr("dtend"));a.clearDaterange();a.setStartDate(b);a.options.isOneWay||a.setEndDate(c);a.updateDropdownSelection(null);a.options.isOneWay?(a.setEndDate(b),jq(".r9-datepicker-item[data-val\x3d%s]".format(jq(this).attr("data-val"))).mousedown(),
R9.Analytics.api.trackEvent("/flexgraph/oneway/click")):(a.endDisplay.focus(),R9.Analytics.api.trackEvent("/flexgraph/startdate/click"))}else a.setEndDate(b),jq(".r9-datepicker-item[data-val\x3d%s]".format(jq(this).attr("data-val"))).mousedown(),R9.Analytics.api.trackEvent("/flexgraph/enddate/click")})},fetchBuzzGraphData:function(){var a=this;jq("#flexgraphOK").size();var b="y"==jq("#onewaytrip").filter(":checked").val()||"y"==jq("#multi").filter(":checked").val();a.options.isOneWay=b;var c=a.getStartDate()||
a.today,d=a.getEndDate(),f=b?1:3;null==d||b||(f=Math.floor(a.utils.dateDiff(d,c)+1));var k=Number(jq(".r9-datepicker-month-first").find(".r9-datepicker-enabled:first").attr("data-val"));if(""==a.options.originControl.val()||""==a.options.destControl.val())jq(".r9-datepicker-buzz-graph-footer \x3e div").addClass("hidden"),jq(".r9-datepicker-buzz-graph-footer .noairports").removeClass("hidden");else if(a.actOnStart){var h=moment(k).format("YYYY-MM-DD");a.buzzCall&&a.buzzCall.abort();a.buzzCall=b?jq.ajax({type:"GET",
url:"/h/run/flexgraph",data:{q:"oneway",o:a.options.originControl.val().substr(0,3),d:a.options.destControl.val().substr(0,3),depart:h,daysout:70,duration:f,json:1},dataType:"json",success:function(b){try{responseObject=b,a.graphDataReadyCallback(responseObject,f,k,!0,c.getTime())}catch(l){}a.buzzCall=!1},error:function(b,c,e){a.buzzCall=!1},cache:!1}):jq.ajax({type:"GET",url:"/h/run/flexgraph",data:{q:"fixed",o:a.options.originControl.val().substr(0,3),d:a.options.destControl.val().substr(0,3),depart:h,
daysout:70,duration:f,json:1},dataType:"json",success:function(b){try{responseObject=b,a.graphDataReadyCallback(responseObject,f,k,!1,c.getTime())}catch(l){}a.buzzCall=!1},error:function(b,c,e){a.buzzCall=!1},cache:!1})}else{var h=moment(c.getTime()).format("YYYY-MM-DD"),n=(d||a.today).getTime();a.buzzCall&&a.buzzCall.abort();a.buzzCall=jq.ajax({type:"GET",url:"/h/run/flexgraph",data:{q:"start",o:a.options.originControl.val().substr(0,3),d:a.options.destControl.val().substr(0,3),depart:h,daysout:70,
json:1},dataType:"json",success:function(b){try{responseObject=b,a.graphDataReadyCallback(responseObject,f,c.getTime(),!1,n)}catch(l){}a.buzzCall=!1},error:function(b,c,e){a.buzzCall=!1},cache:!1})}},displayBuzzGraph:function(){this.fetchBuzzData(!0)},fetchBuzzData:function(a){this.options.showBuzzGraph&&a&&(jq(".r9-datepicker-buzz-day.r9-datepicker-enabled .r9-datepicker-buzz-bar").each(function(){jq(this).css("height","2px").attr("footertitle","")}),this.fetchBuzzGraphData())},graphDataReadyCallback:function(a,
b,c,d,f){this.actOnStart?d?(jq(".r9-datepicker-buzz-graph-footer \x3e div").addClass("hidden"),jq(".r9-datepicker-buzz-graph-footer .oneway").removeClass("hidden")):(jq(".r9-datepicker-buzz-graph-footer \x3e div").addClass("hidden"),jq(".r9-datepicker-buzz-graph-footer .duration #durationNumber").html(b),jq(".r9-datepicker-buzz-graph-footer .duration").removeClass("hidden")):(jq(".r9-datepicker-buzz-graph-footer \x3e div").addClass("hidden"),jq(".r9-datepicker-buzz-graph-footer .fixedstart #flexDepartDate").html(moment(c).format(this.options.startInputFormat)),
jq(".r9-datepicker-buzz-graph-footer .fixedstart").removeClass("hidden"));c=b=500;var e=0,g=0,n=0,m;for(m in a){n++;var l=Number(a[m].localPrice);l>b&&(b=l);l<c&&1<l&&(c=l,g=m);m==f&&(e=l)}if(0==n)jq(".r9-datepicker-buzz-graph").hide(),jq(".r9-datepicker-buzz-graph-footer").hide();else{n=0;for(m in a){var l=a[m].localPrice,r=a[m].localPriceAsString,w=a[m].departMilli,p=a[m].returnMilli,q=moment(a[m].departMilli).format(this.options.startInputFormat),u=moment(a[m].returnMilli).format(this.options.startInputFormat),
t=this.actOnStart?jq(".r9-datepicker-buzz-day[data-val\x3d'"+m+"']").find("div"):jq(".r9-datepicker-buzz-day[data-val\x3d'"+p+"']").find("div");1==t.size()&&(l=Math.floor(l/b*100),t.css("height",l+"%"),n++,d?t.attr("footertitle",q+" "+r):t.attr("footertitle",q+"-"+u+" "+r),this.actOnStart?t.attr("dtstart",w):t.attr("dtstart",p),t.attr("dtend",p),this.actOnStart?m==f&&(t.addClass("selected"),jq("#graphpricebar").css("bottom",l-1+"px").show(),jq("#graphprice").html(r).css("bottom",l-7+"px").show()):
p==f&&(t.addClass("selected"),jq("#graphpricebar").css("bottom",l-1+"px").show(),jq("#graphprice").html(r).css("bottom",l-7+"px").show()),m==g&&(0<e&&e>c&&c<.9*e?jq("#graphlowpricebar").css("bottom",l-1+"px").show():jq("#graphlowpricebar").hide()))}0==n?(jq(".r9-datepicker-buzz-graph").hide(),jq(".r9-datepicker-buzz-graph-footer").hide()):jq(".r9-datepicker-buzz-graph").is(":visible")||(jq(".r9-datepicker-buzz-graph").show(),jq(".r9-datepicker-buzz-graph-footer").show())}}})})(jq||jQuery);
(function(d){d.extend("Widgets.DaterangePicker.prototype.options",{prevTitle:"Prev",nextTitle:"Next",nightsFormat:"0#same day|1#1 night|2#{0} nights",daysFormat:"0#same day|1#1 day|2#{0} days",startInputFormat:"MM/DD/YYYY",endInputFormat:"MM/DD/YYYY",startFormat:"ddd M/D",endFormat:"ddd M/D"})})(window.R9);
(function(d){R9.extend("Widgets",{DaterangePickerTwoFields:function(c,a){R9.Widgets.BaseCalendarWidget.apply(this);this.endNode=c;this.endElement=d(this.endNode);this.startElement=jq(this.endElement).closest("form").find('[id$\x3d"start-wrapper"]');1!=this.startElement.length&&(this.startElement=jq("#"+this.endElement.attr("id").replace("end-wrapper","start-wrapper")));this.validateElement()&&(this.startDisplay=d(R9.Widgets.DaterangePickerTwoFields.findDisplay(this.startElement[0])),this.startClearDisplay=
d(R9.Widgets.DaterangePickerTwoFields.findClearDisplay(this.startElement[0])),this.startPlaceholderDisplay=d(R9.Widgets.DaterangePickerTwoFields.findPlaceholderDisplay(this.startElement[0])),this.startInputTab=d(R9.Widgets.DaterangePickerTwoFields.findInputTab(this.startElement[0])),this.startInput=d(R9.Widgets.DaterangePickerTwoFields.findInput(this.startElement[0])),this.endDisplay=d(R9.Widgets.DaterangePickerTwoFields.findDisplay(this.endElement[0])),this.endClearDisplay=d(R9.Widgets.DaterangePickerTwoFields.findClearDisplay(this.endElement[0])),
this.endPlaceholderDisplay=d(R9.Widgets.DaterangePickerTwoFields.findPlaceholderDisplay(this.endElement[0])),this.endInputTab=d(R9.Widgets.DaterangePickerTwoFields.findInputTab(this.endElement[0])),this.endInput=d(R9.Widgets.DaterangePickerTwoFields.findInput(this.endElement[0])),this.options=d.extend({},this.options,a),this.init())}});R9.extend("Widgets.DaterangePickerTwoFields",{isDatepicker:function(c){return c&&c.nodeName&&"div"==c.nodeName.toLowerCase()},isWidgetControlled:function(c){return d(c).hasClass(R9.Widgets.DaterangePicker.prototype.widgetBaseClass+
"-wrapper")},findDisplay:function(c){var a=d(c).closest("form").find("#"+c.id.replace("wrapper","display"))[0];a||(a=document.getElementById(c.id.replace("wrapper","display")));return a},findClearDisplay:function(c){var a=d(c).closest("form").find("#"+c.id.replace("wrapper","clear"))[0];a||(a=document.getElementById(c.id.replace("wrapper","clear")));return a},findPlaceholderDisplay:function(c){var a=d(c).closest("form").find("#"+c.id.replace("wrapper","placeholder"))[0];a||(a=document.getElementById(c.id.replace("wrapper",
"placeholder")));return a},findInputTab:function(c){var a=d(c).closest("form").find("#"+c.id.replace("wrapper","tab"))[0];a||(a=document.getElementById(c.id.replace("wrapper","tab")));return a},findInput:function(c){var a=jq(c).closest("form").find("#"+c.id+" .r9-datepicker-input")[0];a||(a=jq("#"+c.id+" .r9-datepicker-input")[0]);return a},getDropdownId:function(c){return"datepicker"}});R9.extend("Widgets.DaterangePickerTwoFields.prototype",!0,R9.Widgets.DaterangePicker.prototype,{endNode:null,startElement:null,
endElement:null,startDisplay:null,startClearDisplay:null,startPlaceholderDisplay:null,startInputTab:null,startInput:null,endDisplay:null,endClearDisplay:null,endPlaceholderDisplay:null,endInputTab:null,endInput:null,singleDateMode:!1,init:function(){this.advanceStyling&&(this.options.skipForceSetDefaultStartOnFocusBlur=!0,this.options.skipForceSetDefaultEndOnFocusBlur=!0,this.options.doNotFillWhenEmpty=!0);this.initDropdown();this.timers={};this.options.useLongDisplayFormat&&(this.options.startFormat=
this.options.startInputFormat,this.options.endFormat=this.options.endInputFormat);this.endStartIsSameField()||(this.bindEvent(this.endInputTab,"focus",this.handleEndInputFocusEvent),this.bindEvent(this.endInputTab,"blur",this.handleInputBlurEvent),this.bindEvent(this.endInputTab,"keydown",this.handleInputKeydownEvent),this.bindEvent(this.endElement,"mousedown",this.handleEndClickEvent),this.bindEvent(this.endClearDisplay,"mousedown",this.handleEndClearClickEvent));this.bindEvent(this.startInputTab,
"focus",this.handleStartInputFocusEvent);this.bindEvent(this.startInputTab,"blur",this.handleInputBlurEvent);this.bindEvent(this.startInputTab,"keydown",this.handleInputKeydownEvent);this.bindEvent(this.startElement,"mousedown",this.handleStartClickEvent);this.bindEvent(this.startClearDisplay,"mousedown",this.handleStartClearClickEvent);this.endElement.data(this.widgetName,this);jq(".r9-datepicker-wrapper").each(function(){var c=jq(this).find(".r9-datepicker-display");if(!(void 0!==c&&1<c.length))jq(this).off("mousedown focus").on("mousedown focus",
function(a){a.preventDefault();a.stopPropagation();jq("body").trigger("event",[a]);jq(this).find(".r9-datepicker-display").focus()})});this.bindCommandUtilities();this.start_custom_value=this.end_custom_value="";this.utils=this.options.commands.utilities;this.today=moment().startOf("day").toDate();this.bindAccessibilityEvents();this.updateClicks();this.updateDOM()},validateElement:function(){return R9.Widgets.DaterangePicker.isDatepicker(this.endNode)&&R9.Widgets.DaterangePicker.isWidgetControlled(this.endNode)&&
void 0===this.endElement.data(this.widgetName)},getWrapperElement:function(){return this.actOnStart?this.startElement:this.endElement},getStartWrapperElement:function(){return this.startElement},getEndWrapperElement:function(){return this.endElement},switchActOn:function(){var c=!this.actOnStart;this.hideDropdown(this.getWrapperElement());this.actOnStart=c;(this.actOnStart?this.startInputTab:this.endInputTab).focus()},markDropdownElements:function(){this.unmarkDropdownElements();this.actOnStart?this.startElement.addClass("r9-datepicker-dropdown r9-datepicker-dropdown-start"):
this.endElement.addClass("r9-datepicker-dropdown r9-datepicker-dropdown-end")},unmarkDropdownElements:function(){this.startElement.removeClass("r9-datepicker-dropdown r9-datepicker-dropdown-start");this.endElement.removeClass("r9-datepicker-dropdown r9-datepicker-dropdown-end")},setSingleDateMode:function(c,a){this.singleDateMode!=c&&(this.singleDateMode=c,a||this.updateDOM())},getSingleDateMode:function(){return this.singleDateMode},handleStartClearClickEvent:function(c,a){this.clearDaterange(0);
this.options.change&&this.options.change.apply(this,arguments);return!this.startElement.hasClass("r9-datepicker-focus")},handleEndClearClickEvent:function(c,a){this.clearDaterange(1);this.options.change&&this.options.change.apply(this,arguments);return!this.endElement.hasClass("r9-datepicker-focus")},handleStartInputFocusEvent:function(c,a){if(!c.disabled){this.preventBlur=!1;var b=this.getStartWrapperElement();b.addClass("r9-datepicker-focus");this.startDisplay.text()||this.setStartDate(this.today);
this.actOnStart=!0;this.showDropdown(b);this.options.focus&&this.options.focus.apply(this,arguments)}},handleEndInputFocusEvent:function(c,a){if(!c.disabled){this.preventBlur=!1;var b=this.getEndWrapperElement();b.addClass("r9-datepicker-focus");this.endDisplay.text()||this.setEndDate(moment(this.getStartDate()).toDate());this.actOnStart=!1;this.showDropdown(b);this.options.focus&&this.options.focus.apply(this,arguments)}},handleItemClickEvent:function(c,a){var b=this,e=jq(c);return this.singleDateMode?
(e.hasClass("r9-datepicker-enabled")&&(c=parseInt(e.attr("data-val")),this.clicks[0]=c,this.clicks[1]<this.clicks[0]&&(this.clicks[1]=this.clicks[0]),this.updateDropdownSelection(null),setTimeout(function(){b.hideDropdown(null);b.options.change&&b.options.change.apply(b,arguments);b.options.nextFieldSelector&&jq(b.options.nextFieldSelector).focus()},this.options.secondClickHideDelay)),this.updateDOM(),!1):R9.Widgets.DaterangePicker.prototype.handleItemClickEvent.call(this,c,a)},handleClickEvent:function(c,
a,b){return!0},updateItem:function(c,a){this.singleDateMode?(a.hover?c.addClass("r9-datepicker-item-hover"):c.removeClass("r9-datepicker-item-hover"),c.removeClass("r9-datepicker-item-selected"),c.removeClass("r9-datepicker-item-start"),a.selected&&!a.end?(c.addClass("r9-datepicker-item-selected"),c.attr("aria-selected",!0)):a.selected||c.attr("aria-selected",!1),a.start&&c.addClass("r9-datepicker-item-start")):R9.Widgets.DaterangePicker.prototype.updateItem.call(this,c,a)}})})(jq||jQuery);
(function(d){R9.extend("Widgets",{DaterangePickerFixed:function(c,a){this.elementNode=c;this.element=d(this.elementNode);this.validateElement()&&(this.startDisplay=d(R9.Widgets.DaterangePicker.findStartDisplay(this.elementNode)),this.sepDisplay=d(R9.Widgets.DaterangePicker.findSepDisplay(this.elementNode)),this.endDisplay=d(R9.Widgets.DaterangePicker.findEndDisplay(this.elementNode)),this.clearDisplay=d(R9.Widgets.DaterangePicker.findClearDisplay(this.elementNode)),this.nightsDisplay=d(R9.Widgets.DaterangePicker.findNightsDisplay(this.elementNode)),
this.placeholderDisplay=d(R9.Widgets.DaterangePicker.findPlaceholderDisplay(this.elementNode)),this.input=d(R9.Widgets.DaterangePicker.findInputNode(this.elementNode)),this.startInput=d(R9.Widgets.DaterangePicker.findStartInput(this.elementNode)),this.endInput=d(R9.Widgets.DaterangePicker.findEndInput(this.elementNode)),this.options=d.extend({},this.options,a),this.init())}});R9.extend("Widgets.DaterangePickerFixed",{isDatepicker:function(c){return c&&c.nodeName&&"div"==c.nodeName.toLowerCase()},
isWidgetControlled:function(c){return d(c).hasClass(R9.Widgets.DaterangePicker.prototype.widgetBaseClass+"-wrapper")},findStartDisplay:function(c){return document.getElementById(c.id+"-start")},findEndDisplay:function(c){return document.getElementById(c.id+"-end")},findSepDisplay:function(c){return document.getElementById(c.id+"-sep")},findClearDisplay:function(c){return document.getElementById(c.id+"-clear")},findNightsDisplay:function(c){return document.getElementById(c.id+"-nights")},findPlaceholderDisplay:function(c){return document.getElementById(c.id+
"-placeholder")},findStartInput:function(c){return jq("#"+c.id+" .r9-datepicker-input.r9-datepicker-start")[0]},findEndInput:function(c){return jq("#"+c.id+" .r9-datepicker-input.r9-datepicker-end")[0]},findInputNode:function(c){return document.getElementById(c.id+"-tab")},getDropdownId:function(c){return"datepicker"}});R9.extend("Widgets.DaterangePickerFixed.prototype",!0,R9.Widgets.DaterangePicker.prototype,{options:{rangeDays:34},handleItemClickEvent:function(c,a){var b=this;c=jq(c);c.hasClass("r9-datepicker-enabled")&&
(c=parseInt(c.attr("data-val")),this.clicks[0]=c,this.clicks[1]=moment(c).add(this.options.rangeDays,"days").valueOf(),this.updateDropdownSelection(null),setTimeout(function(){b.hideDropdown(null);b.options.change&&b.options.change.apply(b,arguments);b.options.nextFieldSelector&&jq(b.options.nextFieldSelector).focus()},this.options.secondClickHideDelay));this.updateDOM();return!1},getHighlitedRange:function(c,a){c=[0,0];if(null==a)return c;c[0]=parseInt(a.attr("data-val"));c[1]=moment(c[0]).add(34,
"days").valueOf();return c},setStartDate:function(c){null!=c&&(this.clicks[0]=c.getTime(),this.clicks[1]=moment(this.clicks[0]).add(this.options.rangeDays,"days").valueOf(),this.updateDOM())},setEndDate:function(c){null!=c&&(this.clicks[1]=c.getTime(),this.clicks[0]=moment(this.clicks[1]).subtract(this.options.rangeDays,"days").valueOf(),this.updateDOM())}})})(jq||jQuery);
(function(d){R9.extend("Widgets",{DaterangePickerOrSingleDate:function(c,a){R9.Widgets.DaterangePicker.call(this,c,a)}});R9.extend("Widgets.DaterangePickerOrSingleDate",{});R9.extend("Widgets.DaterangePickerOrSingleDate.prototype",!0,R9.Widgets.DaterangePicker.prototype,{minDate:null,singleDateMode:!1,setSingleDateMode:function(c,a){this.singleDateMode=c;a||this.updateDOM()},getSingleDateMode:function(){return this.singleDateMode},updateDOM:function(){var c;this.singleDateMode?(this.element.addClass("r9-datepicker-single-date-mode"),
this.dropdown.addClass("r9-datepicker-single-date-mode"),this.endDisplay.text(""),this.endInput.val(""),0!=this.clicks[0]?(c=moment(this.clicks[0]),this.startDisplay.text(c.format(this.options.startFormat)),this.startInput.val(c.format(this.options.startInputFormat))):(this.startDisplay.text(""),this.startInput.val("")),null==c?this.element.addClass("r9-datepicker-start-empty"):this.element.removeClass("r9-datepicker-start-empty")):(this.element.removeClass("r9-datepicker-single-date-mode"),this.dropdown.removeClass("r9-datepicker-single-date-mode"),
R9.Widgets.DaterangePicker.prototype.updateDOM.call(this))},updateHoverDOM:function(c){this.singleDateMode||R9.Widgets.DaterangePicker.prototype.updateHoverDOM.call(this,c)},computeState:function(c,a,b,e,d,f){this.singleDateMode?a==b[0]?d.start=!0:a==c&&(d.highlited=!0):R9.Widgets.DaterangePicker.prototype.computeState.call(this,c,a,b,e,d,f)},handleItemClickEvent:function(c,a){var b=this,e=jq(c);return this.singleDateMode?(e.hasClass("r9-datepicker-enabled")&&(c=parseInt(e.attr("data-val")),this.clicks[0]=
c,this.updateDropdownSelection(null),setTimeout(function(){b.hideDropdown(null);b.options.change&&b.options.change.apply(b,arguments);b.options.nextFieldSelector&&jq(b.options.nextFieldSelector).focus()},this.options.secondClickHideDelay)),this.updateDOM(),!1):R9.Widgets.DaterangePicker.prototype.handleItemClickEvent.call(this,c,a)}})})(jq||jQuery);
(function(d,c){d.publish("common.widgets.datepicker.BaseCalendar.prototype",c.extend({},d.Widgets.BaseCalendarWidget.prototype,{useSpecialCharacters:!1,options:{language:null,title:"",prevTitle:"",nextTitle:"",titleYearFormat:"YYYY",titleMonthFormat:"MMMM",reverseMonthAndYearOrder:!1,yearSymbol:null},showYearWithSpecialSymbol:function(a){var b=[],c=this.getYearSymbol();b.push("\x3cspan class\x3d'r9-datepicker-year'\x3e");b.push(a.format(this.options.titleYearFormat)+c+" ");b.push("\x3c/span\x3e");
return b.join("")},showMonthAndYear:function(a){var b=[];this.isReverseMonthAndYearOrder()?(b.push(this.showYearWithSpecialSymbol(a)),b.push(this.showMonth(a))):(b.push(this.showMonth(a)),b.push(this.showYearWithSpecialSymbol(a)));return b.join("")},isReverseMonthAndYearOrder:function(){return!0===this.options.reverseMonthAndYearOrder||!0===d.config.getBoolean("ui.datepicker.reverse.order.month.year",!1)},getYearSymbol:function(){return null!=this.options.yearSymbol?this.options.yearSymbol:this.isReverseMonthAndYearOrder()?
d.config.getString("ui.datepicker.year.symbol",""):""}}));d.createWidgetClass("datepicker.DaterangePicker",c.extend({},d.Widgets.DaterangePickerTwoFields.prototype,d.common.widgets.datepicker.BaseCalendar.prototype,{widgetName:"daterangePicker",widgetBaseClass:"r9-datepicker",calendarBaseClass:"r9-datepicker-calendar",dropdownId:"datepicker",html:null,singleDateMode:!1,maxDate:null,options:c.extend({},d.common.widgets.datepicker.BaseCalendar.prototype.options,d.Widgets.DaterangePickerTwoFields.prototype.options,
{skipForceSetDefaultStartOnFocusBlur:!1,skipForceSetDefaultEndOnFocusBlur:!1,doNotFillWhenEmpty:!1,minRangeDays:1,alwaysShowEndDatepicker:!1,responsive:!1,presentationCheck:function(){return d.utils.presentation.isTablet()}}),init:function(a){this.html=c("html");d.Widgets.BaseCalendarWidget.apply(this);this.options.useDaysFormat?(this.unitFormat=this.options.daysFormat,this.unitAdjustment=1):(this.unitFormat=this.options.nightsFormat,this.unitAdjustment=0);this.advanceStyling&&(this.options.skipForceSetDefaultStartOnFocusBlur=
!0,this.options.skipForceSetDefaultEndOnFocusBlur=!0,this.options.doNotFillWhenEmpty=!0);this.options.maxDate&&(this.maxDate=this.options.maxDate);this.elementNode=this.element.get(0);a=this.element.closest(".R9-Overlay");0<a.length&&(this.options.appendTo="#%s".format(a.attr("id")));this.startSection=this.findStartSection();this.startDisplay=this.findStartDisplay();this.startPlaceholderDisplay=this.findStartPlaceholderDisplay();this.startElement=this.startWrapper=this.findStartWrapperElement();this.startInput=
this.findStartInput();this.startInputTab=this.findStartInputTab();this.endSection=this.findEndSection();this.endDisplay=this.findEndDisplay();this.endPlaceholderDisplay=this.findEndPlaceholderDisplay();this.endElement=this.endWrapper=this.findEndWrapperElement();this.endInput=this.findEndInput();this.endInputTab=this.findEndInputTab();this.element.hasClass("singleDate")&&this.setSingleDateMode(!0,!0);this.summaryDisplay=this.findSummaryDisplay();this.setUseDaysFormat(this.options.useDaysFormat);this.initDropdown();
this.timers={};this.bindCommandUtilities();this.start_custom_value=this.end_custom_value="";this.utils=this.options.commands.utilities;this.today=moment().startOf("day").toDate();this.isResponsive()&&this.handleResponsive();this.wholeMonthSearch&&(this.options.skipForceSetDefaultStartOnFocusBlur=!0,this.options.skipForceSetDefaultEndOnFocusBlur=!0,this.options.doNotFillWhenEmpty=!0);this.update();this.updateClicks();this.updateDOM()},addEventHandlers:function(){var a=function(a){a.off("mousedown focus").on("mousedown focus",
function(b){b.preventDefault();b.stopPropagation();a.removeClass("r9-datepicker-end-empty r9-datepicker-start-empty");c(this).find(".r9-datepicker-display").focus()})};a(this.startWrapper);a(this.endWrapper);this.bindAccessibilityEvents();this.bindEvent(this.startInputTab,"focus",this.handleStartInputFocusEvent);this.bindEvent(this.startInputTab,"blur",this.handleInputBlurEvent);this.bindEvent(this.startInputTab,"keydown",this.handleInputKeydownEvent);this.bindEvent(this.startElement,"mousedown",
this.handleStartClickEvent);this.bindEvent(this.endInputTab,"focus",this.handleEndInputFocusEvent);this.bindEvent(this.endInputTab,"blur",this.handleInputBlurEvent);this.bindEvent(this.endInputTab,"keydown",this.handleInputKeydownEvent);this.bindEvent(this.endElement,"mousedown",this.handleEndClickEvent);this.bindEvent(this.dropdown,"mousedown",this.handleDropdownClickEvent);this.bindEvent(this.overlay,"mousedown",this.handleItemClickEvent);this.isResponsive()&&c(window).resize(this.handleResponsive.bind(this))},
handleDropdownClickEvent:function(){return!!this.wholeMonthSearch},isSelectingEndDate:function(){return this.endWrapper.hasClass("r9-datepicker-focus")},handleCloseEvent:function(){this.isDropdownVisible()&&this.hideDropdown()},handleItemClickEvent:function(a,b){if(!0===this.isBeforeStart(a)&&!1===this.actOnStart)return this.preventBlur=!0,this.wholeMonthSearch&&(this.preventBlur=!1),b.preventDefault(),this;var e=this;b=c(a);var d,f,k;b.hasClass("r9-datepicker-enabled")&&(f=parseInt(b.attr("data-val")),
d=(k=this.actOnStart)?0:1,b=this.actOnStart?1:0,this.clicks[d]=f,this.clicks[0]&&this.clicks[1]&&(d=moment(this.clicks[1]).diff(this.clicks[0],"days"),d<this.options.minRangeDays&&(this.clicks[b]=0)),this.updateDropdownSelection(null),!this.options.alwaysShowEndDatepicker||this.singleDateMode||this.isSelectingEndDate()?!this.singleDateMode&&this.clicks[0]&&this.clicks[1]||this.singleDateMode&&this.clicks[0]?setTimeout(function(){e.hideDropdown();e.options.change&&e.options.change.apply(e,[f,k]);e.options.nextFieldSelector&&
c(e.options.nextFieldSelector).focus()},this.options.secondClickHideDelay):this.switchActOn():(this.switchActOn(),e.options.change&&e.options.change.apply(e,[f,k]),this.loadBuzzData&&k&&this.displayBuzzData()));this.updateDOM();c(a).trigger("daterangepicker.itemclicked");return!1},handleStartDisplayFocusEvent:function(a,b){if(this.clickTarget&&c(this.clickTarget[0]).hasClass("FormView"))return this;var e=null,g="",f=this.getStartWrapperElement(),k=this;this.markDropdownElements();c(".r9-datepicker-focus").removeClass("r9-datepicker-focus");
c(f).addClass("r9-datepicker-focus");var h=c(a);h.text()||!0!==this.options.skipForceSetDefaultStartOnFocusBlur&&this.setStartDate(this.today);null!==(e=this.getStartDate())&&(g=c(this.startInput).val()||moment(e).format(this.options.startInputFormat));this.actOnStart=!0;this.hideDropdown(this.getEndWrapperElement());this.showDropdown(f);this.options.accessible&&setTimeout(function(){h.text(g);k.wholeMonthSearch&&("wholeMonthSearch"===(null!==d.storage.get("daterangePickerDefaultNavTab")?d.storage.get("daterangePickerDefaultNavTab"):
"specificDate")?k.startDisplay.text("Select a month..."):h.text(g));k.selectDisplayBox(a)},1);b.stopPropagation();b.stopImmediatePropagation();c("body").trigger("event",[b]);return this},handleStartDisplayBlurEvent:function(a,b){if(null!==this.clickTarget&&(0<this.clickTarget.closest(".r9-datepicker").length||this.wholeMonthSelect))this.blurTarget=a;else{var e=this.getStartWrapperElement(),d=this.getStartDate();a=c(a);""===a.text()&&!0===this.options.doNotFillWhenEmpty&&(this.setStartDate(null),this.options.change&&
this.options.change.apply(this,arguments));this.hideDropdown(e);c(e).removeClass("r9-datepicker-focus");""===a.text()&&null===d?!0!==this.options.skipForceSetDefaultStartOnFocusBlur&&this.setStartDate(this.today):""!==this.start_custom_value?this.utils.applyStartVal():(null===this.getEndDate()||moment(this.getStartDate()).isSame(this.getEndDate()))&&this.setEndDate(moment(this.getStartDate()).add(1,"days").toDate());this.updateDropdownSelection();this.updateClicks();return this}},handleEndDisplayFocusEvent:function(a,
b){var c="",d=this.getEndWrapperElement(),f=this;f.markDropdownElements();jq(".r9-datepicker-focus").removeClass("r9-datepicker-focus");jq(d).addClass("r9-datepicker-focus");var k=jq(a),h=f.clicks[0]||f.today.getTime();(!k.text()||f.clicks[1]<=h)&&!0!==this.options.skipForceSetDefaultEndOnFocusBlur&&f.setEndDate(moment(h).toDate());var n;null!==(n=f.getEndDate())&&(c=jq(f.endInput).val()||moment(n).format(f.options.endInputFormat));f.actOnStart=!1;f.showDropdown(d);f.options.accessible&&(jq(f.endDisplay).attr("contenteditable",
"true"),setTimeout(function(){k.text(c);f.selectDisplayBox(a)},1));b.stopPropagation();b.stopImmediatePropagation();jq("body").trigger("event",[b]);return this},handleEndDisplayBlurEvent:function(a,b){var c=this.getEndWrapperElement();this.options.accessible&&jq(this.endDisplay).attr("contenteditable","false");if(null!==this.clickTarget&&0<this.clickTarget.closest(".r9-datepicker").length)this.blurTarget=a;else return a=jq(a),""===a.text()&&!0===this.options.doNotFillWhenEmpty&&(this.setEndDate(null),
this.options.change&&this.options.change.apply(this,arguments)),this.hideDropdown(c),""===a.text()&&null===this.getEndDate()?!0!==this.options.skipForceSetDefaultEndOnFocusBlur&&(null!==this.getStartDate()?this.setEndDate(moment(this.getStartDate()).add(1,"days")):this.setEndDate(moment().toDate())):this.utils.applyEndVal(),this.updateDropdownSelection(),this},switchActOn:function(){var a=!this.actOnStart;this.hideDropdown(this.getWrapperElement());this.actOnStart=a;c(this.actOnStart?this.startInputTab:
this.endInputTab).focus()},findStartSection:function(){return this.getChildElement("start")},findStartDisplay:function(){return this.getChildElement("start-display")},findStartPlaceholderDisplay:function(){return this.getChildElement("start-placeholder")},findEndSection:function(){return this.getChildElement("end")},findEndDisplay:function(){return this.getChildElement("end-display")},findEndPlaceholderDisplay:function(){return this.getChildElement("end-placeholder")},findSummaryDisplay:function(){return this.getChildElement("summary-display")},
findClearDisplay:function(){return this.getChildElement("clear")},findCloseLink:function(){return c(".r9-datepicker-title-close",this.dropdown)},findTitle:function(){return c(".r9-datepicker-title \x3e span",this.dropdown)},findStartInput:function(){return this.getChildElement("start-formField")},findEndInput:function(){return this.getChildElement("end-formField")},findTabInput:function(){return this.getChildElement("tab")},findStartInputTab:function(){return this.getChildElement("start-tab")},findEndInputTab:function(){return this.getChildElement("end-tab")},
findStartWrapperElement:function(){return this.getChildElement("start-wrapper")},findEndWrapperElement:function(){return this.getChildElement("end-wrapper")},getDropdownEl:function(){return c("#datepicker")},getWrapperElement:function(){return this.actOnStart?this.startWrapper:this.endWrapper},getStartWrapperElement:function(){return this.startWrapper},getEndWrapperElement:function(){return this.endWrapper},handleNextPrevClickEvent:function(a,b){b=this.saveDropdownPositionState(this.dropdown);a=moment(parseInt(c(a).attr("data-val")));
this.dropdown[0].innerHTML=this.makeCalendarHTML(a);this.restoreDropdownPositionState(this.dropdown,b);this.runBelowCalendarCallback();this.updateDropdownSelection(null);this.loadBuzzData&&this.displayBuzzData();this.isResponsive()&&this.presentationCheck()&&(this.updateTitle(),this.bindEvent(this.findCloseLink(),"click",this.handleCloseEvent));this.wholeMonthSearch&&(this.createCalendarTabNavBindings(),this.createWholeMonthClickBindings(),this.createNoOfNightsChangedBinding(),jq(".tabWrapper.wholeMonth").hasClass("selected")?
jq(".tabWrapper.wholeMonth").trigger("click"):jq(".tabWrapper.specificDate").trigger("click"),jq(".searchform.rtow").hasClass("oneway")&&(jq(".tabWrapper.wholeMonth").hide(),jq(".tabWrapper.specificDate").click()));return!1},saveDropdownPositionState:function(a){if(a){var b=a.find(".r9-datepicker-pointer");a=c(a);if(0<b.length&&0<a.length)return{pointerPos:b.position(),wrapperPos:a.position(),wrapperHeight:a.height(),topPointer:0>b.position().top}}return null},restoreDropdownPositionState:function(a,
b){if(b&&a){var e=c(a);if(0<e.length){if(!b.topPointer){var d=e.height()-b.wrapperHeight;e.css("top",b.wrapperPos.top-d+"px")}a.find(".r9-datepicker-pointer").css("left",b.pointerPos.left+"px")}}},showDropdown:function(a){this.hideTimeout&&clearTimeout(this.hideTimeout);this.options.show&&this.options.show.apply(this,arguments);this.dropdown.parent().is(this.options.appendTo)||this.dropdown.appendTo(this.options.appendTo);this.showOverlay();this.markDropdownElements();this.updateClicks();"function"===
typeof this.options.minDateFunc&&this.options.minDateFunc(this);this.wholeMonthSearch&&jq(".searchform.rtow").hasClass("oneway")&&(d.events.publish("flights.search.rt.form.wholeMonthSelect.setSpecificDateCategory",{group:"wholeMonthSelect"}),this.daterangePickerDefaultNavTab="specificDate");this.dropdown[0].innerHTML=this.makeCalendarHTML(!this.actOnStart&&this.clicks[1]?this.clicks[1]:this.clicks[0]);this.updateDropdownSelection(null);this.runBelowCalendarCallback();this.wholeMonthSearch&&(this.createCalendarTabNavBindings(),
this.createWholeMonthClickBindings(),this.createNoOfNightsChangedBinding(),jq(".tabWrapper.wholeMonth").hasClass("selected")?jq(".tabWrapper.wholeMonth").trigger("click"):jq(".tabWrapper.specificDate").trigger("click"),jq(".searchform.rtow").hasClass("oneway")&&(jq(".tabWrapper.wholeMonth").hide(),jq(".tabWrapper.specificDate").click()));var b=this.calendarBaseClass;this.options.dropdownClass&&(b=b+" "+this.options.dropdownClass);c(a).addClass("r9-datepicker-focus");this.dropdown.addClass(b);this.advanceStyling&&
this.dropdown.addClass("r9-advance-styling");this.wholeMonthSearch?this.dropdown.addClass("CalendarWidget-WholeMonthSearch"):this.dropdown.hasClass("CalendarWidget-WholeMonthSearch")&&this.dropdown.removeClass("CalendarWidget-WholeMonthSearch");b=this.dropdown[0].style;this.positionDropdown(a);d.events.publish("common.widgets.datepicker.DaterangePicker.showDropdown",{wrapper:a});var e=this,g=c(window).width();this.resizeHandler=function(){var b=c(window).width();10<Math.abs(b-g)&&(g=b,e.positionDropdown(a))};
c(window).on("resize",this.resizeHandler);this.bindItemEvent("mousedown",this.handleItemClickEvent);if("ontouchstart"in document.documentElement){var f=this;this.overlay.addClass("touch");this.bindOverlayEvent("mousedown",function(){f.hideDropdown()})}else this.bindItemEvent("mouseover",this.handleItemHoverEvent),this.bindItemEvent("mouseout",this.handleItemHoverEndEvent);this.isResponsive()&&this.presentationCheck()&&(this.updateTitle(),this.bindEvent(this.findCloseLink(),"click",this.handleCloseEvent));
this.bindNextPrevEvent("mousedown",this.handleNextPrevClickEvent);this.dropdown.prop("data-owner",a.attr("id"));this.loadBuzzData&&this.displayBuzzData();b.display=this.isResponsive()&&this.presentationCheck()?"block":"inline";this.wholeMonthSearch&&(e=this,jq(".noOfNightsInput").on("click",function(){jq(this).change().select()}),setTimeout(function(){jq(".noOfNightsInput").is(":focus")||(e.clickTarget=jq(".noOfNightsInput"),jq(".noOfNightsInput").trigger("click"))},300));this.isResponsive()&&(this.presentationCheck()?
this.html.addClass("mobile-overlay-fix-content"):this.html.removeClass("mobile-overlay-fix-content"))},createCalendarTabNavBindings:function(){var a=this;jq(a.dropdown).find(".tabWrapper").on("click",function(){var b=this;jq(a.dropdown).find(".tabWrapper:not(no-click)").removeClass("selected");jq(this).addClass("selected");jq(a.dropdown).removeClass("SelectedNavTab-Date").removeClass("SelectedNavTab-Month");if(jq(this).hasClass("specificDate"))setTimeout(function(){var c=jq(b).width(),e=jq(b).position().left-
25;jq(a.dropdown).find(".tabUnderlay").css({left:e,width:c})},10),setTimeout(function(){var b=jq(a.dropdown).find(".tabUnderlay");b.hasClass("no-transition")&&b.removeClass("no-transition")},100),jq(a.dropdown).addClass("SelectedNavTab-Date"),jq(a.dropdown).find(".plusMinus").stop().fadeIn(),"undefined"!==typeof d.storage&&d.storage.set("daterangePickerDefaultNavTab","specificDate"),d.events.publish("flights.search.rt.form.wholeMonthSelect.setSpecificDateCategory",{group:"wholeMonthSelect"}),this.daterangePickerDefaultNavTab=
"specificDate";else{var c=jq(a.dropdown).find(".tabUnderlay");setTimeout(function(){var a=jq(b).width(),e=jq(b).position().left-25;c.css({left:e,width:a})},10);setTimeout(function(){var b=jq(a.dropdown).find(".tabUnderlay");b.hasClass("no-transition")&&b.removeClass("no-transition")},100);jq(a.dropdown).addClass("SelectedNavTab-Month");jq(a.dropdown).find(".plusMinus").stop().fadeOut();"undefined"!==typeof d.storage&&d.storage.set("daterangePickerDefaultNavTab","wholeMonthSearch");setTimeout(function(){jq(".noOfNightsInput").is(":focus")||
(a.clickTarget=jq(".noOfNightsInput"),jq(".noOfNightsInput").trigger("click"))},300);d.events.publish("flights.search.rt.form.wholeMonthSelect.setWholeMonthCategory",{group:"wholeMonthSelect"});this.daterangePickerDefaultNavTab="wholeMonthSearch"}});jq(a.dropdown).find(".input.flexPlusMinus").on("click",function(){jq(this).toggleClass("checked");jq(this).hasClass("checked")?("undefined"!==typeof d.storage&&d.storage.set("flexPlusMinusChecked",!0),d.events.publish("flights.search.rt.form.wholeMonthSelect.enablePlusMinusSearch",
{group:"wholeMonthSelect"})):("undefined"!==typeof d.storage&&d.storage.set("flexPlusMinusChecked",!1),d.events.publish("flights.search.rt.form.wholeMonthSelect.disablePlusMinusSearch",{group:"wholeMonthSelect"}))})},createWholeMonthClickBindings:function(){var a=this;jq(a.dropdown).off("click").on("click",".monthWrapper",function(){jq(a.dropdown).find(".monthWrapper").removeClass("selected");jq(this).addClass("selected");var b=jq(this).data("month"),c=jq(this).data("end-of-month"),g=jq(this).data("year"),
f=new Date(g,b-1,1),c=new Date(g,b-1,c);moment(f).isBefore(moment())&&(f=moment().toDate());"undefined"!==typeof d.storage&&(d.storage.set("flexSelectedMonth",b),d.storage.set("flexSelectedYear",g));d.events.publish("flights.search.rt.form.wholeMonthSelect",{group:"wholeMonthSelect",startDate:f,endDate:c});d.Analytics.api.trackEvent({category:"sw16-flex-to-the-max",action:"searchByWholeMonthClick",label:"month",value:b-1});a.handleCloseEvent()})},createNoOfNightsChangedBinding:function(){var a=jq(this.dropdown).find(".noOfNightsInput");
jq(this.dropdown).off("change").on("change",".noOfNightsInput",function(){var b,c;b=a.val().replace(" ","").replace("nights","").split("-");1<b.length?(c=b[0],b=b[1]):(c=b[0],b=b[0]);7<b-c&&(c=b-7);var g=c+"-"+b;c===b&&(g=c);a.val(g);"undefined"!==typeof d.storage&&d.storage.set("flexNoOfNights",g);d.events.publish("flights.search.rt.form.noOfNightsChanged",{group:"wholeMonthSelect",noOfNights:a.val()})})},endStartIsSameField:function(){return this.options.singleDateMode||this.options.singlePickerWithSingleField},
refreshWidth:function(){var a=this.dropdown[0].style;a.width="inherit";var b=this.dropdown.outerWidth();this.options.minWidth&&(b=Math.max(this.options.minWidth,b));this.options.maxWidth&&(b=Math.min(this.options.maxWidth,b));a.width=b+this.options.offsetWidth+"px"},positionDropdown:function(a){var b=a.offset(),e=jq(this.options.appendTo).offset(),g=this.dropdown[0].style;g.zIndex=10009;c("#datepicker").removeClass("r9-datepicker-responsive-right-position");if(this.isResponsive()&&this.presentationCheck())this.dropdown.css({left:"0",
top:d.utils.presentation.isMobile()?"0":"4%"});else{var f=b.left-e.left,k=f+this.dropdown.outerWidth();k>window.innerWidth&&(k-=window.innerWidth,f=f-k-15,this.dropdown.find(".r9-datepicker-pointer").css("left",k+36+"px"));g.left=f+"px";f=0;this.element.parent()[0]===jq(document.body)[0]&&(f=parseInt((jq(document.body).css("top")||"0").replace("-",""))||0);this.shouldFlipDirection()?(this.dropdown.addClass("up"),g.top=f+b.top-this.dropdown.outerHeight()-e.top+"px"):(this.dropdown.removeClass("up"),
g.top=f+b.top+a.outerHeight()-e.top+"px")}},shouldFlipDirection:function(){var a=c(window).scrollTop(),b=a+c(window).outerHeight(),e=this.dropdown.outerHeight(),d=this.element.offset().top;return d+this.element.outerHeight()+e>b&&!(d-e<a)},initDropdown:function(){var a=this.getDropdownId(this.element),b=this.getDropdownEl(this.element).get(0);if("undefined"===typeof b){var c=d.Widgets.DaterangePicker.prototype.widgetBaseClass+" R9-Overlay";this.options.dropdownClass&&(c=c+" "+this.options.dropdownClass);
b=jq("\x3cdiv\x3e\x3c/div\x3e",{id:a,css:{display:"none",position:"absolute"}}).appendTo(this.options.appendTo)[0];jq(b).addClass(c);this.advanceStyling&&jq(b).addClass("r9-advance-styling");this.wholeMonthSearch&&(jq(b).addClass("CalendarWidget-WholeMonthSearch"),a="specificDate","undefined"!==typeof d.storage&&(a="undefined"!==typeof d.storage.get("daterangePickerDefaultNavTab")?d.storage.get("daterangePickerDefaultNavTab"):"specificDate"),"wholeMonthSearch"===a?jq(b).addClass("SelectedNavTab-Month"):
jq(b).addClass("SelectedNavTab-Date"))}this.dropdown=jq(b);this.overlay=jq("#"+this.widgetBaseClass+"-overlay");this.overlay.length||(this.overlay=jq('\x3cdiv id\x3d"'+this.widgetBaseClass+'-overlay" class\x3d"'+this.widgetBaseClass+'-overlay R9-Overlay"\x3e\x3c/div\x3e').appendTo(this.options.appendTo))},isResponsive:function(){return this.options.responsive},presentationCheck:function(){return this.options.presentationCheck()},handleResponsive:function(){this.presentationCheck()?(this.dropdown.addClass("mobile-datepicker"),
this.overlay.addClass("mobile-overlay"),this.isDropdownVisible()&&!this.html.hasClass("mobile-overlay-fix-content")&&(this.html.addClass("mobile-overlay-fix-content"),this.updateTitle(),this.bindEvent(this.findCloseLink(),"click",this.handleCloseEvent))):(this.dropdown.removeClass("mobile-datepicker"),this.overlay.removeClass("mobile-overlay"),this.html.removeClass("mobile-overlay-fix-content"));this.positionDropdown(this.actOnStart?this.getStartWrapperElement():this.getEndWrapperElement())},updateTitle:function(){var a=
"",b,c="";null!==(b=this.getStartDate())&&(a=moment(b).format(this.options.titleFormat));null!==(c=this.getEndDate())&&b!==c&&(a+=(a?" - ":"")+moment(c).format(this.options.titleFormat));this.findTitle().text(a)}}))})(R9,jQuery);(function(d){d.extend("common.widgets.datepicker.DaterangePicker.prototype.options",{startInputFormat:"MM/DD/YYYY",endInputFormat:"MM/DD/YYYY",startFormat:"ddd M/D",endFormat:"ddd M/D",inlineDisplayFormat:"MMM D",titleFormat:"MMM D"})})(window.R9);(function(){var g=function(a){a=a.split("-");return new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]))};R9.extend("PredictedPriceSource",{API:function(){}});R9.extend("PredictedPriceSource.API",{searchInfos:{},getPriceDataSetKey:function(a){if(!a)return null;var b=Array.isArray(a.origin)?a.origin[0]:a.origin,c=Array.isArray(a.destination)?a.destination[0]:a.destination;return[b,c,a.dateMode,"Default"].join("|")},getFetchUrl:function(){return R9.config.getString("ui.horizon.common.datepicker.prediction.datasource",
"/a/api/flightPricePrediction/predictCalendar")},updateSearchInfo:function(a,b,c){var e=this.searchInfos[a]||{pendingReqs:[]};c&&(e={pendingReqs:[]});this.searchInfos[a]=$.extend({},e,b);return this.searchInfos[a]},sendFetchRequest:function(a,b){return $.ajax(a,b)},failPendingReqs:function(a,b){if(a&&a.pendingReqs)for(;a.pendingReqs.length;)a.pendingReqs.pop().reject(b)},passPendingReqs:function(a){if(a&&a.pendingReqs)for(;a.pendingReqs.length;)a.pendingReqs.pop().resolve({dataSet:a.dataSet,parameters:a.parameters,
lowestMean:a.lowestMean,highestMean:a.highestMean})},onPriceFetchFail:function(a){var b=this.getPriceDataSetKey(a),b=this.updateSearchInfo(b,{fetched:!0,success:!1});this.failPendingReqs(b,a)},onPriceDataPollSuccess:function(a,b){var c=this.getPriceDataSetKey(a);this.updateSearchInfo(c,{error:b.error,success:b.success,fetched:!0,parameters:b.parameters});if(b.success)this.onPricePredictionFetch(a,b);else this.onPriceFetchFail(a)},dateToStr:function(a){return moment(a).format("YYYY-MM-DD")},getPriceDatum:function(a,
b){if(b)return a=this.dateToStr(a),b[a]},createPriceDatum:function(a,b){a=this.dateToStr(a);b[a]={date:a,returnDates:null,value:null,lastValue:null};return b[a]},onPricePredictionFetch:function(a,b){var c=b.predictions,e=this.getPriceDataSetKey(a),f=this.updateSearchInfo(e,{dataSet:{},expiresOn:moment().add(1,"days").toDate().getTime(),parameters:b.parameters}),d=f.dataSet;d&&(c.forEach(function(a){var b=d[a.startDate];b||(b={date:a.startDate,returnDates:null,value:null,lastValue:null},d[a.startDate]=
b);b.returnDates||(b.returnDates={});b.lOSBucket||(b.lOSBucket=[[],[],[],[]]);var c;c=a.startDate;c=Math.round((g(a.endDate)-g(c))/864E5);b.lOSBucket[3>=c?0:7>=c?1:14>=c?2:3].push(a.minPrice);b.returnDates[a.endDate]={price:a.minPrice,priceDisplay:R9.Common.Utils.formatPrice(a.minPrice,f.parameters.currency),returnDate:a.endDate}}),this.calculateMeanPrices(f)?this.passPendingReqs(f,a):(f.success=!1,this.failPendingReqs(f,a)))},calculateMeanPrices:function(a){var b=a.dataSet,c=Infinity,e=0,f=!1;Object.keys(b).forEach(function(d){b.hasOwnProperty(d)&&
(d=b[d],d.meanPrice=.28*this.calcMean(d.lOSBucket[0])+.33*this.calcMean(d.lOSBucket[1])+.21*this.calcMean(d.lOSBucket[2])+.18*this.calcMean(d.lOSBucket[3]),d.meanPriceDisplay=R9.Common.Utils.formatPrice(d.meanPrice,a.parameters.currency),f=!isNaN(d.meanPrice),c=Math.min(c,d.meanPrice),e=Math.max(e,d.meanPrice))}.bind(this));a.lowestMean={price:c,display:R9.Common.Utils.formatPrice(c,a.parameters.currency)};a.highestMean={price:e,display:R9.Common.Utils.formatPrice(e,a.parameters.currency)};return f},
calcMean:function(a){return a.reduce(function(a,c){return a+c},0)/a.length},fetchData:function(a,b){var c=new $.Deferred;if(!a)return c.reject("Incorrect url parameters"),c;var e=this.getPriceDataSetKey(a),f=this.getFetchUrl(a),d=this.updateSearchInfo(e,{});d.pendingReqs.push(c);d.expiresOn&&d.expiresOn<Date.now()&&(d=this.updateSearchInfo(e,{},!0));if(d.dataSet&&d.success)return this.passPendingReqs(d,a),c;if(d.xhr&&4!==d.xhr.readyState)return c;a=$.extend({},{data:this.createReqBody(a),success:this.onPriceDataPollSuccess.bind(this,
a),error:this.onPriceFetchFail.bind(this,a)},b);d.xhr=this.sendFetchRequest(f,a);return c},createReqBody:function(a){a=$.extend({},a);Array.isArray(a.origin)&&(a.origin=a.origin[0]);Array.isArray(a.destination)&&(a.destination=a.destination[0]);return a}});R9.extend("PredictedPriceSourceColorCoded",{API:function(){},sources:{single:"/a/api/flightPricePrediction/coloredCalendar/oneWay",range:"/a/api/flightPricePrediction/coloredCalendar/roundTrip"}});R9.extend("PredictedPriceSourceColorCoded.API",
R9.PredictedPriceSource.API,{getFetchUrl:function(a){return R9.config.getString("ui.horizon.common.datepicker.colorcoded.datasource."+a.dateMode,R9.PredictedPriceSourceColorCoded.sources[a.dateMode])},onPricePredictionFetch:function(a,b){var c=this.getPriceDataSetKey(a),c=this.updateSearchInfo(c,{dataSet:Object.keys(b.calendar).reduce(function(a,c){var d=b.calendar[c];a[c]={date:c,meanPrice:d.avgPrice,colorFromServer:d.color,meanPriceDisplay:R9.Common.Utils.formatPrice(d.avgPrice,b.parameters.currency)};
return a},{}),expiresOn:moment().add(1,"days").toDate().getTime(),parameters:b.parameters});c.dataSet&&this.passPendingReqs(c,a)},passPendingReqs:function(a){if(a&&a.pendingReqs)for(;a.pendingReqs.length;)a.pendingReqs.pop().resolve({dataSet:a.dataSet,parameters:a.parameters})},createReqBody:function(a){return Object.keys(a).reduce(function(b,c){var e=a[c];Array.isArray(e)?e.forEach(function(a){b.push([c,a])}):b.push([c,e]);return b},[]).map(function(a){return a[0]+"\x3d"+a[1]}).join("\x26")},getPriceDataSetKey:function(a){if(!a)return null;
var b=Array.isArray(a.origin)?a.origin.sort().join():a.origin,c=Array.isArray(a.destination)?a.destination.sort().join():a.destination;return[b,c,a.dateMode,"ColorCoded"].join("|")}})})();(function(d,e){d.createComponentClass("common.widgets.datepicker.PredictionDataProvider",{state:{searchInfos:{}},fdFormQuestion:"flights.fd.searchform",rpFormQuestion:"flights.rp.searchform",options:{formId:"",onFetchSuccess:e.noop(),onFetchFail:e.noop(),origDestListenersOff:!1,origin:null,destination:null,nonStopOnly:!1,dateMode:"range",api:d.PredictedPriceSource.API,loadingDataCallback:e.noop(),doneLoadingCallback:e.noop(),airportMultiSelectEnabled:!1},init:function(){this.origin=this.options.origin;
this.destination=this.options.destination;this.dateMode=this.options.dateMode;this.nonStopOnly=this.options.nonStopOnly},addEventHandlers:function(){var a=this;!this.options.origDestListenersOff&&this.options.formId&&(this.options.airportMultiSelectEnabled?(this.subscribe(["flights.search.rtow.form.origin","flights.search.rtow.form.destination"],{id:this.options.formId},this.populateOriginAndDestinationFromSearchForm.bind(this,!1)),this.subscribe(["flights.inline.search.rtow.form.origin","flights.inline.search.rtow.form.destination"],
{id:this.options.formId},this.populateOriginAndDestinationFromSearchForm.bind(this,!0))):(this.subscribe("flights.search.rtow.form.origin",{id:this.options.formId},function(b){a.setOrigin(b)}),this.subscribe("flights.search.rtow.form.destination",{id:this.options.formId},function(b){a.setDestination(b)}),this.subscribe("flights.inline.search.rtow.form.origin",{id:this.options.formId},function(b){a.setOrigin(b,!0)}),this.subscribe("flights.inline.search.rtow.form.destination",{id:this.options.formId},
function(b){a.setDestination(b,!0)})),this.subscribe("datepicker.setdatemode",{formId:this.options.formId},function(b){a.setDateMode(b)}))},populateOriginAndDestinationFromSearchForm:function(a,b){a=d.question.ask([a?this.rpFormQuestion:this.fdFormQuestion,this.options.formId].join("_"));b=[];var c=[];a&&a.originMultiAirports&&a.originMultiAirports.length&&(b=b.concat(this.processSmartyData(a.originMultiAirports)));a&&a.destinationMultiAirports&&a.destinationMultiAirports.length&&(c=c.concat(this.processSmartyData(a.destinationMultiAirports)));
this.origin=b;this.destination=c;this.fetchPricesInCalendar()},setOrigin:function(a,b){if(a&&this.options.airportMultiSelectEnabled){b=d.question.ask([b?this.rpFormQuestion:this.fdFormQuestion,this.options.formId].join("_"));var c=[];a.originCode&&c.push(this.getDataObject(a.originCode.split("/")[0],a.originLocation));null!==b&&b.originMultiAirports.length&&(c=c.concat(this.processSmartyData(b.originMultiAirports)));this.origin=c;this.fetchPricesInCalendar()}else a&&a.originCode?this.origin&&this.origin.originCode===
a.originCode||(this.origin=a,this.fetchPricesInCalendar()):this.origin=null},setDestination:function(a,b){if(a&&this.options.airportMultiSelectEnabled){b=d.question.ask([b?this.rpFormQuestion:this.fdFormQuestion,this.options.formId].join("_"));var c=[];a.destinationCode&&c.push(this.getDataObject(a.destinationCode.split("/")[0],a.destinationLocation));null!==b&&b.destinationMultiAirports.length&&(c=c.concat(this.processSmartyData(b.destinationMultiAirports)));this.destination=c;this.fetchPricesInCalendar()}else a&&
a.destinationCode?this.destination&&this.destination.destinationCode===a.destinationCode||(this.destination=a,this.fetchPricesInCalendar()):this.destination=null},setDateMode:function(a){a&&a.dateMode?(this.dateMode=a.dateMode,this.fetchPricesInCalendar()):this.dateMode=null},setFilters:function(a){a&&(this.nonStopOnly=!!a.nonstopOnly)},processSmartyData:function(a){var b=this;return a.map(function(a){return b.getDataObject(a.code,a.display)})},getDataObject:function(a,b){return{code:a,display:b}},
fetchPricesInCalendar:function(a){(a=a||this.getPostData())&&this.options.api.fetchData(a,{beforeSend:this.beforeSend.bind(this),onComplete:this.onComplete.bind(this)}).then(this.options.onFetchSuccess.bind(this)).catch(this.options.onFetchFail.bind(this))},beforeSend:function(){this.options.loadingDataCallback&&this.options.loadingDataCallback()},onComplete:function(){this.options.doneLoadingCallback&&this.options.doneLoadingCallback()},canFetchData:function(){return this.origin&&this.destination&&
this.dateMode&&(!this.options.airportMultiSelectEnabled||0!==this.origin.length&&0!==this.destination.length)&&""!==this.origin.originCode&&""!==this.destination.destinationCode?!0:!1},getPostData:function(){if(this.canFetchData()){var a={dateMode:this.dateMode};this.options.airportMultiSelectEnabled?(a.origin=this.origin.map(function(a){return a.code}),a.destination=this.destination.map(function(a){return a.code})):(a.origin=this.origin.originCode.split("/")[0],a.destination=this.destination.destinationCode.split("/")[0],
a.nonstopOnly=this.nonStopOnly);return a}},getDataSet:function(a){a=a||this.getPostData();return this.options.api.fetchData(a,{beforeSend:this.beforeSend.bind(this),onComplete:this.onComplete.bind(this)})},getPriceDatum:function(a,b){return this.options.api.getPriceDatum(a,b)},setOptions:function(a){var b=Object.getOwnPropertyNames(this.options),c=Object.getOwnPropertyNames(a).reduce(function(c,d){0<=b.indexOf(d)&&(c[d]=a[d]);return c},{});this.options=e.extend({},this.options,c)}})})(R9,jQuery);(function(d,c){d.createWidgetClass("datepicker.StyleJamFlexDatePickerHorizontal","common.widgets.datepicker.StyleJamFlexDatePicker",{tabContent:null,headerContent:null,inlineComponentsReady:function(){this.base();d.dom.schedule(this.adjustFlexHeaderClasses.bind(this))},addAboveCalendarContent:function(a,b){this.base(a,b);b.append(this.flexOptions)},removeAboveCalendarContent:function(){this.base();this.flexOptions.appendTo(this.aboveCalContent)},makeAboveCalendarContent:function(){this.base();this.flexOptions=
c(this.makeFlexOptionsHTML());this.aboveCalContent.append(this.flexOptions)},adjustFlexHeaderClasses:function(){var a=this.getPresentationState("form","active"),b=this.getPresentationState("form","hidden");d.dom.swapClasses(this.flexHeader.find(".form-"+this.flexCategory),b,a)},makeFlexDatesHTML:function(){var a=this,b=[];c.each(this.options.categories,function(d,c){b.push(a.makeFlexForm(c.value));a.categories[c.value]=!0});return d.template.render("flexDatePickerHorizontalHeader",{headerId:this.id("flexHeader"),
dayTipId:this.id("BUZZ_LOW"),closeBtnId:this.id("closeBtn"),formsId:this.id("flexDateForms"),forms:b.join("")})},getFlexDateOptions:function(){return this.flexOptions.find(".js-flexDateOption")},getWeekendTimeText:function(a){return c(a.getSelectedElement()).data("title")}})})(R9,jQuery);(function(e,f){e.createWidgetClass("datepicker.StyleJamFlexDatePicker","common.widgets.datepicker.StyleJamDatePicker",{flexCategory:"plusminusthree",defaultDateMode:"",flexHeader:null,flexOptions:null,flexDateForms:null,plusMinusThreeDepart:null,plusMinusThreeReturn:null,openFlexDuration:null,categories:{exact:!1,openflex:!1,plusminusthree:!1,weekend:!1},options:{openFlexDefaultDuration:"",openFlexAllowBlankDuration:!1,inlineSearchForm:!1,separateExactDateOption:!0,presentationStateKey:"",isUpdateOnDisplayChange:!0},
init:function(){this.options.flexCategory&&(this.flexCategory=this.options.flexCategory);this.base();this.defaultDateMode=this.dateMode},addEventHandlers:function(){var a=this;this.base();this.flexOptions.on("click","[data-flex-value]",this.handleFlexDateChange.bind(this)).on("mousedown","[data-flex-value]",function(){a.keyboardNav=!1});e.events.subscribe("Calendar.prevNextTabbed",this.onPrevNextChevronKeyDown.bind(this));this.bindTabOrderEvents();this.categories.openflex&&this.openFlexDuration&&
(this.openFlexDuration.styleJamTextInput(this.id("openFlexDuration"),{}),this.openFlexDuration.blur(this.onOpenFlexDurationBlur.bind(this)),this.openFlexDuration.keydown(function(b){b.which===a.Keys.RETURN?(b.preventDefault(),a.onDismiss()):b.which===a.Keys.TAB&&(b.preventDefault(),b.shiftKey?a.getLastVisibleFlexDateOption().focus():a.calendar.prev.focus())}),e.dom.schedule(function(){a.openFlexDuration.val().length||a.openFlexDuration.val(a.options.openFlexDefaultDuration)}));this.options.flexCategory&&
this.changeFlexCategory(this.options.flexCategory)},addMeToCalendar:function(){this.base();e.events.ready("datepicker.FlexDatePicker.loaded_"+this.id())},addAboveCalendarContent:function(a){this.base(a);this.flexHeader.length&&a.append(this.flexHeader)},removeAboveCalendarContent:function(){this.base();this.flexHeader.length&&this.aboveCalContent.append(this.flexHeader)},bindDropdown:function(a,b){a.on("keydown.taborder",this.onFlexDateDropdownKeyDown.bind(this));return a.styleJamDropdown({change:b.bind(this)}).getWidget()},
onPlusMinusThreeDepartChange:function(){this.publishFlexUpdate();this.markSelectedDays();e.Analytics.api.trackEvent({category:"flexDates",label:"plusMinusThree",action:"changeDepart",value:this.plusMinusThreeDepart.getValue()})},onPlusMinusThreeReturnChange:function(){this.publishFlexUpdate();this.markSelectedDays();e.Analytics.api.trackEvent({category:"flexDates",label:"plusMinusThree",action:"changeReturn",value:this.plusMinusThreeReturn.getValue()})},onWeekendDepartChange:function(a){var b=this.weekendDepartTime.getValue();
this.weekendStartTime=this.parseWeekendTimes(b);a||e.Analytics.api.trackEvent({category:"flexDates",label:"weekend",action:"changeDepart",value:b});this.markSelectedDays();this.publishFlexUpdate()},onWeekendReturnChange:function(a){var b=this.weekendReturnTime.getValue();this.weekendEndTime=this.parseWeekendTimes(b);a||e.Analytics.api.trackEvent({category:"flexDates",label:"weekend",action:"changeReturn",value:b});this.markSelectedDays();this.publishFlexUpdate()},onOpenFlexDurationBlur:function(){var a=
this.validateOpenFlexDuration();this.openFlexDuration&&(a?(this.openFlexDuration.removeClass("error"),this.openFlexDuration.val(a)):(this.openFlexDuration.addClass("error"),e.Analytics.api.trackEvent({category:"flexDates",label:"openflex",action:"error",value:encodeURIComponent(this.openFlexDuration.val())})),this.publishFlexUpdate())},makeAboveCalendarContent:function(){this.aboveCalContent=f(this.makeFlexDatesHTML()).appendTo(this.element);this.flexHeader=this.getChildElement("flexHeader");this.toolTip=
this.getChildElement("BUZZ_LOW");this.flexOptions=this.getChildElement("flexDateOptions");this.flexDateForms=this.getChildElement("flexDateForms");this.categories.openflex&&(this.openFlexDuration=this.getChildElement("openFlexDuration"));this.plusMinusThreeDepart=this.bindDropdown(this.getChildElement("plusMinusThreeDepart"),this.onPlusMinusThreeDepartChange);this.plusMinusThreeReturn=this.bindDropdown(this.getChildElement("plusMinusThreeReturn"),this.onPlusMinusThreeReturnChange);this.weekendReturnTime=
this.bindDropdown(this.getChildElement("weekendReturnTime"),this.onWeekendReturnChange);this.weekendDepartTime=this.bindDropdown(this.getChildElement("weekendDepartTime"),this.onWeekendDepartChange)},makeFlexDatesHTML:function(){var a=this,b=[];f.each(this.options.categories,function(d,c){b.push(a.makeFlexForm(c.value));a.categories[c.value]=!0});return e.template.render("flexDatePickerHeader",{headerId:this.id("flexHeader"),dayTipId:this.id("BUZZ_LOW"),closeBtnId:this.id("closeBtn"),formsId:this.id("flexDateForms"),
forms:b.join(""),options:this.makeFlexOptionsHTML()})},makeFlexOptionsHTML:function(){var a=[],b=this;f.each(this.options.categories,function(d,c){d=c.value===b.flexCategory;a.push(e.template.render("flexDatePickerCatHeader",{optionType:"weekend"===c.value||"openflex"===c.value?"read-only":"",catId:b.id(c.value),catVal:c.value,catTitle:c.title,catLabel:c.label,ariaSelected:d,extraStyles:d?b.getPresentationState("cat","selected"):b.getPresentationState("cat","default")}))});return e.template.render("flexDatePickerOptions",
{optionsId:this.id("flexDateOptions"),cats:a.join("")})},makeFlexForm:function(a){var b=a===this.flexCategory;return"plusminusthree"===a?e.template.render("flexDatePickerPlusMinusThreeForm",{formId:this.id(a)+"Form",optionId:this.id(a)+"Option",departId:this.id("plusMinusThreeDepart"),returnId:this.id("plusMinusThreeReturn"),ariaExpanded:b,departLabelId:this.id("flexDepartLabel"),returnLabelId:this.id("flexReturnLabel")}):"weekend"===a?e.template.render("flexDatePickerWeekendForm",{formId:this.id(a)+
"Form",optionId:this.id(a)+"Option",departTimeId:this.id("weekendDepartTime"),returnTimeId:this.id("weekendReturnTime"),ariaExpanded:b,departLabelId:this.id("weekendDepartTimeLabel"),returnLabelId:this.id("weekendReturnTimeLabel")}):"openflex"===a?e.template.render("flexDatePickerOpenFlexForm",{formId:this.id(a)+"Form",optionId:this.id(a)+"Option",flexDurationId:this.id("openFlexDuration"),ariaExpanded:b,labelId:this.id("openFlexDurationLabel")}):null},setDateMode:function(a,b){switch(a){case this.DateMode.RANGE:case this.DateMode.SINGLE:this.defaultDateMode=
a,"weekend"!==this.flexCategory&&"openflex"!==this.flexCategory||this.changeFlexCategory("exact")}e.dom.schedule(this.adjustHeaderFlexHeaderClasses.bind(this,a));this.base(a,b)},adjustHeaderFlexHeaderClasses:function(a){var b=this,d=this.getPresentationState("catHeader","hidden"),c=this.getPresentationState("cat","hidden"),g=this.getPresentationState("pmtSection","hidden"),k=this.getPresentationState("pmtSection","default"),h=this.flexHeader.find(".form-plusminusthree");a===this.DateMode.SINGLE?("exact"!==
this.flexCategory&&"plusminusthree"!==this.flexCategory&&this.changeFlexCategory("exact"),e.dom.swapClasses(this.flexOptions.find(".weekend, .openflex"),"",c),this.swapClasses(h,"FlexDateForms__FlexDateForm--range","FlexDateForms__FlexDateForm--single"),h.find(".col").each(function(){b.swapClasses(f(this),"col-pmtSection","col-pmtSection--centered");b.swapClasses(f(this),"PlusMinusThreeGrid__pmtDepart","PlusMinusThreeGrid__pmtDepart--centered")}),e.dom.swapClasses(this.flexHeader.find(".range-only"),
k,g),this.swapClasses(this.flexHeader.find(".range-only"),"col-pmtSection--centered","col-pmtSection--hidden"),this.hasExactTab()||this.getChildElement("flexDateOptions").addClass(d)):(this.getChildElement("flexDateOptions").removeClass(d),this.swapClasses(h,"FlexDateForms__FlexDateForm--single","FlexDateForms__FlexDateForm--range"),h.find(".col").each(function(){b.swapClasses(f(this),"col-pmtSection--centered","col-pmtSection");b.swapClasses(f(this),"PlusMinusThreeGrid__pmtDepart--centered","PlusMinusThreeGrid__pmtDepart")}),
e.dom.swapClasses(this.flexOptions.find(".exact, .weekend, .plusminusthree, .openflex"),c,""),e.dom.swapClasses(this.flexHeader.find(".range-only"),g,k))},handleFlexDateChange:function(a){var b=f(a.currentTarget).attr("data-flex-value");this.changeFlexCategory(b);setTimeout(function(){e.Analytics.api.trackEvent({category:"flexDates",label:"dateMode",action:"change",value:b})},100)},hasExactTab:function(){return this.options.separateExactDateOption},resolveFlexCategory:function(a){return this.categories.hasOwnProperty(a)?
a:"exact"},changeFlexCategory:function(a,b){var d=this.getPresentationState("cat","default"),c=this.getPresentationState("cat","focused"),g=this.getPresentationState("cat","selected"),f=this.getPresentationState("form","active"),h=this.getPresentationState("form","hidden");a=this.resolveFlexCategory(a);this.tempDate=0;this.hasExactTab()||"exact"!==a||(a="plusminusthree");if(b||a!==this.flexCategory){""!==this.flexCategory&&e.dom.schedule(function(a){var b=this.flexOptions.find("."+a);e.dom.swapClasses(b,
[g,c].join(" "),d);b.attr("aria-selected",!1);e.dom.swapClasses(this.flexHeader.find(".form-"+a),f,h)}.bind(this,this.flexCategory));this.flexCategory=a;e.dom.schedule(function(a){var b=this.flexOptions.find("."+a);e.dom.swapClasses(b,[d,c].join(" "),g);b.attr("aria-selected",!0);this.categories.openflex&&this.openFlexDuration&&this.openFlexDuration.removeClass("error");e.dom.swapClasses(this.flexHeader.find(".form-"+a),h,f)}.bind(this,this.flexCategory));switch(a){case "plusminusthree":case "exact":this.setDateMode(this.defaultDateMode);
break;case "weekend":this.setDateMode(this.DateMode.WEEKEND);break;case "openflex":this.setDateMode(this.DateMode.OPENFLEX)}this.publishFlexUpdate()}},shouldDismiss:function(){if("openflex"===this.flexCategory&&this.openFlexDuration)if(this.validateOpenFlexDuration())this.openFlexDuration.removeClass("error");else return this.openFlexDuration.addClass("error"),!1;return this.base()},onClear:function(a){a.hasOwnProperty("field")&&"endDate"===a.field&&(this.plusMinusThreeReturn.setValue("exact"),this.onPlusMinusThreeReturnChange());
this.base()},getFlexDatesDisplayData:function(){var a=this.getFlexDatesData();switch(this.flexCategory){case "plusminusthree":var b={};"exact"!==a.depart_date_flex&&(b.startDate=this.plusMinusThreeDepart.getText());this.dateMode!==this.DateMode.SINGLE&&"exact"!==a.return_date_flex&&(b.endDate=this.plusMinusThreeReturn.getText());f.extend(a,{inputDisplay:b});break;case "weekend":f.extend(a,{weekend_depart_time_display:this.getWeekendTimeText(this.weekendDepartTime),weekend_return_time_display:this.getWeekendTimeText(this.weekendReturnTime),
inputDisplay:{startDate:this.options.msg.WEEKEND_INPUT_DISPLAY_WEEKS}});break;case "openflex":f.extend(a,{inputDisplay:{startDate:this.options.msg.OPEN_FLEX_INPUT_DISPLAY_WEEKS}})}return a},getWeekendTimeText:function(a){return a.getText()},getFlexDatesData:function(a){if(a)return a=null,this.validateOpenFlexDuration()&&"openflex"===this.flexCategory&&(a=this.validateOpenFlexDuration()),{flex_category:"anywhere",explore_length_of_stay:a};a={flex_category:this.flexCategory};switch(this.flexCategory){case "plusminusthree":this.plusMinusThreeDepart&&
f.extend(a,{depart_date_flex:this.plusMinusThreeDepart.getValue()});this.dateMode!==this.DateMode.SINGLE&&this.plusMinusThreeReturn&&f.extend(a,{return_date_flex:this.plusMinusThreeReturn.getValue()});break;case "weekend":this.weekendDepartTime&&this.weekendReturnTime&&f.extend(a,{weekend_depart:this.weekendDepartTime.getValue(),weekend_return:this.weekendReturnTime.getValue()});break;case "openflex":f.extend(a,{openflex_length_of_stay:this.validateOpenFlexDuration()})}return a},publishFlexUpdate:function(){this.publishUpdate({action:"flex",
flex:this.flexCategory,fields:{startDate:!0,endDate:!0},data:this.getFlexDatesDisplayData()});"function"===typeof this.options.change&&this.options.change.apply(this,[])},getFlexCategory:function(){return this.flexCategory},validateOpenFlexDuration:function(){var a=[];(this.openFlexDuration?this.openFlexDuration.val()||"":"").split(",").forEach(function(b){var d=b.split("-");b=f.trim(d[0]);var c=Math.round(b);if(1===d.length)f.isNumeric(b)?30<c?a=null:a.push(c.toString()):a=null;else if(2==d.length){var d=
f.trim(d[1]),g=Math.round(d);f.isNumeric(b)&&f.isNumeric(d)?g<c||30<c||30<c||7<g-c?a=null:c===g?a.push(b):a.push("%s-%s".format(c.toString(),g.toString())):a=null}});return null===a?this.options.openFlexAllowBlankDuration?null:this.options.openFlexDefaultDuration:a.join(", ")},loadFlexData:function(a){e.events.when("datepicker.FlexDatePicker.loaded_"+this.id(),function(a){a.flex_category&&this.changeFlexCategory(a.flex_category);a.weekend_depart&&this.weekendDepartTime.setValue(a.weekend_depart);
a.weekend_return&&this.weekendReturnTime.setValue(a.weekend_return);a.depart_date_flex&&this.plusMinusThreeDepart.setValue(a.depart_date_flex);a.return_date_flex&&this.plusMinusThreeReturn.setValue(a.return_date_flex);if(a.openflex_length_of_stay&&this.openFlexDuration&&(this.openFlexDuration.val(a.openflex_length_of_stay),this.categories.openflex&&"openflex"===a.flex_category))this.onOpenFlexDurationBlur();this.publishFlexUpdate(a)}.bind(this,a))},getStartDayElements:function(){var a=this.base();
if("plusminusthree"===this.flexCategory){var b=this.getFlexDateRange(this.plusMinusThreeDepart.getValue(),this.startDate);f.extend(a,{flex:b})}return a},getEndDayElements:function(){var a=this.base();if("plusminusthree"===this.flexCategory){var b=this.getFlexDateRange(this.plusMinusThreeReturn.getValue(),this.endDate);f.extend(a,{flex:b})}return a},getFlexDateRange:function(a,b){var d=0,c=0,g=[];switch(a){case "plusminusthree":c=d=3;break;case "plusminustwo":c=d=2;break;case "plusminusone":c=d=1;
break;case "plusone":c=1;break;case "minusone":d=1}if(this.validateDate(b)){a=moment(b);g.push("[data-val\x3d%s]".format(b));for(b=1;b<=d;b++){var e=a.clone().subtract(b,"days").valueOf();this.validateDate(e)&&g.push("[data-val\x3d%s]".format(e))}for(d=1;d<=c;d++)b=a.clone().add(d,"days").valueOf(),this.validateDate(b)&&g.push("[data-val\x3d%s]".format(b))}return g},getPresentationState:function(){var a=Array.prototype.slice.call(arguments);a.unshift("flexDatePickerPresentationStates");return this.base.apply(this,
a)},handleTabIntoEvent:function(a){document.getSelection().removeAllRanges();this.base(a)},handleFocusAfterDateInput:function(a,b){this.dateMode===this.DateMode.SINGLE&&b.tabForward&&!this.hasExactTab()?(b.event&&b.event.preventDefault(),this.plusMinusThreeDepart.select.focus()):!a&&b.tabForward?this.getFlexDateOptions().first().focus():this.base(a,b)},onFlexDateDropdownKeyDown:function(a){var b,d=a.shiftKey,c=this.getLastVisibleFlexDateOption(),g=f(a.target);a.which===this.Keys.TAB&&(this.dateMode!==
this.DateMode.RANGE&&this.dateMode!==this.DateMode.WEEKEND?b=this.calendar.getDayElement(this.getCurrentDayVal()):g.closest(this.plusMinusThreeDepart.element).length?(this.plusMinusThreeDepart.select.blur(),b=d?c:this.plusMinusThreeReturn.select):g.closest(this.weekendDepartTime.element).length?(this.weekendDepartTime.select.blur(),b=d?c:this.weekendReturnTime.select):g.closest(this.plusMinusThreeReturn.element).length?(this.plusMinusThreeReturn.select.blur(),b=d?this.plusMinusThreeDepart.select:
this.calendar.prev):g.closest(this.weekendReturnTime.element).length&&(this.weekendReturnTime.select.blur(),b=d?this.weekendDepartTime.select:this.calendar.prev),b&&(a.preventDefault(),b.focus()))},onPrevNextChevronKeyDown:function(a){var b;a=a.event;var d=a.shiftKey;if(a.which===this.Keys.TAB){b=this.calendar.next;var c=this.calendar.prev,g=f(a.target).closest(c).length;!g&&this.setPicking("startDate");g?c.blur():b.blur();b=g?d?this.plusMinusThreeReturn:b:d?this.calendar.next:this.calendar.getDayElement(this.getCurrentDayVal())}b&&
(a.preventDefault(),b.focus())},bindTabOrderEvents:function(){var a=this,b=a.getPresentationState("cat","default"),d=a.getPresentationState("cat","focused"),c=a.getPresentationState("cat","selected");this.flexOptions.on("keydown",".js-flexDateOption",function(b){var c=f(this).attr("data-flex-value");if(b.which===a.Keys.RETURN||b.which===a.Keys.SPACE)b.preventDefault(),a.handleFlexDateChange({currentTarget:this});if(b.which===a.Keys.TAB)if(a.keyboardNav=!0,b.shiftKey&&(a.hasExactTab()&&"exact"===c||
!a.hasExactTab()&&"plusminusthree"===c))b.preventDefault(),a.publishCurrentInputFocus();else if(!b.shiftKey&&f(this).attr("id")===a.getLastVisibleFlexDateOptionId())switch(b.preventDefault(),a.flexCategory){case "plusminusthree":case "exact":a.hasExactTab()&&"plusminusthree"!==a.flexCategory?"startDate"===a.picking?(0<a.startDate||a.changeDate(moment(new Date).startOf("day").valueOf(),!0),a.calendar.getDayElement(a.startDate).focus()):"endDate"===a.picking&&(0<this.endDate?a.calendar.getDayElement(a.endDate).focus():
a.changeDate(moment(new Date).startOf("day").valueOf(),!0),a.calendar.getDayElement(a.endDate).focus()):a.plusMinusThreeDepart.select.focus();break;case "weekend":a.weekendDepartTime.select.focus();break;case "openflex":a.openFlexDuration.focus()}}).on("blur",".js-flexDateOption",function(){e.dom.schedule(function(a){e.dom.swapClasses(a,d,b);a.is("[aria-selected\x3dtrue]")&&e.dom.swapClasses(a,b,c)}.bind(null,f(this)))}).on("focus",".js-flexDateOption",function(g){a.keyboardNav&&e.dom.schedule(function(a){a.is("[aria-selected\x3dtrue]")&&
e.dom.swapClasses(a,c,b);e.dom.swapClasses(a,b,d)}.bind(null,f(this)))})},getFlexDateOptions:function(){return this.flexOptions.find(".js-flexDateOption")},getLastVisibleFlexDateOption:function(){return f("#"+this.getLastVisibleFlexDateOptionId())},getLastVisibleFlexDateOptionId:function(){return this.dateMode===this.DateMode.SINGLE?this.id("plusminusthreeOption"):this.categories.openflex?this.id("openflexOption"):this.id("weekendOption")},toggleFlexMode:function(a){this.flexHeader.toggleClass(this.getPresentationState("dateHeader",
"hidden"),!a);a||(this.changeFlexCategory("exact",!0),this.plusMinusThreeReturn.setValue("exact"),this.onPlusMinusThreeReturnChange(),this.plusMinusThreeDepart.setValue("exact"),this.onPlusMinusThreeDepartChange())}})})(R9,jQuery);(function(f,e){f.createWidgetClass("datepicker.StyleJamDatePicker",{DateMode:{SINGLE:"single",RANGE:"range",WEEKEND:"weekend",OPENFLEX:"openflex"},Keys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,RETURN:13,PAGE_UP:33,PAGE_DOWN:34,SPACE:32,HOME:36,SHIFT:16,END:35,ESC:27},options:{msg:{},title:"",initDate:"",fullCssClass:"",startDate:"",endDate:"",dateMode:"range",group:"",updateGroup:"",minRange:0,change:null,dismiss:null,closeDelay:0,getFormData:null,consecutive:!0,delayShowDropdown:e.noop,showDropdownDelay:200,
keepOpenOnRangeStartChange:!0,hasPointer:!0,mobileBreakpoint:568,presentationStates:{},optionalReturn:!1,appendTo:null,hasCloseButton:!0},dateMode:"range",startDate:0,endDate:0,tempDate:0,weekendStartTime:{day:4,partial:""},weekendEndTime:{day:0,partial:""},picking:"startDate",prevState:null,visible:!1,html:null,fullScreen:!1,calendar:null,toolTip:null,init:function(){this.html=e("html");this.makeAboveCalendarContent();this.makeBelowCalendarContent();f.events.when("common.widgets.datepicker.stylejamcalendar.initialized",
function(a){this.calendar=a.instance;this.options.startDate&&this.validateDate(this.options.startDate)&&(this.startDate=moment(this.options.startDate).valueOf());this.options.endDate&&this.validateDate(this.options.endDate)&&(this.endDate=moment(this.options.endDate).valueOf());this.options.dateMode&&this.setDateMode(this.options.dateMode);this.addMeToCalendar()}.bind(this))},addMeToCalendar:function(){this.calendar.addPicker({id:this.id(),dateMode:this.dateMode,initDate:this.options.initDate,title:this.options.title,
cssClass:this.options.fullCssClass,group:this.options.group,onLoad:this.onLoad.bind(this),onUnload:this.onUnload.bind(this),onDayClick:this.onDayClick.bind(this),onDayOver:this.onDayPreviewOver.bind(this),onDayOut:this.onDayPreviewOut.bind(this),onDayKeydown:this.onDayKeydown.bind(this)})},onLoad:function(a){this.addAboveCalendarContent(a.aboveCalendarContainer,a.tabContainer);this.addBelowCalendarContent(a.belowCalendarContainer,a.tabContainer)},onUnload:function(){this.removeAboveCalendarContent();
this.removeBelowCalendarContent()},addAboveCalendarContent:function(a){this.aboveCalContent.length&&(a.append(this.aboveCalContent),this.toolTip.length&&a.append(this.toolTip))},addBelowCalendarContent:function(){},removeAboveCalendarContent:function(){this.aboveCalContent.length&&(this.element.append(this.aboveCalContent),this.toolTip.length&&this.aboveCalContent.append(this.toolTip))},removeBelowCalendarContent:function(){},addEventHandlers:function(){this.subscribe("DateInput.update",{group:this.options.group},
this.onDateInputUpdate.bind(this));this.subscribe("DateInput.summon",{group:this.options.group},this.onSummon.bind(this));this.subscribe("DateInput.dismiss",{group:this.options.group},this.onDismiss.bind(this));this.subscribe("DateInput.destroy",{group:this.options.group},this.destroy.bind(this));this.subscribe("DateInput.publishUpdate",this.publishUpdate.bind(this));this.subscribe("Calendar.monthchange",{group:this.options.group},this.onMonthChange.bind(this));this.subscribe("forceDismiss.DatePicker",
this.onDismiss.bind(this));this.subscribe("forceDismiss.DatePicker.ifOpen",this.dismissDatePickerIfOpen.bind(this));e(document).on("click.DatePicker",this.hideOnClickOut.bind(this));e(window).on("resize.DatePicker",this.handleWindowResize.bind(this));this.options.optionalReturn&&this.subscribe("DateInput.clear",{group:this.options.group},this.onClear.bind(this))},destroy:function(){e(window).off("resize.DatePicker"+this.id());e(document).off("click.DatePicker"+this.id());this.base();this.element.remove()},
getCssClass:function(){return[this.base(),"R9-Overlay"].join(" ")},hideOnClickOut:function(a){var b=e(a.target).closest("[data-date-group\x3d%s]".format(this.options.group));if((a.originalEvent||!f.config.getBoolean("ui.xp.autoopen-dp",!1))&&this.isCalendarOpen()&&0===b.length)this.onDismiss()},handleWindowResize:function(){this.isCalendarOpen()&&(this.calendar.append(this.options.appendTo)||this.calendar.position(this.picking))},publishUpdate:function(a){e.extend(a,{updateGroup:this.options.updateGroup,
group:this.options.group});f.events.publish("DatePicker.update",a)},onDateInputUpdate:function(a){if(this.isCalendarOpen()||a.force)switch(a.clear&&this.clear(),a.picking&&this.updatePickingVal(a.picking),a.weekendStartTime&&(this.weekendStartTime=this.parseWeekendTimes(a.weekendStartTime)),a.weekendEndTime&&(this.weekendEndTime=this.parseWeekendTimes(a.weekendEndTime)),a.dateMode&&this.setDateMode(a.dateMode),a.action){case "preview":this.updatePickingVal(a.field);!a.previous&&a.value||this.removeDatePreview(a.previous,
!0);a.value&&this.previewDate(a.value,a.preventUpdate);break;case "change":a.spinner&&this.handleSpinnerUpdate(a);this.changeDate(a.value,a.focused||a.spinner,a.tabForward,a.event);break;case "tab":this.handleTabIntoEvent(a)}},onSummon:function(a){if(this.calendar)if(this.tempDate=0,"function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.onSummon.bind(this,a),this.options.showDropdownDelay);else{null!==
this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);this.setPicking(a.field,!0);null!==this.options.getFormData?this.element.addClass("Buzz"):this.element.removeClass("Buzz");a.modal?this.element.addClass("InModal"):this.element.removeClass("InModal");a.sticky?this.element.addClass("InSticky"):this.element.removeClass("InSticky");this.validateDate(a.minDate,!0)&&this.setMinDate(a.minDate);if(!this.isCalendarOpen()||this.calendar.isDifferentPicker(this.id())){this.calendar.open(this.id());
f.dom.swapClasses(this.aboveCalContent,this.getPresentationState("aboveCalContent","hidden"),this.getPresentationState("aboveCalContent","visible"));var b=f.question.ask("DateInput.%s.startDate".format(this.options.group));b&&(this.startDate=b.value);if(this.dateMode===this.DateMode.RANGE){var c=f.question.ask("DateInput.%s.endDate".format(this.options.group));this.validateDateRange(b.value,c.value)&&(this.startDate=b.value,this.endDate=c.value);c&&(this.endDate=c.value)}"function"===typeof this.options.open&&
this.options.open.call(this);f.events.publish("DatePicker.opened",this.options.group);this.setDateMode(this.dateMode)}this.calendar.setDisplayHeight();this.calendar.append(this.options.appendTo)||this.calendar.position(this.getPicking());f.config.getBoolean("ui.horizon.datepicker.highlight.proper.range.on.open",!0)?this.moveMonthIntoView(this[a.field]):this.moveDateIntoView(this[a.field]);this.markSelectedDays();this.updateBuzzData();this.options.hasCloseButton&&this.bindEvent(this.findCloseLink(),
"click",this.handleCloseEvent)}},dismissDatePickerIfOpen:function(a){this.isCalendarOpen()&&this.onDismiss(a)},onDismiss:function(a){this.shouldDismiss(a)&&(this.options.closeDelay?setTimeout(this.dismissDatePicker.bind(this,a),this.options.closeDelay):this.dismissDatePicker(a))},dismissDatePicker:function(a){this.calendar&&(a=a||{},this.visible=!1,this.hideTooltip(),0!==this.tempDate&&this.changeDate(this.tempDate,!1,!1,null),this.calendar.buffer(this.options.appendTo),this.calendar.close(this.id()),
f.dom.swapClasses(this.aboveCalContent,this.getPresentationState("aboveCalContent","visible"),this.getPresentationState("aboveCalContent","hidden")),this.publishUpdate(e.extend(a,{action:"blur",fields:{startDate:!0,endDate:!0},format:"display"})),"function"===typeof this.options.dismiss&&this.options.dismiss(a),f.events.publish("DatePicker.closed",e.extend({},a,{group:this.options.group})))},shouldDismiss:function(a){return this.dateMode===this.DateMode.RANGE&&a&&this.options.consecutive&&(a.tabForward&&
"startDate"===this.getPicking()||a.tabBackward&&"endDate"===this.getPicking())?!1:!0},onClear:function(a){},onDayClick:function(a){this.changeDate(e(a).data("val"))},canIncludeStartDateInRange:function(a,b){return this.validateDateRange(a,b)},changeDate:function(a,b,c,d){var g=!1,h=!0,f=this.getPicking(),e={action:"change",fields:{}};this.tempDate=0;if(this.dateMode===this.DateMode.RANGE){if("startDate"===this.getPicking()&&this.validateDate(a))this.startDate===a&&this.options.consecutive?(h=!1,this.setPicking("endDate",
c,void 0,c)):(this.startDate=a,e.fields.startDate=a,this.canIncludeStartDateInRange(a,this.endDate)||(this.endDate=0,this.options.optionalReturn?e.fields.endDate=null:(e.fields.endDate=this.getMinEndDate(),this.endDate=e.fields.endDate)),this.moveDateIntoView(a),this.markSelectedDays(),!b&&this.isCalendarOpen()&&((0===this.endDate||this.options.keepOpenOnRangeStartChange)&&this.options.consecutive?this.setPicking("endDate",c,void 0,c):g=!1===b)),"endDate"===this.wasPicking&&this.endDate&&(e.fields.endDate=
this.endDate);else if("endDate"===this.getPicking()&&this.validateDate(a))if(this.endDate===a)h=!1,0===this.startDate&&this.options.consecutive?this.setPicking("startDate"):g=!b;else{if(this.validateDateRange(this.startDate,a)||!this.startDate)this.endDate=a,e.fields.endDate=a;this.startDate||(this.startDate=this.getMinStartDate(),e.fields.startDate=this.startDate);this.moveDateIntoView(this.endDate);this.markSelectedDays();b||(0===this.startDate&&this.options.consecutive?this.setPicking("startDate"):
g=!0)}e.picking=this.getPicking()}else{this.moveDateIntoView(a);e.fields.startDate=a;if(this.validateDate(this.endDate)&&!this.validateDateRange(a,this.endDate)){var l=Math.max(this.options.minRange,1),l=moment(a).add(l,"days");e.fields.endDate=l.valueOf();this.endDate=e.fields.endDate}this.startDate=a;this.markSelectedDays();b||(g=!0)}e.tabForward=c;h&&this.publishUpdate(e);"function"===typeof this.options.change&&(a=[this.startDate],a.push(this.endDate?this.endDate:null),a.push(f),this.options.change.apply(this,
a));g&&(g={},g.field=this.picking,g.tabForward=c,g.event=d,g.focusDisplay=!0,this.onDismiss(g))},moveDateIntoView:function(a){this.isCalendarOpen()&&0!==a&&(a=this.calendar.calculateMonthOffset(a),0!==a&&this.calendar.changeMonth(a))},moveMonthIntoView:function(a){this.isCalendarOpen()&&0!==a&&(a=moment(a).startOf("month").diff(this.calendar.getCurrentDate().startOf("month"),"month"),"endDate"===this.getPicking()&&0<a&&a--,this.calendar.changeMonth(a))},clear:function(){this.endDate=this.startDate=
0;this.setPicking("startDate");this.clearDayState("preview hover highlighted selected startDate endDate");this.publishUpdate({action:"clear",fields:{startDate:0,endDate:0}})},onMonthChange:function(){this.updateBuzzData();this.markSelectedDays()},clearDayState:function(a){this.calendar.clearDayState(a)},validateDate:function(a,b){if("undefined"===typeof a||0===a||!this.calendar)return!1;a=moment(a);var c=this.calendar.getMinDate(this.id());if(a.isValid()){if(a.isBefore(this.calendar.now)&&!this.options.allowPastDates||
!b&&null!==c&&a.isBefore(c))return!1}else return!1;return!0},validateDateRange:function(a,b){return a&&b?this.validateMinRange(a,b)&&this.validateDate(a)&&this.validateDate(b):!1},validateMinRange:function(a,b){a=moment(a);return moment(b).diff(a,"days")>=this.options.minRange},getMinStartDate:function(){return this.endDate?moment(this.endDate).subtract(this.options.minRange,"days").valueOf():0},getMinEndDate:function(){return this.startDate?moment(this.startDate).add(this.options.minRange,"days").valueOf():
0},onDayPreviewOver:function(a){var b=e(a).data("val");this.previewDate(b);e(a).attr("data-tip")&&this.showTooltip(e(a))},previewDate:function(a,b){var c=moment(a),d={action:"preview",fields:{},picking:this.getPicking()};if(!a||c.isBefore(this.calendar.now))c=this.calendar.now.clone(),a=c.valueOf();else if(c.isSame(this.calendar.maxDate)||c.isAfter(this.calendar.maxDate))c=this.calendar.maxDate.clone(),a=c.valueOf();this.dateMode===this.DateMode.RANGE?"endDate"===this.getPicking()&&0!==this.startDate?
this.validateMinRange(this.startDate,a)?this.validateDateRange(this.startDate,a)?d.fields[this.getPicking()]=a:d.endDate=this.getMinEndDate():(0===this.endDate?(this.endDate=this.startDate,this.startDate=0,d.fields={startDate:a,endDate:this.endDate}):d.fields={startDate:a,endDate:0},this.wasPicking=this.getPicking(),this.setPicking("startDate",!1,!0),d.picking="startDate"):d.fields[this.getPicking()]=a:d.fields.startDate=a;b||this.publishUpdate(d);this.moveDateIntoView(a);this.markPreviewedDays(a)},
removeDatePreview:function(a,b){if(this.isCalendarOpen()){a={action:"preview",fields:{startDate:0,endDate:0},clear:!0};this.clearDayState("preview hover");this.hideTooltip();if(this.wasPicking){var c=this[this.wasPicking],d=this[this.getPicking()];if(0===d||0===c)this[this.wasPicking]=d,this[this.getPicking()]=c;delete a.fields[this.wasPicking];this.setPicking(this.wasPicking,!1,!0);this.wasPicking=null;this.markSelectedDays()}a.picking=this.getPicking();b||this.publishUpdate(a)}},onDayPreviewOut:function(a){a=
e(a).data("val");this.removeDatePreview(a)},setDateMode:function(a){this.dateMode=a;this.dateMode!==this.DateMode.RANGE&&this.setPicking("startDate");this.isCalendarOpen()&&this.markSelectedDays();this.options.formId&&""!==this.options.formId?f.events.publish("datepicker.setdatemode",{formId:this.options.formId,dateMode:a}):f.events.publish("datepicker.setdatemode",{dateMode:a})},computeActiveDates:function(a,b){switch(this.dateMode){case this.DateMode.RANGE:return this.computeActiveRangeDates(a,
b);default:return a?[a.format(b)]:[b]}},canSelectAsStartDate:function(a,b){return a<=b},computePreSelectedRangeDates:function(a){var b;if(a&&a.length){var c=this.calendar.getSelectableDays(".highlighted,.selected");b=c.not(a.join());if(c.length===b.length)return null}return b},computeActiveRangeDates:function(a,b){var c;b||(b=this[this.getPicking()]);b&&(c=moment(b));var d=[];if(c)if("startDate"===this.getPicking()&&this.endDate&&c.valueOf()<=this.endDate){var e=this.endDate,h=this.calendar.getMonthDate(3),
f=moment(this.endDate);if(h.isSame(f)||h.isBefore(f))e=this.calendar.getMonthDate(3).valueOf();for(;this.canSelectAsStartDate(c.valueOf(),e);)a?d.push(a.format(c.valueOf())):d.push(c.valueOf()),c.add(1,"day")}else if("endDate"===this.getPicking()&&this.startDate&&c.valueOf()>=this.startDate){e=this.startDate;h=this.calendar.getMonthDate(-1);f=moment(this.startDate);if(h.isSame(f)||h.isAfter(f))e=this.calendar.getMonthDate(-1).valueOf();for(;c.valueOf()>=e;)a?d.unshift(a.format(c.valueOf())):d.unshift(c.valueOf()),
c.add(-1,"day")}else a?d.push(a.format(b)):d.push(b);d.length||(a?d.push(a.format(b)):d.push(b));return d},computeActiveWeekendDates:function(a,b){b=b?moment(b):moment(this.startDate);for(var c=b.clone().add(5,"weeks"),d={selected:[],highlighted:[]},e=!1,f=[],k=[];b.isSame(c)||b.isBefore(c);)!e&&b.day()>this.weekendStartTime.day||(b.day()===this.weekendStartTime.day?(e=!0,f=[],k=[],a?f.push(a.format(b.valueOf())):f.push(b.valueOf())):b.day()===this.weekendEndTime.day&&e?(a?f.push(a.format(b.valueOf())):
f.push(b.valueOf()),d.selected=d.selected.concat(f),d.highlighted=d.highlighted.concat(k)):(b.day()>this.weekendStartTime.day||b.day()<this.weekendEndTime.day)&&e&&(a?k.push(a.format(b.valueOf())):k.push(b.valueOf()))),b.add(1,"day");return d},computeActiveOpenFlexDates:function(a,b){b=b?moment(b):moment(this.startDate);for(var c=b.clone().add(5,"weeks"),d=[];b.isSame(c)||b.isBefore(c);)a?d.push(a.format(b.valueOf())):d.push(b.valueOf()),b.add(1,"day");return d},parseWeekendTimes:function(a){var b=
a.split("_");a=b[0];b=b[1];return{day:moment().set("day",a).day(),partial:"ANYTIME"!==b?b:""}},markSelectedDays:function(){var a;if(this.isCalendarOpen())switch(this.clearDayState("highlighted preview selected startDate endDate hover"),this.dateMode){case this.DateMode.RANGE:a=this.computeActiveDates("[data-val\x3d%s]");1<a.length&&this.highlightDates(a);this.startDate&&(a=this.getStartDayElements(),a.flex&&this.calendar.markFlex(a.flex),a.exact&&this.markStartDate(a.exact));this.endDate&&(a=this.getEndDayElements(),
a.flex&&this.calendar.markFlex(a.flex),a.exact&&this.markEndDate(a.exact));break;default:this.calendar.selectDate(this.startDate)}},highlightDates:function(a){this.calendar.highlightDates(a)},markStartDate:function(a){this.calendar.markStartDate(a)},markEndDate:function(a){this.calendar.markEndDate(a)},getStartDayElements:function(){return{exact:this.startDate}},getEndDayElements:function(){return{exact:this.endDate}},markPreviewedDays:function(a){if(this.isCalendarOpen()){this.clearDayState("preview hover");
var b=this.computeActiveDates("[data-val\x3d%s]",a);this.calendar.markPreviewDates(b);this.calendar.hoverDay(a)}},setPicking:function(a,b,c,d){if(this.getPicking()!==a){this.tempDate=0;var e={},f={};e[this.getPicking()]=!0;f[a]=!0;this.updatePickingVal(a);this.isCalendarOpen()&&(this.calendar.position(this.getPicking(),c),b||this.publishUpdate({action:"focus",fields:f,format:"input"}),this.publishUpdate({action:"blur",fields:e,tabForward:d}))}},updatePickingVal:function(a){this.picking=a},getPicking:function(){return this.picking},
findCloseLink:function(){return this.getChildElement("closeBtn")},handleCloseEvent:function(){this.onDismiss()},bindEvent:function(a,b,c){var d=this;b+="."+this.id();a.off(b).on(b,function(a){return c.call(d,this,a)})},isBuzzEnabled:function(){return"function"===typeof this.options.getFormData&&f.DatePicker&&f.DatePicker.BuzzData},updateBuzzData:function(){this.isBuzzEnabled()&&(new f.DatePicker.BuzzData).fetch(this.options.getFormData(),this.handleBuzzUpdate.bind(this))},handleBuzzUpdate:function(a){this.calendar&&
this.calendar.handleBuzzUpdate(a)},makeAboveCalendarContent:function(){this.aboveCalContent=f.template.renderElement("aboveCalContent",{dayTipId:this.id("BUZZ_LOW"),closeBtnId:this.id("closeBtn")}).appendTo(this.element);this.toolTip=this.getChildElement("BUZZ_LOW")},makeBelowCalendarContent:function(){},showTooltip:function(a){a=a.offset();var b=this.calendar.element.offset();a={top:Math.round(a.top-b.top),left:Math.round(a.left-b.left)};this.toolTip.length&&(this.toolTip.css(a),f.dom.swapClasses(this.toolTip,
this.getPresentationState("toolTip","hidden"),this.getPresentationState("toolTip","visible")))},hideTooltip:function(){this.toolTip&&f.dom.swapClasses(this.toolTip,this.getPresentationState("toolTip","visible"),this.getPresentationState("toolTip","hidden"))},setMinDate:function(a){this.calendar.setMinDate(a,this.id())},getPresentationState:function(){var a=Array.prototype.slice.call(arguments),b=0,c=this.options.presentationStates;do c=c.hasOwnProperty(a[b])?c[a[b]]:null,b++;while(null!=c&&b<a.length);
return c},onDayKeydown:function(a,b){a=moment(this.getCurrentDayVal());var c=!0,d=!1,e=this.picking,f,k=!0,m;switch(b.which){case this.Keys.UP:a.subtract(1,"week");break;case this.Keys.DOWN:a.add(1,"week");break;case this.Keys.LEFT:a.subtract(1,"day");break;case this.Keys.RIGHT:a.add(1,"day");break;case this.Keys.PAGE_UP:b.ctrlKey||b.metaKey?a.subtract(1,"year"):a.subtract(1,"month");break;case this.Keys.PAGE_DOWN:b.ctrlKey||b.metaKey?a.add(1,"year"):a.add(1,"month");break;case this.Keys.HOME:a=a.startOf("month");
break;case this.Keys.END:a=a.endOf("month");break;case this.Keys.SPACE:this.tempDate=0;d=!0;c=!1;f=!0;break;case this.Keys.TAB:case this.Keys.RETURN:this.tempDate=0;c=!1;d=!b.shiftKey;k=!1;m=!0;break;case this.Keys.ESC:this.tempDate=0;this.onDismiss({focusDisplay:!0});break;default:c=k=!1}c&&this.validateDate(a.valueOf(),!1)&&("endDate"!==this.picking||this.validateDateRange(this.startDate,a.valueOf()))&&(this.tempDate=a.valueOf(),this.previewDate(this.tempDate),this.calendar.getDayElement(this.tempDate).focus());
d&&this.changeDate(a.valueOf(),f,void 0,b);k&&b.preventDefault();m&&this.handleDayNextFocus(b,e)},getCurrentDayVal:function(){var a=this.tempDate?this.tempDate:this[this.getPicking()];0===a&&(a="startDate"===this.getPicking()||0===this.startDate?moment().startOf("day").valueOf():this.getMinEndDate());return a},publishCurrentInputFocus:function(){var a={};a[this.getPicking()]=!0;this.publishUpdate({action:"focus",fields:a,format:"input"})},handleTabIntoEvent:function(a){this.setPicking(a.field);"startDate"===
this.getPicking()?0<this.startDate?(this.changeDate(this.startDate,!0,a.tabForward,a.event),this.handleFocusAfterDateInput(!0,a)):(this.changeDate(moment(this.calendar.getMinDate()).startOf("day").valueOf(),!0),this.calendar.getDayElement(this.startDate).focus()):"endDate"===this.getPicking()&&(0<this.endDate?(this.changeDate(this.endDate,!0,a.tabForward,a.event),this.handleFocusAfterDateInput(!1,a)):this.startDate?this.changeDate(moment(this.getMinEndDate()).startOf("day").valueOf(),!0):this.changeDate(moment((new Date).valueOf()).startOf("day").valueOf(),
!0))},handleFocusAfterDateInput:function(a,b){b=e.extend(b,{tabBackward:!b.tabForward});if(a)if(b.tabForward&&this.dateMode===this.DateMode.RANGE)b.event&&b.event.preventDefault(),this.setPicking("endDate"),this.publishCurrentInputFocus();else this.onDismiss(b);else b.event&&b.event.preventDefault(),b.tabForward?(this.setPicking("startDate"),this.calendar.getDayElement(this.startDate).focus()):(this.setPicking("startDate"),this.publishCurrentInputFocus())},handleDayNextFocus:function(a,b){var c,d=
a.shiftKey;"endDate"===b?d?(a.preventDefault(),this.setPicking("startDate"),this.calendar.getDayElement(this.startDate).focus()):c=!0:d?(a.preventDefault(),this.publishCurrentInputFocus()):this.dateMode===this.DateMode.RANGE?(a.preventDefault(),this.setPicking("endDate"),this.calendar.getDayElement(this.endDate).focus()):c=!0;if(c)this.onDismiss({event:a,returnEvent:a.which===this.Keys.RETURN,focusDisplay:a.which===this.Keys.ESC,tabForward:!d,tabBackward:d})},handleSpinnerUpdate:function(a){var b=
a.currentValue,c=a.delta;b||("endDate"===this.getPicking()&&this.startDate?b=this.getMinEndDate():(b=(new Date).valueOf(),c=1));a.value=moment(b).add(c,"day").valueOf()},isCalendarOpen:function(){return this.calendar&&this.calendar.isOpen&&this.calendar.currentPickerId===this.id()}})})(R9,jQuery);(function(c,g,h){c.createWidgetClass("datepicker.ColorCodedDatePicker","common.widgets.datepicker.StyleJamFlexDatePickerHorizontal",{footerContent:null,formDataQuestion:"flights.fd.searchform",formDataQuestionRP:"flights.rp.searchform",priceType:{GOOD:0,AVERAGE:50,EXPENSIVE:90},options:{priceInCalendarEnabled:!1,withHoverPrice:!1,oneWayEnabled:!1,messages:{displayPriceFmt:"",footerText:{single:"",range:""}},formId:"",airportMultiSelectEnabled:!1},state:{dataSet:null,currencyCode:"",economyCabin:!0,
noChildren:!0},init:function(){this.base();var a={formId:this.options.formId,onFetchSuccess:this.handleFetchSuccess.bind(this),onFetchFail:this.handleFetchFail.bind(this),dateMode:this.dateMode,airportMultiSelectEnabled:this.options.airportMultiSelectEnabled};if(this.options.oneWayEnabled||this.options.airportMultiSelectEnabled)a.api=c.PredictedPriceSourceColorCoded.API;this.priceDataProvider=new c.common.widgets.datepicker.PredictionDataProvider(this.id("predictionProvider"),a)},addEventHandlers:function(){this.base();
this.subscribe("flights.search.travelers.change",this._handleTravelersChange.bind(this));this.subscribe("flights.search.cabinType.change",this._handleCabinChange.bind(this))},handleFetchSuccess:function(){this.checkAndUpdatePriceIndicators()},handleFetchFail:function(){this.clearPriceIndicators();this.state.dataSet=null},_handleTravelersChange:function(a){if(a=a&&a.data)this.state.noChildren=0===a.child+a.seatInfant+a.lapInfant},_handleCabinChange:function(a){if(a=a&&a.value)this.state.economyCabin=
"e"===a},addBelowCalendarContent:function(a){this.footerContent&&this.footerContent.length&&a.empty().append(this.footerContent)},removeBelowCalendarContent:function(){this.footerContent&&this.footerContent.length&&this.element.append(this.footerContent)},makeBelowCalendarContent:function(){this.options.priceInCalendarEnabled&&(this.footerContent=g(this.createFooter()).appendTo(this.element))},createFooter:function(){return c.template.render("flexDatePickerFooter",{footerId:this.id("footer")})},changeFlexCategory:function(a,
b){this.base(a,b);this.checkAndUpdatePriceIndicators()},isExactTab:function(){return"exact"===this.flexCategory||"plusminusthree"===this.flexCategory},checkAndUpdatePriceIndicators:function(){this.isCalendarOpen()&&(!this.state.economyCabin||!this.state.noChildren||"exact"!==this.flexCategory&&"plusminusthree"!==this.flexCategory||!this.options.oneWayEnabled&&this.dateMode!==this.DateMode.RANGE?(this.swapClasses(this.footerContent,"FlexDateFooter--visible","FlexDateFooter--hidden"),this.clearPriceIndicators(),
this.calendar.getSelectableDays().addClass(this.getStlBlocks("Calendar__ColDay--pic Calendar__ColDay--pic--active")),this.markSelectedDays()):(this.calendar.clearDayState("highlighted preview selected startDate endDate hover"),this.markSelectedDays(),this.updatePriceDataInDates()))},changeDate:function(a,b,e,d){if("startDate"===this.getPicking()&&this.validateDate(a)){if(!this.calendar.getCurrentPicker()){this.base(a,b,e,d);return}this.clearDayState("previnrange")}this.base(a,b,e,d)},highlightDates:function(a){this.isExactTab()&&
this.dateMode===this.DateMode.RANGE?(this.clearPriceIndicators(a),this.calendar.highlightDates(a,function(){return this.getStlBlocks("Calendar__ColDay--pic--highlighted")}.bind(this))):this.base(a)},markStartDate:function(a){if(this.isExactTab()&&this.dateMode===this.DateMode.RANGE){var b=this;this.clearPriceIndicators(["[data-val\x3d%s]".format(a)]);this.calendar.selectDate(a,function(){return"startDate "+b.getStlBlocks("Calendar__ColDay--pic--selected")},function(){return b.dayStateClasses("hover highlighted")})}else this.base(a)},
markEndDate:function(a){if(this.isExactTab()&&this.dateMode===this.DateMode.RANGE){var b=this;this.clearPriceIndicators(["[data-val\x3d%s]".format(a)]);this.calendar.selectDate(a,function(){return"endDate "+b.getStlBlocks("Calendar__ColDay--pic--selected")},function(){return b.dayStateClasses("hover highlighted")})}else this.base(a)},onMonthChange:function(){this.isExactTab()?(this.markSelectedDays(),this.checkAndUpdatePriceIndicators(),this.logEvent({action:"month-change"})):this.base()},onDismiss:function(a){this.base(a);
this.swapClasses(this.footerContent,"FlexDateFooter--visible","FlexDateFooter--hidden");a&&a.silent||this.logEvent({action:"dismiss"})},onSummon:function(a){this.base(a);this.isCalendarOpen()&&(this.options.oneWayEnabled||this.dateMode===this.DateMode.RANGE?"weekend"!==this.flexCategory&&"openflex"!==this.flexCategory?(this.updateTravelersAndCabinType(),this.checkAndUpdatePriceIndicators()):this.swapClasses(this.footerContent,"FlexDateFooter--visible","FlexDateFooter--hidden"):(this.swapClasses(this.footerContent,
"FlexDateFooter--visible","FlexDateFooter--hidden"),this.calendar.getSelectableDays().addClass(this.getStlBlocks("Calendar__ColDay--pic Calendar__ColDay--pic--active"))),this.calendar.setDisplayHeight())},updateTravelersAndCabinType:function(){var a=c.question.ask("SearchPage.view"),a=c.question.ask("RP"===a?this.formDataQuestionRP:this.formDataQuestion),b=c.question.ask("flights.search.cabinType."+this.options.formId+".get");a&&(this.state.noChildren=0===a.child+a.seatInfant+a.lapInfant);b?this.state.economyCabin=
"e"===b.value:a&&(this.state.economyCabin="e"===a.cabin);this.footerContent&&this.footerContent.find(".footer-label").text(this.options.messages.footerText[this.dateMode])},getRadioButtonSimplifiedFlexData:function(a){return a},updatePriceDataInDates:function(){if(this.calendar.getCurrentPicker()&&this.isCalendarOpen()){var a=h(this.calendar.getCurrentDate()).startOf("month"),b=a.clone().add(1,"months").endOf("month"),e=a.clone(),d=h().startOf("day");this.calendar.getSelectableDays().addClass(this.getStlBlocks("Calendar__ColDay--pic Calendar__ColDay--pic--active"));
this.priceDataProvider.getDataSet().then(function(a){var f=this.state.dataSet=a.dataSet;this.state.currencyCode=a.parameters.currency;var c=[];if(f)for(;e.isSameOrBefore(b);){if(!e.isBefore(d)){var k=this.priceDataProvider.getPriceDatum(e,f),g={};if(k){var h=this.dateToStr(e);g.forDate=h;g.price=k.meanPrice;g.displayPrice=k.meanPriceDisplay;c.push(g)}}e.add(1,"days")}f=c.reduce(function(a,b){return Math.min(a,b.price)},Infinity);k=c.reduce(function(a,b){return Math.max(a,b.price)},-1);this.updateFooterBar(a,
f,k);this.updateCalendarDates(c,f,k);this.logEvent({action:"update-colors"})}.bind(this)).fail(function(){this.state.dataSet=null}.bind(this))}},updateFooterBar:function(a,b,e){if(this.footerContent)if(e<b)this.swapClasses(this.footerContent,"FlexDateFooter--visible","FlexDateFooter--hidden");else{this.swapClasses(this.footerContent,"FlexDateFooter--hidden","FlexDateFooter--visible");a=c.Common.Utils.String.formatString(this.options.messages.displayPriceFmt,c.Common.Utils.formatOptionalPrice(b,!0,
!0));var d=c.Common.Utils.String.formatString(this.options.messages.displayPriceFmt,c.Common.Utils.formatOptionalPrice(b+.9*(e-b),!0,!0)),f=c.Common.Utils.String.formatString(this.options.messages.displayPriceFmt,c.Common.Utils.formatOptionalPrice(b+.3*(e-b),!0,!0));0===e-b&&(f=c.Common.Utils.String.formatString(this.options.messages.displayPriceFmt,c.Common.Utils.formatOptionalPrice(1.3*b,!0,!0)),d=c.Common.Utils.String.formatString(this.options.messages.displayPriceFmt,c.Common.Utils.formatOptionalPrice(1.9*
b,!0,!0)));this.footerContent.find(".min-price").text(a);this.footerContent.find(".mid-price").text(f);this.footerContent.find(".max-price").text(d);this.logEvent({action:"update-legends"})}},updateCalendarDates:function(a,b,e){a=a.reduce(function(a,f){var d=f.forDate,c=this.priceType.GOOD;if(b<=e){var g=(f.price-b)/(e-b)*100;90<g?c=this.priceType.EXPENSIVE:30<g&&(c=this.priceType.AVERAGE)}a[d]={date:f.forDate,val:f.price,display:f.displayPrice,priceType:c};return a}.bind(this),{});this.updateDatesWithPriceData({minVal:b,
maxVal:e,dataSet:a})},updateDatesWithPriceData:function(a){var b=a.dataSet;this.calendar.getSelectableDays().each(function(a,d){a=g(d);d=a.attr("data-val");d=h(parseInt(d));a.addClass(this.getStlBlocks("Calendar__ColDay--pic Calendar__ColDay--pic--active"));d.isValid()?(a.data("pricedata",null),d=d.format("YYYY-MM-DD"),b[d]&&(a.data("pricedata",JSON.stringify(b[d])),a.is(".selected")||a.is(".highlighted")||c.dom.swapClasses(a,this.getStlBlocks("Calendar__ColDay--pic--0 Calendar__ColDay--pic--50 Calendar__ColDay--pic--90"),
this.getStlBlocks("Calendar__ColDay--pic Calendar__ColDay--pic--active Calendar__ColDay--pic--"+b[d].priceType))),d="",a.is(".selected")&&(d+=" Calendar__ColDay--pic--selected"),a.is(".highlighted")&&(d+=" Calendar__ColDay--pic--highlighted"),c.dom.swapClasses(a,"",this.getStlBlocks(d))):c.dom.swapClasses(a,this.dayStateClasses("preview hover"),"")}.bind(this))},dayStateClasses:function(a){var b="Calendar__ColDay--pic--0 Calendar__ColDay--pic--50 Calendar__ColDay--pic--90 ",b=a?b+a.split(" ").map(function(a){return"Calendar__ColDay--pic--"+
a}).join(" "):b+" Calendar__ColDay--pic--selected Calendar__ColDay--pic--highlighted Calendar__ColDay--pic--hover Calendar__ColDay--pic--preview";return this.getStlBlocks(b)},resetColColors:function(a,b){var e=this;return function(d){if(!e.isWeekendOrMonthView()){var f;try{f=JSON.parse(g(d).data("pricedata"))}catch(n){}var c=["Calendar__ColDay--pic","Calendar__ColDay--pic--active"],h=d.is(".highlighted")&&!a,k=d.is(".selected")&&!b;!f||h||k?d.is(".highlighted")?c.push("Calendar__ColDay--pic--highlighted"):
d.is(".selected")&&c.push("Calendar__ColDay--pic--selected"):c.push("Calendar__ColDay--pic--"+f.priceType);return e.getStlBlocks(c.join(" "))}}},clearDayState:function(a,b,e){var d=this;if(this.isWeekendOrMonthView())return this.base(a);this.calendar.clearDayState(a,b||this.resetColColors(),e||function(){return d.dayStateClasses(a)})},clearPriceIndicators:function(a){this.calendar.getSelectableDays(a?a.join(","):null).removeClass(this.dayStateClasses())},dateToStr:function(a){return h(a).format("YYYY-MM-DD")},
strToDate:function(a){return h(a,"YYYY-MM-DD")},isWeekendOrMonthView:function(){return"exact"!==this.flexCategory&&"plusminusthree"!==this.flexCategory},markPreviewedDays:function(a){if(this.isWeekendOrMonthView())this.base(a);else if(this.isCalendarOpen()){this.clearDayState("preview hover");var b=this.computeActiveDates("[data-val\x3d%s]",a),e=this.calendar.getSelectableDays(b.join()),d=this.computePreSelectedRangeDates(b),c=this;d&&(d.addClass("previnrange"),this.clearDayState("previnrange",this.resetColColors(!0,
!0),function(){return c.getStlBlocks("Calendar__ColDay--pic--highlighted Calendar__ColDay--pic--selected")}));this.calendar.markPreviewDates(b,function(){return c.getStlBlocks("Calendar__ColDay--pic Calendar__ColDay--pic--active Calendar__ColDay--pic--preview")},function(){return c.dayStateClasses("")});e.filter(".startDate,.endDate").removeClass(this.dayStateClasses()+" previnrange").addClass(function(){var b=g(this),d=b.data("val");return"startDate"===c.getPicking()&&b.is(".startDate")&&!b.is(".endDate")&&
d!==a||"endDate"===c.getPicking()&&b.is(".endDate")&&!b.is(".startDate")&&d!==a?c.getStlBlocks("Calendar__ColDay--pic--preview")+" preview":c.getStlBlocks("Calendar__ColDay--pic--selected")});this.calendar.hoverDay(a,function(){return c.getStlBlock("Calendar__ColDay--pic--hover")},function(){return c.dayStateClasses("preview")+" preview"})}},removeDatePreview:function(a,b){this.base(a,b);this.isWeekendOrMonthView()||(a=this.calendar.getSelectableDays(".day.highlighted,.day.startDate,.day.endDate"),
a.removeClass(this.getStlBlocks("Calendar__ColDay--pic--preview")+" preview"),a.filter(".startDate").removeClass(this.dayStateClasses()).addClass(this.getStlBlocks("Calendar__ColDay--pic--startDate Calendar__ColDay--pic--selected")),a.filter(".endDate").removeClass(this.dayStateClasses()).addClass(this.getStlBlocks("Calendar__ColDay--pic--endDate Calendar__ColDay--pic--selected")),a.filter(".highlighted").removeClass(this.dayStateClasses()).addClass(this.getStlBlocks("Calendar__ColDay--pic--highlighted")))},
onDayPreviewOver:function(a){var b=g(a).data("val");this.previewDate(b);this.options.withHoverPrice&&this.dateMode===this.DateMode.RANGE&&this.showTooltip(g(a))},showTooltip:function(a){var b=a.offset(),e=this.calendar.element.offset(),d=this.calendar.element.outerWidth(),b={top:Math.round(b.top-e.top-2),left:Math.round(b.left-e.left)};(e=this.calcTooltipVal(a))&&this.toolTip.length&&(this.toolTip.text(c.Common.Utils.String.formatString(this.options.messages.displayPriceFmt,e)),c.dom.swapClasses(this.toolTip,
this.getPresentationState("toolTip","hidden"),this.getPresentationState("toolTip","visible")),a=this.toolTip.outerWidth()/2-a[0].offsetWidth,b.left-=a,this.toolTip.css(b),d<b.left+this.toolTip.outerWidth()?(this.toolTip.css("left",d-this.toolTip.outerWidth()),this.toolTip.addClass(this.getStlBlock("ColorCodedTip--touchedRight"))):this.toolTip.removeClass(this.getStlBlock("ColorCodedTip--touchedRight")),this.logEvent({action:"show-tooltip"}))},calcTooltipVal:function(a){var b=g(a).data("pricedata"),
c=h(parseInt(g(a).data("val"))),d=0<this.startDate&&h(this.startDate),f=0<this.endDate&&h(this.endDate),l=this.getPicking();if(!this.state.dataSet)return null;try{b=JSON.parse(b||"{}")}catch(m){this.log.warn("Error parsing priceData for date, "+g(a).data("val")),b=null}if("endDate"===l&&this.startDate&&c.isSameOrAfter(d)){if((f=this.state.dataSet[d.format("YYYY-MM-DD")])&&f.returnDates&&f.returnDates[c.format("YYYY-MM-DD")])return f.returnDates[c.format("YYYY-MM-DD")].priceDisplay}else if("startDate"===
l&&(!this.endDate||f&&c.isSameOrBefore(f))){if((c=this.state.dataSet[c.format("YYYY-MM-DD")])&&c.returnDates&&this.endDate&&c.returnDates[f.format("YYYY-MM-DD")])return c.returnDates[f.format("YYYY-MM-DD")].priceDisplay}else return b?b.display:null;return null},logEvent:function(a){a=g.extend({},a,{category:this.options.withHoverPrice?"color-coded-calendar-with-hover-price":"color-coded-calendar"});c.Analytics.api.trackEvent(a)},isBuzzEnabled:function(){return!1}})})(R9,jQuery,moment);(function(b,c){b.createWidgetClass("datepicker.StyleJamDateRangeInput",{separator:null,options:{group:"",dateMode:"range",datePickerId:null,responsive:!1,responsiveMobileOnly:!1,dateRangeInputFlex:null,dateRangeInputBlurred:null,dateRangeInputFocused:null,flexIconVisible:null,flexIconHidden:null,displayFlexHidden:null,endInputHidden:null,presentationBase:"",changeEvent:null},startWrapper:null,endWrapper:null,flexWrapper:null,suspendBlur:!1,init:function(){this.separator=this.getChildElement("separator");
this.$flexIcon=this.element.find(".js-flexIcon");this.endCol=this.getChildElement("end");this.endWrapper=this.getChildElement("endWrapper");this.flexWrapper=this.getChildElement("flexWrapper")},addEventHandlers:function(){var a=this;this.subscribe("DatePicker.update",{group:this.options.group},this.onDatePickerUpdate.bind(this));this.options.changeEvent&&(this.subscribe(this.options.changeEvent+".change",function(b){if(!b.namespace||a.id().startsWith(b.namespace))a.onDisplayCatChange(b.value)}),this.subscribe(this.options.changeEvent+
".set",this.onDisplayCatChange.bind(this)));this.subscribe("DatePicker.opened",this.options.group,this.toggleFocusState.bind(this,!0));this.subscribe("DatePicker.closed",{group:this.options.group},this.toggleFocusState.bind(this,!1))},toggleFocusState:function(a){a?(b.dom.swapClasses(this.element,this.options.dateRangeInputBlurred,this.options.dateRangeInputFocused),b.events.publish("DateRangeInput.opened",this.options.group)):(b.dom.swapClasses(this.element,this.options.dateRangeInputFocused,this.options.dateRangeInputBlurred),
b.events.publish("DateRangeInput.closed",this.options.group))},onInputFocus:function(){var a=this;this.toggleFocusState(!0);this.suspendBlur=!0;setTimeout(function(){a.suspendBlur=!1},100)},onInputBlur:function(){this.suspendBlur||this.toggleFocusState(!1)},onDatePickerUpdate:function(a){"flex"===a.action&&("openflex"===a.data.flex_category||"weekend"==a.data.flex_category?(this.setDateMode("range",a.data.flex_category),this.showFlexDisplay()):(this.toggleFlex(a.data.flex_category),this.hideFlexDisplay()),
this.options.flexDisplayEnabled&&("plusminusthree"===a.data.flex_category?"exact"===a.data.depart_date_flex&&"exact"===a.data.return_date_flex?this.hideFlexIcon():this.showFlexIcon():"exact"===a.data.flex_category?this.hideFlexIcon():this.showFlexIcon()))},onDisplayCatChange:function(a){switch(a){case "oneway":this.setDateMode("single");break;case "roundtrip":this.setDateMode("range")}},getField:function(a){return"range"===this.options.dateMode?a.offsetX<=this.separator.position().left?"startDate":
"endDate":"startDate"},setDateMode:function(a,b){this.options.dateMode=a;"single"===a?(this.endCol.attr("aria-hidden","true"),this.separator.attr("aria-hidden","true"),this.hideEndDate()):(this.endCol.attr("aria-hidden","false"),this.separator.attr("aria-hidden","false"),this.showEndDate(),this.options.changeEvent&&this.subscribe(this.options.changeEvent,this.onDisplayCatChange.bind(this)));"undefined"!==typeof b&&this.toggleFlex(b)},toggleFlex:function(a){"weekend"===a||"openflex"===a?(this.element.addClass("mode-flex"),
this.flexWrapper.attr("aria-hidden","false"),this.endWrapper.attr("aria-hidden","true")):(this.element.removeClass("mode-flex"),this.flexWrapper.attr("aria-hidden","true"),this.endWrapper.attr("aria-hidden","false"))},getStlChildrenClasses:function(){return b.stylejam.common.widgets.datepicker.StyleJamDateRangeInput[this.options.presentationBase]},showEndDate:function(){b.dom.swapChildrenClasses(this.element,this.getStlChildrenClasses(),"single","range")},hideEndDate:function(){b.dom.swapChildrenClasses(this.element,
this.getStlChildrenClasses(),"range","single")},showFlexIcon:function(){b.dom.swapChildrenClasses(this.element,this.getStlChildrenClasses(),"noflex","flex")},hideFlexIcon:function(){b.dom.swapChildrenClasses(this.element,this.getStlChildrenClasses(),"flex","noflex")},showFlexDisplay:function(){b.dom.swapClasses(this.endWrapper,"",this.options.endInputHidden);b.dom.swapClasses(this.flexWrapper,this.options.displayFlexHidden,"")},hideFlexDisplay:function(){b.dom.swapClasses(this.flexWrapper,"",this.options.displayFlexHidden);
b.dom.swapClasses(this.endWrapper,this.options.endInputHidden,"")},focus:function(){var a=this.element.data("dateModal");a?a.toggleOverlayWindow(!0):b.events.publish("DateInput.startDate.focus",{group:this.options.group})}})})(R9,jQuery);(function(a,d){a.createWidgetClass("datepicker.DateModal",{display:null,overlayWindow:null,overlayContent:null,overlayBackground:null,inputWrapper:null,endInput:null,placeholderUpdateInterval:null,overlayInit:!1,triggeringFocus:!1,clicking:!1,open:!1,focusTimeout:-1,spinnerIds:null,startDate:null,startTime:null,startTimeSelect:null,endDate:null,endTime:null,endTimeSelect:null,endTimeWasChangedByUser:!1,timeValuesMap:null,displayMode:null,options:{mobileBreakpoint:568,desktopBreakpoint:1024,dateFormat:"ddd M/D",
spinners:!1,isDateTime:!1,isSingle:!1,timeDropdown:!1,timeDropdownOpenStartAfterDate:!1,timeDropdownOpenEndAfterStart:!1,timeDropdownSyncEndToStart:!1,syncChangedByUserEndTimeToStart:!0,flexEnabled:!1,alignment:"left",responsive:!1,compressedLayout:!1,repositionOnScroll:!1,startDateField:"",startDateId:"",endDateField:"",endDateId:"",datePickerId:"",datePickerClassName:"",group:"",updateGroup:"",scrollLockEnabled:!1},displayStart:null,inputStartDec:null,inputStartInc:null,inputSeparator:null,displayEnd:null,
inputEndDec:null,inputEndInc:null,displayStartIcon:null,displayEndIcon:null,displayStartChevron:null,displayEndChevron:null,scrollPosition:void 0,previousOverflow:void 0,init:function(){var b=this;this.display=this.getChildElement("display");this.displayStartInner=this.getChildElement("display-start-inner");this.displayEndInner=this.getChildElement("display-end-inner");this.overlayWindow=this.getChildElement("overlay-window");this.overlayContent=this.getChildElement("overlay-content");this.overlayBackground=
this.getChildElement("overlay-bg");this.inputWrapper=this.getChildElement("input-wrapper");this.close=this.getChildElement("close");this.options.startDate&&this.setStartDate(moment(this.options.startDate).valueOf());this.options.endDate&&this.setEndDate(moment(this.options.endDate).valueOf());this.options.spinners&&(this.spinnerIds="#"+this.id("start-inc")+", #"+this.id("end-inc")+", #"+this.id("start-dec")+", #"+this.id("end-dec"));this.displayMode=this.options.flex?"flex":this.options.dateMode;
this.options.flexEnabled&&(this.flexStartDisplay=this.getChildElement("start-flex"),this.flexEndDisplay=this.getChildElement("end-flex"));this.endInput=this.inputWrapper.find(".js-end-input");this.startTime=this.getChildElement("start-time");this.startTimeSelect=this.getChildElement("start-time-select").getWidget();this.endTime=this.getChildElement("end-time");this.endTimeSelect=this.getChildElement("end-time-select").getWidget();setTimeout(function(){b.overlayWindow.css("display","block")},200);
this.options.compressedLayout&&(this.displayStart=this.getChildElement("display-start"),this.inputStartDec=this.getChildElement("start-dec"),this.inputStartInc=this.getChildElement("start-inc"),this.inputSeparator=this.getChildElement("input-separator"),this.displayEnd=this.getChildElement("display-end"),this.inputEndDec=this.getChildElement("end-dec"),this.inputEndInc=this.getChildElement("end-inc"),this.displayStartIcon=this.getChildElement("display-start-icon-wrapper"),this.displayEndIcon=this.getChildElement("display-end-icon-wrapper"),
this.displayStartChevron=this.getChildElement("display-start-chevron-wrapper"),this.displayEndChevron=this.getChildElement("display-end-chevron-wrapper"))},bindComponent:function(){(this.options.isSingle||this.options.isDateTime)&&this.base();this.element.data("dateModal",this)},inlineComponentsReady:function(){var b=this;a.dom.schedule(function(){b.positionOverlayWindow()})},addEventHandlers:function(){var b=this;this.registerEvent("mousedown",this.display,function(){b.clicking=!0});this.registerEvent("click",
this.display,function(a){b.clicking=!1;d(a.target).closest("#"+b.id("start-time-select")+",#"+b.id("end-time-select")).length||b.options.spinners&&0!==d(a.target).closest(b.spinnerIds).length||b.toggleOverlayWindow(!0,0<d(a.target).closest("#"+b.id("display-end")).length)});this.registerEvent("mouseup",function(){b.clicking=!1});this.registerEvent("click",this.close,function(){b.toggleOverlayWindow(!1)});this.registerEvent("focus",this.display,function(){if(!b.clicking)if(b.triggeringFocus)b.onFocus(!1),
b.triggeringFocus=!1,clearTimeout(b.focusTimeout);else b.onFocus(!0)});this.registerEvent("keydown",this.display,function(c){c.which===a.globals.keyCodes.TAB?(clearTimeout(b.focusTimeout),b.toggleOverlayWindow(!1)):c.which===a.globals.keyCodes.RETURN&&(clearTimeout(b.focusTimeout),b.toggleOverlayWindow(!0))});this.subscribe("overlay.setitem.complete",function(){b.toggleOverlayWindow(!1)});this.subscribe("DateModal.toggleOverlayWindow",function(a){b.toggleOverlayWindow(a)});this.subscribe("DateInput."+
this.options.group+".setDateMode",function(a){b.setDateMode(a)});this.options.flexEnabled&&(this.subscribe("DateInput."+this.options.group+".startDate.flexChange",function(a){b.flexStartDisplay.html(a)}),this.subscribe("DateInput."+this.options.group+".endDate.flexChange",function(a){b.flexEndDisplay.html(a)}));this.subscribe("DateInput."+this.options.group+".startDate.setDate",function(a){var c=a&&a.date&&a.date.valueOf();null!==c&&b.setStartDate(c);b.refreshInput(b.displayStartInner,a.date)});this.subscribe("DateInput."+
this.options.group+".startDate.clearDate",function(a){b.setStartDate(null);b.refreshInput(b.displayStartInner,null)});this.subscribe("DateInput."+this.options.group+".endDate.setDate",function(a){var c=a&&a.date&&a.date.valueOf();null!==c&&b.setEndDate(c);b.refreshInput(b.displayEndInner,a.date)});this.subscribe("DateInput."+this.options.group+".endDate.clearDate",function(a){b.setEndDate(null);b.refreshInput(b.displayEndInner,null)});this.options.compressedLayout&&this.subscribe("DatePicker.layout.compressed.toggle",
function(a){b.toggleCompressedLayout(a)});this.options.isDateTime&&(this.timeValuesMap={},this.options.timeValues.forEach(function(b){this.timeValuesMap[b.value]=b},this),this.subscribe("DateInput.update",{group:this.options.group,action:"time"},function(a){var c=a.fields.startDate;if(c||0===c)b.startTimeSelect?b.startTimeSelect.setValue(c):(c=b.getTimeDisplay(c),b.startTime.html(c));if((a=a.fields.endDate)||0===a)b.endTimeSelect?b.endTimeSelect.setValue(a):(a=b.getTimeDisplay(a),b.endTime.html(a))}),
this.startTimeSelect&&(this.startTimeSelect.options.change=this.onStartTimeChange.bind(this)),this.endTimeSelect&&(this.endTimeSelect.options.change=this.onEndTimeChange.bind(this)));this.options.flexEnabled&&this.subscribe("DatePicker.update",{group:this.options.group,action:"flex"},this.onFlexUpdate.bind(this));this.subscribe("DatePicker.closed",{group:this.options.group},function(a){b.toggleOverlayWindow(!1);if(a.tabForward||a.tabBackward||a.focusDisplay||a.returnEvent)b.triggeringFocus=!0,b.display.focus();
var c=b.startTimeSelect;b.options.isDateTime&&b.openTimeDropdown&&(b.startDateChanged||b.endDateChanged)&&c&&setTimeout(function(){b.openTimeDropdown=!1;c.focusInlineElement();c.open()},100)});this.subscribe("DateInput.startDate.focus",b.options.group,function(){b.openTimeDropdown=b.options.timeDropdownOpenStartAfterDate;b.startDateChanged=!1;b.endDateChanged=!1});this.options.spinners&&(this.bindSpinner("start-inc","startDate",1),this.bindSpinner("start-dec","startDate",-1),this.bindSpinner("end-inc",
"endDate",1),this.bindSpinner("end-dec","endDate",-1));this.registerEvent("click.overlay",d(document),function(a){0===d(a.target).closest("#"+b.id("overlay-window")+", #"+b.id("display")+", [data-date-group\x3d"+b.options.group+"]").length&&b.toggleOverlayWindow(!1)});this.registerEvent("resize",d(window),this.positionOverlayWindow.bind(this));this.options.changeEvent&&(this.subscribe(this.options.changeEvent+".change",function(a){if(!a.namespace||b.id().startsWith(a.namespace))b.onDisplayCatChange(a.value)}),
this.subscribe(this.options.changeEvent+".set",this.onDisplayCatChange.bind(this)));this.options.compressedLayout&&this.subscribe("hotels.detailsv2.sticky.toggle",function(b){b?this.hotelDetailsStickyShow():this.hotelDetailsStickyHide()}.bind(this));this.options.repositionOnScroll&&this.registerEvent("scroll",d(window),function(){a.dom.schedule(b.positionOverlayWindow.bind(b))})},onStartTimeChange:function(b,a,e){if((e=d("#"+this.options.startDateId).getWidget())&&e.setTime){e.setTime(a);var c=this.options,
f=this.endTimeSelect;f&&(c.timeDropdownOpenEndAfterStart?setTimeout(function(){c.timeDropdownSyncEndToStart&&!this.endTimeWasChangedByUser&&(this.onEndTimeChange(b,a,!0),f.val(a));f.focusInlineElement();f.open()}.bind(this),100):c.timeDropdownSyncEndToStart&&!this.endTimeWasChangedByUser&&setTimeout(function(){this.onEndTimeChange(b,a,!0);f.val(a)}.bind(this),100))}},onEndTimeChange:function(a,c,e){(a=d("#"+this.options.endDateId).getWidget())&&a.setTime&&a.setTime(c);this.shouldMarkEndTimeChangedByUser(e)&&
(this.endTimeWasChangedByUser=!0)},shouldMarkEndTimeChangedByUser:function(a){return!this.options.syncChangedByUserEndTimeToStart&&!this.endTimeWasChangedByUser&&!0!==a},bindSpinner:function(b,c,d){var e=this;this.registerEvent("click",this.getChildElement(b),function(){e.publishEvent("DateInput.update",{action:"change",currentValue:e[c],delta:d,field:c,picking:c,force:!0,spinner:!0});a.Analytics.api.trackEvent({category:c,label:"arrow",action:"click",value:0<d?"inc":"dec"})})},destroy:function(){this.base();
this.element.data("dateModal",null);window.clearInterval(this.placeholderUpdateInterval)},positionOverlayWindow:function(){var a=this.display.offset(),c=this.display.outerWidth(!0),e=parseInt(this.display.css("margin-left"),10);a&&(e="right"===this.options.alignment&&this.canRightAlign()?Math.floor(a.left+(c-this.overlayWindow.outerWidth())-8):"center"===this.options.alignment?Math.floor(a.left+(c-this.overlayWindow.outerWidth())/2):Math.floor(a.left-e+8),this.overlayBackground.css({width:c-16,height:this.display.outerHeight()-
16}),this.positionOverlayInputWrapper(c),this.isFullScreen()?this.overlayContent.css({minWidth:0}):this.overlayContent.css({minWidth:Math.max(c,516)}),e+this.overlayWindow.outerWidth()+16>d(window).innerWidth()&&(c=d(window).innerWidth()-this.overlayWindow.outerWidth()-16,e=0<c?c:0),this.open&&"parentIFrame"in window&&window.parentIFrame.sendMessage({action:"DatePicker.opened",mode:this.isFullScreen()?"FullScreen":"Normal"}),this.overlayWindow.css({maxWidth:d(window).outerWidth(),transform:"translate("+
e+"px,"+Math.floor(a.top+8)+"px)"}))},toggleOverlayWindow:function(b,c){var d=this.isFullScreen()?1:200;b!==this.open&&(this.open=b,this.options.scrollLockEnabled&&window.innerWidth<this.options.mobileBreakpoint&&(b?this.lockScroll():this.unlockScroll()),b?(this.positionOverlayWindow(),a.dom.swapChildrenClasses(this.overlayWindow,this.getStlClasses().OverlayWindow,"hidden","visible"),this.overlayContent.addClass("visible"),this.focusTimeout=setTimeout(function(){c?this._publishDateInputFocus("DateInput.endDate.focus"):
this._publishDateInputFocus("DateInput.startDate.focus")}.bind(this),d)):(a.dom.swapChildrenClasses(this.overlayWindow,this.getStlClasses().OverlayWindow,"visible","hidden"),this.overlayContent.removeClass("visible"),this.publishEvent("DatePicker.dismiss",{}),"parentIFrame"in window&&window.parentIFrame.sendMessage({action:"DatePicker.closed"})))},onFocus:function(a){this.toggleOverlayWindow(a)},lockScroll:function(){var a=d("html");this.scrollPosition={x:window.pageXOffset||document.documentElement.scrollLeft||
document.body.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop};this.previousOverflow=a.css("overflow");a.css("overflow","hidden")},unlockScroll:function(){var a=d("html");this.previousOverflow&&a.css("overflow",this.previousOverflow);this.scrollPosition&&window.scrollTo(this.scrollPosition.x,this.scrollPosition.y)},_publishDateInputFocus:function(b){a.events.publish(b,this.options.group)},positionOverlayInputWrapper:function(a){"undefined"===typeof a&&
(a=this.display.outerWidth(!0));this.inputWrapper.css({width:a})},refreshInput:function(a,c){null!==c?(a.html(c.format(this.options.dateFormat)),this.swapClasses(a,this.getStlClasses().inputDateEmpty,this.getStlClasses().inputDateFull)):(a.html(a.attr("data-placeholder")),this.swapClasses(a,this.getStlClasses().inputDateFull,this.getStlClasses().inputDateEmpty))},getOverlayWrapper:function(){return this.overlayContent},focus:function(){var a=this;setTimeout(function(){a.display.trigger("focus")},
50)},isFullScreen:function(){return this.options.mobileBreakpoint>=d(window).outerWidth()},canRightAlign:function(){return this.options.mobileBreakpoint<=d(window).outerWidth()},publishEvent:function(b,c){d.extend(c,{updateGroup:this.options.updateGroup,group:this.options.group});a.events.publish(b,c)},getTimeDisplay:function(a){return this.timeValuesMap[a].text},onDisplayCatChange:function(a){switch(a){case "oneway":this.setDateMode("single");break;case "roundtrip":this.setDateMode("range")}},setDateMode:function(a){this.setDisplayMode(a);
this.options.dateMode=a},setDisplayMode:function(b){var c=this.displayMode;a.dom.swapChildrenClasses(this.display,this.getStlClasses().DisplayInput,c,b);this.displayMode=b;this.endInput&&this.endInput.length&&this.endInput.toggleClass(this.getStlBlock("OverlayInput--hidden"),"single"===b);this.swapClasses(this.overlayContent,"Overlay-"+this.options.datePickerClassName+"--"+c,"Overlay-"+this.options.datePickerClassName+"--"+b)},onFlexUpdate:function(a){switch(a.flex){case "weekend":case "openflex":this.setFlex(!0);
break;case "duration":break;default:this.setFlex(!1)}setTimeout(function(){this.positionOverlayInputWrapper()}.bind(this),0)},setFlex:function(a){(this.options.flex=a)?this.setDisplayMode("flex"):this.setDisplayMode(this.options.dateMode)},toggleCompressedLayout:function(b){b?(a.dom.swapClasses(this.display,a.stylejam.common.widgets.datepicker.DateModal.inputResponsive,a.stylejam.common.widgets.datepicker.DateModal.inputStatic),a.dom.swapClasses(this.displayStart,a.stylejam.common.widgets.datepicker.DateModal.inputDateResponsive,
a.stylejam.common.widgets.datepicker.DateModal.inputDateStatic),a.dom.swapClasses(this.displayStart,a.stylejam.common.widgets.datepicker.DateModal.inputDateStartResponsive,a.stylejam.common.widgets.datepicker.DateModal.inputDateStartStatic),a.dom.swapClasses(this.inputStartDec,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic),a.dom.swapClasses(this.inputStartInc,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive,
a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic),a.dom.swapClasses(this.inputSeparator,a.stylejam.common.widgets.datepicker.DateModal.inputSeparatorResponsive,a.stylejam.common.widgets.datepicker.DateModal.inputSeparatorStatic),a.dom.swapClasses(this.displayEnd,a.stylejam.common.widgets.datepicker.DateModal.inputDateResponsive,a.stylejam.common.widgets.datepicker.DateModal.inputDateStatic),a.dom.swapClasses(this.inputEndDec,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive,
a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic),a.dom.swapClasses(this.inputEndInc,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic),a.dom.swapClasses(this.displayStartIcon,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIcon,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIconHidden),a.dom.swapClasses(this.displayEndIcon,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIcon,
a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIconHidden)):(a.dom.swapClasses(this.display,a.stylejam.common.widgets.datepicker.DateModal.inputStatic,a.stylejam.common.widgets.datepicker.DateModal.inputResponsive),a.dom.swapClasses(this.displayStart,a.stylejam.common.widgets.datepicker.DateModal.inputDateStatic,a.stylejam.common.widgets.datepicker.DateModal.inputDateResponsive),a.dom.swapClasses(this.displayStart,a.stylejam.common.widgets.datepicker.DateModal.inputDateStartStatic,a.stylejam.common.widgets.datepicker.DateModal.inputDateStartResponsive),
a.dom.swapClasses(this.inputStartDec,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive),a.dom.swapClasses(this.inputStartInc,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive),a.dom.swapClasses(this.inputSeparator,a.stylejam.common.widgets.datepicker.DateModal.inputSeparatorStatic,a.stylejam.common.widgets.datepicker.DateModal.inputSeparatorResponsive),
a.dom.swapClasses(this.displayEnd,a.stylejam.common.widgets.datepicker.DateModal.inputDateStatic,a.stylejam.common.widgets.datepicker.DateModal.inputDateResponsive),a.dom.swapClasses(this.inputEndDec,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive),a.dom.swapClasses(this.inputEndInc,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerStatic,a.stylejam.common.widgets.datepicker.DateModal.inputDateSpinnerResponsive),
a.dom.swapClasses(this.displayStartIcon,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIconHidden,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIcon),a.dom.swapClasses(this.displayEndIcon,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIconHidden,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayIcon));a.dom.swapClasses(this.displayStartChevron,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayChevronHidden,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayChevron);
a.dom.swapClasses(this.displayEndChevron,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayChevronHidden,a.stylejam.common.widgets.datepicker.DateModal.inputDisplayChevron)},hotelDetailsStickyShow:function(){a.dom.swapClasses(this.inputStartDec,this.options.styles.dateSpinner,this.options.styles.dateSpinnerSticky);a.dom.swapClasses(this.inputStartInc,this.options.styles.dateSpinner,this.options.styles.dateSpinnerSticky);a.dom.swapClasses(this.inputEndInc,this.options.styles.dateSpinner,this.options.styles.dateSpinnerSticky);
a.dom.swapClasses(this.inputEndDec,this.options.styles.dateSpinner,this.options.styles.dateSpinnerSticky);a.dom.swapClasses(this.displayEndIcon,this.options.styles.iconWrapper,this.options.styles.iconWrapperSticky);a.dom.swapClasses(this.inputSeparator,this.options.styles.inputSeparator,this.options.styles.inputSeparatorSticky);a.dom.swapClasses(this.displayEnd,this.options.styles.displayEnd,this.options.styles.displayEndSticky)},hotelDetailsStickyHide:function(){a.dom.swapClasses(this.inputStartDec,
this.options.styles.dateSpinnerSticky,this.options.styles.dateSpinner);a.dom.swapClasses(this.inputStartInc,this.options.styles.dateSpinnerSticky,this.options.styles.dateSpinner);a.dom.swapClasses(this.inputEndInc,this.options.styles.dateSpinnerSticky,this.options.styles.dateSpinner);a.dom.swapClasses(this.inputEndDec,this.options.styles.dateSpinnerSticky,this.options.styles.dateSpinner);a.dom.swapClasses(this.displayEndIcon,this.options.styles.iconWrapperSticky,this.options.styles.iconWrapper);a.dom.swapClasses(this.inputSeparator,
this.options.styles.inputSeparatorSticky,this.options.styles.inputSeparator);a.dom.swapClasses(this.displayEnd,this.options.styles.displayEndSticky,this.options.styles.displayEnd)},getStartDate:function(){return this.startDate},setStartDate:function(a){this.startDateChanged|=this.open&&this.getStartDate()!==a;this.startDate=a;return!0},getEndDate:function(){return this.endDate},setEndDate:function(a){this.endDateChanged|=this.open&&this.getEndDate()!==a;this.endDate=a;return!0}})})(R9,jQuery);/*
 @r9/cmp2-ui - 1.8.2 generated: 2019-09-12T13:54:30.874Z */
(function(e){function b(h){if(a[h])return a[h].exports;var g=a[h]={i:h,l:!1,exports:{}};return e[h].call(g.exports,g,g.exports,b),g.l=!0,g.exports}var a={};b.m=e;b.c=a;b.d=function(a,g,l){b.o(a,g)||Object.defineProperty(a,g,{configurable:!1,enumerable:!0,get:l})};b.n=function(a){var g=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(g,"a",g),g};b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};b.p="";b(b.s=37)})([function(e,b,a){function h(c){var d="function"==
typeof Symbol&&c[Symbol.iterator],k=0;return d?d.call(c):{next:function(){return c&&k>=c.length&&(c=void 0),{value:c&&c[k++],done:!c}}}}function g(c,d){var k="function"==typeof Symbol&&c[Symbol.iterator];if(!k)return c;var n,a;c=k.call(c);var f=[];try{for(;(void 0===d||0<d--)&&!(n=c.next()).done;)f.push(n.value)}catch(q){a={error:q}}finally{try{n&&!n.done&&(k=c.return)&&k.call(c)}finally{if(a)throw a.error;}}return f}function l(c){return this instanceof l?(this.v=c,this):new l(c)}Object.defineProperty(b,
"__esModule",{value:!0});b.__extends=function(c,d){function k(){this.constructor=c}m(c,d);c.prototype=null===d?Object.create(d):(k.prototype=d.prototype,new k)};a.d(b,"__assign",function(){return f});b.__rest=function(c,d){var k={},n;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&0>d.indexOf(n)&&(k[n]=c[n]);if(null!=c&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(c);a<n.length;a++)0>d.indexOf(n[a])&&(k[n[a]]=c[n[a]])}return k};b.__decorate=function(c,
d,a,n){var k,f=arguments.length,m=3>f?d:null===n?n=Object.getOwnPropertyDescriptor(d,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(c,d,a,n);else for(var b=c.length-1;0<=b;b--)(k=c[b])&&(m=(3>f?k(m):3<f?k(d,a,m):k(d,a))||m);return 3<f&&m&&Object.defineProperty(d,a,m),m};b.__param=function(c,d){return function(a,n){d(a,n,c)}};b.__metadata=function(c,d){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(c,d)};b.__awaiter=
function(c,d,a,n){return new (a||(a=Promise))(function(k,f){function m(c){try{p(n.next(c))}catch(r){f(r)}}function b(c){try{p(n.throw(c))}catch(r){f(r)}}function p(c){c.done?k(c.value):(new a(function(d){d(c.value)})).then(m,b)}p((n=n.apply(c,d||[])).next())})};b.__generator=function(c,d){function a(c){return function(d){return n([c,d])}}function n(a){if(f)throw new TypeError("Generator is already executing.");for(;g;)try{if(f=1,m&&(b=m[2&a[0]?"return":a[0]?"throw":"next"])&&!(b=b.call(m,a[1])).done)return b;
switch(m=0,b&&(a=[0,b.value]),a[0]){case 0:case 1:b=a;break;case 4:return g.label++,{value:a[1],done:!1};case 5:g.label++;m=a[1];a=[0];continue;case 7:a=g.ops.pop();g.trys.pop();continue;default:if(b=g.trys,!(b=0<b.length&&b[b.length-1])&&(6===a[0]||2===a[0])){g=0;continue}if(3===a[0]&&(!b||a[1]>b[0]&&a[1]<b[3]))g.label=a[1];else if(6===a[0]&&g.label<b[1])g.label=b[1],b=a;else if(b&&g.label<b[2])g.label=b[2],g.ops.push(a);else{b[2]&&g.ops.pop();g.trys.pop();continue}}a=d.call(c,g)}catch(r){a=[6,r],
m=0}finally{f=b=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var f,m,b,l,g={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return l={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l};b.__exportStar=function(a,d){for(var c in a)d.hasOwnProperty(c)||(d[c]=a[c])};b.__values=h;b.__read=g;b.__spread=function(){for(var a=[],d=0;d<arguments.length;d++)a=a.concat(g(arguments[d]));return a};b.__await=l;b.__asyncGenerator=
function(a,d,k){function c(a){e[a]&&(h[a]=function(c){return new Promise(function(d,n){1<r.push([a,c,d,n])||f(a,c)})})}function f(a,c){try{var d=e[a](c);d.value instanceof l?Promise.resolve(d.value.v).then(m,b):g(r[0][2],d)}catch(z){g(r[0][3],z)}}function m(a){f("next",a)}function b(a){f("throw",a)}function g(a,c){a(c);r.shift();r.length&&f(r[0][0],r[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h,e=k.apply(a,d||[]),r=[];return h={},c("next"),c("throw"),
c("return"),h[Symbol.asyncIterator]=function(){return this},h};b.__asyncDelegator=function(a){function c(c,d){a[c]&&(f[c]=function(f){return(n=!n)?{value:l(a[c](f)),done:"return"===c}:d?d(f):f})}var f,n;return f={},c("next"),c("throw",function(a){throw a;}),c("return"),f[Symbol.iterator]=function(){return this},f};b.__asyncValues=function(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=a[Symbol.asyncIterator];return c?c.call(a):"function"==typeof h?h(a):
a[Symbol.iterator]()};b.__makeTemplateObject=function(a,d){return Object.defineProperty?Object.defineProperty(a,"raw",{value:d}):a.raw=d,a};b.__importStar=function(a){if(a&&a.__esModule)return a;var c={};if(null!=a)for(var f in a)Object.hasOwnProperty.call(a,f)&&(c[f]=a[f]);return c.default=a,c};b.__importDefault=function(a){return a&&a.__esModule?a:{default:a}};var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var c in d)d.hasOwnProperty(c)&&
(a[c]=d[c])},f=Object.assign||function(a){for(var c,f=1,n=arguments.length;f<n;f++){c=arguments[f];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(a[m]=c[m])}return a}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setLogger=function(a){this._method=a},a.prototype.getLogger=function(){return this._method||this._methodPlaceholder()},
a.prototype.debug=function(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];this.getLogger().debug.apply(this,a)},a.prototype.error=function(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];this.getLogger().error.apply(this,a)},a.prototype.info=function(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];this.getLogger().info.apply(this,a)},a.prototype.warn=function(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];this.getLogger().warn.apply(this,a)},a.prototype._methodPlaceholder=
function(){return{debug:g,error:g,info:g,warn:g}},a}(),g=function(){console.error("cmp2-ui: You should really consider adding logger")};b.getLogger=function(){return h.getInstance().getLogger()};b.setLogger=function(a){return h.getInstance().setLogger(a)}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(25);var g=a(7),l=a(6),m=a(3),f=a(5).default(),c=m.default();a=function(a){function d(d){var c=a.call(this)||this;return c.options=d,c}return h.__extends(d,a),d.prototype.onDirectClick=
function(a,d){a=c.forDirect(a);a=new l.default(this.options,a);(new g.default(a)).start(!1)},d.prototype.onDirectMouseUp=function(a,d){},d.prototype.onDirectMouseDown=function(a,d){},d.prototype.onItemChange=function(a,d,c){},d.prototype.onItemMouseDown=function(a,d){},d.prototype.onItemMouseUp=function(a,d){},d.prototype.onFormClick=function(a,d,c){c([],[])},d.prototype.onFormButtonMouseDown=function(a){},d.prototype.onFormButtonMouseUp=function(a){},d.prototype.navigateToResults=function(a,d,c){return!1},
d.prototype.showRPCompareAll=function(){return!0},d.prototype.pushHandleHistory=function(a,d){d&&f.addHistory(a,d)},d.prototype.getWindowNamePrefix=function(){return c.getWindowNamePrefix()},d.prototype.onResultPageOpen=function(a,d,f){void 0===f&&(f="");a=new l.default(this.options,c.forSubmit(a));a=new g.default(a);a.setWindowNamePrefix(f);a.start(!0)},d.prototype.setIgnoreWindowErrors=function(a){f.setIgnoreWindowErrors(a)},d}(e.Observer);b.Base=a;b.default=a},function(e,b,a){Object.defineProperty(b,
"__esModule",{value:!0});var h=a(21),g=a(22),l=a(11),m=a(33).default(),f=function(){function a(){this.windowNamePrefix="k"+(new Date).getTime()+l.default.randomString(8)}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getWindowNamePrefix=function(){return this.windowNamePrefix},a.prototype.hidden=function(a,c){return{url:this.getUrl(a),name:a.code,features:m.hidden(!1,c)}},a.prototype.hiddenSmall=function(a,c){return{url:this.getUrl(a),
name:a.code,features:m.hidden(!0,c)}},a.prototype.tiled=function(a,c,f,b){return{url:this.getUrl(a),name:a.code,features:m.tiled(c,f,b)}},a.prototype.empty=function(a){return{url:this.getUrl(a),name:a.code,features:{}}},a.prototype.forDirect=function(a){for(var d=[],c=m.getWindowHandleInformation(),f=0,b=0,g;g=a[b];b++)g.visible&&f++;for(b=0;g=a[b];b++)g.visible&&d.push(this.tiled(g,b,f,c));return d},a.prototype.forBlank=function(a){return[{url:a||this.getUrl(),name:"_blank",features:{}}]},a.prototype.forMultiProviderWindow=
function(a,c){void 0===a&&(a=[]);void 0===c&&(c={});var d,f=[];if(0<a.length){for(var m=0,b;b=a[m];m++)b.deepLink&&"CLOSE"!==b.deepLink&&(f.push(b.code),d=b.deepLink);if(0<f.length)return 1===f.length&&d?h.formatUrl(d):h.formatUrl("/s/compareresults/multi",g.extend({providerCodes:f.join(",")},c||{}))}return""},a.prototype.forSubmit=function(a,c){void 0===c&&(c=0);for(var d=[],f=m.getWindowHandleInformation(),b=0,k=0,g;g=a[k];k++)g.visible&&g.checked&&b++;for(k=0;g=a[k];k++)g.visible&&g.checked&&(4===
c&&d.push(this.empty(g)),0===c&&d.push(this.tiled(g,k,b,f)),2===c&&d.push(this.hidden(g,f)),3===c&&d.push(this.hiddenSmall(g,f)));return d},a.prototype.getSpinnerPath=function(){return h.formatUrl("/s/compareresults/spinner")},a.prototype.getUrl=function(a){return a?a.deepLink?h.formatUrl(a.deepLink):h.formatUrl("/s/compareresults/spinner",{code:a.code}):this.getSpinnerPath()},a}();b.WindowHandleOptions=f;b.default=function(){return f.getInstance()}},function(e,b,a){function h(a,c,d){return void 0===
d&&(d=!0),a===c?0:a?c?a.localeCompare(c):d?1:-1:d?-1:1}function g(a){switch(a){case "fd":case "pn":return"FD";case "bb":case "rr":case "sa":case "pu":case "md":return"RP"}}function l(a){switch(a){case "right":return"R";case "top":case "inline":case "panel":case "fdct":return"M";case "bottom":return"B";case "popup":return"P"}return""}Object.defineProperty(b,"__esModule",{value:!0});b.isLocationEqual=function(a,c){return a.type===c.type&&a.id===c.id&&a.name===c.name};b.sortLocations=function(a){return a&&
1<a.length&&a.sort(function(a,d){var c=h(a.type,d.type);return 0===c?(c=h(a.name,d.name),0===c?h(a.id,d.id):c):c}),a};b.setLogoSize=function(a,c){c&&c.width&&c.height&&(a.logoSize=c.width+"x"+c.height)};var m=/-/g;b.prepareDate=function(a){return a.replace(m,"")};b.getPageOrigin=function(a){var c=[];if(a.placement){var d=a.placement;c.push(d.vertical?d.vertical:a.type);c.push(d.type||"");c.push(g(d.showOn)||"");c.push(d.page||"");c.push(l(d.displayRail)+(d.position||0))}return c.join(".")};b.getPostHeader=
function(){return{"Content-Type":"application/json; charset\x3dUTF-8"}}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(26),g=a(1);e=a(32);b.isSystemTargetName=function(a){return void 0===a&&(a=""),-1!==["_blank","_parent","_self","_top"].indexOf(a)};b.getWindowName=function(a){return void 0===a&&(a=""),b.isSystemTargetName(a)?a:a.replace(/[^a-z0-9]+/gi,"")};"undefined"!=typeof window&&e.addEvent(window,"popstate",function(a){(a=a.originalEvent?a.originalEvent:a)&&a.state&&
a.state.hasOwnProperty("cmp2-workaround-back-Key")&&window.location.replace(a.state["cmp2-workaround-back-Key"])});var l=function(){function a(){this._ignoreWindowErrors=!1}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getIgnoreWindowErrors=function(){return this._ignoreWindowErrors},a.prototype.setIgnoreWindowErrors=function(a){this._ignoreWindowErrors=a},a.prototype.open=function(a,c,d){void 0===c&&(c="");void 0===d&&(d={});"object"==
typeof d&&(d=h.param(d,!0,","));return(a=open(a,b.getWindowName(c),d))&&!a.closed?a:null},a.prototype.getActiveWindowHandles=function(a){for(var c=[],d=0,f;f=a[d];d++)(f=this.getWindowHandle(f))&&c.push(f);return c},a.prototype.getFirstActiveHandle=function(a){for(var c=0,d;d=a[c];c++)if(this.getWindowHandle(d))return d;return null},a.prototype.getLastActiveHandle=function(a){for(var c=a.length-1,d;d=a[c];c--)if(this.getWindowHandle(d))return d;return null},a.prototype.getWindowHandle=function(a){try{return!a||
a.closed?null:a}catch(c){return null}},a.prototype.addHistory=function(a,c){if(a&&c&&void 0!==history.pushState&&void 0!==history.replaceState)try{var d=a.location.href;a.history.replaceState((f={},f["cmp2-workaround-back-Key"]=c,f),"",c);a.history.pushState((b={},b["cmp2-workaround-back-Key"]=d,b),a.document.title,d)}catch(p){g.getLogger().warn("cmp2-workaround: WindowHandle unable to add history",p)}var f,b},a.prototype.updateHandleName=function(a,c,d){void 0===d&&(d="");a=this.getWindowHandle(a);
if(!a)return g.getLogger().warn("cmp2-workaround: WindowHandle handle is not found",d),!1;try{if(a.name=c,a.name!==c)return g.getLogger().warn("cmp2-workaround: WindowHandle unable to change name",d),!1}catch(k){return g.getLogger().warn("cmp2-workaround: WindowHandle unable to change name",k,d),!1}return!0},a.prototype.resizeBeforeMove=function(a,c){var d=this.getWindowHandle(a);if(d)try{if(void 0!==c.left&&void 0!==c.top){d.resizeTo(100,100);var b=this.moveToLeftTop(a);d.moveTo(b[0]+c.left,b[1]+
c.top)}void 0!==c.width&&void 0!==c.height&&d.resizeTo(c.width,c.height)}catch(n){g.getLogger().warn("cmp2-workaround: WindowHandle unable resize handler in resizeBeforeMove",n,n.stack)}},a.prototype.moveAccordingFeatures=function(a,c){if((a=this.getWindowHandle(a))&&c)try{void 0!==c.left&&void 0!==c.top&&a.moveTo(c.left,c.top),void 0!==c.width&&void 0!==c.height&&a.resizeTo(c.width,c.height)}catch(d){g.getLogger().warn("cmp2-workaround: WindowHandle unable resize handler in moveAccordingFeatures",
d,d.stack)}},a.prototype.moveToLeftTop=function(a){if(a=this.getWindowHandle(a))try{return a.moveTo(-1E7,-1E7),["screenX"in a?a.screenX:a.screenLeft,"screenY"in a?a.screenY:a.screenTop]}catch(c){g.getLogger().warn("cmp2-workaround: WindowHandle unable to move handler in moveToLeftTop",c,c.stack)}return[0,0]},a}();b.WindowHandle=l;b.default=function(){return l.getInstance()}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=function(){return function(a,b){this.items=[];this.options=
a;this.items=b;this.resize=a.resizeWindows||!1}}();b.WindowHandleConstructor=e;b.default=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(25);var g=a(1),l=a(5);a=a(3);var m=l.default(),f=a.default();a=function(a){function c(c){var d=a.call(this)||this;return d.windowNamePrefix="",d.windowHandleInformation=c,d.items=c.items,c.resize&&d.resizeHandle(c),c.preOpen&&d.preOpen(c.preOpen),c.postOpen&&d.postOpen(c.postOpen),c.preItemOpen&&d.preItemOpen(c.preItemOpen),c.postItemOpen&&
d.postItemOpen(c.postItemOpen),d}return h.__extends(c,a),c.prototype.setWindowNamePrefix=function(a){void 0===a&&(a="");a&&(this.windowNamePrefix=a)},c.prototype.getWindowNamePrefix=function(){return this.windowNamePrefix||(this.windowNamePrefix=f.getWindowNamePrefix()),this.windowNamePrefix},c.prototype.start=function(a){var c=this.items;this.publish("preOpen",[c]);for(var d=this.getWindowNamePrefix(),b=[],f=[],k=0,h;h=c[k];k++){this.publish("preItemOpen",[h,c]);var e=l.isSystemTargetName(h.name)?
h.name:l.getWindowName(d+h.name),r=m.open(h.url,e,h.features),w=this.windowHandleInformation.options;if(w.expectWindowReference)if(r)b.push(e),f.push(r),this.publish("handleCreated",[h,c,r]);else if(!m.getIgnoreWindowErrors()){var y=a?"":" in the RP";g.getLogger().warn("cmp2-workaround: unable to open handle in StandardWindowHandleExecutor"+y,{workaround:w,name:e,item:h})}this.publish("postItemOpen",[h,c,r])}this.publish("postOpen",[f,b])},c.prototype.handleCreated=function(a){return this.subscribe("handleCreated",
a),this},c.prototype.preOpen=function(a){return this.subscribe("preOpen",a),this},c.prototype.postOpen=function(a){return this.subscribe("postOpen",a),this},c.prototype.preItemOpen=function(a){return this.subscribe("preItemOpen",a),this},c.prototype.postItemOpen=function(a){return this.subscribe("postItemOpen",a),this},c.prototype.getItems=function(){return this.items},c.prototype.resizeHandle=function(a){this.postItemOpen(function(c,d,b){(d=m.getWindowHandle(b))&&c.features&&(c=c.features,a.options.resizeBeforeOpening?
m.resizeBeforeMove(d,c):m.moveAccordingFeatures(d,c))})},c}(e.Observer);b.StandardWindowHandleExecutor=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=a(49);var h=a(2);b.Base=h.default;var g=e.default();b.setWorkaround=function(a){g.setWorkaround(a,!1)};b.getWorkaround=function(){return g.getWorkaround()};e=a(1);b.getLogger=e.getLogger;b.setLogger=e.setLogger;e=a(22);b.extend=e.extend;a=a(21);b.updateBasePath=a.updateBasePath},function(e,b,a){Object.defineProperty(b,
"__esModule",{value:!0});e=a(39);b.List=e.List;e=a(43);b.Impression=e.Impression;e=a(47);b.WindowInfo=e.WindowInfo;e=a(48);b.ApiCompareToSettings=e.CompareToSettings;a=a(4);b.getPageOrigin=a.getPageOrigin},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(9),g=a(12),l=a(8);e=function(){function a(){this._client="other";this._queue=[];this._isInProgress=!1}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setClient=function(a){this._client=
a},a.prototype.getClient=function(){return this._client},a.prototype.setSettings=function(a){this._settings=a;l.setWorkaround(a.workaround)},a.prototype.isSettings=function(){return!!this._settings},a.prototype.getSettings=function(a,c){var d=this;if(this._settings)return void a(this._settings);if(this._queue.push({onSuccess:a,onError:c}),!this._isInProgress){this._isInProgress=!0;a=h.ApiCompareToSettings.getInstance().getRequest();var b=function(){d._isInProgress=!1;d._queue.forEach(function(a){a.onError&&
a.onError(void 0)});d._queue=[]};g.Ajax.getInstance().request(a,function(a){if(!a||!a.success)return l.getLogger().error("cmp2-ui: AJAX error on getSettings",a.errors),void b();var c=a.content;d.setSettings(c);d._isInProgress=!1;d._queue.forEach(function(a){a.onSuccess(c)});d._queue=[]},function(a){l.getLogger().error("cmp2-ui: AJAX error on getSettings",a);b()},b)}},a.prototype.getSettingsSync=function(){return this.isSettings()?this._settings:void l.getLogger().error("cmp2-ui: getSettingsSync failed. Refactor")},
a}();b.CompareToSettings=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=function(){function a(){}return a.UUID=function(){var a=(new Date).getTime();return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(b){var m=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?m:3&m|8).toString(16)})},a.randomString=function(a){void 0===a&&(a=6);for(var b="",m=0;m<a;m++)b+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*Math.random()));
return b},a}();b.StringGenerators=e;b.default=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(8);e=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setMethod=function(a){this._method=a},a.prototype.request=function(a,b,f,c){return this._method?(this._method(a,b,f),!0):(h.getLogger().error("cmp2-ui: Ajax method is not set"),c&&c(),!1)},a}();b.Ajax=e},function(e,b,a){Object.defineProperty(b,
"__esModule",{value:!0});var h=a(10),g=a(35);e=function(){function a(){var a=g.StorageHelper.getInstance().getItem("cmp2.state");this._setCompareToState(a)}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.apiToDisplayCompareToItem=function(a,b,c){var d=this;h.CompareToSettings.getInstance().getSettings(function(c){var f=[],m=g.StorageHelper.getInstance().getItem("cmp2.check.all");c=c.rendering;var k=c.storeStateSession,l=c.limited,h=c.usePreCheckItems,
e=c.maxCheckedItems,x=0;a.forEach(function(a){var c=!1;(!l||x<e)&&(c=d._isItemChecked(a,k,h,m))&&x++;f.push({name:a.name,code:a.code,id:a.id,visible:a.visible,checked:c,prechecked:h&&a.prechecked,termId:a.termId,idInState:a.idInState,rank:a.rank,logo:a.logo,logoLarge:a.logoLarge})});b(f)},c)},a.prototype.updateDisplayItemsDeepLink=function(a,b){var c={};b.forEach(function(a){c[a.code]=a.url});for(b=0;b<a.length;b++){var d=a[b],f=c[d.code];"CLOSE"===f?d.visible=!1:d.deepLink=f}return a},a.prototype.getCompareToItemsFromImpressionState=
function(a,b){var c=[],d={};b.forEach(function(a){d[a.code]=a.url});for(b=0;b<a.length;b++){var f=a[b];f.visible&&f.checked&&c.push({checked:f.checked,code:f.code,id:f.id,prechecked:f.prechecked,idInState:!0,rank:f.rank,termId:f.termId,visible:f.visible,name:"",logo:"",logoLarge:"",deepLink:d[f.code]})}return c},a.prototype.getImpressionRequestState=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push({checked:d.checked,code:d.code,id:d.id,prechecked:d.prechecked,rank:d.rank,termId:d.termId,
visible:d.visible})}return b},a.prototype.getVisibleItem=function(a){var b=[];if(a&&"object"==typeof a&&a.constructor===Array&&0<a.length)for(var c=0;c<a.length;c++){var d=a[c];d.visible&&b.push(d)}return b},a.prototype.getVisibleItemCount=function(a){return this.getVisibleItem(a).length},a.prototype.isCheckedItem=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.visible&&c.checked)return!0}return!1},a.prototype.updateCheckedItemState=function(a,b){if(b.id&&b.idInState)this._compareTosStates[b.id]=
b.checked;else{var c=b.code;if(c){var d=this.getMediaAlphaProviderName(c);d&&(c=d);this._compareTosStates[c]=b.checked}}b=g.StorageHelper.getInstance();b.setItem("cmp2.state",this._compareTosStates);var f=0;a.forEach(function(a){a.visible&&a.checked&&f++});0===f?b.setItem("cmp2.check.all","false"):this.getVisibleItemCount(a)===f?b.setItem("cmp2.check.all","true"):b.removeItem("cmp2.check.all")},a.prototype.getMediaAlphaProviderName=function(a){return(a=/^([a-zA-Z]*-[0-9]*-[0-9]*)/.exec(a))?a[1]:null},
a.prototype._isItemChecked=function(a,b,c,d){if(!a.visible)return!1;if(b){if(null!==d)return!0===d;b=this._compareTosStates;if(a.idInState){if(a.id&&b.hasOwnProperty(a.id))return b[a.id]}else if(d=a.code){var f=this.getMediaAlphaProviderName(d);if(f&&(d=f),b.hasOwnProperty(d))return b[d]}}return a.prechecked&&c},a.prototype._setCompareToState=function(a){this._compareTosStates=a&&"object"==typeof a?a:{}},a}();b.CompareToList=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=
a(4);e=function(){function a(){}return a.prototype._populateBaseListRequest=function(a,b){a.placement&&h.setLogoSize(b.params,a.placement.logo)},a}();b.ListHelper=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.ignoreRequestInformation=function(a){var b=a.details;a=b[0].startLocation[0];b=b[1].startLocation[0];return"POINT"===a.type&&!a.cityId||"POINT"===b.type&&!b.cityId||!1}},function(e,b,a){function h(a){return 2<a.details.length||2===a.details.length&&(a.details[0].other.cabin!==
a.details[1].other.cabin||!g.isLocationEqual(a.details[0].startLocation[0],a.details[1].endLocation[0])||!g.isLocationEqual(a.details[0].endLocation[0],a.details[1].startLocation[0]))}Object.defineProperty(b,"__esModule",{value:!0});var g=a(4);b.ignoreRequestInformation=function(a){return h(a)};b.isMultiCity=h;b.getTravelersCount=function(a){if(!a.requestInformation)return 0;a=a.requestInformation.other;return a.adults+a.seniors+a.youths+a.children+a.seatInfants+a.lapInfants}},function(e,b,a){function h(a,
b){var f=null;switch(b.type){case "CITY":f={type:"CITY",id:b.id};break;case "AIRPORT":a.near=b.id;a.cityCode=b.cityId;break;case "HOTEL":f={type:"HOTEL",id:b.id};a.cityCode=b.cityId;break;case "LANDMARK":f={type:"LANDMARK",id:b.id};a.cityCode=b.cityId;break;case "NEIGHBORHOOD":f={type:"NEIGHBORHOOD",id:b.id};a.cityCode=b.cityId;break;case "REGION":f={type:"REGION",id:b.id};break;case "FREE_REGION":f={type:"FREE_REGION",id:b.id};break;case "COUNTRY":f={type:"COUNTRY",id:b.id};break;case "POINT":f=
{type:"POINT",id:b.latitude+","+b.longitude};break;case "ADDRESS":f={type:"ADDRESS",id:b.name},a.cityCode=b.cityId}return f||!1}function g(a,b){switch(b.type){case "CITY":a.cityCode=b.id;break;case "AIRPORT":a.near=b.id;a.cityCode=b.cityId;break;case "HOTEL":case "LANDMARK":case "NEIGHBORHOOD":case "ADDRESS":case "POINT":a.cityCode=b.cityId}}Object.defineProperty(b,"__esModule",{value:!0});b.ignoreRequestInformation=function(a,b){if(!a.requestInformation)return!0;var f=a.requestInformation.details[0].startLocation[0];
switch(f.type){case "REGION":case "FREE_REGION":case "COUNTRY":return!(10<=b)&&!f.cityId;case "ADDRESS":return!(10>b&&f.cityId||10<=b&&a.placement&&"right"===a.placement.displayRail||25<=b);case "POINT":return!(10>b&&f.cityId||25<=b);default:return!1}};b.addLocationInformationVersion=function(a,b,f){return 10>f?(g(a,b),!1):h(a,b)};b.addLocationInformation=h;b.addOldLocationInformation=g},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(4);e=function(){function a(){}return a.prototype._populateBaseImpressionRequest=
function(a,b){a.placement&&h.setLogoSize(b.data.searchContext,a.placement.logo)},a}();b.ImpressionHelper=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.isFunction=function(a){return"function"==typeof a&&"number"!=typeof a.nodeType}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.class2Type={}},function(e,b,a){function h(a){a=a.split("/");for(var c=a.length,b=[],f=0;f<c;f++){var g=a[f];0!==g.length&&b.push(g)}return b.join("/").replace(/^(https?:)([\/])*/g,
"$1//")}Object.defineProperty(b,"__esModule",{value:!0});var g=a(26);b.updateBasePath=function(a){return b.BASE_PATH=h(a),-1===b.BASE_PATH.indexOf("http")&&(b.BASE_PATH="/"+b.BASE_PATH),b.BASE_PATH};var l=/#.*$/,m=/\?/,f=/([?&])_=[^&]*/;b.formatUrl=function(a,d,k){void 0===d&&(d="");void 0===k&&(k=!0);a=(a=h(a))?a&&0===a.indexOf("http")?a:b.BASE_PATH.replace(/[\/]$/g,"")+"/"+a:b.BASE_PATH;if(d){var c=k;void 0===a&&(a="");void 0===d&&(d="");void 0===c&&(c=!0);k=a.replace(l,"");a=a.slice(k.length);
d&&(d="object"==typeof d?g.param(d):d,k+=(m.test(k)?"\x26":"?")+d);d=(!1===c&&(k=k.replace(f,"$1"),a=(m.test(k)?"\x26":"?")+"_\x3d"+(new Date).getTime()+a),k+a)}else d=a;return d};b.BASE_PATH=""},function(e,b,a){function h(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c,d,k,n,p,e=a.length,q=a[0]||{},u=1,v=!1;"boolean"==typeof q&&(v=q,q=a[u]||{},u++);"object"==typeof q||l.isFunction(q)||(q={});for(u===e&&(q=this,u--);u<e;u++)if(null!=(b=a[u]))for(c in b)b.hasOwnProperty(c)&&(d=q[c],
k=b[c],q!==k)&&(v&&k&&(g.isPlainObject(k)||(n=Array.isArray(k)))?(n?(n=!1,p=d&&Array.isArray(d)?d:[]):p=d&&g.isPlainObject(d)?d:{},q[c]=h(v,p,k)):void 0!==k&&(q[c]=k));return q}Object.defineProperty(b,"__esModule",{value:!0});var g=a(29),l=a(19);b.extend=h},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h,g=a(0),l=a(35),m=a(10);e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return g.__extends(b,a),b.getInstance=function(){return h||(h=new this),h},
b.prototype.prepareItemsToDisplay=function(a){var b=this,c=m.CompareToSettings.getInstance().getSettingsSync();if(!c)return[];var d=[],f=l.StorageHelper.getInstance().getItem("cmp2.check.all"),c=c.rendering,g=c.storeStateSession,h=c.limited,e=c.usePreCheckItems,x=c.maxCheckedItems,r=0;return a.forEach(function(a){var c=!1;(!h||r<x)&&(c=b._isItemChecked(a,g,e,f))&&r++;c={name:a.name,code:a.code,id:a.id,visible:a.visible,checked:c,prechecked:e&&a.prechecked,termId:a.termId,idInState:a.idInState,rank:a.rank,
logo:a.logo,logoLarge:a.logoLarge};"deepLink"in a&&(c.deepLink=a.deepLink);"clickToCall"in a&&(c.clickToCall=a.clickToCall);"svgLogo"in a&&(c.svgLogo=a.svgLogo);"phoneNumber"in a&&(c.phoneNumber=a.phoneNumber);"trackingUrl"in a&&(c.trackingUrl=a.trackingUrl);d.push(c)}),d},b.prototype.getCompareToItemsFromImpressionState=function(a){var b=[];return a.forEach(function(a){b.push({name:"",logo:"",logoLarge:"",code:a.code,id:a.id,visible:a.visible,checked:a.checked,prechecked:a.prechecked,idInState:!0,
termId:a.termId,rank:a.rank})}),b},b.prototype.mapDeepLinkToItems=function(a,b){var c=[];return this.getCompareToItemsFromImpressionState(a).forEach(function(a){a.visible&&a.checked&&b[a.code]&&b[a.code].deepLink&&(a.deepLink=b[a.code].deepLink,c.push(a))}),c},b}(a(13).CompareToList);b.ItemsList=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(9),g=a(10);b.isEnabled=function(a,b){return b&&b.enabled&&(!b.verticals||b.verticals[a])||!1};b.excludeRequest=function(a,b,f){if(!f)return!1;
var c=a.clientDisplayRails;a=a.displayRails;return c&&c[b]&&!1===c[b][f.displayRail]||a&&!1===a[f.displayRail]||!1};b.getMultiProviderWindowExtra=function(a,b,f){f={searchId:void 0!==f?f:a.searchId};var c=g.CompareToSettings.getInstance().getSettingsSync();if(!c||!(b="rp"===b?c.multiProviderWindowRP:c.multiProviderWindowFD))return f;c=a.placement;return c&&(b.pageOrigin&&(f.pageOrigin=h.getPageOrigin(a)),b.showOn&&(f.showOn=c.showOn),b.displayRail&&(f.displayRail=c.displayRail),b.vertical&&(f.vertical=
a.type),b.position&&(f.position=c.displayRail)),f};b.getApiVersion=function(a,b){a=a.type;var f=b.apiVersions;return f&&f[a]?f[a]:b.apiVersion}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=function(){function a(){this.events={}}return a.prototype.on=function(a,b){var g=this.events[a];return g||(this.events[a]=g=[]),g.push(b),this},a.prototype.off=function(a,b){var g=this.events[a];return g?(void 0===b?delete this.events[a]:this.events[a]=g.filter(function(a){if(a!==b)return a}),
this):this},a.prototype.subscribe=function(a,b){return this.on(a,b)},a.prototype.unSubscribe=function(a,b){return this.off(a,b)},a.prototype.publish=function(a,b){a=this.events[a];if(!a)return this;for(var g=0,f;f=a[g];g++)f.apply(this,b||[]);return this},a.prototype.notify=function(a,b){return this.publish(a,b)},a}();b.Observer=e},function(e,b,a){function h(a,b,f,p){var d;if(Array.isArray(b))g.each(b,function(b,d){f||c.test(a)?p(a,d):h(a+"["+("object"==typeof d&&null!=d?b:"")+"]",d,f,p)});else if(f||
"object"!==l.toType(b))p(a,b);else for(d in b)b.hasOwnProperty(d)&&h(a+"["+d+"]",b[d],f,p)}Object.defineProperty(b,"__esModule",{value:!0});var g=a(50),l=a(27),m=a(29),f=a(19),c=/\[\]$/;b.param=function(a,b,c){void 0===b&&(b=!1);void 0===c&&(c="\x26");var d,n=[],k=function(a,b){b=f.isFunction(b)?b():b;n[n.length]=encodeURIComponent(a)+"\x3d"+encodeURIComponent(null==b?"":b)};if(Array.isArray(a)||!m.isPlainObject(a))g.each(a,function(a,b){k(a,b)});else for(d in a)a.hasOwnProperty(d)&&h(d,a[d],b,k);
return n.join(c)}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(20),g=a(28);b.toType=function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h.class2Type[g.toString.call(a)]||"object":typeof a}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=a(20);b.toString=e.class2Type.toString},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(30),g=a(53),l=a(31),m=a(28);b.isPlainObject=function(a){var b,d;return!(!a||"[object Object]"!==
m.toString.call(a))&&(!(b=Object.getPrototypeOf(a))||"function"==typeof(d=l.hasOwn.call(b,"constructor")&&b.constructor)&&h.functionToString.call(d)===g.objectFunctionString)}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=a(31);b.functionToString=e.hasOwn.toString},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=a(20);b.hasOwn=e.class2Type.hasOwnProperty},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.addEvent=function(a,b,e){void 0===a._eventListeners&&
(a._eventListeners=[]);a.addEventListener(b,e,!1);var g=a._eventListeners;g.push({type:b,fn:e});a._eventListeners=g};b.removeEvent=function(a,b,e){if(void 0!==a._eventListeners){a.removeEventListener(b,e);for(var g,f=a._eventListeners,c=[],d=f.length,k=0;k<d;k++)g=f[k],g.type!==b&&g.fn!==e&&c.push(f[k]);a._eventListeners=f}}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(22),g=a(1),l={scrollbars:1,location:1,statusbar:1,menubar:0,resizable:1},m=function(){function a(){}
return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getWindowHandleInformation=function(a){try{a=a||window;var b=a.document,c=a.screen,f=b.documentElement,p=b.getElementsByTagName("body")[0];return{y:"screenY"in a?a.screenY:a.screenTop,x:"screenX"in a?a.screenX:a.screenLeft,width:a.innerWidth||f.clientWidth||p.clientWidth,height:a.innerHeight||f.clientHeight||p.clientHeight,screenWidth:c.availWidth,screenHeight:c.availHeight}}catch(t){g.getLogger().error("cmp2-workaround: WindowHandleFeatures unable to access window/handle information",
t)}try{return{y:0,x:0,width:window.screen.availWidth,height:window.screen.availHeight,screenWidth:window.screen.availWidth,screenHeight:window.screen.availHeight}}catch(t){g.getLogger().error("cmp2-workaround: WindowHandleFeatures unable to access window information",t)}return{y:0,x:0,width:800,height:600,screenWidth:800,screenHeight:600}},a.prototype.hidden=function(a,b){var c=Math.min(1024,b.height-20),d=Math.min(1280,b.width-20),f=b.y+10,g=b.x+10;return a&&(c=160,d=160,f=b.y+(b.height-110),g=b.x+
(b.width-185)),h.extend({},l,{top:f,left:g,height:c,width:d})},a.prototype.tiled=function(a,b,f){b=Math.floor(f.screenWidth/b-10);return h.extend({},l,{left:Math.floor((b+5)*a),top:-999999999,height:Math.abs(-1*f.screenHeight),width:Math.abs(b)})},a}();b.WindowHandleFeatures=m;b.default=function(){return m.getInstance()}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0),g=a(1),l=a(5);e=a(7);var m=l.default();e=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;return b.windowHandleNames=[],b.windowHandles=[],b}return h.__extends(b,a),b.prototype.start=function(a){var b=this,c=this.getItems();this.windowHandleNames=[];this.windowHandles=[];this.publish("preOpen",[c]);var d=this.windowHandleInformation.options,f=1;void 0!==d.delay&&(f=d.delay);for(var d=0,g=void 0;g=c[d];d++)this._open(g,a);setTimeout(function(){b.publish("postOpen",[b.windowHandles,b.windowHandleNames])},f)},b.prototype._open=function(a,b){var c=this,d=this.getItems(),f=this.getWindowNamePrefix(),
k=this.windowHandleInformation.options,e=0;void 0!==k.timer&&(e=k.timer);setTimeout(function(){c.publish("preItemOpen",[a,d]);var n=l.isSystemTargetName(a.name)?a.name:l.getWindowName(f+a.name),p=m.open(a.url,n,a.features);if(k.expectWindowReference)if(p)c.addHandleName(n),c.addHandle(p),c.publish("handleCreated",[a,d,p]);else{var e=b?"":" in the RP";g.getLogger().warn("cmp2-workaround: unable to open handle in TimeoutWindowHandleExecutor"+e,{workaround:k,name:n,item:a})}c.publish("postItemOpen",
[a,d,p])},e)},b.prototype.addHandleName=function(a){this.windowHandleNames.push(a)},b.prototype.addHandle=function(a){this.windowHandles.push(a)},b}(e.default);b.TimeoutWindowHandleExecutor=e;b.default=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(8);e=function(){function a(){this._available=!1;try{this.setStorage(window.localStorage)}catch(l){}}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setStorage=function(a){var b;
try{a&&(a.setItem("vendor-support-test","success?"),b=a.getItem("vendor-support-test"),a.removeItem("vendor-support-test"),this._storage=a),"success?"===b&&(this._available=!0)}catch(f){}},a.prototype.getItem=function(a){if(this._available&&this._storage){var b=this._storage.getItem(a);if(b)try{return JSON.parse(b)}catch(f){return h.getLogger().error("cmp2-ui: StorageHelper unable to parse value",{key:a,value:b,error:f}),b}}return null},a.prototype.setItem=function(a,b){if(this._available&&this._storage)try{null!==
b&&"object"==typeof b?this._storage.setItem(a,JSON.stringify(b)):this._storage.setItem(a,b)}catch(f){h.getLogger().error("cmp2-ui: StorageHelper unable to set item",{key:a,data:b})}},a.prototype.removeItem=function(a){try{this._available&&this._storage&&this._storage.removeItem(a)}catch(m){h.getLogger().error("cmp2-ui: StorageHelper unable to remove item",{key:a})}},a.prototype.clear=function(){if(this._available&&this._storage)try{this._storage.clear()}catch(l){h.getLogger().error("cmp2-ui: StorageHelper unable to clear")}},
a}();b.StorageHelper=e},function(e,b,a){function h(a,b,c){return{type:a.type,placement:c&&c.placement||a.placement,searchId:a.searchId||c&&c.searchId,url:c&&c.url||a.url,compareTos:k.ItemsList.getInstance().getCompareToItemsFromImpressionState(b||[]),registerImpression:!0,includeCloseDeepLinks:!1,deepLink:!0,list:!1}}Object.defineProperty(b,"__esModule",{value:!0});var g=a(13),l=a(10),m=a(8),f=a(24),c=a(9),d=a(12),k=a(23);b.onDirectMouseUp=function(a,b){if(!l.CompareToSettings.getInstance().isSettings())return void m.getLogger().error("cmp2-ui: settings are not set to execute direct mouse up");
m.getWorkaround().onDirectMouseUp(g.CompareToList.getInstance().getVisibleItem(a),f.getMultiProviderWindowExtra(b,"rp"))};b.onDirectMouseDown=function(a,b){if(!l.CompareToSettings.getInstance().isSettings())return void m.getLogger().error("cmp2-ui: settings are not set to execute direct mouse down");m.getWorkaround().onDirectMouseDown(g.CompareToList.getInstance().getVisibleItem(a),f.getMultiProviderWindowExtra(b,"rp"))};b.onDirectClick=function(a,b){if(!l.CompareToSettings.getInstance().isSettings())return void m.getLogger().error("cmp2-ui: settings are not set to execute direct click");
m.getWorkaround().onDirectClick(g.CompareToList.getInstance().getVisibleItem(a),f.getMultiProviderWindowExtra(b,"rp"))};b.logImpression=function(a,b,k,e){if(!a.placement)return k([]),void m.getLogger().error("cmp2-ui: placement information is missing in logImpression",a);var n=l.CompareToSettings.getInstance().getSettingsSync();if(!n)return void k([]);a=c.Impression.getInstance().getRequestConfig(a,a.searchId,b,f.getApiVersion(a,n));if(!a)return void k([]);d.Ajax.getInstance().request(a,function(a){if(!a||
!a.success)return m.getLogger().error("cmp2-ui: Received an unexpected response in logImpression",a.errors),void e();k(g.CompareToList.getInstance().updateDisplayItemsDeepLink(b,a.urls))},function(a){m.getLogger().error("cmp2-ui: AJAX error on log impression",a);e()},function(){e()})};b.onResultPageOpen=function(a,b){var n=l.CompareToSettings.getInstance();n.getSettings(function(k){if(f.isEnabled(a.type,k)&&!f.excludeRequest(k,n.getClient(),a.placement)){var e=c.WindowInfo.getInstance().getRetrieveConfig(a,
f.getApiVersion(a,k));e&&d.Ajax.getInstance().request(e,function(n){if(!n||!n.success)return void m.getLogger().error("cmp2-ui: errors in Storage",n.errors);if((n=n.content||[],"object"==typeof n)&&n.constructor===Array&&0<n.length){var e=n[n.length-1],p=m.getWorkaround();if(e){var h=g.CompareToList.getInstance().getCompareToItemsFromImpressionState(e.items||[],[]);(void 0===k.workaround.updateHistory||k.workaround.updateHistory)&&g.CompareToList.getInstance().isCheckedItem(h)&&p.pushHandleHistory(window,
e.other.referer||"")}for(var q=n.length,e=0,h=void 0;h=n[e];e++)if(h=function(n,e){var h={type:e.type,placement:e.placement,requestInformation:e.requestInformation},l=c.Impression.getInstance().getRequestConfig(h,b,e.items,f.getApiVersion(a,k));if(!l)return m.getLogger().error("cmp2-ui: Could not construct Impression Request Config"),{value:void 0};d.Ajax.getInstance().request(l,function(a){if(!a.success)return void m.getLogger().error("cmp2-ui: errors in impression",a.errors);p.setIgnoreWindowErrors(n+
1!==q);p.onResultPageOpen(g.CompareToList.getInstance().getCompareToItemsFromImpressionState(e.items||[],a.urls||[]),f.getMultiProviderWindowExtra(h,"fd",b),e.other.windowNamePrefix);p.setIgnoreWindowErrors(!1)},function(a){m.getLogger().error("cmp2-ui: Error while logging FD impression",a)})}(e,h),"object"==typeof h)return h.value}},function(a){m.getLogger().error("cmp2-ui: AJAX error on Retrieve WindowInfo",a)})}})};b.onResultPage=function(a,b){var n=l.CompareToSettings.getInstance(),g=n.getSettingsSync();
if(!g)return void m.getLogger().error("cmp2-ui: errors config is not defined can't make request on ResultPage");if(f.isEnabled(a.type,g)&&!f.excludeRequest(g,n.getClient(),a.placement)){var e=c.WindowInfo.getInstance().getRetrieveConfig(a,30);e&&d.Ajax.getInstance().request(e,function(n){if(!n||!n.success)return void m.getLogger().error("cmp2-ui: errors in Storage",n.errors,e);if((n=n.content||[],"object"==typeof n)&&n.constructor===Array&&0<n.length){var p=k.ItemsList.getInstance(),q=n[n.length-
1],l=m.getWorkaround();if(q){var t=p.getCompareToItemsFromImpressionState(q.items||[]);(void 0===g.workaround.updateHistory||g.workaround.updateHistory)&&p.isCheckedItem(t)&&l.pushHandleHistory(window,q.other.referer||"")}var u=n.length;n.forEach(function(n,g){var k=h(a,n.items,n),q=c.List.getInstance().getConfig(k);d.Ajax.getInstance().request(q,function(c){if(!c||!c.success)return void m.getLogger().error("cmp2-ui: ResultPage error",q,c);var d=p.mapDeepLinkToItems(n.items||[],c.content||{});a:if(c=
c.content||{},b)for(var e=0;e<d.length;e++){var h=d[e];if(h.visible&&h.checked&&(h=c[h.code])){b(h.name);break a}}l.setIgnoreWindowErrors(g+1!==u);l.onResultPageOpen(d,f.getMultiProviderWindowExtra(k,"fd",a.searchId||n.searchId),n.other.windowNamePrefix);l.setIgnoreWindowErrors(!1)},function(a){m.getLogger().error("cmp2-ui: AJAX error on onResultPage",a,e,q)})})}},function(a){m.getLogger().error("cmp2-ui: AJAX error on Retrieve WindowInfo V3",a,e)})}};b.registerImpression=function(a,b){var n=l.CompareToSettings.getInstance();
n.getSettings(function(g){if(f.isEnabled(a.type,g)&&!f.excludeRequest(g,n.getClient(),a.placement)){g=h(a,b);var e=c.List.getInstance().getConfig(g);d.Ajax.getInstance().request(e,function(a){a&&a.success||m.getLogger().error("cmp2-ui: Error on registerImpression",e,a)},function(a){m.getLogger().error("cmp2-ui: AJAX error on registerImpression",a,e)})}})}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=a(38);window["@r9/cmp2-ui"]||(window["@r9/cmp2-ui"]=e)},function(e,b,a){Object.defineProperty(b,
"__esModule",{value:!0});e=a(0);var h=a(9),g=a(8),l=a(12),m=a(10),f=a(13),c=a(23),d=a(24),k=a(36);b.logImpression=k.logImpression;e.__exportStar(a(8),b);e.__exportStar(a(9),b);e=a(66);b.onItemMouseUp=e.onItemMouseUp;b.onItemMouseDown=e.onItemMouseDown;b.onItemChange=e.onItemChange;b.onFormClick=e.onFormClick;b.onFormButtonMouseDown=e.onFormButtonMouseDown;b.onFormButtonMouseUp=e.onFormButtonMouseUp;a=a(36);b.onDirectMouseUp=a.onDirectMouseUp;b.onDirectMouseDown=a.onDirectMouseDown;b.onDirectClick=
a.onDirectClick;b.onResultPageOpen=a.onResultPageOpen;b.onResultPage=a.onResultPage;b.registerImpression=a.registerImpression;b.setModuleConfig=function(a){a.ajax&&l.Ajax.getInstance().setMethod(a.ajax);a.logger&&g.setLogger(a.logger);a.settings&&m.CompareToSettings.getInstance().setSettings(a.settings);a.client&&m.CompareToSettings.getInstance().setClient(a.client)};b.showRPCompareAll=function(a){if(!m.CompareToSettings.getInstance().isSettings())return g.getLogger().error("cmp2-ui: settings are not set to execute showRPCompareAll"),
!1;if(g.getWorkaround().showRPCompareAll()){a=f.CompareToList.getInstance().getVisibleItemCount(a);var b=m.CompareToSettings.getInstance().getSettingsSync();if(b&&a>=b.rendering.minItemsForCompareAll)return!0}return!1};b.getCompareToList=function(a,b,c){if(!a.placement)return b([],[]),void g.getLogger().error("cmp2-ui: placement information is missing",a);var n=m.CompareToSettings.getInstance();n.getSettings(function(e){if(!d.isEnabled(a.type,e)||d.excludeRequest(e,n.getClient(),a.placement))return void b([],
[]);var p=h.List.getInstance().getRequestConfig(a,d.getApiVersion(a,e));if(!p)return void b([],[]);l.Ajax.getInstance().request(p,function(d){if(!d||!d.success)return g.getLogger().error("cmp2-ui: Received an unexpected response",p,d),void c();a.searchId?f.CompareToList.getInstance().apiToDisplayCompareToItem(d.compareTos,function(d){var f=[];if(!d.length)return void b(d,f);d.forEach(function(a){f.push(g.extend({},a))});k.logImpression(a,d,function(a){b(a,f)},c)},c):f.CompareToList.getInstance().apiToDisplayCompareToItem(d.compareTos,
function(a){b(a)},c)},function(b){g.getLogger().error("cmp2-ui: AJAX error on getCompareToList",b,a);c()},c)},c)};b.getCompareTo=function(a,b,f){if(!a.placement)return b([]),void g.getLogger().error("cmp2-ui: placement information is missing",a);if(!a.url)return b([]),void g.getLogger().error("cmp2-ui: missing url",a);var e=m.CompareToSettings.getInstance();if(e.isSettings()){var k=e.getSettingsSync();if(!d.isEnabled(a.type,k)||d.excludeRequest(k,e.getClient(),a.placement))return void b([])}a.registerImpression=
!!a.registerImpression;a.deepLink=!!a.deepLink;a.convertUrl=!!a.convertUrl;a.list=!0;a.config=!e.isSettings();var n=h.List.getInstance().getConfig(a);l.Ajax.getInstance().request(n,function(k){if(!k||!k.success)return g.getLogger().error("cmp2-ui: Received an unexpected response",n,k,a),void f();if(k.config){e.setSettings(k.config);var h=e.getSettingsSync();if(!d.isEnabled(a.type,h)||d.excludeRequest(h,e.getClient(),a.placement))return void b([])}return e.isSettings()?k.content?void b(c.ItemsList.getInstance().prepareItemsToDisplay(k.content)):
void b([]):(g.getLogger().error("cmp2-ui: expected to have settings after getCompareTo request",n,k,a),void b([]))},function(a){g.getLogger().error("cmp2-ui: AJAX error on getCompareTo",a,n);f()},f)}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(40),g=a(41),l=a(42),m=a(4);e=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getRequestConfig=function(a,b){switch(void 0===b&&(b=2),a.type){case "F":return g.FlightListHelper.getInstance().getListRequest(a,
b);case "H":return l.HotelListHelper.getInstance().getListRequest(a,b);case "C":return h.CarListHelper.getInstance().getListRequest(a)}return!1},a.prototype.getConfig=function(a){return{method:"POST",headers:m.getPostHeader(),url:"/s/horizon/compareTo/list",data:a}},a}();b.List=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(14);var g=a(4),l=a(15);a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.getInstance=function(){return this._instance||
(this._instance=new this),this._instance},b.prototype.getListRequest=function(a){var b=a.requestInformation;if(!b||l.ignoreRequestInformation(b)||!a.placement)return!1;var c=b.details[0],f=c.startLocation[0],e=b.details[1],b=e.startLocation[0],c={method:"GET",url:"/a/api/compareto/V2/cars/list",params:{showOn:a.placement.showOn,pickupDate:g.prepareDate(c.startDate),dropoffDate:g.prepareDate(e.startDate),oneWay:!g.isLocationEqual(f,b)}},e=c.params;f.id&&(e.cityCode=f.id);f.cityId&&(e.cityCode=(e.cityCode?
e.cityCode+"/":"")+f.cityId);f=f.name;if(f&&(e.location=f),e.oneWay)b.id&&(e.dropoffCityCode=b.id),b.cityId&&(e.dropoffCityCode+="/"+b.cityId),(f=b.name)&&(e.dropoffLocation=f);return this._populateBaseListRequest(a,c),c},b}(e.ListHelper);b.CarListHelper=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0),g=a(16),l=a(4);e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.getInstance=function(){return this._instance||(this._instance=
new this),this._instance},b.prototype.getListRequest=function(a,b){var c=a.requestInformation;if(!c||g.ignoreRequestInformation(c)||!a.placement)return!1;var d=c.details,f=d[0];l.sortLocations(f.startLocation);l.sortLocations(f.endLocation);c={method:"GET",url:"/a/api/compareto/V2/flights/list",params:{showOn:a.placement.showOn,departureDate:l.prepareDate(f.startDate),origin:f.startLocation[0].id||"",destination:f.endLocation[0].id||"",cabin:f.other.cabin,student:c.other.student,oneWay:1===d.length}};
f=c.params;return(3<=b&&10>b||11<=b)&&(f.travelers=g.getTravelersCount(a)),2===d.length&&(f.returnDate=l.prepareDate(d[1].startDate)),this._populateBaseListRequest(a,c),c},b}(a(14).ListHelper);b.FlightListHelper=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0),g=a(17),l=a(4);e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.getInstance=function(){return this._instance||(this._instance=new this),this._instance},b.prototype.getListRequest=
function(a,b){var c=a.requestInformation;if(!c||g.ignoreRequestInformation(a,b)||!a.placement)return!1;var d=c.details[0],f={method:"GET",url:"/a/api/compareto/V2/hotels/list",params:{showOn:a.placement.showOn,checkinDate:l.prepareDate(d.startDate),checkoutDate:l.prepareDate(d.endDate)}},e=f.params;if(3<=b&&10>b||11<=b)c=c.other,e.travelers=c.adults+c.children,e.rooms=c.rooms;d=d.startLocation[0];(b=g.addLocationInformationVersion(e,d,b))&&(b.id&&(e.destinationId=b.id),b.type&&(e.destinationType=
b.type));b=d.name;return b&&(e.location=b),this._populateBaseListRequest(a,f),f},b}(a(14).ListHelper);b.HotelListHelper=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(44),g=a(45),l=a(46);e=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getRequestConfig=function(a,b,d,e){switch(void 0===e&&(e=2),a.type){case "F":return h.FlightImpressionHelper.getInstance().getImpressionRequest(a,b,d);
case "H":return g.HotelImpressionHelper.getInstance().getImpressionRequest(a,b,d,e);case "C":return l.CarImpressionHelper.getInstance().getImpressionRequest(a,b,d)}return!1},a}();b.Impression=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(18);var g=a(4),l=a(16);a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.getInstance=function(){return this._instance||(this._instance=new this),this._instance},b.prototype.getImpressionRequest=
function(a,b,f){var c=a.requestInformation;if(!c||l.ignoreRequestInformation(c)||!a.placement)return!1;var d=c.details[0];g.sortLocations(d.startLocation);g.sortLocations(d.endLocation);b={method:"POST",url:"/a/api/compareto/V2/flights/impression",headers:g.getPostHeader(),data:{compareToStates:f,searchContext:{showOn:a.placement.showOn,departureDate:g.prepareDate(d.startDate),origin:d.startLocation[0].id||"",destination:d.endLocation[0].id||"",cabin:d.other.cabin,student:c.other.student,oneWay:1===
c.details.length,numberOfTravelers:l.getTravelersCount(a)},searchId:b,pageOrigin:g.getPageOrigin(a),displayRail:a.placement.displayRail}};return 2===c.details.length&&(b.data.searchContext.returnDate=g.prepareDate(c.details[1].startDate)),this._populateBaseImpressionRequest(a,b),b},b}(e.ImpressionHelper);b.FlightImpressionHelper=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(18);var g=a(4),l=a(17);a=function(a){function b(){return null!==a&&a.apply(this,arguments)||
this}return h.__extends(b,a),b.getInstance=function(){return this._instance||(this._instance=new this),this._instance},b.prototype.getImpressionRequest=function(a,b,f,e){var c=a.requestInformation;if(!c||l.ignoreRequestInformation(a,e)||!a.placement)return!1;var d=c.details[0],k=d.startLocation[0];b={method:"POST",url:"/a/api/compareto/V2/hotels/impression",headers:g.getPostHeader(),data:{compareToStates:f,searchContext:{showOn:a.placement.showOn,checkinDate:g.prepareDate(d.startDate),checkoutDate:g.prepareDate(d.endDate),
rooms:c.other.rooms,guests:c.other.adults+c.other.children},searchId:b,pageOrigin:g.getPageOrigin(a),displayRail:a.placement.displayRail}};f=b.data.searchContext;(e=l.addLocationInformationVersion(f,k,e))&&(f.destination=e);k=k.name;return k&&(f.location=k),this._populateBaseImpressionRequest(a,b),b},b}(e.ImpressionHelper);b.HotelImpressionHelper=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(18);var g=a(4),l=a(15);a=function(a){function b(){return null!==a&&a.apply(this,
arguments)||this}return h.__extends(b,a),b.getInstance=function(){return this._instance||(this._instance=new this),this._instance},b.prototype.getImpressionRequest=function(a,b,f){var c=a.requestInformation;if(!c||l.ignoreRequestInformation(c)||!a.placement)return!1;var d=c.details[0],e=d.startLocation[0],h=c.details[1],c=h.startLocation[0];b={method:"POST",url:"/a/api/compareto/V2/cars/impression",headers:g.getPostHeader(),data:{compareToStates:f,searchContext:{showOn:a.placement.showOn,pickupDate:g.prepareDate(d.startDate),
dropoffDate:g.prepareDate(h.startDate),oneWay:!g.isLocationEqual(e,c)},searchId:b,pageOrigin:g.getPageOrigin(a),displayRail:a.placement.displayRail}};f=b.data.searchContext;(d=d.other.hour)&&(f.pickupHour=d);(d=h.other.hour)&&(f.dropoffHour=d);(d=e.id)&&(f.cityCode=d);e.cityId&&(f.cityCode=(f.cityCode?f.cityCode+"/":"")+e.cityId);e=e.name;if(e&&(f.location=e),f.oneWay)(e=c.id)&&(f.dropoffCityCode=e),c.cityId&&(f.dropoffCityCode+="/"+c.cityId),(c=c.name)&&(f.dropoffLocation=c);return this._populateBaseImpressionRequest(a,
b),b},b}(e.ImpressionHelper);b.CarImpressionHelper=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(15),g=a(17),l=a(16),m=a(4);e=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getStoreConfig=function(a,b,f,e,g){if(void 0===f&&(f={}),void 0===e&&(e=2),void 0===g&&(g=!0),30===e)return this._getStoreConfig(a,b,f);if(this._ignoreRequest(a,e))return!1;if(g&&a.requestInformation)for(e=a.requestInformation.details,
g=0;g<e.length;g++)this._removeLocationNames(e[g]);return this._getStoreConfig(a,b,f)},a.prototype.getRetrieveConfig=function(a,b){return(void 0===b&&(b=2),30===b)?this._getRetrieveConfig(a):!this._ignoreRequest(a,b)&&this._getRetrieveConfig(a)},a.prototype._ignoreRequest=function(a,b){var c=a.requestInformation;if(!c)return!0;switch(a.type){case "F":return l.ignoreRequestInformation(c);case "H":return g.ignoreRequestInformation(a,b);case "C":return h.ignoreRequestInformation(c)}return!0},a.prototype._removeLocationNames=
function(a){for(var b=a.startLocation,c=0;c<b.length;c++)b[c].name&&delete b[c].name;if(a=a.endLocation)for(c=0;c<a.length;c++)a[c].name&&delete a[c].name},a.prototype._getStoreConfig=function(a,b,f){return{method:"POST",url:"/s/horizon/compareTo/WindowInformation/add",headers:m.getPostHeader(),data:{type:a.type,placement:a.placement,requestInformation:a.requestInformation,convertUrl:!!a.convertUrl,url:a.url?a.url:"",items:b,other:f}}},a.prototype._getRetrieveConfig=function(a){return{method:"POST",
url:"/s/horizon/compareTo/WindowInformation/list",headers:m.getPostHeader(),data:a}},a}();b.WindowInfo=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getRequest=function(){return{method:"GET",url:"/s/horizon/compareTo/config"}},a}();b.CompareToSettings=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(2),g=a(54),l=a(55),
m=a(56),f=a(57),c=a(59),d=a(60),k=a(1),n=a(61),p=a(62),t=a(63),q=a(64),u=a(65),v=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setWorkaround=function(a,b){switch(b?a.fallbackName:a.name){case "AsyncOpen":this.workaround=new g.default(a);break;case "AsyncOpenMobile":this.workaround=new l.default(a);break;case "ChangeWindowNameLast":this.workaround=new m.default(a);break;case "ChangeWindowNameSequence":this.workaround=
new f.default(a);break;case "DocumentFocus":this.workaround=new c.default(a);break;case "HandleOpen":this.workaround=new d.default(a);break;case "RegularOpenCloseLast":this.workaround=new n.default(a);break;case "Swapper":this.workaround=new p.default(a);break;case "SwapperMultipleWindows":this.workaround=new t.default(a);break;case "SwapperMultipleWindowsNoSpinner":this.workaround=new u.default(a);break;case "SwapperNoSpinner":this.workaround=new q.default(a);break;default:if(!b&&a.fallbackName)return k.getLogger().warn("cmp2-workaround: unable to find workaround. Trying to fallback",
a),void this.setWorkaround(a,!0);k.getLogger().error("cmp2-workaround: unable to find workaround",a.name);this.workaround=new h.default(a)}},a.prototype.getWorkaround=function(){return this.workaround||(k.getLogger().error("cmp2-workaround: workaround is not set"),this.workaround=new h.default({name:""})),this.workaround},a}();b.Workaround=v;b.default=function(){return v.getInstance()}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(51);b.each=function(a,b){if(h.isArrayLike(a))for(var e=
a.length,f=0;f<e&&!1!==b.call(a[f],f,a[f]);f++);else for(f in a)if(a.hasOwnProperty(f)&&!1===b.call(a[f],f,a[f]))break;return a}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(19),g=a(27),l=a(52);b.isArrayLike=function(a){var b=!!a&&"length"in a&&a.length,c=g.toType(a);return!h.isFunction(a)&&!l.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&0<b&&b-1 in a)}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.isWindow=function(a){return null!=a&&a===
a.window}},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=a(30);b.objectFunctionString=e.functionToString.call(Object)},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(6),l=a(3),m=a(8),f=a(34),c=l.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.onDirectClick=function(a,b){a=c.forDirect(a);a=new g.default(this.options,a);(new f.default(a)).start(!1)},b.prototype.onFormClick=
function(a,b,d){var e=this;a=c.forSubmit(b);b={url:"",name:"_self",features:{}};delete b.features;a.push(b);a=new g.default(this.options,a);a.postItemOpen=function(a,b,c){a.features||(c&&!c.closed?c.focus():m.getLogger().warn("cmp2-workaround: AsyncOpen unable to focus",{workaround:e.options}))};a.postOpen=function(a,b){d(a,b)};(new f.default(a)).start(!0)},b}(e.default);b.AsyncOpen=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(6),l=a(3),
m=a(8),f=a(34),c=a(5),d=a(11),k=c.default(),n=l.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.onDirectClick=function(a,b){a=n.forDirect(a);a=new g.default(this.options,a);(new f.default(a)).start(!1)},b.prototype.navigateToResults=function(a,b,c){return!(!c||0===c.length)||(m.getLogger().warn("cmp2-workaround: AsyncOpenMobile navigateToResults using fallback. There is no window handles available.",{workaround:this.options}),
!1)},b.prototype.onFormClick=function(a,b,e){var h=this,l=n.forSubmit(b,4),q=l.shift();q?(b=this.getWindowNamePrefix(),k.updateHandleName(window,c.getWindowName(b+q.name),1),l.push({url:a,name:"k"+d.default.randomString(8),features:{}}),l=new g.default(this.options,l),l.postOpen=function(b,c){var f=k.getActiveWindowHandles(b),g=k.getLastActiveHandle(f);f.length!==b.length&&m.getLogger().warn("cmp2-workaround: AsyncOpenMobile some windows are closed",{workaround:h.options,activeWindowHandlesLength:f.length,
windowHandlesLength:b.length});g&&(k.updateHandleName(g,"k"+d.default.randomString(8),2),g.location.href=a);e(b,c)},l=new f.default(l),l.setWindowNamePrefix(b),l.start(!0)):(m.getLogger().error('cmp2-workaround: AsyncOpenMobile "firstItem" is undefined',{workaround:this.options}),e([],[]))},b}(e.default);b.AsyncOpenMobile=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(7),l=a(6),m=a(5);a=a(3);var f=m.default(),c=a.default();a=function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.onResultPageOpen=function(a,b,d){void 0===b&&(b={});void 0===d&&(d="");b=this.options;a=new l.default(b,c.forSubmit(a));b.resultPageFocus&&(a.postOpen=function(){f.open("",name)});a=new g.default(a);a.setWindowNamePrefix(d);a.start(!0)},b.prototype.onFormClick=function(a,b,d){a=c.forSubmit(b);var e=this.getWindowNamePrefix();f.updateHandleName(window,e,1);a=new l.default(this.options,a);a.postOpen=function(a,b){f.open("",e);d(a,
b)};(new g.default(a)).start(!0)},b}(e.default);b.ChangeWindowNameLast=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0),g=a(58);e=a(2);var l=a(1),m=a(7),f=a(11),c=a(6),d=a(5),k=a(33),n=a(3),p=a(21),t=d.default(),q=k.default(),u=n.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.onDirectClick=function(a,b){var d=this;void 0===b&&(b={});var e=q.getWindowHandleInformation(),g=f.default.UUID(),
e=[{url:u.getSpinnerPath(),name:"provider",features:q.hidden(!1,e)}],e=new c.default(this.options,e);e.postOpen=function(){d.onResultPageOpen(a,b,g)};e=new m.default(e);e.setWindowNamePrefix(g);e.start(!1)},b.prototype.onResultPageOpen=function(a,b,c){void 0===b&&(b={});void 0===c&&(c="");var d=u.forMultiProviderWindow(a,b);if(d){var e=f.default.UUID();t.updateHandleName(window,e,1);c+="provider";var g=t.open(u.getSpinnerPath(),c),h=this.options;if(!h.expectWindowReference)return void l.getLogger().warn("cmp2-workaround: ChangeWindowNameSequence not expecting window reference. Refactor",
{workaround:h,windowName:c,items:a,extra:b});if(!g)return void(t.getIgnoreWindowErrors()||l.getLogger().error("cmp2-workaround: ChangeWindowNameSequence unable to open window",{workaround:h,windowName:c,items:a,extra:b}));t.open("",e);this.createSequence(g,a,d,function(a,b){a=t.getWindowHandle(a);return!!a&&(a.location.href=b,!0)})}},b.prototype.createSequence=function(a,b,c,d){var f=this;if(1===b.length)return void d.apply(f,[a,c,-1,-1]);var e=new g.TimedQueue(this.options.delay);e.setOnError(function(){l.getLogger().error("cmp2-workaround: ChangeWindowNameSequence unable finish sequence",
{workaround:f.options,items:b,index:e.getIndex(),total:e.getTotal()})});for(var h=0,k=void 0;k=b[h];h++)e.add(d,f,[a,p.formatUrl(k.deepLink||"")]);e.add(d,f,[a,u.getSpinnerPath()]);e.add(function(a){if(a=t.getWindowHandle(a)){try{var c=q.getWindowHandleInformation(window);t.moveAccordingFeatures(a,q.tiled(0,1,c))}catch(A){l.getLogger().error("cmp2-workaround: ChangeWindowNameSequence unable to change position",{workaround:f.options,items:b,index:e.getIndex(),total:e.getTotal()},A)}return!0}return!1},
f,[a]);e.add(d,f,[a,c,-1]);e.run()},b.prototype.onFormClick=function(a,b,d){a=q.getWindowHandleInformation();a=[{url:u.getSpinnerPath(),name:"provider",features:q.hidden(!1,a)}];var e=f.default.UUID();t.updateHandleName(window,e,1);a=new c.default(this.options,a);a.postOpen=function(a,b){t.open("",e);d(a,b)};(new m.default(a)).start(!0)},b}(e.default);b.ChangeWindowNameSequence=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});e=function(){function a(a){void 0===a&&(a=
3E3);this._index=0;this._defaultDelay=a;this._queue=[]}return a.prototype.add=function(a,b,e,f){void 0===b&&(b=this);void 0===e&&(e=[]);void 0===f&&(f=this._defaultDelay);this._queue.push({fn:a,caller:b,delay:f,args:e})},a.prototype.run=function(a){void 0===a&&(a=0);this._index=a;this.next()},a.prototype.next=function(){var a=this,b=this._index++,e=this._queue[b],b=this._queue[this.getIndex()];if(e){var e=e.fn.apply(e.caller,e.args),f="boolean"!=typeof e||e;!1===e&&this.onError&&this.onError();b&&
f&&setTimeout(function(){a.next()},b.delay)}},a.prototype.setOnError=function(a){this.onError=a},a.prototype.reset=function(){this._index=0},a.prototype.getDefaultDelay=function(){return this._defaultDelay},a.prototype.getIndex=function(){return this._index},a.prototype.getTotal=function(){return this._queue.length},a.prototype.cleanUp=function(){this._index=0;this._queue=[]},a}();b.TimedQueue=e},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0),g=a(32);e=a(2);var l=a(1),
m=a(7),f=a(6),c=a(5),d=a(3).default(),k=c.default();a=function(a){function b(b){var c=a.call(this,b)||this;return c.submitEvent=!1,c.opened={},g.addEvent(window,"unload",function(){c.closeAllOpened()}),c}return h.__extends(b,a),b.prototype.showRPCompareAll=function(){return!1},b.prototype.onItemChange=function(a,b,c){var d=this;c.checked?this._openAndFocus([c],function(a){(a=k.getWindowHandle(a[0]))&&(d.opened[c.code]=a);d.submitEvent=!1}):this.close(c.code,this.opened[c.code]?this.opened[c.code]:
null)},b.prototype.onFormClick=function(a,b,c){this._openAndFocus(b,c)},b.prototype._openAndFocus=function(a,b){var c=this,e=d.forSubmit(a,3),e=new f.default(this.options,e);e.postItemOpen=function(a,b,d){return c._windowFocus(d)};e.postOpen=function(d,e){c.submitEvent=!0;c.closeNotActive(a);b(d,e)};(new m.default(e)).start(!0)},b.prototype.closeAllOpened=function(){if(!this.submitEvent){var a=this.opened,b;for(b in a)a.hasOwnProperty(b)&&this.close(b,a[b])}},b.prototype.closeNotActive=function(a){for(var b=
0,c;c=a[b];b++)!c.checked&&this.opened[c.code]&&this.close(c.code,this.opened[c.code])},b.prototype.close=function(a,b){if(b){b=k.getWindowHandle(b);try{b?(b.close(),delete this.opened[a]):l.getLogger().warn("cmp2-workaround: unable to close handle handle is not exists",{workaround:this.options})}catch(u){l.getLogger().warn("cmp2-workaround: error in closing handle",{workaround:this.options})}}},b.prototype._windowFocus=function(a){var b=this;this.focusInterval&&clearInterval(this.focusInterval);
var c=0,d=setInterval(function(){try{var e=k.getWindowHandle(a);e&&(e.blur(),e.opener.focus());window.self.focus();window.focus();document.focus()}catch(r){l.getLogger().warn("cmp2-workaround: DocumentFocus - windowFocus",{workaround:b.options},r)}10<++c&&d&&clearInterval(d)},300);this.focusInterval=d},b}(e.default);b.DocumentFocus=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(1),l=a(7),m=a(6),f=a(3).default();a=function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.onFormClick=function(a,b,c){var d=this;a=f.forSubmit(b);a=new m.default(this.options,a);a.postItemOpen=function(a,b,c){c&&!c.closed&&((a=c.open(f.getSpinnerPath()))?a.close():g.getLogger().warn("cmp2-workaround: HandleOpen unable to focus",{workaround:d.options}))};a.postOpen=function(a,b){return c(a,b)};(new l.default(a)).start(!0)},b}(e.default);b.HandleOpen=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});
var h=a(0);e=a(2);var g=a(1),l=a(7),m=a(6),f=a(5);a=a(3);var c=f.default(),d=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.onFormClick=function(a,b,e){var f=this;a=d.forSubmit(b);a=new m.default(this.options,a);a.postOpen=function(a,b){var h=c.open(d.getSpinnerPath()),k=f.options;k.expectWindowReference?h?h.close():g.getLogger().warn("cmp2-workaround: RegularOpenCloseLast unable to focus",{workaround:k}):g.getLogger().warn("cmp2-workaround: RegularOpenCloseLast not expecting window reference. Refactor",
{workaround:k});e(a,b)};(new l.default(a)).start(!0)},b}(e.default);b.RegularOpenCloseLast=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(1),l=a(7),m=a(6),f=a(5);a=a(3);var c=f.default(),d=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.onDirectClick=function(a,b){void 0===b&&(b={});a=[{url:d.forMultiProviderWindow(a,b),name:"_blank",features:{}}];a=new m.default(this.options,
a);(new l.default(a)).start(!1)},b.prototype.onResultPageOpen=function(a,b,e){void 0===b&&(b={});void 0===e&&(e="");if(b=d.forMultiProviderWindow(a,b)){var f=c.open(b,e),h=this.options;!h.expectWindowReference||c.getIgnoreWindowErrors()||f||g.getLogger().info("cmp2-workaround: Swapper unable to open window",{workaround:h,items:a,url:b,windowNamePrefix:e})}},b.prototype.navigateToResults=function(a,b,e){return(e=c.getFirstActiveHandle(e))?(e.location.href=a,this.options.method||(window.location.href=
d.getSpinnerPath()),!0):(g.getLogger().error("cmp2-workaround: Swapper unable to navigate to RP",{workaround:this.options,items:b,url:a}),!1)},b.prototype.onFormClick=function(a,b,e){a=d.forBlank();c.updateHandleName(window,this.getWindowNamePrefix(),1);a=new m.default(this.options,a);a.postOpen=function(a,b){return e(a,b)};(new l.default(a)).start(!0)},b}(e.default);b.Swapper=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(1),l=a(7),m=a(11),
f=a(6),c=a(5);a=a(3);var d=c.default(),k=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.navigateToResults=function(a,b,c){b=d.getActiveWindowHandles(c);var e=d.getLastActiveHandle(b);return e?(b.length!==c.length&&g.getLogger().warn("cmp2-workaround: SwapperMultipleWindows some windows are closed",{workaround:this.options,activeWindowHandlesLength:b.length,windowHandlesLength:c.length}),d.updateHandleName(e,"k"+m.default.randomString(8),
2),e.location.href=a,this.options.method||(window.location.href=k.getSpinnerPath()),!0):(g.getLogger().error("cmp2-workaround: SwapperMultipleWindows unable to found active window",{workaround:this.options}),!1)},b.prototype.onFormClick=function(a,b,e){b=k.forSubmit(b,4);var h=b.shift();if(!h)return g.getLogger().error('cmp2-workaround: SwapperMultipleWindows "firstItem" is undefined',{workaround:this.options}),void e([],[]);a=this.getWindowNamePrefix();d.updateHandleName(window,c.getWindowName(a+
h.name),1);b.push({url:k.getSpinnerPath(),name:"k"+m.default.randomString(8),features:{}});b=new f.default(this.options,b);b.postOpen=function(a,b){e(a,b)};b=new l.default(b);b.setWindowNamePrefix(a);b.start(!0)},b}(e.default);b.SwapperMultipleWindows=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(1),l=a(7),m=a(6),f=a(5);a=a(3);var c=f.default(),d=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,
a),b.prototype.onDirectClick=function(a,b){void 0===b&&(b={});a=[{url:d.forMultiProviderWindow(a,b),name:"_blank",features:{}}];a=new m.default(this.options,a);(new l.default(a)).start(!1)},b.prototype.onResultPageOpen=function(a,b,e){void 0===b&&(b={});void 0===e&&(e="");if(b=d.forMultiProviderWindow(a,b)){var f=c.open(b,e),h=this.options;!h.expectWindowReference||c.getIgnoreWindowErrors()||f||g.getLogger().error("cmp2-workaround: SwapperNoSpinner unable to open window",{workaround:h,items:a,url:b,
windowNamePrefix:e})}},b.prototype.navigateToResults=function(a,b,c){return!(!c||0===c.length)||(g.getLogger().warn("cmp2-workaround: SwapperNoSpinner navigateToResults using fallback. There is no window handles available.",{workaround:this.options}),!1)},b.prototype.onFormClick=function(a,b,e){a=d.forBlank(a);c.updateHandleName(window,this.getWindowNamePrefix(),1);a=new m.default(this.options,a);a.postOpen=function(a,b){return e(a,b)};(new l.default(a)).start(!0)},b}(e.default);b.SwapperNoSpinner=
a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(0);e=a(2);var g=a(1),l=a(7),m=a(11),f=a(6),c=a(5);a=a(3);var d=c.default(),k=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return h.__extends(b,a),b.prototype.navigateToResults=function(a,b,c){return!(!c||0===c.length)||(g.getLogger().warn("cmp2-workaround: SwapperMultipleWindowsNoSpinner navigateToResults using fallback. There is no window handles available.",{workaround:this.options}),
!1)},b.prototype.onFormClick=function(a,b,e){var h=this,n=k.forSubmit(b,4),q=n.shift();if(!q)return g.getLogger().error('cmp2-workaround: SwapperMultipleWindowsNoSpinner "firstItem" is undefined',{workaround:this.options}),void e([],[]);b=this.getWindowNamePrefix();d.updateHandleName(window,c.getWindowName(b+q.name),1);n.push({url:a,name:"k"+m.default.randomString(8),features:{}});n=new f.default(this.options,n);n.postOpen=function(b,c){var f=d.getActiveWindowHandles(b),k=d.getLastActiveHandle(f);
f.length!==b.length&&g.getLogger().warn("cmp2-workaround: SwapperMultipleWindowsNoSpinner some windows are closed",{workaround:h.options,activeWindowHandlesLength:f.length,windowHandlesLength:b.length});k&&(d.updateHandleName(k,"k"+m.default.randomString(8),2),k.location.href=a);e(b,c)};n=new l.default(n);n.setWindowNamePrefix(b);n.start(!0)},b}(e.default);b.SwapperMultipleWindowsNoSpinner=a;b.default=a},function(e,b,a){Object.defineProperty(b,"__esModule",{value:!0});var h=a(8),g=a(9),l=a(13),m=
a(10),f=a(23),c=a(24),d=a(12);b.onItemMouseUp=function(a,b){return h.getWorkaround().onItemMouseUp(a,b)};b.onItemMouseDown=function(a,b){return h.getWorkaround().onItemMouseDown(a,b)};b.onItemChange=function(a,b,c){return 30===m.CompareToSettings.getInstance().getSettingsSync().apiVersion?f.ItemsList.getInstance().updateCheckedItemState(a,c):l.CompareToList.getInstance().updateCheckedItemState(a,c),h.getWorkaround().onItemChange(a,b,c)};b.onFormClick=function(a,b,e,f){var k=function(){f&&f()};if(!a.placement)return k(),
void h.getLogger().error("cmp2-ui: placement information is missing in onFormClick method",a);var n=a.type,p=m.CompareToSettings.getInstance();if(!p.isSettings())return 0<b.length&&h.getLogger().error("cmp2-ui: settings is missing in onFormClick method with items",a,b),void k();var t=p.getSettingsSync();if(!c.isEnabled(n,t)||c.excludeRequest(t,p.getClient(),a.placement))return void k();a.url=e;var n=l.CompareToList.getInstance().getImpressionRequestState(b),p={windowNamePrefix:h.getWorkaround().getWindowNamePrefix(),
referer:t.uiReferer?window.location.href:""},r=g.WindowInfo.getInstance().getStoreConfig(a,n,p,c.getApiVersion(a,t),void 0===t.removeName||t.removeName);if(!r)return void k();var w=a.urlPrefix?a.urlPrefix:"";if(l.CompareToList.getInstance().isCheckedItem(b))return void h.getWorkaround().onFormClick(w+e,b,function(a){d.Ajax.getInstance().request(r,function(c){if(!c||!c.success)return h.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",c.errors),void k();h.getWorkaround().navigateToResults(w+
e,b,a)||k()},function(a){h.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",a);k()},k)});d.Ajax.getInstance().request(r,function(a){a&&a.success||h.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",a.errors);k()},function(a){h.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",a);k()},k)};b.onFormButtonMouseDown=function(a){if(l.CompareToList.getInstance().isCheckedItem(a))return m.CompareToSettings.getInstance().isSettings()?void h.getWorkaround().onFormButtonMouseDown(a):
void h.getLogger().error("cmp2-ui: settings are not set to execute form mouse down")};b.onFormButtonMouseUp=function(a){if(l.CompareToList.getInstance().isCheckedItem(a))return m.CompareToSettings.getInstance().isSettings()?void h.getWorkaround().onFormButtonMouseUp(a):void h.getLogger().error("cmp2-ui: settings are not set to execute form mouse up")}}]);(function(f,g){f.createComponentClass("common.compareto.v3.CompareToModuleSettings",{options:{config:null,prefix:null,advanceError:!1},moduleLoaded:!1,ajaxCall:function(a,c,d){var e=this.options,b=g.extend(!0,{},a.params,a.data);"GET"!==a.method&&(b=JSON.stringify(b));g.ajax({url:a.url,method:a.method,dataType:"json",contentType:"application/json; charset\x3dutf-8",data:b,headers:a.headers,success:function(a){c&&c(a)},error:function(a,b,c){d&&(e.advanceError?d({jqXHR:a,status:a.status,responseText:a.responseText,
textStatus:b,errorThrown:c}):d(a))}})},init:function(){var a=this,c=a.options,d=c.config,c=c.prefix,e=a.log;f.question.answer("cmp2.module.loaded",function(){return a.moduleLoaded});d?a.setConfig(d):g.ajax({method:"GET",url:c+"compareTo/config",success:function(b){b&&b.content?a.setConfig(b.content):(e.error("cmp2-module: unexpected response in config",b),a.setConfig(null))},error:function(b){e.error("cmp2-module: error loading config",b);a.setConfig(null)}})},setConfig:function(a){var c=this;window["@r9/cmp2-ui"].setModuleConfig({ajax:function(a,
e,b){c.ajaxCall(a,e,b)},logger:c.log,settings:a,client:"desktop"});c.moduleLoaded=!0;f.events.publish("cmp2.module.loaded",!0)},addEventHandlers:function(){}})})(window.R9,window.jQuery||window.jq);(function(d,e){d.createComponentClass("common.compareto.v3.Items",{options:{navigateToResults:!1,placement:{},hiddenClass:"",visibleClass:"",hiddenControls:"",visibleControls:"",itemChecked:"",defaultStyle:"",itemUnChecked:""},lastRequest:null,lastRequestData:null,lastResponse:null,itemsInProgress:!1,cleanupTimer:null,init:function(){this.cmp2ItemsElement=this.getChildElement("checkbox-row");this.cmp2ModuleLoaded=!0===d.question.ask("cmp2.module.loaded")},shouldUpdate:function(a){return-1<this.id().indexOf(a.id)},
addEventHandlers:function(){var a=this;this.subscribe("cmp2.module.loaded",function(b){a.cmp2ModuleLoaded=b;a.lastRequestData&&a.cmp2ModuleLoaded&&(d.events.publish("cmp2.getItems",a.lastRequestData),a.lastRequestData=null)});this.subscribe("cmp2.getItems",function(b){if(a.shouldUpdate(b))if(a.cmp2ModuleLoaded){a.cleanupTimer&&clearTimeout(a.cleanupTimer);var c=a.sanitizeFormData(b);a.lastRequest===e.param(c)?a.itemsInProgress||a.printResponse(a.lastResponse):(a.lastRequest=e.param(c),a.lastResponse=
[],a.itemsInProgress=!0,window["@r9/cmp2-ui"].getCompareTo(c,function(b){a.printResponse(b);a.lastResponse=b;a.itemsInProgress=!1},function(b){a.log.error("v3.Items: unable to load items",b,c);a.lastResponse=[];a.itemsInProgress=!1}))}else a.lastRequestData=b});this.subscribe("cmp2.cleanUp",function(b){a.shouldUpdate(b)&&(a.cleanupTimer=setTimeout(function(){a.printResponse([])},50))});this.subscribe("cmp2.submit",function(b){if(a.shouldUpdate(b)){var c=b.url&&b.url.startsWith("http")?b.url:"/"+b.url,
d=a.sanitizeFormData(b);a.onFormSubmit(b,d,a.items||[],c)}});var b=this.id(),b=b.substr(0,b.lastIndexOf("-"));e("#"+b+" button[type\x3dsubmit]").on("mousedown",function(){window["@r9/cmp2-ui"].onFormButtonMouseDown(a.items||[])});e("#"+b+" button[type\x3dsubmit]").on("mouseup",function(){window["@r9/cmp2-ui"].onFormButtonMouseUp(a.items||[])});this.getChildElement("allLink").on("click",function(b){b.preventDefault();a.toggleCheckedItems(!0)});this.getChildElement("noneLink").on("click",function(b){b.preventDefault();
a.toggleCheckedItems(!1)});this.subscribe("cmp2.uncheckAll",function(){a.toggleCheckedItems(!1)});this.subscribe("cmp2.checkAll",function(){a.toggleCheckedItems(!0)});this.subscribe("cmp2.update.component.options",function(b){if(b||b.navigateToResults)a.options.navigateToResults=b.navigateToResults})},onFormSubmit:function(a,b,c,f){var e=this.options.navigateToResults;window["@r9/cmp2-ui"].onFormClick(b,c||[],f||"",function(){e?f&&f.startsWith("http")?window.location.href=f:window.location.href="/"+
f.replace(/^[/]*/g,""):d.events.publish("searchform.submit",a)})},toggleCheckedItems:function(a){(!a||this.items&&window["@r9/cmp2-ui"].showRPCompareAll(this.items))&&this.cmp2ItemsElement.find(".item").each(function(){var b=e(this);"true"===b.attr("aria-checked")!==a&&b.trigger("click")})},onItemKeyDown:function(a){return a.keyCode===d.globals.keyCodes.SPACE||a.keyCode===d.globals.keyCodes.ENTER?(e(a.currentTarget).click(),!1):!0},renderItemTemplate:function(a){var b=this.options;return e("\x3cspan /\x3e").addClass(b.defaultStyle).addClass("item").addClass(a.checked?
b.itemChecked:b.itemUnChecked).attr("role","checkbox").attr("aria-checked",a.checked).attr("data-code",a.code).attr("tabindex","0").text(a.name).keydown(this.onItemKeyDown.bind(this))},printResponse:function(a){d.dom.swapClasses(this.element,this.options.visibleClass,this.options.hiddenClass);d.events.publish("cmp2.hidden",{id:this.id(),visible:!1});this.cmp2ItemsElement.empty();for(var b=0,c;c=a[b];b++)if(c.visible){var e=this.renderItemTemplate(c);this.cmp2ItemsElement.append(e);this.updateElementState(e,
c)}a&&0<a.length&&(this.updateControlsState(a),d.events.publish("cmp2.shown",{id:this.id(),visible:!0}),d.dom.swapClasses(this.element,this.options.hiddenClass,this.options.visibleClass));this.items=a;d.events.publish("cmp2.rendering.finished",{id:this.id(),items:a})},updateControlsState:function(a){d.dom.swapClassesToggle(this.getChildElement("controls"),this.options.visibleControls,this.options.hiddenControls,window["@r9/cmp2-ui"].showRPCompareAll(a))},updateElementState:function(a,b){var c=this,
f=c.options,g=e(a);g.on("click",function(){var a=e.extend(!0,{},b);b.checked=!b.checked;d.dom.swapClassesToggle(g,f.itemChecked,f.itemUnChecked,b.checked);g.attr("aria-checked",b.checked);window["@r9/cmp2-ui"].onItemChange(c.items,a,b)});g.on("mousedown",function(){window["@r9/cmp2-ui"].onItemMouseDown(c.items,b)}).on("mouseup",function(){window["@r9/cmp2-ui"].onItemMouseUp(c.items,b)})},sanitizeFormData:function(a){var b;switch(a.vertical){case "flights":b="F";break;case "hotels":b="H";break;case "cars":b=
"C";break;case "packages":b="P";break;case "cruises":b="R";break;case "trains":b="T";break;default:b=a.vertical}return{type:b,placement:this.options.placement,url:a.url,requestInformation:null}}})})(window.R9,window.jQuery||window.jq);(function(m,e){m.createWidgetClass("datepicker.Calendar",{aboveCalendarContainer:null,belowCalendarContainer:null,months:null,currentPickerId:null,animate:!0,animating:!1,isOpen:!1,DateMode:{SINGLE:"single",RANGE:"range",WEEKEND:"weekend",OPENFLEX:"openflex"},now:null,maxDate:null,leftArrow:'\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" viewBox\x3d"0 0 26 26" fill\x3d"currentColor"\x3e\x3cpath d\x3d"M16.49 20.89L7.89 13l8.6-7.89 1.02 1.11-7.4 6.78 7.4 6.78-1.02 1.11z"/\x3e\x3c/svg\x3e',rightArrow:'\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" viewBox\x3d"0 0 26 26" fill\x3d"currentColor"\x3e\x3cpath d\x3d"M9.91 20.87l-1.07-1.05L15.57 13 8.84 6.18l1.07-1.05L17.68 13l-7.77 7.87"/\x3e\x3c/svg\x3e',
pickers:{},options:{monthTitleFormat:"MMMM YYYY",allowPastDates:!1,fullCssClass:"Common-Widgets-Datepicker-Calendar",shortDayNameLen:1,mobileBreakpoint:568,monthWidth:260,isMobile:!1,flexRadioButtons:!1,forceDownwards:!1,removeOnPollingStart:!1},daysSelector:".col-day[data-val]:not(.disabled)",mobileHtml:null,getCssClass:function(){var a=this.getCurrentPicker(),b=this.options.fullCssClass;a&&a.cssClass()&&(b+=" "+a.cssClass());return b},addPicker:function(a){var b=a.dateMode,c=a.group;if("undefined"===
typeof a.id||"undefined"===typeof b||"undefined"===typeof c)throw Error("id, dateMode and group should not be empty.");this.pickers[a.id]=e.extend({},a,{state:{currentDate:this.getInitDate(a.initDate),minDate:null}})},init:function(){this.now=moment().startOf("day");this.maxDate=moment().add(1,"year");this.createCalendar();m.events.ready("common.widgets.datepicker.calendar.initialized",{instance:this})},createCalendar:function(){this.element=e(this.createSkeleton(this.now));this.aboveCalendarContainer=
this.element.find(".aboveCalendar");this.belowCalendarContainer=this.element.find(".belowCalendar");this.pointer=this.element.find(".pointer");this.title=this.element.find(".title");this.displayWrapper=this.element.find(".displayWrapper");this.next=this.element.find(".nextMonth");this.prev=this.element.find(".prevMonth");this.months=this.element.find(".monthsGrid");this.animation=this.element.find(".animationWrapper");this.defaultView=this.element.find(".default-view")},addEventHandlers:function(){var a=
this,b=function(b){return function(c){b.call(a,this,c)}};this.element.on("click.next",".nextMonth",this.onNextClick.bind(this));this.element.on("click.prev",".prevMonth",this.onPrevClick.bind(this));this.element.on("keypress.next",".nextMonth",this.proxyClick.bind(this));this.element.on("keypress.prev",".prevMonth",this.proxyClick.bind(this));this.element.on("click.day",this.daysSelector,b(this.onDayClick));this.element.on("mouseenter.day",this.daysSelector,b(this.onDayOver));this.element.on("mouseleave.day",
this.daysSelector,b(this.onDayOut));this.element.on("keydown.day",this.daysSelector,b(this.onDayKeydown));this.options.removeOnPollingStart&&m.events.subscribe("resultspage.streaming.start",this.resetPosition.bind(this))},proxyClick:function(a){32!=a.which&&13!=a.which||this.trigger("click")},changeMonth:function(a){var b=this,c=this.getCurrentDate(),d=c.add(a,"month");1!==Math.abs(a)||500>this.animation.outerWidth()?(this.update(d),this.onMonthChange()):(this.animating=!0,this.animation.addClass("animating").css("transform",
"translateX(%spx)".format(a*("rtl"===document.dir?this.options.monthWidth:-this.options.monthWidth))),setTimeout(function(){b.animating=!1;b.animation.removeClass("animating").css("transform","translateX(0px)");-1==a?(b.removeMonth(b.months.children().last()),b.addMonth(b.makeMonthHTML(c.clone(),-1),!0),b.months.children().eq(1).attr("aria-hidden","false").removeClass("col-hidden"),b.months.children().eq(3).attr("aria-hidden","true").addClass("col-hidden")):1==a&&(b.removeMonth(b.months.children().first()),
b.addMonth(b.makeMonthHTML(c.clone(),2),!1),b.months.append(),b.months.children().eq(2).attr("aria-hidden","false").removeClass("col-hidden"),b.months.children().eq(0).attr("aria-hidden","true").addClass("col-hidden"));b.setDisplayHeight();b.onMonthChange()},200),this.updateNav())},removeMonth:function(a){a.remove()},addMonth:function(a,b){b?this.months.prepend(a):this.months.append(a)},onNextClick:function(a){e(a.currentTarget).is(".disabled")||this.animating?a.preventDefault():this.changeMonth(1)},
onPrevClick:function(a){e(a.currentTarget).is(".disabled")||this.animating?a.preventDefault():this.changeMonth(-1)},onDayClick:function(a,b){var c=this.getCurrentPicker();if(c.onDayClick)c.onDayClick(a,b)},onDayOver:function(a,b){var c=this.getCurrentPicker();if(c.onDayOver)c.onDayOver(a,b)},onDayOut:function(a,b){var c=this.getCurrentPicker();if(c.onDayOut)c.onDayOut(a,b)},onDayKeydown:function(a,b){var c=this.getCurrentPicker();if(c.onDayKeydown)c.onDayKeydown(a,b)},setMinDate:function(a,b){if(b=
this.pickers[b]){var c=b.state.currentDate,d=b.state.minDate;null!=d&&d.isSame(a,"d")||(d=moment(a),b.state.minDate=d,a=d.clone().startOf("month"),a.isAfter(c)&&(b.state.currentDate=a))}},getMinDate:function(a){return a&&this.pickers[a]?this.pickers[a].state.minDate:this.getCurrentPicker()?this.getCurrentPicker().state.minDate:null},setCurrentDate:function(a){this.getCurrentPicker().state.currentDate=a},getCurrentDate:function(){return this.getCurrentPicker().state.currentDate},checkDate:function(a){return!this.options.allowPastDates&&
a.isBefore(this.now)||a.isAfter(this.maxDate)||null!==this.getMinDate()&&a.isBefore(this.getMinDate())?!1:!0},makeNavHTML:function(a){var b=this.checkDate(a.clone().add(-1,"month"))?"":"disabled";a=this.checkDate(a.clone().add(1,"month"))?"":"disabled";var c=[];c.push('\x3cdiv id\x3d"%s" tabindex\x3d"0" role\x3d"button" %s aria-label\x3d"Previous month" class\x3d"navItem prevMonth %s"\x3e%s\x3c/div\x3e'.format(this.id("prev"),b?'disabled\x3d"disabled"':"",b,this.leftArrow));c.push('\x3cdiv id\x3d"%s" tabindex\x3d"0" role\x3d"button" %s aria-label\x3d"Next month" class\x3d"navItem nextMonth %s"\x3e%s\x3c/div\x3e'.format(this.id("next"),
a?'disabled\x3d"disabled"':"",a,this.rightArrow));return c.join("")},makeWeekHeaderHTML:function(a,b,c){var d=[];d.push('\x3cdiv class\x3d"keel-grid weekDayGrid %s" %s\x3e'.format((a?"hide":"")+" "+(c||""),a?'role\x3d"row"':'aria-hidden\x3d"true"'));c=moment().startOf("week");for(var e=0;7>e;e++)d.push('\x3cdiv class\x3d"col-weekDay"\x3e\x3cdiv %s class\x3d"weekDay" %s aria-label\x3d"%s"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(b?'id\x3d"%s-%s"'.format(b,e):"",a?'role\x3d"columnheader"':"",c.format("dddd"),
c.format("dd").substr(0,this.options.shortDayNameLen))),c.add(1,"day");d.push("\x3c/div\x3e");return d.join("")},makeMobileCalendarHTML:function(a){this.isMobileModeLoaded=!0;if(!this.mobileHtml){this.mobileHtml=[];for(var b=-1;13>b;b++)this.mobileHtml.push(this.makeMonthHTML(a.clone(),b,!0))}return this.mobileHtml},makeCalendarHTML:function(a){var b=[];b.push(this.makeMonthHTML(a.clone(),-1));b.push(this.makeMonthHTML(a.clone(),0));b.push(this.makeMonthHTML(a.clone(),1));b.push(this.makeMonthHTML(a.clone(),
2));return b.join("")},makeMonthHTML:function(a,b,c){var d=[];a=a.clone().add(b,"month").startOf("month");var e=a.month(),g=this.id(a.format("YYYYMM"));b=(-1===b||2===b)&&!c;d.push('\x3cdiv id\x3d"'+g+'" class\x3d"col col-month col-month-m '+(b?"col-hidden":"")+'" role\x3d"grid" aria-readonly\x3d"true" aria-hidden\x3d"'+b+'"\x3e');d.push('\x3cdiv class\x3d"month"\x3e');d.push('\x3cdiv class\x3d"monthDisplay"\x3e'+a.format(this.options.monthTitleFormat)+"\x3c/div\x3e");d.push(this.makeWeekHeaderHTML(!0,
g));d.push('\x3cdiv class\x3d"weeks"\x3e');d.push('\x3cdiv class\x3d"keel-grid weekGrid" role\x3d"row"\x3e');for(b=0;b<a.weekday();b++)d.push(this.makeDayHTML(g));for(;a.month()==e;)d.push(this.makeDayHTML(g,a)),6===a.weekday()&&d.push('\x3c/div\x3e\x3cdiv class\x3d"keel-grid weekGrid" role\x3d"row"\x3e'),a.add(1,"day");a.add(-1,"day");d.push("\x3c/div\x3e");d.push("\x3c/div\x3e");d.push("\x3c/div\x3e");d.push("\x3c/div\x3e");return d.join("")},makeDayHTML:function(a,b){var c="",d="",e="",g=-1,h=
"",k="";b?(this.checkDate(b)?(b.isSame(this.now)&&(c="today"),g=0):c="disabled",d=b.date(),h='aria-describedby\x3d"'+a+"-"+b.weekday()+'"',k=' aria-label\x3d"'+b.format("MMMM D")+'"',e='data-val\x3d"'+b.valueOf()+'"'):c="empty";return"\x3cdiv "+e+' class\x3d"col-day '+c+'" role\x3d"gridcell" '+h+k+'tabindex\x3d"'+g+'"\x3e\x3cdiv class\x3d"day"\x3e'+d+"\x3c/div\x3e\x3c/div\x3e"},createSkeleton:function(a){var b=this.makeWeekHeaderHTML(!1);a=this.makeNavHTML(a);var c=this.options.flexRadioButtons?"flexRadioButtons":
"";return'                \x3cdiv id\x3d"'+this.id()+'" class\x3d"'+this.getCssClass()+'" aria-expanded\x3d"false" role\x3d"dialog"\x3e                    \x3cdiv id\x3d"'+this.id("pointer")+'" class\x3d"pointer hidden"\x3e\x3c/div\x3e                    \x3cdiv id\x3d"'+this.id("title")+'" class\x3d"title"\x3e\x3c/div\x3e                    \x3cdiv class\x3d"innerWrapper"\x3e                        \x3cdiv class\x3d"contentContainer"\x3e                            \x3cdiv id\x3d"'+this.id("above")+
'" class\x3d"aboveCalendar hidden '+c+'"\x3e\x3c/div\x3e                            \x3cdiv id\x3d"'+this.id("displayWrapper")+'" class\x3d"displayWrapper"\x3e                                \x3cdiv class\x3d"default-view"\x3e                                    '+a+'                                    \x3cdiv class\x3d"keel-grid weekDaysGrid"\x3e                                        \x3cdiv class\x3d"col-hidden col-weekHeader col-weekHeader-m"\x3e'+b+'\x3c/div\x3e                                        \x3cdiv class\x3d"col-hidden col-weekHeader col-weekHeader-m"\x3e'+
b+'\x3c/div\x3e                                    \x3c/div\x3e                                    \x3cdiv id\x3d"'+this.id("animation")+'" class\x3d"animationWrapper"\x3e                                        \x3cdiv id\x3d"'+this.id("months")+'" class\x3d"keel-grid monthsGrid"\x3e\x3c/div\x3e                                    \x3c/div\x3e                                \x3c/div\x3e                            \x3c/div\x3e                            \x3cdiv id\x3d"'+this.id("below")+'" class\x3d"belowCalendar hidden"\x3e\x3c/div\x3e                        \x3c/div\x3e                    \x3c/div\x3e                \x3c/div\x3e            '},
getCurrentPicker:function(){return this.pickers[this.currentPickerId]},setTitle:function(){var a=this.getCurrentPicker().title;"undefined"===typeof a||""===a?this.title.addClass("hidden"):this.title.text(a)},setClass:function(){this.element.removeClass().addClass(this.getCssClass())},populateMonthsGrid:function(a){a=a||this.getCurrentPicker().initDate||this.now;var b=this.makeCalendarHTML(a);this.setCurrentDate(a.clone());this.months.html(b)},switchPicker:function(a){if(null!==this.currentPickerId){var b=
this.pickers[this.currentPickerId];if(b.onUnload)b.onUnload(this)}if(b=this.pickers[a]){this.currentPickerId=a;this.setTitle();this.setClass();0===this.element.closest("body").length&&this.element.appendTo("body");if(b.onLoad)b.onLoad(this);b.afterLoad&&b.afterLoad(this);this.update(b.state.minDate);this.element.attr("data-date-group",b.group)}},update:function(a){this.populateMonthsGrid(a);this.updateNav();this.setDisplayHeight()},updateNav:function(){this.checkDate(this.getMonthDate(-1,!0))?this.prev.removeClass("disabled").removeAttr("disabled"):
this.prev.addClass("disabled").attr("disabled","disabled");this.checkDate(this.getMonthDate(2))?this.next.removeClass("disabled").removeAttr("disabled"):this.next.addClass("disabled").attr("disabled","disabled")},setDisplayHeight:function(){if(this.displayWrapper.is(":visible")){var a=0;this.months.children().each(function(b){if(1==b||2==b)a=Math.max(a,e(this).find(".month").outerHeight())});this.displayWrapper.height(a);this.getCurrentPicker()&&this.getCurrentPicker().setDisplayHeight&&this.getCurrentPicker().setDisplayHeight()}},
resetPosition:function(){setTimeout(function(){this.element.removeAttr("style")}.bind(this),750)},position:function(a,b){if(this.isOpen){var c=this.getCurrentPicker(),d=c.dateMode,t=c.group,c=c.hasPointer,g={},h=0,k=0,l=0,r=Math.round(e(window).outerWidth()),f=m.question.ask("DateInput.%s.startDate".format(t));if(r<this.options.mobileBreakpoint&&this.isOpen)this.element.removeAttr("style");else{if(d===this.DateMode.RANGE){var q=m.question.ask("DateInput.%s.endDate".format(t)),p,n;q||console.error('Missing end input field, if this is a single date, set the dateMode parameter to "single"');
var u=q.offset.left-f.offset.left;f.wrapper&&f.wrapper===q.wrapper&&e(f.wrapper).length&&(p=e(f.wrapper),n=p.offset());p?(g.left=n.left,h=n.top,k=p.outerHeight(),l="endDate"===a?q.offset.left-n.left:f.offset.left-n.left):f.height===q.height&&f.offset.top===q.offset.top&&this.element.outerWidth()-60>u&&(g.left=f.offset.left,h=f.offset.top,k=f.height,l="endDate"===a?u:0)}else f.wrapper&&e(f.wrapper).length&&(p=e(f.wrapper),n=p.offset()),p&&(g.left=n.left,h=n.top,k=p.outerHeight(),l=f.offset.left-n.left);
g.hasOwnProperty("left")&&"undefined"!==typeof k||(a=m.question.ask("DateInput.%s.%s".format(t,d===this.DateMode.RANGE?a:"startDate")),h=a.offset.top,k=a.height,g.left=a.offset.left);(a=this.shouldFlipDirection(h,k))&&!this.options.forceDownwards?(g.top=h-this.element.outerHeight(),this.element.addClass("up")):(g.top=h+k,this.element.removeClass("up"));h=Math.round(g.left);g=Math.round(g.top);l=Math.round(l);k=Math.round(this.element.outerWidth())+h-r;0<k&&(h-=k,l+=k);k=0;this.element.parent()[0]===
jq(document.body)[0]&&(k=parseInt((jq(document.body).css("top")||"0").replace("-",""))||0);"rtl"===document.dir&&(h=m.question.ask("date.input.wrapper.width"),h=-1*(r-h-f.offset.left));f="translateX(%spx) translateY(%spx)".format(h,g+k);l="translateX(%spx)".format(l);f={transform:f,msTransform:f};l={transform:l,msTransform:l};b||this.element.css(f);c?this.pointer.css(l).removeClass("hidden"):this.pointer.addClass("hidden");this.animate=!0;!a&&this.getCurrentPicker()&&this.getCurrentPicker().autoScrollPosition&&
r>this.options.mobileBreakpoint&&(b=this.scrollToCalendar(g),0<b&&e("html, body").animate({scrollTop:e(window).scrollTop()+b},1E3));setTimeout(function(){this.animate&&this.element.addClass("animate")}.bind(this),1)}}},scrollToCalendar:function(a){a=e(window).scrollTop()+e(window).outerHeight()-a;return this.element.outerHeight(!0)-a},shouldFlipDirection:function(a,b){var c=e(window).scrollTop(),d=c+e(window).outerHeight(),m=this.element.outerHeight();return a+b+m>d&&!(a-m<c)},getMonthDate:function(a,
b){a=this.getCurrentDate().clone().add(a,"month");return b?a.endOf("month"):a.startOf("month")},onMonthChange:function(){m.events.publish("Calendar.monthchange",{group:this.getCurrentPicker().group})},open:function(a){if("undefined"===typeof this.pickers[a])throw Error('Picker %s not attached to the calendar. Please use "addPicker" to attach it to the calendar',a);a!==this.currentPickerId&&(this.switchPicker(a),this.animate=!1);this.element.attr("aria-expanded",!0);this.element.addClass("Summon");
setTimeout(function(){this.animate&&this.element.addClass("animate")}.bind(this),1);this.isOpen=!0},close:function(a){this.isOpen&&this.currentPickerId===a&&(this.element.attr("aria-expanded",!1),this.element.removeClass("Summon animate"),this.isOpen=!1)},getInitDate:function(a){a=a?moment(a):this.now.clone();a.isBefore(this.now)&&!this.options.allowPastDates&&(a=this.now.clone());return a},getSelectableDays:function(a){var b=this.months.children().find(".col-day[data-val]").not(".disabled");return a&&
0>a.indexOf("%s")?b.filter(a):b},getDayElement:function(a){a=moment(a).valueOf();return this.element.find(".col-day[data-val\x3d%s]".format(a))},hideTooltip:function(){this.element.find(".dayTip").hide()},highlightDates:function(a){this.getSelectableDays(a.join(",")).addClass("highlighted")},markFlex:function(a){this.getSelectableDays(a.join(",")).addClass("flex")},markStartDate:function(a){this.selectDate(a).addClass("startDate")},selectDates:function(a){return this.getSelectableDays(a.join(",")).addClass("selected").attr("aria-selected",
"true")},selectDate:function(a){a=this.getDayElement(a);a.addClass("selected").attr("aria-selected","true");return a},markEndDate:function(a){this.selectDate(a).addClass("endDate")},markPreviewDates:function(a){this.getSelectableDays(a.join(",")).addClass("preview")},isDifferentPicker:function(a){return this.currentPickerId!==a},calculateMonthOffset:function(a){a=moment(a).startOf("month").diff(this.getCurrentDate().startOf("month"));a=Math.round(moment.duration(a).asMonths());0<a&&--a;return a},
offset:function(){return this.element.offset()},append:function(a){var b=this.getAppendElement(a);return null!==b&&this.appended!==a?(b.append(this.element.detach()),this.appended=a,!0):!1},buffer:function(a){return null!==this.getAppendElement(a)&&this.appended===a?(e("body").append(this.element.detach()),this.appended=null,!0):!1},getAppendElement:function(a){return a&&e(a).length?e(a):null}})})(R9,jQuery);(function(g,f){g.createWidgetClass("datepicker.DatePicker",{DateMode:{SINGLE:"single",RANGE:"range",WEEKEND:"weekend",OPENFLEX:"openflex"},Keys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,RETURN:13,PAGE_UP:33,PAGE_DOWN:34,SPACE:32,HOME:36,SHIFT:16,END:35,ESC:27},options:{msg:{},title:"",initDate:"",fullCssClass:"Common-Widgets-Datepicker-DatePicker",startDate:"",endDate:"",dateMode:"range",group:"",updateGroup:"",minRange:0,change:null,dismiss:null,closeDelay:0,rising:!1,getFormData:null,consecutive:!0,
delayShowDropdown:f.noop,showDropdownDelay:200,keepOpenOnRangeStartChange:!0,hasPointer:!0,mobileBreakpoint:568,optionalReturn:!1,markOpenFlexDates:!1,markWeekendDates:!1,hasCloseButton:!0,mobileFriendly:!1,autoScrollPosition:!1},dateMode:"range",startDate:0,endDate:0,tempDate:0,weekendStartTime:{day:4,partial:""},weekendEndTime:{day:0,partial:""},picking:"startDate",prevState:null,visible:!1,html:null,fullScreen:!1,calendar:null,cssClasses:[],lastAboveMobileContent:null,addFixedClass:!1,calendarElementCss:{},
init:function(){this.cssClasses=[];this.html=f("html");this.addCssClass(this.options.fullCssClass);this.options.getFormData&&this.addCssClass("Buzz");this.makeAboveCalendarContent();this.makeBelowCalendarContent();g.events.when("common.widgets.datepicker.calendar.initialized",function(a){this.calendar=a.instance;this.options.startDate&&this.validateDate(this.options.startDate)&&(this.startDate=moment(this.options.startDate).valueOf());this.options.endDate&&this.validateDate(this.options.endDate)&&
(this.endDate=moment(this.options.endDate).valueOf());this.options.dateMode&&this.setDateMode(this.options.dateMode);this.addMeToCalendar()}.bind(this))},addMeToCalendar:function(){var a=this.getExtraOptions();this.calendar.addPicker(f.extend({},{id:this.id(),dateMode:this.dateMode,initDate:this.options.initDate,title:this.options.title,cssClass:this.getCssClass.bind(this),group:this.options.group,onLoad:this.onLoad.bind(this),afterLoad:this.afterLoad.bind(this),onUnload:this.onUnload.bind(this),
onDayClick:this.onDayClick.bind(this),onDayOver:this.onDayPreviewOver.bind(this),onDayOut:this.onDayPreviewOut.bind(this),onDayKeydown:this.onDayKeydown.bind(this),autoScrollPosition:this.options.autoScrollPosition},a))},onLoad:function(a){this.addAboveCalendarContent(a.aboveCalendarContainer,a.leftContainer);this.addBelowCalendarContent(a.belowCalendarContainer,a.leftContainer)},afterLoad:function(a){},onUnload:function(){this.removeAboveCalendarContent();this.removeBelowCalendarContent();this.updatePickingVal("startDate")},
addAboveCalendarContent:function(a){var b=this.element.find(".aboveCalContent");b.length&&(this.aboveCalContent=b,a.append(b))},addBelowCalendarContent:function(){},removeAboveCalendarContent:function(){this.aboveCalContent&&this.element.append(this.aboveCalContent);this.lastAboveMobileContent&&this.element.append(this.lastAboveMobileContent)},removeBelowCalendarContent:function(){},addEventHandlers:function(){this.subscribe("DateInput.update",{group:this.options.group},this.onDateInputUpdate.bind(this));
this.subscribe("DateInput.summon",{group:this.options.group},this.onSummon.bind(this));this.subscribe("DateInput.dismiss",{group:this.options.group},this.onDismiss.bind(this));this.subscribe("Calendar.monthchange",{group:this.options.group},this.onMonthChange.bind(this));this.subscribe("forceDismiss.DatePicker",this.onDismiss.bind(this));this.subscribe("DateInput.change.element.style",this.changeElementStyle.bind(this));f(document).on("click.DatePicker",this.hideOnClickOut.bind(this));f(window).on("resize.DatePicker",
this.handleWindowResize.bind(this));this.options.optionalReturn&&this.subscribe("DateInput.clear",{group:this.options.group},this.onClear.bind(this))},destroy:function(){f(window).off("resize.DatePicker"+this.id());f(document).off("click.DatePicker"+this.id());this.base();this.element.remove()},getCssClass:function(){return[this.cssClasses.join(" "),"R9-Overlay"].join(" ")},hideOnClickOut:function(a){var b=f(a.target).closest("[data-date-group\x3d%s]".format(this.options.group));if((a.originalEvent||
!g.config.getBoolean("ui.xp.autoopen-dp",!1))&&this.isCalendarOpen()&&0===b.length)this.onDismiss()},handleWindowResize:function(){this.isCalendarOpen()&&(this.calendar.append(this.options.appendTo)||this.calendar.position(this.picking))},publishUpdate:function(a){f.extend(a,{updateGroup:this.options.updateGroup,group:this.options.group});g.events.publish("DatePicker.update",a)},onDateInputUpdate:function(a){if(this.isCalendarOpen()||a.force)switch(a.clear&&this.clear(),a.picking&&this.updatePickingVal(a.picking),
a.weekendStartTime&&(this.weekendStartTime=this.parseWeekendTimes(a.weekendStartTime)),a.weekendEndTime&&(this.weekendEndTime=this.parseWeekendTimes(a.weekendEndTime)),a.dateMode&&this.setDateMode(a.dateMode),a.action){case "preview":this.updatePickingVal(a.field);!a.previous&&a.value||this.removeDatePreview(a.previous,!0);a.value&&this.previewDate(a.value,a.preventUpdate);break;case "change":a.spinner&&this.handleSpinnerUpdate(a);this.changeDate(a.value,a.focused||a.spinner,a.tabForward,a.event);
break;case "tab":this.handleTabIntoEvent(a)}},addCssClass:function(a){a.split(" ").forEach(function(a){0<=this.cssClasses.indexOf(a)||this.cssClasses.push(a)}.bind(this))},changeElementStyle:function(a){this.addFixedClass=a.addFixedClass;this.calendarElementCss=a.calendarElementCss},removeCssClass:function(a){a.split(" ").forEach(function(a){for(var b=this.cssClasses.indexOf(a);0<=b;)this.cssClasses.splice(b,1),b=this.cssClasses.indexOf(a)}.bind(this))},onSummon:function(a){if(this.calendar)if(this.tempDate=
0,"function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.onSummon.bind(this,a),this.options.showDropdownDelay);else{null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);this.setPicking(a.field,!0);null!==this.options.getFormData?this.addCssClass("Buzz"):this.removeCssClass("Buzz");a.modal?this.addCssClass("InModal"):this.removeCssClass("InModal");this.addFixedClass&&
this.addCssClass("calendar-fixed");a.rising?this.addCssClass("Rising"):this.removeCssClass("Rising");a.sticky?this.addCssClass("InSticky"):this.removeCssClass("InSticky");this.validateDate(a.minDate,!0)&&this.setMinDate(a.minDate);!0===this.options.mobileFriendly&&this.addCssClass("mobile-friendly");!0===this.options.seoDatepicker&&this.addCssClass("seo-datepicker");if(!this.isCalendarOpen()||this.calendar.isDifferentPicker(this.id())){this.calendar.open(this.id());var b=g.question.ask("DateInput.%s.startDate".format(this.options.group));
b&&(this.startDate=b.value);if(this.dateMode===this.DateMode.RANGE){var c=g.question.ask("DateInput.%s.endDate".format(this.options.group));this.validateDateRange(b.value,c.value)&&(this.startDate=b.value,this.endDate=c.value);c&&(this.endDate=c.value)}g.events.publish("DatePicker.opened",this.options.group);this.setDateMode(this.dateMode,!1,!0)}this.calendar.setDisplayHeight();this.calendar.append(this.options.appendTo)||this.calendar.position(this.getPicking());this.moveDateIntoView(this[a.field]);
this.markSelectedDays();this.updateBuzzData();this.options.hasCloseButton&&this.bindEvent(this.findCloseLink(),"click",this.handleCloseEvent);f(".Common-Widgets-Datepicker-Calendar.Common-Widgets-Datepicker-DatePicker").css(this.calendarElementCss)}},dismissDatePicker:function(a){this.calendar&&(this.visible=!1,this.hideTooltip(),0!==this.tempDate&&this.changeDate(this.tempDate,!1,!1,null),this.calendar.buffer(this.options.appendTo),this.calendar.close(this.id()),this.publishUpdate(f.extend(a,{action:"blur",
fields:{startDate:!0,endDate:!0},format:"display"})),"function"===typeof this.options.dismiss&&this.options.dismiss(),g.events.publish("DatePicker.closed",f.extend({},a,{group:this.options.group})))},onDismiss:function(a){this.shouldDismiss(a)&&(this.options.closeDelay?setTimeout(this.dismissDatePicker.bind(this,a),this.options.closeDelay):this.dismissDatePicker(a))},shouldDismiss:function(a){return this.dateMode===this.DateMode.RANGE&&a&&this.options.consecutive&&(a.tabForward&&"startDate"===this.getPicking()||
a.tabBackward&&"endDate"===this.getPicking())?!1:!0},onClear:function(a){},onDayClick:function(a){a=f(a).data("val");this.changeDate(a)},changeDate:function(a,b,c,d){moment(a);var e=!1,h=!0,f=this.getPicking(),k={action:"change",fields:{}};this.tempDate=0;if(this.dateMode===this.DateMode.RANGE){if("startDate"===this.getPicking()&&this.validateDate(a))this.startDate===a&&this.options.consecutive?this.setPicking("endDate",c,void 0,c):(this.startDate=a,k.fields.startDate=a,this.validateDateRange(a,this.endDate)||
(this.endDate=0,this.options.optionalReturn?k.fields.endDate=null:(k.fields.endDate=this.getMinEndDate(),this.endDate=k.fields.endDate)),this.moveDateIntoView(a),this.markSelectedDays(),!b&&this.isCalendarOpen()&&((0===this.endDate||this.options.keepOpenOnRangeStartChange)&&this.options.consecutive?this.setPicking("endDate",c,void 0,c):e=!0)),"endDate"===this.wasPicking&&this.endDate&&(k.fields.endDate=this.endDate);else if("endDate"===this.getPicking()&&this.validateDate(a))if(this.endDate===a)h=
!1,0===this.startDate&&this.options.consecutive?this.setPicking("startDate"):e=!0;else{if(this.validateDateRange(this.startDate,a)||!this.startDate)this.endDate=a,k.fields.endDate=a;this.startDate||(this.startDate=this.getMinStartDate(),k.fields.startDate=this.startDate);this.moveDateIntoView(this.endDate);this.markSelectedDays();b||(0===this.startDate&&this.options.consecutive?this.setPicking("startDate"):e=!0)}k.picking=this.getPicking()}else{this.moveDateIntoView(a);k.fields.startDate=a;if(this.validateDate(this.endDate)&&
!this.validateDateRange(a,this.endDate)){var g=Math.max(this.options.minRange,1),g=moment(a).add(g,"days");k.fields.endDate=g.valueOf();this.endDate=k.fields.endDate}this.startDate=a;this.markSelectedDays();b||(e=!0)}k.tabForward=c;h&&this.publishUpdate(k);"function"===typeof this.options.change&&(a=[this.startDate],a.push(this.endDate?this.endDate:null),a.push(f),this.options.change.apply(this,a));e&&(e={},e.field=this.picking,e.tabForward=c,e.event=d,e.focusDisplay=!0,this.onDismiss(e))},moveDateIntoView:function(a){0!==
a&&this.isCalendarOpen()&&(a=this.calendar.calculateMonthOffset(a),0!==a&&this.calendar.changeMonth(a))},clear:function(){this.endDate=this.startDate=0;this.setPicking("startDate");this.clearDayState("preview");this.clearDayState("hover");this.clearDayState("highlighted");this.clearDayState("selected");this.clearDayState("startDate");this.clearDayState("endDate");this.publishUpdate({action:"clear",fields:{startDate:0,endDate:0}})},onMonthChange:function(){this.updateBuzzData();this.markSelectedDays()},
clearDayState:function(a){var b=this.calendar.getSelectableDays(".%s".format(a)).removeClass(a);"selected"===a&&(b.removeAttr("aria-selected"),this.calendar.getSelectableDays(".flex").removeClass("flex"))},validateDate:function(a,b){if("undefined"===typeof a||0===a)return!1;a=moment(a);var c=this.calendar.getMinDate(this.id());if(a.isValid()){if(a.isBefore(this.calendar.now)&&!this.options.allowPastDates||!b&&null!==c&&a.isBefore(c))return!1}else return!1;return!0},validateDateRange:function(a,b){return a&&
b?this.validateMinRange(a,b)&&this.validateDate(a)&&this.validateDate(b):!1},validateMinRange:function(a,b){a=moment(a);return moment(b).diff(a,"days")>=this.options.minRange},getMinStartDate:function(){return this.endDate?moment(this.endDate).subtract(this.options.minRange,"days").valueOf():0},getMinEndDate:function(){return this.startDate?moment(this.startDate).add(this.options.minRange,"days").valueOf():0},onDayPreviewOver:function(a){a=f(a).data("val");this.previewDate(a)},previewDate:function(a,
b){var c=moment(a),d={action:"preview",fields:{},picking:this.getPicking()};if(!a||c.isBefore(this.calendar.now))c=this.calendar.now.clone(),a=c.valueOf();else if(c.isSame(this.calendar.maxDate)||c.isAfter(this.calendar.maxDate))c=this.calendar.maxDate.clone(),a=c.valueOf();this.dateMode===this.DateMode.RANGE?"endDate"===this.getPicking()&&0!==this.startDate?this.validateMinRange(this.startDate,a)?this.validateDateRange(this.startDate,a)?d.fields[this.getPicking()]=a:d.endDate=this.getMinEndDate():
(0===this.endDate?(this.endDate=this.startDate,this.startDate=0,d.fields={startDate:a,endDate:this.endDate}):d.fields={startDate:a,endDate:0},this.wasPicking=this.getPicking(),this.setPicking("startDate",!1,!0),d.picking="startDate"):d.fields[this.getPicking()]=a:d.fields.startDate=a;b||this.publishUpdate(d);this.moveDateIntoView(a);this.markPreviewedDays(a)},removeDatePreview:function(a,b){if(this.isCalendarOpen()){a={action:"preview",fields:{startDate:0,endDate:0},clear:!0};this.clearDayState("preview");
this.clearDayState("hover");this.hideTooltip();if(this.wasPicking){var c=this[this.wasPicking],d=this[this.getPicking()];if(0===d||0===c)this[this.wasPicking]=d,this[this.getPicking()]=c;delete a.fields[this.wasPicking];this.setPicking(this.wasPicking,!1,!0);this.wasPicking=null;this.markSelectedDays()}a.picking=this.getPicking();b||this.publishUpdate(a)}},onDayPreviewOut:function(a){a=f(a).data("val");this.removeDatePreview(a)},setDateMode:function(a,b,c){this.dateMode=a;c||this.dateMode===this.DateMode.RANGE||
this.setPicking("startDate");this.isCalendarOpen()&&this.markSelectedDays()},computeActiveDates:function(a,b){var c=function(){return a?[a.format(b)]:[b]};switch(this.dateMode){case this.DateMode.RANGE:return this.computeActiveRangeDates(a,b);case this.DateMode.WEEKEND:return this.options.markWeekendDates?this.computeActiveWeekendDates(a,b):c();case this.DateMode.OPENFLEX:return this.options.markOpenFlexDates?this.computeActiveOpenFlexDates(a,b):c();default:return c()}},computeActiveRangeDates:function(a,
b){var c;b||(b=this[this.getPicking()]);b&&(c=moment(b));var d=[];if(c)if("startDate"===this.getPicking()&&this.endDate&&c.valueOf()<=this.endDate){b=this.endDate;var e=this.calendar.getMonthDate(3),h=moment(this.endDate);if(e.isSame(h)||e.isBefore(h))b=this.calendar.getMonthDate(3).valueOf();for(;c.valueOf()<=b;)a?d.push(a.format(c.valueOf())):d.push(c.valueOf()),c.add(1,"day")}else if("endDate"===this.getPicking()&&this.startDate&&c.valueOf()>=this.startDate){b=this.startDate;e=this.calendar.getMonthDate(-1);
h=moment(this.startDate);if(e.isSame(h)||e.isAfter(h))b=this.calendar.getMonthDate(-1).valueOf();for(;c.valueOf()>=b;)a?d.unshift(a.format(c.valueOf())):d.unshift(c.valueOf()),c.add(-1,"day")}else a?d.push(a.format(b)):d.push(b);return d},computeActiveWeekendDates:function(a,b){b=b?moment(b):moment(this.startDate);for(var c=b.clone().add(5,"weeks"),d={selected:[],highlighted:[]},e=!1,h=[],f=[];b.isSame(c)||b.isBefore(c);)!e&&b.day()>this.weekendStartTime.day||(b.day()===this.weekendStartTime.day?
(e=!0,h=[],f=[],a?h.push(a.format(b.valueOf())):h.push(b.valueOf())):b.day()===this.weekendEndTime.day&&e?(a?h.push(a.format(b.valueOf())):h.push(b.valueOf()),d.selected=d.selected.concat(h),d.highlighted=d.highlighted.concat(f)):(b.day()>this.weekendStartTime.day||b.day()<this.weekendEndTime.day)&&e&&(a?f.push(a.format(b.valueOf())):f.push(b.valueOf()))),b.add(1,"day");return d},computeActiveOpenFlexDates:function(a,b){b=b?moment(b):moment(this.startDate);for(var c=b.clone().add(5,"weeks"),d=[];b.isSame(c)||
b.isBefore(c);)a?d.push(a.format(b.valueOf())):d.push(b.valueOf()),b.add(1,"day");return d},parseWeekendTimes:function(a){var b=a.split("_");a=b[0];b=b[1];return{day:moment().set("day",a).day(),partial:"ANYTIME"!==b?b:""}},markSelectedDays:function(){var a;if(this.isCalendarOpen())switch(this.clearDayState("highlighted"),this.clearDayState("preview"),this.clearDayState("hover"),this.clearDayState("selected"),this.clearDayState("startDate"),this.clearDayState("endDate"),this.dateMode){case this.DateMode.RANGE:a=
this.computeActiveDates("[data-val\x3d%s]");1<a.length&&this.calendar.highlightDates(a);this.startDate&&(a=this.getStartDayElements(),a.flex&&this.calendar.markFlex(a.flex),a.exact&&this.calendar.markStartDate(a.exact));this.endDate&&(a=this.getEndDayElements(),a.flex&&this.calendar.markFlex(a.flex),a.exact&&this.calendar.markEndDate(a.exact));break;case this.DateMode.OPENFLEX:this.options.markOpenFlexDates&&(a=this.computeActiveDates("[data-val\x3d%s]"),this.calendar.getSelectableDays(a.join(",")).addClass("highlighted"));
this.calendar.getDayElement(this.startDate).addClass("selected").attr("aria-selected","true");break;case this.DateMode.WEEKEND:this.options.markWeekendDates&&(a=this.computeActiveDates("[data-val\x3d%s]"),this.calendar.getSelectableDays(a.selected.join(",")).addClass("highlighted"),a.highlighted.length&&this.calendar.getSelectableDays(a.highlighted.join(",")).addClass("highlighted"));this.calendar.getDayElement(this.startDate).addClass("selected").attr("aria-selected","true");break;default:this.calendar.selectDate(this.startDate)}},
getStartDayElements:function(){return{exact:this.startDate}},getEndDayElements:function(){return{exact:this.endDate}},markPreviewedDays:function(a){this.clearDayState("preview");this.clearDayState("hover");var b=this.computeActiveDates("[data-val\x3d%s]",a);this.calendar.markPreviewDates(b);a=this.calendar.getDayElement(a);a.addClass("hover");a.attr("data-tip")&&this.showTooltip(a)},setPicking:function(a,b,c,d){if(this.getPicking()!==a){this.tempDate=0;var e={},h={};e[this.getPicking()]=!0;h[this.getPicking()]=
!0;this.updatePickingVal(a);this.calendar.position(this.getPicking(),c);b||this.publishUpdate({action:"focus",fields:h,format:"input"});this.publishUpdate({action:"blur",fields:e,tabForward:d})}},updatePickingVal:function(a){this.picking=a},getPicking:function(){return this.picking},findCloseLink:function(){return f(".DatePickerTitleClose",this.calendar.element)},handleCloseEvent:function(){this.onDismiss()},bindEvent:function(a,b,c){var d=this;b+="."+this.id();a.off(b).on(b,function(a){return c.call(d,
this,a)})},isBuzzEnabled:function(){return"function"===typeof this.options.getFormData&&g.DatePicker&&g.DatePicker.BuzzData},updateBuzzData:function(){this.isBuzzEnabled()&&(new g.DatePicker.BuzzData).fetch(this.options.getFormData(),this.handleBuzzUpdate.bind(this))},handleBuzzUpdate:function(a){var b=this,c=this.calendar.months.find("[data-tip\x3dBUZZ_LOW]"),d=[];window.subData&&(a=window.subData);if("object"===typeof a.dates)for(var e in a.dates)a.dates.hasOwnProperty(e)&&"LOW"===a.dates[e]&&d.push(moment(e).valueOf());
0<c.length&&c.each(function(a,b){a=f(b);b=d.indexOf(a.attr("data-val"));-1==b?a.removeClass("buzz-date-low").removeAttr("data-tip"):d.splice(b,1)});f.each(d,function(a,c){b.calendar.getDayElement(c).addClass("buzz-date-low").attr("data-tip","BUZZ_LOW")})},makeAboveCalendarContent:function(){f("\x3cdiv class\x3d'aboveCalContent'\x3e"+(this.options.hasCloseButton?"\x3ca class\x3d'DatePickerTitleClose'\x3eX\x3c/a\x3e":"")+"\x3cdiv id\x3d'"+this.id("BUZZ_LOW")+"' class\x3d'dayTip buzzMsg'\x3e"+this.options.msg.BUZZ_MESSAGE_LOW+
"\x3c/div\x3e\x3c/div\x3e").appendTo(this.element)},makeBelowCalendarContent:function(){},showTooltip:function(a){var b=this.getChildElement(a.attr("data-tip"));a=a.offset();var c=this.calendar.element.offset();b.css({top:Math.round(a.top-c.top),left:Math.round(a.left-c.left)}).show()},hideTooltip:function(){this.calendar.hideTooltip()},setMinDate:function(a){this.calendar.setMinDate(a,this.id())},onDayKeydown:function(a,b){a=moment(this.getCurrentDayVal());var c=!0,d=!1,e=!1,f=!0,g=!1;switch(b.which){case this.Keys.UP:a.subtract(1,
"week");break;case this.Keys.DOWN:a.add(1,"week");break;case this.Keys.LEFT:a.subtract(1,"day");break;case this.Keys.RIGHT:a.add(1,"day");break;case this.Keys.PAGE_UP:b.ctrlKey||b.metaKey?a.subtract(1,"year"):a.subtract(1,"month");break;case this.Keys.PAGE_DOWN:b.ctrlKey||b.metaKey?a.add(1,"year"):a.add(1,"month");break;case this.Keys.HOME:a=a.startOf("month");break;case this.Keys.END:a=a.endOf("month");break;case this.Keys.SPACE:this.tempDate=0;d=!0;c=!1;e=!0;break;case this.Keys.TAB:this.tempDate=
0;c=!1;b.shiftKey?this.handleDayTabBackward():(g=d=!0,f=!1);break;case this.Keys.RETURN:this.tempDate=0;c=!1;d=!0;break;case this.Keys.ESC:this.tempDate=0;this.onDismiss({focusDisplay:!0});break;default:c=f=!1}c&&this.validateDate(a.valueOf(),!1)&&("endDate"!==this.picking||this.validateDateRange(this.startDate,a.valueOf()))&&(this.tempDate=a.valueOf(),this.previewDate(this.tempDate),this.calendar.getDayElement(this.tempDate).focus());d&&this.changeDate(a.valueOf(),e,g,b);f&&b.preventDefault()},getCurrentDayVal:function(){var a=
this.tempDate?this.tempDate:this[this.getPicking()];0===a&&(a="startDate"===this.getPicking()||0===this.startDate?moment().startOf("day").valueOf():this.getMinEndDate());return a},publishCurrentInputFocus:function(){var a={};a[this.picking]=!0;this.publishUpdate({action:"focus",fields:a,format:"input"})},handleTabIntoEvent:function(a){this.setPicking(a.field);var b=a&&a.event&&a.event.shiftKey,c;if("startDate"===this.getPicking())if(b)this.onDismiss(a);else c=!0,this.calendar.getDayElement(this.startDate).focus();
else"endDate"===this.getPicking()&&(c=!0,b?(this.setPicking("startDate"),this.calendar.getDayElement(this.startDate).focus()):this.calendar.getDayElement(this.endDate).focus());c&&a&&a.event&&a.event.preventDefault()},handleDayTabBackward:function(){this.publishCurrentInputFocus()},handleSpinnerUpdate:function(a){var b=a.currentValue,c=a.delta;b||("endDate"===this.getPicking()&&this.startDate?b=this.getMinEndDate():(b=(new Date).valueOf(),c=1));a.value=moment(b).add(c,"day").valueOf()},isCalendarOpen:function(){return this.calendar&&
this.calendar.isOpen&&this.calendar.currentPickerId===this.id()},getExtraOptions:function(){return{}}})})(R9,jQuery);(function(b){R9.extend("Widgets",{TextInput:function(a,c){this.elementNode=a;this.element=b(this.elementNode);this.validateElement()&&(this.options=b.extend({},this.options,c),this.init())}});R9.extend("Widgets.TextInput",{isTextInput:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"text"==a.type.toLowerCase()},isWidgetControlled:function(a){return"undefined"==typeof document.createElement("input").placeholder}});R9.extend("Widgets.TextInput.prototype",{widgetName:"textinput",
widgetBaseClass:"r9-textinput",widgetPlaceholderClass:"r9-textinput-placeholder-active",elementNode:null,element:null,options:{click:null,change:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("smartyfocus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindFormSubmission();this.element.data(this.widgetName,this);this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode)},validateElement:function(){return R9.Widgets.TextInput.isTextInput(this.elementNode)&&
R9.Widgets.TextInput.isWidgetControlled(this.elementNode)&&void 0===this.element.data(this.widgetName)},bindInputEvent:function(a,b){var c=this;a+="."+this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,a)})},bindFormSubmission:function(){var a=this,b="submit."+a.widgetName+a.element.attr("id"),d="form-pre-submit."+a.widgetName+a.element.attr("id");this.element.parents("form").off(b).on(b,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)});
this.element.parents("form").off(d).on(d,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)})},handleElementFocusEvent:function(a,c){a.disabled||(b(a).val()==b(a).attr("placeholder")&&this.clearPlaceholderText(b(a)),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,c){a.disabled||(0==b.trim(b(a).val()).length&&this.setPlaceholderText(a),this.options.blur&&this.options.blur.apply(this,arguments))},clearPlaceholderText:function(a){a.removeClass(this.widgetPlaceholderClass).val("")},
setPlaceholderText:function(a){b(a).addClass(this.widgetPlaceholderClass).val(b(a).attr("placeholder"))}})})(jq||jQuery);
(function(b){R9.createWidgetClass("text.TextInput",b.extend({},R9.Widgets.TextInput.prototype,{widgetPlaceholderClass:"vs-placeholder",inputElement:null,options:{needsPlaceholderSupport:!1,selectOnFocus:!1},init:function(){this.inputElement=this.inputElement||this.element;this.elementNode=this.inputElement.get(0)},addEventHandlers:function(){var a=this;this.options.needsPlaceholderSupport&&(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("focus",this.handleElementFocusEvent),
this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));if(this.options.selectOnFocus)a.inputElement.on("focus",function(){a.inputElement.on("mouseup.a keyup.a",function(b){a.elementNode.setSelectionRange(0,9999);a.inputElement.off("mouseup.a keyup.a").select()})})},getValue:function(){return b(this.inputElement).val()}}))})(jq||jQuery);(function(l){var m={},n=function(a,c){var b=JSON.stringify(a,Object.keys(a).sort());if(m.hasOwnProperty(b))m[b].callbacks.push(c);else{var d={key:b,callbacks:[c],request:l.ajax({type:"GET",dataType:"json",url:"/s/run/recentsearchhistory/gethistory",data:a,success:function(a){for(;d.callbacks.length;)d.callbacks.pop()(a)},complete:function(){delete m[b]}})};m[b]=d}};R9.extend("Common",{SmartyHistory:function(a){var c=a.historyType;c||(c="flight");var b=R9.Common.SmartyHistory.prototype["_"+c+"Instance"];
if(b)return b.init(),R9.Common.SmartyHistory.prototype["_"+c+"Instance"];this.options=l.extend({},this.options,a);this.init();R9.Common.SmartyHistory.prototype["_"+c+"Instance"]=this}});R9.extend("Common.SmartyHistory",{SmartyFlightHistory:function(a){return R9.Common.SmartyHistory.call(this,l.extend({historyType:"flight"},a))},SmartyHotelHistory:function(a){return R9.Common.SmartyHistory.call(this,l.extend({historyType:"hotel"},a))},SmartyCarHistory:function(a){return R9.Common.SmartyHistory.call(this,
l.extend({historyType:"car"},a))},SmartyClearHistory:function(){this.currentSmartyHistory&&(this.currentSmartyHistory.clearHistory(),this.currentSmarty.hideDropdown(),this.currentSmarty.runSearch(!1));R9.Analytics.api.trackEvent("smartyHistory/click/clearHistory")}});R9.extend("Common.SmartyHistory.prototype",{history:null,received:!1,options:{historyType:"flight",maxSearchHistory:30,searchHistorySubtype:"",showPastDates:R9.config.getBoolean("ui.smarty-history.showPastDates",!1)},init:function(){this.received&&
null!==this.history||setTimeout(this.update.bind(this),1)},update:function(){var a=this;n({searchType:a.options.historyType,maxSearchHistoryNum:a.options.maxSearchHistory,searchHistorySubtype:a.options.searchHistorySubtype},function(c){if(c)for(a.history=c,a.processPastDates(),a.received=!0,c=0;c<a.history.length;c++)a.history[c].idx=c})},clearHistory:function(){this.history=[];var a=this;l.ajax({type:"POST",url:"/s/run/recentsearchhistory/clearhistory",data:{searchType:a.options.historyType},success:function(c){a.history=
[];R9.Analytics.api.trackEvent({category:"Smarty-History",action:"clear-history"})}})},matchWord:function(a,c){var b=a.indexOf(c);0!==b&&(b=a.indexOf(" "+c),-1<b&&(b+=1));return b},processPastDates:function(){var a=[];if(null!==this.history){for(var c=0;c<this.history.length;c++){var b=this.history[c],d=b.startDate||b.checkinDate,e=b.endDate||b.checkoutDate;if(d&&e){var d=new moment(d),e=new moment(e),g=new moment;d.isBefore(g,"day")||e.isBefore(g,"day")?this.options.showPastDates&&(b.isPast=!0,a.push(b)):
a.push(b)}}this.history=a}}});R9.extend("Common.SmartyHistory.SmartyFlightHistory.prototype",!0,R9.Common.SmartyHistory.prototype,{filter:function(a,c,b,d,e){b=b||Infinity;var g=[];if(null===this.history)return[];var h=[];if(c||""===e)h=this.history;else for(var f=0;f<this.history.length;f++){var k=this.history[f];k.departCode===e&&h.push(k)}h=this.filterByRoundTrip(h,d);if(""===a)return h.slice(0,b);for(e=0;e<h.length&&!(f=h[e],k=f.departShortName+" "+f.departAirportName.toUpperCase(),c||(k=f.destShortName+
" "+f.destAirportName.toUpperCase()),-1<this.matchWord(k.toUpperCase(),a.toUpperCase())&&(g.push(f),g.length>=b));e++);return this.filterByRoundTrip(g,d).slice(0,b)},filterByRoundTrip:function(a,c){if(null===a)return[];if(R9.config.getBoolean("ui.flight.smarty-history.separateRTOW",!1)){for(var b=[],d=0;d<a.length;d++){var e=a[d];e.isRoundTrip===c&&b.push(e)}return b}return a}});R9.extend("Common.SmartyHistory.SmartyHotelHistory.prototype",!0,R9.Common.SmartyHistory.prototype,{filter:function(a,c){c=
c||Infinity;var b=[];if(null===this.history)return[];if(""===a)return this.history.slice(0,c);for(var d=0;d<this.history.length;d++){var e=this.history[d],g=e.location.toUpperCase();if(-1<this.matchWord(g,a)&&(b.push(e),b.length>=c))break}return b.slice(0,c)}});R9.extend("Common.SmartyHistory.SmartyCarHistory.prototype",!0,R9.Common.SmartyHistory.prototype,{filter:function(a,c,b,d){b=b||Infinity;var e=[];if(null===this.history)return[];var g=this.filterByOneWay(this.history,d);if(""===a)return g.slice(0,
b);for(var h=0;h<g.length;h++){var f=g[h],k=null===f.airportCode?f.location.toUpperCase():f.location.toUpperCase()+" "+f.airportCode;!c&&f.location2&&(k=null===f.airportCode2?f.location2.toUpperCase():f.location2.toUpperCase()+" "+f.airportCode2);if(-1<this.matchWord(k,a)&&(e.push(f),e.length>=b))break}return this.filterByOneWay(e,d).slice(0,b)},filterByOneWay:function(a,c){if(null===a)return[];for(var b=[],d=0;d<a.length;d++){var e=a[d];e.oneWay===c&&b.push(e)}return b}})})(jq||jQuery);(function(b){R9.extend("Common",{SmartyControlGroup:function(a){this.options=b.extend({},this.options,a);null===this.options.startFormat&&(this.options.startFormat=R9.Widgets.DaterangePicker.prototype.options.startFormat);null===this.options.endFormat&&(this.options.endFormat=R9.Widgets.DaterangePicker.prototype.options.endFormat);this.init()}});R9.extend("Common.SmartyControlGroup.prototype",{options:{form:"",smartyHistory:null,smartyTopDestinations:null,daterangePicker:"",startDate:"",endDate:"",
datePicker:"",startFormat:null,endFormat:null,useLegacyDatePicker:null},type:"flight",getHistory:function(){return this.options.smartyHistory&&this.options.smartyHistory()},getTopDestinations:function(){return this.options.smartyTopDestinations&&this.options.smartyTopDestinations()},getTime:function(a){return null==a?null:a.getTime()},validateDate:function(a){return null==a?null:this.datepicker().utils?this.datepicker().utils.validate(new Date(a)):this.options.datePicker&&this.options.datePicker.validateDate(a)?
new Date(a):null},datepicker:function(){return b(this.options.daterangePicker).data("datepicker")}});R9.extend("Common.SmartyControlGroup",{SmartyFlightControlGroup:function(a){R9.Common.SmartyControlGroup.call(this,a)},SmartyHotelControlGroup:function(a){R9.Common.SmartyControlGroup.call(this,a)},SmartyCarControlGroup:function(a){R9.Common.SmartyControlGroup.call(this,a)}});R9.extend("Common.SmartyControlGroup.SmartyFlightControlGroup.prototype",!0,R9.Common.SmartyControlGroup.prototype,{options:b.extend(R9.Common.SmartyControlGroup.prototype.options,
{form:null,formObject:null,originInput:"",destInput:"",originCode:"",destCode:"",daterangePicker:"",cabin:null,travelers:"",nearbyDeparture:"",nearbyArrival:"",smartyObject:"",maxHistory:5,state:null,isRoundTrip:null}),init:function(){this.type="flight"},setFieldsFromHistoryItem:function(a,c){a.isRoundTrip?(R9.events.publish("flights.search.form.display.change",{value:"roundtrip"}),R9.events.publish("flights.search.form.display.set","roundtrip")):(R9.events.publish("flights.search.form.display.change",
{value:"oneway"}),R9.events.publish("flights.search.form.display.set","oneway"));c&&!R9.config.getBoolean("ui.smarty.previewUpdatesForm.enabled",!1)||null==this.options.formObject||this.options.formObject.updateTravelDateState(this.validateDate(a.startDate),this.validateDate(a.endDate));this.options.useLegacyDatePicker?(this.datepicker().setStartDate(this.validateDate(a.startDate)),this.datepicker().setEndDate(this.validateDate(a.endDate))):(this.startDate().setDate(a.startDate),this.endDate().setDate(a.endDate));
b(this.options.nearbyDeparture).prop("checked",a.departureAllowNearby);b(this.options.nearbyArrival).prop("checked",a.arrivalAllowNearby);this.setTravelersFromHistoryItem(a);c?(b(this.options.originInput).val(a.departAirportName),b(this.options.destInput).val(a.destAirportName),b(this.options.originCode).val(a.departCode),b(this.options.destCode).val(a.destCode)):this.options.airportMultiSelectEnabled?(this.options.originField.resetAirportMultiSelect(),this.isMultiAirportOrigin(a)?this.options.originField.addAirportMultiSelections(this.getAirportMultiSelections(a.departAirportName)):
this.options.originField.addAirportMultiSelection(a.departCode,a.departAirportName,a.depSmartyDisplay),this.options.destField.resetAirportMultiSelect(),this.isMultiAirportDestination(a)?this.options.destField.addAirportMultiSelections(this.getAirportMultiSelections(a.destAirportName)):this.options.destField.addAirportMultiSelection(a.destCode,a.destAirportName,a.dstSmartyDisplay)):(c={type:"ap",id:a.departCode,short_str:a.departAirportName},this.options.originInput.getWidget().setItem(c),a={type:"ap",
id:a.destCode,short_str:a.destAirportName},this.options.destInput.getWidget().setItem(a))},saveFieldsToHistoryItem:function(){var a={};a.departAirportName=b(this.options.originInput).val();a.destAirportName=b(this.options.destInput).val();a.departCode=b(this.options.originCode).val();a.destCode=b(this.options.destCode).val();this.options.useLegacyDatePicker?(a.startDate=this.getTime(this.datepicker().getStartDate()),a.endDate=this.getTime(this.datepicker().getEndDate())):(a.startDate=this.startDate().getValue(),
a.endDate=this.endDate().getValue());a.departureAllowNearby=b(this.options.nearbyDeparture).prop("checked");a.arrivalAllowNearby=b(this.options.nearbyArrival).prop("checked");this.options.travelers&&b(".Common-Widgets-Number-NumberBox, .Common-Widgets-Number-StyleJamNumberBox",this.options.travelers.elementNode).each(function(){var c=b(this).getWidget(),e=b(this).attr("id").split("-").pop().toLowerCase();a[e]=c.getValue()});this.options.cabin&&(a.cabin=this.options.cabin.getValue());a.isRoundTrip=
"function"===typeof this.options.isRoundTrip?this.options.isRoundTrip():this.options.isRoundTrip;return a},isRoundTrip:function(){return"function"===typeof this.options.isRoundTrip?this.options.isRoundTrip():"checked"===b("#roundtrip").attr("checked")?!0:0<b(".inlineSearchAgainView").length&&"y"!==b('[name\x3d"oneway"]',".inlineSearchAgainView").val()?!0:!1},setTravelersFromHistoryItem:function(a){if(this.options.cabin){this.options.cabin.setButtonCheckedByValue(a.cabin);var c=this.options.cabin.getCheckedPair();
this.options.state.cabinDisplayType=c.title;this.options.state.cabin=c.value}this.options.travelers&&b(".Common-Widgets-Number-NumberBox, .Common-Widgets-Number-StyleJamNumberBox",this.options.travelers.elementNode).each(function(){var c=b(this).getWidget(),d=b(this).attr("id").split("-").pop().toLowerCase(),d=a[d];void 0!=c&&c.setValue(d)})},datepicker:function(){return this.options.daterangePicker},startDate:function(){return this.options.startDate},endDate:function(){return this.options.endDate},
setSmarty:function(a){this.options.smartyObject=a},getMaxHistory:function(){return this.options.maxHistory},isMultiAirportOrigin:function(a){return null===a.departCode&&3===a.departAirportName.indexOf(",")},isMultiAirportDestination:function(a){return null===a.destCode&&3===a.destAirportName.indexOf(",")},getAirportMultiSelections:function(a){var b=[];a.split(",").forEach(function(a){b.push({code:a,display:a,description:a})});return b},statusMessage:{adults:"{0} adult",seniors:"{0} senior",children:"{0} child",
traveler_count:"1#1 traveler|2#{0} travelers"}});R9.extend("Common.SmartyControlGroup.SmartyHotelControlGroup.prototype",!0,R9.Common.SmartyControlGroup.prototype,{options:b.extend(R9.Common.SmartyControlGroup.prototype.options,{form:null,locationInput:"",ctid:"",lmid:"",hid:"",nhid:"",rooms:"",adults:"",children:"",guests:"",minStars:"",priceRange:"",rating:"",smartyObject:"",maxHistory:5,isPTCEnabled:!1}),init:function(){this.type="hotel"},setSmarty:function(a){this.options.smartyObject=a},validateDate:function(a){return null==
a?null:this.options.daterangePicker.utils?this.options.daterangePicker.utils.validate(new Date(a)):this.options.datePicker?this.options.datePicker.validateDate(a):null},getMaxHistory:function(){return this.options.maxHistory},setFieldsFromHistoryItem:function(a,c){this.options.useLegacyDatePicker?(this.options.daterangePicker.setStartDate(this.validateDate(a.checkinDate)),this.options.daterangePicker.setEndDate(this.validateDate(a.checkoutDate))):(this.options.startDate.setDate(a.checkinDate),this.options.endDate.setDate(a.checkoutDate));
this.options.rooms&&this.options.rooms.setValue(a.rooms);this.options.isPTCEnabled?(this.options.adults.setValue(a.adults),this.options.children.setValue(a.children)):this.options.guests.setValue(a.guests);b(this.options.minStars).val(a.minStars);b(this.options.rating).val(Math.floor(a.rating/10));c?(b(this.options.locationInput).val(a.location),b(this.options.ctid).val(a.ctid),b(this.options.lmid).val(a.lmid),b(this.options.hid).val(a.hid),b(this.options.nhid).val(a.nhid),b(this.options.frid).val(a.frid),
b(this.options.rid).val(a.rid),b(this.options.cid).val(a.cid)):(a={id:a.ctid,str:a.location,lmid:a.lmid,hid:a.hid,nhid:a.nhid,frid:a.frid,rid:a.rid,cid:a.cid},this.options.locationInput.getWidget().setItem(a))},saveFieldsToHistoryItem:function(){var a={};a.location=b(this.options.locationInput).val();a.ctid=b(this.options.ctid).val();a.lmid=b(this.options.lmid).val();a.hid=b(this.options.hid).val();a.nhid=b(this.options.nhid).val();a.frid=b(this.options.frid).val();a.rid=b(this.options.rid).val();
a.cid=b(this.options.cid).val();this.options.useLegacyDatePicker?(a.checkinDate=this.getTime(this.options.daterangePicker.getStartDate()),a.checkoutDate=this.getTime(this.options.daterangePicker.getEndDate())):(a.checkinDate=this.options.startDate.getValue(),a.checkoutDate=this.options.endDate.getValue());this.options.rooms&&(a.rooms=this.options.rooms.getValue());this.options.isPTCEnabled?(a.adults=this.options.adults.getValue(),a.children=this.options.children.getValue()):a.guests=this.options.guests.getValue();
a.minStars=b(this.options.minStars).val();a.rating=Math.floor(10*b(this.options.rating).val());return a}});R9.extend("Common.SmartyControlGroup.SmartyCarControlGroup.prototype",!0,R9.Common.SmartyControlGroup.prototype,{options:{form:null,location:"",location2:"",ctid1:"",ctid2:"",datePicker:"",pickupDate:"",dropoffDate:"",locationSmarty:null,location2Smarty:null},init:function(){this.type="car"},setLocationSmarty:function(a){this.options.locationSmarty=a},setLocation2Smarty:function(a){this.options.location2Smarty=
a},getMaxHistory:function(){return this.options.maxHistory},datepicker:function(){return this.options.datePicker},validateDate:function(a){return null==a?null:this.options.datePicker?this.options.datePicker.validateDate(a):null},isOneWay:function(){return"function"===typeof this.options.isOneWay?this.options.isOneWay():"true"==b(".formType.active").attr("data-oneway")?!0:0<b(".inlineSearchAgainView").length&&"y"===b('[name\x3d"oneway"]',".inlineSearchAgainView").val()?!0:!1},setFieldsFromHistoryItem:function(a,
c){this.options.pickupDate.setDate(a.startDate);this.options.dropoffDate.setDate(a.endDate);this.options.pickupDate.setTime(a.pickupHour);this.options.dropoffDate.setTime(a.dropoffHour);c?(a.airportName?b(this.options.location).val(a.airportDisplayName):b(this.options.location).val(a.location),a.airportName2?b(this.options.location2).val(a.airportDisplayName2):b(this.options.location2).val(a.location2),b(this.options.ctid1).val(a.cityCode),b(this.options.ctid2).val(a.cityCode2)):(this.options.locationSmarty.setItem({id:a.cityCode,
str:a.airportDisplayName||a.location}),a={id:a.cityCode2,str:a.airportDisplayName2||a.location2},null!=this.options.location2Smarty&&null!=a&&null!=a.str&&this.options.location2Smarty.setItem(a))},saveFieldsToHistoryItem:function(){var a={};a.location=b(this.options.location).val();a.location2=b(this.options.location2).val();a.cityCode=b(this.options.ctid1).val();a.cityCode2=b(this.options.ctid2).val();a.startDate=this.options.pickupDate.getValue();a.endDate=this.options.dropoffDate.getValue();a.pickupHour=
this.options.pickupDate.getTime();a.dropoffHour=this.options.dropoffDate.getTime();return a}})})(jq||jQuery);(function(a,d){a.createWidgetClass("smarty.AirportSmarty","common.widgets.smarty.FlareSmarty",{constructor:function(e,b){var c={dropdownClass:" smartbox smartbox-air smartbox-v2 R9-Overlay ",extendRequest:{v:"v2"},flareSmartyType:13,forceSelection:!0,minWidth:250,searchOnFocus:!0};this.concatExtraDropdownClasses([c,b],this.extraIconClasses(a.config.getBoolean("ui.smarty.flights.greyIcons",!1)));this.base(e,d.extend(c,b))}})})(window.R9,window.jq||window.jQuery);(function(a,d){a.createWidgetClass("smarty.TrainSmarty","common.widgets.smarty.FlareSmarty",{constructor:function(e,b){var c={forceSelection:!0,dropdownClass:" smartbox smartbox-air R9-Overlay smartbox-v2 ",minWidth:250,searchOnFocus:!0,extendRequest:{v:"v2"}};this.concatExtraDropdownClasses([c,b],this.extraIconClasses(a.config.getBoolean("ui.smarty.trains.greyIcons",!0)));this.base(e,d.extend(c,b))}})})(window.R9,window.jq||window.jQuery);(function(d,e){function h(a,b){if(a)for(var c=0,d=a.childElementCount;c<d;c++)if(a.children){var g=b?a.children[d-c-1]:a.children[c],f=g;if((f&&null!==f.getAttribute("tabindex")&&""!==f.getAttribute("tabindex")&&"-1"!==f.getAttribute("tabindex")||-1<k.indexOf(f.tagName)||"INPUT"===f.tagName&&"hidden"!==f.getAttribute("type"))&&e(f).is(":visible")||(g=h(g,b)))return g}}var k=["SELECT","A","BUTTON","TEXTAREA"];d.createWidgetClass("dialog.Dialog",{content:null,contentBody:null,closeButton:null,modalBackground:null,
focusBoundaries:null,initialFocus:null,lastFocus:null,options:{fullHeight:!1,customWidth:!1,modal:!0,blur:!1,onClose:null,onOpen:null,afterClose:null,afterOpen:null,initialFocusId:null,preventInitialFocus:!1,closeOnModalClick:!0,hasKeyboardControl:!0,openImmediately:!1,preventClose:!1,returnFocus:!0,scrollToTopOnMobile:!0,forceOpen:!1,renderInline:!1,isMobile:!1,isOpenTopZindex:!1,iframeResize:!0,iframeTopGapPercent:.08,preventClosingClickBubble:!1},topLevelComponent:null,returnElement:null,init:function(){this.resizeEventName=
"resize."+this.id();this.content=this.getChildElement("content");this.contentBody=this.getChildElement("body");this.closeButton=this.getChildElement("close");this.modalBackground=this.getChildElement("modal");this.viewport=this.getChildElement("viewport");this.modal=this.getChildElement("modal");this.modalUniqueClass="modal-class-"+this.modal.attr("id")},addEventHandlers:function(){var a=this,b=this.closeOnModalClick.bind(this);this.options.preventClose||(this.options.hasKeyboardControl&&(this.registerEvent("keydown",
e(document),function(c){a.options.preventClose||c.which!==d.globals.keyCodes.ESC||a.close(!0)}),this.registerEvent("keypress",this.closeButton,function(c){if(!a.options.preventClose)switch(c.which){case d.globals.keyCodes.RETURN:a.close(!0)}})),this.registerEvent("click",this.closeButton,function(){a.options.preventClose||a.close(!0)}));this.options.closeOnModalClick&&this.registerEvent("click",this.viewport,b);this.registerEvent("click",this.content,function(){a.viewport.off("click",b);setTimeout(function(){if(a.options.closeOnModalClick)a.viewport.on("click",
b)},50)});this.subscribe("dialogs.close",function(){a.isOpen()&&a.close()});this.options.preventClosingClickBubble&&this.registerEvent("click",this.element,function(a){a.stopPropagation()})},inlineComponentsReady:function(){var a=this;this.options.modal||this.modalBackground.hide();this.topLevelComponent=this.contentBody.children("div").eq("0");this.options.renderInline&&e("body").append(this.element);this.options.openImmediately?(this.element.addClass("animate"),d.dom.schedule(this.open.bind(this))):
setTimeout(function(){a.element.addClass("animate")},100);this.getChildElement("focusStartBoundary").focus(this.resetFocus.bind(this,!1));this.getChildElement("focusEndBoundary").focus(this.resetFocus.bind(this,!0))},closeOnModalClick:function(a){a=e(a.target).closest(".content");this.content[0]===a[0]||this.options.preventClose||this.close(!0)},calculateDimensions:function(){if(this.topLevelComponent&&this.topLevelComponent.length){var a=this.topLevelComponent[0].getBoundingClientRect(),b=this.content[0].getBoundingClientRect(),
c="number"===typeof this.topLevelComponent.outerWidth()?Math.ceil(a.width):null,a="number"===typeof this.topLevelComponent.outerHeight()?Math.ceil(a.height):null;this.options.customWidth||c===Math.ceil(b.width)||this.content.width(c);this.options.fullHeight||a===Math.ceil(b.height)||this.content.height(a)}},resetFocus:function(a){(a=a?this.closeButton:this.lastFocus?this.lastFocus:this.findFirstFocusableElement(!0))&&"function"===typeof a.focus&&a.focus();return!1},handleKeyPress:function(a){switch(a.which){case d.globals.keyCodes.ESC:this.close(!0)}},
setContentDimensions:function(a,b,c){void 0!==a&&this.content.width(a);void 0!==b&&this.content.height(b);c&&this.content.css({maxWidth:c})},setViewPortOverflow:function(a,b){this.viewport&&this.viewport.length&&(a&&this.viewport.css({overflowX:a}),b&&this.viewport.css({overflowX:b}))},setContent:function(a){this.contentBody.html(a);this.topLevelComponent=this.contentBody.children("div").eq("0")},close:function(a){if(this.isOpen()&&!this.options.forceOpen){var b,c=e("body");this.isTouchDevice()&&
(b=c.css("top").replace("-","").replace("px",""),c.css({overflow:"",position:"",width:""}));this.options.iframeResize&&window.parentIFrame&&"function"===typeof window.parentIFrame.getPageInfo&&window.parentIFrame.getPageInfo(!1);c.scrollTop(b);this.element.removeClass("visible");this.element.attr("aria-hidden",!0);d.globals.testMode&&this.element.attr("data-test-popover-open",!1);if("function"===typeof this.options.onClose)this.options.onClose(this.element,a);d.events.publish("dialog.close",{id:this.id()});
this.options.blur&&d.events.publish("pageContainer.contentBlur",!1);c.removeClass(this.modalUniqueClass);0>c.attr("class").indexOf("modal-class-")&&c.removeClass("hideOverflow modal-open");this.returnElement&&this.returnElement.length&&(this.returnElement.focus(),this.returnElement=null);e(window).off(this.resizeEventName);"function"===typeof this.options.afterClose&&this.options.afterClose()}},open:function(a){if(!this.isOpen()){this.topLevelComponent&&0!==this.topLevelComponent.length||(this.topLevelComponent=
this.contentBody.children("div").eq("0"));this.options.preventClose&&this.closeButton.hide();this.options.returnFocus&&(this.returnElement=e(document.activeElement));if(this.options.isOpenTopZindex){var b=0;this.element.siblings("[role\x3ddialog]").each(function(){var a=parseInt(e(this).css("z-index"));a&&a>b&&(b=a)});0<b&&this.element.css("z-index",b+1)}d.events.publish(["common.dropdown.closeAll","common.widgets.tooltip.closeAll"]);this.element.addClass("visible");this.element.attr("aria-hidden",
!1);d.globals.testMode&&this.element.attr("data-test-popover-open",!0);null===this.initialFocus&&this.setFocusTargets();this.options.preventInitialFocus||this.focusInitialElement();this.options.iframeResize&&window.parentIFrame&&"function"===typeof window.parentIFrame.getPageInfo&&window.parentIFrame.getPageInfo(this.positionOnIframe.bind(this));if("function"===typeof this.options.onOpen)this.options.onOpen(this.element);"function"===typeof a&&a(this.element);this.modalBackground.length&&(e("body").addClass("hideOverflow modal-open"),
e("body").addClass(this.modalUniqueClass));this.options.blur&&d.events.publish("pageContainer.contentBlur",!0);null!==this.topLevelComponent&&setTimeout(this.calculateDimensions.bind(this),1);this.isTouchDevice()&&this.options.scrollToTopOnMobile&&e("body").css({overflow:"hidden",position:"fixed",width:"100%"});e(window).off(this.resizeEventName).on(this.resizeEventName,this.calculateDimensions.bind(this));"function"===typeof this.options.afterOpen&&this.options.afterOpen()}},positionOnIframe:function(a){if(a&&
this.viewport){var b=a.clientHeight*this.options.iframeTopGapPercent,c=a.scrollTop;a=a.offsetTop;this.content.addClass("no-margin");c<a?this.viewport.css("top",0):c-a<b?this.viewport.css("top",2*(c-a)+"px"):c-a+b+this.content.height()>=this.modal.height()?this.viewport.css("top",this.modal.height()-this.content.height()+"px"):this.viewport.css("top",c-a+Math.round(b)+"px")}},focusInitialElement:function(){var a=this;setTimeout(function(){var b=a.initialFocus&&a.initialFocus.get(0);b&&"function"===
typeof b.focus&&b.focus()},501)},setFocusTargets:function(){this.focusBoundaries=this.getChildElement("focusStartBoundary").add(this.getChildElement("focusEndBoundary"));this.initialFocus=this.findFirstFocusableElement(!1);this.lastFocus=this.findFirstFocusableElement(!0)},findFirstFocusableElement:function(a){if(this.options.initialFocusId&&!a)return e("#"+this.options.initialFocusId);a=h(this.contentBody[0],a);a||(a=this.closeButton);return e(a)},isOpen:function(){return this.element.hasClass("visible")},
isTouchDevice:function(){return"ontouchstart"in window||navigator&&navigator.maxTouchPoints},destroy:function(){this.base();this.element.remove()}})})(R9,jQuery);(function(c){R9.extend("Widgets",{Checkbox:function(a,b){this.elementNode=a;this.element=c(this.elementNode);this.icon=c(R9.Widgets.Checkbox.findIconNode(this.elementNode));this.validateElement()&&(this.options=c.extend({},this.options,b),this.init())}});R9.extend("Widgets.Checkbox",{isCheckbox:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"checkbox"==a.type.toLowerCase()},isWidgetControlled:function(a){return c(a).hasClass(R9.Widgets.Checkbox.prototype.widgetBaseClass+"-input")},
refresh:function(a,b){b=c(b);b[a.checked?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-checked");b[a.disabled?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-disabled")},findIconNode:function(a){return c(a).closest("[id$\x3d'-icon']")},findElementNode:function(a){return document.getElementById(a.id.substring(0,a.id.lastIndexOf("-icon")))}});R9.extend("Widgets.Checkbox.prototype",{widgetName:"checkbox",widgetBaseClass:"r9-checkbox",elementNode:null,
element:null,icon:null,options:{click:null,change:null},init:function(){this.bindInputClickEvent();this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.element.data(this.widgetName,this)},validateElement:function(){return R9.Widgets.Checkbox.isCheckbox(this.elementNode)&&R9.Widgets.Checkbox.isWidgetControlled(this.elementNode)},bindInputEvent:function(a,b){var c=this;a+="."+
this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,R9.Widgets.Checkbox.findIconNode(this),a)})},bindInputClickEvent:function(){this.bindInputEvent("click",this.handleElementClickEvent)},handleElementClickEvent:function(a,b,c){this.options.click&&this.options.click.apply(this,arguments)},handleElementChangeEvent:function(a,b,c){R9.Widgets.Checkbox.refresh(a,b);this.options.change&&this.options.change.apply(this,arguments)},handleElementFocusEvent:function(a,b,d){a.disabled||(c(b).addClass(this.widgetBaseClass+
"-state-focus"),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,b,d){a.disabled||(c(b).removeClass(this.widgetBaseClass+"-state-focus"),this.options.blur&&this.options.blur.apply(this,arguments))}})})(jq||jQuery);var FOCUSED_CLASS=R9.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");
(function(c){R9.createWidgetClass("checkbox.Checkbox",c.extend({},R9.Widgets.Checkbox.prototype,{isToggle:!1,options:{keydown:c.noop,click:null,change:null},init:function(){this.elementNode=this.element.get(0);this.element.parent().is(".toggle")&&(this.isToggle=!0);this.label=this.getChildElement("label")},addEventHandlers:function(){this.bindInputClickEvent();this.bindInputEvent("change",this._handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",
this.handleElementBlurEvent)},_handleElementChangeEvent:function(a,b,d){this.handleElementChangeEvent(a,b,d);b=c(a).prop("checked");a.setAttribute("aria-checked",b);this.label&&this.isToggle&&this.label.attr("aria-label",this.label.children(b?".on":".off").text())},setEnabled:function(a){a?this.element.removeAttr("disabled"):this.element.attr("disabled","disabled");this.element.attr("aria-disabled",!a);R9.Widgets.Checkbox.refresh(this.element,this.icon)},getValue:function(){return this.element.prop("checked")},
setChecked:function(a){this.element.prop("checked",a)},handleElementFocusEvent:function(){this.base();this.toggleFocusOutline(!0)},handleElementBlurEvent:function(){this.base();this.toggleFocusOutline(!1)},toggleFocusOutline:function(a){this.element.closest(".js-checkbox-container").toggleClass(FOCUSED_CLASS,a)}}))})(jq||jQuery);(function(h,e){function k(a){return null===a||"undefined"===typeof a}function n(a){return k(a)||"string"===typeof a&&""===a.trim()}var p=h.config.getBoolean("ui.horizon.flights.airportPicker.autoFocusOrigin",!1);h.createComponentClass("common.airportpicker.AirportPicker",{cacodeInputField:null,sbhintInputField:null,nearbyAirportsTable:null,customAirportMapDiv:null,radiusDropdown:null,submitButtonInput:null,dialog:null,locationSmarty:null,currentCallback:null,events:{open:"flights.airportpicker.open",
submit:"flights.airportpicker.submit"},init:function(){this.base.apply(this,arguments);this.options.events&&(this.events=e.extend(!0,{},this.events,this.options.events));this._setupLocale();this.prefetchDomElements();this.bindSmarty();this.bindRadius();this.bindDialog()},_setupLocale:function(){k(h.globals.locale)&&(h.globals.locale={lc_cc:"US",lc:"en"})},loadCustomAirports:function(){var a=this,b=function(a){var b={cacode:a.cacodeInputField.val(),calocation:a.locationInputVal(),sbhint:a.sbhintInputField.val(),
radius:a.radiusDropdown.getSelectedElement().value,maxAirports:a.options.maxAirportsSearch};n(b.calocation)&&(b.calocation="",b.cacode="");"train"===a.options.searchType&&(b.trainsOnly="true");return b}(this);2===arguments.length&&(b.startcode=arguments[0],b.startlocation=arguments[1]);this.showLoader();jq.ajax({type:"GET",url:this.options.ajaxUrl,data:b,dataType:"json",cache:!1,success:function(b){a.updateDom(b)},error:function(a,b,d){alert(b)},done:function(){a.hideLoader()}})},addEventHandlers:function(a){this.base.apply(this,
arguments);var b=this;this.getChildElement("form").submit(function(a){a.preventDefault();return b.eventTriggers().submit()});this.subscribe(this.events.open,e.proxy(this.eventListeners().open,this))},eventListeners:function(){var a=this;return{open:function(b){k(b)||b.id!==a.id()||a.dialog.isOpen()||(a.updateDom(),a.sbhintInputField.val(b.hint),a.loadCustomAirports(b.code,b.location),a.currentCallback=b.callback,a.dialog.open())}}},eventTriggers:function(){function a(){if(!b.options.airportMultiSelectEnabled){var a=
b.getCheckedAirports().map(function(){return e(this).val()}).get().join(", "),c=b.sbhintInputField.val(),d=b.cacodeInputField.val();b.radiusDropdown.getValue();n(c)||(d=c);c=3<a.length?"C-"+d+"-"+b.radiusDropdown.getValue():a;return{id:b.id(),code:c,location:a}}var f=[];b.getCheckedAirports().each(function(){var a=e(this);f.push({code:a.val(),display:a.data("location"),description:a.data("name")})});return f}var b=this;return{submit:function(){try{var l=b.getAirportCheckCount();if(0>=l)throw b.options.msg.noAirportSelected;
if(l>b.options.maxAirportsSelect)throw b.options.msg.tooManyAirportsSelected;var c=a();h.events.publish(b.events.submit,c);"function"===typeof b.currentCallback&&b.currentCallback(c);b.dialog.close()}catch(d){alert(d)}}}},bindDialog:function(){var a=this,b=h.Common.Utils.throttle(200,function(){var b=900;window.innerWidth<b&&(b=window.innerWidth-40);a.findChildElement(".dialogContentContainer").width(b);a.dialog.calculateDimensions()});this.dialog=this.getChildElement("dialog").dialog({onOpen:function(){e(window).bind("resize",
b)},onClose:function(){e(window).unbind("resize",b)},preventInitialFocus:!p,initialFocus:a.id("calocation")}).getWidget()},bindSmarty:function(){var a=this,b={dataSource:a.options.smartyUrl,flareSmartyType:a.options.flareSmartyType,v:"v2",clearItem:function(){},setItem:function(b,c,d){setTimeout(function(){b.elementNode.value=c.str;a.cacodeInputField.val(c.id);var f=!1,d="",g="";switch(c.type){case "ap":case "apnc":case "city":case "rail":f=c.id.split("/");1<f.length&&(c.id=f[1],g=c.id);f=!0;break;
case "freereg":d="F:%s".format(c.frid);break;case "reg":d="R:%s".format(c.rid);break;case "ctry":d="Y:%s".format(c.cid)}a.cacodeInputField.val(g);a.sbhintInputField.val(d);a.updateRadiusVisibility(f);a.loadCustomAirports()},1)}};this.locationSmarty="train"===this.options.searchType?this.getChildElement("calocation").trainSmarty(b).getWidget():this.getChildElement("calocation").flightSmarty(b).getWidget()},bindRadius:function(){var a=this;this.radiusDropdown=this.getChildElement("radius").dropdown({change:function(){a.loadCustomAirports()}}).getWidget()},
prefetchDomElements:function(){this.cacodeInputField=this.getChildElement("cacode");this.sbhintInputField=this.getChildElement("sbhint");this.nearbyAirportsTable=this.getChildElement("nearbyAirportsTable");this.customAirportMapDiv=this.getChildElement("customAirportMapDiv");this.submitButtonInput=this.getChildElement("submit")},updateDom:function(a){var b="",l="",c="",d=!1,f=!1,e=!1,g=[],h,m;k(a)||(b=a.calocation,l=a.cacode,c=a.sbhint,m=a.radius,k(a.nearbyAirports)||(d=a.nearbyAirports.hasDistance,
f=a.nearbyAirports.hasDriveTime,e=a.nearbyAirports.hasTransitTime,g=a.nearbyAirports.nearbyAirportsList),k(a.customAirportMap)||(h=a.customAirportMap));this.updateRadius(m);this.updateSmartyInputs(b,l,c);this.updateTable(d,f,e,g);this.updateMap(h);this.dialog.calculateDimensions()},updateRadius:function(a){n(a)&&(a=this.radiusDropdown.element.find("option[selected]").val());this.radiusDropdown.setValue(a)},updateRadiusVisibility:function(a){if(1>arguments.length){var b=self.sbhintInputField.val();
a=!n(b)}this.findChildElement(".gridCellRadius")},updateSmartyInputs:function(a,b,e){this.locationInputVal(a);this.cacodeInputField.val(b);this.sbhintInputField.val(e)},updateTable:function(a,b,l,c){function d(a,b,c,d){a=h.template.renderElement("airportItemRow",{airportName:d.airportName,longAirportName:d.longAirportName,airportLocation:d.airportLocation,airportDistance:d.localizedDistance,airportDriveTime:b?d.localizedDriveTimeAway:void 0,airportTransitTime:c?d.localizedTransitTimeAway:void 0,rank:d.rank,
airportCode:d.airportCode,markerText:d.markerText});d="cb"+d.airportCode;d=e(a).find("#"+d).checkbox({change:k.bind(g)}).getWidget();(function(a,b){b.element.attr("aria-label",f(a));a.click(function(a){b.element.parent().find(a.target)||b.element.trigger("click")})})(a,d);return a}function f(a){return a.find(".airportItemNameCol").text()+". "+a.find(".airportItemDistanceCol").text()}function k(){0>=g.getAirportCheckCount()||3<g.getAirportCheckCount()?(g.submitButtonInput.addClass("disabled"),g.submitButtonInput.attr("aria-disabled",
!0)):(g.submitButtonInput.removeClass("disabled"),g.submitButtonInput.attr("aria-disabled",!1))}var g=this,n=this.nearbyAirportsTable.find("tbody");n.empty();var m=this.findChildElement(".customAirportsForm");if(0<c.length)for(m.addClass("resultsAvailable"),m=0;m<c.length;m++)n.append(d(a,b,l,c[m]));else m.removeClass("resultsAvailable");this.nearbyAirportsTable.toggleClass("noDriveTime",!b);this.nearbyAirportsTable.toggleClass("noTransitTime",!l);a?this.nearbyAirportsTable.removeClass("noDistance"):
this.nearbyAirportsTable.addClass("noDistance");k()},updateMap:function(a){function b(a){c.customAirportMapDiv.find(".airportPin").remove();k(a)||jq.each(a,function(a,b){a=h.template.renderElement("airportPin",{id:b.itemId,xCoord:b.xCoord+-12+"px",yCoord:b.yCoord+-25+"px",hoverText:b.hoverText,label:b.pinLabel});c.customAirportMapDiv.append(a)})}function l(){function a(a){a=e(a).attr("id").match(/^(row|pin)(.*)$/);return 3===a.length?a[2]:""}c.nearbyAirportsTable.find(".airportItemRow").off("mouseenter mouseleave").on("mouseenter mouseleave",
function(){var b=a(this);e("#pin"+b).toggleClass("active")});c.customAirportMapDiv.find(".airportPin").off("mouseenter mouseleave").on("mouseenter mouseleave",function(){var b=a(this);e("#row"+b).toggleClass("active")})}var c=this;k(a)||n(a.mapUrl)?(this.customAirportMapDiv.css("background-image",""),this.customAirportMapDiv.removeClass("mapAvailable"),b([])):(this.customAirportMapDiv.addClass("mapAvailable"),this.customAirportMapDiv.css("background-image","url("+a.mapUrl+")"),b(a.pinMarkers),l())},
getCheckedAirports:function(){return this.findChildElement(".airportCheck \x3e input:checked")},getAirportCheckCount:function(){return this.getCheckedAirports().length},showLoader:function(){this._loadingTimeout=setTimeout(e.proxy(function(){this.element.addClass("loading")},this),100)},hideLoader:function(){clearTimeout(this._loadingTimeout);this.element.removeClass("loading")},findChildElement:function(a){return this.dialog.element.find(a)},locationInputVal:function(){1===arguments.length&&(this.locationSmarty.elementNode.value=
arguments[0]);return this.locationSmarty.elementNode.value}})})(R9,jQuery);(function(d,f){function e(a){return null===a||"undefined"===typeof a||"string"===typeof a&&""===a.trim()}d.createComponentClass("flights.search.AnywhereSearchDialog",{formData:null,options:{autoAnywhere:!1},init:function(){this.dialog=this.getChildElement("dialog").dialog({}).getWidget();this.searchButton=this.getChildElement("search");this.exploreButton=this.getChildElement("explore")},addEventHandlers:function(){var a=this;this.subscribe("flights.search.AnywhereSearchDialog.open",function(c){a.formData=
c;a.options.autoAnywhere?a.openExplorePage():a.dialog.open()});this.subscribe("flights.search.AnywhereSearchDialog.close",function(){a.dialog.close()});this.searchButton.on("click",function(){d.events.publish("flights.search.AnywhereSearchDialog.search.click");a.dialog.close()});this.exploreButton.on("click",function(){d.events.publish("flights.search.AnywhereSearchDialog.explore.click");a.openExplorePage()})},openExplorePage:function(){var a=this.formData;if(null!==a){var c=["explore"];if(a.isMulticity){for(var b=
0;b<a.nrLegs&&(e(a["origincode"+b])||!e(a["destinationcode"+b]));b++);b<a.nrLegs&&c.push(a["origincode"+b])}else a.origincode&&c.push(a.origincode);window.open("/"+c.join("/"));this.dialog.close()}}})})(R9,jQuery);(function(f,q){function p(a){a=(a||"").split(",");for(var b=[],c=/^[A-Z0-9]{3}$/i,d=0;d<a.length;d++){var e=a[d].trim().toUpperCase();if(c.test(e))b.push(e);else return""}return b.join(",")}var r=/[0-9]+[fr]{1,2}/;f.publish("flights.search.FlightSearchFormUrls",{generateRtowFlightsUrl:function(a,b,c,d){var e=this._createSegmentsArray(b);if(null!=a)if(e.push(this._generateLeg(a,b,c)),"anywhere"!==b&&"continents"!==b)e.push(this._generateCabinClass(a.cabinClass)),e.push(this._generateTravelers(a.adults,
a.seniors,a.youth,a.child,a.seatInfants,a.lapInfants,a.students)),e.push(this._generateBaggageCount(a.baggageCount));else if(f.config.getBoolean("ui.explore-dropdown-on-ffd.enabled",!0)||f.config.getBoolean("ui.explore.ffd.use.exact.dates",!1))return this._generateExploreUrl(a,e);return this.appendFilterStateParam(this._createUrlFromSegments(e,a&&a.relativeUrl,a&&a.hostUrl),d)},generateExploreDestinationUrl:function(a){var b="explore/"+a.origincode+"-"+a.destinationcode,c=a.depart_date_canon,d=a.return_date_canon;
c&&d&&(c=moment(c).format("YYYYMMDD"),d=moment(d).format("YYYYMMDD"),b=b+"/"+c+","+d);a.stops&&(b+="?"+a.stops);return b},appendFilterStateParam:function(a,b){if(!b||q.isEmptyObject(b)||!f.config.getBoolean("ui.flights.searchUrlFS.enabled",!0))return a;var c=[];Object.keys(b).each(function(a){a&&"string"===typeof b[a]&&""!==b[a]&&c.push(a+"\x3d"+b[a])});if(c.length){var d=-1<a.indexOf("\x26")?"\x26":"?";return a+d+"fs\x3d"+c.join(";")}return a},_generateExploreUrl:function(a,b){a.anywhereRange&&"none"!==
a.anywhereRange&&b.push(a.anywhereRange);b=this._createUrlFromSegments(b,a.relativeUrl);var c=[];a.anywhereDuration&&"none"!==a.anywhereDuration&&c.push("tripduration\x3d"+a.anywhereDuration);a.exploreLengthOfStay&&(-1!==a.exploreLengthOfStay.indexOf("-")?c.push("tripdurationrange\x3d"+a.exploreLengthOfStay.replace("-",",")):c.push("tripdurationrange\x3d"+a.exploreLengthOfStay+","+a.exploreLengthOfStay));a.anywhereOccasion&&"none"!==a.anywhereOccasion&&c.push("occ\x3d"+a.anywhereOccasion);c.length&&
(b+="?"+c.join("\x26"));return b},generateMultiCityFlightsUrl:function(a,b,c){var d=this._createSegmentsArray(),e=[];if(null!=a){for(var f=0;f<b;f++)d.push(this._generateLeg(a.legData[f],"openflex",!0)),"legCabinClass"in a.legData[f]&&0<a.legData[f].legCabinClass.length&&e.push(a.legData[f].legCabinClass);0===e.length&&e.push(a.cabinClass);d.push(this._generateCabinClasses(e));d.push(this._generateTravelers(a.adults,a.seniors,a.youth,a.child,a.seatInfants,a.lapInfants,a.students))}return this.appendFilterStateParam(this._createUrlFromSegments(d,
a&&a.relativeUrl,a&&a.hostUrl),c)},_createSegmentsArray:function(a){switch(a){case "anywhere":case "continents":return["explore"];default:return[f.config.getString("ui.flights.searchUrlPath","flights").replace("/","")]}},_createUrlFromSegments:function(a,b,c){a=a.join("/").replace(/[/]{2,}/g,"/").replace(/\/$/g,"");if(!b&&((b=f.config.getString("ui.flights.searchSwitchHostUrl",""))&&(c=b),c))if(f.config.getString("ui.flights.searchSwitchHostUrl.trackAffiliate",!0)){c=c.replace(/^(.+?)\/*?$/,"$1");
b=f.globals.isSeo&&"undefined"!==typeof seoR9&&seoR9.placement?seoR9.placement:f.globals.placement;var d=f.globals.isSeo&&"undefined"!==typeof seoR9&&seoR9.affiliate?seoR9.affiliate:f.globals.affiliate;a=c+"/in?url\x3d"+encodeURIComponent((a.startsWith("/")?"":"/")+a)+"\x26a\x3d"+encodeURIComponent(d||"")+"\x26p\x3d"+encodeURIComponent(b||"")}else a=c+(a.startsWith("/")?"":"/")+a;return a},_generateLeg:function(a,b,c){var d=[],e="anywhere"===b||"continents"===b;e?a.destinationId?d.push(this._generateOriginAndDestination(a.originId,
a.originLocation,a.destinationId,a.destinationLocation,!1,!1)):d.push(this._getAirportCode(a.originId,a.origin_location)):(a.regionSearch&&d.push("region"),d.push(this._generateOriginAndDestination(a.originId,a.originLocation,a.destinationId,a.destinationLocation,a.includeNearbyOrigin,a.includeNearbyDestination)));if(e)a.departDate&&a.returnDate&&d.push([this._generateDate(a.departDate),this._generateDate(a.returnDate)].join());else if("weekend"!==b&&"openflex"!==b)b="plusminusthree"===b,d.push(this._generateDate(a.departDate,
a.plusMinusThreeDepart,b)),!0!==c&&d.push(this._generateDate(a.returnDate,a.plusMinusThreeReturn,b));else if("openflex"===b)!0!==c?(c=this._safeURLDate(a.openflexDepartDate||a.departDate),d.push(c),c&&(c=new Date(c),c.setDate(c.getDate()+30),a=a.openflexLengthOfStay||"",d.push(this._generateOpenFlexDate(this._safeURLDate(c),a.toString())))):(c=this._generateDate(a.departDate,a.plusMinusThreeDepart,"plusminusthree"===a.plusMinusThreeDepart),"a"!==a.departTime&&(c+=this._getTimeOption(a.departTime||
"")),d.push(c));else{if(!0===c)throw Error("Illegal state: can't use flex category 'weekend' on oneway trips");d.push(this._generateWeekend(a.weekendDepartDate,a.weekendDepart,a.weekendReturn))}return d.join("/")},_generateCabinClass:function(a){return"p"===a?"/premium":"b"===a?"/business":"f"===a?"/first":""},_generateBaggageCount:function(a){return a&&0<a?"/bags-"+a:""},_generateCabinClasses:function(a){var b=[];if("undefined"===typeof a||0===a.length)return"";var c;for(c=0;c<a.length;c++)-1===
b.indexOf(a[c])&&b.push(a[c]);if(1===b.length)return"p"===b[0]?"/premium":"b"===b[0]?"/business":"f"===b[0]?"/first":"";b="/";for(c=0;c<a.length;c++)0<c&&(b+=","),"e"===a[c]?b+="economy":"p"===a[c]?b+="premium":"b"===a[c]?b+="business":"f"===a[c]&&(b+="first");return b},_generateOpenFlexDate:function(a,b){return a+"-flexible-calendar-"+b.replace("-","to").replace(/ /g,"")},_getTimeOption:function(a){return"a"===a?"":"r"===a?"-early-morning":"m"===a?"-morning":"n"===a?"-afternoon":"e"===a?"-evening":
"l"===a?"-night":"-"+a+"h"},_generateDate:function(a,b,c){c="";null!=a&&(c=a,null!=b&&(c+=this._getFlexOption(b)));return c},_safeURLDate:function(a){if(!a)return"";if("string"===typeof a||a&&"object"===typeof a&&a.hasOwnProperty("_isAMomentObject"))a=new Date(a);return a&&"function"===typeof a.toISOString&&a.getTime()?a.toISOString().split("T",1)[0]:""},_generateTravelers:function(a,b,c,d,e,l,g){function h(a){a=parseInt(a,10);isNaN(a)&&(a=0);return a}function m(a,b){for(var c="",d=0;d<a;d++)c+="-"+
b;return c}var k=[];a=h(a);b=h(b);d=h(d);c=h(c);e=h(e);l=h(l);var n=-1;"undefined"!==typeof g&&(n=h(g));g=d+c+e+l;1<a||0<b||0<g?k.push(a+"adults"):1===a&&0<n&&k.push(a+"adults");0<b&&k.push(b+"seniors");0<n&&k.push(n+"students");0<g&&(g="children",a="17",f.config&&(a=f.config.getString("ui.ptc.youth.age","17")),g+=m(e,"1S"),g+=m(l,"1L"),g+=m(d,"11"),g+=m(c,a),k.push(g));return k.join("/")},_generateWeekend:function(a,b,c){var d="weekend";b=this._generateWeekendDays(b,c);a=a?a:"";"WEEKEND"!==a?(d+=
"/"+a.replace(/\//g,"-"),""!==b&&(d+="-"+b)):""!==b&&(d+="/"+b);return d},_generateWeekendDays:function(a,b){var c="";null==a||"FRIDAY_ANYTIME"===a&&"SUNDAY_ANYTIME"===b||(c=this._generateWeekendDay(a)+"-"+this._generateWeekendDay(b));return c},_generateWeekendDay:function(a){return"THURSDAY_ANYTIME"===a?"Thu":"THURSDAY_AM"===a?"Thu-AM":"THURSDAY_PM"===a?"Thu-PM":"FRIDAY_ANYTIME"===a?"Fri":"FRIDAY_AM"===a?"Fri-AM":"FRIDAY_PM"===a?"Fri-PM":"SATURDAY_ANYTIME"===a?"Sat":"SATURDAY_AM"===a?"Sat-AM":"SUNDAY_ANYTIME"===
a?"Sun":"SUNDAY_AM"===a?"Sun-AM":"SUNDAY_PM"===a?"Sun-PM":"MONDAY_ANYTIME"===a?"Mon":"MONDAY_AM"===a?"Mon-AM":"MONDAY_PM"===a?"Mon-PM":""},_generateOriginAndDestination:function(a,b,c,d,e,f){a=this._getAirportCode(a,b,e);c=this._getAirportCode(c,d,f);return a+"-"+c},_getAirportCode:function(a,b,c){if(null==a)return"";if(r.exec(a)||-1!==a.indexOf("cy")||-1!==a.indexOf("cg"))return a;var d=p(b)||p(a);if(d)return!0===c&&(d+=",nearby"),d;a=a.split("/")[0];if(""==a||0==a.indexOf("C-"))a=b.replace(/ /g,
""),-1!=a.indexOf("(")&&(b=a.match(/\(([A-Z]{3})\)/g),null!=b&&(a=b[0]));!0===c&&(a+=",nearby");return a},_getFlexOption:function(a){return"plusminusthree"===a?"-flexible":"plusminustwo"===a?"-flexible-2days":"plusminusone"===a?"-flexible-1day":"plusone"===a?"-flexible-1day-after":"minusone"===a?"-flexible-1day-before":""}})})(R9,jQuery);(function(d,h,g,m){var k=d.config.getString("ui.horizon.filters.delimiter","__"),n=function(a){switch(a){case "m":return"0400,1200";case "n":return"1200,1800";case "e":return"1800,2400"}return null},l=function(a){switch(a){case "0400,1200":return"m";case "1200,1800":return"n";case "1800,2400":return"e"}return null};d.publish("flights.search.RTOWFormController",m.extend({parent:null,originField:null,destinationField:null,daterangePicker:null,advancedDaterangePicker:null,openflexDaterangePicker:null,
openflexCalcReturnDate:null,openflexLengthOfStay:null,searchForm:null,searchFormWrapper:null,flexCategoryRadio:null,departDate:null,returnDate:null,datePicker:null,flexDatePicker:null,openFlexDatePicker:null,flexSignUp:null,flexSignIn:null,cleanDateModal:null,oneway:!1,initialized:!1,flexCat:"exact",state:{start_date:null,end_date:null,plusMinusThreeDepart:null,plusMinusThreeReturn:null,weekendDepartDate:null,weekendDepart:null,weekendReturn:null,nearby_origin:!1,nearby_destination:!1,origin:null,
originCode:null,destination:null,destinationCode:null},utils:null,constructor:function(a,b){this.state=h.extend(!0,{},this.state);this.parent=a;this.utils=b;this.initFields()},initFields:function(){this.originField=new d.flights.search.FlightAirportField(this.parent.getChildElement("origin"),{airportMultiSelectEnabled:this.parent.options.airportMultiSelect,initialAirportMultiSelections:this.parent.options.originAirportMultiSelections});this.destinationField=new d.flights.search.FlightAirportField(this.parent.getChildElement("destination"),
{airportMultiSelectEnabled:this.parent.options.airportMultiSelect,initialAirportMultiSelections:this.parent.options.destinationAirportMultiSelections});this.daterangePicker=this.parent.getChildElement("travelDates");this.advancedDaterangePicker=this.parent.getChildElement("flexTravelDates");this.openflexDaterangePicker=this.parent.getChildElement("flexDepartDate");this.openflexCalcReturnDate=this.parent.getChildElement("flexCalcReturnDate");this.openflexLengthOfStay=this.parent.getChildElement("flexLengthOfStay");
this.searchForm=this.parent.getChildElement("RTOWsearchform");this.searchFormWrapper=this.parent.element.find(".js-searchForm");this.flexCategoryRadio=this.parent.getChildElement("flexCat");this.departDate=this.parent.getChildElement("depart").getWidget();this.returnDate=this.parent.getChildElement("return").getWidget();this.datePicker=this.parent.getChildElement("datePicker").getWidget();this.flexDatePicker=this.parent.getChildElement("flexDatePicker").getWidget();this.openFlexDatePicker=this.parent.getChildElement("openFlexDatePicker").getWidget();
this.flexSignUp=this.parent.getChildElement("signup");this.flexSignIn=this.parent.getChildElement("login");this.departCol=this.parent.getChildElement("depart-col");this.returnCol=this.parent.getChildElement("return-col");this.datesCol=this.parent.getChildElement("dates-col");this.originCol=this.parent.getChildElement("origin-col");this.destCol=this.parent.getChildElement("dest-col");this.advancedSection=this.parent.getChildElement("advancedSection");this.advancedOpenButton=this.parent.getChildElement("advancedFilterToggleOn");
this.advancedCloseButton=this.parent.getChildElement("advancedFilterToggleOff");this.timesFilterWrapper=this.parent.getChildElement("timesFilterWrapper");this.parent.options.cleanCalendarEnabled&&(this.cleanDateModal=this.parent.getChildElement("dateRangeInput").data("dateModal"))},_extendRadionButton:function(a){a.setValue=function(a){this.element.find("input").each(function(){var b=h(this);b.val()===a?b.prop("checked",!0):b.prop("checked",!1)});d.Widgets.RadiobuttonSet.refresh(this.element)};a.setEnabled=
function(a,c){this.element.find("input").each(function(){var b=h(this);b.val()===a&&b.prop("disabled",!c)});d.Widgets.RadiobuttonSet.refresh(this.element)}},setOneWay:function(a){this.oneway=a;this.parent.options.useLegacyDatePicker?(this.daterangePicker.getWidget().setSingleDateMode(a),"undefined"!==typeof this.advancedDaterangePicker.getWidget()&&this.advancedDaterangePicker.getWidget().setSingleDateMode(a)):(this.getDatePicker().setDateMode(a?"single":"range",!0),"undefined"!==typeof this.flexDatePicker&&
this.flexDatePicker.setDateMode(a?"single":"range",!0));var b=this.flexCategoryRadio.getWidget();if("undefined"!==typeof b){var c=this.getFlexCategory();!0!==a||"weekend"!==c&&"openflex"!==c||(b.setButtonCheckedByValue("plusminusthree"),this.setFlexCategory("plusminusthree"));b.setButtonEnabledByValue("weekend",!a);b.setButtonEnabledByValue("openflex",!a)}this.searchForm.removeClass("oneway roundtrip");this.searchForm.addClass(a?"oneway":"roundtrip");this.parent.loadCompareToItems();this.setGridState(a?
"--oneway":"");this.parent.options.advancedFiltersEnabled&&(this.updateTakeoffFilterVisibility(1,this.oneway,!0),this.parent.swapClassesToggle(this.timesFilterWrapper,"AdvancedSection__Right--oneway","AdvancedSection__Right--roundtrip",this.oneway))},setGridState:function(a){var b=""===a?"--oneway":"";this.departCol.length&&this.returnCol.length&&(this.parent.swapClasses(this.departCol,"col-depart-date"+b,"col-depart-date"+a),this.parent.swapClasses(this.returnCol,"col-return-date"+b,"col-return-date"+
a));this.datesCol.length&&this.parent.swapClasses(this.datesCol,"col-date-range"+b,"col-date-range"+a);this.parent.swapClasses(this.originCol,"col-origin"+b,"col-origin"+a);this.parent.swapClasses(this.destCol,"col-destination"+b,"col-destination"+a)},getFlexCategory:function(){if("anywhere"===this.state.destinationCode)return"anywhere";if(this.cleanDateModal)return this.getDatePicker().getFlexCategory();if(this.parent.options.useFlexDatePicker&&this.datePicker&&this.datePicker.getFlexCategory)return this.datePicker.getFlexCategory();
var a=this.parent.getChildElement("plusMinus3Days");return this.searchFormWrapper.hasClass("advanced")?this.flexCat:a.length&&a.is(":visible")&&a.is(":checked")?"plusminusthree":"exact"},setFlexCategory:function(a){this.flexCat=a;h(".flexCatBlock",this.parent.element).removeClass("exact weekend plusminusthree openflex").addClass(a);this.parent.vsLog("flexdates/dayofweek/"+a);this.parent.gaLog("select-flextype",a)},bindFlexDisplayCat:function(){var a=this;"undefined"!==typeof this.flexCategoryRadio.styleJamRadioButtonSet&&
this.flexCategoryRadio.styleJamRadioButtonSet({change:function(b,c){a.setFlexCategory(b.value)}})},bindNearbyCheckboxes:function(){var a=this;this.utils.bindCheckbox(this.parent.getChildElement("nearbyOriginCheckRtow"),function(b){a.triggerChangeNearbyOrigin(b)});this.utils.bindCheckbox(this.parent.getChildElement("nearbyDestinationCheckRtow"),function(b){a.triggerChangeNearbyDestination(b)})},validate:function(){var a=[],a=a.concat(this.parent.getLocationValidationMessages(0,this.getOriginAirportCode(),
this.getDestinationAirportCode())),b=this.getFlexCategory();"anywhere"!==b&&(a="weekend"===b||"openflex"===b||this.oneway?a.concat(this.parent.getDateValidationMessages(0,!0,this.state.start_date)):a.concat(this.parent.getDateValidationMessages(0,!1,this.state.start_date,this.state.end_date)));return a=a.concat(this.parent.getTravelerValidationMessages())},isSameDayRoundtrip:function(){var a=g(this.state.start_date),b=g(this.state.end_date);return!this.oneway&&a.isValid()&&b.isValid()?a.isSame(b,
"day"):!1},originCodeVal:function(){1===arguments.length&&this.originField.code(arguments[0]);return this.originField.code()},getOriginAirportCode:function(){return this.utils.getMultipleAirportCodes(this.state.origin)||this.utils.getAirportCode(this.state.originCode)},originLocationVal:function(){1===arguments.length&&this.originField.val()!==arguments[0]&&this.originField.val(arguments[0]);return this.originField.val()},destinationCodeVal:function(){1===arguments.length&&this.destinationField.code(arguments[0]);
return this.destinationField.code()},getDestinationAirportCode:function(){return this.utils.getMultipleAirportCodes(this.state.destination)||this.utils.getAirportCode(this.state.destinationCode)},destinationLocationVal:function(){1===arguments.length&&this.destinationField.val()!==arguments[0]&&this.destinationField.val(arguments[0]);return this.destinationField.val()},serialize:function(){var a={},b=g(this.state.start_date),c=g(this.state.end_date);a.isMulticity=!1;var e=this.getFlexCategory(),f=
{};if(this.parent.options.useFlexDatePicker)switch(f=this.getDatePicker().getFlexDatesData("anywhere"===e),f.flex_category){case "exact":case "plusminusthree":b.isValid()&&(f.depart_date=b.format(d.globals.apiDateFormat));!this.oneway&&c.isValid()&&(f.return_date=c.format(d.globals.apiDateFormat));break;case "weekend":b.isValid()&&(g(b).startOf("month").isSameOrBefore(g())?f.weekend_depart_date="WEEKEND":f.weekend_depart_date=b.format("YYYY-MM-DD"));break;case "openflex":b.isValid()&&(f.openflex_depart_date=
b.toDate())}else f.flex_category=e,"exact"===e||"plusminusthree"===e?(b.isValid()&&(f.depart_date=b.format(d.globals.apiDateFormat)),!this.oneway&&c.isValid()&&(f.return_date=c.format(d.globals.apiDateFormat)),"plusminusthree"===e&&(f.depart_date_flex=this.state.plusMinusThreeDepart,this.oneway||(f.return_date_flex=this.state.plusMinusThreeReturn))):"weekend"===e?(f.weekend_depart_date=this.state.weekendDepartDate,f.weekend_depart=this.state.weekendDepart,f.weekend_return=this.state.weekendReturn):
"openflex"===e&&(f.openflex_depart_date=this.state.openflexDepartDate,f.openflex_length_of_stay=this.state.openflexLengthOfStay);h.extend(a,f);"anywhere"===e&&(this.parent.getChildElement("anymonth").length?(f=this.parent.getChildElement("anymonth").getWidget().getValue())?(a.depart_date_canon=f.split(",")[0],a.return_date_canon=f.split(",")[1],a.depart_date=g(a.depart_date_canon,"YYYYMMDD").format(d.globals.apiDateFormat),a.return_date=g(a.return_date_canon,"YYYYMMDD").format(d.globals.apiDateFormat)):
(this.state.start_date&&(a.depart_date=this.state.start_date.format(d.globals.apiDateFormat)),this.state.end_date&&(a.return_date=this.state.end_date.format(d.globals.apiDateFormat))):d.config.getBoolean("ui.explore-dropdown-on-ffd.enabled",!1)&&(a.anywhereRange=d.question.ask("ExploreFlexDatesDropdown.range"),a.anywhereDuration=d.question.ask("ExploreFlexDatesDropdown.duration"),a.anywhereOccasion=d.question.ask("ExploreFlexDatesDropdown.occasion")),d.config.getBoolean("ui.explore.ffd.use.exact.dates",
!1)&&null===a.explore_length_of_stay&&(a.depart_date_anywhere=g(this.state.start_date).format("YYYY-MM-DD"),a.return_date_anywhere=g(this.state.end_date).format("YYYY-MM-DD")));a.oneway=this.oneway;a.origin=a.origincode=this.getOriginAirportCode();a.origin_location=this.state.origin;a.origin_code=this.state.originCode;a.nearby_origin=this.state.nearby_origin;a.originMultiAirports=this.originField.getAirportMultiSelections();"anywhere"!==e&&(a.destination=a.destinationcode=this.getDestinationAirportCode(),
a.destination_location=this.state.destination,a.destination_code=this.state.destinationCode,a.nearby_destination=this.state.nearby_destination,a.destinationMultiAirports=this.destinationField.getAirportMultiSelections(),null!==this.utils.REGION_RX.exec(a.destination)?a.freeRegionId=parseInt(a.destination.replace(/[A-z]+/,"")):null!==/[0-9]+[r]{1,2}/.exec(a.destination)?a.regionId=parseInt(a.destination.replace(/[A-z]+/,"")):a.countrySearch=this.utils.isCountryOrCountryGroup(a.destination),b.isValid()&&
(a.depart_date_canon=g(this.state.start_date).format("YYYY-MM-DD")),!this.oneway&&c.isValid()&&(a.return_date_canon=g(this.state.end_date).format("YYYY-MM-DD")));this.parent.serializeTravelers(a);return a},initState:function(a){a=a||{};this.triggerChangeOrigin();this.triggerChangeDestination();this.triggerChangeDateRange();this.triggerChangeNearbyOrigin(a.nearby_origin,this.parent.options.isNearbyInSmarty);this.triggerChangeNearbyDestination(a.nearby_destination,this.parent.options.isNearbyInSmarty);
this.triggerChangeLengthOfStay(a.openflex_length_of_stay);this.parent.options.useFlexDatePicker&&"anywhere"!==a.flex_category&&this.getDatePicker().loadFlexData(a);this.parent.options.flexDatesSignUpPromoEnabled&&"exact"!==this.parent.options.flex_category&&(d.Analytics.api.trackEvent({category:"flexDatesSignUpPromo",action:"open",label:this.parent.options.flex_category}),this.flexCategoryRadio.getWidget().focusRadio())},onCmp2GoodToLoad:function(a){return d.config.getBoolean("ui.flights.form.cmp2.allPass",
!1)||!a||!a.hasOwnProperty("originLocation")&&!a.hasOwnProperty("destinationLocation")?!0:!!(a.originLocation&&a.originCode||a.destinationLocation&&a.destinationCode)},onChangeOrigin:function(a){this.allowAirportMultiSelect(a.originCodeType)?this.originField.addAirportMultiSelection(a.originCode,a.originLocation,a.originLocationDescription,"selection"):(this.originLocationVal(a.originLocation),this.originCodeVal(a.originCode));0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&this.originCodeVal(a.originLocation);
this.state.origin=this.originLocationVal()||"";this.state.originCode=this.originCodeVal()||"";a.refreshNearby&&this.parent.setNearbyWrapperVisibility(this.state.origin,".rtow .originBlock .nearbyWrapper")},triggerChangeOrigin:function(a){a=a||{};var b=h.extend({},this.parent.eventDataTemplate),c=this;b.originLocation=this.utils.valOrDefault(a.location,function(){return c.originLocationVal()});b.originLocationDescription=a.locationDescription;b.originCode=this.utils.valOrDefault(a.code,function(){return c.originCodeVal()});
b.originCodeType=a.codeType;b.refreshNearby=!(""===a.location&&""===a.code);b.item=a.smartyItem;b.odSwitch=a.odSwitch;b.isDestinationFocusSkipped=a.isDestinationFocusSkipped;d.events.publish(this.parent.events.rtowOrigin,b);b=h.extend({},b);b.legIndex=0;d.events.publish(this.parent.events.multiOrigin,b);a.location&&(this.parent.vsLog("location/origin"),this.parent.gaLog("select-origin"))},onChangeDestination:function(a){this.allowAirportMultiSelect(a.destinationCodeType)?(a.resetState&&this.destinationField.resetAirportMultiSelect(),
this.destinationField.addAirportMultiSelection(a.destinationCode,a.destinationLocation,a.destinationLocationDescription,"selection")):(this.destinationLocationVal(a.destinationLocation),this.destinationCodeVal(a.destinationCode));0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&this.destinationCodeVal(a.destinationLocation);this.state.destination=this.destinationLocationVal()||"";this.state.destinationCode=this.destinationCodeVal()||"";a.refreshNearby&&this.parent.setNearbyWrapperVisibility(this.state.destination,
".rtow .destinationBlock .nearbyWrapper");a.pulse&&this.pulseInputModal(this.destinationField)},triggerChangeDestination:function(a){a=a||{};var b=h.extend({},this.parent.eventDataTemplate),c=this;b.destinationLocation=this.utils.valOrDefault(a.location,function(){return c.destinationLocationVal()});b.destinationLocationDescription=a.locationDescription;b.destinationCode=this.utils.valOrDefault(a.code,function(){return c.destinationCodeVal()});b.destinationCodeType=a.codeType;b.refreshNearby=!(""===
a.location&&""===a.code);b.item=a.smartyItem;b.odSwitch=a.odSwitch;d.events.publish(this.parent.events.rtowDestination,b);b=h.extend({},b);b.legIndex=0;d.events.publish(this.parent.events.multiDestination,b);a.location&&(this.parent.vsLog("location/destination"),this.parent.gaLog("select-destination"))},onAirportPickerSubmit:function(a){this.originField.addAirportMultiSelections(a)},allowAirportMultiSelect:function(a){var b=this.parent.options.airportMultiSelect;a=a&&0===a.indexOf("ap");return b&&
a},validateDate:function(a){return this.parent.options.validateDateOnChange?d.Common.Utils.Date.validateCurrentDate(a):!0},onChangeDateRange:function(a){if(this.parent.options.useLegacyDatePicker){var b=this.daterangePicker.getWidget();b.setStartDate(a.startDate);b.setEndDate(a.endDate);0<this.advancedDaterangePicker.length&&(b=this.advancedDaterangePicker.getWidget(),b.setStartDate(a.startDate),b.setEndDate(a.endDate));0<this.openflexDaterangePicker.length&&(b=this.openflexDaterangePicker.getWidget(),
b.setStartDate(a.startDate),b=b.getStartDate())&&(b=g(b).add(1,"month").subtract(1,"day"),b=b.format("ddd M/D"),b=replaceArgs(this.parent.options.msg.openflexToDateWithLengthIntro,b),this.openflexCalcReturnDate.text(b))}else b=this.endDate(),"undefined"!==typeof a.startDate&&this.startDate(a.startDate),"undefined"!==typeof a.endDate?null!==a.endDate&&"undefined"!==typeof a.startDate&&g(a.startDate).isSameOrBefore(g(a.endDate))?this.endDate(a.endDate):this.endDate(null):null!==b&&"undefined"!==typeof a.startDate&&
b.isSameOrBefore(g(a.startDate))&&this.endDate(null),this.parent.options.flexMonthEnabled&&(b=g(b).add(1,"month").subtract(1,"day"),b=b.format("ddd M/D"),b=replaceArgs(this.parent.options.msg.openflexToDateWithLengthIntro,b),this.openflexCalcReturnDate.text(b));this.validateDate(a.startDate)&&(this.state.openflexDepartDate=a.startDate,this.state.start_date=a.startDate);this.validateDate(a.endDate)&&(this.state.end_date=a.endDate);this.parent.vsLog("dropoffdate");this.parent.gaLog("select-date","depart:"+
g(this.state.start_date).format("MMM Do YY")+", return:"+g(this.state.end_date).format("MMM Do YY"))},triggerChangeDateRange:function(a,b){var c=this,e=g(a);null!==a&&void 0!==a&&e.isValid()&&(a=e);e=g(b);null!==b&&void 0!==b&&e.isValid()&&(b=e);e=h.extend({},this.parent.eventDataTemplate);if(this.parent.options.useLegacyDatePicker){var f=this.daterangePicker.getWidget();e.startDate=this.utils.valOrDefault(a,function(){return f.getStartDate()});e.endDate=this.utils.valOrDefault(b,function(){return f.getEndDate()})}else e.startDate=
this.utils.valOrDefault(a,function(){return c.startDate()}),e.endDate=this.utils.valOrDefault(b,function(){return c.endDate()});d.events.publish(this.parent.events.rtowDateRange,e)},onChangeNearbyOrigin:function(a){this.utils.setCheckboxValue(this.parent.getChildElement("nearbyOriginCheckRtow"),a.includeNearbyOrigin);this.state.nearby_origin=a.includeNearbyOrigin},triggerChangeNearbyOrigin:function(a,b){var c=h.extend({},this.parent.eventDataTemplate),e=this;c.includeNearbyOrigin=this.utils.valOrDefault(a,
function(){var a=e.parent.getChildElement("nearbyOriginCheckRtow");return 1>a.length?!1:a[0].checked});d.events.publish(this.parent.events.rtowNearbyOrigin,c);b&&this.originField.inputEl.getWidget().setIsNearbyChecked(c.includeNearbyOrigin);this.parent.vsLog("location/addnearby/"+(c.includeNearbyOrigin?"on":"off"));this.parent.gaLog("add-nearby",c.includeNearbyOrigin?"on-"+this.originLocationVal():"off-"+this.originLocationVal())},onChangeNearbyDestination:function(a){this.utils.setCheckboxValue(this.parent.getChildElement("nearbyDestinationCheckRtow"),
a.includeNearbyDestination);this.state.nearby_destination=a.includeNearbyDestination},triggerChangeNearbyDestination:function(a,b){var c=h.extend({},this.parent.eventDataTemplate),e=this;c.includeNearbyDestination=this.utils.valOrDefault(a,function(){var a=e.parent.getChildElement("nearbyDestinationCheckRtow");return 1>a.length?!1:a[0].checked});d.events.publish(this.parent.events.rtowNearbyDestination,c);b&&this.destinationField.inputEl.getWidget().setIsNearbyChecked(c.includeNearbyDestination);
this.parent.vsLog("location/addnearby/"+(c.includeNearbyOrigin?"on":"off"));this.parent.gaLog("add-nearby",c.includeNearbyDestination?"on-"+this.destinationLocationVal():"off-"+this.destinationLocationVal())},onChangeLengthOfStay:function(a){var b=this.parent.getChildElement("flexLengthOfStay");b.val()!==a.lengthOfStay&&b.val(a.lengthOfStay);this.state.openflexLengthOfStay=a.lengthOfStay},triggerChangeLengthOfStay:function(a){var b=h.extend({},this.parent.eventDataTemplate);b.lengthOfStay=a||"6-8";
d.events.publish(this.parent.events.rtowLengthOfStay,b)},onOriginDepartureSwitch:function(a){a=this.destinationField.val();var b=this.destinationField.code();if(d.config.getBoolean("ui.horizon.flights.smarty.od.switch.validate.enabled",!0)){var c=this.destinationField.code();/^\d+[r|fr|cy]+$|^any$|^[A-Z]{2}cg$/.test(c)&&(b=a="")}var c=this.originField.val(),e=this.originField.code();if(this.parent.options.airportMultiSelect){var f=this.originField.getAirportMultiSelections(),g=this.destinationField.getAirportMultiSelections();
this.originField.resetAirportMultiSelect();this.destinationField.resetAirportMultiSelect();f.length?this.destinationField.addAirportMultiSelections(f):(this.destinationField.val(c),this.destinationField.code(e));g.length?this.originField.addAirportMultiSelections(g):(this.originField.val(a),this.originField.code(b))}else this.originField.val(a),this.destinationField.val(c),this.originField.code(b),this.destinationField.code(e);this.triggerChangeDestination({odSwitch:!0});this.triggerChangeOrigin({odSwitch:!0});
this.triggerChangeDestination({odSwitch:!0});this.triggerChangeOrigin({odSwitch:!0});a=this.parent.getChildElement("nearbyOriginCheckRtow");b=this.parent.getChildElement("nearbyDestinationCheckRtow");a.is(":checked")!==b.is(":checked")&&(a.click(),b.click());this.parent.loadCompareToItems()},onOriginAdd:function(a){this.parent.options.airportMultiSelect&&this.originField.addAirportMultiSelections(a.airports)},onDestinationAdd:function(a){this.parent.options.airportMultiSelect&&this.destinationField.addAirportMultiSelections(a.airports)},
onSetPlusMinusThree:function(a){this.parent.options.useLegacyDatePicker||("plusminusthree"!==this.getFlexCategory()&&this.getDatePicker().changeFlexCategory("plusminusthree"),a.depart&&this.setFlexDepart(a.depart),a.return&&this.setFlexReturn(a.return),this.getDatePicker().publishFlexUpdate())},buildSearchURL:function(a,b){var c={originId:a.origin,destinationId:a.destination,originLocation:a.origin_location,destinationLocation:a.destination_location,includeNearbyOrigin:a.nearby_origin,includeNearbyDestination:a.nearby_destination,
cabinClass:a.cabin,baggageCount:a.baggageCount,departDate:a.depart_date_canon,returnDate:a.return_date_canon,plusMinusThreeDepart:a.depart_date_flex,plusMinusThreeReturn:a.return_date_flex,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,weekendDepartDate:a.weekend_depart_date,weekendDepart:a.weekend_depart,weekendReturn:a.weekend_return,openflexDepartDate:a.openflex_depart_date,openflexLengthOfStay:a.openflex_length_of_stay};d.config.getBoolean("ui.explore-dropdown-on-ffd.enabled",
!1)&&(c.anywhereDuration=a.anywhereDuration,c.anywhereOccasion=a.anywhereOccasion,c.anywhereRange=a.anywhereRange);d.config.getBoolean("ui.explore.ffd.use.exact.dates",!1)&&"anywhere"===a.flex_category&&(null!==a.explore_length_of_stay?c.exploreLengthOfStay=a.explore_length_of_stay:"undefined"===typeof c.returnDate&&"undefined"===typeof c.departDate&&(c.returnDate=g(a.return_date_anywhere).format("YYYYMMDD"),c.departDate=g(a.depart_date_anywhere).format("YYYYMMDD")));this.parent.options.showStudents&&
(c.students=a.students);this.utils.isEmpty(a.airlineFilter)||(c.airlineFilter=a.airlineFilter);c.regionSearch=this.parent.options.regionSearchEnabled&&a.destination&&(this.utils.REGION_RX.exec(a.destination)||this.utils.isCountryOrCountryGroup(a.destination));return d.flights.search.FlightSearchFormUrls.generateRtowFlightsUrl(c,this.getFlexCategory(),this.oneway,b)},bindAdvanced:function(){var a=this.parent,b=this;a.registerEvent("click",this.advancedOpenButton,function(){b.toggleAdvancedSection(!0);
a.gaLog("advancedFilter","open")});a.registerEvent("click",this.advancedCloseButton,function(){b.toggleAdvancedSection(!1);a.gaLog("advancedFilter","close")});var c=a.getChildElement("nonstopFilter");c.length&&(this.nonstopFilter=c.styleJamCheckbox({change:this.handleStopFilterChanged.bind(this)}).getWidget());c=a.getChildElement("basiceconFilter");c.length&&(this.basiceconFilter=c.styleJamCheckbox({change:this.handleCabinFilterChanged.bind(this)}).getWidget());d.events.when("inlineComponents.initialized",
function(){var b=a.getChildElement("timesFilterDepart"),c=a.getChildElement("timesFilterReturn");b.getWidget()&&(this.timesFilterDepart=b.getWidget(),this.timesFilterDepart.setOption("change",this.handleTakeoffFilterChanged.bind(this,0)));c.getWidget()&&(this.timesFilterReturn=c.getWidget(),this.timesFilterReturn.setOption("change",this.handleTakeoffFilterChanged.bind(this,1)))}.bind(this))},loadAdvancedFilterState:function(a){var b=a.cabin,c=a.takeoff,e=!1;"0"===a.stops&&this.nonstopFilter&&(this.nonstopFilter.setChecked(!0),
e=!0);b&&this.basiceconFilter&&"-"===b[0]&&-1<b.indexOf("bfbe")&&(this.basiceconFilter.setChecked(!0),e=!0);c&&(a=c.split(k),this.timesFilterDepart&&a[0]&&(b=l(a[0]))&&(this.timesFilterDepart.setValue(b,!1),e=!0),this.timesFilterReturn&&1<a.length&&a[1]&&(b=l(a[1]))&&(this.timesFilterReturn.setValue(b,!1),e=!0));e&&this.toggleAdvancedSection(!0)},handleStopFilterChanged:function(){this.nonstopFilter.getValue()?this.parent.searchFormFilterState.stops="0":delete this.parent.searchFormFilterState.stops;
this.parent.gaLog("advancedFilter","click/nonstop")},handleCabinFilterChanged:function(){this.basiceconFilter.getValue()?this.parent.searchFormFilterState.cabin="-bfbe":delete this.parent.searchFormFilterState.cabin;this.parent.gaLog("advancedFilter","click/basicecon")},handleTakeoffFilterChanged:function(a){this.updateTakeoffFilterState(a);this.parent.gaLog("advancedFilter","click/"+(0===a?"departTime":"returnTime"))},updateTakeoffFilterVisibility:function(a,b){var c=0===a?this.timesFilterDepart:
this.timesFilterReturn;c&&(this.parent.swapClassesToggle(c.element.parent(),"AdvancedSection__FilterSelect--hidden","AdvancedSection__FilterSelect--visible",b),this.updateTakeoffFilterState(a,b))},updateTakeoffFilterState:function(a,b){if(this.parent.searchFormFilterState){var c=0===a?this.timesFilterDepart:this.timesFilterReturn;if(c){var e=this.parent.searchFormFilterState.takeoff||"",d="";b||(d=n(c.getValue()));b=e.split(k);b=[b[0],1<b.length?b[1]:""];b[a]=d;a=b.join(k);1<a.length?this.parent.searchFormFilterState.takeoff=
a:delete this.parent.searchFormFilterState.takeoff}}},toggleAdvancedSection:function(a){this.parent.swapClassesToggle(this.advancedOpenButton,"AdvancedFilterToggle--visible","AdvancedFilterToggle--hidden",!a);this.parent.swapClassesToggle(this.advancedCloseButton,"AdvancedFilterToggle--visible","AdvancedFilterToggle--hidden",a);this.parent.swapClassesToggle(this.advancedSection,"AdvancedSection--visible","AdvancedSection--hidden",a)},bindFlexDatePicker:function(){this.parent.subscribe("DatePicker.update",
{updateGroup:"RTOWDates"},this.onFlexDatePickerUpdate.bind(this))},onFlexDatePickerUpdate:function(a){if(a.flex){switch(a.flex){case "plusminusthree":case "exact":this.searchFormWrapper.removeClass("show-flex-display");break;case "weekend":case "openflex":this.searchFormWrapper.addClass("show-flex-display")}this.parent.options.advancedFiltersEnabled&&(this.timesFilterDepart&&this.updateTakeoffFilterState(0,"weekend"===a.flex),this.timesFilterReturn&&this.updateTakeoffFilterState(0,"openflex"===a.flex||
"weekend"===a.flex))}},bindMultiAirportSelect:function(){var a=this;this.originField.setOptions({onChangeAirportMultiSelection:function(b){a.state.origin=b;a.state.originCode=b;a.triggerChangeOrigin()},onDisableNearbyToggle:function(){a.state.nearby_origin=!1}});this.destinationField.setOptions({onChangeAirportMultiSelection:function(b){a.state.destination=b;a.state.destinationCode=b;a.triggerChangeDestination()},onDisableNearbyToggle:function(){a.state.nearby_destination=!1}})},bindAll:function(){this.bindFlexDisplayCat();
this.parent.options.advancedFiltersEnabled&&this.bindAdvanced();this.parent.options.useFlexDatePicker&&this.bindFlexDatePicker();this.bindNearbyCheckboxes();this.parent.bindFlightSmartyFields({field:this.originField,isOrigin:!0,changeCallback:h.proxy(this.triggerChangeOrigin,this)});this.parent.bindFlightSmartyFields({field:this.destinationField,enableTopDestinations:!0,topDestinationOptions:{originField:this.originField},changeCallback:h.proxy(this.triggerChangeDestination,this)});this.parent.options.airportMultiSelect&&
this.bindMultiAirportSelect();if(this.parent.options.useLegacyDatePicker){var a=this.daterangePicker.add(this.advancedDaterangePicker).add(this.openflexDaterangePicker);this.parent.bindDaterangePicker(a,h.proxy(this.triggerChangeDateRange,this))}else this.parent.bindDaterangePicker(this.getDatePicker(),h.proxy(this.triggerChangeDateRange,this)),this.flexDatePicker&&this.parent.bindDaterangePicker(this.flexDatePicker,h.proxy(this.triggerChangeDateRange,this)),this.parent.options.flexMonthEnabled&&
this.openFlexDatePicker&&this.parent.bindDaterangePicker(this.openFlexDatePicker,h.proxy(this.triggerChangeDateRange,this));this.parent.subscribe(this.parent.events.rtowOrigin,this.parent.proxyEventCallback(this.onChangeOrigin,this,null,this.onCmp2GoodToLoad));this.parent.subscribe(this.parent.events.rtowDestination,this.parent.proxyEventCallback(this.onChangeDestination,this,null,this.onCmp2GoodToLoad));this.parent.subscribe(this.parent.events.rtowDateRange,this.parent.proxyEventCallback(this.onChangeDateRange,
this,null,this.onCmp2GoodToLoad));this.parent.subscribe(this.parent.events.rtowNearbyOrigin,this.parent.proxyEventCallback(this.onChangeNearbyOrigin,this));this.parent.subscribe(this.parent.events.rtowNearbyDestination,this.parent.proxyEventCallback(this.onChangeNearbyDestination,this));this.parent.subscribe(this.parent.events.rtowLengthOfStay,this.parent.proxyEventCallback(this.onChangeLengthOfStay,this));this.parent.subscribe("flights.search.swapLocations",{id:this.parent.id("originDepartureSwitch")},
this.onOriginDepartureSwitch.bind(this));this.parent.subscribe("flights.search.addOrigins",{id:this.parent.id()},this.onOriginAdd.bind(this));this.parent.subscribe("flights.search.addDestinations",{id:this.parent.id()},this.onDestinationAdd.bind(this));this.parent.subscribe("flights.search.setPlusMinusThree",{id:this.parent.id()},this.onSetPlusMinusThree.bind(this));this.parent.options.airportMultiSelect&&this.parent.subscribe("flights.airportpicker.submit",this.onAirportPickerSubmit.bind(this))},
getDatePicker:function(){return this.cleanDateModal||this.datePicker},focusDepartDate:function(){this.cleanDateModal?this.getDatePicker().focus("depart"):this.departDate.focus()},setFlexDepart:function(a){this.cleanDateModal?this.cleanDateModal.setFlexDepart(a):this.datePicker.plusMinusThreeDepart.setDate(a)},setFlexReturn:function(a){this.cleanDateModal?this.cleanDateModal.setFlexReturn(a):this.datePicker.plusMinusThreeReturn.setDate(a)},startDate:function(a){if(this.cleanDateModal)return this.cleanDateModal.departDate(a);
if("undefined"!==typeof this.departDate){if("undefined"===typeof a)return this.departDate.getDate();this.departDate.setDate(a)}},endDate:function(a){if(this.cleanDateModal)return this.cleanDateModal.returnDate(a);if("undefined"!==typeof this.returnDate){if("undefined"===typeof a)return this.returnDate.getDate();this.returnDate.setDate(a)}},setup:function(){this.bindAll();this.initialized=!0},teardown:function(){this.destinationField=this.originField=null},activate:function(){this.initialized||this.setup();
!0===this.oneway&&this.setOneWay(!0);this.searchForm.attr("aria-hidden","false");this.parent.swapClasses(this.searchForm,"SearchForm--hidden","SearchForm--visible")},pulseInputModal:function(a){(a=a&&a.inputEl&&a.inputEl.data?a.inputEl.data("inputModal"):null)&&a.pulseDisplay()},focusDestination:function(){this.destinationField.focusInput()}}))})(window.R9,window.jQuery,window.moment,window.base2.Base);(function(e,l,m,n){e.publish("flights.search.MulticityFormController",n.extend({parent:null,searchForm:null,addMoreLegsLink:null,clearAllLink:null,initialized:!1,indexLastVisibleLeg:!1,maxLegs:0,legState:{origin:"",destination:"",originCode:"",destinationCode:"",depart_date:null,depart_time:"a",cabin_type:"e",nearby_origin:!1,nearby_destination:!1},defaultLegState:null,backFromRP:!1,legStates:[],accessors:null,utils:null,constructor:function(a,b){this.parent=a;this.utils=b;this.initFields()},initFields:function(){this.searchForm=
this.parent.getChildElement("js-multiSearchform");this.addMoreLegsLink=this.parent.getChildElement("js-addMoreLegs");this.clearAllLink=this.parent.getChildElement("js-clearLegs");this.indexLastVisibleLeg=this.parent.options.backFromRP?this.parent.options.multicityOptions.length-1:this.parent.options.defaultLegsVisible-1;this.maxLegs=this.parent.options.maxLegs;this.defaultLegState=this.parent.options.multicityOptions;this.backFromRP=this.parent.options.backFromRP;this.accessors={}},removeLeg:function(a){for(;a<
(this.backFromRP?this.defaultLegState.length-1:this.maxLegs-1);a++)a<this.indexLastVisibleLeg?this.copyLeg(a+1,a):(this._legAccessor(a).visible(!1),this.setLegWidgetValues(a,this.legState));this.setLegWidgetValues(a,this.legState);this._legAccessor(a).visible(!1);--this.indexLastVisibleLeg;this.addMoreLegsLink.show();this.parent.vsLog("multicity/removeleg");this.parent.gaLog("clear-multicity")},addLeg:function(){this.indexLastVisibleLeg<this.maxLegs-1&&(this.indexLastVisibleLeg+=1,this.setLegWidgetValues(this.indexLastVisibleLeg,
this.legState),this._legAccessor(this.indexLastVisibleLeg).visible(!0));this.indexLastVisibleLeg>=this.maxLegs-1&&this.addMoreLegsLink.hide();this.parent.vsLog("multicity/addanotherflight");this.parent.gaLog("select-add-another-flight")},updateLegState:function(a){var b=this._legAccessor(a);a=this.legStates[a];a.origin=b.origin();a.originCode=b.originCode();a.destination=b.destination();a.destinationCode=b.destinationCode();a.depart_date=b.departDate();a.depart_time=b.departTime();a.cabin_type=b.cabinType();
a.nearby_origin=b.nearbyOrigin();a.nearby_destination=b.nearbyDestination()},setLegWidgetValues:function(a,b){var c=this._legAccessor(a);c.origin(b.origin);c.destination(b.destination);c.originCode(b.originCode);c.destinationCode(b.destinationCode);c.departDate(b.depart_date);c.departTime(b.depart_time);c.cabinType(b.cabin_type);c.nearbyOrigin(b.nearby_origin);c.nearbyDestination(b.nearby_destination);this.updateLegState(a)},copyLeg:function(a,b){a=this._legAccessor(a);var c=this._legAccessor(b);
c.origin(a.origin());c.destination(a.destination());c.originCode(a.originCode());c.destinationCode(a.destinationCode());c.departDate(a.departDate());c.departTime(a.departTime());c.cabinType(a.cabinType());c.nearbyOrigin(a.nearbyOrigin());c.nearbyDestination(a.nearbyDestination());this.updateLegState(b)},validate:function(){for(var a=[],b=0;b<=this.indexLastVisibleLeg;b++){var c=this._legAccessor(b);if(!1===this.isLegEmpty(c)||0===b)this.updateLegState(b),c=this.validateLeg(b),!0!==c&&(a=a.concat(c))}return a=
a.concat(this.parent.getTravelerValidationMessages())},validateLeg:function(a){var b=this.legStates[a];a+=1;var c=[],d=this.utils.getMultipleAirportCodes(b.origin)||this.utils.getAirportCode(b.originCode),g=this.utils.getMultipleAirportCodes(b.destination)||this.utils.getAirportCode(b.destinationCode),c=c.concat(this.parent.getLocationValidationMessages(a,d,g));return c=c.concat(this.parent.getDateValidationMessages(a,!0,b.depart_date,null))},serialize:function(){var a={};this.parent.serializeTravelers(a);
a.isMulticity=!0;for(var b=0,c=e.config.getBoolean("ui.flights.userhistory.usefulllocationcode",!0),d=e.config.getBoolean("ui.flights.mc.useMultiApCode",!0),g,h=0;h<=this.indexLastVisibleLeg;h++){var f=this._legAccessor(h);!1===this.isLegEmpty(f)&&(this.updateLegState(h),f=this.legStates[h],c?(a["origin"+b]=a["origincode"+b]=f.originCode,a["destination"+b]=a["destinationcode"+b]=f.destinationCode):(a["origin"+b]=a["origincode"+b]=this.utils.getAirportCode(f.originCode),a["destination"+b]=a["destinationcode"+
b]=this.utils.getAirportCode(f.destinationCode)),a["originLocation"+b]=f.origin,a["destinationLocation"+b]=f.destination,d&&((g=this.utils.getMultipleAirportCodes(f.origin))&&(a["origin"+b]=a["origincode"+b]=g),(g=this.utils.getMultipleAirportCodes(f.destination))&&(a["destination"+b]=a["destinationcode"+b]=g)),a["nearby_origin"+b]=f.nearby_origin,a["nearby_destination"+b]=f.nearby_destination,g=f.depart_date,a["depart_date"+b]=m(g).format(e.globals.apiDateFormat),a["depart_date_canon"+b]=m(g).format("YYYY-MM-DD"),
a["depart_time"+b]=f.depart_time,a["cabin_type"+b]=f.cabin_type,b+=1)}a.origin_location=a.originLocation0;a.origincode=a.origincode0;a.destination_location=a.destinationLocation0;a.destinationcode=a.destinationcode0;a.depart_date=a.depart_date0;a.nearby_origin=a.nearby_origin0;a.nearby_destination=a.nearby_destination0;a.nrLegs=b;return a},isLegEmpty:function(a){return this.utils.isEmpty(a.originCode())&&this.utils.isEmpty(a.destinationCode())&&this.utils.isEmpty(a.departDate())},buildSearchURL:function(a,
b){var c={cabinClass:a.cabin,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,legData:[]};this.parent.options.showStudents&&(c.students=a.students);for(var d=0;d<a.nrLegs;d++){var g={};g.originId=a["origin"+d];g.destinationId=a["destination"+d];g.originLocation=a["originLocation"+d];g.destinationLocation=a["destinationLocation"+d];g.includeNearbyOrigin=a["nearby_origin"+d];g.includeNearbyDestination=a["nearby_destination"+d];g.departDate=
a["depart_date_canon"+d];g.departTime=a["depart_time"+d];g.legCabinClass=a["cabin_type"+d];c.legData[d]=g}this.utils.isEmpty(a.airlineFilter)||(c.airlineFilter=a.airlineFilter);return e.flights.search.FlightSearchFormUrls.generateMultiCityFlightsUrl(c,a.nrLegs,b)},_legAccessor:function(a){this.accessors[a]||(this.accessors[a]=this._makeLegAccessor(a));return this.accessors[a]},_makeLegAccessor:function(a){function b(b){return d.getChildElement(b+a)}function c(a,b){if(!a||!a.length)return!1;void 0!==
b&&g.utils.setCheckboxValue(a,b);return a[0].checked}var d=this.parent,g=this,h=new e.flights.search.FlightAirportField(d.getChildElement("origin"+a)),f=new e.flights.search.FlightAirportField(d.getChildElement("destination"+a));return{originField:h,destinationField:f,origin:function(a){return this.originField.val(a)},destination:function(a){return this.destinationField.val(a)},originCode:function(a){return this.originField.code(a)},destinationCode:function(a){return this.destinationField.code(a)},
departDate:function(a){if(d.options.useLegacyDatePicker){var c=b("depart_date").getWidget();void 0!==a&&c.setStartDate(a);return c.getStartDate()}c=b("departDate").getWidget();void 0!==a&&c.setDate(a);return c.getDate()},departTime:function(a){var c=b("depart_time").getWidget();if(!c)return"";void 0!==a&&c.setValue(a);return c.getValue()},cabinType:function(a){var c=b("cabin_type").getWidget();if(!c)return"";void 0!==a&&c.setValue(a);return c.getValue()},nearbyOrigin:function(a){return c(b("nearbyOriginCheck"),
a)},nearbyDestination:function(a){return c(b("nearbyDestinationCheck"),a)},visible:function(a){var c=b("js-multiCityLeg");!1!==a?(c.removeClass("js-hiddenLeg"),c.find("input").first().focus(),d.swapClasses(c,"SearchForm--hidden","col-leg")):(c.addClass("js-hiddenLeg"),d.swapClasses(c,"col-leg","SearchForm--hidden"));return!c.hasClass("js-hiddenLeg")}}},setupLeg:function(a,b){function c(a,b){return 0<a?this._legAccessor(a-1).departDate().isSameOrBefore(b):!0}function d(a,b){var c=m(a._legAccessor(b).departDate());
if(null!=c)for(b+=1;b<f.options.maxLegs;b++){var d=a._legAccessor(b),p=m(d.departDate());null!=p&&p.isBefore(c)&&d.departDate(null)}}function g(b){var c,d;for(d=a-1;0<=d;d--)if(c=e._legAccessor(d).departDate(),null!=c){f.options.useLegacyDatePicker?b.minDate=c:b.setMinDate(c);break}}var h=this._legAccessor(a),f=this.parent,e=this;if(f.options.useLegacyDatePicker){var k=f.getChildElement("depart_date"+a);f.bindDaterangePicker(k,null,{getFormData:function(){var b=e.serialize();return{vertical:"flights",
origin:b["origincode"+a],destination:b["destinationcode"+a],isOneWay:b.oneway}},useDaysFormat:!0,singleDateMode:!0,singlePickerWithSingleField:!0,minDateFunc:g,change:function(){e.triggerChangeDepartDate(this.getStartDate(),a);d(e,a)},skipForceSetDefaultStartOnFocusBlur:!0});k.getWidget().singleDateMode=!0;if(0===a||null!=b.departDate)b.depart_date=null!=b.departDate?m(b.departDate):k.getWidget().getStartDate()}else if(k=f.getChildElement("departDate%s".format(a)).getWidget(),f.bindDaterangePicker(k,
null,{getFormData:function(){var b=e.serialize();return{vertical:"flights",origin:b["origincode"+a],destination:b["destinationcode"+a],isOneWay:b.oneway}},minDateFunc:g,change:function(b){e.triggerChangeDepartDate(b.date,a);d(e,a)},isValid:c.bind(this,a)}),0===a||null!=b.departDate)b.depart_date=null!=b.departDate?m(b.departDate):k.date;k=f.getChildElement("depart_time"+a);this.utils.bindDropdown(k,function(b){e.triggerChangeDepartTime(b.value,a);f.vsLog("multicity/choosetime/"+b.value);f.gaLog("select-multicitytime")});
this.utils.bindCheckbox(f.getChildElement("nearbyOriginCheck"+a),function(b){e.triggerChangeNearbyOrigin(b,a);f.vsLog("location/addnearby/"+(b?"on":"off"));f.gaLog("add-nearby",b?"on-"+h.origin():"off-"+h.origin())});this.utils.bindCheckbox(f.getChildElement("nearbyDestinationCheck"+a),function(b){e.triggerChangeNearbyDestination(b,a);f.vsLog("location/addnearby/"+(b?"on":"off"));f.gaLog("add-nearby",b?"on-"+h.destination():"off-"+h.destination())});k=f.getChildElement("cabin_type"+a);this.utils.bindDropdown(k,
function(b){e.triggerChangeLegCabinType(b.value,a);f.vsLog("multicity/chooselegcabintype/"+b.value);f.gaLog("select-multicitytlegcabintype")});["removeLegTop","removeLegBottom"].forEach(function(b){f.getChildElement(b+a).click(function(){e.triggerRemoveLeg(a)})},this);f.getChildElement("js-removeLeg"+a).click(function(){e.triggerRemoveLeg(a)});f.getChildElement("js-removeLegMobile"+a).click(function(){e.triggerRemoveLeg(a)});f.getChildElement("js-removeLegTablet"+a).click(function(){e.triggerRemoveLeg(a)});
var k=function(a,b){return function(c){b.triggerChangeOrigin({location:c.location,code:c.code,leg:a})}}(a,e),n=function(a,b){return function(c){b.triggerChangeDestination({location:c.location,code:c.code,leg:a})}}(a,e),q=function(a,b){return function(c){b.triggerChangeNearbyOrigin(c,a)}}(a,e),r=function(a,b){return function(c){b.triggerChangeNearbyDestination(c,a)}}(a,e);f.bindFlightSmartyFields({field:h.originField,isOrigin:!0,changeCallback:k,nearbyFormCallback:q,beforeStartCallback:function(a){var b=
null;a=a.inputEl.prop("id").match(/^.*?-(?:destination|origin)(\d+)/);2===a.length&&(a=parseInt(a[1]),0<a&&(b=e._legAccessor(a-1)));return function(a,c){a.elementNode.value||c&&(8===c.keyCode||46===c.keyCode)||!b||(c=h.originField.codeEl,a.elementNode.value=b.destination(),c.val(b.destinationCode()),a.elementNode.focus(),l(this).select())}},noHistory:!0,isMulticity:!0});f.bindFlightSmartyFields({field:h.destinationField,isOrigin:!1,changeCallback:n,nearbyFormCallback:r,noHistory:!0,isMulticity:!0});
e.setLegWidgetValues(a,b)},setup:function(){var a=this,b=this.parent;if(0===this.legStates.length)for(var c=0;c<this.maxLegs;c++)this.legStates.push(l.extend({},this.backFromRP&&c<this.defaultLegState.length?this.defaultLegState[c]:this.legState)),this.setupLeg(c,this.legStates[c]);this.searchForm.closest(".viewport").find(".content");this.addMoreLegsLink.click(function(b){a.triggerAddLeg();b.preventDefault?b.preventDefault():b.returnValue=!1});this.clearAllLink.keypress(function(b){b.preventDefault();
switch(b.which){case e.globals.keyCodes.SPACE:case e.globals.keyCodes.RETURN:a.clearAllLink.click()}});this.clearAllLink.click(function(b){for(var c=0;c<=a.indexLastVisibleLeg;c++){var d=a.legStates[c];d.origin="";d.originCode="";d.destination="";d.destinationCode="";d.depart_date="";d.depart_time="";d.cabin_type="";d.nearby_origin="";d.nearby_destination="";a.setLegWidgetValues(c,d)}b.preventDefault()});b.subscribe(b.events.multiOrigin,this.multiProxyEventCallback(this.onChangeOrigin,this));b.subscribe(b.events.multiDestination,
this.multiProxyEventCallback(this.onChangeDestination,this));b.subscribe(b.events.multiDepartDate,this.multiProxyEventCallback(this.onChangeDepartDate,this));b.subscribe(b.events.multiDepartTime,this.multiProxyEventCallback(this.onChangeDepartTime,this));b.subscribe(b.events.multiNearbyOrigin,this.multiProxyEventCallback(this.onChangeNearbyOrigin,this));b.subscribe(b.events.multiNearbyDestination,this.multiProxyEventCallback(this.onChangeNearbyDestination,this));b.subscribe(b.events.multiLegCabinType,
this.multiProxyEventCallback(this.onChangeLegCabinType,this));b.subscribe(b.events.multiRemoveLeg,this.multiProxyEventCallback(this.onRemoveLeg,this));b.subscribe(b.events.multiAddLeg,this.multiProxyEventCallback(this.onAddLeg,this));this.initialized=!0},multiProxyEventCallback:function(a,b){var c=this.parent;return c.proxyEventCallback(a,b,function(a){return c.id()===a.id||!0===c.options.sync&&(0===a.legIndex||c.options.mixedCabinsUI&&1===a.legIndex)},function(){return!1})},activate:function(){var a=
this.parent;this.initialized||this.setup();for(var b=0;b<this.indexLastVisibleLeg;b++)if("any"===this._legAccessor(b).destinationCode()){var c=this.legStates[b];c.destination="";c.destinationCode="";this.setLegWidgetValues(b,c)}this.searchForm.attr("aria-hidden","false");a.swapClasses(this.searchForm,"SearchForm--hidden","SearchForm--visible")},initState:function(){for(var a=0;a<(this.backFromRP?this.defaultLegState.length:this.maxLegs);a++)this.triggerChangeOrigin({location:void 0,code:void 0,leg:a}),
this.triggerChangeDestination({location:void 0,code:void 0,leg:a}),this.triggerChangeDepartDate(void 0,a),this.triggerChangeDepartTime(void 0,a),this.triggerChangeNearbyOrigin(void 0,a),this.triggerChangeNearbyDestination(void 0,a)},onChangeOrigin:function(a){var b=this._legAccessor(a.legIndex);b.origin(a.originLocation);b.originCode(a.originCode);0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&b.originCode(a.originLocation);a=this.legStates[a.legIndex];a.origin=b.origin();a.originCode=
b.originCode()},triggerChangeOrigin:function(a){a=a||{};var b=l.extend({},this.parent.eventDataTemplate),c=this._legAccessor(a.leg);b.originLocation=this.utils.valOrDefault(a.location,function(){return c.origin()});b.originCode=this.utils.valOrDefault(a.code,function(){return c.originCode()});b.legIndex=a.leg;b.refreshNearby=!(""===a.location&&""===a.code);b.isDestinationFocusSkipped=a.isDestinationFocusSkipped;e.events.publish(this.parent.events.multiOrigin,b);0===a.leg&&e.events.publish(this.parent.events.rtowOrigin,
b);a.location&&(this.parent.vsLog("location/origin"),this.parent.gaLog("select-origin"))},onChangeDestination:function(a){var b=this._legAccessor(a.legIndex);b.destination(a.destinationLocation);b.destinationCode(a.destinationCode);0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&b.destinationCode(a.destinationLocation);a=this.legStates[a.legIndex];a.destination=b.destination();a.destinationCode=b.destinationCode()},triggerChangeDestination:function(a){a=a||{};var b=l.extend({},
this.parent.eventDataTemplate),c=this._legAccessor(a.leg);b.destinationLocation=this.utils.valOrDefault(a.location,function(){return c.destination()});b.destinationCode=this.utils.valOrDefault(a.code,function(){return c.destinationCode()});b.legIndex=a.leg;b.refreshNearby=!(""===a.location&&""===a.code);e.events.publish(this.parent.events.multiDestination,b);0===a.leg&&e.events.publish(this.parent.events.rtowDestination,b);a.location&&(this.parent.vsLog("location/destination"),this.parent.gaLog("select-destination"))},
onChangeDepartDate:function(a){var b=this._legAccessor(a.legIndex);b.departDate(a.departDate);this.legStates[a.legIndex].depart_date=b.departDate()},triggerChangeDepartDate:function(a,b){var c=l.extend({},this.parent.eventDataTemplate),d=this._legAccessor(b);c.departDate=this.utils.valOrDefault(a,function(){return d.departDate()});c.legIndex=b;e.events.publish(this.parent.events.multiDepartDate,c)},onChangeDepartTime:function(a){var b=this._legAccessor(a.legIndex);b.departTime(a.departTime);this.legStates[a.legIndex].depart_time=
b.departTime()},triggerChangeDepartTime:function(a,b){var c=l.extend({},this.parent.eventDataTemplate),d=this._legAccessor(b);c.departTime=this.utils.valOrDefault(a,function(){return d.departTime()});c.legIndex=b;e.events.publish(this.parent.events.multiDepartTime,c)},onChangeLegCabinType:function(a){var b=this._legAccessor(a.legIndex);b.cabinType(a.cabinType);this.legStates[a.legIndex].cabin_type=b.cabinType()},triggerChangeLegCabinType:function(a,b){var c=l.extend({},this.parent.eventDataTemplate),
d=this._legAccessor(b);c.cabinType=this.utils.valOrDefault(a,function(){return d.cabinType()});c.legIndex=b;e.events.publish(this.parent.events.multiLegCabinType,c)},updateNonMcSearchFormCabinClasses:function(a){var b=this,c={};this.legStates.forEach(function(a,d){d=b._legAccessor(d);!b.isLegEmpty(d)&&a.cabin_type&&(c[a.cabin_type]=(c[a.cabin_type]||0)+1)});var d=Object.keys(c);if(0<d.length){var d=d.sort(function(a,b){return c[a]-c[b]}),g=d[d.length-1];1<d.length&&c[d[0]]===c[d[1]]&&(g=this.legStates[0].cabin_type);
e.events.publish(this.parent.events.cabinType,{cabinType:g,id:a.id},1<d.length&&c[d[0]]===c[d[1]])}},updateAllLegsToCabinType:function(a){var b=this;this.legStates.forEach(function(c,d){a.legIndex=d;b.onChangeLegCabinType(a)})},onChangeNearbyOrigin:function(a){var b=this._legAccessor(a.legIndex);b.nearbyOrigin(a.includeNearbyOrigin);this.legStates[a.legIndex].nearby_origin=b.nearbyOrigin()},triggerChangeNearbyOrigin:function(a,b,c){var d=l.extend({},this.parent.eventDataTemplate),g=this._legAccessor(b);
d.includeNearbyOrigin=this.utils.valOrDefault(a,function(){return g.nearbyOrigin()});d.legIndex=b;e.events.publish(this.parent.events.multiNearbyOrigin,d);c&&this._legAccessor(b).originField.getSmarty().setIsNearbyChecked(d.includeNearbyOrigin)},onChangeNearbyDestination:function(a){var b=this._legAccessor(a.legIndex);b.nearbyDestination(a.includeNearbyDestination);this.legStates[a.legIndex].nearby_destination=b.nearbyDestination()},triggerChangeNearbyDestination:function(a,b,c){var d=l.extend({},
this.parent.eventDataTemplate),g=this._legAccessor(b);d.includeNearbyDestination=this.utils.valOrDefault(a,function(){return g.nearbyDestination()});d.legIndex=b;e.events.publish(this.parent.events.multiNearbyDestination,d);c&&this._legAccessor(b).destinationField.getSmarty().setIsNearbyChecked(d.includeNearbyDestination)},onRemoveLeg:function(a){this.removeLeg(a.legIndex);this.parent.recalculateDialogDimensions()},triggerRemoveLeg:function(a){var b=l.extend({},this.parent.eventDataTemplate);b.legIndex=
a;e.events.publish(this.parent.events.multiRemoveLeg,b)},onAddLeg:function(a){this.addLeg();this.parent.recalculateDialogDimensions()},triggerAddLeg:function(){var a=l.extend({},this.parent.eventDataTemplate);e.events.publish(this.parent.events.multiAddLeg,a)},teardown:function(){this.accessors=null}}))})(window.R9,window.jQuery,window.moment,window.base2.Base);(function(c,d){var f=c.config.getBoolean("ui.horizon.searchForm.includePageTypeCookie",!0);c.createComponentClass("base.search.SearchForm",{vertical:null,searchForm:null,submitButton:null,errorContainer:null,searchFormFilterState:null,animationInterval:null,isFormChanged:!1,isScrollUserAction:!1,timers:{selectAll:null},options:{loadCmp2WhenVisible:!1,suppressCmp2s:!1,cleanUpInputFieldOnFocus:!1,useCmp2Submit:!0,navigateToResults:!1,pageOrigin:"",useHistory:!0,inlineErrorEnabled:!1,sync:!0,forceSearchFormSubmit:!1,
loggingPrefix:"",isSeo:!1,isCmp2Tooltip:!1,autofocusViaJs:!1,multiSearcherEnabled:!1,useSelectWidget:!1,useDialogQuestions:!1,displayDateFormat:"MMM D",enableSmartyRemoteHide:!1,hasSubscriptionPanel:!1,formChangedClass:"formChangedState",singlePulseAnimation:!1,showTopDestinations:!1,continents:[],smartyInnerScrollEnabled:!1,smartyUIUpdateEnabled:!1,searchFormFilterState:null,useStyleJamInlineSearchButton:!1,useMultipleSubmitIds:!1,searchAndScrollEnabled:!1,scrollLoggingEnabled:!1,isSEM:!1},scrollSearchToggleHeight:200,
didUpdateHistory:!1,localHistory:null,isSubmitted:!1,consentGranted:!1,init:function(a){this.searchForm=this.element.find(".searchform");this.submitButton=this.options.useMultipleSubmitIds?this.getChildElements("submit,submit-multi"):this.getChildElement("submit");this.errorContainer=this.getChildElement("error");this.searchFormFilterState=this.options.searchFormFilterState;this.options.searchAndScrollEnabled&&(a=this.element.parent(),this.scrollSearchToggleHeight=Math.min(a.offset().top+a.height(),
this.scrollSearchToggleHeight));var b=this;this.answer(this.id(),function(){return b.serialize()})},addEventHandlers:function(){var a=this;this.bindLocalHistory();this.bindSelectTextOnFocus();this.loadFromStorage();this.options.useStyleJamInlineSearchButton&&(this.registerEvent("click",this.submitButton,function(){a.searchForm.submit();return!0}),this.registerEvent("keyup",this.submitButton,function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.searchForm.submit()}));this.options.searchAndScrollEnabled&&
(this.subscribe("toggle.scroll.search.banner",this.toggleScrollSearchBanner.bind(this)),this.subscribe("submit.search.form",this.submitSearchForm.bind(this)));this.searchForm.on("submit",function(b){b.preventDefault();a.options.searchAndScrollEnabled&&a.logUserImpressionForScrollSearchBanner();a.isScrollUserAction&&!a.options.searchAndScrollEnabled&&(a._trackEvent("userSubmitAfterScroll","outsideScrollSearchXp","manual"),a.isScrollUserAction=!1);a.trackSubmitEvent();return a.onSubmit(b)});c.events.subscribe("search.form.clear",
d.proxy(this.onClear,this));c.events.subscribe("common.compareto.focusout",{id:this.id()+"-compareTo"},function(){a.submitButton.focus()});c.events.subscribe("search.form.button.enable",function(){a.enableSearchButton()})},enableSearchButton:function(){this.submitButton.prop("disabled",!1).attr("aria-disabled",!1);this.isSubmitted=!1},disableSearchButton:function(){this.submitButton.prop("disabled",!0).attr("aria-disabled",!0);this.isSubmitted=!0},inlineComponentsReady:function(){c.events.publish("searchform.initialized",
this);this.loadCompareToItems();if(this.options.autofocusViaJs){var a=this;setTimeout(function(){a.autofocus()},10)}},loadCompareToItems:function(){var a=this;if(!c.config.getBoolean("ui.cmp2.searchform.defer",!0)||!this.deferCmp2Id&&this.deferCmp2Init)if(this.isEnoughInformationForCompareToRequest()){var b=this.serialize()||{};b.relativeUrl=!0;var e=this.buildSearchURL(b);b.id=this.id();b.url=e;b.vertical=this.vertical;c.events.publish("cmp2.getItems",b);c.events.publish("search.form.clear",this.id())}else c.events.publish("cmp2.cleanUp",
{id:this.id()});else this.deferCmp2Init=1,this.deferCmp2Id&&clearTimeout(this.deferCmp2Id),this.deferCmp2Id=setTimeout(function(){clearTimeout(a.deferCmp2Id);a.deferCmp2Id=null;a.loadCompareToItems()},100)},shouldUpdate:function(a){a=a||{};return this.options.sync||this.id()===a.id},updateLogging:function(a){a.loggingPrefix&&a.loggingPrefix!==this.options.loggingPrefix&&(this.options.loggingPrefix=a.loggingPrefix)},getCompareToFormData:function(){return{}},isEnoughInformationForCompareToRequest:function(){return!1},
serialize:function(){return{tab:this.vertical,pageOrigin:this.options.pageOrigin,src:"",searchingAgain:"",c2s:"",po:"",personality:"",provider:"-1",searchFormFilterState:this.getSearchFormFilterState(),pageType:f?this.getPageType():null}},load:function(a){},buildSearchURL:function(a){},onClear:function(){this.clearErrors()},clearErrors:function(){this.errorContainer.html("")},validate:function(){return!1},isValid:function(){var a=this.validate();return!a||!a.length},showError:function(a){if(this.options.inlineErrorEnabled)if(0<
this.errorContainer.length)this.errorContainer.html(a),c.events.publish("search.submit.error",this.errorContainer);else throw"Missing container with id: "+this.id("error");else c.events.publish("error.alert",{messages:a})},onSubmit:function(a){if(this.isSubmitted)return!1;this.clearErrors();this.disableSearchButton();if((a=this.validate())&&a.length)return this.enableSearchButton(),this.showError(a),!1;this.saveToStorage(!0);c.storage.set("search_submit_pageId",c.globals.analytics.pageId);a=this.serialize()||
{};a.vertical=this.vertical;a.url=this._generate(a);a.id=this.id();this.triggerConsentGranted();var b=window["@r9/gdpr"];c.config.getBoolean("ui.horizon.common.gdpr.consent.v3.enabled",!1)&&b&&b.canShowConsentDialog()?c.events.publish("horizon.common.gdpr.showCustomizeDialog",function(a){this.publishSubmitEvent(a)}.bind(this,a)):this.publishSubmitEvent(a);c.config.getBoolean("ui.horizon.common.results.tooltip-reset.enabled",!0)&&c.events.publish("resultItem.alert.tooltip.reset");var e=this;setTimeout(function(){e.enableSearchButton()},
2500);return!1},triggerConsentGranted:function(){c.config.getBoolean("ui.gtm.useConsent",!1)&&c.config.getBoolean("ui.consent.submit.publish",!0)&&!this.consentGranted&&(this.consentGranted=!0,c.events.publish("consent.granted"))},notValidSubscription:function(){return!0===this.options.hasSubscriptionPanel?c.question.ask("email.subscription.validate."+this.id("subscription-panel")):!1},submitSubscription:function(){return!0===this.options.hasSubscriptionPanel?c.question.ask("email.subscription.submit."+
this.id("subscription-panel")):!0},publishSubmitEvent:function(a){var b;b=this.options.multiSearcherEnabled?"multilocale.search.submit":this.options.useCmp2Submit&&!this.options.forceSearchFormSubmit?"cmp2.submit":"searchform.submit";a.navigateToResults=this.options.navigateToResults;c.events.publish(b,a)},bindSelectTextOnFocus:function(){var a=this;this.searchForm.find("input.selectTextOnFocus").on("focus.selectAll",function(){a.selectInput(this)});var b=this.searchForm.find("input[autofocus]");
b.length&&a.selectInput(b.get(0))},selectInput:function(a){if(!d(a).data("disabledSelect")){var b=this;clearTimeout(this.timers.selectAll);this.timers.selectAll=window.setTimeout(function(){a.select();b.options.cleanUpInputFieldOnFocus&&(a.value="")},50)}},bindLocalHistory:function(){var a=this;this.didUpdateHistory=!1;this.localHistory=new c.common.utils.history.UserHistory({tab:a.vertical,persistLocalStorage:!0,onSave:function(){a.didUpdateHistory||a.saveToStorage(!1)}})},trackSubmitEvent:function(){c.Analytics.api.trackEvent("%s/searchform/submit".format(this.options.loggingPrefix))},
getCookieData:function(){var a=this.serialize(),b={page_origin:a.pageOrigin,src:a.src,searchingagain:a.searchingAgain,c2s:a.c2s,po:a.po,personality:a.personality,provider:a.provider};f&&(b.pageType=a.pageType);return b},getPageType:function(){var a;a=c.question.ask("SearchPage.view");a||(a=(a=c.globals.analytics&&c.globals.analytics.pageId)?"results"===a?"RP":"FD":data.pageOrigin.contains(".FD")?"FD":"RP");return a},getSearchFormFilterState:function(){return d.extend({},this.searchFormFilterState)},
_generate:function(a){a=this.buildSearchURL(a);this.setCookies(a);return a},setCookies:function(a){var b=this.getCookieData();b.id=this.id();c.events.publish("update.cookies",b);document.cookie=this._generateCookie(a,this.vertical,b)},_generateCookie:function(a,b,c){if(""!==a){b="/"+b+"/";var e=encodeURIComponent(a.substring(a.indexOf(b)+b.length));0>a.indexOf(b)&&(e=encodeURIComponent(a.substring(a.indexOf("/",1)+1)));a="hiddenParams"+e;b=new Date;e=b.getTime();b.setTime(e+3E4);c=encodeURIComponent(decodeURIComponent(d.param(c)));
return a+"\x3d"+c+"; expires\x3d"+b.toGMTString()+"; path\x3d/"}},getStorageProps:function(){return null},getStorageExceptions:function(){return null},loadFromStorage:function(){this.loadingHistory=!0;this.options.useHistory&&this.localHistory.wasLastUsedPage&&this.loadFromHistory(this.localHistory.getRecentHistory());this.loadingHistory=!1},loadFromHistory:function(a){this.load(d.extend({},{id:this.id()},a))},saveToStorage:function(a){this.didUpdateHistory=!0;if(a){a=this.serialize()||{};var b=this.getStorageProps()||
{},c=this.getStorageExceptions()||[],g={};b||(b=d.map(a,function(a,b){return b}));c&&d.map(c,function(a){a=d.inArray(a,b);0<=a&&b.splice(a,1)});for(c=0;c<b.length;c++)if(a.hasOwnProperty(b[c])){var h=b[c],f=a[h];this.localHistory.set(h,f);g[h]=f}d.isEmptyObject(g)||this.localHistory.pushSearchHistory(g)}},autofocus:function(){return null},isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return this.isNull(a)||this.isUndefined(a)||"string"===
typeof a&&""===a.trim()},destroy:function(){this.options.scrollLoggingEnabled&&d(window).off("scroll.logListener");null!==this.animationInterval&&clearInterval(this.animationInterval);this.base()},setFormChangedState:function(a){this.options.searchAndScrollEnabled&&(c.events.publish("form.changedState",{changed:a}),this._trackEvent("formChanged","stateChange",a));this.isFormChanged=a;!this.options.searchAndScrollEnabled&&this.options.scrollLoggingEnabled&&a&&this.enableScrollLoggingEvent();if(this.options.useStyleJamInlineSearchButton)return this.setStyleJamButtonActivation(a,
this.id("submit"));c.events.publish("button.formChangedState",{changed:a});this.element.toggleClass(this.options.formChangedClass,a);this.options.singlePulseAnimation&&this.submitButton.toggleClass("pulse",a)},setStyleJamButtonActivation:function(a,b){c.events.publish(a?"button.activate":"button.deactivate",{id:b});this.options.singlePulseAnimation&&c.events.publish(a?"button.pulse":"button.pulse.reset",{id:b})},checkAndSetDropdownSmartyInnerScrollOpts:function(a){this.options.smartyInnerScrollEnabled&&
(a.boundToScreen=!0)},checkAndSetSmartyUIUpdateOpts:function(a){this.options.smartyUIUpdateEnabled&&(a.extendRequest={f:"j"},a.dropdownClass+=" ui-update-v1",a.smartyUIUpdateEnabled=!0)},toggleScrollSearchBanner:function(){this.searchForm.is(":visible")&&c.events.publish("show.hide.scroll.search.banner",{showScrollSearchBanner:d(window).scrollTop()>this.scrollSearchToggleHeight&&this.isFormChanged})},submitSearchForm:function(){this._isFormChanged()&&this.searchForm.submit()},_isFormChanged:function(){return this.isFormChanged&&
this.searchForm.is(":visible")},logUserImpressionForScrollSearchBanner:function(){c.question.ask("was.user.shown.scrollSearch.banner")&&(this._trackEvent("userSubmitAfterSeeingScrollBanner","searchFormSubmit","manual"),c.events.publish("reset.scrollSearch.banner.shown"))},enableScrollLoggingEvent:function(){d(window).off("scroll.logListener").on("scroll.logListener",this.onScrollSearchEventLog.bind(this))},onScrollSearchEventLog:function(){c.dom.schedule(this.logUserScrollInteraction.bind(this))},
logUserScrollInteraction:function(){d(window).scrollTop()>this.scrollSearchToggleHeight&&this._isFormChanged()&&(this._trackEvent("scrollBeforeSubmit","outsideScrollSearchXp",d(window).scrollTop()),this.isScrollUserAction=!0,d(window).off("scroll.logListener"))},_trackEvent:function(a,b,d){c.Analytics.api.trackEvent({category:"searchForm",action:a,label:b,value:d})}})})(window.R9,window.jq||window.jQuery);(function(c,d,m){function u(a,b){a=t(a,b);b(a.getSelectedElement(),!0)}function t(a,b){var c;d(a).is(".Common-Widgets-Dropdown-StyleJamDropdown")?c=a.styleJamDropdown({change:function(){b(a.getWidget().getSelectedElement())}}).getWidget():d(a).is(".Common-Widgets-Select-StyleJamSelect")?(c=d(a).getWidget())&&c.setOption("change",function(){b(a.getWidget().getSelectedItem())}):c=a.dropdown({change:function(){b(a.getWidget().getSelectedElement())}}).getWidget();return c}function v(a,b){"boolean"===
typeof b&&a&&a[0]&&a[0].checked!==b&&a.click()}function w(a,b,c){if(a.length){var e=a.parent().is(".StyleJamCheckbox")?"styleJamCheckbox":"checkbox";a[e]({change:function(){b.call(c,this.checked)}})}}function p(a,b){return null===a||"undefined"===typeof a?"function"===typeof b?b():b:a}function q(a){return a&&(-1!==a.indexOf("cy")||-1!==a.indexOf("cg"))}function x(a){return null!=a?r.exec(a)||q(a)?a:a.split("/")[0]:""}function y(a){a=(a||"").split(",");for(var b=[],c=/^[A-Z0-9]{3}$/i,e=0;e<a.length;e++){var k=
a[e].trim().toUpperCase();if(c.test(k))b.push(k);else return""}return b.join(",")}function n(a){return a&&a.length}var r=/[0-9]+[fr]{1,2}/;c.createComponentClass("flights.search.StyleJamFlightSearchForm","base.search.SearchForm",{vertical:"flights",loggingPrefix:"Search-Form",formQuestion:"flights.fd.searchform",display:null,inline:!1,inlineViewOnly:!1,controllers:{},activeFormController:null,lapInfantWarning:null,travelerTypes:null,options:{cmp2LimitDisplay:!1,slideCMP2:!1,flareSmartyType:1,smartyUrl:"/mv/marvel",
autoOpenNextField:!1,showSmartyHistory:!1,isNearbyInSmarty:!1,allAirportsLocalizedText:"",airlineFilter:void 0,showAnywhere:!1,anywhereIfEmpty:!1,toggleLinks:!0,toggleSwap:!1,toggleField:!1,useMultiCityInFD:!1,multicityEnabled:!0,useLegacyDatePicker:!0,showAnywherePopupEnabled:!1,isFdForm:!1,regionSearch:!1,regionSearchEnabled:!1,autoNearbyEnabled:!1,mixedCabinsUI:!1,ajaxOrigin:!1,travelersAboveForm:!1,stageAreaEnabled:!1,stageDepartDefault:"",stageDepartOneWay:"",stageReturnDefault:"",stageReturnOneWay:"",
dialog:!1,focusIndicationClass:"",showFocusIndication:!1,regionDisplayAirportPicker:!1,useSwindle:!1,urlRedirectPath:"/",ignoreSticky:!1,isBusinessMode:!1,airportMultiSelect:!1,delayHistoryLoad:!1,newSearchHeaderDesign:!1,searchInNewTab:!1,searchAnywhereInNewTab:!0,originAirportMultiSelections:[],destinationAirportMultiSelections:[],mainSearchForm:!1,validateDateOnChange:!0,cleanCalendarEnabled:!1,redirectToExplore:!1},isRegionSearchSupported:!1,state:{travelers:0,cabin:"e",adults:0,seniors:0,child:0,
youth:0,seatInfant:0,lapInfant:0,students:0},eventDataTemplate:{id:null},events:{rtowOrigin:"flights.search.rtow.form.origin",rtowDestination:"flights.search.rtow.form.destination",rtowDateRange:"flights.search.rtow.form.dateRange",rtowNearbyOrigin:"flights.search.rtow.form.nearbyOrigin",rtowNearbyDestination:"flights.search.rtow.form.nearbyDestination",rtowLengthOfStay:"flights.search.rtow.form.lengthOfStay",multiOrigin:"flights.search.multi.form.origin",multiDestination:"flights.search.multi.form.destination",
multiDepartDate:"flights.search.multi.form.departDate",multiDepartTime:"flights.search.multi.form.departTime",multiNearbyOrigin:"flights.search.multi.form.nearbyOrigin",multiNearbyDestination:"flights.search.multi.form.nearbyDestination",multiLegCabinType:"flights.search.multi.form.legCabinType",multiAddLeg:"flights.search.multi.form.addLeg",multiRemoveLeg:"flights.search.multi.form.removeLeg",cabinType:"flights.search.rtow.form.cabinType",travelerCount:"flights.search.rtow.form.travelerCount",displayCat:"flights.search.rtow.form.displayCat",
searchError:"search.submit.error",stickyFormState:"flights.search.form.sticky.toggle"},travelerDialogClass:"Flights-Frontdoor-TravelersDialog-Content",stateInitialized:!1,defaultSeparateIconAndTextButtonClass:"SeparateIconAndTextButton",stickySeparateIconAndTextButtonClass:"SeparateIconAndTextButton--sticky",init:function(a){this.base.apply(this,arguments);this.options.slideCMP2&&(this.originCountry=this.options.originCountryCode);this.options.showAnywhere=this.options.showAnywhere&&!d(".Sem-Common-Layout-SEMStandardBody").length;
this.errorContainer.length||(this.errorContainer=d("."+this.id("error"),this.element));this.state=d.extend({},this.state);this.eventDataTemplate=d.extend({},this.eventDataTemplate);this.eventDataTemplate.id=this.id();this.display=this.options.display;!this.options.advancedFiltersEnabled&&!this.options.showBaggageDropdown||this.searchFormFilterState||(this.searchFormFilterState={});this.bindShowAirportMapLinks();this.bindDisplayCat();this.controllers=this.createSubControllers();this.bindOpenNextFieldEvents();
this.initActiveFormController();this.setupChildControllers();this.isRegionSearchSupported=-1<c.config.getString("ui.flights.smarty.regionEnabled","32,51,58,72,77").split(",").indexOf(""+this.options.flareSmartyType);this.lapInfantWarning=this.getChildElement("infantInLapWarning");this.studentCheckbox=this.getChildElement("student");this.studentCheckbox.length&&this.studentCheckbox.styleJamCheckbox()},inlineComponentsReady:function(){this.base.apply(this,arguments);this.initState();this.loadCompareToItems();
this.options.ajaxOrigin&&this.checkOriginForUpdate();c&&c.globals&&c.globals.isSeo&&this.checkForValidDates();this.loadSlideCMP2()},addEventHandlers:function(){this.base.apply(this,arguments);this.subscribe(["flights.frontdoor.form.all","cmp2.form.fill"],this.proxyEventCallback(this.onChangeTriggerData,this));this.subscribe(this.events.cabinType,this.proxyEventCallback(this.onChangeCabinType,this));this.subscribe(this.events.travelerCount,this.proxyEventCallback(this.onChangeTravelers,this));this.subscribe(this.events.displayCat,
this.proxyEventCallback(this.onChangeDisplayCat,this));this.subscribe(this.events.searchError,this.proxyEventCallback(this.onSearchError,this));var a=0;this.subscribe("flights.search.travelers.init."+this.id(),function(b){a++;!this.options.travelersAboveForm&&2!==a&&this.options.multicityEnabled||this.setupTravelersAndCabin()}.bind(this));var b=this;this.subscribe("DropdownDialog.open",function(a){var e=d(".FlightSearchDialogWidget");!e.length||a.id!==b.id("multi-travelers")&&a.id!==b.id("travelers")||
e.find(".viewport").animate({scrollTop:d("#"+a.id).offset().top-e.find(".content").offset().top+.12*e.find(".viewport").height()},500);a.id===b.id("travelersAboveForm-dialog")&&c.events.publish("flights.search.travelers.init.from.state",b.state)});this.subscribe("intentmedia.submit.handler",d.proxy(this.onHookSubmitForIntentMedia,this));this.subscribe("common.kn.Swindle.hook",d.proxy(this.onHookSubmitForKnSwindle,this));this.options.dialog||this.answer(this.formQuestion,function(){return b.serialize()});
this.subscribe("flights.search.AnywhereSearchDialog.search.click",function(){b.vsLog("/nodestination/click/search")});this.subscribe("flights.search.AnywhereSearchDialog.explore.click",function(){b.vsLog("/nodestination/click/anywhere")});this.subscribe("omni.vertical.changed",function(a){"flights"===a&&b.focusFirstElement()});this.studentCheckbox.getWidget()&&this.studentCheckbox.getWidget().setOption("click",function(){var a=this.getValue();b.vsLog("/student/"+(a?"checked":"unchecked"));window.setMetaCookie("isStudent",
a?"true":"false")});if(this.options.slideCMP2){var f=this;this.subscribe([this.events.cabinType,this.events.travelerCount,this.events.displayCat,this.events.searchError,this.events.rtowOrigin,this.events.rtowDestination,this.events.rtowDateRange,this.events.rtowNearbyOrigin,this.events.rtowNearbyDestination,this.events.rtowLengthOfStay,"flights.frontdoor.form.all","cmp2.form.fill"],function(){f.enableSearchButton()})}d(".js-addMoreLegs",this.element).on({mouseenter:function(){c.dom.swapClasses(d("button",
this),c.stylejam.common.widgets.button.StyleJamButton.plusButtonInactive,c.stylejam.common.widgets.button.StyleJamButton.plusButtonActive)},mouseleave:function(){c.dom.swapClasses(d("button",this),c.stylejam.common.widgets.button.StyleJamButton.plusButtonActive,c.stylejam.common.widgets.button.StyleJamButton.plusButtonInactive)}});this.getChildElement("js-removeLeg").on("click",function(a){var c=d(".js-multiCityLeg",b.element).not(".js-hiddenLeg").last().index();0!==c&&(b.controllers.multi.triggerRemoveLeg(c),
a=d(a.currentTarget),1===c?b.swapClasses(a,"SearchForm--visible","SearchForm--hidden"):b.swapClasses(a,"SearchForm--hidden","SearchForm--visible"))});this.subscribe("flights.search.multi.form.removeLeg",function(a){b.adjustFormClass.call(b);b.options.newSearchHeaderDesign&&c.events.publish("coverPhotoFullScreen.resize")});this.subscribe("flights.search.multi.form.addLeg",function(a){b.swapClasses(b.getChildElement("js-removeLeg"),"SearchForm--hidden","SearchForm--visible");b.adjustFormClass.call(b);
b.options.newSearchHeaderDesign&&c.events.publish("coverPhotoFullScreen.resize")});this.subscribe(this.events.stickyFormState,function(a){if(-1!==["rising","rising-mono-grey-without-large"].indexOf(b.options.presentation)){var f=b.getChildElement("origin-col"),e=b.getChildElement("dest-col"),h=b.getChildElement("dates-col");a?(c.dom.swapClasses(b.getChildElement("fields"),c.stylejam.flights.search.StyleJamFlightSearchForm.defaultFieldGrid,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyFieldGrid),
"roundtrip"===b.display||"multicity"===b.display?(d(f).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayOriginCol),c.dom.swapClasses(f,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOriginCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOriginCol),d(e).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDestCol),c.dom.swapClasses(e,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultDestCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyDestCol),
d(h).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDatesCol),c.dom.swapClasses(h,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultDatesCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyDatesCol)):"oneway"===b.display&&(d(f).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOriginCol),c.dom.swapClasses(f,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayOriginCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayOriginCol),
d(e).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyDestCol),c.dom.swapClasses(e,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayDestCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDestCol),d(h).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyDatesCol),c.dom.swapClasses(h,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayDatesCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDatesCol)),c.dom.swapClasses(b.submitButton,
c.stylejam.common.widgets.button.StyleJamButton.defaultSubmitBtn,c.stylejam.common.widgets.button.StyleJamButton.stickySubmitBtn),c.dom.swapClasses(b.getChildElement("col-button-wrapper"),c.stylejam.flights.search.StyleJamFlightSearchForm.defaultButtonCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyButtonCol),c.dom.swapClasses(b.getChildElement("col-switch"),c.stylejam.flights.search.StyleJamFlightSearchForm.defaultSwitchCol,c.stylejam.flights.search.StyleJamFlightSearchForm.stickySwitchCol),
b.options.newSearchHeaderDesign&&c.dom.swapClasses(b.submitButton,b.defaultSeparateIconAndTextButtonClass,b.stickySeparateIconAndTextButtonClass),b.getChildElement("compareToWrapper").hide(),c.events.publish("DatePicker.layout.compressed.toggle",!0)):(c.dom.swapClasses(b.getChildElement("fields"),c.stylejam.flights.search.StyleJamFlightSearchForm.stickyFieldGrid,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultFieldGrid),"roundtrip"===b.display||"multicity"===b.display?(d(f).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayOriginCol),
c.dom.swapClasses(f,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOriginCol,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOriginCol),d(e).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDestCol),c.dom.swapClasses(e,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyDestCol,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultDestCol),d(h).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDatesCol),c.dom.swapClasses(h,
c.stylejam.flights.search.StyleJamFlightSearchForm.stickyDatesCol,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultDatesCol)):"oneway"===b.display&&(d(f).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayOriginCol),c.dom.swapClasses(f,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayOriginCol,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayOriginCol),d(e).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayDestCol),
c.dom.swapClasses(e,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDestCol,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayDestCol),d(h).removeClass(c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayDatesCol),c.dom.swapClasses(h,c.stylejam.flights.search.StyleJamFlightSearchForm.stickyOneWayDatesCol,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultOneWayDatesCol)),c.dom.swapClasses(b.getChildElement("form-grid"),c.stylejam.flights.search.StyleJamFlightSearchForm.stickyFormGrid,
c.stylejam.flights.search.StyleJamFlightSearchForm.defaultFormGrid),c.dom.swapClasses(b.submitButton,c.stylejam.common.widgets.button.StyleJamButton.stickySubmitBtn,c.stylejam.common.widgets.button.StyleJamButton.defaultSubmitBtn),c.dom.swapClasses(b.getChildElement("col-button-wrapper"),c.stylejam.flights.search.StyleJamFlightSearchForm.stickyButtonCol,c.stylejam.flights.search.StyleJamFlightSearchForm.defaultButtonCol),c.dom.swapClasses(b.getChildElement("col-switch"),c.stylejam.flights.search.StyleJamFlightSearchForm.stickySwitchCol,
c.stylejam.flights.search.StyleJamFlightSearchForm.defaultSwitchCol),b.options.newSearchHeaderDesign&&c.dom.swapClasses(b.submitButton,b.stickySeparateIconAndTextButtonClass,b.defaultSeparateIconAndTextButtonClass),b.options.newSearchHeaderDesign&&c.utils.presentation.isMobile()||b.getChildElement("compareToWrapper").show(),c.events.publish("DatePicker.layout.compressed.toggle",!1))}});this.options.showFocusIndication&&this.subscribe("body.accessibilityMode.enabled",function(a){a?(c.dom.swapClasses(d(".js-addMoreLegs"),
"",b.options.focusIndicationClass),c.dom.swapClasses(d(".js-clearLegs"),"",b.options.focusIndicationClass)):(c.dom.swapClasses(d(".js-addMoreLegs"),b.options.focusIndicationClass,""),c.dom.swapClasses(d(".js-clearLegs"),b.options.focusIndicationClass,""))});this.options.useSwindle&&this.answer("flights.search.isSwindleEligibleQuery",this.canSwindleQuery.bind(this));c.config.getBoolean("ui.horizon.flights.frontdoor.inspirationPromotion",!1)&&!b.options.isBusinessMode&&this.subscribe("inspirationPromotion.destination.changed",
function(a){b.updateFormFromInspirationData(a)});this.options.showBaggageDropdown&&this.subscribe("flights.search.baggageCounts.changed",this.updateBaggageCounts.bind(this));this.answer([this.formQuestion,this.id()].join("_"),function(){return b.serialize()});this.options.mainSearchForm&&this.answer(this.formQuestion+".main",function(){return b.serialize()});this.subscribe("flights.search.StyleJamFlightSearchForm.enableSearchButton",function(a){a===b.id()&&b.enableSearchButton()})},loadFromHistory:function(a){this.options.delayHistoryLoad?
d(document).ready(this.base.bind(this,a)):this.base(a)},load:function(a){if(a){var b=this.controllers.rtow,f=this.controllers.multi;a.nearby_origin&&b.triggerChangeNearbyOrigin(a.nearby_origin,this.options.isNearbyInSmarty);a.nearby_destination&&b.triggerChangeNearbyDestination(a.nearby_destination,this.options.isNearbyInSmarty);a.hasOwnProperty("oneway")&&a.oneway&&(this.display="oneway");if(a.hasOwnProperty("isMulticity")&&a.isMulticity&&this.options.toggleLinks){this.display=this.options.useMultiCityInFD?
"rtow":"multicity";this.triggerChangeDisplayCat(this.display,!0);var e=0;if(f.maxLegs)for(var k=0;k<f.maxLegs;k++)a["origincode"+k]&&a["destinationcode"+k]?(e++,f._legAccessor(k).visible(!0)):f._legAccessor(k).visible(!1);f.indexLastVisibleLeg=e-1;e===f.maxLegs&&this.element.find(".js-addMoreLegs").hide();for(var k=this.options.isNearbyInSmarty,g=0;g<e;g++){var h="depart_time"+g;a[h]&&f.triggerChangeDepartTime(a[h],g);h="nearby_origin"+g;a[h]&&f.triggerChangeNearbyOrigin(a[h],g,k);h="nearby_destination"+
g;a[h]&&f.triggerChangeNearbyDestination(a[h],g,k);var h="originLocation"+g,l="origincode"+g;a[h]&&a[l]?f.triggerChangeOrigin({location:a[h],code:a[l],leg:g}):0===g&&a.originLocation&&a.origincode&&f.triggerChangeOrigin({location:a.originLocation,code:a.origincode,leg:g});h="destinationLocation"+g;l="destinationcode"+g;a[h]&&a[l]?f.triggerChangeDestination({location:a[h],code:a[l],leg:g}):0===g&&a.destinationLocation&&a.destinationcode&&f.triggerChangeDestination({location:a.destinationLocation,code:a.destinationcode,
leg:g});h="depart_date_canon"+g;a[h]&&f.triggerChangeDepartDate(a[h],g);h="cabin_type"+g;a[h]&&f.triggerChangeLegCabinType(a[h],g)}}a.hasOwnProperty("depart_date_canon")&&a.depart_date_canon&&a.hasOwnProperty("return_date_canon")&&a.return_date_canon&&b.triggerChangeDateRange(a.depart_date_canon,a.return_date_canon);a.hasOwnProperty("searchFormFilterState")&&(this.searchFormFilterState=d.extend({},this.searchFormFilterState,a.searchFormFilterState),c.events.publish("searchform.loadForm.searchFormFilterState",
{searchFormFilterState:a.searchFormFilterState}),this.options.advancedFiltersEnabled&&this.controllers.rtow.loadAdvancedFilterState(this.searchFormFilterState))}},updateFormFromInspirationData:function(a){a&&(a=d.extend({},a,{id:this.element[0].id,pulse:!0,destinationCodeType:"ap",resetState:!0}),c.events.publish(this.events.rtowDestination,a))},updateCabinType:function(a){a.hasOwnProperty("cabin")&&a.cabin&&(c.events.publish("flights.search.cabinType.set",{namespace:this.id(),value:a.cabin}),this.options.travelersAboveForm||
c.events.publish("flights.search.travelers.refresh",{namespace:this.id()}))},bindOpenNextFieldEvents:function(){var a=this,b=!1;if(this.options.autoOpenNextField){var f=null,e=null,k=null,g=function(){var a=0;return function(){var b=Date.now(),c=b-a;a=b;return 250<c}}(),h=function(){!g()||b||a.options.phoenixRising&&c.utils.presentation.isMobile()&&c.globals.isSeo||(a.controllers.rtow.destinationModal?a.controllers.rtow.destinationModal.focus():a.controllers.rtow.destinationField.inputEl.focus());
b=!1},l=function(){g()&&(a.options.useLegacyDatePicker?a.controllers.rtow.daterangePicker.getWidget().startDisplay.trigger("mousedown"):a.controllers.rtow.focusDepartDate())};this.subscribe(this.events.rtowOrigin,function(b){b.id!==a.element[0].id||b.odSwitch||(null==f?f=!!b.originCode:(f=!!b.originCode)&&!b.isDestinationFocusSkipped&&(k=setTimeout(h,10)))});this.options.ajaxOrigin&&this.subscribe(this.events.rtowOrigin,function(a){!this.options.dialog&&a.isDestinationFocusSkipped&&c.events.publish("flights.search.small.sticky.update")}.bind(this));
this.subscribe(this.events.rtowDestination,function(b){b.id===a.element[0].id&&(null!==k&&(clearTimeout(k),k=null),null==e?e=!!b.destinationCode:(e=!!b.destinationCode,b=a.options.useLegacyDatePicker?a.controllers.rtow.daterangePicker.getWidget().startInput.val()&&a.controllers.rtow.daterangePicker.getWidget().endInput.val():a.controllers.rtow.startDate()&&a.controllers.rtow.endDate(),e&&!b&&l()))});this.controllers.rtow.originField.inputEl.on("keyup",function(a){13===a.which&&f&&h()}).on("keydown",
function(a){a.which===c.globals.keyCodes.TAB&&(b=!0)}).on("mousedown touchstart",function(){d(this).focus()});this.controllers.rtow.destinationField.inputEl.on("keyup",function(a){13===a.which&&e&&l()})}},vsLog:function(a){if(this.stateInitialized&&this.searchForm.is(":visible")&&0<=this.searchForm.offset().top&&"complete"===document.readyState){var b="simpleform";this.searchForm.filter(".active").hasClass("multicity")?b="multicity":this.element.find(".js-searchForm").hasClass("advanced")&&(b="advancedform");
c.Analytics.api.trackEvent(["flights/form",b,a].join("/"))}},gaLog:function(a,b){this.stateInitialized&&this.searchForm.is(":visible")&&0<=this.searchForm.offset().top&&"complete"===document.readyState&&c.Analytics.api.trackEvent({category:"Search-Form",action:a,label:b})},initState:function(){this.options.showStudents||delete this.state.students;if(!0!==this.options.sync){this.triggerChangeDisplayCat(void 0,!0);var a;this.localHistory&&this.localHistory.getRecentHistory&&(a=this.localHistory.getRecentHistory());
Object.values(this.controllers).forEach(function(b){b.initState(a)})}this.stateInitialized=!0},setupChildControllers:function(){this.controllers.rtow.setup();this.options.toggleLinks&&this.options.multicityEnabled&&this.controllers.multi.setup()},onSubmit:function(a){var b=this;if(!this.isSubmitted){var f=!1===this.validate(),e=this.serialize(),d=!1;this.options.airportMultiSelect&&this.activeFormController===this.controllers.rtow&&(n(e.originMultiAirports)||n(e.destinationMultiAirports))&&c.Analytics.api.trackEvent({category:"airportMultiSelect",
action:"submit",label:n(e.originMultiAirports),value:n(e.destinationMultiAirports)});if(this.loadSlideCMP2())return!1;f&&this.submitIntentMedia();if(f&&this.submitKnSwindle.call(this))return!1;this.gaLog("click-search","origin:%s;dest:%s;depart:%s;return:%s;travelers:%s;triptype:%s;cabin:%s;departflex:%s;returnflex:%s".format(e.origin,e.destination,e.depart_date_canon,e.return_date_canon,e.travelers,this.display,e.cabin,e.depart_date_flex,e.return_date_flex));if(f&&this.options.useSwindle&&this.submitSwindle())return!1;
if(this.options.showAnywhere&&"anywhere"!==e.flex_category)if(e.isMulticity)for(var g=0;g<e.nrLegs&&(this.isEmpty(e["origincode"+g])||!this.isEmpty(e["destinationcode"+g]));g++);else d=!this.isEmpty(e.origincode)&&this.isEmpty(e.destinationcode)&&"function"===typeof this.showAnywhereSearchPopup&&this.options.showAnywherePopupEnabled;this.triggerConsentGranted();d?(this.vsLog("/nodestinationerror/show"),this.showAnywhereSearchPopup(e)):this.options.regionSearchEnabled&&(e.freeRegionId||e.countrySearch)&&
!this.options.regionSearch&&f?window.location=this.options.redirectToExplore?c.flights.search.FlightSearchFormUrls.generateExploreDestinationUrl({origincode:e.origincode,destinationcode:e.destinationcode,depart_date_canon:e.depart_date_canon,return_date_canon:e.return_date_canon}):"/"+this._generate(e):this.base(a)}setTimeout(function(){b.recalculateDialogDimensions()},10);return!1},canSwindleQuery:function(a){var b="multicity"===this.display,c=this.activeFormController,c=c&&c.isSameDayRoundtrip?
c.isSameDayRoundtrip():!1,e=a||this.serialize()||{};a=!!e.freeRegionId||a.countrySearch;e=-1!==["explore","anywhere"].indexOf(e.flex_category);return!b&&!c&&!a&&!e},submitSwindle:function(){var a=this.serialize()||{};return this.canSwindleQuery(a)?c.question.ask("hotels.swindle.handleSwindle",{url:this.buildSearchURL(a)}):!1},showAnywhereSearchPopup:function(a){c.events.publish("flights.search.AnywhereSearchDialog.open",a)},publishSubmitEvent:function(a){this.options.regionSearch||"anywhere"===a.flex_category&&
!this.options.searchAnywhereInNewTab?window.location.href="/"+a.url:"anywhere"===a.flex_category||this.options.searchInNewTab?(window.open(a.url),this.enableSearchButton()):this.base(a)},getCMP2AirportLocation:function(a,b){if(a){a=a.substr(0,3);if(""===a||0===a.indexOf("C-"))a=b.replace(/ /g,""),-1!==a.indexOf("(")?(b=a.match(/\(([A-Z]{3})\)/g),null!=b&&(a=b[0])):a=a.substr(0,3);return a}return""},getCompareToFormData:function(){var a=this.serialize(),b={vertical:this.vertical};a.origin=a.origin_location;
a.origincode=a.origin_code;a.destination=a.destination_location;a.destinationcode=a.destination_code;return d.extend(b,a)},isEnoughInformationForCompareToRequest:function(){if(this.options.loadCmp2WhenVisible&&!this.element.is(":visible"))return!1;var a=["plusminusthree","exact","exact-graph"];if(this.activeFormController===this.controllers.rtow&&-1===d.inArray(this.activeFormController.getFlexCategory(),a))return!1;a=!0;this.options.cmp2LimitDisplay&&(a="oneway"===this.display||"roundtrip"===this.display);
if(this.options.regionSearchEnabled&&a&&this.activeFormController){var b=this.serialize();if(b.destination&&(r.exec(b.destination)||q(b.destination)))return!1}return a&&!this.options.suppressCmp2s&&!this.isNull(this.activeFormController)&&!1===this.validate()},autofocus:function(){this.controllers.rtow.originField.inputEl.focus()},switchToFullView:function(){this.inlineViewOnly=this.inline=!1},switchToInlineView:function(a){this.inline=!0;this.inlineViewOnly=a||!1;a&&this.updateInlineViewOnly()},
getSearchFormFilterState:function(){var a=this.base();if("multicity"===this.display){var b=[];this.options.advancedFiltersEnabled&&(b=b.concat(["stops","cabin","takeoff"]));this.options.showBaggageDropdown&&(b=b.concat(["cfc","bfc"]));b.forEach(function(b){delete a[b]})}return a},buildSearchURL:function(a){return this.activeFormController.buildSearchURL(a,this.getSearchFormFilterState())},serialize:function(){var a=this.base();a.provider="";var b=this.getActiveFormData();return d.extend(a,b)},getActiveFormData:function(){return d.extend({airlineFilter:this.options.airlineFilter},
this.activeFormController.serialize())},getCookieData:function(){var a=this.base(),b={},c=this;this.element.find("[type\x3d'hidden']").filter(function(){var a=d(this).attr("name");return c.isEmpty(a)?!1:!/^(?:airportcode|origincode|destinationcode)\d?$/i.test(a)}).each(function(){var a=d(this),f=a.attr("name"),g=a.val();c.isEmpty(g)||(b[f]=a.val())});this.options.airlineFilter&&!b.airlineFilter&&(b.airlineFilter=this.options.airlineFilter);return d.extend(a,b)},getStorageProps:function(){for(var a=
"depart_date depart_date_canon return_date return_date_canon origincode destinationcode travelers cabin flex_category isMulticity oneway nearby_origin nearby_destination depart_date_flex return_date_flex weekend_depart_date weekend_depart weekend_return openflex_depart_date openflex_length_of_stay".split(" "),b=this.activeFormController&&this.activeFormController.maxLegs?this.activeFormController.maxLegs:3,c=0;c<b;c++)a.push("origincode"+c),a.push("originLocation"+c),a.push("destinationcode"+c),a.push("destinationLocation"+
c),a.push("depart_date"+c),a.push("depart_date_canon"+c),a.push("depart_time"+c),a.push("cabin_type"+c),a.push("nearby_origin"+c),a.push("nearby_destination"+c);(this.options.showBaggageDropdown||this.options.advancedFiltersEnabled)&&a.push("searchFormFilterState");return a},removeActiveClass:function(a){a=a?d(a).find(".js-rtow,.js-mcmc"):d(".js-rtow,.js-mcmc");a.attr("aria-hidden","true");"undefined"!==typeof c.stylejam&&this.swapClasses(a,"SearchForm--visible","SearchForm--hidden")},bindDisplayCat:function(){var a=
this;this.options.toggleLinks?this.subscribe("flights.search.form.display.change",function(b){b.namespace&&b.namespace!==a.eventDataTemplate.id&&!a.options.sync||a.triggerChangeDisplayCat(b.value,!0)}):this.options.multicityEnabled&&(a.multiCityDialog=this.getChildElement("multiCityDialog").getWidget(),a.multiCityDialog&&(d.extend(a.multiCityDialog.options,{onClose:function(){a.autofocus()}}),this.subscribe(["flights.search.multicity.legAdded","flights.search.multicity.legRemoved"],function(){setTimeout(a.multiCityDialog.calculateDimensions.bind(a.multiCityDialog),
1)}),this.subscribe("searchform.submit",function(){a.multiCityDialog.close()})))},initActiveFormController:function(){switch(this.display){case "roundtrip":case "rtow":case "oneway":this.activeFormController=this.controllers.rtow;break;case "multi":case "multicity":this.activeFormController=this.controllers.multi}},onChangeDisplayCat:function(a){switch(a.displayCat){case "roundtrip":case "rtow":a=this.activeFormController==this.controllers.multi;this.activeFormController=this.controllers.rtow;this.options.mixedCabinsUI&&
a&&this.copyMultiDataForMixedCabinsUI();this.display="roundtrip";break;case "oneway":this.activeFormController=this.controllers.rtow;this.display="oneway";break;case "explore":this.activeFormController=this.controllers.rtow;this.display="explore";break;case "multi":case "multicity":a=this.activeFormController==this.controllers.rtow;this.activeFormController=this.controllers.multi;this.options.mixedCabinsUI&&a&&this.copyRTDataForMixedCabinsUI();this.display="multicity";break;default:return}this.options.toggleLinks&&
this.removeActiveClass(this.element);this.options.travelersAboveForm&&(a="multicity"===this.display,this.getChildElement("cabinType").parent().toggleClass(this.getStlBlock("Header__grid__col--hidden"),a),this.options.showBaggageDropdown&&this.getChildElement("baggage").toggleClass(this.getStlBlock("Header__grid__col--hidden"),a));("multicity"!==this.display||this.options.toggleLinks)&&this.activeFormController.activate();"oneway"!==this.display&&"roundtrip"!==this.display||this.activeFormController.setOneWay("oneway"===
this.display);this.updateLapInfantWarning();this.loadCompareToItems();this.recalculateDialogDimensions()},copyRTDataForMixedCabinsUI:function(){var a=this.controllers.rtow.state;if(null!=a.end_date){var b=d.extend({},this.eventDataTemplate);b.legIndex=1;b.originCode=a.destinationCode;b.originLocation=a.destination;c.events.publish(this.events.multiOrigin,b);b=d.extend({},this.eventDataTemplate);b.legIndex=1;b.destinationCode=a.originCode;b.destinationLocation=a.origin;c.events.publish(this.events.multiDestination,
b);b=d.extend({},this.eventDataTemplate);b.legIndex=1;b.departDate=a.end_date;c.events.publish(this.events.multiDepartDate,b);b=d.extend({},this.eventDataTemplate);b.cabinType=this.state.cabin;this.controllers.multi.updateAllLegsToCabinType(b)}},copyMultiDataForMixedCabinsUI:function(){var a=d.extend({},this.eventDataTemplate);this.controllers.multi.updateNonMcSearchFormCabinClasses(a)},triggerChangeDisplayCat:function(a,b){var f=d.extend({},this.eventDataTemplate);f.displayCat=p(a,this.display);
c.events.publish(this.events.displayCat,f);b&&c.events.publish("flights.search.form.display.set",f.displayCat);this.vsLog("/triptype/"+a);this.gaLog("select-trip-type",a)},updateInlineViewOnly:function(){var a=this.activeFormController.serialize(),a={depart_date:m(a.depart_date).format("MMM DD"),return_date:m(a.return_date).format("MMM DD"),origincode:a.origincode,destinationcode:a.destinationcode,cabin:a.cabin||"Economy",travelers:a.travelers},b;for(b in a)a.hasOwnProperty(b)&&d(".displayView[data-disp-%s]".format(b),
this.element).html(a[b])},adjustAnywhereSearchCategory:function(a){a?this.controllers.rtow.searchFormWrapper.addClass("anywhere-search"):this.controllers.rtow.searchFormWrapper.removeClass("anywhere-search")},updateBaggageCounts:function(a){this.searchFormFilterState[a.type]=""+a.value},bindFlightSmartyFields:function(a){var b=this,f=function(b){var c=b.inputEl;return function(b){setTimeout(function(){if(!c.val()||0===c.val().length){var e=b.options.messages.anywhereInptText;c.closest(".js-searchForm").addClass("anywhere-search");
a.changeCallback({location:e,code:"anywhere"})}},1)}},e=function(){return function(e){if(e)if(a.nearbyFormCallback)a.nearbyFormCallback(e.enabled);else{var f=d.extend({},b.eventDataTemplate);a.isOrigin?(f.includeNearbyOrigin=e.enabled,c.events.publish(b.events.rtowNearbyOrigin,f)):(f.includeNearbyDestination=e.enabled,c.events.publish(b.events.rtowNearbyDestination,f))}}},k=b.options.flareSmartyType,g=a.field.inputEl,h={flareSmartyType:k,dataSource:b.options.smartyUrl,smartyControlGroup:function(){if(!(b.options.showSmartyHistory&&
!a.noHistory||b.options.showTopDestinations&&a.enableTopDestinations))return null;var e=b.getChildElement("origin-airport"),f=b.getChildElement("destination-airport"),d=b.getChildElement("origin-code"),g=b.getChildElement("destination-code"),k=b.getChildElement("nearbyOriginCheckRtow"),h=b.getChildElement("nearbyDestinationCheckRtow"),l=b.state,m,n,p,q;b.options.useLegacyDatePicker?m=b.getChildElement("travelDates").daterangePicker().getWidget():(p=b.activeFormController.departDate,q=b.activeFormController.returnDate,
n=b.activeFormController.datePicker);e={form:b.searchForm,formObject:b,originField:b.controllers.rtow.originField,destField:b.controllers.rtow.destinationField,originInput:e,destInput:f,originCode:d,destCode:g,daterangePicker:m,startDate:p,endDate:q,datePicker:n,useLegacyDatePicker:b.options.useLegacyDatePicker,nearbyDeparture:k,nearbyArrival:h,isRoundTrip:function(){return"roundtrip"===b.display},maxHistory:b.options.maxHistoryItems,airportMultiSelectEnabled:b.options.airportMultiSelect,state:l};
if(b.options.showSmartyHistory&&!a.noHistory){var r=new c.Common.SmartyHistory.SmartyFlightHistory;e.smartyHistory=function(){return r}}if(b.options.showTopDestinations&&a.enableTopDestinations){var t=new c.Common.SmartyTopDestinations.SmartyFlightTopDestinations(a.topDestinationOptions||{});e.smartyTopDestinations=function(){return t}}return new c.Common.SmartyControlGroup.SmartyFlightControlGroup(e)}(),setItem:function(e){return function(f,d){d&&setTimeout(function(){var g,k,h;g=b.options.regionDisplayAirportPicker?
!1:!(a.isOrigin||a.isMulticity)&&b.isRegionSearchSupported;if("ap"===d.type||"apnc"===d.type||"rail"===d.type)g=d.short_str||d.str,h=d.str,k=d.id;else if("isl"===d.type)g=d.str,k="";else if(g&&"reg"===d.type)g=d.short_str||d.str,k=d.rid+"r";else if(g&&"freereg"===d.type)g=d.short_str||d.str,k=d.frid+"fr";else if(g&&b.options.regionSearchEnabled&&"ctry"===d.type)g=d.short_str||d.str,k=d.cid+"cy";else if(g&&b.options.regionSearchEnabled&&"ctgroup"===d.type)g=d.short_str||d.str,k=d.cgid+"cg";else if(f.options.showAnywhere&&
"anywhere"===d.short_str)c.events.publish("forceDismiss.DatePicker"),g=f.options.messages.anywhereInptText,k="anywhere",e.closest(".js-searchForm").removeClass("advanced").addClass("anywhere-search"),b.vsLog("/smarty/anywhere");else if("addr"===d.type)g=d.name,b.openAirportPicker(g,"",l,!a.isOrigin,function(b){a.changeCallback({location:b.location,code:b.code})}),e.getWidget().setItem({});else{k=g="";var l=d.id;if(b.isRegionSearchSupported)switch(d.type){case "freereg":l="F:%s".format(d.frid);break;
case "reg":l="R:%s".format(d.rid);break;case "ctry":l="Y:%s".format(d.cid)}b.openAirportPicker("","",l,!a.isOrigin,function(b){a.changeCallback({location:b.location,code:b.code})})}f.options.showAnywhere&&"anywhere"!==d.short_str&&e.closest(".js-searchForm").removeClass("anywhere-search");a.isOrigin&&(b.originCountry=d.cc||"");a.changeCallback({location:g,locationDescription:h,code:k,codeType:d.type})},100)}}(g),clearItem:function(b){return function(c){setTimeout(function(){c.options.showAnywhere&&
b.closest(".js-searchForm").removeClass("anywhere-search");a.changeCallback({location:void 0,code:""})},1)}}(g),messages:b.options.msg,showAnywhere:b.options.showAnywhere&&!a.isOrigin&&!a.isMulticity,showBackgroundAutocomplete:c.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",!1),animateSmarty:!1,useNearby:b.options.isNearbyInSmarty,showDropdownWhenEmpty:!0};if(this.options.phoenixRising){var l=a.field.inputEl.data("inputModal");l&&(h.appendTo=l.getSmartyWrapper(),h.fixedDropdown=
!0)}"function"===typeof a.beforeStartCallback&&d.extend(h,{beforeStart:a.beforeStartCallback(a.field)});h.useNearby&&(h.nearbyCallback=e());b.options.showAnywhere&&b.options.anywhereIfEmpty&&!a.isOrigin&&(h.afterDone=f(a.field));if(32===k||51===k||55===k||58===k)h.dropdownClass="smartbox smartbox-air smartbox-v2 smartbox-air-regions";c.config.getBoolean("ui.smarty.flights.greyIcons",!1)&&(h.dropdownClass=h.dropdownClass+" "+c.config.getString("ui.smarty.iconClasses","greyIcons"));b.checkAndSetSmartyUIUpdateOpts(h);
h.allAirportsLocalizedText=this.options.allAirportsLocalizedText;g.flightSmarty(h)},setupTravelersAndCabin:function(){var a=this;this.subscribe("flights.search.cabinType.change",{namespace:this.id()},function(b){"m"===b.value?(a.triggerChangeCabinType("e"),c.events.publish("flights.search.travelers.close",{namespace:a.id()}),a.triggerChangeDisplayCat("multicity",!0),a.vsLog("/passengers/cabin/m"),a.gaLog("select-cabin","m")):a.triggerChangeCabinType(b.value)});this.subscribe("flights.search.travelers.change",
{namespace:this.id()},function(b){a.triggerChangeTravelers(b.data)});this.travelersDataQuestion="flights.search.travelers."+this.id(this.options.travelersAboveForm?"above":"rtow");var b;this.localHistory&&this.localHistory.getRecentHistory&&(b=this.localHistory.getRecentHistory())&&(c.events.publish("flights.search.travelers.set",d.extend({namespace:this.id()},b)),!this.options.ignoreSticky&&b.cabin&&(this.options.travelersAboveForm?c.events.when("flights.search.cabinType.init."+this.id(),this.triggerChangeCabinType.bind(this,
b.cabin)):this.triggerChangeCabinType(b.cabin)));(b=c.question.ask(this.travelersDataQuestion))&&this.triggerChangeTravelers(b)},onChangeTravelers:function(a){c.events.publish("flights.search.travelers.set",d.extend({namespace:this.id()},a));d.extend(this.state,a);this.updateLapInfantWarning()},triggerChangeTravelers:function(a){var b=d.extend({},this.eventDataTemplate);a||(a=c.question.ask(this.travelersDataQuestion));d.extend(b,a);c.events.publish(this.events.travelerCount,b);b.hasOwnProperty("travelerType")&&
(this.vsLog("passengers/"+b.travelerType),this.gaLog("select-passengers",b.travelerType))},getCabin:function(){return c.question.ask("flights.search.cabinType."+this.id()+".get")},onChangeCabinType:function(a){this.updateCabinType({cabin:a.cabinType});if(a=this.getCabin())this.state.cabin=a.value,this.state.cabinDisplayType=a.display},triggerChangeCabinType:function(a){var b=this,f=d.extend({},this.eventDataTemplate);f.cabinType=p(a,function(){return b.getCabin().value});c.events.publish(this.events.cabinType,
f);this.vsLog("/passengers/cabin/"+a);this.gaLog("select-cabin",a)},bindDaterangePicker:function(a,b,c){var e=this,f=function(a){var b=e.serialize();return{vertical:"flights",origin:b.origincode,destination:b.destinationcode,isOneWay:b.oneway,departDate:a?void 0:b.depart_date_canon}};this.options.useLegacyDatePicker?(c=c||{getFormData:f,useDaysFormat:!0,minRangeDays:0,change:function(){b(this.getStartDate(),this.getEndDate())},alwaysShowEndDatepicker:this.options.autoOpenNextField,nextFieldSelector:"#"+
this.controllers.rtow.searchForm.find(".searchButton").attr("id")},a.daterangePicker(c).getWidget()):(c=c||{change:b,dismiss:this.dismissingDatepicker.bind(this),getFormData:f,onFormNavBack:this.navBackFromDatepicker.bind(this),onFormNavForward:this.focusSubmitButton.bind(this)},d.extend(a.options,c))},navBackFromDatepicker:function(){this.activeFormController.focusDestination&&this.activeFormController.focusDestination()},dismissingDatepicker:function(a){a&&a.returnEvent&&this.focusSubmitButton()},
focusSubmitButton:function(){var a=this.activeFormController===this.controllers.multi?this.getChildElement("submit-multi"):this.getChildElement("submit");c.dom.schedule(function(){a&&a.focus()})},checkForValidDates:function(){var a=this.getChildElement("depart"),b=this.getChildElement("return");if(a&&a.getWidget()&&b&&b.getWidget()&&(a=a.getWidget(),b=b.getWidget(),a=a.getDate(),b=b.getDate(),a&&m(Date.now()).isAfter(a,"day")||!a||!b)){b=1;a=8;c&&c.config&&(b=c.config.getInt("ui.horizon.flights.flightroutes.departureDate.offset",
b),a=c.config.getInt("ui.horizon.flights.flightroutes.returnDate.offset",a));var f=d.extend({},this.eventDataTemplate);f.startDate=m().startOf("day").add(b,"d");f.endDate=m().startOf("day").add(a,"d");c.events.publish(this.events.rtowDateRange,f)}},bindShowAirportMapLinks:function(){function a(a){a.preventDefault?a.preventDefault():a.returnValue=!1;d(!1,function(a){e.controllers.rtow.triggerChangeOrigin(a.location,a.code);e.controllers.multi.triggerChangeOrigin(a.location,a.code,0)})}function b(a){a.preventDefault?
a.preventDefault():a.returnValue=!1;d(!0,function(a){e.controllers.rtow.triggerChangeDestination({location:a.location,code:a.code});e.controllers.multi.triggerChangeDestination({location:a.location,code:a.code,leg:0})})}function d(a,b){var c=a?e.destinationField:originField;e.openAirportPicker(c.val(),c.code(),"",a,b)}var e=this;this.getChildElement("showAirportMapOriginRtow").click(a.bind(this));this.getChildElement("showAirportMapOriginRtow").keydown(function(b){b.which===c.globals.keyCodes.RETURN&&
a(b)});this.getChildElement("showAirportMapDestinationRtow").click(b.bind(this));this.getChildElement("showAirportMapDestinationRtow").keydown(function(a){a.which===c.globals.keyCodes.RETURN&&b(a)})},onChangeTriggerData:function(a){if(!this.isEmpty(a.origincode)&&!this.isEmpty(a.originname)){var b={location:a.originname,code:a.origincode,isDestinationFocusSkipped:a.isDestinationFocusSkipped};this.controllers.rtow.triggerChangeOrigin(b);this.controllers.multi.triggerChangeOrigin(d.extend({},b,{leg:0}))}this.isEmpty(a.destinationcode)||
this.isEmpty(a.destinationname)||(this.controllers.rtow.triggerChangeDestination({location:a.destinationname,code:a.destinationcode}),this.controllers.multi.triggerChangeDestination({location:a.destinationname,code:a.destinationcode,leg:0}));this.isEmpty(a.departDate)||this.isEmpty(a.returnDate)||this.controllers.rtow.triggerChangeDateRange(a.departDate,a.returnDate);this.isEmpty(a.filter)||(this.options.airlineFilter=a.filter);this.updateLogging(a);this.loadCompareToItems()},updateTravelDateState:function(a,
b){this.isEmpty(a)||this.isEmpty(b)||this.controllers.rtow.triggerChangeDateRange(a,b)},openAirportPicker:function(a,b,d,e,k){e=this.id(e?"airportPickerDestination":"airportPickerOrigin");c.events.publish("flights.airportpicker.open",{id:e,location:a,code:b,hint:d,callback:k})},updateLapInfantWarning:function(){this.element.removeClass("hasInfantInLapWarning hasTopInfantInLapWarning");c.config.getBoolean("ui.horizon.flights.search.showInfantWarningInForm",!0)&&(0<this.state.lapInfant&&(this.element.addClass("hasInfantInLapWarning"),
this.activeFormController===this.controllers.rtow&&this.element.addClass("hasTopInfantInLapWarning")),this.swapClassesToggle(this.lapInfantWarning,"MultiForm__lap-warning__inner--hide","MultiForm__lap-warning__inner--show",0===this.state.lapInfant))},onSearchError:function(){this.recalculateDialogDimensions()},serializeTravelers:function(a){a.travelers=this.state.travelers;a.adults=this.state.adults;a.seniors=this.state.seniors;a.youth=this.state.youth;a.child=this.state.child;a.seatInfant=this.state.seatInfant;
a.lapInfant=this.state.lapInfant;a.cabin=this.state.cabin;a.cabinDisplayType=this.state.cabinDisplayType},loadSlideCMP2:function(){if(this.options.slideCMP2&&this.activeFormController===this.controllers.rtow&&"US"===this.originCountry){this.disableSearchButton();var a=this.getCompareToFormData(),b=this,d=this.buildSearchURL(this.serialize()||{}),a={id:this.id("slidecmp2"),url:d,pageOrigin:a.pageOrigin};c.ajax.execute("common/compareto/slide/SlideCompareToFlights",{customUpdate:function(a){b.getChildElement("slidecmp2").replaceWith(a.innerHTML);
return!0},data:a});return!0}return!1},loadCompareToItems:function(){this.options.slideCMP2&&"US"===this.originCountry?c.events.publish("cmp2.cleanUp",{id:this.id()+"-compareTo"}):this.base()},validate:function(){var a=!1,b=this.activeFormController.validate();0===b.length&&(a=!0,b=this.getStandAloneErrorMessage());if(0===b.length)return!1;if(a)return b[0];for(a=0;a<b.length;a++)b[a]=c.utils.escapeHTML(b[a]);return"\x3cul\x3e\x3cli\x3e"+b.join("\x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e"},getStandAloneErrorMessage:function(){var a=
this.state.adults+this.state.seniors;this.options.showStudents&&(a+=this.state.students);return 0===a?[this.options.errMsg.noUnaccompaniedMinors+""]:[]},getTravelerValidationMessages:function(){return this.state.travelers>this.options.maxTravelers?[c.Common.Utils.String.formatString(this.options.errMsg.tooManyPassengersSelected+"",this.options.maxTravelers)]:1>this.state.travelers?[this.options.errMsg.noPassengersSelected+""]:[]},getDateValidationMessages:function(a,b,d,e){var f=[],g=!this.isEmpty(d),
h=!this.isEmpty(e);g||f.push(c.Common.Utils.String.formatChoice(this.options.errMsg.missingLeaveDateChoice,a,a));b||(h?(a=m(d),0>m(e).diff(a,"days")&&f.push(this.options.errMsg.departDateAfterReturnDate),m().startOf("day").isAfter(a)&&f.push(this.options.errMsg.departDateInPast)):f.push(this.options.errMsg.missingReturnDate));return f},getLocationValidationMessages:function(a,b,d){var e=[];this.isEmpty(b)&&e.push(c.Common.Utils.String.formatChoice(this.options.errMsg.missingFromAirportChoice,a,a)+
"");this.isEmpty(d)?e.push(c.Common.Utils.String.formatChoice(this.options.errMsg.missingToAirportChoice,a,a)+""):b===d&&e.push(c.Common.Utils.String.formatChoice(this.options.errMsg.uniqueAirportsChoice,a,a)+"");return e},isInternalEvent:function(a){return this.id()===a.id},isConsumeUpdateEvent:function(a){return this.isInternalEvent(a)||!0===this.options.sync},proxyEventCallback:function(a,b,c,d){var e=this;return function(f){("function"===typeof c?c.call(b,f):e.isConsumeUpdateEvent(f))&&a.apply(b,
arguments);("function"===typeof d?d.call(b,f):e.isInternalEvent(f))&&e.loadCompareToItems()}},recalculateDialogDimensions:function(){c.events.publish("flights.search.dialog.recalculatedimensions",{id:this.id()})},onHookSubmitForIntentMedia:function(a){a&&"function"===typeof a.callOnSubmit&&(this.intentMediaCallOnSubmit=a.callOnSubmit)},submitIntentMedia:function(){"function"===typeof this.intentMediaCallOnSubmit&&this.intentMediaCallOnSubmit.call(null,this.serialize())},onHookSubmitForKnSwindle:function(a){a&&
"function"===typeof a.callOnSubmit&&(this.swindleCallOnSubmit=a.callOnSubmit)},submitKnSwindle:function(){if("function"===typeof this.swindleCallOnSubmit){var a=this.serialize()||{};if(this.canSwindleQuery(a)){a.relativeUrl=!0;var b=this.buildSearchURL(a);a.relativeUrl=!1;a="/"+this.buildSearchURL(a);this.options.slideCMP2&&(a=this.options.urlRedirectPath+encodeURIComponent(b));return this.swindleCallOnSubmit.call(null,a,b)}}return!1},checkOriginForUpdate:function(){var a=this;d.ajax({url:"/s/run/analytic/airport",
method:"GET",success:function(b){if(b.success){var c=b.ipAirport?b.ipAirport:"";a.onChangeTriggerData({origincode:c,originname:b.ipAirportDisplayName?b.ipAirportDisplayName:c,isDestinationFocusSkipped:a.options.phoenixRising})}}})},focusFirstElement:function(){this.options.toggleLinks?c.events.publish("flights.search.form.display.focus"):this.getChildElement("origin").get(0).focus()},createSubControllers:function(){var a={bindAndInitDropdown:u,bindDropdown:t,bindCheckbox:w,setCheckboxValue:v,isEmpty:this.isEmpty.bind(this),
valOrDefault:p,isCountryOrCountryGroup:q,getAirportCode:x,getMultipleAirportCodes:y,REGION_RX:r},b={rtow:new c.flights.search.RTOWFormController(this,a)};this.options.multicityEnabled&&(b.multi=new c.flights.search.MulticityFormController(this,a));return b},setNearbyWrapperVisibility:function(a,b){a=this.isEmpty(a)?"hidden":"visible";b=this.element.find(b);b.css("visibility",a);b.removeClass("visible hidden").addClass(a)},adjustFormClass:function(){this.controllers.multi.searchForm&&(0===d(".js-multiCityLeg.js-hiddenLeg",
this.element).length===!0?this.controllers.multi.searchForm.addClass("fullyExpand"):this.controllers.multi.searchForm.removeClass("fullyExpand"))},destroy:function(){this.base();this.controllers.rtow.teardown();this.controllers.multi&&this.controllers.multi.teardown()}})})(window.R9,window.jQuery,window.moment);(function(d,e,f){d.publish("common.utils.history.UserHistory",f.extend({constructor:function(a){this.options=e.extend({},this.options,a);this.init()},pageTab:"other",wasLastUsedPage:!1,searchHistoryLimit:3,options:{defaultCookiExpire:10,defaultSearchExpire:100,persistLocalStorage:!0,onSave:e.noop},_storageTemplate:{sticky:{origin:"",destination:"",guests:"",depart_date:"",return_date:"",travelersObject:""},lastUsedTab:"",canary:3},_storageKey:"BKHISTORY2",hasSearchHistory:!1,searchHistoryMoreRecent:!1,
_loadStorageInstance:function(){var a=this._storageTemplate.canary,b=d.storage.get(this._storageKey);d.common.utils.history.UserHistory.storageSync=b&&b.canary&&b.canary===a?b:e.extend(!0,{},this._storageTemplate)},getStorage:function(){d.common.utils.history.UserHistory.storageSync||(d.common.utils.history.UserHistory.storageSync=e.extend(!0,{},this._storageTemplate));return d.common.utils.history.UserHistory.storageSync},initStorageInstance:function(){var a=this.getStorage();a[this.pageTab]||(a[this.pageTab]=
{searches:[],last_updated:null},d.storage.set(this._storageKey,a))},_createExpirationTimestamp:function(a){return moment().add(a||0,"hours").toDate()},init:function(){this.dirty=!1;this.pageTab=this.options.tab||this.pageTab;this._loadStorageInstance();this.initStorageInstance();this.getStorage().lastUsedTab===this.pageTab&&(this.wasLastUsedPage=!0);this.evictExpiredSearches();var a=this.getStorage()[this.pageTab];a&&a.searches&&0<a.searches.length&&(this.hasSearchHistory=!0,a.last_updated&&a.searches[0]&&
1>moment(a.last_updated).diff(a.searches[0].createdAt)&&(this.searchHistoryMoreRecent=!0));var b=this;e(window).bind("beforeunload",function(){try{b.save()}catch(c){}})},save:function(){if(this.dirty)try{this.options.onSave.call(this),this.dirty&&this.options.persistLocalStorage&&(this.dirty=!1,this.getStorage().lastUsedTab=this.pageTab,this.getStorage().common=this.common,d.storage.set(this._storageKey,this.getStorage()))}catch(a){return!1}return!0},get:function(a){if(this.getStorage()[this.pageTab])return this.getStorage()[this.pageTab][a]},
set:function(a,b){var c=this.getStorage()[this.pageTab];c&&c[a]!==b&&(this.dirty=!0,c.last_updated=this._createExpirationTimestamp(),c[a]=b);clearTimeout(this._saveTimeout);this._saveTimeout=setTimeout(e.proxy(this,"save"),100)},reduceTravelersObjectToTotal:function(){var a=0;if(this.getStorage().sticky){var b=this.getStorage().sticky.travelersObject;b&&(a+=parseInt(b.adults),a+=parseInt(b.youth),a+=parseInt(b.children),a+=parseInt(b.infants),a+=parseInt(b.lapinfants),a+=parseInt(b.seniors))}return a},
getRecentHistory:function(){var a=this.getStorage()[this.pageTab],b=this.hasSearchHistory&&this.searchHistoryMoreRecent&&a&&a.searches?a.searches[0]:null;if(!b&&a&&(!a.last_updated||moment().diff(a.last_updated,"hours")<this.options.defaultSearchExpire)){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=this.get(c));delete b.last_updated;delete b.searches}return b},evictExpiredSearches:function(){var a=this.getStorage(),b=a[this.pageTab]?a[this.pageTab].searches:null,c=this;b&&0!==b.length&&(b.length>
this.searchHistoryLimit&&a[this.pageTab].searches&&(b=b.slice(0,this.searchHistoryLimit)),a[this.pageTab].searches=b.filter(function(a){return!c._shouldExpire(a.expiresBy)}))},pushSearchHistory:function(a){var b=this.getStorage();b[this.pageTab]&&b[this.pageTab].searches&&(a.expiresBy=this._createExpirationTimestamp(this.options.defaultSearchExpire),a.createdAt=this._createExpirationTimestamp(),b[this.pageTab].searches.splice(0,0,a),this.dirty=!0);this.save()},_shouldExpire:function(a){return 0<moment().diff(moment(a))},
purge:function(){d.storage.remove(this._storageKey);d.common.utils.history.UserHistory.storageSync=null;this.initStorageInstance();this.options.persistLocalStorage=!1}}))})(R9,jQuery,base2.Base);(function(e){R9.createComponentClass("common.frontdoor.brands.momondo.HeroPhotoCover",{options:{backgroundImagePaths:[],lowerQualBackgroundImagePath:"",maskImagePath:"",carouselInterval:8E3},addEventHandlers:function(){this.bindImageLoad.call(this,"img2",this.options.maskImagePath);this.bindImageLoad.call(this,"img1",this.options.lowerQualBackgroundImagePath,"bgSvg");0<this.options.backgroundImagePaths.length&&this.bindImageLoad.call(this,"img3",this.options.backgroundImagePaths[0].imagePath,"circleSvg");
1<this.options.backgroundImagePaths.length&&this.loopCarouselImages()},bindImageLoad:function(a,b,c){0<b.length&&(a=e("#"+a),c?a.one("load",function(){e("."+c).show()}).attr("src",b):a.attr("src",b))},loopCarouselImages:function(){var a=this,b=this.getChildElement("js-images").children(),c=this.getChildElement("js-texts").children(),f=this.options.backgroundImagePaths.length,d=0;setInterval(function(){a.swapClasses(e(b[d]),"CoverWrapper__layout__circleImgLayer__svgWrap__image--active","CoverWrapper__layout__circleImgLayer__svgWrap__image");
a.swapClasses(e(c[d]),"CoverWrapper__layout__circleImgLayer__text__paragraph--active","CoverWrapper__layout__circleImgLayer__text__paragraph");d++;d>=f&&(d=0);a.swapClasses(e(b[d]),"CoverWrapper__layout__circleImgLayer__svgWrap__image","CoverWrapper__layout__circleImgLayer__svgWrap__image--active");a.swapClasses(e(c[d]),"CoverWrapper__layout__circleImgLayer__text__paragraph","CoverWrapper__layout__circleImgLayer__text__paragraph--active")},a.options.carouselInterval)},swapClasses:function(a,b,c){a.removeClass(b);
a.addClass(c)}})})(jQuery);(function(b,c){b.createComponentClass("common.frontdoor.FrontDoorAdDisplay",{columns:{left:null,middle:null,right:null},init:function(){this.columns.left=this.getChildElement("left");this.columns.middle=this.getChildElement("middle");this.columns.right=this.getChildElement("right")},addEventHandlers:function(){this.subscribe("fd.ad.display.left",this.adLoadedCallback.bind(this,"left"));this.subscribe("fd.ad.display.middle",this.adLoadedCallback.bind(this,"middle"));this.subscribe("fd.ad.display.right",
this.adLoadedCallback.bind(this,"right"))},adLoadedCallback:function(a,b){(a=this.columns[a])&&a.length&&(b.isEmpty?a.addClass("col-hidden"):a.removeClass("col-hidden"))}})})(R9,jQuery);(function(d,e){function f(a){return function(b,c){d.events.publish(a,c)}}d.createComponentClass("sem.common.carousel.SlickCarousel",{options:{dots:!1,arrows:!1,prevArrow:void 0,nextArrow:void 0,infinite:!0,slidesToShow:3,rows:1,centerMode:!0,variableWidth:!0,autoplay:!1,autoplaySpeed:3E3,slidesToScroll:1,initialSlide:0,swipeToSlide:!0,adaptiveHeight:!0,fade:!1,edgeFriction:0,speed:300,touchThreshold:50,tileClickEvent:"sem.carousel.tileClicked",responsive:{},hasLazy:!1,loggingPrefix:"",lazyLoadComponent:!1,
lazyLoadComponentThreshold:1E3,lazyLoadSlider:!1,lazyLoad:"ondemand",accessibility:!0},slick:null,inlineComponentsReady:function(){var a=this;this.options.lazyLoadComponentThreshold=10;this.options.lazyLoadComponent?this.getChildElement("slick").lazyLoad({skip_invisible:!0,threshold:this.options.lazyLoadComponentThreshold,appear:function(){var b=a.element.find(".lazyLoadPlaceholder");b&&b.remove();a.initCarousel()}}):this.initCarousel()},initCarousel:function(){this.slick=this.getChildElement("slick").on("destroy",
f("sem.slick.destroyed")).slick(this.options).slick("getSlick");if(this.options.hasLazy){var a=this;this.element.find(".slick-arrow").on("click",function(){setTimeout(function(){jq(document.body).trigger("scroll")},a.options.speed+10)})}d.events.publish("sem.slick.initialized");var b=this;this.slick.$prevArrow&&this.registerEvent("click",this.slick.$prevArrow,function(){d.Analytics.api.trackEvent({category:"carousel"+(b.options.loggingPrefix?"/"+b.options.loggingPrefix:""),action:"prev-arrow",label:"click"})});
this.slick.$nextArrow&&this.registerEvent("click",this.slick.$nextArrow,function(){d.Analytics.api.trackEvent({category:"carousel"+(b.options.loggingPrefix?"/"+b.options.loggingPrefix:""),action:"next-arrow",label:"click"})});if(this.options.lazyLoadSlider){var c=this.element.find(".slick-slider");c.on("lazyLoaded",function(a,d,e,f){b.element.css("opacity",1);setTimeout(function(){c.addClass("loaded")},750)})}this.element.on("click",".slick-slide",e.proxy(this,"slickSlideClicked"))},slickSlideClicked:function(a){a=
e(a.currentTarget);var b=this.slick.$slides.length,c=a.data("slick-index");0>c?c+=b:c>b&&(c-=b);0<=c&&c<b&&(a=e(this.slick.$slides[c]));d.events.publish(this.options.tileClickEvent,{id:a.attr("id")||a.data("id"),slide:a})}})})(R9,window.jq||window.jQuery);(function(c,d){c.createComponentClass("common.frontdoor.brands.momondo.brandonly.WorldPieceCampaignVideoDialog",{youtubeIframe:null,autoPlayRegex:/(autoplay=(1|0))/,init:function(){this.youtubeIframe=this.getChildElement("world-piece-movie-youtube-iframe")},addEventHandlers:function(){var a=this;c.events.subscribe("world-piece.autoplay.video",function(){var b=a.getVideoUrl().replace(a.autoPlayRegex,"autoplay\x3d1");a.setVideoUrl(b)});c.events.subscribe("dialog.close",function(b){b.id===a.id()&&(b=
a.getVideoUrl().replace(a.autoPlayRegex,"autoplay\x3d0"),a.setVideoUrl(b))})},getVideoUrl:function(){return this.youtubeIframe.attr("src")},setVideoUrl:function(a){this.youtubeIframe.attr("src",a)}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.frontdoor.brands.momondo.brandonly.WorldPieceWatchVideoButton",{videoDialog:null,autoPlay:!0,init:function(){this.videoDialog=this.getChildElement("world-piece-movie-dialog").getWidget()},addEventHandlers:function(){this.watchCampaignVideoClickHandler()},watchCampaignVideoClickHandler:function(){var a=this;a.getChildElement("watch-world-piece-film-button").click(function(){b.Analytics.api.trackEvent({category:"the-world-piece",action:"cta-video"});a.autoPlay&&
(b.events.publish("world-piece.autoplay.video"),a.autoPlay=!1);a.videoDialog.open()})}})})(R9,jQuery);(function(a,c){a.createComponentClass("common.frontdoor.brands.momondo.brandonly.WorldPieceExploreButton",{options:{vsLoggingPrefix:"cta-explore-more"},init:function(){},addEventHandlers:function(){this.exploreMoreButtonClickHandler()},exploreMoreButtonClickHandler:function(){var b=this;b.getChildElement("explore-world-piece-campaign-button").click(function(){a.Analytics.api.trackEvent({category:"the-world-piece",action:b.options.vsLoggingPrefix})})}})})(R9,jQuery);(function(a){a.createComponentClass("common.personalization.SearchHistory",{init:function(){},addEventHandlers:function(){this.subscribe("searchHistory.tileClicked",function(){a.Analytics.api.trackEvent({subPageId:"personalization",category:"searchHistory",action:"itemClicked"})})}})})(R9);(function(a,b){a.createComponentClass("common.seo.LazyImage",{options:{isBackgroundImage:!1},placeholder:void 0,image:void 0,observer:void 0,init:function(){this.placeholder=this.getChildElement("placeholder");this.image=this.getChildElement("image")},addEventHandlers:function(){a.config.getBoolean("ui.horizon.common.momondo.lazyload.pagelevel.enabled",!1)||("IntersectionObserver"in window?this.initIntersectionObserver():this.preloadImage())},initIntersectionObserver:function(){var c=this;this.observer=
new IntersectionObserver(function(a,b){a.forEach(function(a){0<a.intersectionRatio&&(b.unobserve(a.target),c.preloadImage())})});this.observer.observe(b(this.element)[0])},preloadImage:function(){if(this.options.isBackgroundImage)this.element.css("background-image","url("+this.element.data("src")+")"),this.element.fadeTo("slow",1),this.placeholder.remove();else{var a=this;this.image.attr("src",this.image.data("src"));this.image.attr("srcset",this.image.data("srcset"));b(this.image).on("load",function(){a.placeholder.remove();
a.image.fadeTo("slow",1)})}}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.frontdoor.brands.momondo.brandonly.DestinationsSection",{moreBtn:null,colItems:null,mediaSBP:568,bpStylesUnSwapped:!0,init:function(){var a=this;a.colItems=a.element.find(".js-col");a.moreBtn=a.getChildElement("moreButton");a.element.find(".destImg").unveil(0,function(){c(this).on("load",function(){var e=c(this),d=e.parent(".imgWrap").find(".imgHolder");0<d.length&&(d.css("background-image","url("+e.attr("src")+")"),b.dom.swapClasses(d,a.getStlClasses("imgBlockDefault").imgBlockDefault,
a.getStlClasses("imgBlockVisible").imgBlockVisible))})}).trigger("unveil")},addEventHandlers:function(){var a=this;a.element.find(".linkBlock").hover(function(){b.dom.swapClasses(c(this).find(".content"),a.getStlClasses("sectionDefault").sectionDefault,a.getStlClasses("sectionHovered").sectionHovered)},function(){b.dom.swapClasses(c(this).find(".content"),a.getStlClasses("sectionHovered").sectionHovered,a.getStlClasses("sectionDefault").sectionDefault)});a.moreBtn.click(function(){b.dom.swapClasses(a.colItems,
a.getStlClasses("colDefault").colDefault,a.getStlClasses("colUnhide").colUnhide);b.dom.swapClasses(a.moreBtn,a.getStlClasses("moreDefault").moreDefault,a.getStlClasses("moreClicked").moreClicked);a.bpStylesUnSwapped=!1});c(window).resize(function(){!1===a.bpStylesUnSwapped&&c(window).width()>a.mediaSBP&&(b.dom.swapClasses(a.colItems,a.getStlClasses("colUnhide").colUnhide,a.getStlClasses("colDefault").colDefault),b.dom.swapClasses(a.moreBtn,a.getStlClasses("moreClicked").moreClicked,a.getStlClasses("moreDefault").moreDefault),
a.bpStylesUnSwapped=!0)})}})})(R9,jQuery||window.jQuery);(function(a,c){a.createComponentClass("common.frontdoor.brands.momondo.brandonly.ImageCardItem",{options:{itemType:"",apiComponentUrl:"common/frontdoor/brands/momondo/brandonly/utils/MomondoAnywhereAPI"},init:function(){},inlineComponentsReady:function(){this.formatAnywhereUrl.call(this)},urlFormat:"",log:a.logger("common.frontdoor.brands.momondo.brandonly.ImageCardItem"),addEventHandlers:function(){var b=this.getStlClasses();this.element.hover(function(){a.dom.swapClasses(c(this).find(".js-svg"),
b.svgDefault,b.svgHover);a.dom.swapClasses(c(this).find(".js-footer"),b.footerDefault,b.footerHover)},function(){a.dom.swapClasses(c(this).find(".js-svg"),b.svgHover,b.svgDefault);a.dom.swapClasses(c(this).find(".js-footer"),b.footerHover,b.footerDefault)})},formatAnywhereUrl:function(){"ANYWHERE"===this.options.itemType&&(this.urlFormat=this.element.attr("href"),this.setUrl("/"),this.retrieveSearchParams.call(this))},retrieveSearchParams:function(){null!=a.question.ask("flights.fd.searchform")?this.formatExploreUrl.call(this,
a.question.ask("flights.fd.searchform")):null!=a.question.ask("hotels.fd.searchform")?this.formatExploreUrl.call(this,a.question.ask("hotels.fd.searchform")):null!=a.question.ask("cars.fd.searchform")&&this.formatExploreUrl.call(this,a.question.ask("cars.fd.searchform"))},formatExploreUrl:function(b){var a=(b.depart_date_canon+"/"||"").replace(/-/g,""),c=(b.return_date_canon||"").replace(/-/g,""),d="/explore/";b.origin_code&&(d=d+b.origin_code+"/",a&&c&&(d=d+a+c));this.setUrl(d)},setUrl:function(a){this.element.attr("href",
a)}})})(R9,jQuery||window.jQuery);(function(e,f){e.createComponentClass("common.frontdoor.brands.momondo.brandonly.ReleaseSection",{init:function(){var b=f(".js-row");if(0<b.length){var a=1,c=function(a){a.addClass("hidden");a.removeClass("visible")},d=function(){setTimeout(function(){a===b.length&&(c(b.eq(a-1)),a=0);0<a&&c(b.eq(a-1))},5E3);setTimeout(function(){var c=b.eq(a);c.addClass("visible");c.removeClass("hidden");a++;d()},5500)};d()}}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.frontdoor.brands.momondo.brandonly.PromoBoxes",{dialog:null,init:function(){var a=this;a.dialog=a.getChildElement("guarantee-priceDialog");if(0<a.dialog.length)a.element.find(".more").on("click",function(){a.dialog.dialog({preventInitialFocus:!0}).getWidget().open()})}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.frontdoor.FrontDoorContent",{init:function(){this.element.find("img").unveil(500,function(){d(this).on("load",function(){this.style.opacity=1})}).trigger("unveil")},addEventHandlers:function(d){var a=this;c.events.subscribe("frontdoor.vertical.changed",function(b){b.vertical===a.vertical?a.show():a.hide()});c.events.subscribe(["frontdoor.view.changed","fdcontent.view.setview"],function(b){"inline"===b.view||"hidden"===b.view?a.hide():a.show()})},show:function(){this.element.removeClass("hidden")},
hide:function(){this.element.addClass("hidden")}})})(R9,jQuery);(function(c,d){function h(){var a=d.Deferred(),b=d("iframe[src^\x3d'https://smartlock.google.com/iframe/request']");return b.length&&0<b.height()&&b.is(":visible")?a.resolve(b):b.length?a.reject("Google Yolo widget found an iframe but not visible"):a.reject("Google Yolo widget is unable to locate the iframe")}function f(a){var b=d.Deferred();window.setTimeout(b.resolve,a);return b}function g(a,b,c){var e=d.Deferred();a().then(e.resolve).catch(function(d){return 0>=c-1?e.reject(d):f(b).then(g.bind(null,
a,b,c-1)).then(e.resolve).catch(e.reject)});return e}c.createComponentClass("common.authentication.GoogleYolo",{options:{googleClientId:"",iframeLookupAttempts:20,maxWidgetHeight:null,handleReload:!1,isAnon:!1,showYoloEmailSubscriptionPopUp:!1,userEmail:void 0,maxInitializationRetries:1,isDevEnvironment:!1,logHintError:!1,apiTimeout:6E3},hasLoadError:!1,cancelShow:!1,disableForDevEnvironment:!1,init:function(){this.disableForDevEnvironment=this.options.isDevEnvironment&&0>window.location.host.indexOf("localhost")},
addEventHandlers:function(){if(!this.disableForDevEnvironment){var a=this;this.subscribe("signin.open",function(){a.cancelShow=!0});this.options.handleReload&&this.subscribe("googleauth.login.success",function(){setTimeout(function(){window.location.reload(!0)},300)})}},inlineComponentsReady:function(){this.disableForDevEnvironment||this.load()},setupEmailSubscription:function(){c.ajax.execute("common/authentication/GoogleYoloEmailSubscription",{data:{email:this.options.userEmail},appendTo:d("body")}).then(function(){window.deleteMetaCookie("showYoloEmailSubscriptionPopUp");
c.storage.set("yolo-subscription-hide",!0)})},hasValidTimeoutCookie:function(){var a=c.storage.get("google-yolo-hide"),b=new Date;b.setDate(b.getDate()-7);return!isNaN(a)&&parseInt(a)>b.getTime()},getHintPromise:function(){return window.googleyolo.hint({supportedAuthMethods:["https://accounts.google.com"],supportedIdTokenProviders:[{uri:"https://accounts.google.com",clientId:this.options.googleClientId}]})},onHintSuccess:function(a){this.hasLoadError=!1;c.Analytics.api.trackEvent("googleyolo/login");
c.authentication.external.googleYolo.login(a)},retryCount:0,onHintError:function(a){switch(a.type){case "userCanceled":c.storage.set("google-yolo-hide",(new Date).getTime());c.Analytics.api.trackEvent("googleyolo/user-cancel");break;case "noCredentialsAvailable":c.Analytics.api.trackEvent("googleyolo/no-credentials");this.hasLoadError=!0;break;case "requestFailed":if(this.retryCount<this.options.maxInitializationRetries){c.Analytics.api.trackEvent("googleyolo/retryLoad");this.retryCount+=1;this.hasLoadError=
!0;this.initializeWidget();break}default:c.Analytics.api.trackEvent("googleyolo/error/"+a.type),this.options.logHintError&&this.log.error("Google Yolo hint request failed",a),this.hasLoadError=!0}},initializeWidget:function(){0<this.options.apiTimeout&&window.googleyolo.setTimeouts&&window.googleyolo.setTimeouts(this.options.apiTimeout);this.getHintPromise().then(this.onHintSuccess.bind(this),this.onHintError.bind(this));f(500).then(g.bind(null,h,500,this.options.iframeLookupAttempts)).then(this.manipulateIframe.bind(this)).catch(this.logIframeError.bind(this))},
load:function(){if(!this.options.isAnon&&this.options.showYoloEmailSubscriptionPopUp)this.setupEmailSubscription();else if(this.options.isAnon&&!this.hasValidTimeoutCookie()){var a=function(){window.googleyolo?this.cancelShow||(c.Analytics.api.trackEvent("googleyolo/impression"),this.initializeWidget()):!c.globals.adBlock&&c.config.getBoolean("ui.social.debug",!1)&&this.log.warn("Google YOLO login failed to load")}.bind(this);jq.getScript("//smartlock.google.com/client",function(){window.setTimeout(a,
3E3)})}},manipulateIframe:function(a){var b=this.options.maxWidgetHeight;b&&a.height()>b&&a.height(b);a.prop("tabindex",-1)},logIframeError:function(a){this.hasLoadError||this.log.error(a)}})})(R9,jQuery);(function(a,c){a.createComponentClass("base.frontdoor.FrontDoor",{options:{vertical:null},init:function(a){},addEventHandlers:function(c){var d=this;a.events.subscribe("frontdoor.view.changed",function(b){d.element.toggleClass("InlineView","inline"===b.view);a.events.publish("frontdoor.setview",b.view)})}})})(R9,jq||jQuery);(function(a,b){a.createComponentClass("flights.frontdoor.FlightFrontDoor","base.frontdoor.FrontDoor",{})})(R9,jQuery);(function(c,h,g){c.publish("common.kn.Mixin",g.extend({loadGPT:function(){if(!c.common.kn.Mixin.loadedGPT&&c.config&&c.config.getBoolean("ui.gpt.loadOnce",!0)||!window.googletag){c.common.kn.Mixin.loadedGPT=1;window.googletag||(window.googletag={cmd:[]});var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src="//www.googletagservices.com/tag/js/gpt.js";var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}window.googletag.cmd=window.googletag.cmd||
[]},loadAdsense:function(){window._googCsa||function(a,f,d,b,e,c){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)};a[b].t=1*new Date;e=f.createElement(d);c=f.getElementsByTagName(d)[0];e.async=1;e.src="//www.google.com/adsense/search/async-ads.js";c.parentNode.insertBefore(e,c)}(window,document,"script","_googCsa")},findAdDataForType:function(a,c,d){if(!(d&&a&&c&&d[a]))return null;var b,e;for(e in d[a])if(d[a].hasOwnProperty(e)){b=d[a][e];if("string"===typeof b)try{b=JSON.parse(b)}catch(k){b=
null}if(b&&b.pageLocation&&b.pageLocation===c)return b}return null}}))})(R9,jQuery,window.base2.Base);(function(f,g){f.createComponentClass("common.kn.DisplaySra",{options:{slots:null,slotKeyDelim:"",slotsLoadedTimerMS:400,deferGPTLoad:!1,deferUserInteractMS:3E3,eventsEnable:null,eventsDisable:null,lazyLoad:!1,lazyFetch:-999,lazyRender:-999,renderIfNotEmpty:!1,checkRegisteredSlotMatch:!0},enabled:1,delayedGptApiCt:0,hasSlots:0,pendingSlotInfo:null,registeredSlots:null,definedSlots:null,allSlotsRegistered:null,allSlotsRegisteredTimerID:null,allSlotsLoaded:null,boundSlotRenderedListener:null,boundWindowSmartAdResize:null,
pageTargetingLast:null,dfpHideData:null,adBlocked:null,useSlotGroups:!1,intersectionObserver:null,observingSlots:null,waitingSlotGroups:null,init:function(){this.pendingSlotInfo=[];this.registeredSlots={};this.definedSlots={};this.hasSlots=g.isArray(this.options.slots)&&this.options.slots.length},addEventHandlers:function(){this.hasSlots&&(this.subscribe("displayad.sra.register",this.onSraSlotRegisterEvent.bind(this)),this.subscribe("displayad.sra.unregisterAll",this.unregisterAllSlots.bind(this)),
this.subscribe("displayad.sra.destroy",this.onSraSlotDestroyEvent.bind(this)),this.subscribe("displayad.sra.slots.broadcast",this.onSraSlotsBroadcast.bind(this)),this.subscribe("resultspage.adinfo.empty",this.publishAllAdsRequests.bind(this)),this.subscribe("resultspage.ads.update",this.onResultsPageAdsUpdate.bind(this)),this.subscribe("resultspage.ads.options",this.onResultsPageAdsPoll.bind(this)),this.subscribe("adblock.detected",this.onAdBlockDetected.bind(this)),this.options.eventsEnable&&this.options.eventsEnable.pop&&
this.options.eventsEnable.length&&(this.enabled=0,this.subscribe(this.options.eventsEnable,this.onSraEnable.bind(this))),this.options.eventsDisable&&this.options.eventsDisable.pop&&this.options.eventsDisable.length&&this.subscribe(this.options.eventsDisable,this.onSraDisable.bind(this)))},inlineComponentsReady:function(){if(this.hasSlots){f.events.publish("displayad.sra.slots.broadcast",{owner:this,slots:[].concat(this.options.slots)});var a=this,b=f.question.ask("adblock.detected");if(b&&b.adblock)this.onAdBlockDetected();
else this.options.deferGPTLoad?f.events.when("ajaxComponent.highPriority.initialized",function(){a.loadGPT()}):this.loadGPT()}},destroy:function(){g(window).off(this.getWindowMessageEventName());this.boundWindowSmartAdResize&&this.boundWindowSmartAdResize===window.resizeIframeToContents&&(window.resizeIframeToContents=null);this.boundWindowSmartAdResize=null;this.base();this.cleanupSlots()},loadGPT:function(){this.loadedGPT||(this.loadedGPT=1,(new f.common.kn.Mixin).loadGPT())},onSraSlotDestroyEvent:function(a){if(a&&
a.adDivId){var b=this;this.pendingSlotInfo=this.pendingSlotInfo.filter(function(b){return b&&b.adDivId!==a.adDivId});Object.keys(this.registeredSlots).forEach(function(c){c&&b.registeredSlots[c]&&b.registeredSlots[c].adDivId===a.adDivId&&delete b.registeredSlots[c]});this.destroyDefinedSlot(a.adDivId)}},destroyDefinedSlot:function(a){if(window.googletag){var b=this;googletag.cmd.push(function(){b.definedSlots&&b.definedSlots[a]&&(b.intersectionObserver&&b.intersectionObserver.unobserve(document.getElementById(a)),
b.observingSlots&&b.observingSlots.hasOwnProperty(a)&&delete b.observingSlots[a],googletag.destroySlots([b.definedSlots[a]]),delete b.definedSlots[a])})}},onSraSlotsBroadcast:function(a){a&&this!==a.owner&&g.isArray(a.slots)&&(this.options.slots=this.options.slots.filter(function(b){return 0>a.slots.indexOf(b)}),1>this.options.slots.length&&(this.hasSlots=0,this.cleanupSlots(),this.registeredSlots={},this.pendingSlotInfo=[],this.enabled=this.allSlotsRegistered=0))},onSraEnable:function(){this.enabled||
(this.enabled=1,this.checkLoadSlots())},onSraDisable:function(){this.enabled&&(this.enabled=0,this.cleanupSlots())},handleMissingOrigin:function(a){this.loggedMissingParams||(this.loggedMissingParams=1,a&&this.logError("Ad params without origin"))},onSraSlotRegisterEvent:function(a){a&&a.adDivId?a.adBlockOptions?(this.augmentPageOptions(a),a.adBlockOptions.origin?this.updateSlotDataAndLoad(a):this.handleMissingOrigin(a.gptAdID)):a.isAvoidResults?this.logError("No ad targeting for non-results ad"):
(this.pendingSlotInfo.push(a),this.publishOneAdsRequest(a)):this.logError("Missing adOptions ID")},publishAllAdsRequests:function(){var a=[];this.pendingSlotInfo&&this.pendingSlotInfo.length&&(a=this.pendingSlotInfo.filter(function(a){return a&&!a.isAvoidResults}));a=a.concat(Object.values(this.registeredSlots).map(function(a){return a&&!a.isAvoidResults?a:null}));a.forEach(this.publishOneAdsRequest.bind(this))},publishOneAdsRequest:function(a){a&&!a.isAvoidResults&&f.events.publish("ads.request",
{adType:"displayAd",pageLocation:a.pageLocation,now:!a.gptAdID,events:["searchform.submit","resultsHeader.changed","filters.changed","paginator.change"],minRefreshRate:this.options.minRefreshRate})},onResultsPageAdsUpdate:function(a){if(this.enabled){var b=this,c=new f.common.kn.Mixin,d=function(a,c){Object.keys({gptAdID:null,gptTargetID:null,gptAdWidth:null,gptAdHeight:null,gptAdSizes:null,gptPageURL:null,adBlockOptions:null,pageOptions:null,slotGroup:0}).forEach(function(b){c.hasOwnProperty(b)&&
"undefined"!==typeof c[b]&&(a[b]=c[b])});b.augmentPageOptions(a);return a};this.pendingSlotInfo&&this.pendingSlotInfo.length&&this.pendingSlotInfo.forEach(function(e){if(e){var h=c.findAdDataForType("displayAd",e.pageLocation,a);h&&h.adBlockOptions&&h.adBlockOptions.origin&&b.hasSlots&&0<=b.options.slots.indexOf(b.makeSlotKey(h))&&b.updateSlotDataAndLoad(d(e,h))}});this.pendingSlotInfo.length&&(this.pendingSlotInfo=this.pendingSlotInfo.filter(function(a){return!Object.values(b.registeredSlots).some(function(b){return!b||
a.adDivId===b.adDivId})}));this.pendingSlotInfo.length&&g.isEmptyObject(this.registeredSlots)&&this.pendingSlotInfo.some(function(a){return a&&!a.isAvoidResults})&&this.hasSlots?this.publishAllAdsRequests():Object.values(this.registeredSlots).forEach(function(e){var h=c.findAdDataForType("displayAd",e.pageLocation,a);h&&b.updateSlotDataAndLoad(d(e,h))})}},makeSlotKey:function(a){var b=this.getAdSizes(a);return b[0][0]+"x"+b[0][1]+this.options.slotKeyDelim+a.pageLocation+this.options.slotKeyDelim+
a.adBlockOptions.origin},updateSlotDataAndLoad:function(a){var b=this;if(a&&a.adBlockOptions&&a.adDivId&&(a=g.extend({slotKey:this.makeSlotKey(a),adSize:this.getAdSizes(a),adDivId:a.adDivId,smartAd:null},a),a.slotKey&&this.hasSlots&&!(0>this.options.slots.indexOf(a.slotKey)))){var c=this.registeredSlots[a.slotKey];c&&c.adDivId!==a.adDivId&&this.definedSlots&&this.definedSlots[c.adDivId]&&this.destroyDefinedSlot(c.adDivId);this.registeredSlots[a.slotKey]=g.extend({},a);!this.allSlotsRegistered&&0<
this.options.slotsLoadedTimerMS&&(clearTimeout(this.allSlotsRegisteredTimerID),this.allSlotsRegisteredTimerID=setTimeout(function(){var a=f.question.ask("adblock.detected");a&&a.adblock||b.setAllSlotsRegistered()},this.options.slotsLoadedTimerMS));this.checkLoadSlots()}},onSlotRenderedEvent:function(a){this.enabled&&(f.events.publish("displayad.loaded",{slotElementId:a.slot.getSlotElementId()}),!0===this.options.renderIfNotEmpty&&!1===a.isEmpty&&g("#"+a.slot.getSlotElementId()).show())},checkLoadSlots:function(){if(this.enabled&&
this.hasSlots){if(this.options.checkRegisteredSlotMatch)for(var a,b=0;b<this.options.slots.length;b++){if((a=this.options.slots[b])&&!this.registeredSlots[a])return}else if(!this.registeredSlots||g.isEmptyObject(this.registeredSlots))return;this.setAllSlotsRegistered()}},unregisterAllSlots:function(){this.registeredSlots={};this.pendingSlotInfo=[];this.allSlotsRegistered=0;clearTimeout(this.allSlotsRegisteredTimerID)},setAllSlotsRegistered:function(){this.allSlotsRegistered=1;clearTimeout(this.allSlotsRegisteredTimerID);
this.loadAllSlots()},loadAllSlots:function(a){this.enabled&&(this.adBlocked?this.replaceAllAdBlockedSlots():window.googletag&&googletag.apiReady?a?(this.setupAllSlots(),this.allSlotsLoaded=1):this.deferUserInteractID?this.handleDelayedSlotLoad():this.handleDelayedSlotLoad(null,1):this.handleDelayedSlotLoad(1))},handleDelayedSlotLoad:function(a,b){var c=this;this.delayedSlotLoadID&&clearTimeout(this.delayedSlotLoadID);this.delayedSlotLoadID=setTimeout(function(){if(a&&(c.delayedGptApiCt+=1,100<=c.delayedGptApiCt)){var d=
f.question.ask("adblock.detected");100!==c.delayedGptApiCt||d&&d.adblock||f.Analytics.api.trackEvent({category:"sra",action:"error",label:"gptapi"});return}c.loadAllSlots(b)},200)},onResultsPageAdsPoll:function(){if(this.options.deferUserInteractMS&&!g.isEmptyObject(this.definedSlots)){var a=this;this.deferUserInteractID&&clearTimeout(this.deferUserInteractID);this.deferUserInteractID=setTimeout(function(){a.deferUserInteractID=null},this.options.deferUserInteractMS)}},setupAllSlots:function(){var a=
this,b;Object.values(this.registeredSlots).forEach(function(c){!c||a.pageTargetingLast&&a.sameObjectProperties(a.pageTargetingLast,c.pageOptions,["tile"])||(a.pageTargetingLast=g.extend({},c.pageOptions),b=c)});this.pageTargetingLast?"function"!==typeof googletag.pubads?this.logError("Bad googletag pubads"):(this.setWindowEvents(),googletag.cmd.push(function(){b&&a.setupPageTargeting(b);a.boundSlotRenderedListener||(a.boundSlotRenderedListener=a.onSlotRenderedEvent.bind(a),googletag.pubads().addEventListener("slotRenderEnded",
a.boundSlotRenderedListener));Object.values(a.registeredSlots).forEach(function(b){b&&a.setupSlot(b);a.allSlotsLoaded&&g("#"+b.adDivId).show()});a.allSlotsLoaded?a.useSlotGroups?(a.waitingSlotGroups=!0,a.refreshSlotGroups()):googletag.pubads().refresh():(a.useSlotGroups&&googletag.pubads().disableInitialLoad(),googletag.enableServices(),Object.keys(a.definedSlots).forEach(function(a){a&&googletag.display(a)}),a.useSlotGroups&&(a.waitingSlotGroups=!0,a.refreshSlotGroups()))})):this.errPageOptions||
(this.errPageOptions=1,this.logError("Missing slot data page options"))},refreshSlotGroups:function(){var a=this,b=this.observingSlots,c,d,e;this.waitingSlotGroups&&(g.isEmptyObject(b)?this.waitingSlotGroups=this.waitingSlotGroups||!0:(c=Object.values(this.registeredSlots).filter(function(a){return a&&b[a.adDivId]}).map(function(a){return a.slotGroup||-1}).filter(function(b,c,d){return d.indexOf(b)===c&&(!0===a.waitingSlotGroups||0<=a.waitingSlotGroups.indexOf(b))}),c.length&&(d=[],c.forEach(function(b){d=
d.concat(Object.values(a.registeredSlots).filter(function(a){return-1===b?!a.slotGroup:a.slotGroup===b}).map(function(b){return a.definedSlots[b.adDivId]}))}),e=Object.values(this.registeredSlots).filter(function(a){return 0>c.indexOf(a.slotGroup||-1)}).map(function(a){return a.slotGroup||-1}).filter(function(a,b,c){return c.indexOf(a)===b}),e.length?!0===this.waitingSlotGroups?this.waitingSlotGroups=e:(this.waitingSlotGroups=this.waitingSlotGroups.filter(function(a){return 0<=e.indexOf(a)}),this.waitingSlotGroups.length||
(this.waitingSlotGroups=!1)):this.waitingSlotGroups=!1,d.length&&googletag.cmd.push(function(){googletag.pubads().refresh(d)}))))},onObserverEvent:function(a){var b=this;this.observingSlots&&a&&a.forEach(function(a){a&&a.target&&a.target.id&&(b.observingSlots[a.target.id]=a.isIntersecting)});this.refreshSlotGroups()},setupSlotGroupObserver:function(a){if(!(a.slotGroup&&"IntersectionObserver"in window))return!1;var b=document.getElementById(a.adDivId);if(!b)return!1;this.intersectionObserver||(this.intersectionObserver=
new IntersectionObserver(this.onObserverEvent.bind(this),{root:null,threshold:.1}),this.observingSlots={});this.observingSlots.hasOwnProperty(a.adDivId)||(this.observingSlots[a.adDivId]=!1,this.intersectionObserver.observe(b));return!0},augmentPageOptions:function(a){a&&a.pageOptions&&("undefined"===typeof a.pageOptions.xp&&(a.pageOptions.xp=f.globals.experiment),a.isAvoidResults&&"undefined"===typeof a.pageOptions.host&&(a.pageOptions.host="http://"+window.location.hostname))},setupPageTargeting:function(a){googletag.pubads().clearTargeting();
googletag.pubads().enableSingleRequest();this.options.gptIframeTitle&&googletag.setAdIframeTitle(this.options.gptIframeTitle);this.options.isForceSafeFrame&&googletag.pubads().setForceSafeFrame(!0);if(this.options.lazyLoad){var b={};!isNaN(this.options.lazyFetch)&&-1<=this.options.lazyFetch&&(b.fetchMarginPercent=this.options.lazyFetch);!isNaN(this.options.lazyRender)&&-1<=this.options.lazyRender&&(b.renderMarginPercent=this.options.lazyRender);googletag.pubads().enableLazyLoad(b)}a.gptPageURL&&googletag.pubads().set("page_url",
a.gptPageURL);googletag.pubads().collapseEmptyDivs();Object.keys(a.pageOptions).forEach(function(b){b&&googletag.pubads().setTargeting(b,a.pageOptions[b])})},setupSlot:function(a){if(a&&a.adDivId&&a.adBlockOptions){var b=this.definedSlots[a.adDivId],c;b||(c=1,b=googletag.defineSlot(a.gptTargetID,a.adSize,a.adDivId));b?(this.setupSlotGroupObserver(a)&&(this.useSlotGroups=!0),b.clearTargeting(),Object.keys(a.adBlockOptions).forEach(function(c){c&&b.setTargeting(c,a.adBlockOptions[c])}),c&&(b.addService(googletag.pubads()),
this.definedSlots[a.adDivId]=b)):this.errSlotDefine||(this.errSlotDefine=1,this.logError("defineSlot failed"))}else this.errSlotOptions||(this.errSlotOptions=1,this.logError("Missing slot ID or data ad options"))},cleanupSlots:function(){this.boundSlotRenderedListener=this.pageTargetingLast=null;this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,this.useSlotGroups=!1,this.waitingSlotGroups=this.observingSlots=null);if(window.googletag&&googletag.cmd){var a=
this;googletag.cmd.push(function(){var b=[];Object.keys(a.definedSlots).forEach(function(c){b.push(a.definedSlots[c]);delete a.definedSlots[c]});b.length&&googletag.destroySlots(b);a.definedSlots={};a.allSlotsLoaded=0})}},onAdBlockDetected:function(){this.adBlocked||(this.adBlocked=1,this.replaceAllAdBlockedSlots())},replaceAllAdBlockedSlots:function(){if(this.enabled){var a=this;Object.values(this.registeredSlots).forEach(function(b){a.replaceAdBlockedContent(b)})}},replaceAdBlockedContent:function(a){var b,
c=" width\x3d'%s' height\x3d'%s' ",d=a&&a.adDivId?g("#"+a.adDivId):null;a&&a.adBlockedURL&&a.gptAdID&&d?(b=this.getAdSizes(a),c=g.isArray(b)?b[0]&&g.isArray(b[0])?c.format(b[0][0],b[0][1]):c.format(b[0],b[1]):c.format(a.gptAdWidth,a.gptAdHeight),d.html("\x3ciframe class\x3d'had-frame' frameborder\x3d'0' "+c+" scrolling\x3d'no' src\x3d'"+a.adBlockedURL+"'\x3e\x3c/iframe\x3e")):d&&d.hide()},setWindowEvents:function(){var a=this,b=this.getWindowMessageEventName(),c;this.dfpHideData={};Object.values(this.registeredSlots).forEach(function(b){b&&
b.adBlockOptions&&b.adBlockOptions.pos&&b.adBlockOptions.origin&&(c=b.adBlockOptions.origin.match(/\w+\.\w*\.(\w+)\./))&&1<c.length&&c[1]&&(a.dfpHideData[c[1]+"."+b.adBlockOptions.pos+".NoAd"]=g.extend({},b))});g(window).off(b).on(b,this.onWindowMessage.bind(this))},getWindowMessageEventName:function(){return"message.displayad-"+this.id()},onWindowMessage:function(a){var b,c,d;this.enabled&&a&&a.originalEvent&&((c=this.options.smartAdWinMessageHosts||"")&&(c=c.replace(/(http(s)?:)?\/\//g,window.location.protocol+
"//")),c+=","+window.location.protocol+"//"+window.location.host,this.dfpHideData&&a.originalEvent.data&&this.dfpHideData[a.originalEvent.data]?(c=this.dfpHideData[a.originalEvent.data])&&c.adDivId&&(g("#"+c.adDivId).hide(),f.config.getBoolean("ui.horizon.ads.trackCollapse",!0)&&f.Analytics.api.trackEvent({category:"sra",action:"adcollapse",label:c.pageLocation})):a.originalEvent.origin&&0<=c.indexOf(a.originalEvent.origin)&&this.options.smartAdWinMessageID&&a.originalEvent.data[this.options.smartAdWinMessageID]&&
((d=a.originalEvent.data[this.options.smartAdWinMessageID].pos)?(b=this,Object.values(this.registeredSlots).forEach(function(c){c.adBlockOptions&&d===c.adBlockOptions.pos&&b.kickoffSmartAd(a.originalEvent.data[b.options.smartAdWinMessageID],c)})):this.logError("No pos for smartad data: "+d)))},kickoffSmartAd:function(a,b){if(f.config.getBoolean("ui.horizon.ads.loadSmartAd",!0)&&a&&b&&b.adDivId&&(a.searchid||(a.searchid=this.options&&this.options.pageOptions?this.options.pageOptions.searchid:null),
a.provider_code&&a.searchid)){var c=this.getSmartAdURL(a);if(c){this.boundWindowSmartAdResize||(this.boundWindowSmartAdResize=this.onSmartAdGlobalResize.bind(this),window.resizeIframeToContents=this.boundWindowSmartAdResize);window.R9.Ads=window.R9.Ads||{};window.R9.Ads.SmartAd=window.R9.Ads.SmartAd||{slots:{R0:{},R1:{},M0:{}},adjustBannerContainerSize:g.noop()};var d="",e=b.adBlockOptions&&b.adBlockOptions.origin;"string"===typeof a.sz&&(d=(d=a.sz.split("x"))&&2===d.length&&parseInt(d[0])&&parseInt(d[1])?
" width\x3d'"+d[0]+"' height\x3d'"+d[1]+"' ":"");b.smartAd=g.extend({rank:b.gptAdID?b.gptAdID.substr(b.gptAdID.length-1,1):null,origin:e&&1<e.length?e.substr(e.length-2,2):null,reloaded:0,sized:0},a);this.subscriptions&&this.subscriptions["search.poll.response"]||this.subscribe("search.poll.response",this.onSmartAdSearchPoll.bind(this));g("#"+b.adDivId).html("\x3ciframe class\x3d'smartad-frame' frameborder\x3d'0' "+d+" scrolling\x3d'no' src\x3d'"+c+"'\x3e\x3c/iframe\x3e")}else f.Analytics.api.trackEvent({category:"smartad",
action:"urlfail",label:b.pageLocation})}},onSmartAdSearchPoll:function(a){if(a&&a.completed){this.unsubscribe("search.poll.response");var b=this;Object.values(this.registeredSlots).forEach(function(a){a&&a.smartAd&&!a.smartAd.reloaded&&(a.smartAd.reloaded=1,a.smartAd.sized=0,setTimeout(function(){a.smartAd&&g("#"+a.adDivId).find(".smartad-frame").attr("src",b.getSmartAdURL(a.smartAd,"false")+"\x26reload\x3d1")},100))})}},onSmartAdGlobalResize:function(){var a=this;Object.values(this.registeredSlots).forEach(function(b){a.resizeSmartAd(b)})},
resizeSmartAd:function(a){if(a&&a.adDivId&&a.smartAd&&!a.smartAd.sized){var b=g("#"+a.adDivId),c=b.find("iframe.smartad-frame").first(),d,e,f;if(c.length){try{d=c.contents().find("body")}catch(k){return}a.smartAd.sized=1;a=c.outerWidth();e=c.outerHeight();f=d.outerWidth();d=d.outerHeight();2>f||2>d?b.hide():(a!==f&&c.attr("width",f),e!==d&&c.attr("height",d),b.outerWidth()!==f&&(b.width("auto"),b.css("max-width","none")),b.outerHeight()!==d&&(b.height("auto"),b.css("max-height","none")))}}},getSmartAdURL:function(a,
b){if(!a)return null;"true"!==b&&"false"!==b&&(b="true");var c=a.rank||0,d=a.origin||"R0",e=a.provider_code?encodeURIComponent(a.provider_code):"",f=a.click_tracking?encodeURIComponent(a.click_tracking):"",g=a.sz?encodeURIComponent(a.sz):"";return"/h/ads/smartad?provider_code\x3d"+e+"\x26searchid\x3d"+a.searchid+"\x26clicktracking\x3d"+f+"\x26sz\x3d"+g+"\x26rank\x3d"+c+"\x26logimpr\x3d"+b+"\x26strm\x3d\x26pageorigin_location\x3d"+d+"\x26isstreaming\x3d"},getAdSizes:function(a){var b;a.gptAdSizes&&
(b=this.validateAdSizes(a.gptAdSizes));return b||this.validateAdSizes([parseInt(a.gptAdWidth),parseInt(a.gptAdHeight)])},validateAdSizes:function(a){var b=function(a){return!isNaN(a)&&0<a&&9999>a&&a===parseInt(a,10)},c=function(a){return a&&a.pop&&2===a.length&&b(a[0])&&b(a[1])};if(!a||!a.pop)return null;if(c(a))return a;for(var d=0;d<a.length;d++)if(!c(a[d]))return null;return a},sameObjectProperties:function(a,b,c){if(!a||!b)return!1;var d;c=c||[];for(d in a)if(a.hasOwnProperty(d)&&!b.hasOwnProperty(d))return!1;
for(d in b)if(b.hasOwnProperty(d)){if(!a.hasOwnProperty(d))return!1;if(!(0<=c.indexOf(d))&&a[d]!==b[d]){var e=a[d];if(e=e!==e)e=b[d],e=e!==e;if(!e)return!1}}return!0},logError:function(a){f.config.getBoolean("ui.ads.sra.log",!0)&&this.log.error(a)}})})(window.R9,window.jQuery);(function(b){R9.extend("Widgets",{NumberBox:function(a,c){this.inputNode=b(a).find("input")[0];this.jqNode=b(a);if(!this.isValidElement())return this;this.options=b.extend({},this.options,c);this.init()}});R9.extend("Widgets.NumberBox.prototype",{widgetName:"r9NumberBox",inputNode:null,jqNode:null,options:{min:0,max:6,defaultValue:0,callback:b.noop,validator:null,onlyDecorateDisabledButtons:!1},boxValue:0,incrButton:null,decrButton:null,styleJamButton:null,isValidElement:function(){return this.jqNode&&
this.jqNode.children().hasClass("incrementor")&&this.jqNode.children().hasClass("decrementor")&&this.jqNode.children().hasClass("numberHolder")},canChange:function(a){return"function"===typeof this.options.validator?this.options.validator.call(this,a,this.boxValue):!0},getStyleJamButton:function(){return R9.stylejam&&R9.stylejam.common&&R9.stylejam.common.widgets&&R9.stylejam.common.widgets.button?R9.stylejam.common.widgets.button.StyleJamButton:null},increment:function(){if(this.boxValue<this.options.max&&
this.canChange(1))return this.boxValue+=1,this.updateView(),this.options.callback.call(this,1,this.boxValue),!0;this.disableButton(this.incrButton);return!1},decrement:function(){if(this.boxValue>this.options.min&&this.canChange(-1))return--this.boxValue,this.updateView(),this.options.callback.call(this,-1,this.boxValue),!0;this.disableButton(this.decrButton);return!1},updateView:function(){b(this.inputNode).val(this.boxValue);b(this.inputNode).trigger("change");b(this.jqNode).attr("aria-valuenow",
this.boxValue);this.boxValue===this.options.max?(this.enableButton(this.decrButton),this.disableButton(this.incrButton)):(this.boxValue===this.options.min?this.disableButton(this.decrButton):this.enableButton(this.decrButton),this.enableButton(this.incrButton));this.ariaLabel&&this.ariaLabel.length&&this.ariaLabelMessage&&this.updateAriaLabel()},updateAriaLabel:function(){this.ariaLabelUpdateId&&(window.clearTimeout(this.ariaLabelUpdateId),this.ariaLabelUpdateId=null);this.ariaLabelUpdateId=window.setTimeout(function(){var a;
a=-1<this.ariaLabelMessage.indexOf("|")?R9.Common.Utils.String.formatChoice(this.ariaLabelMessage,this.boxValue,this.boxValue):R9.Common.Utils.String.formatString(this.ariaLabelMessage,this.boxValue);this.ariaLabel.html(a)}.bind(this),200)},getValue:function(){return this.boxValue},setValue:function(a,b){a=parseInt(a);if(isNaN(a)||this.boxValue===a)return!1;var c=a-this.boxValue;if(!b&&!this.canChange(c))return!1;this.boxValue=a;this.updateView();this.options.callback&&this.options.callback.call(this,
c);return!0},init:function(){this.styleJamButton=this.getStyleJamButton();this.boxValue=""!=this.inputNode.value?parseInt(this.inputNode.value,10):0;this.incrButton=this.jqNode.find(".incrementor");this.decrButton=this.jqNode.find(".decrementor");this.jqNode.data(this.widgetName,this);0<this.options.defaultValue?this.setValue(this.options.defaultValue):!isNaN(this.options.max)&&this.boxValue>this.options.max&&(this.boxValue=this.options.max);b(this.inputNode).prop("readonly","readonly");this.inputNode.value=
this.boxValue;var a=this;this.incrButton.unbind("click").click(function(b){a.increment();jq(a.jqNode).trigger("increment");return!1});this.decrButton.unbind("click").click(function(b){a.decrement();jq(a.jqNode).trigger("decrement");return!1});this.updateView()},enableButton:function(a){a.removeClass("NumberBox-disabled").prop("disabled",!1).attr("aria-disabled","false");this.styleJamButton&&R9.dom.swapClasses(a,this.styleJamButton.plusMinusButtonDisabled,this.styleJamButton.plusMinusButtonEnabled)},
disableButton:function(a){a.addClass("NumberBox-disabled");this.options.onlyDecorateDisabledButtons||a.prop("disabled",!0).attr("aria-disabled","true");this.styleJamButton&&R9.dom.swapClasses(a,this.styleJamButton.plusMinusButtonEnabled,this.styleJamButton.plusMinusButtonDisabled)},disableDecrement:function(){this.disableButton(this.decrButton)},enableDecrement:function(){this.enableButton(this.decrButton)},disableIncrement:function(){this.disableButton(this.incrButton)},enableIncrement:function(){this.enableButton(this.incrButton)}})})(jq||
jQuery);
(function(b,a){b.createWidgetClass("number.NumberBox",a.extend({},b.Widgets.NumberBox.prototype,{init:function(b){this.inputNode=a(b).find("input")[0];this.jqNode=a(b);if(!this.isValidElement())return this;this.boxValue=""!==this.inputNode.value?parseInt(this.inputNode.value,10):0;this.incrButton=this.jqNode.find(".incrementor-js");this.decrButton=this.jqNode.find(".decrementor-js");0<this.options.defaultValue&&0===this.boxValue&&this.setValue(this.options.defaultValue,!0);a(this.inputNode).prop("readonly","readonly");
this.updateView()},isValidElement:function(){return!0},canChange:function(b){return"function"===typeof this.options.validator?this.options.validator.call(this,b,this.boxValue):!0},addEventHandlers:function(a){var c=this;this.incrButton.unbind("click").click(function(b){c.increment();jq(c.jqNode).trigger("increment");return!1});this.decrButton.unbind("click").click(function(b){c.decrement();jq(c.jqNode).trigger("decrement");return!1});this.element.keyup(function(a){if(a.altKey||a.ctrlKey||a.shiftKey)return!0;
switch(a.keyCode){case b.globals.keyCodes.DOWN:case b.globals.keyCodes.LEFT:case b.globals.keyCodes.PAGE_DOWN:return c.decrement(),jq(c.jqNode).trigger("decrement"),a.preventDefault(),a.stopPropagation(),!1;case b.globals.keyCodes.UP:case b.globals.keyCodes.RIGHT:case b.globals.keyCodes.PAGE_UP:return c.increment(),jq(c.jqNode).trigger("increment"),a.preventDefault(),a.stopPropagation(),!1}});this.element.on("keydown",function(a){if(a.altKey||a.ctrlKey||a.shiftKey)return!0;switch(a.keyCode){case b.globals.keyCodes.PAGE_UP:case b.globals.keyCodes.PAGE_DOWN:case b.globals.keyCodes.HOME:case b.globals.keyCodes.END:case b.globals.keyCodes.LEFT:case b.globals.keyCodes.UP:case b.globals.keyCodes.RIGHT:case b.globals.keyCodes.DOWN:return a.preventDefault(),
a.stopPropagation(),!1}})},setValue:function(a,b){a=parseInt(a);if(isNaN(a)||this.boxValue===a)return!1;var c=this.boxValue>a?this.boxValue-a:a-this.boxValue;this.canChange(c)&&(this.boxValue=a,this.updateView(),this.options.callback&&!b&&this.options.callback.call(this,c))},decrement:function(){if(this.boxValue>this.options.min&&this.canChange(-1))return--this.boxValue,this.updateView(),this.options.callback.call(this,-1,this.boxValue),!0;this.decrButton.addClass("NumberBox-disabled").attr({disabled:"disabled",
"aria-disabled":"true"});return!1}}))})(window.R9,window.jQuery);(function(g,d){g.createWidgetClass("dropdown.DropdownDialog",{element:null,elementNode:null,content:null,placeholder:null,label:null,value:null,icon:null,isOpen:!1,leftOffset:0,ajaxLoadFailed:!1,eventSuffix:null,openDisabled:!1,subValue:null,animationDuration:200,changePosition:!1,positionCss:{},options:{autoOpen:!1,alignment:null,direction:"down",isPopover:!1,showIcon:!0,matchWidth:!1,isFixedWidth:!1,repositionWithStyle:!1,scrollOffset:157,fixedPositionOffset:45,loadWithAjaxOnInit:!1,ajaxUrl:"",
ajaxData:{},iconClass:"",contentClass:"",triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:"",topOffset:0,leftOffset:0,removeZIndex:!1,flippable:!0,delayShowDropdown:d.noop,showDropdownDelay:200,hasSubValue:!1,animateClose:null,expandTo:null,forceTriggerWidth:!1,useCover:!1,closeEvent:null,stopClickPropagation:!1,checkIsOutsideScreen:!1,tooltipIcon:"",tooltipText:"",showModalBp:-1},init:function(){!this.options.alignment&&this.element&&this.element.data("alignment")&&
(this.options.alignment=this.element.data("alignment"));!this.options.expandTo&&this.element&&this.element.data("expandto")&&(this.options.expandTo=this.element.data("expandto"));this.options.alignment||(this.options.alignment="left");this.eventSuffix=".DropdownDialog."+this.id();this.options.autoOpen&&this.open();if(this.options.onInit)this.options.onInit(this);this.createContent();this.elementNode=this.element[0];this.createTrigger();this.popoverArrow=this.getChildElement("popover-arrow");this.options.loadWithAjaxOnInit&&
this.options.ajaxUrl&&this.loadAjax();this.options.alignment||(this.options.alignment="left");this.options.useCover&&(this.cover=this.getChildElement("cover"),this.coverInner=this.getChildElement("cover-inner"));if(this.options.tooltipIcon){var a=this.getChildElement("tooltip");a.toolTip({content:a.data("message"),extraClass:"halfWidth"})}},closeOnBodyClick:function(a){this.isOpen&&(!this.content||!this.content[0]||this.content[0]!==a.target&&1>this.content.find(a.target).length)&&this.close()},changeDropdownPosition:function(a){this.id()===
a.id&&(this.changePosition=a.changePosition,this.positionCss=a.positionCss)},addEventHandlers:function(){var a=this,b;b=this.options.triggerClass?d("."+a.options.triggerClass):d(a.element);g.globals.testMode&&b.attr("data-test-popover-trigger","");var c=this.closeOnBodyClick.bind(this),e=["authentication.showLogin","trips.menu.open","afterclick.dialog.opened","common.dropdown.closeAll"];this.options.closeEvent&&e.push(this.options.closeEvent);this.subscribe(e,this.close.bind(this,null,!0));this.subscribe("travelers.dropdown.change.position",
this.changeDropdownPosition.bind(this));var f="click.dialog"+this.eventSuffix,h=d("body");this.registerEvent("click"+this.eventSuffix,b,function(b){a.options.stopClickPropagation&&b.stopPropagation();h.off(f,c);a.toggleContent();a.isOpen&&setTimeout(function(){h.on(f,c)},10)});if(this.isOpen)h.on(f,c);this.registerEvent("keydown",function(b){if(13===b.which||32===b.which)a.element.trigger("click"),b.preventDefault(),b.stopImmediatePropagation(),b.stopPropagation()})},bindOpenDialogEvents:function(){var a=
this;d(document).on("keydown"+this.eventSuffix,function(b){27===b.which&&a.close(b,null,!0)});d(window).on("resize"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});d(document).on("scroll"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});d(".viewport").on("scroll"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});var b=function(){a.element.is(":visible")&&(g.Common.Utils.Browsers.isIE(11)||setTimeout(function(){a.reposition(!0)},25))};this.registerEvent("click",this.content.find(".close"),
this.close.bind(this));this.registerEvent("mouseup touchend",this.content,b);this.subscribe("horizon.dropdownDialog.reposition",b)},destroy:function(){this.base();this.removeOpenDialogEvents()},removeOpenDialogEvents:function(){d(".viewport").off("scroll"+this.eventSuffix);d(window).off("resize"+this.eventSuffix);d(document).off("scroll"+this.eventSuffix).off("keydown"+this.eventSuffix);d(document.body).off("click"+this.eventSuffix).off("click.dialog"+this.eventSuffix)},createContent:function(){this.content=
this.options.content?d(this.options.content):d("#"+this.element.attr("id")+"_content");this.options.isFixedWidth&&this.content.css("width",this.getTriggerWidth()+"px");this.content.hasClass("open")&&(this.isOpen=!0)},createTrigger:function(){this.element.hasClass("open")&&(this.isOpen=!0);this.label=this.element.find(".label");this.label.length||(this.label=d("\x3cdiv\x3e",{"class":"label"}),this.element.prepend(this.label));this.placeholder=this.element.find(".placeholder");this.placeholder.length||
(this.placeholder=d("\x3cdiv\x3e",{"class":"placeholder",text:this.options.placeholder}),this.element.append(this.placeholder));this.options.showIcon&&(this.icon=this.element.find(".icon"),this.icon.length||(this.icon=d("\x3cdiv\x3e",{"class":"icon "+this.options.iconClass}),this.element.append(this.icon)));this.options.hasSubValue&&(this.value=this.label.find(".value"),this.value.length||(this.value=d("\x3cdiv\x3e",{"class":"value"}),this.label.prepend(this.value)),this.subValue=this.label.find(".subValue"),
this.subValue.length||(this.subValue=d("\x3cdiv\x3e",{"class":"subValue"}),this.label.prepend(this.subValue)));if(this.options.text)this[this.options.hasSubValue?"updateValue":"updateLabel"](this.options.text);else if(!this.options.hasSubValue){var a=this.label.html();a&&a.trim()&&this.updateLabel(a.trim())}},open:function(){if(!this.openDisabled){this.isOpen=!0;var a=this,b="body";if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=
setTimeout(this.open.bind(this),this.options.showDropdownDelay);else{null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);this.bindOpenDialogEvents();this.options.container&&""!==this.options.container&&(b=this.options.container,d(a.options.container).off("scroll."+a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.repositionWithJS()}));this.options.isPopover&&this.popoverArrow.show();this.content.appendTo(b);if(this.options.onOpen)this.options.onOpen(this);
this.repositionWithJS();this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!0);a.element.addClass("open");a.content.addClass("open");this.content.attr("aria-expanded",!0);this.element.attr("aria-expanded",!0);this.content.data("owner",this.element.attr("id"));g.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);g.events.publish("DropdownDialog.open",{id:a.id()});this.toggleCover(!0);this.setupTabKeyHandling();this.styleForModal(!0);this.changePosition&&
this.id()&&this.content.css({top:d(document).scrollTop()+this.positionCss.top+"px",left:this.positionCss.left+"px"})}}},setupTabKeyHandling:function(){var a=this,b=this.getFocusableElements();b.length&&(a.content.off("keydown","**"),setTimeout(function(){d(b[0]).focus();a.content.on("mouseover","a, [tabindex]",function(){a.content.find(":focus").trigger("blur")});a.content.on("keydown",function(c){b=a.getFocusableElements();var e=c.target,d=b.get(0)===e,e=b.get(b.length-1)===e;9===c.which&&(1===b.length||
d&&c.shiftKey||e&&!c.shiftKey)&&(a.toggleContent(),a.element.focus())})},25))},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible, a[href]:visible").not("[tabindex\x3d-1],[disabled]")},_close:function(a,b,c){var e=this.isOpen,d=this;this.isOpen=!1;this.options.isPopover&&this.popoverArrow.hide();this.element.removeClass("open");this.content.removeClass("open");this.toggleCover(!1);d.element.after(d.content);c&&setTimeout(function(){d.element.focus()},1);if(this.options.onClose)this.options.onClose(e,
this,a);g.events.publish("DropdownDialog.close",{id:d.id(),silent:!!b});this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!1);this.content.attr("aria-expanded",!1);this.element.attr("aria-expanded",!1);g.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1);this.styleForModal(!1)},close:function(a,b,c){if(!c||"object"!==typeof c||c.avoidElementId!==this.id()){this.options.repositionWithStyle&&this.resetPosition();this.removeOpenDialogEvents();if(this.options.animateClose){var d=
this;this.animateClose(function(){d._close(a,b,c)})}else this.isOpen&&this._close(a,b,c);null!=a&&a.stopPropagation()}},toggleContent:function(){this.isOpen?this.close(null,null,!0):this.open()},updateLabel:function(a,b,c){b&&(a+=(c||"")+b);this.label.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},updateValue:function(a){a=a||"";this.value.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},hasValue:function(){return this.element.hasClass("hasValue")},
resetPosition:function(){this.content.css({position:"absolute"})},reposition:function(a){if(this.options.repositionWithStyle){var b;window.scrollY>this.options.scrollOffset?(b={position:"fixed",top:this.options.fixedPositionOffset+"px"},this.content.css(b),this.changePosition&&this.content.css({top:d(document).scrollTop()+this.positionCss.top+"px",left:this.positionCss.left+"px"})):(b={position:"absolute"},this.content.css(b),this.repositionWithJS(a))}else this.repositionWithJS(a)},repositionForNonModal:function(){var a=
this.showInModal();if(this.modalActive()&&a)return!1;this.styleForModal(a);return!a&&!this.modalActive()},repositionWithJS:function(a){if(this.repositionForNonModal()){var b=this.options.direction,c=this.options.alignment,e=this.element.offset(),f=d(this.options.container),h=d("#"+this.options.expandTo),g=h.length&&h.is(":visible"),l=g?h.offset():null;a=a||!1;if(f.length)var k=f.offset(),e={top:e.top-k.top+f.scrollTop(),left:e.left-k.left};else f=d(window);k=e.top+this.element.outerHeight();0===this.element.width()&&
0!==this.element.position().top&&(k+=window.scrollY);this.shouldFlipDirection(b)&&(b=this.getReversedDirection(b));this.shouldFlipAlignment(c)&&(c=this.getReversedDirection(c));this.updateAnimationClass(b,c);this.content.toggleClass("noAnimation",a);"up"===b?(this.content.addClass("up"),k=e.top-this.content.outerHeight()):this.content.removeClass("up");if("left"===b||"right"===b)k="up"===this.options.alignment?e.top-this.element.outerHeight()/2:"down"===this.options.alignment?e.top-this.content.outerHeight()+
this.element.outerHeight():e.top+this.element.outerHeight()/2-this.content.outerHeight()/2;a={top:Math.floor(k)+"px"};g?"right"===c?a.right=Math.floor(f.width()-h.width()-l.left)+"px":a.left=Math.floor(l.left)+"px":"left"===b?a.right=Math.floor(f.width()-e.left)+"px":"right"===b?a.left=Math.floor(e.left+this.element.width())+"px":"right"===c||"window-center-desktop"===c?"window-center-desktop"==c&&768<=window.innerWidth?(a.right="",a.left=Math.floor(window.innerWidth/2-this.content.outerWidth()/2)+
"px"):(a.left="",b=this.getTriggerWidth(),38>b&&!this.options.forceTriggerWidth&&(b=38),a.right=Math.floor(f.width()-(e.left+b))+"px"):a.left="center"===c?Math.floor(e.left-this.content.outerWidth()/2)+this.getTriggerWidth()/2+"px":"window-center"===c?Math.floor(window.innerWidth/2-this.content.outerWidth()/2)+"px":Math.floor(e.left)+"px";this.options.topOffset&&0!==this.options.topOffset&&(a.marginTop=this.options.topOffset+"px");this.options.leftOffset&&0!==this.options.leftOffset&&(a.right?a.right=
parseInt(a.right.replace("px",""))-this.options.leftOffset+"px":a.left&&(a.left=parseInt(a.left.replace("px",""))+this.options.leftOffset+"px"));this.leftOffset&&(a.marginLeft=this.leftOffset+"px");this.options.isPopover&&"right"===c&&(a.left=Math.floor(e.left+this.getTriggerWidth()+22)+"px",a.top=Math.floor(k-45)+"px");c=this.options.isFixedWidth?"width":"minWidth";this.options.matchWidth?a[c]=this.getTriggerWidth()+"px":g?a[c]=h.outerWidth()+"px":a.minWidth="";this.options.removeZIndex||(a.zIndex=
this.element.zIndex()+9999);this.options.checkIsOutsideScreen&&(h=this.content.outerWidth(),f=f.outerWidth(),g=!1,h>=f?g=!0:(c=parseInt(a.left,10),e=parseInt(a.right,10),c&&c+h>=f?g=!0:e&&e+h>=f&&(g=!0)),g&&(a.left="0px",a.right="auto",a.maxWidth=f+"px"));this.content.css(a);this.changePosition&&this.content.css({top:d(document).scrollTop()+this.positionCss.top+"px",left:this.positionCss.left+"px"})}},styleForModal:function(a){a&&this.showInModal()?(this.content.css({top:0,left:0,right:0,maxWidth:"100%",
minHeight:"100vh"}),this.content.addClass("modal"),this.content.toggleClass("noAnimation",!0),d("body").addClass("modal-open"),this.addedModalOpen=!0):this.addedModalOpen&&(this.addedModalOpen=!1,this.content.removeClass("modal"),d("body").removeClass("modal-open"))},modalActive:function(){return this.content.hasClass("modal")},shouldFlipDirection:function(a){if(this.options.flippable){var b=d(window).scrollTop(),c=b+d(window).outerHeight(),e=this.content.outerHeight(),f=this.element.offset().top,
c=f+this.element.outerHeight()+e>c,b=f-e<b;if("down"===a)return c&&!b;if("up"===a)return b&&!c}return!1},shouldFlipAlignment:function(a){if(this.options.flippable){var b=d(window).width(),c=this.content.width(),e=this.element.offset().left,f=this.element.width(),f=0>=e+("left"===a?0:f)-c,b=e+("left"===a?c:0)>=b;if("left"===a)return!f&&b;if("right"===a)return f&&!b}return!1},getReversedDirection:function(a){switch(a){case "down":return"up";case "up":return"down";case "left":return"right";case "right":return"left";
case "bottom":return"top";case "top":return"bottom";case "center":return"center"}return a},updateAnimationClass:function(a,b){a=this.getDirectionClass(a,b);this.content.hasClass(a)||this.content.removeClass(function(a,b){return(b.match(/\banimate-\S+/g)||[]).join(" ")}).addClass(a).removeAttr("style")},getDirectionClass:function(a,b){var c;"left"===a||"right"===a?(c="down"===b?"top":"bottom",a="center"===a?"right":this.getReversedDirection(a)):(c="down"===a?"top":"bottom",a="center"===b?"right":b);
return"animate-"+c+"-"+a},loadAjax:function(){var a=this;return g.ajax.execute(this.options.ajaxUrl,{data:this.options.ajaxData,customUpdate:function(b){b.innerHTML&&""!==b.innerHTML?a.content.html(b.innerHTML):(a.element.remove(),a.content.remove(),a.ajaxLoadFailed=!0);return!0}})},getTriggerWidth:function(){var a=this.elementNode.getBoundingClientRect();return a?a.right-a.left:this.element.outerWidth()},animateClose:function(a){var b=this,c=this.content.attr("class");(c=c&&c.match(/\banimate-\S+/))&&
c.length&&(this.content.removeClass(c[0]),window.setTimeout(function(){b.content.addClass(c[0]+" close-animation")},1),window.setTimeout(function(){a();b.content.removeClass("close-animation")},this.animationDuration))},toggleCover:function(a){this.options.useCover&&(a?this.coverInner.css("transform","scale("+(this.cover.outerWidth()+2)/this.element.outerWidth()+", 1.333)"):this.coverInner.css("transform","scale(1)"))},showInModal:function(){return 0<this.options.showModalBp&&d(window).outerWidth()<
this.options.showModalBp&&this.content.hasClass("open")}})})(window.R9,window.jQuery);(function(c,g){var m="adults seniors youth child seatInfant lapInfant".split(" ");c.createComponentClass("flights.search.FlightTravelerDropdown",{travelerSelect:null,travelers:null,cabinType:null,adults:null,seniors:null,youth:null,child:null,seatInfant:null,lapInfant:null,baggageCount:null,students:null,numBoxes:null,errorMessageElement:null,options:{autoSubmit:!1,showStudents:!1,showBaggage:!1,maxTravelers:5,rising:!1,msg:{travelersDropdownCaptionSingleAdult:"",travelersDropdownCaptionSingleSenior:"",
travelersDropdownCaptionSingleChild:"",travelersDropdownCaptionTravelersChoice:""},errorMsg:{minimumTravelers:"",maximumTravelers:"",lapInfantsExceedAdults:"",unaccompaniedMinors:""},dataQuestion:"flights.search.travelers",separatedStyling:!1},numTravelers:1,init:function(){this.travelers=[];this.numBoxes=[];this.adults=this.bindNumberBox("adults");this.seniors=this.bindNumberBox("seniors");this.youth=this.bindNumberBox("youth");this.child=this.bindNumberBox("child");this.seatInfant=this.bindNumberBox("seatInfant");
this.lapInfant=this.bindNumberBox("lapInfant");this.cabinType=this.getChildElement("cabinType");var a=this;this.travelerTypes=m.filter(function(b){return!!a[b]});this.options.showBaggage&&(this.baggageCount=this.bindBaggageCountNumberBox());this.options.showStudents&&(this.students=this.bindNumberBox("students"));this.calculateTravelers();this.updateBoxButtons(this.adults,"adults");this.element.data("component",this);this.errorMessageElement=this.getChildElement("errorMessage")},addEventHandlers:function(){var a=
this;this.travelerSelect=this.getChildElement("dialog").dropdownDialog().getWidget();this.getChildElement("close").click(function(){a.travelerSelect.close()});this.cabinType=this.options.separatedStyling?this.getChildElement("cabinType").radioButtonSet({change:this.onCabinTypeChange.bind(this)}).getWidget():this.getChildElement("cabinType").dropdown({change:this.onCabinTypeChange.bind(this)}).getWidget();this.answer(this.options.dataQuestion,function(){return a.serialize()});this.subscribe("flights.search.travelers.set",
function(b){a.adults.setValue(b.adults||0,!0);a.setSeniors(b.seniors||0,!0);a.youth.setValue(b.youth||0,!0);a.child.setValue(b.child||0,!0);a.seatInfant.setValue(b.seatInfant||0,!0);a.lapInfant.setValue(b.lapInfant||0,!0);a.options.showBaggage&&a.baggageCount.setValue(b.baggageCount||0,!0);a.options.showStudents&&a.students.setValue(b.students||0,!0);a.options.separatedStyling?a.cabinType.setButtonCheckedByValue(b.cabin):a.cabinType.setValue(b.cabin);a.calculateTravelers();c.events.publish("flights.search.travelers.lapInfant",
{count:a.lapInfant.getValue()});a.updateDisplay()});this.subscribe("flights.inline.travelers.open",function(){a.travelerSelect.open()})},bindBaggageCountNumberBox:function(){var a=this;return this.getChildElement("baggageCount").numberBox({callback:function(b){a.onBaggageCountChange(this,b,"baggageCount")},max:2}).getWidget()},bindNumberBox:function(a){var b=this,c="adults"===a||"seniors"===a;(c=this.getChildElement(a).numberBox({validator:function(c){return b.validate(this,c,a)},callback:function(c){b.onTravelersChange(this,
c,a)},max:c?b.options.maxAdults:b.options.maxChildren}).getWidget())&&this.numBoxes.push({id:a,obj:c});return c},calculateTravelers:function(){this.numTravelers=this.adults.getValue()+this.getSeniors()+this.youth.getValue()+this.child.getValue()+this.seatInfant.getValue()+this.lapInfant.getValue();this.options.showStudents&&(this.numTravelers+=this.students.getValue())},getSeniors:function(){return"undefined"!==typeof this.seniors?this.seniors.getValue():0},setSeniors:function(a){"undefined"!==typeof this.seniors&&
this.seniors.setValue(a)},atMaxAdults:function(){return this.totalAdultCount()>=this.options.maxAdults},atMaxMinors:function(){return this.totalMinorCount()>=this.options.maxChildren},atMaxTotalTravelers:function(){return this.numTravelers>=this.options.maxTravelers},atMinTotalTravelers:function(){return 1>=this.numTravelers},atMinEligibleInfantHolders:function(a,b){a=a||this.lapInfant.getValue();b=b||this.totalAdultCount();return a>=b},totalAdultCount:function(){var a=this.seniors?this.seniors.getValue():
0;return this.adults.getValue()+a},totalMinorCount:function(){return[this.youth,this.child,this.lapInfant,this.seatInfant].reduce(function(a,b){return a+(b?b.getValue():0)},0)},isEligibleAdult:function(a){return"adults"===a||"seniors"===a},validate:function(a,b,c){var e=this.isEligibleAdult(c),l=this.totalAdultCount(),d=this.options.errorMsg;if(0<b){if("lapInfant"===c&&a.getValue()>=l)return this.showErrorMessage(d.lapInfantsExceedAdults),!1;if(this.atMaxTotalTravelers())return this.showErrorMessage(d.maximumTravelers),
!1;if(this.atMaxAdults()&&e)return this.showErrorMessage(d.maximumAdults),!1;if(this.atMaxMinors()&&!e)return this.showErrorMessage(d.maximumChildren),!1}else{if(this.atMinTotalTravelers())return this.showErrorMessage(d.minimumTravelers),!1;if(e&&this.atMinEligibleInfantHolders())return this.showErrorMessage(d.lapInfantsExceedAdults),!1;if(e&&1>=l&&0<this.totalMinorCount())return this.showErrorMessage(d.unaccompaniedMinors),!1}this.hideErrorMessage();return!0},onTravelersChange:function(a,b,k){this.calculateTravelers();
c.events.publish("flights.search.travelers.lapInfant",{count:this.lapInfant.getValue()});this.updateDisplay();this.updateBoxButtons(a,k);c.events.publish("flights.search.travelers.change",{data:this.serialize()});this.options.autoSubmit&&this.travelerSelect.close();c.Analytics.api.trackEvent({category:"Search-Form",action:"select-passengers",label:a._id})},onBaggageCountChange:function(a,b,k){this.updateDisplay();c.events.publish("flights.search.travelers.change",{data:this.serialize()});this.options.autoSubmit&&
this.travelerSelect.close();c.Analytics.api.trackEvent({category:"Search-Form",action:"select-baggage-count",label:a._id})},onCabinTypeChange:function(a,b){this.updateDisplay();c.events.publish("flights.search.travelers.change",{data:this.serialize()});this.options.autoSubmit&&this.travelerSelect.close();c.Analytics.api.trackEvent({category:"Search-Form",action:"select-cabin",label:this.cabinType.getValue()})},updateDisplay:function(){this.travelerSelect.updateLabel(this.getDisplaySummary())},getDisplaySummary:function(){var a;
a=this.options.separatedStyling?this.cabinType.getCheckedPair().title:this.cabinType.getText();return 1===this.adults.getValue()&&1===this.numTravelers?c.Common.Utils.String.formatString(this.options.msg.travelersDropdownCaptionSingleAdult,a):1===this.getSeniors()&&1===this.numTravelers?c.Common.Utils.String.formatString(this.options.msg.travelersDropdownCaptionSingleSenior,a):1===this.child.getValue()&&1===this.numTravelers?c.Common.Utils.String.formatString(this.options.msg.travelersDropdownCaptionSingleChild,
a):c.Common.Utils.String.formatChoice(this.options.msg.travelersDropdownCaptionTravelersChoice,this.numTravelers,this.numTravelers+"",a)},updateBoxButtons:function(a,b){var c=this.totalAdultCount(),e=this.atMaxTotalTravelers();this.travelerTypes.forEach(function(a){var b=this.isEligibleAdult(a),f=this[a],h=f.getValue(),g=b&&c<=this.totalMinorCount();a="lapInfant"===a&&h>=c;h=b&&this.atMinEligibleInfantHolders();b=b?this.atMaxAdults():this.atMaxMinors();g||this.atMinTotalTravelers()||h?f.disableDecrement():
f.enableDecrement();e||a||b?f.disableIncrement():f.enableIncrement()},this)},showErrorMessage:function(a){var b=this.errorMessageElement;b&&a&&(b.text(a),this.hasErrorMessage=!0)},hideErrorMessage:function(){var a=this.errorMessageElement;a&&this.hasErrorMessage&&(a.text(""),this.hasErrorMessage=!1)},serialize:function(){var a={adults:this.adults.getValue(),seniors:this.getSeniors(),youth:this.youth.getValue(),child:this.child.getValue(),seatInfant:this.seatInfant.getValue(),lapInfant:this.lapInfant.getValue(),
travelers:this.numTravelers,displaySummary:this.getDisplaySummary()};if(this.options.separatedStyling){var b=this.cabinType.getCheckedPair();g.extend(a,{cabin:b.value,cabinDisplayType:b.title})}else g.extend(a,{cabin:this.cabinType.getValue(),cabinDisplayType:this.cabinType.getText()});this.options.showBaggage&&(a.baggageCount=this.baggageCount.getValue());this.options.showStudents&&(a.students=this.students.getValue());return a}})})(R9,jQuery);(function(f,h){f.createComponentClass("flights.search.MultiCitySearchForm","base.search.SearchForm",{vertical:"flights",options:{smartyUrl:"/mv/marvel",searchParams:{},maxLegs:6,defaultLegsVisible:3,isBackFromRP:!1,phoenixRising:!1,formQuestion:"flights.fd.searchform.multicity",rtowFormQuestion:"flights.fd.searchform",autoRTFromMC:!1,useStyleJamCabinClass:!1,rtowSubmitButtonId:null},addLegButton:null,removeLegOnceButton:null,clearAllButton:null,infantInLapWarning:null,legElements:[],legStates:[],
defaultLegState:[],maxVisibleIndex:0,accessors:null,emptyLegState:{origin:"",destination:"",originCode:"",destinationCode:"",depart_date:null,depart_time:"a",flex_depart_date:null,nearby_origin:!1,nearby_destination:!1,cabin_type:"e"},init:function(a){this.base(a);this.accessors={};this.defaultLegState=this.options.searchParams;this.addLegButton=this.getChildElement("addMoreLegs");this.removeLegOnceButton=this.getChildElement("removeLegsOnce");this.clearAllButton=this.getChildElement("clearAll");
this.infantInLapWarning=this.getChildElement("infantInLapWarning");for(a=0;a<this.options.maxLegs;a++)this.setupLegElements(a)},addEventHandlers:function(){for(var a=this,b=0;b<this.options.maxLegs;b++)this.bindLegEvents(b);this.base();this.addLegButton.click(this.addLeg.bind(this));this.removeLegOnceButton&&this.removeLegOnceButton.click(this.removeLeg.bind(this,null));this.clearAllButton.click(this.clearLegs.bind(this));this.clearAllButton.keypress(function(b){b.preventDefault();switch(b.which){case f.globals.keyCodes.SPACE:case f.globals.keyCodes.RETURN:a.clearAllButton.click()}});
this.subscribe("intentmedia.submit.handler",h.proxy(this.onHookSubmitForIntentMedia,this));this.subscribe("flights.search.multicity.origin",this.onChangeOrigin.bind(this));this.subscribe("flights.search.multicity.destination",this.onChangeDestination.bind(this));this.subscribe("flights.search.multicity.departDate",this.onChangeDepartDate.bind(this));this.subscribe("flights.search.multicity.departTime",this.onChangeDepartTime.bind(this));this.subscribe("flights.search.multicity.cabinType",this.onChangeCabinType.bind(this));
this.subscribe("flights.search.multicity.nearbyOrigin",this.onChangeNearbyOrigin.bind(this));this.subscribe("flights.search.multicity.nearbyDestination",this.onChangeNearbyDestination.bind(this));this.subscribe("flights.search.multicity.addLeg",this.addLeg.bind(this));this.subscribe("flights.search.multicity.removeLeg",this.removeLeg.bind(this));this.subscribe("flights.search.multicity.activate",this.activate.bind(this));this.subscribe("flights.search.travelers.change",this.onChangeTravelers.bind(this));
this.subscribe("searchform.submit",function(b){b.id!==a.id()&&a.load(b)});this.answer(this.options.formQuestion,function(){return a.serialize()});this.answer("flights.searchform.multicity.first.leg.cabin",function(){return a.legStates[0].cabin_type});this.subscribe("resultspage.streaming.start",function(){a.isSubmitted=!1})},setupLegElements:function(a){var b={};b.element=this.getChildElement("multiCityLeg"+a);b.index=a;b.element.hasClass("hiddenLeg")||(this.maxVisibleIndex=a);b.originField=new f.flights.search.FlightAirportField(this.getChildElement("origin"+
a));b.originNearby=this.getChildElement("nearbyOriginCheck"+a);b.destinationField=new f.flights.search.FlightAirportField(this.getChildElement("destination"+a));b.destinationNearby=this.getChildElement("nearbyDestinationCheck"+a);b.departDatepickerEl=this.getChildElement("depart_date"+a);b.departTimeDropdownEl=this.getChildElement("depart_time"+a);b.cabinTypeDropdownEl=this.getChildElement("cabin_type"+a);0<b.index&&(b.removeLegBottom=this.getChildElement("removeLegBottom"+a),b.removeLegTop=this.getChildElement("removeLegTop"+
a));b.eventsBound=!1;this.legElements.push(b);this.legStates.push(h.extend({},a<this.defaultLegState.length?this.defaultLegState[a]:this.emptyLegState))},clearLegs:function(){for(var a=0;a<=this.maxVisibleIndex;a++){var b=this.legStates[a];b.origin="";b.originCode="";b.destination="";b.destinationCode="";b.depart_date="";b.depart_time="";b.nearby_origin="";b.nearby_destination="";b.cabin_type="";this.setLegWidgetValues(a,b)}},bindLegEvents:function(a){var b=this,c=this.legStates[a];this.bindLegDaterangePicker(a);
var d=this.legElements[a];0!==a&&this.isEmpty(c.departDate)||(c.depart_date=null!=c.departDate?moment(c.departDate):d.departDatepicker.getStartDate());d.departTimeDropdown=d.departTimeDropdownEl.dropdown({change:function(c){b.onChangeDepartTime({departTime:c.target.value,legIndex:a});f.Analytics.api.trackEvent({category:"multicity",action:"select",label:"departTime-"+a,value:c.target.value})}}).getWidget();var e=function(c){b.onChangeCabinType({cabinType:c.target.value,legIndex:a});f.Analytics.api.trackEvent({category:"multicity",
action:"select",label:"cabinType-"+a,value:c.target.value})};this.options.useStyleJamCabinClass?(d.cabinTypeDropdown=d.cabinTypeDropdownEl.getWidget(),d.cabinTypeDropdown&&(d.cabinTypeDropdown.options.change=e)):d.cabinTypeDropdown=d.cabinTypeDropdownEl.dropdown({change:e}).getWidget();d.originNearby.change(function(c){b.onChangeNearbyOrigin({includeNearbyOrigin:c.target.checked,legIndex:a})});d.destinationNearby.change(function(c){b.onChangeNearbyDestination({includeNearbyDestination:c.target.checked,
legIndex:a})});0<d.index&&(d.removeLegTop.click(this.removeLeg.bind(this,a)),d.removeLegBottom.click(this.removeLeg.bind(this,a)));var e=function(a,b){return function(c,d){if(!b.isEmpty(c))b.onChangeOrigin({originLocation:c,originCode:d,refreshNearby:!(""===c&&""===d),legIndex:a})}}(a,b),g=function(a,b){return function(c,d){if(!b.isEmpty(c))b.onChangeDestination({destinationLocation:c,destinationCode:d,refreshNearby:!(""===c&&""===d),legIndex:a})}}(a,b);this.bindAirportSmartyFields(d.originField,
!1,e);this.bindAirportSmartyFields(d.destinationField,!0,g);d.eventsBound=!0;this.setLegWidgetValues(a,c)},bindAirportSmartyFields:function(a,b,c){var d=this,e={dataSource:d.options.smartyUrl,setItem:function(a){return function(a,b,d){b&&setTimeout(function(){c(b.short_str||b.str,b.id)},100)}}(a.inputEl),clearItem:function(a){return function(a){setTimeout(function(){c(void 0,"")},1)}}(a.inputEl),beforeStart:function(a){var c;a=a.prop("id").match(/^.*?-(?:destination|origin)(\d+)/);2===a.length&&(c=
a[1]);return function(a,e){!a.elementNode.value&&!b&&(!e||8!==e.keyCode&&46!==e.keyCode)&&c&&0<c&&(e=d._legAccessor(c-1),a.elementNode.value=e.destination(),d._legAccessor(c).originCode(e.destinationCode()),a.elementNode.focus(),h(this).select())}}(a.inputEl),showBackgroundAutocomplete:f.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",!1)};if(this.options.phoenixRising){var g=a.inputEl.data("inputModal");g&&(e.appendTo=g.getSmartyWrapper(),e.fixedDropdown=!0)}a.inputEl.airportSmarty(e)},
bindLegDaterangePicker:function(a){function b(b){var d,e;for(e=a-1;0<=e;e--)if(d=c._legAccessor(e).departDate(),null!=d){c.options.useLegacyDatePicker?b.minDate=d:b.setMinDate(d);break}}var c=this,d=this.legElements[a];this.options.useLegacyDatePicker?(d.departDatepicker=this.bindDaterangePicker(d.departDatepickerEl,null,{getFormData:function(){var a=c.serialize();return{vertical:"flights",origin:a.origincode,destination:a.destinationcode,isOneWay:a.oneway}},useDaysFormat:!0,singleDateMode:!0,singlePickerWithSingleField:!0,
minDateFunc:function(b){var d,e;for(e=a-1;0<=e;e--)if(d=c._legAccessor(e).departDate(),null!=d){b.minDate=d;break}},change:function(){c.onChangeDepartDate({departDate:this.getStartDate(),legIndex:a});c.checkAndResetConsecutiveDates(a)},skipForceSetDefaultStartOnFocusBlur:!0}),d.departDatepicker.singleDateMode=!0):(d.departDateInput=this.getChildElement("depart_date"+a).getWidget(),this.bindDaterangePicker(d.departDateInput,null,{getFormData:function(){var b=c.serialize();return{vertical:"flights",
origin:b["origincode"+a],destination:b["destinationcode"+a],isOneWay:b.oneway}},minDateFunc:b,change:function(b){c.onChangeDepartDate({departDate:b.date,legIndex:a});c.checkAndResetConsecutiveDates(a)}}))},checkAndResetConsecutiveDates:function(a){var b=moment(this._legAccessor(a).departDate());if(null!=b)for(a+=1;a<this.options.maxLegs;a++){var c=this._legAccessor(a),d=moment(c.departDate());null!=d&&d.isBefore(b)&&c.departDate(null)}},removeLeg:function(a){if(!0===this.options.autoRTFromMC&&0===
this.maxVisibleIndex-1)f.events.publish("flights.inline.search.form.display.trigger","roundtrip");else{for(a=a||this.maxVisibleIndex;a<this.options.maxLegs-1;a++)a<this.maxVisibleIndex?this.copyLeg(a+1,a):(this._legAccessor(a).visible(!1),this.setLegWidgetValues(a,this.emptyLegState));--this.maxVisibleIndex;if(0===this.maxVisibleIndex){this.element.addClass("removeDisabled");var b=this.legElements[0];0<b.index&&(b.removeLegBottom.attr("aria-hidden","true"),b.removeLegTop.attr("aria-hidden","true"))}this._legAccessor(a).visible(!1);
this.addLegButton.removeClass("hidden");f.events.publish("flights.search.multicity.legRemoved");f.Analytics.api.trackEvent({category:"multicity",action:"removeLeg"})}},addLeg:function(){this.maxVisibleIndex<this.options.maxLegs-1&&(this.maxVisibleIndex+=1,this.setLegWidgetValues(this.maxVisibleIndex,this.emptyLegState),this._legAccessor(this.maxVisibleIndex).visible(!0));this.maxVisibleIndex>=this.options.maxLegs-1&&this.addLegButton.addClass("hidden");if(0<this.maxVisibleIndex){this.element.removeClass("removeDisabled");
var a=this.legElements[0];0<a.index&&(a.removeLegBottom.attr("aria-hidden","false"),a.removeLegTop.attr("aria-hidden","false"))}f.events.publish("flights.search.multicity.legAdded");f.Analytics.api.trackEvent({category:"multicity",action:"addLeg"})},updateLegState:function(a){var b=this._legAccessor(a);a=this.legStates[a];a.origin=b.origin();a.originCode=b.originCode();a.destination=b.destination();a.destinationCode=b.destinationCode();a.depart_date=b.departDate();a.depart_time=b.departTime();a.cabin_type=
b.cabinType();a.nearby_origin=b.nearbyOrigin();a.nearby_destination=b.nearbyDestination()},setLegWidgetValues:function(a,b){var c=this._legAccessor(a);c.origin(b.origin);c.destination(b.destination);c.originCode(b.originCode);c.destinationCode(b.destinationCode);c.departDate(b.depart_date);c.departTime(b.depart_time);c.cabinType(b.cabin_type);c.nearbyOrigin(b.nearby_origin);c.nearbyDestination(b.nearby_destination);this.updateLegState(a)},copyLeg:function(a,b){a=this._legAccessor(a);var c=this._legAccessor(b);
c.origin(a.origin());c.destination(a.destination());c.originCode(a.originCode());c.destinationCode(a.destinationCode());c.departDate(a.departDate());c.departTime(a.departTime());c.cabinType(a.cabinType());c.nearbyOrigin(a.nearbyOrigin());c.nearbyDestination(a.nearbyDestination());this.updateLegState(b)},validate:function(){for(var a=[],b=0;b<=this.maxVisibleIndex;b++)if(!this._legAccessor(b).empty()||0===b){this.updateLegState(b);var c=this.validateLeg(b);!0!==c&&(a=a.concat(c))}return a=a.concat(this.getTravelerValidationMessages())},
getTravelerValidationMessages:function(){var a=f.question.ask(this.options.travelersDataQuestion);return a.travelers>this.options.maxTravelers?[f.Common.Utils.String.formatString(this.options.errMsg.tooManyPassengersSelected+"",this.options.maxTravelers)]:1>a.travelers?[this.options.errMsg.noPassengersSelected+""]:[]},getLocationValidationMessages:function(a,b,c){var d=[];this.isEmpty(b)&&d.push(f.Common.Utils.String.formatChoice(this.options.errMsg.missingFromAirportChoice,a,a)+"");this.isEmpty(c)?
d.push(f.Common.Utils.String.formatChoice(this.options.errMsg.missingToAirportChoice,a,a)+""):b===c&&d.push(f.Common.Utils.String.formatChoice(this.options.errMsg.uniqueAirportsChoice,a,a)+"");return d},getDateValidationMessages:function(a,b,c,d){var e=[],g=!this.isEmpty(c),k=!this.isEmpty(d);g||e.push(f.Common.Utils.String.formatChoice(this.options.errMsg.missingLeaveDateChoice,a,a));b||(k?(a=moment(c),0>moment(d).diff(a,"days")&&e.push(this.options.errMsg.departDateAfterReturnDate)):e.push(this.options.errMsg.missingReturnDate));
return e},validateLeg:function(a){var b=this.legStates[a];a+=1;var c=[],d=this.parseMultipleAirportCodes(b.origin)||this.getAirportCode(b.originCode),e=this.parseMultipleAirportCodes(b.destination)||this.getAirportCode(b.destinationCode),c=c.concat(this.getLocationValidationMessages(a,d,e));return c=c.concat(this.getDateValidationMessages(a,!0,b.depart_date,null))},serialize:function(){var a=this.base();h.extend(a,f.question.ask(this.options.travelersDataQuestion));a.isMulticity=!0;for(var b=0,c=
f.config.getBoolean("ui.flights.mc.useMultiApCode",!0),d,e=0;e<=this.maxVisibleIndex;e++)if(!this._legAccessor(e).empty()){this.updateLegState(e);var g=this.legStates[e];a["origin"+b]=a["origincode"+b]=this.getAirportCode(g.originCode);a["destination"+b]=a["destinationcode"+b]=this.getAirportCode(g.destinationCode);c&&((d=this.parseMultipleAirportCodes(g.origin))&&(a["origin"+b]=a["origincode"+b]=d),(d=this.parseMultipleAirportCodes(g.destination))&&(a["destination"+b]=a["destinationcode"+b]=d));
a["originLocation"+b]=g.origin;a["destinationLocation"+b]=g.destination;a["nearby_origin"+b]=g.nearby_origin;a["nearby_destination"+b]=g.nearby_destination;d=g.depart_date;a["depart_date"+b]=moment(d).format(f.globals.apiDateFormat);a["depart_date_canon"+b]=moment(d).format("YYYY-MM-DD");a["depart_time"+b]=g.depart_time;a["cabin_type"+b]=g.cabin_type;b+=1}a.origin_location=a.orginLocation0;a.origincode=a.origincode0;a.destination_location=a.destinationLocation0;a.destinationcode=a.destinationcode0;
a.depart_date=a.depart_date0;a.depart_date_canon=a.depart_date_canon0;a.nearby_origin=a.nearby_origin0;a.nearby_destination=a.nearby_destination0;a.nrLegs=a.legCount=b;return a},buildSearchURL:function(a){for(var b={cabinClass:a.cabin,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,legData:[]},c=0;c<a.nrLegs;c++){var d={};d.originId=a["origin"+c];d.destinationId=a["destination"+c];d.originLocation=a["originLocation"+c];d.destinationLocation=
a["destinationLocation"+c];d.includeNearbyOrigin=a["nearby_origin"+c];d.includeNearbyDestination=a["nearby_destination"+c];d.departDate=a["depart_date_canon"+c];d.departTime=a["depart_time"+c];d.legCabinClass=a["cabin_type"+c];b.legData[c]=d}return f.flights.search.FlightSearchFormUrls.generateMultiCityFlightsUrl(b,a.nrLegs)},bindDaterangePicker:function(a,b,c){var d=this,e=function(a){var b=d.serialize();return{vertical:"flights",origin:b.origincode,destination:b.destinationcode,isOneWay:b.oneway,
departDate:a?void 0:b.depart_date_canon}};if(this.options.useLegacyDatePicker)return c=c||{getFormData:e,useDaysFormat:!0,minRangeDays:0,change:function(){b(this.getStartDate(),this.getEndDate())},alwaysShowEndDatepicker:this.options.autoOpenNextField},a.daterangePicker(c).getWidget();c=c||{change:b,getFormData:e};h.extend(a.options,c)},activate:function(){var a=f.question.ask(this.options.rtowFormQuestion),b=this._legAccessor(0);b.origin(a.origin_location);b.originCode(a.origincode);b.destination(a.destination_location);
b.destinationCode(a.destinationcode);b.departDate(a.depart_date_canon);b.nearbyOrigin(a.nearby_origin);b.nearbyDestination(a.nearby_destination);a={adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfant:a.seatInfant,lapInfant:a.lapInfant,students:a.student,cabin:a.cabin};f.events.publish("flights.search.travelers.set",a);this.setTravelerWarning(a);for(a=0;a<this.maxVisibleIndex;a++)"anywhere"===this._legAccessor(a).destination().toLowerCase()&&(b=this.legStates[a],b.destination=
"",b.destinationCode="",this.setLegWidgetValues(a,b));this.searchForm.addClass("active");this.autofocus()},onChangeOrigin:function(a){var b=this._legAccessor(a.legIndex);b.origin(a.originLocation);b.originCode(a.originCode);0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&b.originCode(a.originLocation);var c=this.legStates[a.legIndex];c.origin=b.origin();c.originCode=b.originCode();f.Analytics.api.trackEvent({category:"multicity",action:"set",label:"origin-%s".format(a.legIndex),value:a.originCode})},
onChangeDestination:function(a){var b=this._legAccessor(a.legIndex);b.destination(a.destinationLocation);b.destinationCode(a.destinationCode);0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&b.destinationCode(a.destinationLocation);var c=this.legStates[a.legIndex];c.destination=b.destination();c.destinationCode=b.destinationCode();f.Analytics.api.trackEvent({category:"multicity",action:"set",label:"destination-%s".format(a.legIndex),value:a.destinationCode})},onChangeDepartDate:function(a){var b=
this._legAccessor(a.legIndex);b.departDate(a.departDate);this.legStates[a.legIndex].depart_date=b.departDate()},onChangeDepartTime:function(a){var b=this._legAccessor(a.legIndex);b.departTime(a.departTime);this.legStates[a.legIndex].depart_time=b.departTime()},onChangeCabinType:function(a){var b=this._legAccessor(a.legIndex);b.cabinType(a.cabinType);this.legStates[a.legIndex].cabin_type=b.cabinType()},onChangeNearbyOrigin:function(a){var b=this._legAccessor(a.legIndex);b.nearbyOrigin(a.includeNearbyOrigin);
this.legStates[a.legIndex].nearby_origin=b.nearbyOrigin();f.Analytics.api.trackEvent({category:"multicity",action:"check",label:"nearbyOrigin-"+a.legIndex,value:a.includeNearbyOrigin?"on":"off"})},onChangeNearbyDestination:function(a){var b=this._legAccessor(a.legIndex);b.nearbyDestination(a.includeNearbyDestination);this.legStates[a.legIndex].nearby_destination=b.nearbyDestination();f.Analytics.api.trackEvent({category:"multicity",action:"check",label:"nearbyDestination-%s".format(a.legIndex),value:a.includeNearbyDestination?
"on":"off"})},onChangeTravelers:function(a){this.setTravelerWarning(a.data)},setTravelerWarning:function(a){0<a.lapInfant?this.infantInLapWarning.attr("aria-hidden","false").addClass("visible"):this.infantInLapWarning.attr("aria-hidden","true").removeClass("visible")},onRemoveLeg:function(a){this.removeLeg(a.legIndex)},_legAccessor:function(a){if(this.accessors[a])return this.accessors[a];var b=this.legElements[a],c=this;this.accessors[a]={origin:function(a){return b.originField.val(a)},destination:function(a){return b.destinationField.val(a)},
originCode:function(a){return b.originField.code(a)},destinationCode:function(a){return b.destinationField.code(a)},departDate:function(a){if(c.options.useLegacyDatePicker)return c.isUndefined(a)||b.departDatepicker.setStartDate(a),b.departDatepicker.getStartDate();c.isUndefined(a)||b.departDateInput.setDate(a);return b.departDateInput.getDate()},departTime:function(a){return b.departTimeDropdown?c.isUndefined(a)?b.departTimeDropdown.getValue():b.departTimeDropdown.setValue(a):""},cabinType:function(a){return b.cabinTypeDropdown?
c.options.useStyleJamCabinClass?c.isUndefined(a)?b.cabinTypeDropdown.getValue():b.cabinTypeDropdown.setValue(a):c.isUndefined(a)?b.cabinTypeDropdown.val():b.cabinTypeDropdown.val(a):""},nearbyOrigin:function(a){if(c.isUndefined(a))return b.originNearby.prop("checked");b.originNearby.prop("checked",a);return a},nearbyDestination:function(a){if(c.isUndefined(a))return b.destinationNearby.prop("checked");b.destinationNearby.prop("checked",a);return a},visible:function(a){if(c.isUndefined(a))return!b.element.hasClass("hiddenLeg");
a?b.element.removeClass("hiddenLeg").attr("aria-hidden","false"):b.element.addClass("hiddenLeg").attr("aria-hidden","true")},empty:function(){return c.isEmpty(this.originCode())&&c.isEmpty(this.destinationCode())&&c.isEmpty(this.departDate())}};return this.accessors[a]},parseMultipleAirportCodes:function(a){a=(a||"").split(",");for(var b=[],c=/^[A-Z0-9]{3}$/i,d=0;d<a.length;d++){var e=a[d].trim().toUpperCase();if(c.test(e))b.push(e);else return""}return b.join(",")},getAirportCode:function(a){return/[0-9]+[fr]{1,2}/.exec(a)?
a:null!=a?a.substring(0,3):""},onSubmit:function(a){this.base(a);if(!this.isSubmitted){a=this.serialize();var b=[];0===this.validate().length&&this.submitIntentMedia();for(var c=0;c<a.nrLegs;c++)b.push("leg%s:origin:%s,dest:%s,depart:%s,cabin:%s;".format(c,a["origincode"+c],a["destinationcode"+c],a["depart_date_canon"+c],a["cabin_type"+c]));b={category:"multicity",action:"click-search",value:b.join("")+"travelers:"+a.travelers};f.Analytics.api.trackEvent(b);if(this.options.showAnywhere&&"anywhere"!==
a.flex_category&&a.isMulticity)for(b=0;b<a.nrLegs&&(this.isEmpty(a["origincode"+b])||!this.isEmpty(a["destinationcode"+b]));b++);this.setStyleJamButtonActivation(!1,this.options.rtowSubmitButtonId)}},onHookSubmitForIntentMedia:function(a){a&&"function"===typeof a.callOnSubmit&&(this.intentMediaCallOnSubmit=a.callOnSubmit)},submitIntentMedia:function(){"function"===typeof this.intentMediaCallOnSubmit&&this.intentMediaCallOnSubmit.call(null,this.serialize())},autofocus:function(){var a=this;setTimeout(function(){a.legElements[0].originField.inputEl.focus()},
400)},getCompareToFormData:function(){},getStorageProps:function(){for(var a="depart_date depart_date_canon return_date return_date_canon origincode destinationcode travelers cabin flex_category isMulticity oneway nearby_origin nearby_destination".split(" "),b=0;b<this.options.maxLegs;b++)a.push("origincode"+b),a.push("originLocation"+b),a.push("destinationcode"+b),a.push("destinationLocation"+b),a.push("depart_date"+b),a.push("depart_date_canon"+b),a.push("depart_time"+b),a.push("cabin_type"+b),
a.push("nearby_origin"+b),a.push("nearby_destination"+b);return a},isEnoughInformationForCompareToRequest:function(){return!this.options.suppressCmp2s&&0===this.validate().length},load:function(a){if(a.hasOwnProperty("isMulticity")&&a.isMulticity){var b=0;if(this.options.maxLegs){for(var c=0;c<this.options.maxLegs;c++)a["origincode"+c]&&a["destinationcode"+c]?(b++,this._legAccessor(c).visible(!0)):this._legAccessor(c).visible(!1);b===this.options.maxLegs&&this.addLegButton.addClass("hidden")}this.maxVisibleIndex=
b-1;for(c=0;c<b;c++){var d="depart_time"+c;if(a[d])this.onChangeDepartTime({departTime:a[d],legIndex:c});d="nearby_origin"+c;if(a[d])this.onChangeNearbyOrigin({includeNearbyOrigin:a[d],legIndex:c});d="nearby_destination"+c;if(a[d])this.onChangeNearbyDestination({includeNearbyDestination:a[d],legIndex:c});var d="originLocation"+c,e="origincode"+c;if(a[d]&&a[e])this.onChangeOrigin({originLocation:a[d],originCode:a[e],legIndex:c});else if(0===c&&a.originLocation&&a.origincode)this.onChangeOrigin({originLocation:a.originLocation,
originCode:a.origincode,legIndex:c});d="destinationLocation"+c;e="destinationcode"+c;if(a[d]&&a[e])this.onChangeDestination({destinationLocation:a[d],destinationCode:a[e],legIndex:c});else if(0===c&&a.destinationLocation&&a.destinationcode)this.onChangeDestination({destinationLocation:a.destinationLocation,destinationCode:a.destinationcode,legIndex:c});d="depart_date_canon"+c;if(a[d])this.onChangeDepartDate({departDate:a[d],legIndex:c});d="cabin_type"+c;if(a[d])this.onChangeCabinType({cabinType:a[d],
legIndex:c})}}},getStorageExceptions:function(){}})})(R9,jQuery);(function(c,e){c.createComponentClass("common.results.ProgressBar",{bar:null,timerId:null,currentValue:null,startTime:null,elapsedTime:null,delayInterval:150,options:{linear:!1,totalTime:6E4,interval:750,percentage:0,visible:!0,startEvents:["search.startSearch"],stopEvents:["resultspage.streaming.done"]},init:function(){this.bar=this.getChildElement("bar");0<this.options.percentage&&(this.currentValue=this.options.percentage);this.options.visible&&this.startTimer()},addEventHandlers:function(){var a=
this;this.subscribe(this.options.stopEvents,function(){a.finish()});this.subscribe(this.options.startEvents,function(b){b=b&&!isNaN(b.delay)?b.delay:400;a.stopTimer();a.element.addClass("Reset").addClass("notrans");a.setPercentage(0);var d=function(){a.element.removeClass("Reset");a.start();c.dom.schedule(function(){a.element.removeClass("notrans")})};0<b?setTimeout(d,b):d()})},setPercentage:function(a){isNaN(a)||(this.currentValue=100<a?100:a,a="translateX("+this.currentValue+"%)",this.bar.css({transform:a,
msTransform:a}))},getPosition:function(a){return this.options.linear?a:(3.4+(1-Math.exp(-(6*a-1.5))))/4.4},timerCallback:function(){this.elapsedTime=(new Date).getTime()-this.startTime;if(this.elapsedTime>=this.options.totalTime)this.finish();else if(100===this.currentValue)this.finish();else{var a=100*this.getPosition(this.elapsedTime/this.options.totalTime);this.setPercentage(a);c.events.publish("progressbar.percentage.change",{percent:a});this.setNextTimeout(this.delayInterval)}},finish:function(){var a=
this;this.setPercentage(100);this.stopTimer();setTimeout(function(){a.element.addClass("Hidden");c.events.publish("progressbar.finished")},400)},start:function(){this.element.removeClass("Hidden");this.startTimer()},setNextTimeout:function(a){var b=this;this.timerId=window.setTimeout(function(){b.timerCallback()},a)},startTimer:function(){null===this.timerId&&(this.elapsedTime=0,this.startTime=(new Date).getTime(),this.setNextTimeout(this.delayInterval))},stopTimer:function(){null!==this.timerId&&
(window.clearTimeout(this.timerId),this.startTime=this.timerId=null)}})})(R9,jQuery);(function(g,h,n){function z(a,d){"boolean"===typeof d&&a&&a[0]&&a[0].checked!==d&&a.click()}function w(a,d,b){if(a.length){var c=a.parent().is(".StyleJamCheckbox")?"styleJamCheckbox":"checkbox";a[c]({change:function(){d.call(b,this.checked)}})}}function m(a){return null===a||"undefined"===typeof a||"string"===typeof a&&""===a.trim()}function p(a,d){return null===a||"undefined"===typeof a?"function"===typeof d?d():d:a}function t(a){return"adults"===a||"seniors"===a}function x(a){return a&&(-1!==a.indexOf("cy")||
-1!==a.indexOf("cg"))}function r(a){return null!=a?y.exec(a)||x(a)?a:a.split("/")[0]:""}function u(a){a=(a||"").split(",");for(var d=[],b=/^[A-Z0-9]{3}$/i,c=0;c<a.length;c++){var f=a[c].trim().toUpperCase();if(b.test(f))d.push(f);else return""}return d.join(",")}var y=/[0-9]+[fr]{1,2}/;g.createComponentClass("flights.search.FlightSearchFormDeprecated","base.search.SearchForm",{vertical:"flights",loggingPrefix:"Search-Form",formQuestion:"flights.fd.searchform",formObjectQuestion:"flights.fd.searchform.object",
display:null,inline:!1,inlineViewOnly:!1,controllers:{},activeFormController:null,disableDestinationFocusAfterAjax:!1,travelerTypes:null,options:{cmp2LimitDisplay:!1,slideCMP2:!1,slideCMP2PreventInit:!1,slideCMP2PreventRedirect:!1,activeHome:!1,flareSmartyType:1,smartyUrl:"/mv/marvel",autoOpenNextField:!1,showSmartyHistory:!1,isNearbyInSmarty:!1,airlineFilter:void 0,showAnywhere:!1,anywhereIfEmpty:!1,anywhereSelfTarget:!1,redirectToExplore:!1,backIfEmpty:!1,toggleLinks:!0,toggleSwap:!1,toggleField:!1,
useMultiCityInFD:!1,useLegacyDatePicker:!0,showAnywherePopupEnabled:!1,flippableSmarty:!0,isFdForm:!1,regionSearch:!1,regionSearchEnabled:!1,autoNearbyEnabled:!1,mixedCabinsUI:!1,ajaxOrigin:!1,regionDisplayAirportPicker:!1,dialog:!1,autoRTFromMC:!1,showDirectOption:!1,hostUrl:"",adjustRTCabinType:!1,closeOnScroll:!0,mainSearchForm:!1,useFlexRadioButtons:!1,triggerSetDisplayCat:!1,multiCityDisabled:!1},isRegionSearchSupported:!1,state:{travelers:0,cabin:"e",adults:0,seniors:0,child:0,youth:0,seatInfant:0,
lapInfant:0,students:0,bags:0},eventDataTemplate:{id:null},events:{rtWholeMonthSelect:"flights.search.rt.form.wholeMonthSelect",rtowOrigin:"flights.search.rtow.form.origin",rtowDestination:"flights.search.rtow.form.destination",rtowDateRange:"flights.search.rtow.form.dateRange",rtowNearbyOrigin:"flights.search.rtow.form.nearbyOrigin",rtowNearbyDestination:"flights.search.rtow.form.nearbyDestination",rtowLengthOfStay:"flights.search.rtow.form.lengthOfStay",multiOrigin:"flights.search.multi.form.origin",
multiDestination:"flights.search.multi.form.destination",multiDepartDate:"flights.search.multi.form.departDate",multiDepartTime:"flights.search.multi.form.departTime",multiNearbyOrigin:"flights.search.multi.form.nearbyOrigin",multiNearbyDestination:"flights.search.multi.form.nearbyDestination",multiLegCabinType:"flights.search.multi.form.legCabinType",multiAddLeg:"flights.search.multi.form.addLeg",multiRemoveLeg:"flights.search.multi.form.removeLeg",cabinType:"flights.search.rtow.form.cabinType",
travelerCount:"flights.search.rtow.form.travelerCount",baggageCount:"flights.search.rtow.form.baggageCount",displayCat:"flights.search.rtow.form.displayCat",searchError:"search.submit.error"},travelerDialogClass:"Flights-Frontdoor-TravelersDialog-Content",stateInitialized:!1,directCheckbox:null,init:function(a){this.base.apply(this,arguments);this.options.adjustRTCabinType=this.options.mixedCabinsUI&&this.options.adjustRTCabinType;this.options.slideCMP2&&(this.originCountry=this.options.originCountryCode);
this.options.showAnywhere=this.options.showAnywhere&&!this.options.isSEM;this.errorContainer.length||(this.errorContainer=h("."+this.id("error"),this.element));this.travelerTypes=[];this.state=h.extend({},this.state);this.eventDataTemplate=h.extend({},this.eventDataTemplate);this.eventDataTemplate.id=this.id();this.display=this.options.display;this.bindTravelerSelectDialog();this.bindShowAirportMapLinks();this.bindDisplayCat();this.bindTravelersDropdownCloseLink();this.bindTravelersDropdownCloseEvent();
this.wholeMonthSearch=!1;jq("body").hasClass("FlightsSearch")&&0<jq(".flexOpenflex").length&&0<jq(".Flights-Search-FlightSearchPage.vm-fd").length&&(this.wholeMonthSearch=g.config.getBoolean("ui.flights.whole-month-search.enabled",!1));this.controllers=this.createSubControllers();this.bindOpenNextFieldEvents();this.initActiveFormController();this.setupChildControllers();if(this.wholeMonthSearch){var d=this.controllers.rtow,b=d.flexCategoryRadio.getWidget();!0===g.storage.get("flexPlusMinusChecked")&&
(b.setButtonCheckedByValue("plusminusthree"),d.searchFormWrapper.hasClass("advanced plusMinus")||d.searchFormWrapper.addClass("advanced plusMinus"));"wholeMonthSearch"===(null!==g.storage.get("daterangePickerDefaultNavTab")?g.storage.get("daterangePickerDefaultNavTab"):"specificDate")&&(b.setButtonCheckedByValue("openflex"),d.searchFormWrapper.hasClass("advanced")||d.searchFormWrapper.addClass("advanced"),d.searchFormWrapper.hasClass("plusMinus")&&d.searchFormWrapper.removeClass("plusMinus"))}this.isRegionSearchSupported=
-1<g.config.getString("ui.flights.smarty.regionEnabled","32,51,58,72,77").split(",").indexOf(""+this.options.flareSmartyType);this.studentCheckbox=this.getChildElement("student");this.directCheckbox=this.getChildElement("direct-option")},inlineComponentsReady:function(){this.base.apply(this,arguments);this.initState();this.loadCompareToItems();this.options.ajaxOrigin&&this.checkOriginForUpdate();g&&g.globals&&g.globals.isSeo&&this.checkForValidDates();this.shouldSlideCmp2Init()&&this.loadSlideCMP2()},
addEventHandlers:function(){this.base.apply(this,arguments);this.subscribe(["flights.frontdoor.form.all","cmp2.form.fill"],this.proxyEventCallback(this.onChangeTriggerData,this));this.subscribe(this.events.cabinType,this.proxyEventCallback(this.onChangeCabinType,this));this.subscribe(this.events.travelerCount,this.proxyEventCallback(this.onChangeTravelersCount,this));this.subscribe(this.events.displayCat,this.proxyEventCallback(this.onChangeDisplayCat,this));this.subscribe(this.events.searchError,
this.proxyEventCallback(this.onSearchError,this));this.subscribe(this.events.baggageCount,this.proxyEventCallback(this.onChangeBaggageCount,this));var a=this;this.subscribe("DropdownDialog.open",function(b){var c=h(".FlightSearchDialogWidget");!c.length||b.id!==a.id("multi-travelers")&&b.id!==a.id("travelers")||c.find(".viewport").animate({scrollTop:h("#"+b.id).offset().top-c.find(".content").offset().top+.12*c.find(".viewport").height()},500)});this.subscribe("intentmedia.submit.handler",h.proxy(this.onHookSubmitForIntentMedia,
this));this.subscribe("common.kn.Swindle.hook",h.proxy(this.onHookSubmitForSwindle,this));this.options.dialog||this.answer(this.formQuestion,function(){return a.serialize()});this.options.mainSearchForm&&this.answer(this.formQuestion+".main",function(b){return a.serialize()});this.answer(this.formObjectQuestion,function(){return a});this.answer([this.formQuestion,this.id()].join("_"),function(){return a.serialize()});this.subscribe("flights.search.AnywhereSearchDialog.search.click",function(){a.vsLog("/nodestination/click/search")});
this.subscribe("flights.search.AnywhereSearchDialog.explore.click",function(){a.vsLog("/nodestination/click/anywhere")});this.subscribe("omni.vertical.changed",function(b){"flights"===b&&a.focusFirstElement()});this.studentCheckbox.on("click",function(){var b=h(this).is(":checked");a.vsLog("/student/"+(b?"checked":"unchecked"));window.setMetaCookie("isStudent",b?"true":"false")});this.directCheckbox.on("click",function(){var b=h(this).is(":checked");a.vsLog("/direct/"+(b?"checked":"unchecked"))});
this.subscribe("flights.search.FlightSearchFormDeprecated.enabledSearchButton",function(b){b===a.id()&&a.enableSearchButton()});if(this.options.slideCMP2){var d=this;this.subscribe([this.events.cabinType,this.events.travelerCount,this.events.displayCat,this.events.searchError,this.events.baggageCount,this.events.rtowOrigin,this.events.rtowDestination,this.events.rtowDateRange,this.events.rtowNearbyOrigin,this.events.rtowNearbyDestination,this.events.rtowLengthOfStay,"flights.frontdoor.form.all","cmp2.form.fill"],
function(){d.enableSearchButton()})}g.config.getBoolean("ui.horizon.flights.search.cheapflights.fdcmp2s",!1)&&this.subscribe("cmp2.rendering.finished",function(b){b&&0<b.items.length&&a.getChildElement("slidecmp2").html("").removeAttr("class")});h(".addMoreLegs",this.element).on({mouseenter:function(){h("button",this).addClass("btnActive");h("button",this).is(".Common-Widgets-Button-StyleJamButton")&&g.dom.swapClasses(h("button",this),g.stylejam.common.widgets.button.StyleJamButton.plusButtonInactive,
g.stylejam.common.widgets.button.StyleJamButton.plusButtonActive)},mouseleave:function(){h("button",this).removeClass("btnActive");h("button",this).is(".Common-Widgets-Button-StyleJamButton")&&g.dom.swapClasses(h("button",this),g.stylejam.common.widgets.button.StyleJamButton.plusButtonActive,g.stylejam.common.widgets.button.StyleJamButton.plusButtonInactive)}});this.getChildElement("removeLeg").on("click",function(b){var c=h(".multiCityLeg",a.element).not(".hiddenLeg").last().index();if(0!==c){a.controllers.multi.triggerRemoveLeg(c);
var f=h(b.currentTarget);f.addClass(1===c?"disabled":"");f.closest(".Flights-Search-StyleJamFlightSearchForm").length&&(f=g.stylejam.flights.search.StyleJamFlightSearchForm,1===c?g.dom.swapClasses(h(b.currentTarget),f.searchFormVisible,f.searchFormHidden):g.dom.swapClasses(h(b.currentTarget),f.searchFormHidden,f.searchFormVisible))}});g.events.subscribe("flights.search.multi.form.removeLeg",function(b){a.adjustFormClass.call(a)});g.events.subscribe("flights.search.multi.form.addLeg",function(b){a.id()===
b.id&&a.getChildElement("removeLeg").removeClass("disabled");a.element.is(".Flights-Search-StyleJamFlightSearchForm")&&(b=g.stylejam.flights.search.StyleJamFlightSearchForm,g.dom.swapClasses(a.getChildElement("removeLeg"),b.searchFormHidden,b.searchFormVisible));a.adjustFormClass.call(a)});h("div[id$\x3d'searchDialog-dialog-viewport']").on("scroll",function(){h("div[id$\x3d'smartbox-dropdown']").css("display","none")})},shouldSlideCmp2Init:function(){return this.element.is(":visible")?!this.options.slideCMP2PreventInit&&
!this.options.activeHome:!1},load:function(a){if(a){var d=this.controllers.rtow,b=this.controllers.multi;a.hasOwnProperty("adults")&&a.adults&&(this.getChildElement("adults").getWidget().setValue(a.adults,!0),this.state.adults=a.adults);a.hasOwnProperty("child")&&a.child&&this.getChildElement("child").getWidget().setValue(a.child,!0);a.hasOwnProperty("lapInfant")&&a.lapInfant&&this.getChildElement("lapInfant").getWidget().setValue(a.lapInfant,!0);a.hasOwnProperty("seatInfant")&&a.seatInfant&&this.getChildElement("seatInfant").getWidget().setValue(a.seatInfant,
!0);a.hasOwnProperty("seniors")&&a.seniors&&this.getChildElement("seniors").getWidget().setValue(a.seniors,!0);a.hasOwnProperty("youth")&&a.youth&&this.getChildElement("youth").getWidget().setValue(a.youth,!0);this.updateCabinType(a);a.nearby_origin&&d.triggerChangeNearbyOrigin(a.nearby_origin,this.options.isNearbyInSmarty);a.nearby_destination&&d.triggerChangeNearbyDestination(a.nearby_destination,this.options.isNearbyInSmarty);a.hasOwnProperty("oneway")&&a.oneway&&(this.display="oneway");if(a.hasOwnProperty("isMulticity")&&
a.isMulticity&&this.options.toggleLinks){this.display=this.options.useMultiCityInFD?"rtow":"multicity";var c=a.nrLegs||b.indexLastVisibleLeg+1,f=0;if(b.maxLegs)for(var e=0;e<b.maxLegs&&a["origincode"+e]&&a["destinationcode"+e];e++)f++,b._legAccessor(e).visible(!0);f>c&&(c=f,b.indexLastVisibleLeg=f-1);f=this.options.isNearbyInSmarty;for(e=0;e<c;e++){var k="depart_time"+e;a[k]&&b.triggerChangeDepartTime(a[k],e);k="nearby_origin"+e;a[k]&&b.triggerChangeNearbyOrigin(a[k],e,f);k="nearby_destination"+e;
a[k]&&b.triggerChangeNearbyDestination(a[k],e,f);var k="originLocation"+e,l="origincode"+e;a[k]&&a[l]?b.triggerChangeOrigin(a[k],a[l],e):0===e&&a.originLocation&&a.origincode&&b.triggerChangeOrigin(a.originLocation,a.origincode,e);k="destinationLocation"+e;l="destinationcode"+e;a[k]&&a[l]?b.triggerChangeDestination(a[k],a[l],e):0===e&&a.destinationLocation&&a.destinationcode&&b.triggerChangeDestination(a.destinationLocation,a.destinationcode,e);k="depart_date_canon"+e;a[k]&&b.triggerChangeDepartDate(a[k],
e);k="cabin_type"+e;a[k]&&b.triggerChangeLegCabinType(a[k],e)}}a.hasOwnProperty("depart_date_canon")&&a.depart_date_canon&&a.hasOwnProperty("return_date_canon")&&a.return_date_canon&&d.triggerChangeDateRange(a.depart_date_canon,a.return_date_canon);"exact"!==a.flex_category&&d.datePicker&&this.options.useFlexDatePicker&&(this.options.useFlexRadioButtons&&(a=d.datePicker.getRadioButtonSimplifiedFlexData(a)),d.datePicker.loadFlexData(a),d.datePicker.publishFlexUpdate());if(this.wholeMonthSearch)"undefined"!==
typeof g.storage&&(d.setFlexCategory(a.flex_category),b=d.flexCategoryRadio.getWidget(),!0===g.storage.get("flexPlusMinusChecked")&&(b.setButtonCheckedByValue("plusminusthree"),c=this.getChildElement("plusMinusThreeDepart").dropdown({}).getWidget(),e=this.getChildElement("plusMinusThreeReturn").dropdown({}).getWidget(),a.hasOwnProperty("depart_date_flex")&&a.depart_date_flex&&(c.setValue(a.depart_date_flex),d.state.plusMinusThreeDepart=a.depart_date_flex),a.hasOwnProperty("return_date_flex")&&a.return_date_flex&&
(e.setValue(a.return_date_flex),d.state.plusMinusThreeReturn=a.return_date_flex),d.searchFormWrapper.hasClass("advanced plusMinus")||d.searchFormWrapper.addClass("advanced plusMinus")),"wholeMonthSearch"===(null!==g.storage.get("daterangePickerDefaultNavTab")?g.storage.get("daterangePickerDefaultNavTab"):"specificDate")&&(b.setButtonCheckedByValue("openflex"),d.searchFormWrapper.hasClass("advanced")||d.searchFormWrapper.addClass("advanced"),d.searchFormWrapper.hasClass("plusMinus")&&d.searchFormWrapper.removeClass("plusMinus"),
a.hasOwnProperty("openflex_length_of_stay")&&a.openflex_length_of_stay&&(d.openflexLengthOfStay.val(a.openflex_length_of_stay),d.state.openflexLengthOfStay=a.openflex_length_of_stay)));else if(!this.options.disabledAdvanced&&("plusminusthree"===a.flex_category||"weekend"===a.flex_category||"openflex"===a.flex_category&&this.options.flexMonthEnabled)){d.setFlexCategory(a.flex_category);b=d.flexCategoryRadio.getWidget();switch(a.flex_category){case "weekend":b.setButtonCheckedByValue("weekend");b=this.getChildElement("weekendDepartDate").dropdown({}).getWidget();
c=this.getChildElement("weekendDepart").dropdown({}).getWidget();e=this.getChildElement("weekendReturn").dropdown({}).getWidget();a.hasOwnProperty("weekend_depart_date")&&a.weekend_depart_date&&c&&(b.setValue(a.weekend_depart_date),d.state.weekendDepartDate=a.weekend_depart_date);a.hasOwnProperty("weekend_depart")&&a.weekend_depart&&(c.setValue(a.weekend_depart),d.state.weekendDepart=a.weekend_depart);a.hasOwnProperty("weekend_return")&&a.weekend_return&&(e.setValue(a.weekend_return),d.state.weekendReturn=
a.weekend_return);break;case "plusminusthree":b.setButtonCheckedByValue("plusminusthree");c=this.getChildElement("plusMinusThreeDepart").dropdown({}).getWidget();e=this.getChildElement("plusMinusThreeReturn").dropdown({}).getWidget();a.hasOwnProperty("depart_date_flex")&&a.depart_date_flex&&(c.setValue(a.depart_date_flex),d.state.plusMinusThreeDepart=a.depart_date_flex);a.hasOwnProperty("return_date_flex")&&a.return_date_flex&&(e.setValue(a.return_date_flex),d.state.plusMinusThreeReturn=a.return_date_flex);
break;case "openflex":b.setButtonCheckedByValue("openflex"),a.hasOwnProperty("openflex_length_of_stay")&&a.openflex_length_of_stay&&(d.openflexLengthOfStay.val(a.openflex_length_of_stay),d.state.openflexLengthOfStay=a.openflex_length_of_stay)}d.toggleAdvanced()}}},updateCabinType:function(a){a.hasOwnProperty("cabin")&&a.cabin&&this.getChildElement("cabinType").getWidget().setButtonCheckedByValue(a.cabin)},bindOpenNextFieldEvents:function(){var a=this,d=!1;if(this.options.autoOpenNextField){var b=
null,c=null,f=null,e=function(){var c=0;return function(){var a=Date.now(),b=a-c;c=a;return 250<b}}(),k=function(){e()&&!d&&a.controllers.rtow.destInput.focus();d=!1},l=function(){e()&&(a.options.useLegacyDatePicker?a.controllers.rtow.daterangePicker.getWidget().startDisplay.trigger("mousedown"):a.controllers.rtow.departDate.focus())};g.events.subscribe("flights.search.rtow.form.origin",function(c){c.id!==a.element[0].id||c.odSwitch||(null==b?b=!!c.originCode:(b=!!c.originCode)&&!c.disableDestinationFocusAfterAjax&&
(f=setTimeout(k,10)))});g.events.subscribe("flights.search.rtow.form.destination",function(b){b.id===a.element[0].id&&(null!==f&&(clearTimeout(f),f=null),null==c?c=!!b.destinationCode:(c=!!b.destinationCode,b=a.options.useLegacyDatePicker?a.controllers.rtow.daterangePicker.getWidget().startInput.val()&&a.controllers.rtow.daterangePicker.getWidget().endInput.val():a.controllers.rtow.departDate.getValue()&&a.controllers.rtow.returnDate.getValue(),c&&!b&&l()))});this.controllers.rtow.originInput.on("keyup",
function(c){13===c.which&&b&&k()}).on("keydown",function(c){c.which===g.globals.keyCodes.TAB&&(d=!0)});this.controllers.rtow.destInput.on("keyup",function(a){13===a.which&&c&&l()})}},vsLog:function(a){if(this.stateInitialized&&this.searchForm.is(":visible")&&0<=this.searchForm.offset().top&&"complete"===document.readyState){var d="simpleform";this.searchForm.filter(".active").hasClass("multicity")?d="multicity":this.element.find(".searchFormWrapper").hasClass("advanced")&&(d="advancedform");g.Analytics.api.trackEvent(["flights/form",
d,a].join("/"))}},gaLog:function(a,d){this.stateInitialized&&this.searchForm.is(":visible")&&0<=this.searchForm.offset().top&&"complete"===document.readyState&&g.Analytics.api.trackEvent({category:"Search-Form",action:a,label:d})},initState:function(){this.options.showStudents||delete this.state.students;if(!0!==this.options.sync){this.triggerChangeDisplayCat();for(var a=0;a<this.travelerTypes.length;a++)this.triggerChangeTravelersCount(this.travelerTypes[a]);var d,b;this.options.useHistory&&this.localHistory&&
this.localHistory.getRecentHistory&&(d=(b=this.localHistory.getRecentHistory())?b.cabin:null);this.triggerChangeCabinType(d);this.activeFormController.initState(b)}this.stateInitialized=!0},setupChildControllers:function(){this.controllers.rtow.setup();this.options.toggleLinks&&!this.options.multiCityDisabled&&this.controllers.multi.setup()},onSubmit:function(a){var d=this;if(!this.isSubmitted){var b=this.serialize(),c=!1,f="continents"===b.flex_category,e="anywhere"===b.flex_category||f;if(!1===
this.validate()&&!1===this.submitSubscription.call(this)||!1===this.validate()&&this.submitSwindle.call(this)||this.loadSlideCMP2())return!1;!1===this.validate()&&this.submitIntentMedia();this.gaLog("click-search","origin:%s;dest:%s;depart:%s;return:%s;travelers:%s;triptype:%s;cabin:%s;departflex:%s;returnflex:%s".format(b.origin,b.destination,b.depart_date_canon,b.return_date_canon,b.travelers,this.display,b.cabin,b.depart_date_flex,b.return_date_flex));if(d.options.showAnywhere&&!e)if(b.isMulticity)for(var k=
0;k<b.nrLegs&&(m(b["origincode"+k])||!m(b["destinationcode"+k]));k++);else c=!m(b.origincode)&&m(b.destinationcode)&&"function"===typeof this.showAnywhereSearchPopup&&this.options.showAnywherePopupEnabled;this.triggerConsentGranted();c?(this.vsLog("/nodestinationerror/show"),this.showAnywhereSearchPopup(b)):g.config.getBoolean("ui.horizon.flights.search.openExploreWithExactDates",!1)&&e&&b.depart_date&&b.return_date?d.goToExploreBy(b,f):d.options.regionSearchEnabled&&(b.freeRegionId||b.countrySearch)&&
!d.options.regionSearch?window.location=d.options.redirectToExplore?g.flights.search.FlightSearchFormUrls.generateExploreDestinationUrl({origincode:b.origincode,destinationcode:b.destinationcode,depart_date_canon:b.depart_date_canon,return_date_canon:b.return_date_canon,stops:d.getDirectOptionValue()?"stops\x3d0":""}):"/"+this._generate(b):this.base(a)}setTimeout(function(){d.recalculateDialogDimensions()},10);return!1},goToExploreBy:function(a,d){var b=a.depart_date+","+a.return_date;d=d&&a.continentId?
"continent\x3d"+a.continentId:"";a="/"+this._generate(a)+"/"+b;(b=this.getDirectOptionValue()?"stops\x3d0":"")&&(a+="?"+(b?b:""));d&&(a+=(b?"\x26":"?")+d);window.location=a},showAnywhereSearchPopup:function(a){g.events.publish("flights.search.AnywhereSearchDialog.open",a)},publishSubmitEvent:function(a){this.options.regionSearch?window.location.href="/"+a.url:"anywhere"===a.flex_category?this.options.anywhereSelfTarget?window.location.href="/"+a.url:(window.open("/"+a.url),this.enableSearchButton()):
this.base(a)},getCMP2AirportLocation:function(a,d){if(a){a=a.substr(0,3);if(""===a||0===a.indexOf("C-"))a=d.replace(/ /g,""),-1!==a.indexOf("(")?(d=a.match(/\(([A-Z]{3})\)/g),null!=d&&(a=d[0])):a=a.substr(0,3);return a}return""},getCompareToFormData:function(){var a=this.serialize(),d={vertical:this.vertical};a.origin=a.origin_location;a.origincode=a.origin_code;a.destination=a.destination_location;a.destinationcode=a.destination_code;return h.extend(d,a)},isEnoughInformationForCompareToRequest:function(){if(this.options.loadCmp2WhenVisible&&
!this.element.is(":visible"))return!1;var a=["plusminusthree","exact"];if(this.activeFormController===this.controllers.rtow&&-1===h.inArray(this.activeFormController.getFlexCategory(),a))return!1;a=!0;this.options.cmp2LimitDisplay&&(a="oneway"===this.display||"roundtrip"===this.display);if(this.options.regionSearchEnabled&&a&&this.activeFormController){var d=this.serialize();if(d.destination&&(y.exec(d.destination)||x(d.destination)))return!1}return a&&!this.options.suppressCmp2s&&null!==this.activeFormController&&
!1===this.validate()},autofocus:function(){this.controllers.rtow.originInput.focus()},setView:function(a){this.base(a);"inline"===a||"inlineform"===a?this.switchToInlineView("inline"===a):this.switchToFullView()},switchToFullView:function(){this.inlineViewOnly=this.inline=!1},switchToInlineView:function(a){this.inline=!0;this.inlineViewOnly=a||!1;a&&this.updateInlineViewOnly()},getDirectOptionValue:function(){if(!0===this.options.showDirectOption){var a=this.getChildElement("direct-option");if(a&&
a.is(":checked"))return{stops:"0"}}return null},buildSearchURL:function(a){a.originCountry=this.originCountry;return this.activeFormController.buildSearchURL(a)},serialize:function(){var a=this.base();a.provider="";var d=this.getActiveFormData();return h.extend(a,d)},getActiveFormData:function(){return h.extend({airlineFilter:this.options.airlineFilter},this.activeFormController.serialize())},getCookieData:function(){var a=this.base(),d={};this.element.find("[type\x3d'hidden']").filter(function(){var a=
h(this).attr("name");return m(a)?!1:!/^(airportcode|origincode\d?|destinationcode\d?)$/i.test(a)}).each(function(){var a=h(this),c=a.attr("name"),f=a.val();m(f)||(d[c]=a.val())});this.options.airlineFilter&&!d.airlineFilter&&(d.airlineFilter=this.options.airlineFilter);return h.extend(a,d)},getStorageProps:function(){for(var a="depart_date depart_date_canon return_date return_date_canon origincode destinationcode travelers cabin flex_category isMulticity oneway nearby_origin nearby_destination depart_date_flex return_date_flex weekend_depart_date weekend_depart weekend_return openflex_depart_date openflex_length_of_stay".split(" "),
d=this.activeFormController&&this.activeFormController.maxLegs?this.activeFormController.maxLegs:3,b=0;b<d;b++)a.push("origincode"+b),a.push("originLocation"+b),a.push("destinationcode"+b),a.push("destinationLocation"+b),a.push("depart_date"+b),a.push("depart_date_canon"+b),a.push("depart_time"+b),a.push("cabin_type"+b),a.push("nearby_origin"+b),a.push("nearby_destination"+b);return a},removeActiveClass:function(a){h("form.searchform.active",a).removeClass("active").attr("aria-hidden","true");if(this.element.is(".Flights-Search-StyleJamFlightSearchForm")){var d=
g.stylejam.flights.search.StyleJamFlightSearchForm;g.dom.swapClasses(h("form.searchform",a),d.searchFormVisible,d.searchFormHidden)}},bindDisplayCat:function(){var a=this;this.options.toggleLinks?(this.getChildElement("displayCat").radioButtonSet({change:function(d){a.triggerChangeDisplayCat(d.value,d)}}),this.addExploreEventHandlers()):(a.multiCityDialog=this.getChildElement("multiCityDialog").getWidget(),a.multiCityDialog&&(h.extend(a.multiCityDialog.options,{onClose:function(){a.autofocus();g.events.publish("flights.search.rtow.form.displayCat",
{displayCat:"roundtrip"})}}),this.subscribe(["flights.search.multicity.legAdded","flights.search.multicity.legRemoved"],function(){setTimeout(a.multiCityDialog.calculateDimensions.bind(a.multiCityDialog),1)}),this.subscribe("flights.search.toggle",function(d){"multicity"!==d.displayCat||a.options.toggleLinks?"explore"===d.displayCat?(a.gaLog("open","explore"),a.vsLog("explore/open"),window.open("/explore","_blank")):a.triggerChangeDisplayCat(d.displayCat):(a.multiCityDialog.open(),g.events.publish("flights.search.multicity.activate"))}),
this.subscribe("searchform.submit",function(){a.multiCityDialog.close()})))},addExploreEventHandlers:function(){var a=this;if(this.options.toggleLinks){var d=this.id("explore-label");this.getChildElement("explore-label").click(function(b){switch(b.which){case 1:case g.globals.keyCodes.RETURN:case g.globals.keyCodes.SPACE:return window.open("/explore","_blank"),a.triggerChangeDisplayCat("roundtrip"),a.getChildElement("displayCat").getWidget().focusButtonSet(),!1}});this.getChildElement("displayCat").keydown(function(b){switch(b.which){case g.globals.keyCodes.RETURN:case g.globals.keyCodes.SPACE:if(h(b.currentTarget).attr("aria-activedescendant")===
d)return window.open("/explore","_blank"),a.triggerChangeDisplayCat("roundtrip"),a.getChildElement("displayCat").getWidget().focusButtonSet(),!1}})}},initActiveFormController:function(){switch(this.display){case "roundtrip":case "rtow":case "oneway":this.activeFormController=this.controllers.rtow;break;case "multi":case "multicity":this.activeFormController=this.controllers.multi}},onChangeDisplayCat:function(a){switch(a.displayCat){case "roundtrip":case "rtow":this.activeFormController=this.controllers.rtow;
this.display="roundtrip";this.copyMultiCabinDataForRT();break;case "oneway":this.activeFormController=this.controllers.rtow;this.display="oneway";break;case "explore":this.activeFormController=this.controllers.rtow;this.display="explore";break;case "multi":case "multicity":a=this.activeFormController==this.controllers.rtow;this.activeFormController=this.controllers.multi;this.options.mixedCabinsUI&&a&&this.copyRTDataForMixedCabinsUI();this.display="multicity";break;default:return}this.options.toggleLinks&&
(this.getChildElement("displayCat").getWidget().setButtonCheckedByValue(this.display),this.removeActiveClass(this.element));("multicity"!==this.display||this.options.toggleLinks)&&this.activeFormController.activate();"oneway"!==this.display&&"roundtrip"!==this.display||this.activeFormController.setOneWay("oneway"===this.display);this.updateLapInfantWarning();this.loadCompareToItems();this.recalculateDialogDimensions()},copyMultiCabinDataForRT:function(){if(!0===this.options.adjustRTCabinType&&this.controllers.multi.legStates.length){var a=
this.controllers.multi.legStates[0].cabin_type;if(null!=a){var d=h.extend({},this.eventDataTemplate);d.cabinType=a;g.events.publish(this.events.cabinType,d)}}},copyRTDataForMixedCabinsUI:function(){if(!0!==this.options.adjustRTCabinType){var a=this.controllers.rtow.state;if(null!=a.end_date){var d=h.extend({},this.eventDataTemplate);d.legIndex=1;d.originCode=a.destinationCode;d.originLocation=a.destination;g.events.publish(this.events.multiOrigin,d);d=h.extend({},this.eventDataTemplate);d.legIndex=
1;d.destinationCode=a.originCode;d.destinationLocation=a.origin;g.events.publish(this.events.multiDestination,d);d=h.extend({},this.eventDataTemplate);d.legIndex=1;d.departDate=a.end_date;g.events.publish(this.events.multiDepartDate,d);d=h.extend({},this.eventDataTemplate);d.legIndex=0;d.cabinType=this.state.cabin;g.events.publish(this.events.multiLegCabinType,d);d=h.extend({},this.eventDataTemplate);d.legIndex=1;d.cabinType=this.state.cabin;g.events.publish(this.events.multiLegCabinType,d)}}},triggerChangeDisplayCat:function(a,
d){d=h.extend({},this.eventDataTemplate);d.displayCat=p(a,this.display);g.events.publish(this.events.displayCat,d);this.options.triggerSetDisplayCat&&g.events.publish(this.events.displayCat+".set",d.displayCat);this.vsLog("/triptype/"+a);this.gaLog("select-trip-type",a)},updateInlineViewOnly:function(){var a=this.activeFormController.serialize(),a={depart_date:n(a.depart_date).format("MMM DD"),return_date:n(a.return_date).format("MMM DD"),origincode:a.origincode,destinationcode:a.destinationcode,
cabin:a.cabin||"Economy",travelers:a.travelers},d;for(d in a)a.hasOwnProperty(d)&&h(".displayView[data-disp-%s]".format(d),this.element).html(a[d])},_getAirportCodeField:function(a){return a.siblings("input.aircode")},bindTravelersDropdownCloseLink:function(){var a=this;this.element.find(".closeLink").click(function(d){d.preventDefault?d.preventDefault():d.returnValue=!1;a.getChildElement("multicity"===a.display?"multi-travelers":"travelers").getWidget().close(d,null,!0)})},bindTravelersDropdownCloseEvent:function(){var a=
this;this.subscribe("horizon.dropdownDialog.close.dropdown",function(){var d=a.getChildElement("multicity"===a.display?"multi-travelers":"travelers").getWidget();if(a.options.closeOnScroll)d.close(null,null,!0);else{var b=d.content,c=h(document).scrollTop(),f=b.offset().top;b.hasClass("up")?f>c+window.innerHeight&&d.close(null,null,!0):f<c&&d.close(null,null,!0)}})},adjustAnywhereSearchCategory:function(a){a?this.controllers.rtow.searchFormWrapper.addClass("anywhere-search"):this.controllers.rtow.searchFormWrapper.removeClass("anywhere-search")},
bindFlightSmartyFields:function(a,d,b,c,f){var e=this,k=function(c){return function(a,f){f&&setTimeout(function(){var l,k;l=e.options.regionDisplayAirportPicker?!1:!d&&e.isRegionSearchSupported;if("ap"===f.type||"apnc"===f.type||"rail"===f.type)l=f.short_str||f.str,k=f.id;else if("isl"===f.type)l=f.str,k="";else if(l&&e.options.regionSearchEnabled&&"reg"===f.type)l=f.short_str||f.str,k=f.rid+"r";else if(l&&e.options.regionSearchEnabled&&"freereg"===f.type)l=f.short_str||f.str,k=f.frid+"fr";else if(l&&
e.options.regionSearchEnabled&&"ctry"===f.type)l=f.short_str||f.str,k=f.cid+"cy";else if(l&&e.options.regionSearchEnabled&&"ctgroup"===f.type)l=f.short_str||f.str,k=f.cgid+"cg";else if(a.options.showAnywhere&&"anywhere"===f.short_str)g.events.publish("forceDismiss.DatePicker"),l=a.options.messages.anywhereInptText,k="anywhere",c.closest(".searchFormWrapper").removeClass("advanced").addClass("anywhere-search"),e.vsLog("/smarty/anywhere");else if("continent"===f.type)g.events.publish("forceDismiss.DatePicker"),
l=f.short_str||f.str,k=f.id,c.closest(".searchFormWrapper").removeClass("advanced").addClass("continent-search"),e.vsLog("/smarty/continents");else if("addr"===f.type)l=f.name,e.openAirportPicker(l,"",h,!d,function(c){b(c.location,c.code)}),c.getWidget().setItem({});else{k=l="";var h=f.id;if(e.isRegionSearchSupported)switch(f.type){case "freereg":h="F:%s".format(f.frid);break;case "reg":h="R:%s".format(f.rid);break;case "ctry":h="Y:%s".format(f.cid)}e.openAirportPicker("","",h,!d,function(c){b(c.location,
c.code)})}a.options.showAnywhere&&"anywhere"!==f.short_str&&c.closest(".searchFormWrapper").removeClass("anywhere-search");a.options.showContinents&&"continent"!==f.type&&c.closest(".searchFormWrapper").removeClass("continent-search");d&&(e.originCountry=f.cc||"",e.originCode=r(k));b(l,k)},100)}},l=function(c){return function(a){setTimeout(function(){a.options.showAnywhere&&c.closest(".searchFormWrapper").removeClass("anywhere-search");a.options.showContinents&&c.closest(".searchFormWrapper").removeClass("continent-search");
b(void 0,"")},1)}},q=function(c){return function(a){setTimeout(function(){if(!c.val()||0===c.val().length){var f=a.options.messages.anywhereInptText;c.closest(".searchFormWrapper").addClass("anywhere-search");b(f,"anywhere")}},1)}},v=function(c){return function(a){setTimeout(function(){c.val()&&0!==c.val().length||b(a.initialVal,a.initialCode)},1)}},n=function(){return function(a){if(a)if(c)c(a.enabled);else{var b=h.extend({},e.eventDataTemplate);d?(b.includeNearbyOrigin=a.enabled,g.events.publish(e.events.rtowNearbyOrigin,
b)):(b.includeNearbyDestination=a.enabled,g.events.publish(e.events.rtowNearbyDestination,b))}}};a.each(function(){var c=e.options.flareSmartyType,a=h(this),b={cleanUpInputFieldOnFocus:e.options.cleanUpInputFieldOnFocus,flareSmartyType:c,dataSource:e.options.smartyUrl,smartyControlGroup:function(){if(!e.options.showSmartyHistory)return null;new g.Common.SmartyHistory.SmartyFlightHistory;var c=e.getChildElement("origin"),a=e.getChildElement("destination"),b=e.getChildElement("origincode"),f=e.getChildElement("destinationcode"),
d=e.getChildElement("nearbyOriginCheckRtow"),l=e.getChildElement("nearbyDestinationCheckRtow"),k=1===e.element.find(".roundtrip").length,h=e.state,q,v,n,m;e.options.useLegacyDatePicker?q=e.getChildElement("travelDates").daterangePicker().getWidget():(n=e.activeFormController.departDate,m=e.activeFormController.returnDate,v=e.activeFormController.datePicker);return new g.Common.SmartyControlGroup.SmartyFlightControlGroup({form:e.searchForm,formObject:e,originInput:c,destInput:a,originCode:b,destCode:f,
daterangePicker:q,startDate:n,endDate:m,datePicker:v,useLegacyDatePicker:e.options.useLegacyDatePicker,nearbyDeparture:d,nearbyArrival:l,isRoundTrip:k,maxHistory:e.options.maxHistoryItems,state:h,smartyHistory:function(){return new g.Common.SmartyHistory.SmartyFlightHistory}})}(),setItem:k(a),clearItem:l(a),messages:e.options.msg,showAnywhere:e.options.showAnywhere&&this.id===e.id("destination"),showBackgroundAutocomplete:g.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",!1),
animateSmarty:!1,useNearby:e.options.isNearbyInSmarty,enableRemoteHide:e.options.enableSmartyRemoteHide,flippable:e.options.flippableSmarty};"function"===typeof f&&h.extend(b,{beforeStart:f(a)});b.useNearby&&(b.nearbyCallback=n());e.options.showAnywhere&&e.options.anywhereIfEmpty&&this.id===e.id("destination")?b.afterDone=q(a):e.options.backIfEmpty&&(b.afterDone=v(a));if(32===c||51===c||55===c||58===c)b.dropdownClass="smartbox smartbox-air smartbox-v2 smartbox-air-regions";g.config.getBoolean("ui.smarty.greyIcons",
!1)&&(b.dropdownClass=b.dropdownClass+" "+g.config.getString("ui.smarty.iconClasses","greyIcons"));e.options.continents&&(b.continents=e.options.continents,b.showContinents=this.id===e.id("destination"),b.showDropdownWhenEmpty=b.showContinents);e.checkAndSetSmartyUIUpdateOpts(b);a.flightSmarty(b)})},bindTravelerSelectDialog:function(){var a=this,d=function(c,b){c=t(c);return(c?["adults","seniors"]:["child","youth","seatInfant","lapInfant"]).reduce(function(c,b){return a.state.hasOwnProperty(b)?c+
a.state[b]:c},"number"===typeof b?b:0)>=(c?a.options.maxAdults:a.options.maxChildren)},b=function(c,b,f){var e=a.state.travelers+c,l=this,k=t(f)?"adults":"children",g=a.getChildElement("travelers_content");if(1===e)1===b?h(l).getWidget().disableDecrement():h(".gridCellTravelerTypeCount .numberBox-js",g).each(function(){var c=h(this).getWidget();void 0!==c&&1===c.getValue()&&c.disableDecrement()});else if(1<e){var n=e>=a.options.maxTravelers;h(".gridCellTravelerTypeCount .numberBox-js",g).each(function(){var b=
h(this).getWidget(),e=b.element.data("type"),l=t(e)?"adults":"children",g=b.getValue(),q=a.totalAdultCount()+("adults"===k?c:0),v=a.state.lapInfant+("lapInfant"===f?c:0),m=t(e)&&0===q,A="lapInfant"===e&&g>=q,q=t(e)&&v>=q;0===g||m||a.atMinTotalTravelers()||q?b.disableDecrement():b.enableDecrement();n||A||d(e,l===k?c:0)?b.disableIncrement():b.enableIncrement()}).filter(function(){return l!==this})}},c={};h("."+this.travelerDialogClass+" .gridCellTravelerTypeCount .numberBox-js",a.element).each(function(){var f=
this,k=h(f).attr("id").split("-").pop(),l=t(k);if("undefined"===typeof c[k]){var g=function(c){return function(e){b.call(f,e,this.getValue(),c);a.triggerChangeTravelersCount(c,this.getValue())}}(k);h(this).data("type",k);l={callback:g,validator:function(c){var b=a.state.travelers+c;return b<=a.options.maxTravelers&&0<b||d(k,c)||b>a.options.maxTravelers&&0>c||0>b&&0<c?!0:!1},max:l?a.options.maxAdults:a.options.maxChildren};h(this).is(".Common-Widgets-Number-StyleJamNumberBox")?h(this).styleJamNumberBox(l):
h(this).numberBox(l);c[k]=h(this).getWidget().getValue()}});a.travelerTypes=Object.keys(c);Object.keys(c).each(function(b){a.state[b]=c[b];a.state.travelers+=a.state[b]});b(0);var f=this.bindTravelerSelectDialogUI();a.state.cabin=f.value;a.state.cabinDisplayType=f.title;f=h("."+this.travelerDialogClass+" .baggageRow .numberBox-js",a.element);0<f.length&&f.numberBox({callback:function(c){a.triggerChangeBaggageCount(this.getValue())},validator:function(){return!0},max:2})},onChangeTravelersCount:function(a){this.getChildElement(a.travelerType).getWidget().setValue(a.travelerTypeCount,
!1);this.state[a.travelerType]=a.travelerTypeCount;for(var d=a=0;d<this.travelerTypes.length;d++)a+=this.state[this.travelerTypes[d]];this.state.travelers=a;this.updateTravelerDisplay();this.updateLapInfantWarning()},triggerChangeTravelersCount:function(a,d){var b=h.extend({},this.eventDataTemplate);b.travelerType=a;var c=this;b.travelerTypeCount=p(d,function(){return c.getChildElement(a).getWidget().getValue()});g.events.publish(this.events.travelerCount,b);this.vsLog("passengers/"+a);this.gaLog("select-passengers",
a)},initTravellersDropdown:function(a,d){d.showModalBp=this.options.showTravelersModalBp;a.dropdownDialog(d)},onChangeBaggageCount:function(a){this.getChildElement("baggageCount").getWidget().setValue(a.baggageCount,!1);this.state.baggageCount=a.baggageCount},triggerChangeBaggageCount:function(a){var d=h.extend({},this.eventDataTemplate),b=this;d.baggageCount=p(a,function(){return b.getChildElement("baggageCount").getWidget().getValue()});g.events.publish(this.events.baggageCount,d);this.vsLog("baggage-count")},
bindTravelerSelectDialogUI:function(){var a=this,d=this.getChildElement("cabinType"),b=function(c){return function(){var b=c.getWidget().getCheckedPair();"m"===b.value?(a.triggerChangeCabinType("e"),a.getChildElement("travelers").getWidget().close(),a.triggerChangeDisplayCat("multicity"),a.vsLog("/passengers/cabin/m"),a.gaLog("select-cabin","m")):a.triggerChangeCabinType(b.value)}}(d);return d.radioButtonSet({change:b}).getWidget().getCheckedPair()},onChangeCabinType:function(a){var d=this.getChildElement("cabinType").getWidget();
a.cabinType&&d.setButtonCheckedByValue(a.cabinType);a=d.getCheckedPair();this.state.cabin=a.value;this.state.cabinDisplayType=a.title;this.updateTravelerDisplay()},triggerChangeCabinType:function(a){var d=this,b=h.extend({},this.eventDataTemplate);b.cabinType=p(a,function(){return d.getChildElement("cabinType").getWidget().getValue()});g.events.publish(this.events.cabinType,b);this.vsLog("/passengers/cabin/"+a);this.gaLog("select-cabin",a)},bindDaterangePicker:function(a,d,b){var c=this,f=function(a){var b=
c.serialize();return{vertical:"flights",origin:b.origincode,destination:b.destinationcode,isOneWay:b.oneway,departDate:a?void 0:b.depart_date_canon}};this.options.useLegacyDatePicker?(b=b||{getFormData:f,useDaysFormat:!0,minRangeDays:0,change:function(){d(this.getStartDate(),this.getEndDate())},alwaysShowEndDatepicker:this.options.autoOpenNextField,nextFieldSelector:"#"+this.controllers.rtow.searchForm.find(".searchButton").attr("id")},a.daterangePicker(b).getWidget()):(b=b||{change:d,getFormData:f},
h.extend(a.options,b))},checkForValidDates:function(){var a=this.getChildElement("depart"),d=this.getChildElement("return");if(a&&a.getWidget()&&d&&d.getWidget()&&(a=a.getWidget(),d=d.getWidget(),a=a.getDate(),d=d.getDate(),a&&n(Date.now()).isAfter(a,"day")||!a||!d)){d=1;a=8;g&&g.config&&(d=g.config.getInt("ui.horizon.flights.flightroutes.departureDate.offset",d),a=g.config.getInt("ui.horizon.flights.flightroutes.returnDate.offset",a));var b=h.extend({},this.eventDataTemplate);b.startDate=n().add(d,
"d").startOf("day");b.endDate=n().add(a,"d").startOf("day");g.events.publish(this.events.rtowDateRange,b)}},bindShowAirportMapLinks:function(){function a(a){a.preventDefault?a.preventDefault():a.returnValue=!1;b(!1,function(a){c.controllers.rtow.triggerChangeOrigin(a.location,a.code);c.controllers.multi.triggerChangeOrigin(a.location,a.code,0)})}function d(a){a.preventDefault?a.preventDefault():a.returnValue=!1;b(!0,function(a){c.controllers.rtow.triggerChangeDestination(a.location,a.code);c.controllers.multi.triggerChangeDestination(a.location,
a.code,0)})}function b(a,b){var f=c.getChildElement(a?"destination":"origin"),e=f.val(),f=c._getAirportCodeField(f).val();c.openAirportPicker(e,f,"",a,b)}var c=this;this.getChildElement("showAirportMapOriginRtow").click(a.bind(this));this.getChildElement("showAirportMapOriginRtow").keydown(function(c){c.which===g.globals.keyCodes.RETURN&&a(c)});this.getChildElement("showAirportMapDestinationRtow").click(d.bind(this));this.getChildElement("showAirportMapDestinationRtow").keydown(function(c){c.which===
g.globals.keyCodes.RETURN&&d(c)})},onChangeTriggerData:function(a){if(a.disableDestinationFocusAfterAjax){var d=this.disableDestinationFocusAfterAjax;this.disableDestinationFocusAfterAjax=!0}m(a.origincode)||m(a.originname)||(this.controllers.rtow.triggerChangeOrigin(a.originname,a.origincode),this.controllers.multi.triggerChangeOrigin(a.originname,a.origincode,0));m(a.destinationcode)||m(a.destinationname)||(this.controllers.rtow.triggerChangeDestination(a.destinationname,a.destinationcode),this.controllers.multi.triggerChangeDestination(a.destinationname,
a.destinationcode,0),this.controllers.multi.triggerChangeOrigin(a.destinationname,a.destinationcode,1));m(a.departDate)||m(a.returnDate)||(this.controllers.rtow.triggerChangeDateRange(a.departDate,a.returnDate),this.controllers.multi.triggerChangeDepartDate(a.departDate,0),this.controllers.multi.triggerChangeDepartDate(a.returnDate,1));m(a.cabinClass)||this.triggerChangeCabinType(a.cabinClass);m(a.travelerType)||m(a.travelerTypeCount)||this.triggerChangeTravelersCount(a.travelerType,a.travelerTypeCount);
m(a.filter)||(this.options.airlineFilter=a.filter);this.updateLogging(a);this.loadCompareToItems();a.disableDestinationFocusAfterAjax&&(this.disableDestinationFocusAfterAjax=d)},updateTravelDateState:function(a,d){m(a)||m(d)||this.controllers.rtow.triggerChangeDateRange(a,d)},openAirportPicker:function(a,d,b,c,f){c=this.id(c?"airportPickerDestination":"airportPickerOrigin");g.events.publish("flights.airportpicker.open",{id:c,location:a,code:d,hint:b,callback:f})},updateTravelerDisplay:function(){var a=
this,d=this.activeFormController.travelerSelect.getWidget();if(d){var b=function(c,b,e,d,l,g,h){l=null;var f=a.activeFormController.travelerSelect.getWidget();(f=f?f||f.triggerObj:null)&&f.element&&f.element.is(".only-travelers")&&(h=h.onlyTraveler);if(1===e)switch(c.reduce(function(c,a){return 1===b[a]?a:c||""})){case "adults":l=g.formatString(h.travelersDropdownCaptionSingleAdult,d);break;case "seniors":l=g.formatString(h.travelersDropdownCaptionSingleSenior,d);break;case "child":l=g.formatString(h.travelersDropdownCaptionSingleChild,
d);break;default:l=null}null===l&&(l=g.formatChoice(h.travelersDropdownCaptionTravelersChoice,e,e+"",d));return l}(this.travelerTypes,this.state,this.state.travelers,this.state.cabinDisplayType,this.state.baggageCount,g.Common.Utils.String,this.options.msg);d.updateLabel(b)}},updateLapInfantWarning:function(){this.element.removeClass("hasInfantInLapWarning hasTopInfantInLapWarning");g.config.getBoolean("ui.horizon.flights.search.showInfantWarningInForm",!0)&&0<this.state.lapInfant&&(this.element.addClass("hasInfantInLapWarning"),
this.activeFormController===this.controllers.rtow&&this.element.addClass("hasTopInfantInLapWarning"))},onSearchError:function(){this.recalculateDialogDimensions()},serializeTravelers:function(a){a.travelers=this.state.travelers;a.adults=this.state.adults;a.seniors=this.state.seniors;a.youth=this.state.youth;a.child=this.state.child;a.seatInfant=this.state.seatInfant;a.lapInfant=this.state.lapInfant;a.cabin=this.state.cabin;a.cabinDisplayType=this.state.cabinDisplayType;a.baggageCount=this.state.baggageCount;
this.options.showStudents&&(a.students=this.state.students)},loadSlideCMP2:function(){if(this.options.slideCMP2&&!1===this.validate()){this.disableSearchButton();var a=this,d=a.options,b=this.serialize()||{};b.relativeUrl=!0;var b=this.buildSearchURL(b),c={id:this.id("slidecmp2"),url:b,presentation:d.slidePresentation?d.slidePresentation:""};if(d.activeHome&&!d.slideCMP2PreventRedirect)return g.action.execute("flights/search/brands/cheapflights/Redirect",{url:b,returnUrl:!0},function(c){window.location.href=
c}),!0;g.ajax.execute("common/compareto/slide/SlideCompareToFlights",{customUpdate:function(c){a.getChildElement("slidecmp2").replaceWith(c.innerHTML);return!0},data:c});return!0}return!1},loadCompareToItems:function(){this.options.slideCMP2?g.events.publish("cmp2.cleanUp",{id:this.id()+"-compareTo"}):this.base()},validate:function(){var a=!1,d=this.activeFormController.validate();if(this.options.hasSubscriptionPanel){var b=this.notValidSubscription();b&&b.length&&d.push(b)}0===d.length&&(a=!0,d=
this.getStandAloneErrorMessage());if(0===d.length)return!1;if(a)return d[0];for(a=0;a<d.length;a++)d[a]=g.utils.escapeHTML(d[a]);return"\x3cul\x3e\x3cli\x3e"+d.join("\x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e"},getStandAloneErrorMessage:function(){var a=this.state.adults+this.state.seniors;this.options.showStudents&&(a+=this.state.students);return 0===a?[this.options.errMsg.noUnaccompaniedMinors+""]:[]},getTravelerValidationMessages:function(){return this.state.travelers>this.options.maxTravelers?
[g.Common.Utils.String.formatString(this.options.errMsg.tooManyPassengersSelected+"",this.options.maxTravelers)]:1>this.state.travelers?[this.options.errMsg.noPassengersSelected+""]:[]},getDateValidationMessages:function(a,d,b,c){var f=[],e=!m(b),k=!m(c);e||f.push(g.Common.Utils.String.formatChoice(this.options.errMsg.missingLeaveDateChoice,a,a));d||(k?(a=n(b),0>n(c).diff(a,"days")&&f.push(this.options.errMsg.departDateAfterReturnDate)):f.push(this.options.errMsg.missingReturnDate));return f},getLocationValidationMessages:function(a,
d,b){var c=[];m(d)&&c.push(g.Common.Utils.String.formatChoice(this.options.errMsg.missingFromAirportChoice,a,a)+"");m(b)?c.push(g.Common.Utils.String.formatChoice(this.options.errMsg.missingToAirportChoice,a,a)+""):d===b&&c.push(g.Common.Utils.String.formatChoice(this.options.errMsg.uniqueAirportsChoice,a,a)+"");return c},isInternalEvent:function(a){return this.id()===a.id},isConsumeUpdateEvent:function(a){return this.isInternalEvent(a)||!0===this.options.sync},proxyEventCallback:function(a,d,b,c){var f=
this;return function(e){("function"===typeof b?b.call(d,e):f.isConsumeUpdateEvent(e))&&a.apply(d,arguments);("function"===typeof c?c.call(d,e):f.isInternalEvent(e))&&f.loadCompareToItems()}},setNearbyWrapperVisibility:function(a,d){a=m(a)?"hidden":"visible";d=this.element.find(d);d.css("visibility",a);d.removeClass("visible hidden").addClass(a)},recalculateDialogDimensions:function(){g.events.publish("flights.search.dialog.recalculatedimensions",{id:this.id()})},onHookSubmitForIntentMedia:function(a){a&&
"function"===typeof a.callOnSubmit&&(this.intentMediaCallOnSubmit=a.callOnSubmit)},submitIntentMedia:function(){"function"===typeof this.intentMediaCallOnSubmit&&this.intentMediaCallOnSubmit.call(null,this.serialize())},onHookSubmitForSwindle:function(a){a&&"function"===typeof a.callOnSubmit&&(this.swindleCallOnSubmit=a.callOnSubmit)},submitSwindle:function(){if("function"===typeof this.swindleCallOnSubmit){var a=this.serialize()||{};if(this.canSwindleQuery(a)){a.relativeUrl=!0;var d=this.buildSearchURL(a);
a.relativeUrl=!1;a="/"+this.buildSearchURL(a);this.options.slideCMP2&&(a="/s/horizon/flights/search/brands/cheapflights/Redirect?url\x3d"+encodeURIComponent(d));return this.swindleCallOnSubmit.call(null,a,d)}}return!1},canSwindleQuery:function(a){var d="multicity"===this.display,b=this.activeFormController,b=b&&b.isSameDayRoundtrip?b.isSameDayRoundtrip():!1,c=a||this.serialize()||{};a=!!c.freeRegionId||a.countrySearch;c=-1!==["explore","anywhere"].indexOf(c.flex_category);return!d&&!b&&!a&&!c},checkOriginForUpdate:function(){var a=
this;jq.ajax({url:"/s/run/analytic/airport",method:"GET",success:function(d){if(d.success){var b=d.ipAirport?d.ipAirport:"";d=d.ipAirportDisplayName?d.ipAirportDisplayName:b;a.disableDestinationFocusAfterAjax=!0;a.onChangeTriggerData({origincode:b,originname:d});a.disableDestinationFocusAfterAjax=!1;a.shouldSlideCmp2Init()&&a.loadSlideCMP2()}}})},focusFirstElement:function(){this.getChildElement("displayCat").get(0).focus()},createSubControllers:function(){function a(c,a){c=d(c,a);a(c.getSelectedElement(),
!0)}function d(c,a){return h(c).is(".Common-Widgets-Dropdown-StyleJamDropdown")?c.styleJamDropdown({change:function(){a(c.getWidget().getSelectedElement())}}).getWidget():c.dropdown({change:function(){a(c.getWidget().getSelectedElement())}}).getWidget()}var b=this;return{rtow:{originInput:b.getChildElement("origin"),destInput:b.getChildElement("destination"),originCodeInput:b.getChildElement("origincode"),destCodeInput:b.getChildElement("destinationcode"),daterangePicker:b.getChildElement("travelDates"),
advancedDaterangePicker:b.getChildElement("flexTravelDates"),openflexDaterangePicker:b.getChildElement("flexDepartDate"),openflexCalcReturnDate:b.getChildElement("flexCalcReturnDate"),openflexLengthOfStay:b.getChildElement("flexLengthOfStay"),travelerSelect:b.getChildElement("travelers"),searchForm:b.getChildElement("RTOWsearchform"),searchFormWrapper:b.element.find(".searchFormWrapper"),flexCategoryRadio:b.getChildElement("flexCat"),originDepartureSwitch:b.getChildElement("originDepartureSwitch"),
departDate:b.getChildElement("depart").getWidget(),returnDate:b.getChildElement("return").getWidget(),datePicker:b.getChildElement("datePicker").getWidget(),flexDatePicker:b.getChildElement("flexDatePicker").getWidget(),openFlexDatePicker:b.getChildElement("openFlexDatePicker").getWidget(),flexSignUp:b.getChildElement("signup"),flexSignIn:b.getChildElement("login"),oneway:!1,initialized:!1,flexCat:"exact",state:{start_date:null,end_date:null,plusMinusThreeDepart:null,plusMinusThreeReturn:null,weekendDepartDate:null,
weekendDepart:null,weekendReturn:null,nearby_origin:!1,nearby_destination:!1,origin:null,originCode:null,destination:null,destinationCode:null},_extendRadionButton:function(c){c.setValue=function(c){this.element.find("input").each(function(){var a=h(this);a.val()===c?a.prop("checked",!0):a.prop("checked",!1)});g.Widgets.RadiobuttonSet.refresh(this.element)};c.setEnabled=function(c,a){this.element.find("input").each(function(){var b=h(this);b.val()===c&&b.prop("disabled",!a)});g.Widgets.RadiobuttonSet.refresh(this.element)}},
setOneWay:function(c){this.oneway=c;b.options.useLegacyDatePicker?(this.daterangePicker.getWidget().setSingleDateMode(c),"undefined"!==typeof this.advancedDaterangePicker.getWidget()&&this.advancedDaterangePicker.getWidget().setSingleDateMode(c)):(this.datePicker.setDateMode(c?"single":"range",!0),"undefined"!==typeof this.flexDatePicker&&this.flexDatePicker.setDateMode(c?"single":"range",!0));var a=this.getFlexCategory(),e=this.flexCategoryRadio.getWidget();"undefined"!==typeof e&&(!0!==c||"weekend"!==
a&&"openflex"!==a||(e.setButtonCheckedByValue("plusminusthree"),this.setFlexCategory("plusminusthree")),e.setButtonEnabledByValue("weekend",!c),e.setButtonEnabledByValue("openflex",!c));this.searchForm.removeClass("oneway roundtrip");this.searchForm.addClass(c?"oneway":"roundtrip");b.loadCompareToItems()},getFlexCategory:function(){if(this.searchFormWrapper.is(".anywhere-search"))return"anywhere";if(this.searchFormWrapper.is(".continent-search"))return"continents";if(b.options.useFlexDatePicker&&
this.datePicker&&this.datePicker.getFlexCategory)return this.datePicker.getFlexCategory();var c=b.getChildElement("plusMinus3Days");return this.searchFormWrapper.hasClass("advanced")?this.flexCat:c.length&&c.is(":visible")&&c.is(":checked")?"plusminusthree":"exact"},toggleAdvanced:function(){var c=this.state.start_date,a=this.state.end_date;b.options.useLegacyDatePicker&&(c&&(this.daterangePicker.getWidget().setStartDate(c),this.advancedDaterangePicker.getWidget().setStartDate(c),0<this.openflexDaterangePicker.length&&
this.openflexDaterangePicker.getWidget().setStartDate(c)),a&&(this.daterangePicker.getWidget().setEndDate(a),this.advancedDaterangePicker.getWidget().setEndDate(a)));c=!this.searchFormWrapper.hasClass("advanced");this.searchFormWrapper.toggleClass("advanced",c);b.element.find("#toggleAdvanced").attr("aria-pressed",c);b.getChildElement("openAdvancedLink").attr("aria-hidden",!c);b.getChildElement("closeAdvancedLink").attr("aria-hidden",c);c&&b.getChildElement("flexCat").focus();g.events.publish("flights.search.flightSearchForm.toggleAdvanced");
b.vsLog(c?"toggleview/showadvanced":"toggleview/showfewer");b.gaLog("advanced-options",c?"show":"hide")},setFlexCategory:function(c){this.flexCat=c;h(".flexCatBlock",b.element).removeClass("exact weekend plusminusthree openflex").addClass(c);b.vsLog("flexdates/dayofweek/"+c);b.gaLog("select-flextype",c)},bindFlexDisplayCat:function(){var c=this;"undefined"!==typeof this.flexCategoryRadio.radioButtonSet&&this.flexCategoryRadio.radioButtonSet({change:function(a,b){c.setFlexCategory(a.value)}})},bindPlusMinusThreeOptions:function(){var c=
this;a(b.getChildElement("plusMinusThreeDepart"),function(a,e){c.state.plusMinusThreeDepart=a.value;e||(b.vsLog("dayofweek/depart/plusminusthree/"+a.value),b.gaLog("select-flexrange-depart",a.value))});a(b.getChildElement("plusMinusThreeReturn"),function(a,e){c.state.plusMinusThreeReturn=a.value;e||(b.vsLog("dayofweek/arrive/plusminusthree/"+a.value),b.gaLog("select-flexrange-return",a.value))})},bindWeekendOptions:function(){var c=this;a(b.getChildElement("weekendDepartDate"),function(a,e){c.state.weekendDepartDate=
a.value;e||(b.vsLog("dayofweek/depart/weekends/month/"+a.value),b.gaLog("select-weekend-month","upcoming, "+a.value))});a(b.getChildElement("weekendDepart"),function(a,e){c.state.weekendDepart=a.value;e||(b.vsLog("dayofweek/depart/weekends/days/from/"+a.value),b.gaLog("select-weekend-depart",a.value))});a(b.getChildElement("weekendReturn"),function(a,e){c.state.weekendReturn=a.value;e||(b.vsLog("dayofweek/depart/weekends/days/to/"+a.value),b.gaLog("select-weekend-return",a.value))})},bindOpenflexOptions:function(){var c=
this,a=b.getChildElement("flexLengthOfStay"),e=b.getChildElement("nightsAtDestination");a.on("focus",function(){e.hide()}).on("blur",function(){e.show();b.vsLog("daysofweek/depart/flexmonth/choosestaylength");b.gaLog("select-flexmonth",a.val())}).on("change",function(){c.triggerChangeLengthOfStay(a.val())});c.flexSignUp.off("click").on("click",function(){g.authentication.showSignup({promo:"flexDatesSignUpPromo"})});c.flexSignIn.off("click").on("click",function(){g.authentication.showLogin({promo:"flexDatesSignUpPromo"})})},
bindNearbyCheckboxes:function(){var c=this;w(b.getChildElement("nearbyOriginCheckRtow"),function(a){c.triggerChangeNearbyOrigin(a)});w(b.getChildElement("nearbyDestinationCheckRtow"),function(a){c.triggerChangeNearbyDestination(a)})},validate:function(){var c=[],c=c.concat(b.getLocationValidationMessages(0,this.getOriginAirportCode(),this.getDestinationAirportCode())),a=this.getFlexCategory();"weekend"!==a&&"openflex"!==a&&"anywhere"!==a&&(c=this.oneway?c.concat(b.getDateValidationMessages(0,!0,this.state.start_date)):
c.concat(b.getDateValidationMessages(0,!1,this.state.start_date,this.state.end_date)));return c=c.concat(b.getTravelerValidationMessages())},originCodeVal:function(){1===arguments.length&&this.originCodeInput.val(arguments[0]);return this.originCodeInput.val()},getOriginAirportCode:function(){return u(this.state.origin)||r(this.state.originCode)},originLocationVal:function(){1===arguments.length&&this.originInput.val()!==arguments[0]&&this.originInput.val(arguments[0]);return this.originInput.val()},
destinationCodeVal:function(){1===arguments.length&&this.destCodeInput.val(arguments[0]);return this.destCodeInput.val()},getDestinationAirportCode:function(){return u(this.state.destination)||r(this.state.destinationCode)},destinationLocationVal:function(){1===arguments.length&&this.destInput.val()!==arguments[0]&&this.destInput.val(arguments[0]);return this.destInput.val()},serialize:function(){var a={},f=n(this.state.start_date),e=n(this.state.end_date);a.isMulticity=!1;var d=this.getFlexCategory(),
l={},q="continents"===d,m="anywhere"===d||q;if(b.options.useFlexDatePicker&&!m)switch(l=this.datePicker.getFlexDatesData(m),l.flex_category){case "exact":case "plusminusthree":f.isValid()&&(l.depart_date=f.format(g.globals.apiDateFormat));!this.oneway&&e.isValid()&&(l.return_date=e.format(g.globals.apiDateFormat));break;case "weekend":f.isValid()&&(n(f).startOf("month").isSameOrBefore(n())?l.weekend_depart_date="WEEKEND":l.weekend_depart_date=f.format("YYYY-MM-DD"));break;case "openflex":f.isValid()&&
(l.openflex_depart_date=f.toDate())}else l.flex_category=d,"exact"===d||"plusminusthree"===d?(f.isValid()&&(l.depart_date=f.format(g.globals.apiDateFormat)),!this.oneway&&e.isValid()&&(l.return_date=e.format(g.globals.apiDateFormat)),"plusminusthree"===d&&(l.depart_date_flex=this.state.plusMinusThreeDepart,this.oneway||(l.return_date_flex=this.state.plusMinusThreeReturn))):"weekend"===d?(l.weekend_depart_date=this.state.weekendDepartDate,l.weekend_depart=this.state.weekendDepart,l.weekend_return=
this.state.weekendReturn):"openflex"===d&&(l.openflex_depart_date=this.state.openflexDepartDate,l.openflex_length_of_stay=this.state.openflexLengthOfStay);g.config.getBoolean("ui.horizon.flights.search.openExploreWithExactDates",!1)&&m&&(f.isValid()&&(l.depart_date=f.format("YYYYMMDD")),!this.oneway&&e.isValid()&&(l.return_date=e.format("YYYYMMDD")));h.extend(a,l);m&&(b.getChildElement("anymonth").length?(d=b.getChildElement("anymonth").getWidget().getValue(),""!=d&&(a.depart_date_canon=d.split(",")[0],
a.return_date_canon=d.split(",")[1],a.depart_date=n(a.depart_date_canon,"YYYYMMDD").format(g.globals.apiDateFormat),a.return_date=n(a.return_date_canon,"YYYYMMDD").format(g.globals.apiDateFormat))):g.config.getBoolean("ui.explore-dropdown-on-ffd.enabled",!1)&&(a.anywhereRange=g.question.ask("ExploreFlexDatesDropdown.range"),a.anywhereDuration=g.question.ask("ExploreFlexDatesDropdown.duration"),a.anywhereOccasion=g.question.ask("ExploreFlexDatesDropdown.occasion")),q&&(a.continentId=this.state.destinationCode));
a.oneway=this.oneway;a.origin=a.origincode=this.getOriginAirportCode();a.origin_location=this.state.origin;a.origin_code=this.state.originCode;a.legCount=a.oneway?1:2;a.nearby_origin=this.state.nearby_origin;m||(a.destination=a.destinationcode=this.getDestinationAirportCode(),a.destination_location=this.state.destination,a.destination_code=this.state.destinationCode,a.nearby_destination=this.state.nearby_destination,null!==y.exec(a.destination)?a.freeRegionId=parseInt(a.destination.replace(/[A-z]+/,
"")):null!==/[0-9]+[r]{1,2}/.exec(a.destination)?a.regionId=parseInt(a.destination.replace(/[A-z]+/,"")):a.countrySearch=x(a.destination),f.isValid()&&(a.depart_date_canon=n(this.state.start_date).format("YYYY-MM-DD")),!this.oneway&&e.isValid()&&(a.return_date_canon=n(this.state.end_date).format("YYYY-MM-DD")));b.serializeTravelers(a);return a},initState:function(a){a=a||{};this.triggerChangeOrigin();this.triggerChangeDestination();this.triggerChangeDateRange();this.triggerChangeNearbyOrigin(a.nearby_origin,
b.options.isNearbyInSmarty);this.triggerChangeNearbyDestination(a.nearby_destination,b.options.isNearbyInSmarty);this.triggerChangeLengthOfStay(a.openflex_length_of_stay);b.options.useFlexDatePicker&&!b.options.regionSearch&&"anywhere"!==a.flex_category&&(b.options.useFlexRadioButtons&&(a=this.datePicker.getRadioButtonSimplifiedFlexData(a)),this.datePicker.loadFlexData(a));b.options.flexDatesSignUpPromoEnabled&&"exact"!==b.options.flex_category&&(g.Analytics.api.trackEvent({category:"flexDatesSignUpPromo",
action:"open",label:b.options.flex_category}),this.toggleAdvanced(),this.flexCategoryRadio.getWidget().focusRadio())},onCmp2GoodToLoad:function(a){return g.config.getBoolean("ui.flights.form.cmp2.allPass",!1)||!a||!a.hasOwnProperty("originLocation")&&!a.hasOwnProperty("destinationLocation")?!0:!!(a.originLocation&&a.originCode||a.destinationLocation&&a.destinationCode)},onChangeOrigin:function(a){this.originLocationVal(a.originLocation);this.originCodeVal(a.originCode);0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&
this.originCodeVal(a.originLocation);this.state.origin=this.originLocationVal()||"";this.state.originCode=this.originCodeVal()||"";a.refreshNearby&&b.setNearbyWrapperVisibility(this.state.origin,".rtow .originBlock .nearbyWrapper")},triggerChangeOrigin:function(a,f,e,d){var c=h.extend({},b.eventDataTemplate),k=this;c.originLocation=p(a,function(){return k.originLocationVal()});c.originCode=p(f,function(){return k.originCodeVal()});c.refreshNearby=!(""===a&&""===f);c.item=e;c.odSwitch=d;b.disableDestinationFocusAfterAjax&&
(c.disableDestinationFocusAfterAjax=!0);g.events.publish(b.events.rtowOrigin,c);f=h.extend({},c);f.legIndex=0;g.events.publish(b.events.multiOrigin,f);a&&(b.vsLog("location/origin"),b.gaLog("select-origin"))},onChangeDestination:function(a){this.destinationLocationVal(a.destinationLocation);this.destinationCodeVal(a.destinationCode);0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&this.destinationCodeVal(a.destinationLocation);this.state.destination=this.destinationLocationVal()||
"";this.state.destinationCode=this.destinationCodeVal()||"";a.refreshNearby&&b.setNearbyWrapperVisibility(this.state.destination,".rtow .destinationBlock .nearbyWrapper")},triggerChangeDestination:function(a,f,e,d){var c=h.extend({},b.eventDataTemplate),k=this;c.destinationLocation=p(a,function(){return k.destinationLocationVal()});c.destinationCode=p(f,function(){return k.destinationCodeVal()});c.refreshNearby=!(""===a&&""===f);c.item=e;c.odSwitch=d;g.events.publish(b.events.rtowDestination,c);f=
h.extend({},c);f.legIndex=0;g.events.publish(b.events.multiDestination,f);a&&(b.vsLog("location/destination"),b.gaLog("select-destination"))},onChangeDateRange:function(a){if(b.options.useLegacyDatePicker){var c=this.daterangePicker.getWidget();c.setStartDate(a.startDate);c.setEndDate(a.endDate);0<this.advancedDaterangePicker.length&&(c=this.advancedDaterangePicker.getWidget(),c.setStartDate(a.startDate),c.setEndDate(a.endDate));0<this.openflexDaterangePicker.length&&(c=this.openflexDaterangePicker.getWidget(),
c.setStartDate(a.startDate),c=c.getStartDate())&&(c=n(c).add(1,"month").subtract(1,"day"),c=c.format("ddd M/D"),c=replaceArgs(b.options.msg.openflexToDateWithLengthIntro,c),this.openflexCalcReturnDate.text(c))}else c=this.returnDate.getDate(),"undefined"!==typeof a.startDate&&this.departDate.setDate(a.startDate),"undefined"!==typeof a.endDate?null!==a.endDate&&"undefined"!==typeof a.startDate&&n(a.startDate).isSameOrBefore(n(a.endDate))?this.returnDate.setDate(a.endDate):this.returnDate.setDate(null):
null!==c&&"undefined"!==typeof a.startDate&&c.isSameOrBefore(n(a.startDate))&&this.returnDate.setDate(null),b.options.flexMonthEnabled&&(c=n(c).add(1,"month").subtract(1,"day"),c=c.format("ddd M/D"),c=replaceArgs(b.options.msg.openflexToDateWithLengthIntro,c),this.openflexCalcReturnDate.text(c));a.startDate&&(this.state.openflexDepartDate=a.startDate,this.state.start_date=a.startDate);a.endDate&&(this.state.end_date=a.endDate);b.vsLog("dropoffdate");b.gaLog("select-date","depart:"+n(this.state.start_date).format("MMM Do YY")+
", return:"+n(this.state.end_date).format("MMM Do YY"))},triggerChangeDateRange:function(a,f){var c=this,d=n(a);null!==a&&void 0!==a&&d.isValid()&&(a=d);d=n(f);null!==f&&void 0!==f&&d.isValid()&&(f=d);d=h.extend({},b.eventDataTemplate);if(b.options.useLegacyDatePicker){var l=this.daterangePicker.getWidget();d.startDate=p(a,function(){return l.getStartDate()});d.endDate=p(f,function(){return l.getEndDate()})}else d.startDate=p(a,function(){return c.departDate.getDate()}),d.endDate=p(f,function(){return c.returnDate.getDate()});
g.events.publish(b.events.rtowDateRange,d)},onChangeNearbyOrigin:function(a){z(b.getChildElement("nearbyOriginCheckRtow"),a.includeNearbyOrigin);this.state.nearby_origin=a.includeNearbyOrigin},triggerChangeNearbyOrigin:function(a,f){var c=h.extend({},b.eventDataTemplate);c.includeNearbyOrigin=p(a,function(){var a=b.getChildElement("nearbyOriginCheckRtow");return 1>a.length?!1:a[0].checked});g.events.publish(b.events.rtowNearbyOrigin,c);f&&this.originInput.getWidget().setIsNearbyChecked(c.includeNearbyOrigin);
b.vsLog("location/addnearby/"+(c.includeNearbyOrigin?"on":"off"));b.gaLog("add-nearby",c.includeNearbyOrigin?"on-"+this.originLocationVal():"off-"+this.originLocationVal())},onChangeNearbyDestination:function(a){z(b.getChildElement("nearbyDestinationCheckRtow"),a.includeNearbyDestination);this.state.nearby_destination=a.includeNearbyDestination},triggerChangeNearbyDestination:function(a,f){var c=h.extend({},b.eventDataTemplate);c.includeNearbyDestination=p(a,function(){var a=b.getChildElement("nearbyDestinationCheckRtow");
return 1>a.length?!1:a[0].checked});g.events.publish(b.events.rtowNearbyDestination,c);f&&this.destInput.getWidget().setIsNearbyChecked(c.includeNearbyDestination);b.vsLog("location/addnearby/"+(c.includeNearbyOrigin?"on":"off"));b.gaLog("add-nearby",c.includeNearbyDestination?"on-"+this.destinationLocationVal():"off-"+this.destinationLocationVal())},onChangeLengthOfStay:function(a){var c=b.getChildElement("flexLengthOfStay");c.val()!==a.lengthOfStay&&c.val(a.lengthOfStay);this.state.openflexLengthOfStay=
a.lengthOfStay},triggerChangeLengthOfStay:function(a){var c=h.extend({},b.eventDataTemplate);c.lengthOfStay=a||"6-8";g.events.publish(b.events.rtowLengthOfStay,c)},onOriginDepartureSwitch:function(a){if(b.id()===a.id||!0===b.options.sync){a=this.destInput.val();var c=this.destCodeInput.val();g.config.getBoolean("ui.horizon.flights.smarty.od.switch.validate.enabled",!0)&&/^\d+[r|fr|cy]+$|^any$|^[A-Z]{2}cg$/.test(this.destCodeInput[0].value)&&(c=a="");var e=this.originInput.val();this.originInput.val(a);
this.destInput.val(e);e=this.originCodeInput.val();this.originCodeInput.val(c);this.destCodeInput.val(e);this.triggerChangeDestination(null,null,null,!0);this.triggerChangeOrigin(null,null,null,!0);a=b.getChildElement("nearbyOriginCheckRtow");c=b.getChildElement("nearbyDestinationCheckRtow");a.is(":checked")!==c.is(":checked")&&(a.click(),c.click());b.loadCompareToItems()}},buildSearchURL:function(a){var c={},e={originId:a.origin,destinationId:a.destination,originLocation:a.origin_location,originCountry:a.originCountry,
destinationLocation:a.destination_location,includeNearbyOrigin:a.nearby_origin,includeNearbyDestination:a.nearby_destination,cabinClass:a.cabin,baggageCount:a.baggageCount,departDate:a.depart_date_canon,returnDate:a.return_date_canon,plusMinusThreeDepart:a.depart_date_flex,plusMinusThreeReturn:a.return_date_flex,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,weekendDepartDate:a.weekend_depart_date,weekendDepart:a.weekend_depart,weekendReturn:a.weekend_return,
openflexDepartDate:a.openflex_depart_date,openflexLengthOfStay:a.openflex_length_of_stay,relativeUrl:a.relativeUrl};g.config.getBoolean("ui.explore-dropdown-on-ffd.enabled",!1)&&(e.anywhereDuration=a.anywhereDuration,e.anywhereOccasion=a.anywhereOccasion,e.anywhereRange=a.anywhereRange);b.options.showStudents&&(e.students=a.students);m(a.airlineFilter)||(e.airlineFilter=a.airlineFilter);e.regionSearch=b.options.regionSearchEnabled&&a.destination&&(y.exec(a.destination)||x(a.destination));(a=b.getDirectOptionValue())&&
(c=h.extend(c,a));e.hostUrl=b.options.hostUrl;b.searchFormFilterState=h.isEmptyObject(c)?null:c;return g.flights.search.FlightSearchFormUrls.generateRtowFlightsUrl(e,this.getFlexCategory(),this.oneway,c)},bindAdvanced:function(){this.bindWeekendOptions();this.bindOpenflexOptions();this.bindPlusMinusThreeOptions();this._extendRadionButton(this.flexCategoryRadio.getWidget())},bindFlexDatePicker:function(){b.subscribe("DatePicker.update",{updateGroup:"RTOWDates"},this.onFlexDatePickerUpdate.bind(this))},
onFlexDatePickerUpdate:function(a){if(a.flex)switch(a.flex){case "plusminusthree":case "exact":this.searchFormWrapper.removeClass("show-flex-display");break;case "weekend":case "openflex":this.searchFormWrapper.addClass("show-flex-display")}},bindAll:function(){var a=this,f=b.element.find("#toggleAdvanced");f.click(function(){a.toggleAdvanced()});f.keydown(function(b){b.which===g.globals.keyCodes.RETURN&&a.toggleAdvanced()});this.bindFlexDisplayCat();!0!==b.options.disabledAdvanced?this.bindAdvanced():
b.options.useFlexDatePicker&&this.bindFlexDatePicker();this.bindNearbyCheckboxes();b.bindFlightSmartyFields(this.originInput,!0,h.proxy(this.triggerChangeOrigin,this));b.bindFlightSmartyFields(this.destInput,!1,h.proxy(this.triggerChangeDestination,this));b.options.useLegacyDatePicker?(f=this.daterangePicker.add(this.advancedDaterangePicker).add(this.openflexDaterangePicker),b.bindDaterangePicker(f,h.proxy(this.triggerChangeDateRange,this))):(b.bindDaterangePicker(this.datePicker,h.proxy(this.triggerChangeDateRange,
this)),this.flexDatePicker&&b.bindDaterangePicker(this.flexDatePicker,h.proxy(this.triggerChangeDateRange,this)),b.options.flexMonthEnabled&&this.openFlexDatePicker&&b.bindDaterangePicker(this.openFlexDatePicker,h.proxy(this.triggerChangeDateRange,this)));f=this.searchForm.closest(".viewport").find(".content");b.initTravellersDropdown(this.travelerSelect,{content:h("."+b.travelerDialogClass,b.element),container:f.length?f:void 0});this.searchForm.find(".inlineDisplayView .changeButton").click(function(a){a.preventDefault();
a.stopPropagation();b.setView("inlineform");return!1});if(b.wholeMonthSearch){if("undefined"!==typeof g.storage&&"wholeMonthSearch"===("undefined"!==typeof g.storage.get("daterangePickerDefaultNavTab")?g.storage.get("daterangePickerDefaultNavTab"):"specificDate")){var f=a.daterangePicker.getWidget(),e=n().startOf("month").format("M"),d=n().startOf("year").format("Y");"undefined"!==typeof g.storage&&(null===g.storage.get("flexSelectedMonth")&&g.storage.set("flexSelectedMonth",n().format("M")),null===
g.storage.get("flexSelectedYear")&&g.storage.set("flexSelectedYear",n().format("Y")),e=g.storage.get("flexSelectedMonth"),d=g.storage.get("flexSelectedYear"));e=new Date(d,e-1,1);n(e).isBefore(n())&&(e=n().add(1,"d").toDate());f.setStartDate(e);f.startDisplay.text("Select a month...")}b.subscribe("flights.search.rt.form.wholeMonthSelect.setWholeMonthCategory",{group:"wholeMonthSelect"},function(){!0===a.oneway?(a.setOneWay(!0),jq(".tabWrapper.specificDate").click()):(a.setFlexCategory("openflex"),
a.flexCategoryRadio.getWidget().setButtonCheckedByValue("openflex"),a.daterangePicker.getWidget().startDisplay.text("Select a month..."),a.searchFormWrapper.hasClass("advanced")||a.searchFormWrapper.addClass("advanced"),a.searchFormWrapper.hasClass("plusMinus")&&a.searchFormWrapper.removeClass("plusMinus"))});b.subscribe("flights.search.rt.form.wholeMonthSelect.setSpecificDateCategory",{group:"wholeMonthSelect"},function(c){var e=!1;"undefined"!==typeof g.storage&&(e=g.storage.get("flexPlusMinusChecked",
!0));e?(a.searchFormWrapper.hasClass("advanced")||a.searchFormWrapper.addClass("advanced"),a.searchFormWrapper.hasClass("plusMinus")||a.searchFormWrapper.addClass("plusMinus")):a.searchFormWrapper.removeClass("advanced plusMinus");a.daterangePicker.getWidget().updateDOM();a.setFlexCategory("plusminusthree");a.flexCategoryRadio.getWidget().setButtonCheckedByValue("plusminusthree");var e=b.getChildElement("plusMinusThreeDepart").dropdown({}).getWidget(),f=b.getChildElement("plusMinusThreeReturn").dropdown({}).getWidget();
c.hasOwnProperty("depart_date_flex")&&c.depart_date_flex&&(e.setValue(c.depart_date_flex),a.state.plusMinusThreeDepart=c.depart_date_flex);c.hasOwnProperty("return_date_flex")&&c.return_date_flex&&(f.setValue(c.return_date_flex),a.state.plusMinusThreeReturn=c.return_date_flex)});b.subscribe("flights.search.rt.form.wholeMonthSelect.enablePlusMinusSearch",{group:"wholeMonthSelect"},function(){a.searchFormWrapper.hasClass("advanced plusMinus")||a.searchFormWrapper.addClass("advanced plusMinus")});b.subscribe("flights.search.rt.form.wholeMonthSelect.disablePlusMinusSearch",
{group:"wholeMonthSelect"},function(){a.searchFormWrapper.hasClass("advanced plusMinus")&&a.searchFormWrapper.removeClass("advanced plusMinus")});b.subscribe("flights.search.rt.form.wholeMonthSelect",{group:"wholeMonthSelect"},function(c){var e=a.daterangePicker.getWidget();e.setStartDate(c.startDate);e.setEndDate(c.endDate);0<a.advancedDaterangePicker.length&&(e=a.advancedDaterangePicker.getWidget(),e.setStartDate(c.startDate),e.setEndDate(c.endDate));0<a.openflexDaterangePicker.length&&(e=a.openflexDaterangePicker.getWidget(),
e.setStartDate(c.startDate),e=e.getStartDate())&&(e=n(e).add(1,"month").subtract(1,"day"),e=e.format("ddd M/D"),e=replaceArgs(b.options.msg.openflexToDateWithLengthIntro,e),a.openflexCalcReturnDate.text(e));a.state.openflexDepartDate=c.startDate;a.state.start_date=c.startDate;a.state.end_date=c.endDate});b.subscribe("flights.search.rt.form.noOfNightsChanged",{group:"wholeMonthSelect"},function(c){a.openflexLengthOfStay.val(c.noOfNights);a.state.openflexLengthOfStay=c.noOfNights})}b.subscribe(b.events.rtowOrigin,
b.proxyEventCallback(this.onChangeOrigin,this,null,this.onCmp2GoodToLoad));b.subscribe(b.events.rtowDestination,b.proxyEventCallback(this.onChangeDestination,this,null,this.onCmp2GoodToLoad));b.subscribe(b.events.rtowDateRange,b.proxyEventCallback(this.onChangeDateRange,this,null,this.onCmp2GoodToLoad));b.subscribe(b.events.rtowNearbyOrigin,b.proxyEventCallback(this.onChangeNearbyOrigin,this));b.subscribe(b.events.rtowNearbyDestination,b.proxyEventCallback(this.onChangeNearbyDestination,this));b.subscribe(b.events.rtowLengthOfStay,
b.proxyEventCallback(this.onChangeLengthOfStay,this));b.subscribe("flights.search.swapLocations",this.onOriginDepartureSwitch.bind(this));this.originDepartureSwitch.on("click",{formId:b.id()},function(a){g.Analytics.api.trackEvent({category:"od-switch",action:"click"});g.events.publish("flights.search.swapLocations",{id:a.data.formId})});this.originDepartureSwitch.on("keypress",{formId:b.id()},function(a){switch(a.which){case g.globals.keyCodes.SPACE:case g.globals.keyCodes.RETURN:a.preventDefault(),
g.Analytics.api.trackEvent({category:"od-switch",action:"click"}),g.events.publish("flights.search.swapLocations",{id:a.data.formId})}})},setup:function(){this.bindAll();this.initialized=!0},activate:function(){this.initialized||this.setup();!0===this.oneway&&this.setOneWay(!0);this.triggerChangeDateRange();b.updateTravelerDisplay();this.searchForm.addClass("active").attr("aria-hidden","false");if(b.element.is(".Flights-Search-StyleJamFlightSearchForm")){var a=g.stylejam.flights.search.StyleJamFlightSearchForm;
g.dom.swapClasses(this.searchForm,a.searchFormHidden,a.searchFormVisible)}}},multi:{searchForm:b.getChildElement("multi-searchform"),travelerSelect:b.getChildElement("multi-travelers"),addMoreLegsLink:b.getChildElement("addMoreLegs"),clearAllLink:b.getChildElement("clearLegs"),initialized:!1,indexLastVisibleLeg:b.options.backFromRP?b.options.multicityOptions.length-1:b.options.defaultLegsVisible-1,maxLegs:b.options.maxLegs,legState:{origin:"",destination:"",originCode:"",destinationCode:"",depart_date:null,
depart_time:"a",cabin_type:"e",nearby_origin:!1,nearby_destination:!1},defaultLegState:b.options.multicityOptions,backFromRP:b.options.backFromRP,legStates:[],removeLeg:function(a){for(;a<(this.backFromRP?this.defaultLegState.length-1:this.maxLegs-1);a++)a<this.indexLastVisibleLeg?this.copyLeg(a+1,a):(this._legAccessor(a).visible(!1),this.setLegWidgetValues(a,this.legState));this.setLegWidgetValues(a,this.legState);this._legAccessor(a).visible(!1);--this.indexLastVisibleLeg;this.addMoreLegsLink.show();
b.vsLog("multicity/removeleg");b.gaLog("clear-multicity")},addLeg:function(){this.indexLastVisibleLeg<this.maxLegs-1&&(this.indexLastVisibleLeg+=1,this.setLegWidgetValues(this.indexLastVisibleLeg,this.legState),this._legAccessor(this.indexLastVisibleLeg).visible(!0));this.indexLastVisibleLeg>=this.maxLegs-1&&this.addMoreLegsLink.hide();b.vsLog("multicity/addanotherflight");b.gaLog("select-add-another-flight")},updateLegState:function(a){var b=this._legAccessor(a);a=this.legStates[a];a.origin=b.origin();
a.originCode=b.originCode();a.destination=b.destination();a.destinationCode=b.destinationCode();a.depart_date=b.departDate();a.depart_time=b.departTime();a.cabin_type=b.cabinType();a.nearby_origin=b.nearbyOrigin();a.nearby_destination=b.nearbyDestination()},setLegWidgetValues:function(a,b){var c=this._legAccessor(a);c.origin(b.origin);c.destination(b.destination);c.originCode(b.originCode);c.destinationCode(b.destinationCode);c.departDate(b.depart_date);c.departTime(b.depart_time);c.cabinType(b.cabin_type);
c.nearbyOrigin(b.nearby_origin);c.nearbyDestination(b.nearby_destination);this.updateLegState(a)},copyLeg:function(a,b){a=this._legAccessor(a);var c=this._legAccessor(b);c.origin(a.origin());c.destination(a.destination());c.originCode(a.originCode());c.destinationCode(a.destinationCode());c.departDate(a.departDate());c.departTime(a.departTime());c.cabinType(a.cabinType());c.nearbyOrigin(a.nearbyOrigin());c.nearbyDestination(a.nearbyDestination());this.updateLegState(b)},validate:function(){for(var a=
[],d=0;d<=this.indexLastVisibleLeg;d++){var e=this._legAccessor(d);if(!1===this.isLegEmpty(e)||0===d)this.updateLegState(d),e=this.validateLeg(d),!0!==e&&(a=a.concat(e))}return a=a.concat(b.getTravelerValidationMessages())},validateLeg:function(a){var c=this.legStates[a];a+=1;var e=[],d=u(c.origin)||r(c.originCode),g=u(c.destination)||r(c.destinationCode),e=e.concat(b.getLocationValidationMessages(a,d,g));return e=e.concat(b.getDateValidationMessages(a,!0,c.depart_date,null))},serialize:function(){var a=
{};b.serializeTravelers(a);a.isMulticity=!0;for(var d=0,e=g.config.getBoolean("ui.flights.userhistory.usefulllocationcode",!0),k=g.config.getBoolean("ui.flights.mc.useMultiApCode",!0),l,h=0;h<=this.indexLastVisibleLeg;h++){var m=this._legAccessor(h);!1===this.isLegEmpty(m)&&(this.updateLegState(h),m=this.legStates[h],e?(a["origin"+d]=a["origincode"+d]=m.originCode,a["destination"+d]=a["destinationcode"+d]=m.destinationCode):(a["origin"+d]=a["origincode"+d]=r(m.originCode),a["destination"+d]=a["destinationcode"+
d]=r(m.destinationCode)),a["originLocation"+d]=m.origin,a["destinationLocation"+d]=m.destination,k&&((l=u(m.origin))&&(a["origin"+d]=a["origincode"+d]=l),(l=u(m.destination))&&(a["destination"+d]=a["destinationcode"+d]=l)),a["nearby_origin"+d]=m.nearby_origin,a["nearby_destination"+d]=m.nearby_destination,l=m.depart_date,a["depart_date"+d]=n(l).format(g.globals.apiDateFormat),a["depart_date_canon"+d]=n(l).format("YYYY-MM-DD"),a["depart_time"+d]=m.depart_time,a["cabin_type"+d]=m.cabin_type,d+=1)}a.origin_location=
a.originLocation0;a.origincode=a.origincode0;a.destination_location=a.destinationLocation0;a.destinationcode=a.destinationcode0;a.depart_date=a.depart_date0;a.nearby_origin=a.nearby_origin0;a.nearby_destination=a.nearby_destination0;a.nrLegs=a.legCount=d;return a},isLegEmpty:function(a){return m(a.originCode())&&m(a.destinationCode())&&m(a.departDate())?!0:!1},buildSearchURL:function(a){var c={cabinClass:a.cabin,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,
lapInfants:a.lapInfant,legData:[]};b.options.showStudents&&(c.students=a.students);for(var d=0;d<a.nrLegs;d++){var k={};k.originId=a["origin"+d];k.destinationId=a["destination"+d];k.originLocation=a["originLocation"+d];k.destinationLocation=a["destinationLocation"+d];k.includeNearbyOrigin=a["nearby_origin"+d];k.includeNearbyDestination=a["nearby_destination"+d];k.departDate=a["depart_date_canon"+d];k.departTime=a["depart_time"+d];k.legCabinClass=a["cabin_type"+d];c.legData[d]=k}m(a.airlineFilter)||
(c.airlineFilter=a.airlineFilter);c.hostUrl=b.options.hostUrl;return g.flights.search.FlightSearchFormUrls.generateMultiCityFlightsUrl(c,a.nrLegs)},_legAccessor:function(a){function c(a,b){void 0!==b&&b!==a.val()&&a.val(b);return a.val()}function d(c){return b.getChildElement(c+a)}function g(a,b){if(!a||!a.length)return!1;void 0!==b&&z(a,b);return a[0].checked}return{origin:function(a){return c(d("origin"),a)},destination:function(a){return c(d("destination"),a)},originCode:function(a){return c(d("origincode"),
a)},destinationCode:function(a){return c(d("destinationcode"),a)},departDate:function(a){if(b.options.useLegacyDatePicker){var c=d("depart_date").getWidget();void 0!==a&&c.setStartDate(a);return c.getStartDate()}c=d("departDate").getWidget();void 0!==a&&c.setDate(a);return c.getDate()},departTime:function(a){var b=d("depart_time").getWidget();if(!b)return"";void 0!==a&&b.setValue(a);return b.getValue()},cabinType:function(a){var b=d("cabin_type").getWidget();if("undefined"===typeof b)return"";void 0!==
a&&b.setValue(a);return b.getValue()},nearbyOrigin:function(a){return g(d("nearbyOriginCheck"),a)},nearbyDestination:function(a){return g(d("nearbyDestinationCheck"),a)},visible:function(a){var b=d("multiCityLeg");!1!==a?(b.removeClass("hiddenLeg"),b.find("input").first().focus()):b.addClass("hiddenLeg");return!b.hasClass("hiddenLeg")}}},initTravellerDropdown:function(a){var c=this;b.initTravellersDropdown(this.travelerSelect,{container:a.length?a:void 0,content:h("."+b.travelerDialogClass,b.element),
onOpen:function(a){c.searchForm.is(".mixedcabins")&&a.content.addClass("mixedcabins");if(a.content.is(".Flights-Frontdoor-StyleJamTravelersDialog-Content")){a=h(a.content).find(".cabinWrapper-js");var b=g.stylejam.flights.search.StyleJamFlightSearchForm;g.dom.swapClasses(a,b.searchFormVisible,b.searchFormHidden)}},onClose:function(a,b){b.content.removeClass("mixedcabins");b.content.is(".Flights-Frontdoor-StyleJamTravelersDialog-Content")&&(a=h(b.content).find(".cabinWrapper-js"),b=g.stylejam.flights.search.StyleJamFlightSearchForm,
g.dom.swapClasses(a,b.searchFormHidden,b.searchFormVisible))}})},setup:function(){for(var a=this,f=0;f<this.maxLegs;f++)this.legStates.push(h.extend({},this.backFromRP&&f<this.defaultLegState.length?this.defaultLegState[f]:this.legState)),function(a,c,f){function e(a,c){var d=n(a._legAccessor(c).departDate());if(null!=d)for(c+=1;c<b.options.maxLegs;c++){var f=a._legAccessor(c),e=n(f.departDate());null!=e&&e.isBefore(d)&&f.departDate(null)}}function g(c){var d,e;for(e=a-1;0<=e;e--)if(d=f._legAccessor(e).departDate(),
null!=d){b.options.useLegacyDatePicker?c.minDate=d:c.setMinDate(d);break}}if(b.options.useLegacyDatePicker){var k=b.getChildElement("depart_date"+a);b.bindDaterangePicker(k,null,{getFormData:function(){var b=f.serialize();return{vertical:"flights",origin:b["origincode"+a],destination:b["destinationcode"+a],isOneWay:b.oneway}},useDaysFormat:!0,singleDateMode:!0,singlePickerWithSingleField:!0,minDateFunc:g,change:function(){f.triggerChangeDepartDate(this.getStartDate(),a);e(f,a)},skipForceSetDefaultStartOnFocusBlur:!0});
k.getWidget().singleDateMode=!0;if(0===a||null!=c.departDate)c.depart_date=null!=c.departDate?n(c.departDate):k.getWidget().getStartDate()}else if(k=b.getChildElement("departDate%s".format(a)).getWidget(),b.bindDaterangePicker(k,null,{getFormData:function(){var b=f.serialize();return{vertical:"flights",origin:b["origincode"+a],destination:b["destinationcode"+a],isOneWay:b.oneway}},minDateFunc:g,change:function(b){f.triggerChangeDepartDate(b.date,a);e(f,a)}}),0===a||null!=c.departDate)c.depart_date=
null!=c.departDate?n(c.departDate):void 0;k=b.getChildElement("depart_time"+a);d(k,function(c){f.triggerChangeDepartTime(c.value,a);b.vsLog("multicity/choosetime/"+c.value);b.gaLog("select-multicitytime")});w(b.getChildElement("nearbyOriginCheck"+a),function(c){f.triggerChangeNearbyOrigin(c,a);b.vsLog("location/addnearby/"+(c?"on":"off"));b.gaLog("add-nearby",c?"on-"+f._legAccessor(a).origin():"off-"+f._legAccessor(a).origin())});w(b.getChildElement("nearbyDestinationCheck"+a),function(c){f.triggerChangeNearbyDestination(c,
a);b.vsLog("location/addnearby/"+(c?"on":"off"));b.gaLog("add-nearby",c?"on-"+f._legAccessor(a).destination():"off-"+f._legAccessor(a).destination())});k=b.getChildElement("cabin_type"+a);d(k,function(c){f.triggerChangeLegCabinType(c.value,a);b.vsLog("multicity/chooselegcabintype/"+c.value);b.gaLog("select-multicitytlegcabintype")});["removeLegTop","removeLegBottom"].forEach(function(c){b.getChildElement(c+a).click(function(){f.triggerRemoveLeg(a)})},this);b.getChildElement("removeLeg"+a).click(function(){f.triggerRemoveLeg(a)});
var k=b.getChildElement("origin"+a),l=b.getChildElement("destination"+a),m=function(a,b){return function(c,d){b.triggerChangeOrigin(c,d,a)}}(a,f),p=function(a,b){return function(c,d){b.triggerChangeDestination(c,d,a)}}(a,f),r=function(a,b){return function(c){b.triggerChangeNearbyOrigin(c,a)}}(a,f),t=function(a,b){return function(c){b.triggerChangeNearbyDestination(c,a)}}(a,f);b.bindFlightSmartyFields(k,!1,m,r,function(a){var c,d=a.prop("id").match(/^.*?-(?:destination|origin)(\d+)$/);2===d.length&&
(c=d[1]);return function(d,f){if(!d.elementNode.value&&(!f||8!==f.keyCode&&46!==f.keyCode)&&c&&0<c){f=b._getAirportCodeField(a);var e=c-1,g=b.getChildElement("destination"+e),e=b.getChildElement("destinationcode"+e);d.elementNode.value=g.val();f.val(e.val());d.elementNode.focus();h(this).select()}}});b.bindFlightSmartyFields(l,!0,p,t);c.origin=b.getChildElement("origin"+a).val();c.originCode=b.getChildElement("origincode"+a).val();c.destination=b.getChildElement("destination"+a).val();c.destinationCode=
b.getChildElement("destinationCode"+a).val();f.setLegWidgetValues(a,c)}(f,this.legStates[f],this);f=this.searchForm.closest(".viewport").find(".content");this.initTravellerDropdown(f);this.addMoreLegsLink.click(function(b){a.triggerAddLeg();b.preventDefault?b.preventDefault():b.returnValue=!1});this.clearAllLink.keypress(function(b){b.preventDefault();switch(b.which){case g.globals.keyCodes.SPACE:case g.globals.keyCodes.RETURN:a.clearAllLink.click()}});this.clearAllLink.click(function(b){for(var c=
0;c<=a.indexLastVisibleLeg;c++){var d=a.legStates[c];d.origin="";d.originCode="";d.destination="";d.destinationCode="";d.depart_date="";d.depart_time="";d.cabin_type="";d.nearby_origin="";d.nearby_destination="";a.setLegWidgetValues(c,d)}b.preventDefault()});b.subscribe(b.events.multiOrigin,this.multiProxyEventCallback(this.onChangeOrigin,this));b.subscribe(b.events.multiDestination,this.multiProxyEventCallback(this.onChangeDestination,this));b.subscribe(b.events.multiDepartDate,this.multiProxyEventCallback(this.onChangeDepartDate,
this));b.subscribe(b.events.multiDepartTime,this.multiProxyEventCallback(this.onChangeDepartTime,this));b.subscribe(b.events.multiNearbyOrigin,this.multiProxyEventCallback(this.onChangeNearbyOrigin,this));b.subscribe(b.events.multiNearbyDestination,this.multiProxyEventCallback(this.onChangeNearbyDestination,this));b.subscribe(b.events.multiLegCabinType,this.multiProxyEventCallback(this.onChangeLegCabinType,this));b.subscribe(b.events.multiRemoveLeg,this.multiProxyEventCallback(this.onRemoveLeg,this));
b.subscribe(b.events.multiAddLeg,this.multiProxyEventCallback(this.onAddLeg,this));this.initialized=!0},multiProxyEventCallback:function(a,d){return b.proxyEventCallback(a,d,function(a){return b.id()===a.id||!0===b.options.sync&&(0===a.legIndex||b.options.mixedCabinsUI&&1===a.legIndex)},function(){return!1})},activate:function(){this.initialized||this.setup();b.updateTravelerDisplay();for(var a=0;a<this.indexLastVisibleLeg;a++)if("any"===this._legAccessor(a).destinationCode()){var d=this.legStates[a];
d.destination="";d.destinationCode="";this.setLegWidgetValues(a,d)}this.searchForm.addClass("active").attr("aria-hidden","false");b.element.is(".Flights-Search-StyleJamFlightSearchForm")&&(a=g.stylejam.flights.search.StyleJamFlightSearchForm,g.dom.swapClasses(this.searchForm,a.searchFormHidden,a.searchFormVisible))},initState:function(){for(var a=0;a<(this.backFromRP?this.defaultLegState.length:this.maxLegs);a++)this.triggerChangeOrigin(void 0,void 0,a),this.triggerChangeDestination(void 0,void 0,
a),this.triggerChangeDepartDate(void 0,a),this.triggerChangeDepartTime(void 0,a),this.triggerChangeNearbyOrigin(void 0,a),this.triggerChangeNearbyDestination(void 0,a)},onChangeOrigin:function(a){var b=this._legAccessor(a.legIndex);b.origin(a.originLocation);b.originCode(a.originCode);0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&b.originCode(a.originLocation);a=this.legStates[a.legIndex];a.origin=b.origin();a.originCode=b.originCode()},triggerChangeOrigin:function(a,d,e){var c=h.extend({},
b.eventDataTemplate),f=this._legAccessor(e);c.originLocation=p(a,function(){return f.origin()});c.originCode=p(d,function(){return f.originCode()});c.legIndex=e;c.refreshNearby=!(""===a&&""===d);b.disableDestinationFocusAfterAjax&&(c.disableDestinationFocusAfterAjax=!0);g.events.publish(b.events.multiOrigin,c);0===e&&g.events.publish(b.events.rtowOrigin,c);a&&(b.vsLog("location/origin"),b.gaLog("select-origin"))},onChangeDestination:function(a){var b=this._legAccessor(a.legIndex);b.destination(a.destinationLocation);
b.destinationCode(a.destinationCode);0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&b.destinationCode(a.destinationLocation);a=this.legStates[a.legIndex];a.destination=b.destination();a.destinationCode=b.destinationCode()},triggerChangeDestination:function(a,d,e){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(e);c.destinationLocation=p(a,function(){return f.destination()});c.destinationCode=p(d,function(){return f.destinationCode()});c.legIndex=e;c.refreshNearby=
!(""===a&&""===d);g.events.publish(b.events.multiDestination,c);0===e&&g.events.publish(b.events.rtowDestination,c);a&&(b.vsLog("location/destination"),b.gaLog("select-destination"))},onChangeDepartDate:function(a){var b=this._legAccessor(a.legIndex);b.departDate(a.departDate);this.legStates[a.legIndex].depart_date=b.departDate()},triggerChangeDepartDate:function(a,d){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.departDate=p(a,function(){return f.departDate()});c.legIndex=d;g.events.publish(b.events.multiDepartDate,
c)},onChangeDepartTime:function(a){var b=this._legAccessor(a.legIndex);b.departTime(a.departTime);this.legStates[a.legIndex].depart_time=b.departTime()},triggerChangeDepartTime:function(a,d){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.departTime=p(a,function(){return f.departTime()});c.legIndex=d;g.events.publish(b.events.multiDepartTime,c)},onChangeLegCabinType:function(a){var b=this._legAccessor(a.legIndex);b.cabinType(a.cabinType);this.legStates[a.legIndex].cabin_type=b.cabinType()},
triggerChangeLegCabinType:function(a,d){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.cabinType=p(a,function(){return f.cabinType()});c.legIndex=d;g.events.publish(b.events.multiLegCabinType,c)},onChangeNearbyOrigin:function(a){var b=this._legAccessor(a.legIndex);b.nearbyOrigin(a.includeNearbyOrigin);this.legStates[a.legIndex].nearby_origin=b.nearbyOrigin()},triggerChangeNearbyOrigin:function(a,d,e){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.includeNearbyOrigin=
p(a,function(){return f.nearbyOrigin()});c.legIndex=d;g.events.publish(b.events.multiNearbyOrigin,c);e&&b.getChildElement("origin"+d).getWidget().setIsNearbyChecked(c.includeNearbyOrigin)},onChangeNearbyDestination:function(a){var b=this._legAccessor(a.legIndex);b.nearbyDestination(a.includeNearbyDestination);this.legStates[a.legIndex].nearby_destination=b.nearbyDestination()},triggerChangeNearbyDestination:function(a,d,e){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.includeNearbyDestination=
p(a,function(){return f.nearbyDestination()});c.legIndex=d;g.events.publish(b.events.multiNearbyDestination,c);e&&b.getChildElement("destination"+d).getWidget().setIsNearbyChecked(c.includeNearbyDestination)},onRemoveLeg:function(a){this.removeLeg(a.legIndex);b.recalculateDialogDimensions()},triggerRemoveLeg:function(a){if(!0===b.options.autoRTFromMC&&1===this.legsShown()-1)b.triggerChangeDisplayCat("roundtrip");else{var c=h.extend({},b.eventDataTemplate);c.legIndex=a;g.events.publish(b.events.multiRemoveLeg,
c)}},legsShown:function(){return h(".multiCityLeg:not(.hiddenLeg)",b.element).length},onAddLeg:function(a){this.addLeg();b.recalculateDialogDimensions()},triggerAddLeg:function(){var a=h.extend({},b.eventDataTemplate);g.events.publish(b.events.multiAddLeg,a)}}}},adjustFormClass:function(){this.controllers.multi.searchForm&&(0===h(".multiCityLeg.hiddenLeg",this.element).length===!0?this.controllers.multi.searchForm.addClass("fullyExpand"):this.controllers.multi.searchForm.removeClass("fullyExpand"))},
totalAdultCount:function(){return this.state.adults+this.state.seniors},atMinTotalTravelers:function(){return 0>=this.state.travelers}})})(window.R9,window.jQuery,window.moment);(function(e,g){function p(a){return a?q.exec(a)||a&&(-1!==a.indexOf("cy")||-1!==a.indexOf("cg"))?a:a.split("/")[0]:""}function r(a,b){return null===a||"undefined"===typeof a?"function"===typeof b?b():b:a}var q=/[0-9]+[fr]{1,2}/;e.createComponentClass("flights.search.FlightInlineSearchForm","base.search.SearchForm",{vertical:"flights",formQuestion:"flights.rp.searchform",loggingPrefix:"Search-Form",originField:null,nearbyOrigin:null,isNearbySmartyOrigin:null,isNearbySmartyDestination:null,destinationField:null,
destination_code:null,nearbyDestination:null,daterangePicker:null,datePicker:null,flexDatePicker:null,flexDepartDate:null,displayView:null,flexDepart:null,flexReturn:null,flexWeekend:null,flexWeekendDepart:null,flexWeekendReturn:null,flexMonthLengthOfStay:null,flexDaterangePicker:null,startingForm:null,displayCountsLabel:null,isRegionSearchSupported:!1,preserveFilters:!1,multiCityDialog:null,previousSearchType:"",previousOrigin:null,previousOriginCode:null,previousDestination:null,previousDestinationCode:null,
cleanDateModal:null,options:{advancedFlexDatePickerEnabled:!1,autoSubmit:!1,backToFDMultiCity:!0,debugForm:!1,display:"roundtrip",displayOverlay:!0,displayViewFormFocus:!1,errMsg:{},flexDateDisplay:{},flex_category:"",forceEditMode:!1,msg:{},loadCmp2InEditModeOnly:!1,phoenixRising:!1,multiCityDisplayDates:null,multiCityDisplayLocations:null,nearbyDestination:!1,nearbyOrigin:!1,isNearbyInSmarty:!1,nearbySmartyTemplateSuffix:"",pinnable:!1,preserveFiltersOnSearchChange:!1,shortDateFormat:"MMM d",singleDateField:!1,
submitOnSearchTypeChange:!1,travelersQuestion:"flights.rp.search.travelers",useCmp2Submit:!1,useLegacyDatePicker:!0,revertOnClickOut:!1,flexForAllSearch:!1,departDateFlexOnLoad:!1,returnDateFlexOnLoad:!1,pinnableImmediateSubmit:!1,regionDisplayAirportPicker:!1,showFlexDatesEnabled:!1,hasEditIcon:!0,airportMultiSelect:!1,showBaggageDropdown:!1,originAirportMultiSelections:[],destinationAirportMultiSelections:[],allAirportsLocalizedText:null,cleanCalendarEnabled:!1},state:{travelers:0,cabin:"e"},init:function(){this.base();
this.searchForm=this.getChildElement("searchform");this.displayView=this.getChildElement("display");this.bindOriginDestination();this.options.cleanCalendarEnabled?this.bindCleanDatePicker():this.bindDaterangePickers(this.options.flex_category,this.options.display);e.config.getBoolean("ui.horizon.flight.inline.form.fire.Origin.Destination.Change.at.init",!1)&&(this.publishChangeOrigin(),this.publishChangeDestination());this.displayCountsLabel=this.element.find("label.counts");this.isRegionSearchSupported=
-1<e.config.getString("ui.flights.smarty.regionEnabled","32,51,58,72,77").split(",").indexOf(""+this.options.flareSmartyType);this.options.pinnable&&(this.edit=this.getChildElement("edit"))},inlineComponentsReady:function(){this.base();this.options.pinnable&&this.bindDelayedDropdowns();this.options.phoenixRising||(this.startingForm=this.serialize());e.config.getBoolean("ui.horizon.flight.inline.form.fire.Origin.Destination.Change.at.init",!1)||(this.publishChangeOrigin(),this.publishChangeDestination())},
renewAdvancedDatePicker:function(a){this.options.advancedFlexDatePickerEnabled&&this.getDatePicker()&&(1===Object.keys(a).length&&g.extend(a,{depart_date_flex:this.options.depart_date_flex,return_date_flex:this.options.return_date_flex}),"openflex"===a.flex_category&&this.options.openflex_length_of_stay&&!a.openflex_length_of_stay&&(a.openflex_length_of_stay=this.options.openflex_length_of_stay),this.silenceDatePickerChange=!0,this.getDatePicker().loadFlexData(a),this.silenceDatePickerChange=!1)},
onVisible:function(a){var b=e.question.ask("SearchPage.view");"function"===typeof a&&(null===b||"RP"===b?a.call(this):this.subscribe("resultspage.routed",a.bind(this)))},addEventHandlers:function(){var a=this;this.base();this.subscribe(["searchform.submit","multilocale.search.submit"],function(b){var c="FD"===b.pageType;b=g.extend(!0,{},b,{pageType:a.getPageType()});if("anywhere"===b.flex_category)window.location=b.url;else if(a.previousSearchType="",a.options.revertOnClickOut&&"flights"===b.tab&&
b.id!==a.id()&&(a.startingForm=b),a.loadFormView(b),a.options.airportMultiSelect&&c&&a.resetAirportMultiSelect(b),a.updateDisplayView(b),a.options.displayOverlay&&a.setView("Display"),a.options.pinnable)a.onPinnableClickOut()});this.subscribe("flights.inline.search.form.display.change",function(b){a.switchFormView(b.value);a.options.autoSubmit&&"multicity"!==b.value&&a.options.submitOnSearchTypeSwitch&&!a.validate()&&a.autoSubmit()});this.subscribe("flights.search.cabinType.change",{namespace:this.id()},
function(b){a.state.cabin=b.value});this.options.forceEditOpen&&this.setEditMode(!0);this.options.displayOverlay?(e.events.subscribe("flight.inline.search.form.show",function(b){a.setView("Form");b.focus&&a.originField.inputEl.focus()}),this.getChildElement("change").keypress(function(b){b.keyCode===e.globals.keyCodes.RETURN&&(a.setView("Form"),a.options.displayViewFormFocus&&a.focusFormAfterDisplayView(a.getChildElement("displayOrigin")))}),this.getChildElement("display").on("mousedown",function(b){0===
g(b.target).closest("#"+a.id()+" label.counts a.showAll").length&&(a.element.hasClass("MultiCity")?a.options.backToFDMultiCity||(a.switchFormView("multicity"),e.events.publish("flights.inline.search.form.display.set","multicity")):(a.setView("Form"),a.options.displayViewFormFocus&&a.focusFormAfterDisplayView(b.target),e.Analytics.api.trackEvent({category:a.loggingPrefix,action:"change-search"})))})):this.subscribe("flight.inline.search.form.show",function(b){a.options.singleDateField?a.dateRangeInput.focus():
this.getDatePicker().focus("depart")});this.bindTravelers();this.getChildElement("toggleFlex").click(function(b){a.element.toggleClass("FlexDate");var c=a.element.hasClass("FlexDate");a.flexDepart&&a.flexReturn&&(a.flexDepart.element.attr("aria-expanded",c),a.flexReturn.element.attr("aria-expanded",c&&"oneway"!==a.options.display),c&&a.flexDepart.element.focus());g(b.currentTarget).attr("aria-pressed",c);a.options.flex_category=c?"plusminusthree":"exact";e.Analytics.api.trackEvent({category:a.loggingPrefix,
action:"advanced-options",label:c?"show":"hide"})});this.bindLogging();this.answer("flights.rp.searchform.display",function(){return a.options.display});this.answer("flights.rp.searchform.topOffset",function(){return a.element.offset().top+a.element.outerHeight()});this.answer(this.formQuestion+".buildSearchURL",function(b){return a.buildSearchURL(b||a.serialize())});this.subscribe("resultspage.streaming.start",function(b){!a.isDisplayViewUpdated&&a.options.displayOverlay&&a.updateDisplayView(b);
a.displayCountsLabel.addClass("hidden")});this.subscribe("resultspage.streaming.done",function(){a.displayCountsLabel.removeClass("hidden")});this.getChildElement("change").click(function(){a.element.hasClass("MultiCity")&&a.handleMultiCityForm()});this.subscribe("flights.search.swapLocations",this.onOriginDepartureSwitch.bind(this));this.subscribe("flights.search.enableNearbyAirports",function(b){var c=!1;b&&a.options.isNearbyInSmarty?(a.isNearbySmartyOrigin||(a.originField.getSmarty().setIsNearbyChecked(!0),
a.onSmartyNearbyOrigin({enabled:!0}),c=!0),a.isNearbySmartyDestination||(a.destinationField.getSmarty().setIsNearbyChecked(!0),a.onSmartyNearbyDestination({enabled:!0}),c=!0)):!b||a.nearbyOrigin.is(":checked")&&a.nearbyDestination.is(":checked")||(a.startingForm=a.serialize(),c=!0,a.nearbyOrigin.prop("checked",!0),a.nearbyDestination.prop("checked",!0));c&&(a.isSubmitted=!1,a.onSubmit())});this.answer("flights.search.nearbyAirportsEnabled",function(){return a.nearbyDestination.is(":checked")&&a.nearbyOrigin.is(":checked")});
this.options.pinnable&&(this.onVisible(function(){g(document).off("click.pinnableBind").on("click.pinnableBind",function(b){b=g(b.target);if(1===b.closest("#"+a.id()).length)a.onPinnableClick(b);else 0===b.closest(".R9-Overlay, .r9-smarty, .js-overlay").length&&(a.pinnableCloseTimer=setTimeout(a.onPinnableClickOut.bind(a),100))});this.registerEvent("scroll",g(window),a.onPinnableScroll.bind(a));a.subscribe(["DateInput.startDate.onFocus","DateInput.endDate.onFocus"],a.onPinnableClick.bind(a))}),this.subscribe("pinnableBar.pinnedChange",
function(b){a.pinned=b}),this.subscribe(["InputModal.closed","DatePicker.dismiss","Select.closed","DropdownDialog.close"],function(){setTimeout(function(){clearTimeout(a.pinnableCloseTimer)},10)}),this.getChildElement("close",this.onPinnableClose.bind(this)),this.submitButton.click(this.onPinnableSubmitClick.bind(this)),this.searchForm.click(this.onSearchFormClick.bind(this)));if(this.options.phoenixRising){var b=g.Deferred(),c=2,d=function(){0===--c&&b.resolve()};this.subscribe("flights.search.cabinType.init."+
this.id(),d);this.subscribe("flights.search.travelers.init."+this.id(),d);b.promise().then(function(){var b=a.getChildElement("cabinType").getWidget();b&&(a.state.cabin=b.getValue());a.startingForm=a.serialize()})}var f=this.getChildElement("progress-bar");this.subscribe("flights.search.inlineSearchForm.toggleProgressBar",function(a){f.toggleClass("hidden",!a)});this.answer(this.formQuestion,function(){return a.serialize()});e.events.ready("flights.searchForm.questionAnswers");this.bindSearchPendingState();
this.bindFormChangedState();this.options.showBaggageDropdown&&this.subscribe("flights.search.baggageCounts.changed",this.updateBaggageCounts.bind(this));this.options.useCmp2Submit&&(this.subscribe("cmp2.rendering.finished",function(b){a.element.toggleClass("cmp2-ready",!!(b&&b.items&&b.items.length))}),this.subscribe("cmp2.hidden",{visible:!1},function(){a.element.removeClass("cmp2-ready")}));this.answer([this.formQuestion,this.id()].join("_"),function(){return a.serialize()});this.options.airportMultiSelect&&
this.subscribe("flights.airportpicker.submit",function(b){a.originField.addAirportMultiSelections(b)})},minimized:!1,editMode:!1,submitMode:!1,hovered:!1,pinned:!1,searchPending:!1,onPinnableSubmitClick:function(a){if(this.options.forceEditMode)return!1;if(!this.options.pinnableImmediateSubmit&&!this.editMode)return this.setEditMode(!0),this.setMinimized(!1),!!this.options.useStyleJamInlineSearchButton},onPinnableScroll:function(){if(this.options.forceEditMode)return!1;this.pinned&&!this.hovered&&
(this.setMinimized(!0),this.editMode&&this.setEditMode(!1))},onPinnableClose:function(){if(this.options.forceEditMode)return!1;this.setEditMode(!1)},onPinnableClick:function(a){if(this.options.forceEditMode)return!1;g(a).hasClass("js-multicity-submit")||this.editMode||this.options.pinnableImmediateSubmit&&a&&this.submitButton.is(a)||(this.setMinimized(!1),this.setEditMode(!0))},onSearchFormClick:function(){},onPinnableClickOut:function(){if(this.options.forceEditMode)return!1;this.minimized||this.setMinimized(!0);
this.editMode&&this.setEditMode(!1)},updateBaggageCounts:function(a){this.searchFormFilterState||(this.searchFormFilterState={});this.searchFormFilterState[a.type]=""+a.value},setMinimized:function(a){a?(this.minimized=!0,this.element.addClass("minimized")):(this.minimized=!1,this.element.removeClass("minimized"))},setEditMode:function(a){if(a){var b=this;setTimeout(function(){b.editMode=!0},300);this.element.addClass("edit-mode");this.options.hasEditIcon&&this.submitButton.attr("aria-label",this.options.msg.accessibilityEditSearch)}else this.editMode=
!1,this.element.removeClass("edit-mode"),this.options.hasEditIcon&&this.submitButton.attr("aria-label",this.options.msg.accessibilitySubmitSearch),this.options.revertOnClickOut&&null!==this.startingForm&&!this.checkFormChanges()&&this.loadFormView(this.startingForm),this.options.autoSubmit&&(this.originField.val()||null==this.previousOrigin||(this.originField.val(this.previousOrigin),this.originField.code(this.previousOriginCode),this.previousOriginCode=this.previousOrigin=null),this.destinationField.val()||
null==this.previousDestination||(this.destinationField.val(this.previousDestination),this.destinationField.code(this.previousDestinationCode),this.previousDestinationCode=this.previousDestination=null));setTimeout(function(){e.Analytics.api.trackEvent({category:this.loggingPrefix,action:"edit-mode",label:a?"on":"off"})}.bind(this),100)},setEditIcon:function(a){if(this.options.hasEditIcon)if(a){var b=this;setTimeout(function(){b.editMode=!0},300);this.element.addClass("edit-mode");this.submitButton.attr("aria-label",
this.options.msg.accessibilityEditSearch)}else this.editMode=!1,this.element.removeClass("edit-mode"),this.submitButton.attr("aria-label",this.options.msg.accessibilitySubmitSearch)},onSubmit:function(a){var b=this.validate();if(b)this.showError(b);else if("multicity"===this.options.display&&this.minimized&&!this.editMode)a.preventDefault(),this.onPinnableClick();else{if(!this.startingForm||this.checkFormChanges()){this.startingForm=b=this.serialize();if(this.options.regionSearchEnabled&&(b.freeRegionId||
b.countrySearch)){window.location.href="/"+this._generate(b);return}this.searchPending=!0;this.options.flexForAllSearch&&(e.events.publish("filter.reset",{name:"flexdepart"}),e.events.publish("filter.reset",{name:"flexreturn"}));this.base(a)&&(this.updateDisplayView(b),this.setView("Display"));e.Analytics.api.trackEvent({category:this.loggingPrefix,action:"search",label:"origin:%s;dest:%s;depart:%s;return:%s;travelers:%s;triptype:%s;cabin:%s;departflex:%s;returnflex:%s".format(p(b.origin),p(b.destination),
b.depart_date_canon,b.return_date_canon,b.travelers,this.options.display,b.cabin,b.depart_date_flex,b.return_date_flex)});this.options.autoSubmit&&(this.isSubmitted=!1)}else e.events.publish("resultsHeader.changed",{tab:"flights"}),this.base(a)&&(this.updateDisplayView(),this.setView("Display"));if(this.options.pinnable)this.onPinnableClickOut(!0);this.setFormChangedState(!1);this.options.airportMultiSelect&&(a=this.originField.getAirportMultiSelections().length,b=this.destinationField.getAirportMultiSelections().length,
(a||b)&&e.Analytics.api.trackEvent({category:"airportMultiSelect",action:"submit",label:a,value:b}))}},serialize:function(){var a=this.base();a.provider="";var b=e.question.ask("flights.rp.search.travelers"),c={},d="oneway"===this.options.display;c.isMulticity="multicity"===this.options.display;c.oneway=d;c.flex_category=this.options.flex_category;var f,h;if(this.options.advancedFlexDatePickerEnabled&&this.getDatePicker()&&this.getDatePicker().getFlexCategory()){c.flex_category=this.getDatePicker().getFlexCategory();
this.options.flex_category=c.flex_category;f=moment(this.startDate());h=moment(this.endDate());var k=this.getDatePicker().getFlexDatesData();switch(c.flex_category){case "exact-graph":case "exact":case "plusminusthree":f.isValid()&&(k.depart_date=f.format(e.globals.apiDateFormat),k.depart_date_canon=f.format("YYYY-MM-DD"));!d&&h.isValid()&&(k.return_date=h.format(e.globals.apiDateFormat),k.return_date_canon=h.format("YYYY-MM-DD"));break;case "weekend":f.isValid()&&(moment(f).startOf("month").isSameOrBefore(moment())?
k.weekend_depart_date="WEEKEND":k.weekend_depart_date=f.format("YYYY-MM-DD"));break;case "openflex":f.isValid()&&(k.openflex_depart_date=f.format("YYYY-MM-DD"))}g.extend(c,k)}else"exact"===this.options.flex_category||"plusminusthree"===this.options.flex_category?(this.options.useLegacyDatePicker?(f=moment(this.daterangePicker.getStartDate()),h=moment(this.daterangePicker.getEndDate())):(f=moment(this.departDate.getDate()),h=moment(this.returnDate.getDate())),f.isValid()&&(c.depart_date=f.format(e.globals.apiDateFormat),
c.depart_date_canon=f.format("YYYY-MM-DD")),!d&&h.isValid()&&(c.return_date=h.format(e.globals.apiDateFormat),c.return_date_canon=h.format("YYYY-MM-DD")),"plusminusthree"===this.options.flex_category&&(this.flexDepart&&(c.depart_date_flex=this.flexDepart.getValue()),!d&&this.flexReturn&&(c.return_date_flex=this.flexReturn.getValue()))):"weekend"===this.options.flex_category?(c.weekend_depart_date=this.flexWeekend.getValue(),c.weekend_depart=this.flexWeekendDepart.getValue(),c.weekend_return=this.flexWeekendReturn.getValue()):
"openflex"===this.options.flex_category&&(f=this.options.useLegacyDatePicker?moment(this.flexDaterangePicker.getStartDate()):moment(this.flexDepartDate.getDate()),c.openflex_depart_date=f.format("YYYY-MM-DD"),c.openflex_length_of_stay=this.flexMonthLengthOfStay.val());c.oneway=d;c.isMulticity||(c.legCount=c.oneway?1:2);c.origin=c.origincode=this.originField.code();c.origin_location=this.originField.val();c.originMultiAirports=this.originField.getAirportMultiSelections();!c.origin&&this.isMultipleAirport(c.origin_location)&&
(c.origin=c.origin_location);!c.origin&&c.origin_location.match(/^[A-z]{3}$/)&&(c.origin=c.origin_location);c.destination=c.destinationcode=this.destinationField.code();c.destination_location=this.destinationField.val();c.destination_code=this.destination_code;c.destinationMultiAirports=this.destinationField.getAirportMultiSelections();!c.destination&&this.isMultipleAirport(c.destination_location)&&(c.destination=c.destination_location);!c.destination&&c.destination_location.match(/^[A-z]{3}$/)&&
(c.destination=c.destination_location);c.nearby_origin=this.options.isNearbyInSmarty?!!this.isNearbySmartyOrigin:this.nearbyOrigin.is(":checked");c.nearby_destination=this.options.isNearbyInSmarty?!!this.isNearbySmartyDestination:this.nearbyDestination.is(":checked");null!==q.exec(c.destination)?c.freeRegionId=parseInt(c.destination.replace(/[A-z]+/,"")):c.countrySearch=this.isCountryOrCountryGroup(c.destination);g.extend(c,a,{cabin:this.state.cabin,preserveFilters:this.preserveFilters},b);return c},
getStorageExceptions:function(){return this.preserveFilters?["preserveFilters"]:[]},getSearchFormFilterState:function(){var a=this.base();this.options.showBaggageDropdown&&"multicity"===this.options.display&&["cfc","bfc"].forEach(function(b){delete a[b]});return a},switchFormView:function(a){this.previousSearchType=this.options.display;this.options.display=a;this.getDatePicker()&&this.getDatePicker().setDateMode("oneway"===a?"single":"range");if("multicity"===a)this.handleMultiCityForm();else{a=this.serialize();
var b;if("multicity"===this.previousSearchType&&(b=e.question.ask("flights.rp.searchform.multicity"),!0===this.options.adjustRTCabinType)){var c=e.question.ask("flights.searchform.multicity.first.leg.cabin");c&&(a.cabin=c)}this.loadFormView(a,b)}this.loadCompareToItems()},isMultipleAirport:function(a){if("undefined"!==typeof a&&-1!=a.indexOf(",")){a=a.split(",");var b=!0;g.each(a,function(a,d){3!==g.trim(d).length&&(b=!1)});return b}return!1},focusFormAfterDisplayView:function(a){if(a){a=g(a);var b=
this,c;if(a.is(this.getChildElement("displayOrigin")))c=function(){b.originField.inputEl&&b.originField.inputEl.trigger&&b.originField.inputEl.focus().trigger("mousedown")};else if(a.is(this.getChildElement("displayDestination")))c=function(){b.destinationField.inputEl&&b.destinationField.inputEl.trigger&&b.destinationField.inputEl.focus().trigger("mousedown")};else if(a.is(this.getChildElement("displayDepart"))||a.is(this.getChildElement("displayDepartDay")))c=function(){b.daterangePicker&&b.daterangePicker.startDisplay&&
b.daterangePicker.startDisplay.trigger&&b.daterangePicker.startDisplay.trigger("mousedown")};else if(a.is(this.getChildElement("displayReturn"))||a.is(this.getChildElement("displayReturnDay")))c=function(){b.daterangePicker&&b.daterangePicker.endDisplay&&b.daterangePicker.endDisplay.trigger&&b.daterangePicker.endDisplay.trigger("mousedown")};else if(a.is(this.getChildElement("displayCabin").parent().children())||a.is(this.getChildElement("displayTravelers"))||a.is(this.getChildElement("displayTravelerLabel"))||
a.is(this.getChildElement("baggageCount"))||a.is(this.getChildElement("baggageCountLabel")))c=function(){e.events.publish("flights.inline.travelers.open")};c&&(this.focusSearchFormTID&&clearTimeout(this.focusSearchFormTID),this.focusSearchFormTID=setTimeout(c,200))}},setView:function(a){this.options.displayOverlay&&("Display"===a?(this.element.removeClass("FormView"),this.disableSearchButton()):"Form"===a?(this.element.addClass("FormView"),this.enableSearchButton()):this.element.removeClass("FormView"),
this.options.displayOverlay&&(this.getChildElement("searchform").attr("aria-hidden","Form"!==a),this.getChildElement("display").attr("aria-hidden","Display"!==a),this.getChildElement("change").attr("aria-pressed","Display"!==a)),e.Analytics.api.trackEvent("%s/searchform/view/%s".format(this.options.loggingPrefix,a)))},updateDisplayView:function(a){if(this.options.displayOverlay){this.isDisplayViewUpdated=!0;a||(a=this.serialize());a.roundtrip?this.options.display="roundtrip":a.oneway?this.options.display=
"oneway":a.isMulticity&&(this.options.display="multicity");a.isMulticity||this.updateRoundTripOneWayDisplay(a);if(a.openflex_length_of_stay){var b=a.openflex_length_of_stay.split("-"),b=parseInt(b[b.length-1]);this.getChildElement("displayFlexLengthOfStayLabel").html(e.Common.Utils.String.formatChoice(this.options.msg.openflexNightsLabelChoice,b))}this.getChildElement("displayCabin").html(a.cabinDisplayType);this.getChildElement("displayTravelers").html(a.travelers);this.getChildElement("displayTravelerLabel").html(e.Common.Utils.String.formatChoice(this.options.msg.displayTravelersLabel,
a.travelers,a.travelers));this.getChildElement("baggageCount").html(a.baggageCount);this.getChildElement("baggageCountLabel").html(e.Common.Utils.String.formatChoice(this.options.msg.baggageCountLabel,a.baggageCount,a.baggageCount))}else this.enableSearchButton();this.options.backToFDMultiCity||this.updateMultiCityDisplay(a||this.serialize())},getMultiCityLocationData:function(a){var b=[];if(!a||!a.nrLegs||1>a.nrLegs){if(this.options.multiCityDisplayDates&&this.options.multiCityDisplayLocations)for(var c=
0;c<this.options.multiCityDisplayLocations.length;c++)this.options.multiCityDisplayLocations[c]&&(b.push({loc:this.options.multiCityDisplayLocations[c].first,date:this.options.multiCityDisplayDates[c]}),this.options.multiCityDisplayLocations[c].second&&b.push({loc:this.options.multiCityDisplayLocations[c].second,date:null}))}else for(c=0;c<a.nrLegs;c++)b.push({loc:a["origin"+c],date:moment(a["depart_date_canon"+c]).format(this.options.shortDateFormat)}),a["destination"+c]===a["origin"+(c+1)]&&c!==
a.nrLegs-1||b.push({loc:a["destination"+c],date:null});return b},putMultiCityLocations:function(a,b){for(var c=this.element.find(".multiCityLegTemplate"),d=0;d<a.length;d++){var f=c.clone().removeClass("multiCityLegTemplate");f.find(".airport").html(a[d].loc);var e=a[d].date?a[d].date:"\x26nbsp;";f.find(".date").html(e);b.append(f.children());f.removeClass("hidden")}},updateRoundTripOneWayDisplay:function(a){var b=this.getLocationDisplay(a.origin,a.origin_location),c=this.getLocationDisplay(a.destination,
a.destination_location);this.getChildElement("displayOrigin").html(b);this.getChildElement("displayDestination").html(c);var b=moment(a.depart_date_canon),c=moment(a.return_date_canon),d=moment(a.openflex_depart_date);this.getChildElement("displayFlexMonth").html(d.format(this.options.shortDateFormat)+" \x26ndash; "+d.add(1,"months").subtract(1,"day").format(this.options.shortDateFormat));c&&this.getChildElement("displayReturn").html(c.format(this.options.shortDateFormat));this.options.dayOfWeekEnabled&&
(this.getChildElement("displayDepartDay").html(moment(a.depart_date_canon).format("dddd")),a.return_date_canon&&this.getChildElement("displayReturnDay").html(moment(a.return_date_canon).format("dddd")));a.hasOwnProperty("depart_date_flex")&&this.flexDepart&&this.getChildElement("displayFlexDepart").html(this.options.flexDateDisplay[this.flexDepart.getValue()]);a.hasOwnProperty("return_date_flex")&&this.flexReturn&&this.getChildElement("displayFlexReturn").html(this.options.flexDateDisplay[this.flexReturn.getValue()]);
a.hasOwnProperty("weekend_depart_date")&&(this.getChildElement("displayFlexWeekend").html(this.flexWeekend.getText()),this.getChildElement("displayFlexWeekendDates").html("%s \x26ndash; %s".format(this.flexWeekendDepart.getText(),this.flexWeekendReturn.getText())));a.hasOwnProperty("openflex_length_of_stay")?this.getChildElement("displayFlexLengthOfStay").html(a.openflex_length_of_stay):this.getChildElement("displayDepart").html(b.format(this.options.shortDateFormat))},getLocationDisplay:function(a,
b){a="string"===typeof a?a.split("/")[0]:"";return/(?:[0-9]+[fr]{1,2})|(?::\d+-)/.exec(a)?b:a},loadCompareToItems:function(){this.options.useCmp2Submit&&this.base()},loadFormView:function(a,b){this.element.removeClass("RoundTrip OneWay FlexDate FlexWeekend FlexMonth MultiCity");a=g.extend(!0,{},a);a.isMulticity?(this.element.addClass("MultiCity"),this.options.display="multicity"):this.options.display=a.oneway?"oneway":"roundtrip";e.events.publish("flights.inline.search.form.display.set",this.options.display);
!this.options.flex_category&&a.flex_category&&(this.options.flex_category=a.flex_category);this.originField.val(a.origin_location);this.originField.code(a.origincode);a.destination_location&&a.destination_code&&(this.destination_code=a.destination_code);this.destinationField.val(a.destination_location);this.destinationField.code(a.destinationcode);try{if(this.silenceDatePickerChange=!0,this.options.useLegacyDatePicker)this.daterangePicker.setStartDate(a.depart_date),a.oneway||this.daterangePicker.setEndDate(a.return_date),
this.daterangePicker.setSingleDateMode(a.oneway);else{this.startDate(a.depart_date_canon);var c;a.return_date_canon?c=a.return_date_canon:b&&b.depart_date1&&(c=b.depart_date1);c&&this.endDate(c);"weekend"!==a.flex_category&&"openflex"!==a.flex_category&&this.getDatePicker().setDateMode(a.oneway?"single":"range");this.options.singleDateField&&!this.cleanDateModal&&this.dateRangeInput.setDateMode(a.oneway?"single":"range")}}finally{this.silenceDatePickerChange=!1}a.namespace=this.id();e.events.publish("flights.search.travelers.set",
a);this.state.cabin=a.cabin;e.events.publish("flights.search.cabinType.set",{value:a.cabin,namespace:a.namespace});a.searchFormFilterState&&e.events.publish("searchform.loadForm.searchFormFilterState",{searchFormFilterState:a.searchFormFilterState});this.nearbyOrigin.prop("checked",a.nearby_origin);this.nearbyDestination.prop("checked",a.nearby_destination);this.options.isNearbyInSmarty&&(this.originField&&this.originField.getSmarty()&&this.originField.getSmarty().setIsNearbyChecked&&this.originField.getSmarty().setIsNearbyChecked(a.nearby_origin),
this.destinationField&&this.destinationField.getSmarty()&&this.destinationField.getSmarty().setIsNearbyChecked&&this.destinationField.getSmarty().setIsNearbyChecked(a.nearby_destination));b=g();this.options.useLegacyDatePicker?b=this.daterangePicker.endElement:this.cleanDateModal||(b=this.returnDate.element);a.isMulticity||(a.oneway?(this.element.addClass("OneWay"),b.attr("aria-expanded",!1),"plusminusthree"===a.flex_category&&this.element.addClass("FlexDate")):(b.attr("aria-expanded",!0),"plusminusthree"===
a.flex_category?this.element.addClass("RoundTrip FlexDate"):"weekend"===a.flex_category?this.element.addClass("FlexWeekend"):"openflex"===a.flex_category?this.element.addClass("FlexMonth"):this.element.addClass("RoundTrip")));this.loadFlexData(a);this.publishChangeOrigin();this.publishChangeDestination()},loadFlexData:function(a){this.options.advancedFlexDatePickerEnabled&&this.getDatePicker()?this.renewAdvancedDatePicker(a):a.isMulticity||(a.oneway?(this.setAriaValue(this.flexReturn,"expanded",!1),
"plusminusthree"===a.flex_category&&(this.bindFlexDate(!0),this.flexDepart&&(this.setAriaValue(this.flexDepart,"expanded",!0),this.flexDepart.setValue(a.depart_date_flex)))):"plusminusthree"===a.flex_category?(this.bindFlexDate(!1),this.flexDepart&&this.flexReturn&&(this.flexDepart.setValue(a.depart_date_flex),this.flexReturn.setValue(a.return_date_flex),this.setAriaValue(this.flexReturn,"expanded",!1),this.setAriaValue(this.flexDepart,"expanded",!1))):"weekend"===a.flex_category?(this.bindFlexWeekend(),
this.flexWeekend&&this.flexWeekendDepart&&this.flexWeekendReturn&&(this.flexWeekend.setValue(a.weekend_depart_date),this.flexWeekendDepart.setValue(a.weekend_depart),this.flexWeekendReturn.setValue(a.weekend_return),this.setAriaValue(this.flexWeekendDepart,"expanded",!0),this.setAriaValue(this.flexWeekendReturn,"expanded",!0))):"openflex"===a.flex_category?(this.bindFlexMonth(),this.flexMonthLengthOfStay&&this.flexMonthLengthOfStay.val(a.openflex_length_of_stay),this.options.useLegacyDatePicker?this.flexDaterangePicker.setStartDate(moment(a.openflex_depart_date).toDate()):
this.flexDepartDate.setDate(moment(a.openflex_depart_date).toDate())):this.element.addClass("RoundTrip"))},setAriaValue:function(a,b,c){a&&a.element&&a.element.length&&a.element.attr("aria-"+b,c)},handleMultiCityForm:function(){var a=this.serialize();e.events.publish("flights.search.multicity.activate");this.loadFormView(a)},getStorageProps:function(){return"multicity"===this.options.display?null:"depart_date return_date origincode destinationcode travelers cabin flex_category oneway nearby_origin nearby_destination".split(" ")},
getPageType:function(){return"RP"},bindTravelers:function(){var a=this;this.subscribe("flights.search.travelers.lapInfant",function(b){0<b.count?a.element.addClass("showWarning"):a.element.removeClass("showWarning")});this.subscribe("flights.search.travelers.change",function(){a.isEnoughInformationForCompareToRequest()&&a.loadCompareToItems();a.options.autoSubmit&&a.autoSubmit()})},autoSubmit:function(){if("multicity"!==this.options.display&&this.checkFormChanges())this.onSubmit()},bindFlexDate:function(a){var b=
this;this.flexDepart||(this.flexDepart=this.getChildElement("flexDepart").dropdown({change:function(){e.Analytics.api.trackEvent({category:b.loggingPrefix,action:"select-flexrange-depart",label:this.getValue()});b.options.autoSubmit&&b.autoSubmit()}}).getWidget());this.flexReturn||a||(this.flexReturn=this.getChildElement("flexReturn").dropdown({change:function(){e.Analytics.api.trackEvent({category:b.loggingPrefix,action:"select-flexrange-return",label:this.getValue()});b.options.autoSubmit&&b.autoSubmit()}}).getWidget())},
bindFlexWeekend:function(){this.flexWeekend||(this.flexWeekend=this.getChildElement("flexWeekend").dropdown().getWidget());this.flexWeekendDepart||(this.flexWeekendDepart=this.getChildElement("flexWeekendDepart").dropdown().getWidget());this.flexWeekendReturn||(this.flexWeekendReturn=this.getChildElement("flexWeekendReturn").dropdown().getWidget())},bindFlexMonth:function(){var a=this;this.flexMonthLengthOfStay||(this.flexMonthLengthOfStay=this.getChildElement("flexMonthLengthOfStay"));this.options.useLegacyDatePicker?
this.flexDaterangePicker||(this.flexDaterangePicker=this.bindDaterangePicker(this.getChildElement("flexDepartDate"),function(b,c){a.options.autoSubmit&&a.autoSubmit()},{singleDateMode:!0})):(this.flexDepartDate=this.getChildElement("flexDepartDate").getWidget(),this.flexDatePicker||(this.flexDatePicker=this.bindDaterangePicker(this.getChildElement("flexDatePicker"),function(b,c){a.options.autoSubmit&&a.autoSubmit()})))},bindOriginDestination:function(){var a=this;this.originField=new e.flights.search.FlightAirportField(this.getChildElement("origin"),
{airportMultiSelectEnabled:this.options.airportMultiSelect,initialAirportMultiSelections:this.options.originAirportMultiSelections,onChangeAirportMultiSelection:this.onAirportMultiSelectChange.bind(this),onDisableNearbyToggle:function(){a.isNearbySmartyOrigin=!1}});this.nearbyOrigin=this.getChildElement("nearbyOrigin");this.destinationField=new e.flights.search.FlightAirportField(this.getChildElement("destination"),{airportMultiSelectEnabled:this.options.airportMultiSelect,initialAirportMultiSelections:this.options.destinationAirportMultiSelections,
onChangeAirportMultiSelection:this.onAirportMultiSelectChange.bind(this),onDisableNearbyToggle:function(){a.isNearbySmartyDestination=!1}});this.nearbyDestination=this.getChildElement("nearbyDestination");this.nearbyOrigin.prop("checked",this.options.nearbyOrigin);this.nearbyDestination.prop("checked",this.options.nearbyDestination);this.options.isNearbyInSmarty&&(this.isNearbySmartyOrigin=this.options.nearbyOrigin,this.isNearbySmartyDestination=this.options.nearbyDestination);this.options.autoSubmit&&
(this.previousOrigin=this.originField.val(),this.previousOriginCode=this.originField.code(),this.previousDestination=this.destinationField.val(),this.previousDestinationCode=this.destinationField.code());var b=g.proxy(function(a,b,e,h){this.onChangeOrigin(a,b,e,h);this.publishChangeOrigin({location:a,code:b,codeType:e,locationDescription:h})},this);this.bindFlightSmartyFields(this.originField,!0,b,this.isNearbySmartyOrigin,this.onSmartyNearbyOrigin.bind(this));b=g.proxy(function(a,b,e,h){this.onChangeDestination(a,
b,e,h);this.publishChangeDestination({location:a,code:b,codeType:e,locationDescription:h})},this);this.bindFlightSmartyFields(this.destinationField,!1,b,this.isNearbySmartyDestination,this.onSmartyNearbyDestination.bind(this))},bindFormChangedState:function(){var a=this,b=function(){window.setTimeout(a.setFormChangedState.bind(a,!0),10)};this.subscribe("smarty.setitem.complete",{id:this.id("origin-airport")},b);this.subscribe("smarty.setitem.complete",{id:this.id("destination-airport")},b);this.subscribe("flights.search.swapLocations",
b);this.subscribe("DatePicker.update",{action:"change",group:this.id("travelDates")},b);this.subscribe("flights.search.baggageCounts.changed",{userChange:!0,namespace:this.id()},b);this.subscribe("DatePicker.update",{action:"flex",group:this.id("travelDates")},function(c){a.searchPending||b();a.element.removeClass("FlexDate FlexWeekend FlexMonth");"openflex"===c.flex?a.element.addClass("FlexMonth"):"weekend"===c.flex?a.element.addClass("FlexWeekend"):"plusminusthree"===c.flex&&c.data&&c.data.depart_date_flex&&
c.data.return_date_flex&&("exact"!==c.data.depart_date_flex||"exact"!==c.data.return_date_flex)&&a.element.addClass("FlexDate")});this.subscribe(["flights.inline.search.form.display.change","flights.search.travelers.change","flights.search.cabinType.change"],b)},bindSearchPendingState:function(){var a=this,b=function(){a.searchPending=!0};b.priority=2;this.subscribe("searchform.submit",b);this.subscribe("search.startSearch",function(){a.searchPending=!1})},onSmartyNearbyOrigin:function(a){this.isNearbySmartyOrigin=
a&&a.enabled;this.setFormChangedState(!0)},onSmartyNearbyDestination:function(a){this.isNearbySmartyDestination=a&&a.enabled;this.setFormChangedState(!0)},onChangeOrigin:function(a,b,c,d){void 0===a||""===a&&""===b?this.originField.code(""):(this.allowAirportMultiSelect(c)?this.originField.addAirportMultiSelection(b,a,d,"selection"):(this.originLocationVal(a),this.originCodeVal(b)),this.setFormChangedState(!0),this.options.autoSubmit&&(this.previousOrigin=a,this.previousOriginCode=b),this.isEnoughInformationForCompareToRequest()&&
this.loadCompareToItems(),this.options.autoSubmit&&(this.autoSubmit(),this.originField.inputEl.blur()));e.Analytics.api.trackEvent({category:this.loggingPrefix,action:"select-origin",value:p(this.originField.code())})},originLocationVal:function(){1===arguments.length&&this.originField.val()!==arguments[0]&&this.originField.val(arguments[0]);return this.originField.val()},destinationCodeVal:function(){1===arguments.length&&this.destinationField.code(arguments[0]);return this.destinationField.code()},
originCodeVal:function(){1===arguments.length&&this.originField.code(arguments[0]);return this.originField.code()},destinationLocationVal:function(){1===arguments.length&&this.destinationField.val()!==arguments[0]&&this.destinationField.val(arguments[0]);return this.destinationField.val()},publishChangeOrigin:function(a){if("multicity"!==this.options.display){a=a||{};var b=g.extend({},{id:this.id()}),c=this;b.originLocation=r(a.location,function(){return c.originLocationVal()});b.originCode=r(a.code,
function(){return c.originCodeVal()});e.events.publish("flights.inline.search.rtow.form.origin",b)}},onChangeDestination:function(a,b,c,d){void 0===a||""===a&&""===b?this.destinationField.code(""):(this.allowAirportMultiSelect(c)?this.destinationField.addAirportMultiSelection(b,a,d,"selection"):(this.destinationLocationVal(a),this.destinationCodeVal(b)),this.setFormChangedState(!0),this.options.autoSubmit&&(this.previousDestination=a,this.previousDestinationCode=b),this.isEnoughInformationForCompareToRequest()&&
this.loadCompareToItems(),this.options.autoSubmit&&(this.autoSubmit(),this.destinationField.inputEl.blur()));e.Analytics.api.trackEvent({category:this.loggingPrefix,action:"select-destination",value:p(this.destinationField.code())})},publishChangeDestination:function(a){if("multicity"!==this.options.display){a=a||{};var b=g.extend({},{id:this.id()}),c=this;b.destinationLocation=r(a.location,function(){return c.destinationLocationVal()});b.destinationCode=r(a.code,function(){return c.destinationCodeVal()});
e.events.publish("flights.inline.search.rtow.form.destination",b)}},allowAirportMultiSelect:function(a){var b=this.options.airportMultiSelect;a=a&&0===a.indexOf("ap");return b&&a},resetAirportMultiSelect:function(a){this.originField.resetAirportMultiSelect();this.destinationField.resetAirportMultiSelect();a.originMultiAirports&&a.originMultiAirports.length&&this.originField.addAirportMultiSelections(a.originMultiAirports);a.destinationMultiAirports&&a.destinationMultiAirports.length&&this.destinationField.addAirportMultiSelections(a.destinationMultiAirports)},
onAirportMultiSelectChange:function(a,b){b&&this.setFormChangedState(!0)},onOriginDepartureSwitch:function(){var a=this.destinationField.val(),b=this.destinationField.code(),c=this.originField.getSmarty(),d=this.destinationField.getSmarty();if(e.config.getBoolean("ui.horizon.flights.smarty.od.switch.validate.enabled",!0)){var f=this.destinationField.code();/^\d+[r|fr|cy]+$|^any$|^[A-Z]{2}cg$/.test(f)&&(b=a="")}var f=this.originField.val(),h=this.originField.code();if(this.options.airportMultiSelect){var g=
this.originField.getAirportMultiSelections(),m=this.destinationField.getAirportMultiSelections();this.originField.resetAirportMultiSelect();this.destinationField.resetAirportMultiSelect();g.length?this.destinationField.addAirportMultiSelections(g):(this.destinationField.val(f),this.destinationField.code(h));m.length?this.originField.addAirportMultiSelections(m):(this.originField.val(a),this.originField.code(b))}else this.originField.val(a),this.destinationField.val(f),this.originField.code(b),this.destinationField.code(h);
this.publishChangeOrigin();this.publishChangeDestination();c&&d&&c.getIsNearbyChecked()!==d.getIsNearbyChecked()&&(c.setIsNearbyChecked(!c.getIsNearbyChecked()),d.setIsNearbyChecked(!d.getIsNearbyChecked()));this.loadCompareToItems();this.options.autoSubmit&&this.autoSubmit()},onDateRangeChange:function(a,b){this.silenceDatePickerChange||(this.setFormChangedState(!0),a=a?moment(a).format("MMM Do YY"):null,b=b?moment(b).format("MMM Do YY"):null,e.Analytics.api.trackEvent({category:this.loggingPrefix,
action:"select-date",label:"depart:"+a+",return:"+b}))},bindDaterangePickers:function(a,b){var c=this;this.options.advancedFlexDatePickerEnabled||("oneway"===b?this.bindFlexDate(!0):"roundtrip"===b&&(this.bindFlexDate(!1),"weekend"===a?this.bindFlexWeekend():"openflex"===a&&this.bindFlexMonth()));this.options.useLegacyDatePicker?this.daterangePicker||(this.daterangePicker=this.bindDaterangePicker(this.getChildElement("travelDates"),function(a,b){c.options.autoSubmit&&c.autoSubmit();c.silenceDatePickerChange||
e.Analytics.api.trackEvent({category:c.loggingPrefix,action:"select-date",label:"depart:"+moment(a).format("MMM Do YY")+",return:"+moment(b).format("MMM Do YY")});c.isEnoughInformationForCompareToRequest()&&c.loadCompareToItems()})):(this.departDate=this.getChildElement("departDate").getWidget(),this.returnDate=this.getChildElement("returnDate").getWidget(),this.options.singleDateField&&(this.dateRangeInput=this.getChildElement("dateRangeInput").getWidget()),this.datePicker||(this.datePicker=this.bindDaterangePicker(this.getChildElement("datePicker"),
function(a,b,e){c.onDateRangeChange(a,b);c.options.autoSubmit&&(a&&b&&"endDate"===e||"oneway"===c.options.display&&a)&&c.autoSubmit();c.isEnoughInformationForCompareToRequest()&&c.loadCompareToItems();e=c.returnDate.getDate();"undefined"!==typeof a&&c.departDate.setDate(a);"undefined"!==typeof b?null!==b&&moment(a).isSameOrBefore(moment(b))?c.returnDate.setDate(b):c.returnDate.setDate(null):null!==e&&e.isSameOrBefore(moment(a))&&c.returnDate.setDate(null)}),this.renewAdvancedDatePicker({flex_category:this.options.flex_category,
depart_date_flex:this.options.depart_date_flex,return_date_flex:this.options.return_date_flex})))},bindCleanDatePicker:function(){var a=this;this.cleanDateModal=this.getChildElement("dateRangeInput").data("dateModal");this.cleanDateModal.setOption("change",this.onDateRangeChange.bind(this));this.cleanDateModal.setOption("onFormNavBack",function(){a.destinationField.focusInput()});this.cleanDateModal.setOption("onFormNavForward",function(){a.submitButton.focus()});this.renewAdvancedDatePicker({flex_category:this.options.flex_category})},
bindDaterangePicker:function(a,b,c){var d=this,f=function(a){var b=d.serialize();return{vertical:"flights",origin:b.origincode,destination:b.destinationcode,isOneWay:b.oneway,departDate:a?void 0:b.depart_date_canon}},h=function(a){a&&a.returnEvent&&e.dom.schedule(function(){d.submitButton&&d.submitButton.focus()})};if(this.options.useLegacyDatePicker)return c=c||{useDaysFormat:!0,minRangeDays:0,getFormData:f,change:function(){b(this.getStartDate(),this.getEndDate())}},a.daterangePicker(c).getWidget();
a=a.getWidget();c=c||{minRangeDays:0,getFormData:f,change:b,dismiss:h};g.extend(a.options,c);return a},bindFlightSmartyFields:function(a,b,c,d,f){var h=this,g=function(a){return function(b){setTimeout(function(){a.val()&&0!==a.val().length||c(b.initialVal,b.initialCode)},1)}},m=a.inputEl,l={flareSmartyType:h.options.flareSmartyType,dataSource:h.options.smartyUrl,smartyControlGroup:null,setItem:function(){return function(e,d){if(d){var f=h.options.regionDisplayAirportPicker?!1:!b&&h.isRegionSearchSupported;
setTimeout(function(){var e,g,k;if("ap"===d.type||"apnc"===d.type||"rail"===d.type)e=d.short_str||d.str,g=d.str,k=d.id;else if("isl"===d.type)e=d.str,k="";else if(f&&"reg"===d.type)e=d.short_str||d.str,k=d.rid+"r";else if(f&&"freereg"===d.type)e=d.short_str||d.str,k=d.frid+"fr";else if(f&&h.options.regionSearchEnabled&&"ctry"===d.type)e=d.short_str||d.str,k=d.cid+"cy";else if(f&&h.options.regionSearchEnabled&&"ctgroup"===d.type)e=d.short_str||d.str,k=d.cgid+"cg";else if("addr"===d.type)e=d.name,h.openAirportPicker(e,
"",l,!b,function(a){c(a.location,a.code)}),a.setValue("");else{k=e="";var l=d.id;if(h.isRegionSearchSupported)switch(d.type){case "freereg":l="F:%s".format(d.frid);break;case "reg":l="R:%s".format(d.rid);break;case "ctry":l="Y:%s".format(d.cid)}h.openAirportPicker("","",l,!b,function(a){c(a.location,a.code)})}c(e,k,d.type,g)},1)}}}(m),clearItem:function(){return function(){setTimeout(function(){c(void 0,"")},1)}}(m),messages:h.options.msg,useNearby:h.options.isNearbyInSmarty,showBackgroundAutocomplete:e.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",
!1),allAirportsLocalizedText:this.options.allAirportsLocalizedText},n=a.inputEl.data("inputModal");n&&(l.appendTo=n.getSmartyWrapper(),l.fixedDropdown=!0);h.options.backIfEmpty&&(l.afterDone=g(m));if(32===this.options.flareSmartyType||51===this.options.flareSmartyType||58===this.options.flareSmartyType)l.dropdownClass="smartbox smartbox-air smartbox-v2 smartbox-air-regions";e.config.getBoolean("ui.smarty.greyIcons",!1)&&(l.dropdownClass="smartbox smartbox-air smartbox-v2 smartbox-air-regions "+e.config.getString("ui.smarty.iconClasses",
"greyIcons"));h.options.isNearbyInSmarty&&(f&&(l.nearbyCallback=f),l.nearbyChecked=d);this.options.nearbySmartyTemplateSuffix&&(l.templatePresentationSuffix=this.options.nearbySmartyTemplateSuffix);h.options.smartyUIUpdateEnabled&&(l.extendRequest={f:"j"},l.dropdownClass+=" ui-update-v1",l.smartyUIUpdateEnabled=!0);m.flightSmarty(l)},bindLogging:function(){var a=this;this.originField.inputEl.change(function(){e.Analytics.api.trackEvent({category:a.loggingPrefix,action:"select-origin"})});this.nearbyOrigin.change(function(){var b=
g(this).is(":checked")?"on-"+a.originField.val():"off-"+a.originField.val();e.Analytics.api.trackEvent({category:a.loggingPrefix,action:"add-nearby",label:b})});this.destinationField.inputEl.change(function(){e.Analytics.api.trackEvent({category:a.loggingPrefix,action:"select-destination"})});this.nearbyDestination.change(function(b){b=g(this).is(":checked")?"on-"+a.destinationField.val():"off-"+a.destinationField.val();e.Analytics.api.trackEvent({category:a.loggingPrefix,action:"add-nearby",label:b})})},
checkFormChanges:function(){var a=this.serialize(),b=!1,c=this.startingForm;if(!c)return!1;(b="adults cabin child countrySearch depart_date_canon depart_date_flex destination_location flex_category freeRegionId isMulticity lapInfant nearby_destination nearby_origin oneway openflex_depart_date openflex_length_of_stay origin_location return_date_canon return_date_flex searchFormFilterState seatInfant seniors travelers weekend_depart_date weekend_depart weekend_return youth".split(" ").some(function(b){var d=
c[b];b=a[b];return d&&b&&"object"===typeof d&&"object"===typeof b?!e.Common.Utils.deepEquals(d,b):d!==b&&!(void 0===d&&null===b)&&!(null===d&&void 0===b)}))&&this.options.preserveFiltersOnSearchChange&&(this.preserveFilters=c.origin===a.origin&&c.destination===a.destination);return b},setFormChangedState:function(a){e.config.getBoolean("ui.fisf.preventSameFormChangedState",!0)&&this.startingForm&&!this.checkFormChanges()?(this.base(!1),this.options.useCmp2Submit&&this.options.loadCmp2InEditModeOnly&&
e.events.publish("cmp2.cleanUp",{id:this.id()+"-compareTo"})):this.base(a)},setStyleJamButtonActivation:function(a,b){this.base(a,b);this.element.toggleClass(this.options.formChangedClass,a)},buildSearchURL:function(a){var b={},c={originId:a.origin,destinationId:a.destination,originLocation:a.origin_location,destinationLocation:a.destination_location,includeNearbyOrigin:a.nearby_origin,includeNearbyDestination:a.nearby_destination,cabinClass:a.cabin,baggageCount:a.baggageCount,departDate:a.depart_date_canon,
returnDate:a.return_date_canon,plusMinusThreeDepart:a.depart_date_flex,plusMinusThreeReturn:a.return_date_flex,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,weekendDepartDate:a.weekend_depart_date,weekendDepart:a.weekend_depart,weekendReturn:a.weekend_return,openflexDepartDate:a.openflex_depart_date,openflexLengthOfStay:a.openflex_length_of_stay};a.students&&(c.students=a.students);c.regionSearch=this.options.regionSearchEnabled&&a.destination&&
(q.exec(a.destination)||this.isCountryOrCountryGroup(a.destination));this.searchFormFilterState=g.isEmptyObject(b)?null:b;return e.flights.search.FlightSearchFormUrls.generateRtowFlightsUrl(c,this.options.flex_category,"oneway"===this.options.display,b)},isCountryOrCountryGroup:function(a){return a&&(-1!==a.indexOf("cy")||-1!==a.indexOf("cg"))},openAirportPicker:function(a,b,c,d,f){d=this.id(d?"airportPickerDestination":"airportPickerOrigin");e.events.publish("flights.airportpicker.open",{id:d,location:a,
code:b,hint:c,callback:f})},getDateValidationMessages:function(a){var b=[],c=moment(a.depart_date,e.globals.apiDateFormat),d=moment(a.return_date,e.globals.apiDateFormat);a.depart_date||b.push(this.getErrorLine("missingLeaveDateChoice"));a.oneway||a.return_date||b.push(this.getErrorLine("missingReturnDate"));0===b.length&&0>d.diff(c,"days")&&b.push(this.getErrorLine("departDateAfterReturnDate"));return b},validate:function(){var a=this.serialize(),b=[];a.origin||b.push(this.getErrorLine("missingFromAirportChoice"));
a.destination||b.push(this.getErrorLine("missingToAirportChoice"));a.origin===a.destination&&a.origin&&a.destination&&b.push(this.getErrorLine("uniqueAirportsChoice"));e.config.getBoolean("ui.horizon.flights.rpsearchform.validateDates",!0)&&"exact"===a.flex_category&&(b=b.concat(this.getDateValidationMessages(a)));"openflex"===this.options.flex_category&&(a.openflex_length_of_stay||b.push(this.getErrorLine("missingFlexLengthOfStay")));0<a.lapInfant||0<a.seatInfant||0<a.child||0<a.youth?0===a.adults&&
0===a.seniors&&b.push(this.getErrorLine("noUnaccompaniedMinors")):0===a.adults&&0===a.seniors&&(this.options.showStudents?0===a.students&&b.push(this.getErrorLine("noPassengersSelected")):b.push(this.getErrorLine("noPassengersSelected")));return b.length?"\x3cul class\x3d'errorList'\x3e%s\x3c/ul\x3e".format(b.join("")):null},getErrorLine:function(a,b){"undefined"===typeof b&&(b=0);return"\x3cli\x3e%s\x3c/li\x3e".format(e.Common.Utils.String.formatChoice(this.options.errMsg[a],b))},getCMP2AirportLocation:function(a,
b){if(a){a=a.substr(0,3);if(""===a||0===a.indexOf("C-"))a=b.replace(/ /g,""),-1!==a.indexOf("(")?(b=a.match(/\(([A-Z]{3})\)/g),null!=b&&(a=b[0])):a=a.substr(0,3);return a}return""},getCompareToFormData:function(){if(this.options.useCmp2Submit){var a=this.serialize(),b={vertical:this.vertical};a.origin=this.getCMP2AirportLocation(a.origin,a.origin_location);a.origincode=this.getCMP2AirportLocation(a.origincode,a.origin_location);a.destination=this.getCMP2AirportLocation(a.destination,a.destination_location);
a.destinationcode=this.getCMP2AirportLocation(a.destinationcode,a.destination_location);return g.extend(b,a)}},isEnoughInformationForCompareToRequest:function(){if(this.options.useCmp2Submit){if(this.options.loadCmp2InEditModeOnly&&(!this.editMode||!this.checkFormChanges())||this.options.loadCmp2WhenVisible&&!this.element.is(":visible")||-1===g.inArray(this.options.flex_category,["plusminusthree","exact"]))return!1;var a=!0;this.options.cmp2LimitDisplay&&(a="oneway"===this.options.display||"roundtrip"===
this.options.display);if(this.options.regionSearchEnabled&&a){var b=this.serialize();if(b.destination&&(q.exec(b.destination)||this.isCountryOrCountryGroup(b.destination)))return!1}return a&&!this.options.suppressCmp2s&&!this.validate()}},load:function(a){"exact"!==a.flex_category&&this.getDatePicker()&&this.options.showFlexDatesEnabled&&this.getDatePicker().publishFlexUpdate()},autofocus:function(){},bindDelayedDropdowns:function(){var a=this,b=e.config.getInt("ui.flights.search.pinned.dialogDelay",
550),c=function(){return!a.editMode};if(0!==b){!this.cleanDateModal&&this.datePicker&&(this.datePicker.setOption("delayShowDropdown",c),this.datePicker.setOption("showDropdownDelay",b));var d=this.getChildElement("travelers").data("component");d&&d.travelerSelect&&g.extend(d.travelerSelect.options,{delayShowDropdown:c,showDropdownDelay:b});var d=this.originField?this.originField.getSmarty():null,f=this.destinationField?this.destinationField.getSmarty():null;d&&(d.options.delayShowDropdown=c,d.options.showDropdownDelay=
b);f&&(f.options.delayShowDropdown=c,f.options.showDropdownDelay=b);this.options.phoenixRising&&(g.extend(this.originField.inputEl.data("inputModal").options,{delayOpenSmarty:c,openSmartyDelay:b}),g.extend(this.destinationField.inputEl.data("inputModal").options,{delayOpenSmarty:c,openSmartyDelay:b}));this.element.find(a.options.nearbyAirportsBtnSelector).each(function(){var a=g(this).getWidget();a&&a.options&&(a.options.delayShowDropdown=c,a.options.showDropdownDelay=b)})}},updateMultiCityDisplay:function(a){var b=
this.getChildElement("multiCityDates"),c=this.getChildElement("multiCityDisplay"),d=[],f=[],g=e.question.ask("flights.search.multicity.travelers"),k,m=", ";if(a.isMulticity)for(k=0;k<a.nrLegs;k++){var l=this.getLocationDisplay(a["origin"+k],a["origin_location"+k]),n=this.getLocationDisplay(a["destination"+k],a["destination_location"+k]);if(l&&0<l.indexOf(",")||n&&0<n.indexOf(","))m="; ";f.push(l+"-"+n);d.push(moment(a["depart_date_canon"+k]).format(this.options.displayDateFormat))}else f.push(this.getLocationDisplay(a.origincode)+
"-"+this.getLocationDisplay(a.destinationcode)),d.push(moment(a.depart_date_canon).format(this.options.displayDateFormat));c.html(f.join(m));b.html(d.join(", "));g&&!this.options.phoenixRising&&this.getChildElement("multiCityTravelers").html(g.displaySummary)},getDatePicker:function(){return this.cleanDateModal||this.datePicker},startDate:function(a){if(this.cleanDateModal)return this.cleanDateModal.departDate(a);if("undefined"!==typeof this.departDate){if("undefined"===typeof a)return this.departDate.getDate();
this.departDate.setDate(a)}},endDate:function(a){if(this.cleanDateModal)return this.cleanDateModal.returnDate(a);if("undefined"!==typeof this.returnDate){if("undefined"===typeof a)return this.returnDate.getDate();this.returnDate.setDate(a)}}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.layout.PinnableBar",{placeholder:null,pinnedContent:null,pinned:!1,top:null,scrollPos:0,options:{sticky:!0,slideDown:!1,defaultPlaceholderHeight:86},init:function(){this.placeholder=this.getChildElement("ph");this.pinnedContent=this.getChildElement("content")},addEventHandlers:function(){this.options.slideDown&&this.subscribe("resultspage.view.setvisible",this.setVisible.bind(this));this.subscribe("pinnedContent.setPlaceholderHeight",this.setPlaceholderHeight.bind(this));
window.addEventListener("resize",b.Common.Utils.debounce(b.Common.Utils.onAnimationFrame(this.setPlaceholderHeight.bind(this)),100))},inlineComponentsReady:function(){var a=this;this.answer("pinnedContent.height",function(){return a.options.sticky&&a.placeholder.is(":visible")?a.placeholder.outerHeight():0});this.answer("pinnedContent.placeholderHeight",function(){return a.placeholder.is(":visible")?a.placeholder.outerHeight():0});if(this.options.sticky)d(window).on("scroll",b.Common.Utils.onAnimationFrame(this.handleScroll.bind(this)));
this.placeholder.is(":visible")&&this.setPlaceholderHeight()},handleScroll:function(){this.top=this.element.offset().top;this.scrollPos=d(window).scrollTop();this.scrollPos>this.top&&!this.pinned?(this.pinned=!0,this.element.addClass("pinned"),b.events.publish("pinnableBar.pinnedChange",!0)):this.scrollPos<=this.top&&this.pinned&&(this.pinned=!1,this.element.removeClass("pinned"),b.events.publish("pinnableBar.pinnedChange",!1))},setVisible:function(a){var c=this;setTimeout(function(){b.dom.toggleOneClass(c.element,
"visible",a)},50)},setPlaceholderHeight:function(){var a=this.placeholder.height(),c=this.pinnedContent.height();a!==c&&(this.placeholder.height(c),b.events.publish("pinnableBar.placeholderHeight.updated",c))}})})(R9,jQuery);(function(e,g){g.openTooltipInstances={};var b=!1;R9.extend("Widgets",{Tooltip:function(a,d){this.element=e(a);this.element.data(this.widgetName,this);this.setOptions(d,!0)}});R9.extend("Widgets.Tooltip",{validateElement:function(a){return void 0===e(a).data(this.prototype.widgetName)},getInstance:function(a,d){return this.validateElement(a)?new R9.Widgets.Tooltip(a,d):(a=e(a).data(this.prototype.widgetName),d?a.setOptions(d):a)},removeWidget:function(a){this.validateElement(a)||this.getInstance(a).removeWidget()},
setDebug:function(a){b=a},isDebug:function(){return b}});R9.extend("Widgets.Tooltip.prototype",{element:null,widgetNamespace:"r9-tooltip",widgetBaseClass:"r9-tooltip",widgetName:"tooltip",positionTarget:"data-tooltip-position-target",isOpen:!1,options:{delay:200,fadeIn:200,fadeOut:200,edgeOffset:3,baseClass:null,content:null,positionTarget:null,position:"top",activation:"hover",showImmediately:!1,subNameSpace:"",onOpen:null,fixedPositioning:null,onClose:null,positionUpdate:!1,appendTo:"body",offsetLeft:0,
offsetAgainstEdge:!0,keepOpenOnContentHover:!1,keepOpenOnPositionTargetHover:!1,readContentOnOpen:!1,keepOpenOnRelatedTargetHover:!0,closeDelay:0,fallbackPosition:null,forceDesiredPosition:!1},_timer:null,_closeTimer:null,_originalTitle:null,_positionUpdater:null,init:function(){this._removeAllWidgetBindings();openTooltipInstances.hasOwnProperty(this.options.subNameSpace)||(openTooltipInstances[this.options.subNameSpace]=null);var a=this,d=a._getContainerElement(),c=a._getArrowElement();switch(this.options.activation){case "click":this.element.on("click."+
this.widgetName,function(c){null===openTooltipInstances[a.options.subNameSpace]&&(a.isOpen=!1);a.isOpen?a.close(c):setTimeout(a.open.bind(a,c),0)});this.options.keepOpenOnContentHover||this.bindContainerHoverEvents();this.options.showImmediately&&this.element.trigger("click."+this.widgetName);break;case "focus":this.element.on("focus."+this.widgetName,function(c){a.open(c)});this.element.on("blur."+this.widgetName,function(c){a.close(c)});this.options.showImmediately&&this.element.trigger("focus."+
this.widgetName);break;default:this.element.on("mouseenter."+this.widgetName,function(c){clearTimeout(a._closeTimer);a.open(c)}),(this.options.keepOpenOnPositionTargetHover?this._getPositionTarget():this.element).on("mouseleave."+this.widgetName,function(b){a.options.keepOpenOnRelatedTargetHover&&(e(b.relatedTarget).closest(d).length||e(b.relatedTarget).closest(c).length)||(a.options.closeDelay?a._closeTimer=setTimeout(function(){a.close(b)},a.options.closeDelay):a.close(b))}),this.options.showImmediately&&
this.element.trigger("mouseenter."+this.widgetName),this.options.keepOpenOnContentHover&&this.bindContainerHoverEvents()}return this},bindContainerHoverEvents:function(){var a=this;this._getContainerElement().on("mouseenter."+this.widgetName,function(){a.isOpen&&clearTimeout(a._closeTimer)}).on("mouseleave."+this.widgetName,function(d){a.isOpen&&!e(d.relatedTarget).closest(a._getArrowElement()).length&&(a._closeTimer=setTimeout(function(){a.close(d)},a.options.closeDelay))})},setOptions:function(a,
d){a&&(this.options=e.extend({},this.options,a));(a||d)&&this.init();return this},open:function(a){var d=this.getContent(a);if(!d||this.isOpen)return this;var c=!1;openTooltipInstances[this.options.subNameSpace]&&openTooltipInstances[this.options.subNameSpace]!==this&&(c=!0,openTooltipInstances[this.options.subNameSpace].close(a,c));var b=this._getWrapperElement(),f=this._getContainerElement(),h=this._getArrowElement();this.renderContent(d,f);this._resetElements(b,f,h);d=this._getPositionMap(b,h);
this._updateArrowElement(d,h);this._updateWrapperElement(d,b);this._updateContainerElement(d,f);if(this.options.fixedPositioning){var k=this;Object.keys(this.options.fixedPositioning).forEach(function(a){b.css(a,k.options.fixedPositioning[a])});b.css("position","fixed")}this._timer&&clearTimeout(this._timer);this._closeTimer&&clearTimeout(this._closeTimer);this.isOpen=!0;openTooltipInstances[this.options.subNameSpace]=this;if(this.options.delay){var m=this;this._timer=setTimeout(function(){m._open(b,
a,c)},this.options.delay)}else this._open(b,a,c);this._positionUpdater&&clearInterval(this._positionUpdater);e(g).on("resize",e.proxy(this._updatePosition,this));return this},renderContent:function(a,d){d.html(a)},close:function(a,d){if(!R9.Widgets.Tooltip.isDebug()){this._timer&&clearTimeout(this._timer);this._closeTimer&&clearTimeout(this._closeTimer);this._positionUpdater&&clearInterval(this._positionUpdater);e(g).off("resize",this._updatePosition);a=this._getWrapperElement();a.stop(!0,!0);this.isOpen=
!1;openTooltipInstances[this.options.subNameSpace]=null;var c=this;this.options.fadeOut&&!d?a.fadeOut(this.options.fadeOut,function(){c._close()}):(a.hide(),this._close());return this}},getContent:function(a){var d=this.element.attr("title");d&&(this._originalTitle=d,this.element.attr("title",""));return this.options.content?"function"==typeof this.options.content?this.options.content.call(this,a):this.options.content:this._originalTitle?this._originalTitle:null!=this.element.data("title")?this.element.data("title"):
this.element.text()},removeWidget:function(){this._removeAllWidgetBindings();this.element.removeData(this.widgetName);this.close();return this},_updatePosition:function(){var a=this._getWrapperElement(),d=this._getContainerElement(),c=this._getArrowElement(),b=this._getPositioning(a,c);this._updateArrowElement(b,c);"rtl"!==document.dir&&a.css({top:b.newWrapperTop+"px",left:b.newWrapperLeft+"px"});this._updateContainerElement(b,d)},_getWrapperElement:function(){var a=e("#"+this._getIdValue("-wrapper"));
a.length||(a=this._createDOMElement("-wrapper"),this.options.readContentOnOpen?a.attr("role","alert"):a.attr("role","tooltip"),e(this.options.appendTo).append(a));return a},_getContainerElement:function(){var a=e("#"+this._getIdValue("-container"));a.length||(a=this._createDOMElement("-container"),this._getWrapperElement().append(a));return a},_getArrowElement:function(){var a=e("#"+this._getIdValue("-arrow"));a.length||(a=this._createDOMElement("-arrow"),this._getWrapperElement().append(a));return a},
_createDOMElement:function(a){var d=e("\x3cdiv\x3e\x3c/div\x3e").attr("id",this._getIdValue(a));this._setStyleClasses(d,a);return d},_removeAllWidgetBindings:function(){this.element.off("click."+this.widgetName).off("focus."+this.widgetName).off("blur."+this.widgetName).off("mouseenter."+this.widgetName).off("mouseleave."+this.widgetName);return this},_getPositionTarget:function(){var a=this.options.positionTarget||this.element.attr(this.positionTarget);return a&&(a=this.options.positionTarget?e("#"+
this.options.positionTarget):e(a,this.element),0<a.length)?a:this.element},_getOffsetInformation:function(a,d,c){var b=this._getPositionTarget();this.options.fixedPositioning&&this._getContainerElement();var f=b.outerWidth(),h=b.outerHeight();a="width"===a?c.outerWidth():c.outerHeight();return{arrowSize:Math.round(a/2),elementWidth:f,elementHeight:h,wrapperWidth:d.outerWidth(),wrapperHeight:d.outerHeight(),offset:{top:Math.floor(b.offset().top-e(this.options.appendTo).offset().top),left:Math.floor(b.offset().left-
e(this.options.appendTo).offset().left)}}},_getPositionMap:function(a,d){a.attr("style","").css({top:"-1000px",left:"-5000px",display:"block"});return this._getPositioning(a,d)},_getPositioning:function(a,d,c){switch(c||this.options.position){case "bottom":return this._getBottomPositioning(a,d);case "left":return this._getLeftPositioning(a,d);case "right":return this._getRightPositioning(a,d);default:return this._getTopPositioning(a,d)}},_getCommonPositioningMap:function(){return{newArrowTop:0,newArrowLeft:0,
newWrapperTop:0,newWrapperLeft:0,wrapperClass:""}},getLeftRightOffsetAgainstEdge:function(a,d,c){if(this.options.offsetAgainstEdge){var b=e(this.options.appendTo).offset(),f=b?b.left+e(this.options.appendTo).width():e(this.options.appendTo).width(),h,k=null!=b&&a<b.left,g=!isNaN(f)&&a+c.wrapperWidth>f;k?h=Math.floor(b.left+this.options.edgeOffset):g&&(h="rtl"===document.dir?Math.floor(c.wrapperWidth-(c.offset.left+c.elementWidth)-c.elementWidth/2):Math.floor(f-c.wrapperWidth-this.options.edgeOffset));
if(k||g)d="rtl"===document.dir?c.elementWidth/2+c.arrowSize:d+a-h,a=h}return{wrapperLeft:a,arrowLeft:d}},_getTopPositioning:function(a,d){var c=this._getOffsetInformation("height",a,d),b=c.elementWidth/2,f="-top",h=c.wrapperHeight,k=c.offset.top-this.options.edgeOffset-c.arrowSize-c.wrapperHeight;if(!this.options.forceDesiredPosition&&0>=k){if(this.options.fallbackPosition&&"top"!==this.options.fallbackPosition)return this._getPositioning(a,d,this.options.fallbackPosition);f="-bottom";k=c.offset.top+
c.elementHeight+this.options.edgeOffset+c.arrowSize;h=-1*c.arrowSize}a=this.getLeftRightOffsetAgainstEdge(c.offset.left+b-c.wrapperWidth/2+this.options.offsetLeft,c.wrapperWidth/2-c.arrowSize,c);return e.extend(this._getCommonPositioningMap(),{newArrowTop:Math.round(h),newArrowLeft:Math.round(a.arrowLeft),newWrapperTop:Math.round(k),newWrapperLeft:Math.round(a.wrapperLeft),wrapperClass:f})},_getBottomPositioning:function(a,b){var c=this._getOffsetInformation("height",a,b),d=c.elementWidth/2,f="-bottom",
h=-1*c.arrowSize,k=c.offset.top+c.elementHeight+this.options.edgeOffset+c.arrowSize;if(!this.options.forceDesiredPosition&&k+c.wrapperHeight>=jq(g).scrollTop()+e(g).height()){if(this.options.fallbackPosition&&"bottom"!==this.options.fallbackPosition)return this._getPositioning(a,b,this.options.fallbackPosition);f="-top";k=c.offset.top-this.options.edgeOffset-c.arrowSize-c.wrapperHeight;h=c.wrapperHeight}a=this.getLeftRightOffsetAgainstEdge(c.offset.left+d-c.wrapperWidth/2+this.options.offsetLeft,
c.wrapperWidth/2-c.arrowSize,c);return e.extend(this._getCommonPositioningMap(),{newArrowTop:Math.round(h),newArrowLeft:Math.round(a.arrowLeft),newWrapperTop:Math.round(k),newWrapperLeft:Math.round(a.wrapperLeft),wrapperClass:f})},_getLeftPositioning:function(a,b){var c=this._getOffsetInformation("width",a,b),d=c.elementHeight/2,f=c.wrapperHeight/2,h="-left",k=c.wrapperWidth,g=c.offset.left-this.options.edgeOffset-c.arrowSize-c.wrapperWidth;if(!this.options.forceDesiredPosition&&0>=g){if(this.options.fallbackPosition&&
"left"!==this.options.fallbackPosition)return this._getPositioning(a,b,this.options.fallbackPosition);h="-right";g=c.offset.left+c.elementWidth+this.options.edgeOffset+c.arrowSize;k=-1*c.arrowSize}return e.extend(this._getCommonPositioningMap(),{newArrowTop:Math.round(f-c.arrowSize),newArrowLeft:Math.round(k),newWrapperTop:Math.round(c.offset.top+d-f),newWrapperLeft:Math.round(g),wrapperClass:h})},_getRightPositioning:function(a,b){var c=this._getOffsetInformation("border-right-width",a,b),d=c.elementHeight/
2,f=c.wrapperHeight/2,h="-right",k=-1*c.arrowSize,m="rtl"===document.dir?c.wrapperWidth-c.offset.left+c.arrowSize:c.offset.left+c.elementWidth+this.options.edgeOffset+c.arrowSize;if(!this.options.forceDesiredPosition&&m+c.wrapperWidth>=e(g).width()){if(this.options.fallbackPosition&&"right"!==this.options.fallbackPosition)return this._getPositioning(a,b,this.options.fallbackPosition);a=c.offset.left-this.options.edgeOffset-c.arrowSize-c.wrapperWidth;0<=a&&(h="-left",m=a,k=c.wrapperWidth)}return e.extend(this._getCommonPositioningMap(),
{newArrowTop:Math.round(f-c.arrowSize),newArrowLeft:Math.round(k),newWrapperTop:Math.round(c.offset.top+d-f),newWrapperLeft:Math.round(m),wrapperClass:h})},_setStyleClasses:function(a,b,c){a.attr("class","");this._addStyleClasses(a,b,c);return this},_addStyleClasses:function(a,b,c){b&&(a.addClass(this.widgetBaseClass+b),c&&a.addClass(this.widgetBaseClass+b+c),this.options.baseClass&&(a.addClass(this.options.baseClass+b),c&&a.addClass(this.options.baseClass+b+c)));return this},_updateWrapperElement:function(a,
b){this._addStyleClasses(b,"-wrapper",a.wrapperClass);b.attr("style","");"number"===typeof a.newWrapperTop&&b.css("top",a.newWrapperTop+"px");"number"===typeof a.newWrapperLeft&&("rtl"===document.dir?b.css({right:a.newWrapperLeft+"px",left:""}):b.css({left:a.newWrapperLeft+"px",right:""}));return this},_updateArrowElement:function(a,b){this._addStyleClasses(b,"-arrow",a.wrapperClass);b.css({top:a.newArrowTop+"px"});"rtl"===document.dir?b.css({right:a.newArrowLeft+"px",left:""}):b.css({left:a.newArrowLeft+
"px",right:""});return this},_updateContainerElement:function(a,b){this._addStyleClasses(b,"-container",a.wrapperClass);this.options.updateContainerOnResize&&b.css({top:a.newArrowTop+5+"px",left:a.newArrowLeft-b.width()+"px"});return this},_getIdValue:function(a){return this.widgetNamespace+this.options.subNameSpace+a},_open:function(a,b,c){var d=this;a.stop(!0,!0);var f=function(a){this.options.onOpen&&this.options.onOpen.call(this,a);this.options.positionUpdate&&(this._positionUpdater=setInterval(e.proxy(this._updatePosition,
this),1E3/60))};this.options.fadeIn&&!c?a.fadeIn(this.options.fadeIn,function(){f.call(d,b)}):(a.show(),f.call(d,b));return this},_close:function(){this._originalTitle&&(this.element.attr("title",this._originalTitle),this._originalTitle=null);this.options.onClose&&this.options.onClose.call(this,null);return this},_resetElements:function(a,b,c){this._setStyleClasses(a,"-wrapper");this._setStyleClasses(b,"-container");this._setStyleClasses(c,"-arrow");return this}})})(jq||jQuery,window);
(function(e,g){e.createWidgetClass("tip.ToolTip",g.extend({},e.Widgets.Tooltip.prototype,{contentContainer:null,boundEvents:null,orientationOffset:null,trackEventId:null,options:g.extend({},e.Widgets.Tooltip.prototype.options,{showImmediately:!1,baseClass:"coolTip",extraClass:null,delay:200,position:"top",fallbackPosition:null,forceDesiredPosition:null,orientation:"middle",orientationOffset:null,onDestroy:null,activation:"hover",subNameSpace:"",alwaysRendered:!1,color:"black",size:"l",closeOnBodyClick:!0,
destroyAfterClose:!1,content:"",isComponent:!1,target:null,positionTarget:null,updateContainerOnResize:!1,track:null,testAttributes:null}),init:function(){this.base();if(this.options.alwaysRendered){this.contentContainer=this.getChildElement("rendered-content");var b=this.contentContainer.children().eq(0);b.attr({"data-test-popover-content":"","data-test-popover-open":this.options.showImmediately});this.setContent(b)}e.Widgets.Tooltip.prototype.init.call(this);this.boundEvents={};this.orientationOffset=
this._getOrientationOffset()},addEventHandlers:function(){this.subscribe("common.widgets.tooltip.clearCloseTimers",this._clearCloseTimers.bind(this));var b=this;this.subscribe("common.widgets.tooltip.closeAll",function(){b.isOpen&&b.close()})},destroy:function(){if("function"===typeof this.options.onDestroy)this.options.onDestroy();this.options.fadeOut=!1;var b=this._getContainerElement();Object.keys(this.boundEvents).forEach(function(a){b.off(a,this.boundEvents[a])}.bind(this));this.isOpen&&this.close();
this._removeAllWidgetBindings();this.element.removeData(this.widgetName);this.base()},bindComponent:function(){this.element.data("toolTip",this);this.element.data("widget")||this.element.data("widget",this);this._addTestAttributes(this.element,"trigger");e.globals.testMode&&this.element.attr({"data-test-popover-widget":"","data-test-popover-triggerevent":this.options.activation})},bindEventHandler:function(b,a,d){b=b.replace(/\s|$/g,"."+this.id()+" ");this._getContainerElement().on(b,a,d);this.boundEvents[b]=
a},setContent:function(b){this.options.content=b},renderContent:function(b,a){"string"===typeof b?e.Widgets.Tooltip.prototype.renderContent.call(this,b,a):"object"===typeof b?g.contains(a,b)||(a.html(""),a.append(b)):this.log.errorInternal('Bad parameter passed to renderContent(): "content" param must be a String or a jQuery object');this._addTestAttributes(a,"content")},getOptionalTarget:function(b,a){return"string"===typeof b&&b.length?"#"===b[0]?g(b):g("#"+b):null!==b&&"object"===typeof b?g(b):
a},_addTestAttributes:function(b,a){var d=this,c={};e.globals.testMode&&(c["data-test-popover-"+a]="");this.options.testAttributes&&Object.keys(this.options.testAttributes).forEach(function(a){var b=/^data-/.test(a)?a:"data-"+a;c[b]=d.options.testAttributes[a]});b.attr(c)},_getOrientationOffset:function(){return null!==this.options.orientationOffset?this.options.orientationOffset:this.options.extraClass&&-1!==this.options.extraClass.indexOf("no-arrow")?0:{start:-15,middle:0,end:15}[this.options.orientation]},
_getPositioning:function(b,a,d,c){d=d||this.options.position;var l=e.Widgets.Tooltip.prototype._getPositioning.call(this,b,a,d),f={top:0,left:0},h=this.orientationOffset*(c?-1:1);if("middle"!==this.options.orientation){var k=this.options.orientation,m,n;c&&(k="start"===k?"end":"start");"left"===d||"right"===d?(n="top",m="outerHeight"):(n="left",m="outerWidth");var p=this.getOptionalTarget(this.options.positionTarget,this.element),r=p[m](),q=this._getWrapperElement()[m]();if(!c&&!this.options.forceDesiredPosition)if(c=
p.offset()[n],p="scroll"+n.charAt(0).toUpperCase()+n.slice(1),"start"===k){if(c+q>g(window)[p]()+g(window)[m]())return this._getPositioning(b,a,d,!0)}else if("end"===k&&c+r-q<g(window)[p]())return this._getPositioning(b,a,d,!0);b=r/2;q/=2;"start"===k?f[n]=Math.ceil(q-b+h):"end"===k&&(f[n]=Math.ceil(b-q+h))}l.newArrowTop-=f.top;l.newArrowLeft-=f.left;l.newWrapperTop+=f.top;l.newWrapperLeft+=f.left;return l},clearTrackEvent:function(){this.trackEventId&&(clearTimeout(this.trackEventId),this.trackEventId=
null)},startTrackEvent:function(b){this.clearTrackEvent();if(b&&b.wait&&b.label){var a=parseInt(b.wait);isNaN(a)||1>a||(this.trackEventId=setTimeout(this.triggerTrackEvent.bind(this,b),a))}},triggerTrackEvent:function(b){if(this.element&&this.element.hasClass("tooltip-open")&&b&&b.label){var a={category:b.category||"ToolTip",action:b.action||"open",label:b.label};b.hasOwnProperty("value")&&(a.value=b.value);e.Analytics.api.trackEvent(a)}},_open:function(b,a,d){var c=this,l="click."+this.id(),f=this._getContainerElement();
e.Widgets.Tooltip.prototype._open.call(this,b,a,d);e.events.publish("common.widgets.tooltip.clearCloseTimers",this.options.subNameSpace);this.element.addClass("tooltip-open");f.attr("aria-expanded",!0);e.globals.testMode&&this.element.add(f).attr("data-test-popover-open",!0);var h=function(a){b[0].contains(a.target)||"click"===c.options.activation&&c.element[0].contains(a.target)||(g(document).off(l),c.close())};this.options.closeOnBodyClick&&setTimeout(function(){g(document).off(l).on(l,h)},1);this.options.track&&
this.startTrackEvent(g.extend({wait:2E3},this.options.track))},_close:function(b){var a=this.getContent(),d=this._getContainerElement();this.options.alwaysRendered&&"object"===typeof a&&this.contentContainer.append(a);e.Widgets.Tooltip.prototype._close.call(this,b);this.element.removeClass("tooltip-open");d.attr("aria-expanded",!1);e.globals.testMode&&this.element.add(d).attr("data-test-popover-open",!1);this.options.closeOnBodyClick&&e.dom.schedule(function(){g(document).off("click."+this.id())}.bind(this));
this.options.track&&this.clearTrackEvent();this.options.destroyAfterClose&&this.destroy()},closeAfter:function(b){this._forceCloseTimer&&clearTimeout(this._forceCloseTimer);this._forceCloseTimer=window.setTimeout(this.close.bind(this),b)},_clearCloseTimers:function(b){b===this.options.subNameSpace&&clearTimeout(this._closeTimer)},_addStyleClasses:function(b,a,d){a&&(b.addClass(this.widgetBaseClass+a),d&&b.addClass(this.widgetBaseClass+a+d),this.options.baseClass&&(b.addClass(this.options.baseClass+
a),d&&b.addClass(this.options.baseClass+a+d)),this.options.color&&b.addClass("Color-"+this.options.color));this.options.extraClass&&b.addClass(this.options.extraClass);this.options.size&&b.addClass("size-"+this.options.size);e.Common.Utils.Browsers.isIE()?b.addClass("ie"):e.Common.Utils.Browsers.isChrome()&&(b.addClass("chrome"),a=e.Common.Utils.Browsers.getChromeVersion(),65!==a&&66!==a||b.addClass("chrome65"));return this},_getOffsetInformation:function(b,a,d){var c=this.getOptionalTarget(this.options.positionTarget,
this.element),e=c.outerWidth(),f=c.outerHeight(),c={top:Math.floor(c.offset().top-g(this.options.appendTo).offset().top),left:Math.floor(c.offset().left-g(this.options.appendTo).offset().left)};b="width"===b?d.outerWidth():d.outerHeight();return{arrowSize:Math.round(b/2),elementWidth:e,elementHeight:f,wrapperWidth:a.outerWidth(),wrapperHeight:a.outerHeight(),offset:c}}}))})(R9,jQuery);(function(c){c.createComponentClass("flights.results.FlightQueryPricePrediction",{wrappers:null,adviceText:null,chart:null,info:null,tooltipTrigger:null,advice:null,chartIcon:null,dataCheckPromise:null,searchId:null,ariaLabel:null,options:{showFullGraph:!1,checkEnoughData:!1,useStopsMask:!1,shruggieEnabled:!0,msg:{LOADING_TEXT:""}},init:function(){this.wrappers=this.getChildElement("wrapper");this.adviceText=this.getChildElement("advice");this.chart=this.getChildElement("chart");this.chartIcon=this.getChildElement("chartIcon");
this.info=this.getChildElement("info");this.tooltipTrigger=this.getChildElement("tooltip-trigger");this.ariaLabel=this.getChildElement("ariaLabel");this.options.showFullGraph&&(this.dialog=$("#"+this.id("graph-dialog")),this.wrappers=this.wrappers.add($("#"+this.id("graph-dialog-body"))),this.adviceText=this.adviceText.add($("#"+this.id("advice-dialog"))),this.chartIcon=this.chartIcon.add($("#"+this.id("chartIcon-dialog"))))},addEventHandlers:function(){var a=this;this.answer("flights.results.prediction.is",
function(){return a.advice?{buy:a.advice.buy,advice:a.advice.advice}:null});this.options.checkEnoughData&&this.subscribe("resultspage.searchId.changed",this.checkPredictionHasEnoughData.bind(this));this.subscribe("resultspage.streaming.done",function(b){b.searchId&&0<b.searchId.length&&!b.error&&(a.searchId=b.searchId,a.dataCheckPromise?a.dataCheckPromise.then(a.requestPrediction.bind(a)):a.requestPrediction())});this.options.useStopsMask&&this.subscribe("filters.changed",{name:"stops"},function(){a.searchId&&
a.requestPrediction()});this.subscribe(["search.startSearch","resultspage.cleanup"],this.clearPrediction.bind(this,!0));this.subscribe("search.searchFailed",this.clearPrediction.bind(this,!1));this.addGraphAndTooltipHandlers()},addGraphAndTooltipHandlers:function(){var a=this;this.options.showFullGraph?(this.registerEvent("click",function(){"buy"!==a.advice&&"wait"!==a.advice||a.dialog.getWidget().open()}),this.subscribe("flights.results.prediction.farehistory.fail",function(){a.dialog.addClass("no-graph")})):
this.tooltipTrigger.getWidget()&&"click"===this.tooltipTrigger.getWidget().options.activation&&this.registerEvent("click",this.chart,function(){a.tooltipTrigger.attr("aria-hidden")&&setTimeout(function(){a.tooltipTrigger.getWidget().open()},0)})},requestPrediction:function(){var a={searchId:this.searchId};if(this.options.useStopsMask){var b=c.question.ask("resultspage.filterState.is","stops");if(b){var d=0;Object.keys(b).forEach(function(a){b[a]&&(a=parseInt(a),d|=2>a?a+1:4)});a.stopsMask=d}else a.stopsMask=
7}c.action.execute("flights/results/FlightPricePredictionAction",a,this.onPredictionCompleted.bind(this))},checkPredictionHasEnoughData:function(a){var b=this,d=$.Deferred();this.dataCheckPromise=d.promise();c.action.execute("flights/results/FlightPricePredictionEnoughDataAction",{searchId:a.searchId}).always(function(a){a.hasEnoughData?(b.element.removeClass("hidden"),d.resolve()):d.reject()})},onPredictionCompleted:function(a){this.advice=a.advice;this.element.removeClass("loading");this.wrappers.attr("class",
a.cssClass);this.updateAdviceHeader(a.adviceText,!1);this.info.html(a.infoText);this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent(a.moreInfoText);"none"!==a.advice?(this.chartIcon.attr("aria-hidden","false"),this.tooltipTrigger.attr("aria-hidden","false")):this.options.shruggieEnabled||(this.clearPrediction(!1),this.element.addClass("hidden"));c.events.ready("flights.results.prediction",a);c.Analytics.api.trackEvent({category:"Price-Prediction",action:"read-advice",label:a.advice});
this.ariaLabel.html(a.adviceText+"\x3cbr\x3e"+a.infoText+"\x3cbr\x3e"+(a.moreInfoText||""))},updateAdviceHeader:function(a,b){this.adviceText.html(a);this.adviceText.attr("aria-busy",b)},clearPrediction:function(a){this.searchId=this.advice=null;this.wrappers.get(0).className="";this.chartIcon.attr("aria-hidden","true");this.dataCheckPromise=null;this.skipPrediction=!1;this.updateAdviceHeader(a?this.options.msg.LOADING_TEXT:"",a);this.info.html("");this.tooltipTrigger.attr("aria-hidden","true");this.ariaLabel.html("");
this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent("");this.options.checkEnoughData&&this.element.addClass("hidden")}})})(R9);(function(b){b.createComponentClass("flights.results.FlightPriceAlertButton",{options:{trackCreateAlertPath:"",horizontalFPP:!1,useToast:!1,wireButtonStyle:!1,sourceId:null,msg:{priceAlertSaved:"",priceAlertUpdated:"",priceAlertRemoved:""}},alertMode:"",createButton:void 0,init:function(){this.createButton=this.getChildElement("create")},inlineComponentsReady:function(){var a=b.question.ask("flights.results.prediction.is");a&&!this.options.wireButtonStyle&&this.updateButtonColor(a);(a=b.question.ask("flights.results.alerts.existingAlert"))&&
0<a.length&&this.updateButtonVisibility(!0)},openDriveby:function(){if(!this.driveby){var a={sourceId:this.options.sourceId};this.options.horizontalFPP&&(a.popover=!0,a.appendTo=this.getChildElement("popover"),a.success=this.onDrivebyPopover.bind(this));b.events.publish("flights.results.alerts.create",a)}},addEventHandlers:function(){var a=this;this.getChildElement("create").off("click.pricealert").on("click.pricealert",function(){a.createButton.hasClass("clickedPriceAlert")||(a.createButton.addClass("clickedPriceAlert"),
a.openDriveby())});this.subscribe(["alertsaved.success","flight.results.alerts.driveby.cancel"],function(){a.createButton.removeClass("clickedPriceAlert")});this.options.useToast&&this.subscribe("alertsaved.success",function(){if("edit"!==a.alertMode)a.updateToastEnabled=!0;else if(!a.updateToastEnabled)return;var d=b.template.render(a.id()+"-successToastContent",{alertUpdated:"edit"===a.alertMode});b.events.publish("resultspage.notify",{content:d});b.Analytics.api.trackEvent({category:"pricealert/managelink/impression",
action:"impression"})});this.options.wireButtonStyle||this.subscribe("flights.results.prediction",this.updateButtonColor.bind(this));this.subscribe("flights.priceAlert.setview",function(b){a.preventDialogClose=!1;a.updateButtonVisibility("edit"===b.view);a.alertMode=b.view});this.subscribe(["flights.results.priceAlert.show","flights.results.prediction"],function(b){a.element.toggleClass("hidden",!1===b)});this.subscribe("resultspage.cleanup",function(){a.updateButtonVisibility(!1);a.driveby&&(a.driveby.destroy(),
a.driveby=null)});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setVisible(b.enabled&&b.visible)});var c=this.getChildElement("alert-created-button");c.length&&(this.subscribe("flights.priceAlert.deleted",function(){a.alertMode="";a.updateButtonVisibility(!1);c.removeClass("clickedPriceAlert");a.options.useToast&&b.events.publish("resultspage.notify",{content:a.options.msg.priceAlertRemoved})}),c.on("click",function(){$(this).hasClass("clickedPriceAlert")||($(this).addClass("clickedPriceAlert"),
b.events.publish("flights.results.alerts.delete"))}),this.subscribe("error.alert",function(){c.removeClass("clickedPriceAlert")}));this.options.useToast&&(this.subscribe(["resultspage.streaming.start","search.startSearch"],function(){a.updateToastEnabled=!1}),this.subscribe("resultspage.streaming.done",function(){a.updateToastEnabled=!0}))},setVisible:function(a){a?this.element.show():this.element.hide()},updateButtonVisibility:function(a){this.element.toggleClass("existing",a)},updateButtonColor:function(a){this.createButton.toggleClass("Button-Grey-Invert",
!0===a.buy)},onDrivebyPopover:function(){if(this.driveby)this.driveby.dialog.open();else{var a=this.getChildElement("dialog").styleJamDropdownDialog({target:this.element.find(".alertButton"),staticPosition:{top:"35px",right:0},container:this.element,alignment:"left",direction:"down"}).getWidget();this.driveby=this.getChildElement("popover").children().eq(0).data("driveby");this.driveby.bindDialog(a)}}})})(R9);(function(c){c.createComponentClass("flights.results.FlightPriceAlertBanner",{toggle:void 0,tooltipTrigger:void 0,rippleEl:void 0,alertIcon:void 0,alertIconActive:void 0,options:{alwaysShow:!1,visible:!1,economyOnlyAlerts:!1,sourceId:null},init:function(){this.toggle=this.getChildElement("toggle");this.rippleEl=this.getChildElement("ripple");this.tooltipTrigger=this.getChildElement("tooltip-trigger");this.alertIcon=this.getChildElement("alertIcon");this.alertIconActive=this.getChildElement("alertIconActive")},
inlineComponentsReady:function(){var a=c.question.ask("flights.results.alerts.existingAlert");a&&0<a.length&&this.setChecked(!0);this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent(this.options.msg.tooltipMsg)},addEventHandlers:function(){var a=this,d=this.toggle.parent().is(".StyleJamCheckbox")?"styleJamCheckbox":"checkbox";this.toggle[d]({change:function(b,d,e){c.Analytics.api.trackEvent({category:"Price-Alert",action:b.checked?"toggleOn":"toggleOff"});b.checked?(c.events.publish("flights.results.alerts.create",
{sourceId:a.options.sourceId}),a.activateAlertIcon()):(c.events.publish("flights.results.alerts.delete"),a.inActivateAlertIcon())},click:function(a){$(a).blur()}});this.subscribe("flights.priceAlert.deleted",this.setChecked.bind(this,!1));this.subscribe("flights.priceAlert.setview",function(b){a.setChecked("edit"===b.view)});this.subscribe("search.startSearch",function(b){a.setVisible(a.isEnabledForQuery(b))});this.subscribe("resultspage.cleanup",function(){a.setChecked(!1);a.setCheckboxEnabled(!1)});
this.subscribe(["flights.results.priceAlert.show","flights.results.prediction"],function(b){a.setCheckboxEnabled(!!b)});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setCheckboxEnabled(b.enabled);a.setVisible(b.visible)});this.subscribe("flight.results.alerts.driveby.cancel",function(){a.setChecked(!1)})},activateAlertIcon:function(){this.alertIcon.hide();this.alertIconActive.show();this.rippleEl.addClass("rippleEffect");this.rippleEl.on(c.Common.Utils.Browsers.ANIMATION_END,function(){this.alertIconActive.removeClass("in-transition").addClass("active")}.bind(this))},
inActivateAlertIcon:function(){this.alertIcon.show();this.alertIconActive.hide();this.rippleEl.removeClass("rippleEffect");this.alertIconActive.removeClass("active").addClass("in-transition")},isEnabledForQuery:function(a){return this.options.economyOnlyAlerts&&"e"!==a.cabin?!1:!a.isMulticity&&"openflex"!==a.flex_category&&!a.freeRegionId&&!a.countrySearch},setChecked:function(a){this.toggle.prop("checked",a);a?this.activateAlertIcon():this.inActivateAlertIcon()},setCheckboxEnabled:function(a){this.toggle.getWidget().setEnabled(a)},
setVisible:function(a){this.element.toggleClass("hidden",!a).attr("aria-hidden",!a);this.toggle.attr("aria-hidden",!a)}})})(R9);(function(a){a.createComponentClass("flights.results.brands.momondo.FlightPriceAlertBanner","flights.results.FlightPriceAlertBanner",{setVisible:function(b){this.base(b);a.events.publish("flights.results.alerts.visibility",b)}})})(R9);(function(d,g){d.createComponentClass("common.results.DisplayCounts",{filteredCount:null,totalCount:null,showAllLink:null,product:null,baseProductString:null,options:{withUnits:!1,isHorizontalMode:!1,labelMsg:"",filteredCountId:"",totalCountId:"",pluralProductMsg:"",singleProductMsg:"",ariaLabel:"",wrapperClass:""},init:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.baseProductString=
this.product.html()},addEventHandlers:function(){var a=this;this.subscribe("resultspage.results.count.changed",function(c){d.dom.schedule(a.updateCounts.bind(a,c))});this.subscribe(["search.searchFailed","search.startSearch"],function(){d.dom.schedule(a.updateCounts.bind(a,{filtered:0,total:0}))});this.bindShowAll()},bindShowAll:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.showAllLink=
this.element.find("a.showAll").eq(0);this.showAllLink.click(function(){g(this).hasClass("disabled")||(d.events.publish("filters.reset",{type:"showAll"}),d.Analytics.api.trackEvent({category:"Filters",action:"see-all-results"}))})},updateCounts:function(a){if(this.options.withUnits){this.filteredCount.text(a.filtered);this.totalCount.text(a.total);this.showAllLink.css("display",a.filtered===a.total?"none":"inline-block");var c=this.element.children().first();c.removeClass("visible").addClass("visible");
c.removeClass("simple").addClass("simple");this.element.removeClass("visible").addClass("visible");this.element.removeClass("simple").addClass("simple")}else{var b="";""!=this.options.ariaLabel&&(b=' aria-label\x3d"'+this.options.ariaLabel+'"');var c="\x3cspan id\x3d"+this.options.filteredCountId+"\x3e"+a.filtered+"\x3c/span\x3e",e="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+b+"\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3c/a\x3e",b="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+
b+"\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3cspan class\x3d'product'\x3e "+this.options.pluralProductMsg+"\x3c/span\x3e\x3c/a\x3e",f=this.getChildElement("showLabel"),b=d.Common.Utils.String.formatChoice(this.options.labelMsg,a.filtered,a.filtered,c,e,b,this.options.pluralProductMsg,this.options.singleProductMsg,f.length?f[0].outerHTML:"");this.options.isHorizontalMode&&(b=this.options.pluralProductMsg,b=b.charAt(0).toUpperCase()+b.slice(1),b=d.Common.Utils.String.formatString(this.options.labelMsg,
c,e,b));c="\x3cdiv class\x3d'"+this.options.wrapperClass+" visible'\x3e"+b+"\x3c/div\x3e";this.element.html(c).addClass("visible");d.events.publish("displayCounts.newData",{data:c});this.bindShowAll()}this.element.find("a.showAll").toggleClass("disabled",a.filtered===a.total);a.hasOwnProperty("product")?this.product.html(a.product):this.product.html()!==this.baseProductString&&this.product.html(this.baseProductString)}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.filters.placeholders.FilterPlaceholderList",{topFilters:null,moreFilters:null,hasMultipleFilterLists:!1,init:function(){this.topFilters=this.getChildElement("top");(this.moreFilters=this.getChildElement("more"))&&this.moreFilters.length&&(this.hasMultipleFilterLists=!0)},addEventHandlers:function(){this.hasMultipleFilterLists&&(this.subscribe("filterTab.changed",this.switchActiveFilterList.bind(this)),this.subscribe("moreFilters.toggle",this.toggleMoreFilterList.bind(this)))},
switchActiveFilterList:function(){this.topFilters.toggleClass("hidden");this.moreFilters.toggleClass("hidden")},toggleMoreFilterList:function(a){a?this.moreFilters.removeClass("hidden"):this.moreFilters.addClass("hidden")}})})(R9);(function(c){c.createComponentClass("common.results.filters.FilteredLabel",{options:{targetFilters:null,filterRemovedMessage:"",filterAddedMessage:"",labelTiming:3E3,useFilterLabelCleared:0},clearq:[],addEventHandlers:function(){this.subscribe("filter.label.update",this.onLabelUpdate.bind(this));this.subscribe("filters.changed",this.onLabelClear.bind(this))},onLabelUpdate:function(a){if(this.isMyData(a)){var b=this,d=Math.abs(a.diff),e=c.Common.Utils.String.formatChoice(0>a.diff?this.options.filterRemovedMessage:
this.options.filterAddedMessage,d,d);c.dom.schedule(function(){c.dom.toggleOneClass(b.element,"visible",1);b.getChildElement("filteredLabel").addClass("show").text(e);b.clearq.push(a.name);b.clearLabelID=setTimeout(function(){b.clearLabelID=null;b.clearLabel()},b.options.labelTiming)})}},onLabelClear:function(a){this.isMyData(a)&&this.clearLabel()},isMyData:function(a){return!!(a&&a.name&&this.options.targetFilters&&this.options.targetFilters.indexOf&&0<=this.options.targetFilters.indexOf(a.name)&&
this.options.filterRemovedMessage&&this.options.filterAddedMessage)},clearLabel:function(){this.clearLabelID&&(clearTimeout(this.clearLabelID),this.clearLabelID=null);var a=this,b=this.getChildElement("filteredLabel");b.hasClass("show")&&(b.removeClass("show"),setTimeout(function(){c.dom.toggleOneClass(a.element,"visible",0);if(a.options.useFilterLabelCleared)for(var b=0;b<a.clearq.length;b++)c.events.publish("filter.label.cleared."+a.clearq[b],{name:a.clearq[b]});a.clearq=[]},400))}})})(R9);(function(c,d){c.createComponentClass("common.results.filters.Filter",{name:null,data:null,title:null,content:null,searchCompleted:!1,options:{name:null,title:null,title2:null,collapsible:!1,collapsed:!1,isDropdown:!1,mobileView:!1,logUserInteraction:!0,logFiltersQuestion:"",loggingType:"ga",loggingPrefix:"filters",loggingAction:null,loggingLabel:null,resetInTitle:!1,triggerFilteredLabel:!1,useFilterLabelHidesReset:!1,refreshFilterPosOnCollapse:!1,hasPlaceholder:!1,infoTooltip:null,infoTooltipExtraClass:null,
showApplyAll:!1},trackCategory:"filters",dirty:!1,resetButton:null,enabled:null,interactable:null,previousFilters:{},init:function(){this.data={};this.name=this.options.name;this.title=this.getChildElement("title");this.content=this.getChildElement("content");if(void 0===this.name||""===this.name)throw"Error initializing Javascript filter: a filter name was not provided";this.options.infoTooltip&&this.getChildElement("info").toolTip({content:this.options.infoTooltip,position:"top",showImmediately:!1,
extraClass:this.options.infoTooltipExtraClass})},inlineComponentsReady:function(){this.options.collapsible&&!this.options.collapsed&&this.element.addClass("open")},addEventHandlers:function(){var a=this;this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));var b=this.reset.bind(this);this.subscribe("filters.reset",b);this.subscribe("filter.reset",{name:this.name},b);this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed"],function(){a.element.toggleClass("hidden",
a.element.hasClass("empty"))});this.subscribe("resultspage.streaming.done",function(){a.searchCompleted=!0});this.subscribe("search.searchFailed",function(){a.element.addClass("hidden")});this.subscribe("filter.show",{name:this.name},function(){a.element.removeClass("hidden")});this.subscribe("search.startSearch",this.onSearchStart.bind(this));this.subscribe("train.legChange.reset",function(){c.events.publish("filter.reset",{name:a.name})});(b=this.getChildElement("reset"))&&b.length&&(b.click(function(b){b.stopPropagation();
a.reset({type:"reset",userClick:!0})}),b.keydown(function(b){switch(b.which){case c.globals.keyCodes.RETURN:case c.globals.keyCodes.SPACE:b.preventDefault(),a.reset({type:"reset",userClick:!0})}}));this.subscribe("filters.selectedprice",function(){a.reset.apply(a,arguments)});b=this.getChildElement("skip");b.length&&b.click(function(b){b=d("[tabbable]:visible");var c=b.index(a.element)+1;c>=b.length&&(c=0);b.eq(c).get(0).focus()});if(this.options.collapsible){var e=function(b){var f=(b=a.element.hasClass("open"))?
"hide":"show";c.Analytics.api.trackEvent({category:"Filter-Collapsible",action:f,label:a.name});a.element.toggleClass("open");a.title.attr("aria-pressed","show"===f);a.title.attr("aria-expanded","show"===f);c.globals.testMode&&a.title.attr("data-test-filter-collapsed",b);c.events.publish("horizon.filters.opened");!0===a.options.refreshFilterPosOnCollapse&&c.events.publish("horizon.filters.FiltersDialog.itemToggled");a.isMobileView()&&(a.element.parent().addClass("hideNotOpened"),c.events.publish("horizon.mobile.FiltersDialog.itemOpened",
{name:a.name,title:a.options.title}))};this.title.click(e);this.title.keypress(function(a){a.keyCode!==c.globals.keyCodes.RETURN&&a.keyCode!==c.globals.keyCodes.SPACE||e()})}this.subscribe("filters.disabled",this.setDisabled.bind(this));this.subscribe("filter.disabled",{name:this.name},function(b){a.setDisabled(b.disabled)});this.subscribe("filters.goBack",function(){a.element.removeClass("open");a.element.parent().removeClass("hideNotOpened")});this.options.triggerFilteredLabel&&this.subscribe("resultspage.results.count.changed",
this.onResultsCountChanged.bind(this));c.question.forget("resultspage.filter.%s.history.view".format(this.name));this.answer("resultspage.filter.%s.history.view".format(this.name),this.getHistoryFilterViewState.bind(this));this.subscribe("resultspage.filter.%s.history.apply".format(this.name),this.applyFilterFromHistory.bind(this));this.subscribe("resultspage.filter.%s.history.reset".format(this.name),this.reset.bind(this,{type:"reset"}));this.subscribe("resultspage.filter.%s.history.sync".format(this.name),
this.syncWithHistoryPillState.bind(this));this.subscribe("filters.changed",{name:this.name},function(b){a.toggleDirtyOnAfterFiltersChanged(b)});this.options.hasPlaceholder&&this.subscribe("filters.update.placeholderDisplay",this.updatePlaceholderDisplay.bind(this));this.subscribe("filters."+this.name+".setFromPrevious",this.onSetFromPrevious.bind(this));this.options.showApplyAll&&this.registerEvent("click",this.getChildElement("applyAll"),function(b){b.stopPropagation();b.stopImmediatePropagation();
a.applyAll()})},toggleDirtyOnAfterFiltersChanged:function(a){this.element.is(".Common-Results-Filters-FilterSection")||this.element.toggleClass("isDirty",!a.reset)},onSetFromPrevious:function(a){this.setStateFromPrevious(a);a.silent?this.syncFilterState(a.reset):this.pushStateChange(null,{previousFilterChange:!0,changeData:{field:a.key,value:a.value,remove:a.reset,fromPrevious:!0}});a.reset?delete this.previousFilters[a.key]:this.previousFilters[a.key]=a.value},updatePreviousFilters:function(a){},
removePreviousFilter:function(a){c.events.publish("filters.myfilters.removeFromPrevious",{name:this.name,key:a});a?delete this.previousFilters[a]:this.previousFilters={}},getResetType:function(){return!1===this.options.isMultiValueSet?"showAll":!0===this.options.isMultiValueSet?"clearAll":"custom"},pushStateChange:function(a,b,e){a=!0===a?null:e?e:this.getState();b=d.extend({name:this.name,state:a},b,{elemId:this.id()});c.events.publish("filters.changed",b);Object.keys(this.previousFilters).length&&
!b.previousFilterChange&&this.updatePreviousFilters(a)},logUserInteraction:function(a){if(""===this.options.logFiltersQuestion||this.logViewState(this.element))"ga"===this.options.loggingType&&"object"===typeof a?c.Analytics.api.trackEvent(a):c.Analytics.api.trackEvent("/"+this.options.loggingPrefix+"/"+this.name+(a?"/"+a:""))},logViewState:function(a){return c.question.ask(this.options.logFiltersQuestion,{filterEl:a})},publishHoverState:function(a,b){a=d.extend({namespace:this._namespace,name:this.name,
hover:a},b||{});c.events.publish("filters.%s.hovering".format(this.name),a)},toggleResetLink:function(a){var b=this.getChildElement("reset");a?(0!==b.length&&b.addClass("active"),this.element.addClass("activeReset")):(0!==b.length&&b.removeClass("active"),this.element.removeClass("activeReset"))},reset:function(a){this.willReset.apply(this,arguments);this.setLastUserInteraction(!0);this.pushStateChange(!0,{reset:!0});a&&a.userClick&&this.logUserInteraction("reset")},updatePlaceholderDisplay:function(a){},
filterDataChanged:function(a){this.element.closest(".hfilter").addClass("empty-filter");var b=d.extend({},a[this.name]);if(b.hasOwnProperty("enabled"))b.enabled?this.element.hasClass("inactive")&&this.element.removeClass("inactive"):this.element.addClass("inactive"),this.setEnabled(b.enabled),delete b.enabled;else if(!a[this.name]){Object.keys(a).length&&(this.setEnabled(!1),this.element.addClass("empty"));return}this.dirty=b.isDirty;delete b.isDirty;this.isUserManipulated=b.isUserManipulated;c.events.publish("filter.dirty",
{name:this.name,dirty:this.dirty,isUserManipulated:this.isUserManipulated});this.element.toggleClass("isDirty",this.dirty);this.toggleResetLink(this.dirty);this.options.collapsible&&!this.options.resetInTitle&&this.dirty&&this.element.addClass("open");this.options.triggerFilteredLabel&&this.lastUserInteraction&&(this.invalidateFilterLabelData?(this.invalidateFilterLabelData=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelCount=!0);this.update(b);this.isUserManipulated&&
this.syncFilterState();this.element.toggleClass("empty",!this.shouldBeVisible(b));this.element.closest(".hfilter").toggleClass("empty-filter",!this.shouldBeVisible(b));this.setLastUserInteraction(!1)},syncFilterState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a?null:this.getState()})},syncWithHistoryPillState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a})},setStateFromPrevious:function(a){},onResultsCountChanged:function(a){!isNaN(this.lastTotalFilteredCount)&&
!isNaN(a.filtered)&&0<=a.filtered&&(this.lastFilterCountDiff=a.filtered-this.lastTotalFilteredCount);this.lastTotalFilteredCount=a.filtered;this.invalidateFilterLabelCount?(this.invalidateFilterLabelCount=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelData=this.lastUserInteraction},updateFilteredLabels:function(a){a=parseInt(a);if(!isNaN(a)){if(this.options.useFilterLabelHidesReset){var b=this.getChildElement("reset");b&&b.length&&b.hasClass("active")&&(this.subscribe("filter.label.cleared."+
this.name,this.onFilterLabelCleared.bind(this)),this.toggleResetLink(!1))}c.events.publish("filter.label.update",{name:this.name,diff:a})}},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.dirty&&this.toggleResetLink(!0)},toggleAttribute:function(a){return"true"===a?"false":"true"},setLastUserInteraction:function(a){this.lastUserInteraction=a},setDisabled:function(a){c.dom.toggleOneClass(this.element,"Disabled",a);this.element.find("[aria-disabled]").attr("aria-disabled",
a);this.interactable=!a},cleanupExistingState:function(){},shouldBeVisible:function(a){return!0},willReset:function(a){},update:function(a){},applyAll:function(){},getState:function(){},isMobileView:function(){return this.options.mobileView},setEnabled:function(a){this.enabled!==a&&(this.enabled=a,c.events.publish("filter.enabled",{name:this.name,enabled:a}))},onSearchStart:function(a){this.element.removeClass("hidden");this.enabled=null;this.searchCompleted=!1;"undefined"!==typeof a&&a.preserveFilters||
(this.options.hasPlaceholder||this.element.addClass("empty"),this.cleanupExistingState())},getHistoryFilterViewState:function(){return{}},applyFilterFromHistory:function(a){if(c.config.getBoolean("ui.horizon.filters.history.enabled",!1)){var b=d.extend({},this.getState(),a);c.Analytics.api.trackEvent({category:"Filter-History",action:"Applying state From History: "+a,label:this.name});c.events.publish("filters.changed",{name:this.name,state:b})}},getStateForFilterHistory:function(){return d.extend({},
this.getState(),{displayName:this.options.title})},updateFilterHistory:function(){c.config.getBoolean("ui.horizon.filters.history.enabled",!1)&&(c.Analytics.api.trackEvent({category:"Filter-History",action:"Storing filter state in browser: ",label:this.name}),c.events.publish("store.filter.history",{name:this.name,state:this.getStateForFilterHistory()}))}})})(R9,jQuery);(function(c,e){var f=c.config.getBoolean("ui.horizon.fitlers.valueSetFilterItem.clearDisabledPrice",!0),g=c.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");c.createComponentClass("common.results.filters.ValueSetFilterItem",{checkbox:null,options:{name:null,loggingValue:null,group:null,state:{code:null,displayValue:null,pluralDisplayValue:null,minPrice:null,selected:0,info:!1,showAllSate:void 0,resetState:void 0,noSelect:!1,disabled:!1,hideOnly:!1,ignoreOnly:!1,displayOrder:0,
filtered:!1,partiallyFiltered:!1,resetOnDynamicIconClick:!1,tooltipText:null,href:null,cssClass:null,enableItemActionLogging:!1,enableActionTypeLogging:!0,count:0,showAsNotChecked:null,meta:!1},unrolled:!1,withImage:!1,onlyOnClick:!1,heading:void 0,headingOnlyState:1,onUserChange:e.noop,onRemove:e.noop,countEnabled:!1,allowZeroCount:!1,disableOnZeroCount:!1,messages:{},usePluralDisplayValue:!1,allUncheckedMeansInactive:!1,inModal:!1},events:{only:"filters.valueSetFilterItem.only"},eventPrefix:"",
loggingPrefix:"filters",updateKey:null,state:null,init:function(){this.state=e.extend({},this.options.state||{});this.checkbox=this.getChildElement("check");this.price=this.getChildElement("price");this.only=this.getChildElement("only");this.count=this.getChildElement("count");this.funnel=this.element.find(".funnel");this.innerCount=e("span",this.count);this.eventPrefix="filters.%s.%s.".format(this.options.group,this.options.name);this.options.onUserChange=this.options.onUserChange.bind(this,this.options.name);
this.options.tooltipText&&(this.tooltip=this.getChildElement("tooltip-anchor").toolTip(this.getTooltipOptions({content:this.options.tooltipText})).getWidget());this.update(this.state);var a=this;c.dom.schedule(function(){a.checkbox.prop("checked",0<a.state.selected).attr("aria-checked",0<a.state.selected);"string"===typeof a.state.cssClass&&a.element.addClass(a.state.cssClass);a.options.cssClass&&a.element.addClass(a.options.cssClass);a.state.disabled&&a.setDisabled(!0);a.state.hasOwnProperty("noSelect")&&
(a.element.toggleClass("NoSelect",a.state.noSelect),a.checkbox.attr("aria-disabled",a.state.noSelect))})},addEventHandlers:function(){var a=this;this.registerEvent("click",this.element.find(".FilterCheckbox"),this.checkboxClicked.bind(this));this.registerEvent("keypress",this.element,function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.checkboxClicked(b)});this.registerEvent("click",this.price,this.priceClicked.bind(this));this.registerEvent("click",this.count,this.countClicked.bind(this));this.registerEvent("click",
this.only,this.onlyClicked.bind(this));this.options.resetOnDynamicIconClick&&this.registerEvent("click",this.funnel,this.funnelClicked.bind(this));if(this.options.showRemoveIcon){var b=this.getChildElement("remove"),d=null;"function"===typeof this.options.onRemove&&this.registerEvent("click",b,function(b){b.stopPropagation();d&&d.close();a.options.onRemove(a)});b.attr("title")&&(d=b.toolTip().getWidget())}this.registerEvent("keypress",this.only,function(b){switch(b.which){case c.globals.keyCodes.SPACE:case c.globals.keyCodes.RETURN:a.only.click()}});
this.addSubscriptionHandlers();this.registerEvent("focus",this.checkbox,this.toggleFocusStyle.bind(this,!0));this.registerEvent("blur",this.checkbox,this.toggleFocusStyle.bind(this,!1))},addSubscriptionHandlers:function(){var a=this;this.subscribe(this.eventPrefix+"setchecked",this.setChecked.bind(this));this.only&&this.only.length&&this.subscribe(this.eventPrefix+"onlyclick.force",function(){a.only.click()});this.subscribe(this.eventPrefix+"quickclick.force",function(){a.state.disabled||a.state.hideOnly||
a.state.noSelect||a.setChecked(1,"quickfilter")});this.subscribe(this.eventPrefix+"quickunclick.force",function(){a.state.disabled||a.state.hideOnly||a.state.noSelect||a.setChecked(0,"quickfilter")});this.subscribe(this.eventPrefix+"setchecked.force",function(b){a.setChecked(b.selected,b.changeType||"toggle")});this.subscribe(this.eventPrefix+"resetitem",function(b){a.setChecked(a.state.resetState,b.changeType||"toggle")});this.subscribe(["filters.disabled",this.eventPrefix+"disabled"],this.setDisabled.bind(this));
this.subscribe("resultspage.cleanup",function(b){a.isClean=!0});this.subscribe("filters."+this.options.group+".showAsNotChecked",function(b){a.state.showAsNotChecked=b})},countClicked:function(a){this.state.disabled||this.state.hideOnly||this.state.noSelect||(this.setChecked(1),this.options.onUserChange("count"),this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"count"}))},priceClicked:function(a){if(this.price.attr("href"))window.open(this.price.attr("href"),
"_blank");else{if(this.state.disabled||this.state.hideOnly||this.state.noSelect)return;this.setChecked(1);this.options.onUserChange("price")}this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"price"})},onlyClicked:function(a){void 0!==a&&a.stopPropagation();this.state.disabled||(this.options.heading?this.setChecked(this.options.headingOnlyState):this.setChecked(2),this.options.onUserChange("only"))},funnelClicked:function(a){a.stopPropagation();
this.funnelTooltipWidget&&this.funnelTooltipWidget.close();c.events.publish("filters.reset",{type:"showAll"})},checkboxClicked:function(a){a.preventDefault();if(!this.state.disabled&&!this.state.noSelect){a=0<this.state.selected?0:1;var b="toggle";this.options.enableActionTypeLogging&&(b=0<this.state.selected?"unselect":"select");this.options.onlyOnClick&&2!==this.state.selected&&(a=2,b="only");this.setChecked(a);this.options.onUserChange(b);a=0<this.state.selected?"show":"hide";this.options.enableItemActionLogging&&
c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:a+"-"+this.options.name})}},setDisabled:function(a){this.state.disabled=a;c.dom.toggleOneClass(this.element,"Disabled",a);this.element.attr("aria-disabled",a);c.dom.toggleOneClass(this.checkbox.parent(),"Disabled",a);c.events.publish(this.eventPrefix+"state.disabled",a)},setSelectable:function(a){this.state.noSelect=!a;c.dom.toggleOneClass(this.element,"Disabled",!a);this.element.attr("aria-disabled",!a);c.dom.toggleOneClass(this.checkbox.parent(),
"Disabled",!a)},setPrice:function(a){a=a||"";this.state.minPrice=a;this.price.text(a)},setCount:function(a){this.state.count=a;this.innerCount.text(a)},setChecked:function(a,b){var d=this.options.allUncheckedMeansInactive&&this.state.showAsNotChecked?!1:0<a;c.dom.toggleOneClass(this.element,"Checked",d);this.checkbox.prop("checked",d).attr("aria-checked",d);this.state.selected=a;c.events.publish(this.eventPrefix+"changed",this.state);if(b)this.options.onUserChange(b)},setDisplayValue:function(a){this.element.find(".label").text(a);
this.state.displayValue=a},update:function(a){var b=this;this.options.disableOnZeroCount&&0===a.count&&a.filtered?(a.disabled=!0,this.state.userSelectedDisabled=this.state.selected!==a.resetState):this.state.userSelectedDisabled=!1;a.disabled&&f&&(a.minPrice="");this.state.filtered=a.filtered;this.state.displayOrder=a.displayOrder;this.state.showAllState=a.showAllState;this.state.resetState=a.resetState;this.state.meta=a.meta;var d=this.computeUpdateKey(a);if(!c.config.getBoolean("ui.horizon.filters.updateKey",
!0)||d!==this.updateKey||this.isClean)this.isClean=!1,this.state.selected=a.selected,this.state.disabled=a.disabled,c.dom.schedule(function(){b.updateElement(a);b.updateKey=d})},updateElement:function(a){a.cssClass&&a.cssClass!==this.state.cssClass&&(this.element.removeClass(this.state.cssClass),this.element.addClass(a.cssClass),this.state.cssClass=a.cssClass);this.setChecked(a.selected);this.setPrice(a.minPrice);this.state.displayValue!==a.displayValue&&this.setDisplayValue(a.displayValue);(0!==
a.count||this.options.allowZeroCount)&&a.count!==this.state.count&&this.options.countEnabled&&this.setCount(a.count);this.updateDynamicFilterTooltip(a);var b=!!a.hideOnly;if(this.state.hideOnly!==b||this.element.hasClass("No-Only")!==b)this.state.hideOnly=b,this.element.toggleClass("No-Only",this.state.hideOnly);b=!!a.noSelect;this.state.noSelect!==b&&(this.state.noSelect=b,this.element.toggleClass("NoSelect",this.state.noSelect));this.setDisabled(!!a.disabled);this.price.attr("href",a.href||null)},
updateDynamicFilterTooltip:function(a){this.element.removeClass("Filtered FilteredOut");if(a.filtered||a.partiallyFiltered){var b=a.filtered?this.options.messages.filtered:this.options.messages.partiallyFiltered;if(b){this.showingTooltip=!0;var d=a.displayValue;this.options.usePluralDisplayValue&&(d=a.pluralDisplayValue);b=c.Common.Utils.String.formatString(b,d);this.element.addClass("Filtered"+(a.filtered?" FilteredOut":""));this.funnel.attr({"data-title":b,"aria-label":b,"aria-disabled":!this.options.resetOnDynamicIconClick});
this.funnel.getWidget()||(this.funnelTooltipWidget=this.funnel.toolTip(this.getTooltipOptions()).getWidget())}}else this.showingTooltip&&(this.funnel.attr({title:"","aria-disabled":!0}),this.showingTooltip=!1)},computeUpdateKey:function(a){var b="selected filtered partiallyFiltered hideOnly noSelect disabled showAsNotChecked".split(" ").reduce(function(b,c){return b+(a[c]?"1":"0")},""),b=b+(this.options.countEnabled?a.count:a.minPrice),b=b+(a.cssClass?a.cssClass:""),b=b+a.displayValue;return b+=a.href?
a.href:""},getTooltipOptions:function(a){var b=this.options.cssClass&&-1!==this.options.cssClass.indexOf("kayak-flights");return e.extend({},{position:"top",extraClass:"Common-Results-Filters-ValueSetFilterItem__Tooltip "+this.options.cssClass+" "+(b?"uikit ":"")+(this.options.inModal?"modal-layer":""),orientation:b?"start":"middle",size:b?"uikit":"m"},a)},getState:function(){return this.state.disabled&&!this.state.userSelectedDisabled?null:this.state.selected},toggleFocusStyle:function(a){this.element.toggleClass(g,
a)}})})(R9,jQuery);(function(g,h){g.createComponentClass("common.results.filters.ValueSetFilter","common.results.filters.Filter",{content:null,renderedFilterOptions:null,options:{isMultiValueSet:!1,isDefaultChecked:!1,showAllNone:!1,onReset:null,sortInPlace:!1,sortInPlaceLazy:!1,flushState:!0,onDeselect:null,confineOnlyToHeading:!1,onChange:null,removeExpiredOptions:!0,removeExpiredHeadingsWithOptions:!1,visibleCount:0,overflowMinimum:0,showOverflowTemplate:"",hideOverflowTemplate:"",alwaysVisibleItems:[],preventNoneChecked:!1,
showItemHoverTooltip:!1,reverseOptionOrder:!1,countEnabled:!1,allowZeroCount:!1,allowEmptyPrice:!1,disableOnZeroCount:!1,disableOnNoPrice:!1,showOnly:!0,resetOnDynamicIconClick:!1,extraCssClass:"",featureClass:"",onlyLinkClass:"",hidePrice:!1,messages:{},itemTooltipTextMap:null,usePluralDisplayValue:!1,onGetState:null,reloadTop:!1,logItemActions:!1,logActionType:!0,isDropdown:!1,itemTemplateId:"valueSetFilterItem",showTooltipForEllipsed:!1,tooltipHoverDelay:1E3,allUncheckedMeansInactive:!1,reverseSortOrder:!1,
sortOverflowByCount:null,displayDefaultUnchecked:!1,inModal:!1},events:{all:"filters.valueSetFilter.showall"},only:null,showOverflowLink:void 0,overflowVisible:!1,showAsNotChecked:null,resetState:null,multisetOptions:null,init:function(){this.base();this.renderedFilterOptions={};this.content=this.getChildElement("options");0<this.options.visibleCount&&(this.showOverflowLink=this.getChildElement("overflow"));this.options.itemTooltipTextMap=this.options.itemTooltipTextMap||{};this.resetState=this.options.isMultiValueSet&&
!this.options.isDefaultChecked?0:1},addEventHandlers:function(){this.base();var a=this;void 0!==this.showOverflowLink&&(this.showOverflowLink.click(function(){a.options.isDropdown?a.getChildElement("dropdown_content").hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0):a.element.hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0)}),this.showOverflowLink.keypress(function(b){switch(b.which){case g.globals.keyCodes.SPACE:case g.globals.keyCodes.RETURN:a.showOverflowLink.click()}}));
this.subscribe("filters.%s.setonly".format(this.name),function(b){b=a.getRenderedFilterOptions()[b];a.options.preventNoneChecked&&(a.only.setSelectable(!0),b.setSelectable(!1));a.only=b});this.subscribe("filters.%s.setChecked".format(this.name),this.setCheckedItems.bind(this));this.subscribe("filters.%s.setUnChecked".format(this.name),this.setUnCheckedItems.bind(this));this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),this.onItemHover.bind(this));this.options.showAllNone&&
(this.registerEvent("click",this.getChildElement("all"),this.reset.bind(this,{type:"all",userClick:!0})),this.registerEvent("click",this.getChildElement("none"),this.deselect.bind(this,{type:"none",userClick:!0})));this.subscribe("search.startSearch",function(){a.showAsNotChecked=null;0<a.options.visibleCount&&a.hideOverflowOptions()});this.subscribe("filters.%s.forceReset".format(this.name),function(){a.reset()})},inlineComponentsReady:function(){this.base();this.options.showTooltipForEllipsed&&
!this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),this.onItemHover.bind(this))},reset:function(a){if(!a||!(a.ignore===this.name||h.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name))){this.options.allUncheckedMeansInactive&&(this.showAsNotChecked=!0,g.events.publish("filters."+this.name+".showAsNotChecked",!0));if("function"===typeof this.options.onReset)return this.options.onReset.apply(this,arguments);var b=this.options.flushState,c=this.options.displayDefaultUnchecked;
this.forEachItem(function(e,d){d.state.disabled||d.state.noSelect||(c?(b=!0,d.setChecked(0),d.state.selected=0):void 0!==d.state.showAllState&&a&&a.type&&"reset"!==a.type?(b=!1,d.setChecked(d.state.showAllState)):(e=d.state.resetState,void 0!==e&&void 0!==d.state.defaultSelectedState&&e!==d.state.defaultSelectedState&&(b=!1),d.setChecked(void 0!==e?e:this.resetState)),this.options.preventNoneChecked&&d.setSelectable(!0))});!this.options.resetInTitle&&0<this.options.visibleCount&&this.hideOverflowOptions();
a&&a.silent?this.syncFilterState(b):this.pushStateChange(b,{reset:!0});a&&a.userClick&&(this.setLastUserInteraction(!0),this.logUserInteraction("showall"));this.only=null}},getResetType:function(){return this.options.isDefaultChecked?"showAll":this.base()},deselect:function(a){if(!a||!(a.ignore===this.name||h.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name))){if("function"===typeof this.options.onDeselect)return this.options.onDeselect.apply(this,arguments);this.forEachItem(function(a,c){c.state.disabled||
c.state.noSelect||(c.setChecked(0),this.options.preventNoneChecked&&c.setDisabled(!1))});0<this.options.visibleCount&&this.hideOverflowOptions();a&&a.silent?this.syncFilterState():this.pushStateChange(!1);a&&a.userClick&&this.logUserInteraction(a.type)}},cleanupExistingState:function(){this.forEachItem(function(a,b){g.ComponentManager.remove(b.id())});this.renderedFilterOptions={};this.multisetOptions=null;this.getOptionsContainer().empty()},sortRenderedFilterOptions:function(a){if(a.useHeadings)for(var b=
Object.keys(a.headingValueMap),c=0;c<b.length;c++){var e=this.getOptionsContainer().find('.heading[data-heading\x3d"%s"]'.format(b[c])).find(".content");this.sortOptionsInPlace(e,a.headingValueMap[b[c]])}else this.sortOptionsInPlace(this.getOptionsContainer(),a.valueMap)},sortOptionsInPlace:function(a,b){var c=a.find(".Common-Results-Filters-ValueSetFilterItem");0!==c.length&&(c=c.toArray().sort(function(a,c){a=b[h(a).data("name")];c=b[h(c).data("name")];return a&&c?a.displayOrder-c.displayOrder:
0}),h(c).detach().appendTo(a))},addOptionToFilterMap:function(a,b,c,e,d){var f=this.id()+"-"+Math.floor(1E4*Math.random())+"-"+a.replace(/\W+/g,"");d=d||{};f=h.extend({id:f,name:a},b,{showCount:this.options.countEnabled,showPrice:!this.options.countEnabled&&!this.options.hidePrice,itemTemplateId:this.options.itemTemplateId,hasCount:this.options.allowZeroCount?0<=b.count:0<b.count,hasPrice:this.options.allowEmptyPrice||b.minPrice,disabled:this.options.disableOnZeroCount?0==b.count:!1,tooltipText:this.options.itemTooltipTextMap[a],
showOnly:this.options.showOnly,onlyLinkClass:this.options.onlyLinkClass,optionsContainer:this.getOptionsContainer()},d);d=g.template.renderElement(f.itemTemplateId,f);var n=b.displayOrder,k=function(a,b){return a>b};this.options.reverseSortOrder&&(k=function(a,b){return a<b});var l=null;this.forEachItem(function(a,b){k(b.state.displayOrder,n)&&(null!==l?k(l.state.displayOrder,b.state.displayOrder)&&(l=b):l=b)},e);if(null===l||void 0!==c)if(f=f.optionsContainer,c){var m=f.find('.heading[data-heading\x3d"%s"]'.format(c));
m.length||(m=this.makeHeadingContainer(c),f.append(m));m.find(".content").append(d)}else this.options.reverseOptionOrder?f.prepend(d):(d.insertAfter(l),f.append(d));else d.insertBefore(l.element);b=this.makeFilterOption(d,b,a,c);e[a]=b;b.element.on("mouseenter",this.publishHoverState.bind(this,!0,{item:b.options.name}));b.element.on("mouseleave",this.publishHoverState.bind(this,!1,{item:b.options.name}))},addFilterItem:function(a,b,c,e){this.addOptionToFilterMap(a,b,c,this.getRenderedFilterOptions(),
e)},makeFilterOption:function(a,b,c,e,d){var f=this;return new g.common.results.filters.ValueSetFilterItem(a,h.extend(!0,{},{state:b,name:c,group:this.name,cssClass:this.options.extraCssClass+" "+this.options.featureClass+(d&&d.cssClass?" "+d.cssClass:""),onUserChange:function(){f.filterItemDidChange.apply(f,Array.prototype.slice.call(arguments).concat(this))},heading:e,headingOnlyState:this.options.confineOnlyToHeading?1:2,countEnabled:this.options.countEnabled,allowZeroCount:this.options.allowZeroCount,
disableOnZeroCount:this.options.disableOnZeroCount,resetOnDynamicIconClick:this.options.resetOnDynamicIconClick,messages:this.options.messages,tooltipText:this.options.itemTooltipTextMap[c],enableActionLogging:this.options.logItemActions,enableActionTypeLogging:this.options.logActionType,usePluralDisplayValue:this.options.usePluralDisplayValue,allUncheckedMeansInactive:this.options.allUncheckedMeansInactive,inModal:this.options.inModal},d||{}))},makeHeadingContainer:function(a){var b="\x3cdiv class\x3d'heading' data-heading\x3d\""+
a+'"\x3e%s\x3c/div\x3e';a="\x3cdiv class\x3d'title'\x3e%s\x3c/div\x3e\x3cdiv class\x3d'content'\x3e\x3c/div\x3e".format(a);return h(b.format(a))},shouldBeVisible:function(a){return(a=a.useHeadings?a.headingValueMap:a.valueMap)&&0<Object.keys(a).length},logUserInteraction:function(a,b){if("ga"===this.options.loggingType){a=a.split("/");var c=void 0;a[0]&&(c="reset"===a[0]?"showall":a[0]);var e=this.getRenderedFilterOptions()[a[0]];a[1]&&"toggle"===a[1]&&e&&(a[1]=e.state.selected?"show":"hide");a[1]&&
(c=(b?"":a[1]+"-")+c+(b?"-"+a[1]:""));this.base({category:this.trackCategory,action:this.name,label:c})}else this.base(a)},filterItemDidChange:function(a,b,c,e){var d={field:a,value:c&&c.state.selected};if(this.options.allUncheckedMeansInactive){var f=this.getRenderedFilterOptions();null==this.showAsNotChecked&&(this.showAsNotChecked=Object.keys(f).every(function(b,c){c=0<f[b].state.selected;return b===a?!c:c}));this.showAsNotChecked?(g.events.publish("filters."+this.name+".showAsNotChecked",!1),
this.showAsNotChecked=!1,f[a].setChecked(1),b="only"):0===Object.keys(f).filter(function(a){return 0<f[a].state.selected}).length&&(g.events.publish("filters."+this.name+".showAsNotChecked",!0),this.showAsNotChecked=!0,this.forEachItem(function(a,b){b.setChecked(1)}),b="showall")}this.multisetOptions&&c&&Object.keys(this.multisetOptions).forEach(function(b){var c=this.multisetOptions[b],d=a===b,e=0<this.getRenderedFilterOptions()[b].getState();c.indexOf(a);d?this.forEachItem(function(a,b){b.state.meta||
(a=-1<c.indexOf(a),e?b.setChecked(a?1:0):a||b.setChecked(1))}):-1===c.indexOf(a)&&this.getRenderedFilterOptions()[b].setChecked(0)},this);"only"===b||"price"===b||"count"===b?(this.only=this.getRenderedFilterOptions()[a],this.forEachItem(function(b,c){c.options.state.ignoreOnly||c&&b!=a&&(this.only.options.heading&&this.options.confineOnlyToHeading?this.only.options.heading===c.options.heading&&c.setChecked(0):c.setChecked(0))}),"price"===b&&g.events.publish("filters.selectedprice",{ignore:this.name})):
this.only&&this.unsetOnlyOption(a);"function"===typeof this.options.onChange&&this.options.onChange.call(this,c);e||(this.setLastUserInteraction(!0),this.pushStateChange(null,{changeData:d}),this.updateFilterHistory(),this.options.logUserInteraction&&(this.logUserInteraction("showall"===b?b:a+"/"+b),c&&c.state.filtered&&g.Analytics.api.trackEvent("filters/filteredItem/"+b)));c&&0!==c.getState()&&g.events.publish("gtm.update",{event:"resultsFilterChange",filterName:this.name,filterValue:a});this.options.reloadTop&&
window.scrollTo(0,0)},unsetOnlyOption:function(a){a!==this.only.options.name?(this.only.setChecked(1),this.only=null):a===this.only.options.name&&2!==this.only.state.selected&&(this.only=null)},update:function(a){var b=this,c=!1,e=Object.keys(this.getRenderedFilterOptions()).length;this.multisetOptions=a.multisetOptions;var d=h.extend(!0,{},a);if(d.useHeadings){a=d.headingValueMap;for(var f=Object.keys(a),g=0;g<f.length;g++){var k=f[g],k=this.updateItems(a[k],k,d);c||(c=k)}d.orderedHeadings&&this.getOptionsContainer().find(".heading").sort(function(a,
b){return d.orderedHeadings.indexOf(h(a).data("heading"))>d.orderedHeadings.indexOf(h(b).data("heading"))?1:d.orderedHeadings.indexOf(h(a).data("heading"))<d.orderedHeadings.indexOf(h(b).data("heading"))?-1:0}).appendTo(this.getOptionsContainer());this.options.removeExpiredHeadingsWithOptions&&(f=Object.keys(d.headingValueMap),this.getOptionsContainer().find(".heading").each(function(a,c){(a=h(c).data("heading"))&&""!==a&&0>f.indexOf(a)&&(h(c).find("li").each(function(a,c){(a=h(c).data("name"))&&
""!==a&&delete b.getRenderedFilterOptions()[a]}),h(c).remove())}))}else c=this.updateItems(d.valueMap,void 0,d);(this.options.sortInPlace||this.options.sortInPlaceLazy&&e!==Object.keys(this.getRenderedFilterOptions()).length)&&this.sortRenderedFilterOptions(d);this.element.hasClass("empty")&&c&&this.element.removeClass("empty")},updateItems:function(a,b,c){if(!a)return!1;var e=this,d=Object.keys(a),f=0<d.length,h=0,k=!1,d=d.sort(function(b,c){return a[b].displayOrder-a[c].displayOrder});this.options.disableOnNoPrice&&
d.forEach(function(b){b=a[b];b.minPrice||(b.disabled=1,b.selected=0)});this.options.displayDefaultUnchecked?(this.showAsNotChecked=this.allChecked(a))&&d.forEach(function(b){a[b].selected=0;a[b].showAllState=0}):this.options.allUncheckedMeansInactive&&null==this.showAsNotChecked&&(this.showAsNotChecked=this.allChecked(a))&&d.forEach(function(b){a[b].showAsNotChecked=!0});d.filter(function(a){return e.getRenderedFilterOptions().hasOwnProperty(a)}).forEach(function(b){var c=a[b];e.getRenderedFilterOptions()[b].update(c)});
var l={};d.length>this.options.overflowMinimum&&(l=this.getOverflowItems(d,a));d.forEach(function(d){h++;var f=a[d];f.showAsNotChecked=e.showAsNotChecked;e.getRenderedFilterOptions().hasOwnProperty(d)||e.addFilterItem(d,f,b,{filtersData:c});l&&l[d]&&(0===f.selected||e.options.isDefaultChecked)?(e.getRenderedFilterOptions()[d].element.addClass("overflow-item").attr("aria-hidden",!0),k=!0):e.getRenderedFilterOptions()[d].element.removeClass("overflow-item").attr("aria-hidden",!1);2===f.selected&&(e.only=
e.getRenderedFilterOptions()[d])});this.options.preventNoneChecked&&this.disableOnlyOption();if(void 0!==this.showOverflowLink&&!this.element.hasClass("overflow-visible")&&(this.showOverflowLink.toggleClass("visible",k),this.showOverflowLink.attr("aria-pressed",function(a){return"false"===a?"true":"false"}),k&&(this.options.showOverflowTemplate||this.options.hideOverflowTemplate))){var d={},m=Object.keys(l).length;this.options.showOverflowTemplate&&(d.more=g.Common.Utils.String.formatChoice(this.options.showOverflowTemplate,
m,m),this.overflowVisible||this.getChildElement("overflow-text").text(d.more));this.options.hideOverflowTemplate&&(d.less=g.Common.Utils.String.formatChoice(this.options.hideOverflowTemplate,m,m),this.overflowVisible&&this.getChildElement("overflow-text").text(d.less));Object.keys(d).length&&this.showOverflowLink.data(d)}this.handleExpiredOptions(a,b);return f},updatePlaceholderDisplay:function(a){this.options.isDropdown?this.base(a):a&&(this.getChildElement("placeholder").toggleClass("hidden",!a.visible),
this.getChildElement("options").toggleClass("hidden",!!a.visible))},allChecked:function(a){var b=Object.keys(a);return b.length?b.every(function(b){return 0<a[b].selected||0<a[b].disabled}):null},getOverflowItems:function(a,b){var c=this;if(0<this.options.visibleCount){var e=a.filter(function(a){return-1===c.options.alwaysVisibleItems.indexOf(a)});a=this.options.visibleCount-(a.length-e.length);var d=e;this.options.sortOverflowByCount&&(d=e.sort(function(a,c){a=b.hasOwnProperty(a)?b[a].count:0;return(b.hasOwnProperty(c)?
b[c].count:0)-a}));var f={};d.slice(a).forEach(function(a){f[a]=a});return f}return null},handleExpiredOptions:function(a,b){this.forEachItem(function(c,e){a.hasOwnProperty(c)||e.options.heading!==b||(this.options.removeExpiredOptions?(g.ComponentManager.remove(e.id()),delete this.getRenderedFilterOptions()[c]):e.setChecked(0))})},disableOnlyOption:function(){var a=this.getRenderedFilterOptions();if("object"===typeof a&&0!==a.length){var b=Object.keys(a),c=b.filter(function(b){return 0<a[b].getState()});
b.forEach(function(b){a[b].setSelectable(!0)});1===c.length?a[c[0]].setSelectable(!1):0===c.length&&this.log.console("ValueSetFilter#DisableOnlyOption: No filter options checked while preventNoneChecked is true. \nFilter name: "+this.options.name)}},setCheckedItems:function(a){this.forEachItem(function(b,c){0<=a.items.indexOf(b)?c.setChecked(1):c.setChecked(0)});this.pushStateChange()},setStateFromPrevious:function(a){var b=this.getRenderedFilterOptions()[a.key];if(b)if(a.reset)2===b.getState()?this.reset({silent:!0}):
b.setChecked(void 0!==b.state.resetState?b.state.resetState:this.resetState);else if(a.hasOwnProperty("value")){var c=parseInt(a.value);b.setChecked(c);this.filterItemDidChange(a.key,2===c?"only":null,b,!0)}},updatePreviousFilters:function(a){a?Object.keys(this.previousFilters).forEach(function(b){if(a&&a.hasOwnProperty(b)){var c=a[b],e=parseInt(this.previousFilters[b]);c===e||2===c&&0<e||this.removePreviousFilter(b)}},this):this.removePreviousFilter()},setUnCheckedItems:function(a){this.forEachItem(function(b,
c){0<=a.items.indexOf(b)?c.setChecked(0):c.setChecked(1)});this.pushStateChange()},onItemHover:function(a){if(!a.hasOwnProperty("namespace")||a.namespace===this._namespace){var b=this.renderedFilterOptions[a.item],c=(g.question.ask("hotels.results.filtersPinned")||!1)&&!this.options.inModal;if(this.options.showTooltipForEllipsed&&!0===a.hover){var e=b.element.find("label");if(e.length&&e[0].offsetWidth>=e[0].scrollWidth)return}!0===a.hover?b.element.toolTip({content:b.options.state.displayValue,position:c?
"bottom":"top",showImmediately:!0,delay:this.options.tooltipHoverDelay}):!1===a.hover&&b.element.data("toolTip")&&b.element.data("toolTip").removeWidget()}},showOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").addClass("overflow-visible").attr("aria-expanded",!0),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!1)):(this.element.addClass("overflow-visible").attr("aria-expanded",!0),this.element.find(".overflow-item").attr("aria-hidden",
!1));this.getChildElement("overflow").attr("aria-pressed",!0);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("less"));this.overflowVisible=!0;a&&this.logUserInteraction("overflow/showmore",!0);g.events.publish("filter.overflow.toggle")},hideOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").removeClass("overflow-visible").attr("aria-expanded",!1),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!0)):
(this.element.removeClass("overflow-visible").attr("aria-expanded",!1),this.element.find(".overflow-item").attr("aria-hidden",!0));this.showOverflowLink.attr("aria-pressed",!1);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("more"));this.overflowVisible=!1;a&&this.logUserInteraction("overflow/showless",!0);g.events.publish("filter.overflow.toggle")},forEachItem:function(a,b){var c=this;b=b||this.getRenderedFilterOptions();Object.keys(b).forEach(function(e){a.call(c,e,b[e])},this)},
getRenderedFilterOptions:function(){return this.renderedFilterOptions},getOptionsContainer:function(){return this.content},getState:function(){var a={};this.forEachItem(function(b,c){var e=c.getState();null!==e&&(a[c.state.code||b]=e)},h.extend({},this.getRenderedFilterOptions()));this.options.onGetState&&(a=this.options.onGetState.call(this,a));return a},getHistoryFilterViewState:function(a){var b={};this.forEachItem(function(a,c){var d=c.getState();b[c.state.code||a]=d},h.extend({},this.getRenderedFilterOptions()));
var c=this.showCheckedFilterHistory()?"1":"0",e={},d=null,f=Object.keys(a).filter(function(b){b=a[b];if(h.isArray(b)){if(b.filter(function(a){return"2"==a}).length)return!0}else return"2"==b;return!1}),f=f.length?f[0]:null,g=Object.keys(a).filter(function(a){return b.hasOwnProperty(a)}),k=function(a,c){var d=b[a],e={},f=null;h.isArray(d)?(e[a]=[],d.forEach(function(b){b==c?null===f&&(f=!0):f=!1;e[a].push(c)})):(f=c==d,e[a]=c);return{state:e,isAlreadyApplied:f}};return f?b.hasOwnProperty(f)?h.extend({},
k(f,"2"),{only:f}):{disabled:!0}:g.length?(g.forEach(function(a){var b=k(a,c);e[a]=b.state[a];b.isAlreadyApplied?null===d&&(d=b.isAlreadyApplied):d=!1}),{state:e,isAlreadyApplied:d}):{disabled:!0}},getStateForFilterHistory:function(){var a={},b=this;this.forEachItem(function(b,e){var c=e.getState();null!==c&&(a[e.state.code||b]=c)},h.extend({},this.getRenderedFilterOptions()));return h.extend({},{displayName:this.options.title,type:g.question.ask("filters.FilterHistory.type.checkbox"),inclusive:this.showCheckedFilterHistory(),
state:h.extend({},a),displayValue:Object.keys(a).reduce(function(a,e){a[e]=b.getFilterHistoryDisplayValue(e);return a},{})})},getFilterHistoryDisplayValue:function(a){var b=g.config.getBoolean("ui.horizon.filters.history.%s.show.code.only".format(this.name),!1),c=this.getRenderedFilterOptions();return c.hasOwnProperty(a)?b?c[a].state.code:c[a].state.displayValue:null},showCheckedFilterHistory:function(){return g.config.getBoolean("ui.horizon.filters.history.%s.show.checked.items".format(this.name),
!1)}})})(R9,jQuery);(function(d){R9.extend("Widgets",{Slider:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!this.validateElement())return this;this.options=d.extend({},this.options,b);this.init()}});R9.extend("Widgets.Slider.prototype",{elementNode:null,element:null,elementWidth:0,elementPositionLeft:0,activeRange:null,handles:[],activeHandle:null,activeHandleIndex:null,startValues:null,timelineDepPoints:null,timelineDepTimes:null,timelineArrTimes:null,timelineHours:null,timelinePrices:null,timelineLegSignatures:null,
timelineElements:null,timelineLabels:null,mouseMoveDelegate:d.noop,mouseUpDelegate:d.noop,options:{start:d.noop,stop:d.noop,slide:d.noop,min:0,max:100,step:1,values:[],range:!0,logarithmic:!1,snapToValue:!1,timeValueAmount:0,exponent:-1,cutoff:-1,totalRange:-1,totalStepAmount:-1,equalStepAmount:-1,cutoffPercentage:-1,equalStepRange:-1,expStepAmount:-1,useCustomDistribution:!1},init:function(){var a=this.element.data("r9RangeSlider");null!=a&&(this.options.values=a.getValues());this.element.data("r9RangeSlider",
this);var b=this;this.handles=this.element.children(".r9-rangeSlider-handle");this.activeRange=this.element.find(".r9-rangeSlider-activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(a){b.mouseDown(a);a.preventDefault();a.stopPropagation(!0)});a=this.options.values;if(!a||1>a.length)a=this.options.range?[this.options.min,this.options.max]:[this.options.min];this.determineSetValues(a);setTimeout(function(){b.drawActiveRange()},60)},validateElement:function(){return 0<
this.element.length&&this.element.hasClass("r9-rangeSlider")},setStartValues:function(){this.startValues=[];for(var a=0;a<this.options.values.length;a++)this.startValues[a]=this.options.values[a]},setupActiveHandle:function(a){this.activeHandle=a;this.activeHandleIndex=null;this.elementWidth=this.element.outerWidth();this.elementPositionLeft=this.element.offset().left;for(a=0;a<this.handles.length;a++)this.activeHandle==this.handles[a]&&(this.activeHandleIndex=a);d(this.activeHandle).addClass("r9-rangeSlider-handle-active")},
mouseDown:function(a){this.setupActiveHandle(a.target);var b=this;this.mouseMoveDelegate=function(a){b.mouseMove(a)};this.mouseUpDelegate=function(a){a.stopPropagation(!0);b.mouseUp(a)};d(document).bind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).bind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);this.setStartValues();this.options.start(a,this.options.values)},mouseUp:function(a){d(this.activeHandle).removeClass("r9-rangeSlider-handle-active");
this.activeHandleIndex=this.activeHandle=null;d(document).unbind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).unbind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);var b=!1;if(this.startValues)for(var c=0;c<this.options.values.length;c++){if(this.options.values[c]!=this.startValues[c]){b=!0;break}}else b=!0;this.options.stop(a,this.options.values,b)},setActiveHandleValue:function(a){var b=100*this.positionForValue(a);d(this.activeHandle).css("left",
b+"%").css("z-index","3");for(b=0;b<this.handles.length;b++)this.handles[b]==this.activeHandle&&(this.options.values[b]=a,this.setHandleAttribute("valuenow",a,b),1<this.handles.length&&(0===b?this.setHandleAttribute("valuemin",a,1):this.setHandleAttribute("valuemax",a,0)));this.drawActiveRange()},setHandleAttribute:function(a,b,c){void 0!==c?d(this.handles[c]).attr("aria-"+a,b):d(this.handles).attr("aria-"+a,b);R9.globals.testMode&&(void 0!==c?d(this.handles[c]).attr("data-test-sliderhandle-"+a,b):
d(this.handles).attr("data-test-sliderhandle-"+a,b))},mouseMove:function(a){a.preventDefault();a.stopPropagation();var b=a.originalEvent;b.touches&&0<b.touches.length?a.pageX=b.touches[0].pageX:b.changedTouches&&0<b.changedTouches.length&&(a.pageX=b.changedTouches[0].pageX);this.setActiveHandleValue(this.valueForPosition(Math.min(this.elementWidth,Math.max(0,a.pageX-this.elementPositionLeft))/this.elementWidth,this.activeHandleIndex));this.options.slide(a,this.options.values)},getValues:function(){return this.options.values.slice(0)},
getValue:function(){return 0<this.options.values.length?this.options.values[0]:0},setValues:function(a){var b=this;this.options.values=[];for(var c=0;c<a.length;c++){var e=this.trimAlignValue(a[c]),f=100*this.positionForValue(e),g=2;1<a.length&&(0==c&&90<=f||c==a.length-1&&10>=f)&&(g=3);this.options.values.push(e);d(this.handles[c]).css("left",f+"%").css("z-index",g)}setTimeout(function(){b.drawActiveRange()},60);R9.config.getBoolean("ui.slider.nonBlockingDrawActiveRange",!0)?setTimeout(this.drawActiveRange.bind(this),
1):this.drawActiveRange();this.options.slide(null,this.options.values)},determineSetValues:function(a){if(R9.config.getBoolean("ui.slider.safeSetValues",!0))return this.safeSetValues(a);this.setValues(a);return null},safeSetValues:function(a){try{return this.setValues(a),null}catch(b){return b}},errorSetValues:function(a){R9.Widgets.Slider.singleSetValuesError||(R9.Widgets.Slider.singleSetValuesError=1,R9.config.getBoolean("ui.slider.logRollbar",!1)&&window.Rollbar&&Rollbar.error?Rollbar.error("Slider setValues failed",
{error:a&&a.message?a.message:"(unknown error)",winTop:window===window.top,winParent:window.top===window.parent}):R9.config.getBoolean("ui.slider.logVs",!0)&&R9.Analytics.api.trackEvent({category:"slider",action:"error",label:"setvalues",value:(window===window.top)+"-"+(window.top===window.parent)}))},setCustomDistribution:function(a){this.options.exponent=a.exponent;this.options.cutoff=a.cutoff;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=a.ranges.length;
this.options.cutoffPercentage=a.cutoffPercentage;this.options.equalStepAmount=this.options.cutoffPercentage*this.options.totalStepAmount;this.options.equalStepRange=this.options.cutoff-this.options.min;this.options.expStepAmount=this.options.totalStepAmount-this.options.equalStepAmount;this.options.useCustomDistribution=!0},resetCustomDistribution:function(){this.options.exponent=-1;this.options.cutoff=-1;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=-1;this.options.equalStepAmount=
-1;this.options.cutoffPercentage=-1;this.options.equalStepRange=-1;this.options.expStepAmount=-1;this.options.useCustomDistribution=!1},setTimelinePoints:function(a,b,c,d,f,g,h){this.timelineDepPoints=a;this.timelineDepTimes=b;this.timelineArrTimes=c;this.timelineHours=d;this.timelinePrices=f;this.timelineLegSignatures=g;h&&this.clearTimelineValues();this.setTimelineValues()},clearTimelineValues:function(){this.element.find(".timelineValue").remove();this.clearTimelineHours()},setTimelineValues:function(){this.timelineElements=
[];for(var a=0;a<this.timelineDepPoints.length;a++)this.setTimelinePoint(a);this.setTimelineHours()},setTimelinePoint:function(a){var b=d("\x3cspan /\x3e").addClass("timelineValue"),c=d('\x3cdiv class\x3d"times"  /\x3e').text(this.timelineDepTimes[a]+" - "+this.timelineArrTimes[a]),e=d('\x3cdiv class\x3d"priceValue" /\x3e').text(this.timelinePrices[a]),f=d("\x3cdiv /\x3e");b.data("legSig",this.timelineLegSignatures[a]);f.append(c);f.append(e);a=100*this.positionForValue(this.timelineDepPoints[a]);
this.element.append(b);b.css("left",a+"%");b.off("mouseover.r9Timeline").on("mouseover.r9Timeline",function(){d(this).addClass("highlight")});b.off("mouseout.r9Timeline").on("mouseout.r9Timeline",function(){d(this).removeClass("highlight")});this.markFilteredOutTimeLinePoint(b);b.toolTip({delay:0,showImmediately:!1,extraClass:"timelinePoint",content:""+f.html()});this.timelineElements.push(b)},markFilteredOutTimeLinePoint:function(a){if(a&&0!==a.length){var b=this.getPositionLeftValue(this.handles[0],
0),c=this.getPositionLeftValue(this.handles[1],100),d=this.getPositionLeftValue(a,100);b>d||c<d?a.addClass("filteredOut"):a.removeClass("filteredOut")}},markFilteredOutTimeLinePoints:function(){var a=this;this.timelineElements&&0!==this.timelineElements.length&&$.each(this.timelineElements,function(b,c){a.markFilteredOutTimeLinePoint(c)})},clearTimelineHours:function(){this.element.find(".timelineHour").remove()},setTimelineHours:function(){for(var a=0,b=0;24>b;b++){var c=this.options.min+36E5*b;
if(c>this.options.min&&c<this.options.max){var e=d("\x3cspan /\x3e").addClass("timelineHour").text(this.timelineHours[a]);this.element.append(e);c=100*this.positionForValue(c);e.css("left",c+"%");a++}}},getPositionLeftValue:function(a,b){return a?parseFloat($(a)[0].style.left):b},formatHourLabel:function(a){var b=new Date(a);a=b.getUTCHours();10>a&&(a="0"+a);b=b.getUTCMinutes();10>b&&(b="0"+b);return a+":"+b},triggerStop:function(){this.options.stop({},this.options.values,!0)},setValue:function(a){var b=
this.options.values.slice(0);b[0]=a;this.determineSetValues(b)},getOption:function(a){return this.options[a]},setOption:function(a,b){if("object"==typeof a)for(a in b=a,b)b.hasOwnProperty(a)&&(this.options[a]=b[a]);else this.options[a]=b;this.determineSetValues(this.options.values)},positionForValue:function(a){if(this.options.logarithmic){var b=Math.log(this.options.min);a=(Math.log(a)-b)/((Math.log(this.options.max)-b)/1)}else a=this.options.useCustomDistribution?a>this.options.cutoff?Math.log(a-
this.options.cutoff)/this.options.exponent/this.options.expStepAmount*(1-this.options.cutoffPercentage)+this.options.cutoffPercentage:(a-this.options.min)/this.options.equalStepRange*this.options.cutoffPercentage:(a-this.options.min)/(this.options.max-this.options.min);return a.toFixed(5)},valueForPosition:function(a,b){if(this.options.logarithmic&&1!==a){var c=Math.log(this.options.min);a=Math.exp(c+(Math.log(this.options.max)-c)*a)}else a=this.options.useCustomDistribution&&1!==a&&0<a?a>this.options.cutoffPercentage?
this.options.cutoff+Math.exp((a*this.options.totalStepAmount-this.options.equalStepAmount)*this.options.exponent):1/this.options.cutoffPercentage*a*this.options.equalStepRange+this.options.min:this.options.min+(this.options.max-this.options.min)*a;a=this.trimAlignValue(a);0<b&&(a=Math.max(a,this.options.values[b-1]));b+1<this.handles.length&&(a=Math.min(a,this.options.values[b+1]));return a},drawActiveRange:function(){var a=!1,b=0,c=d(this.handles[this.handles.length-1]).css("left"),e=d(this.activeRange);
this.options.range&&(b=d(this.handles[0]).css("left"));if(c&&0<=c.indexOf("%")||b&&0<=b.indexOf("%"))a=!0;c=parseInt(c)-parseInt(b);e.css({left:b,width:(c||0)+(a?"%":"")});(1<this.handles.length?this.options.values[0]===this.options.min&&this.options.values[1]===this.options.max:this.options.values[0]===this.options.max)?e.addClass("fullRange"):e.removeClass("fullRange");this.markFilteredOutTimeLinePoints()},trimAlignValue:function(a){if(a<=this.options.min)return this.options.min;if(a>=this.options.max)return this.options.max;
var b;this.options.snapToValue?(b=10<this.options.step?this.options.step:10,b=Math.ceil(Math.pow(b,Math.floor(Math.log(a)/Math.log(b))-1))):b=0<this.options.step?this.options.step:1;var c=a%b;a-=c;2*Math.abs(c)>=b&&(a+=0<c?b:-b);a=parseFloat(a.toFixed(5));a=Math.min(a,this.options.max);return Math.max(a,this.options.min)}})})(jq||jQuery);
(function(d,a){d.createWidgetClass("slider.Slider",a.extend({},d.Widgets.Slider.prototype,{init:function(){var a=this;this.handles=this.element.children(".handle");this.activeRange=this.element.find(".activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(b){a.mouseDown(b);b.preventDefault();b.stopPropagation(!0)});this.handles.off("focus.sliderHandle").on("focus.sliderHandle",function(){a.focusHandler(1)});this.handles.off("blur.sliderHandle").on("blur.sliderHandle",
function(){a.focusHandler(0)});this.setHandleAttribute("valuemin",this.options.min);this.setHandleAttribute("valuemax",this.options.max);setTimeout(function(){var b=a.options.values;if(!b||1>b.length)b=a.options.range?[a.options.min,a.options.max]:[a.options.min];(b=a.determineSetValues(b))&&a.errorSetValues(b);a.setHandleAttribute("label",a.options.ariaLabel)},1)},focusHandler:function(a){this.handles.off("keydown.sliderHandle");this.handles.off("keyup.sliderHandle");if(a&&!this.element.hasClass("Disabled")){var b=
this;this.handles.on("keydown.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:a.preventDefault();b.keyMoveHandle(a,-1,1);break;case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault();b.keyMoveHandle(a,1,1);break;case 33:a.preventDefault();b.keyMoveHandle(a,1,5);break;case 34:a.preventDefault(),b.keyMoveHandle(a,-1,5)}});this.handles.on("keyup.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault(),
b.mouseUp(a),b.startValues=null}})}},keyMoveHandle:function(b,c,d){this.setupActiveHandle(b.target);var e=a(b.target).position().left/this.elementWidth,g=1/((this.options.max-this.options.min)/(null!==this.options.step?this.options.step:1));this.options.logarithmic&&(g=.01);c=this.valueForPosition(Math.min(this.elementWidth,Math.max(0,e+g*c*d)),this.activeHandleIndex);this.startValues||this.setStartValues();this.setActiveHandleValue(c);this.options.start(b,this.options.values);this.options.slide(b,
this.options.values)},mouseDown:function(){this.element.hasClass("Disabled")||d.Widgets.Slider.prototype.mouseDown.apply(this,arguments)},validateElement:function(){return this.element.hasClass("Common-Widgets-Slider-Slider")}}))})(R9,jQuery);(function(g,f){g.createComponentClass("common.results.filters.RangeFilterSlider","common.results.filters.Filter",{options:{formatValues:function(a){return a},displayFormat:"%s",min:void 0,max:void 0,snapToValue:!1,step:1,logarithmic:!1,useTextInput:!1,maxValueSlider:!1,onStop:f.noop,onSlide:void 0,onStart:void 0,onValidate:void 0,useAndUp:!1,andUpString:"",andUpMax:null,usesRangeDistribution:!1},minRange:void 0,maxRange:void 0,leftRange:void 0,rightRange:void 0,displayLabel:void 0,leftDisplay:void 0,
separatorDisplay:void 0,rightDisplay:void 0,andUpDisplay:void 0,andUpMin:void 0,textInputForm:void 0,textInputMin:void 0,textInputMax:void 0,textInputOpen:!1,widget:void 0,init:function(){this.displayLabel=this.getChildElement("rangeLabel");this.leftDisplay=this.element.find(".min");this.rightDisplay=this.element.find(".max");this.separatorDisplay=this.element.find(".sep");this.andUpDisplay=this.element.find(".andup");this.andUpMin=this.element.find(".minValue");this.andUpText=this.element.find(".andUpText")},
addEventHandlers:function(){var a=this;this.answer("RangeFilterSlider.init."+this.id(),function(b){for(var c in b)!b.hasOwnProperty(c)||null!==b[c]&&void 0!==b[c]||delete b[c];f.extend(a.options,b);return a});this.widget=this.getChildElement("sliderWidget").slider({range:!this.options.maxValueSlider,min:this.options.min,max:this.options.max,step:this.options.step,snapToValue:this.options.snapToValue,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,usesRangeDistribution:this.options.usesRangeDistribution}).getWidget();
this.minRange=this.options.min;this.maxRange=this.options.max;var c=function(b){a.options.maxValueSlider?a.setRightRange(b[0]):(a.setLeftRange(b[0]),a.setRightRange(b[1]))};this.widget.setOption("stop",function(b,d,e){e&&(a.setLastUserInteraction(!0),c(d));a.options.onStop(b,d,e)});this.widget.setOption("slide",function(b,d){if(b&&(c(d),"function"===typeof a.options.onSlide))a.options.onSlide(b,d)});this.options.useTextInput&&(this.textInputForm=this.getChildElement("textInputForm"),this.textInputMin=
this.getChildElement("minInput").find("input[type\x3dnumber]"),this.textInputMax=this.getChildElement("maxInput").find("input[type\x3dnumber]"),this.addTextInputHandlers());this.widget.setOption("start",function(b,c){if("function"===typeof a.options.onStart)a.options.onStart(b,c)});this.subscribe("results.filter.disablePriceGraph",function(){var b=a.getChildElement("sliderWidget"),c=b.children(".left"),b=b.children(".right");c.css("left","0%");b.css("left","100%");a.leftDisplay.html("---");a.rightDisplay.html("---");
a.leftDisplay.addClass("disabled");a.rightDisplay.addClass("disabled")});this.subscribe("results.filter.enablePriceGraph",function(){a.leftDisplay.removeClass("disabled");a.rightDisplay.removeClass("disabled")})},addTextInputHandlers:function(){var a=this;this.displayLabel.click(a.openTextInput.bind(a));this.textInputForm.submit(a.submitTextInput.bind(a));f("body").on("click.exceptPriceFilter",function(b){!a.textInputOpen||0<f(a.element).find(f(b.target)).length||(a.textInputForm.trigger("submit"),
a.closeTextInput())});var c={9:function(b){b.target&&f(b.target).is(a.textInputMin)?a.textInputMax.focus():a.closeTextInput()},13:function(){a.textInputForm.trigger("submit")},27:function(){a.closeTextInput()}};this.textInputForm.keydown(function(a){"function"===typeof c[a.keyCode]&&(c[a.keyCode](a),a.preventDefault())})},setMinRange:function(a){this.minRange=a;this.options.min=a;this.widget.setOption("min",a);this.widget.setHandleAttribute("valuemin",a,0)},setMaxRange:function(a){this.maxRange=a;
this.options.max=a;this.widget.setOption("max",a);this.widget.setHandleAttribute("valuemax",a,1)},setUsesRangeDistribution:function(a){this.options.usesRangeDistribution=a;this.widget.setOption("usesRangeDistribution",a)},setLeftRange:function(a,c){this.leftRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},setRightRange:function(a,c){this.rightRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},isLeftRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.minRange!==
a[0]},isRightRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.maxRange!==a[1]},reset:function(){this.setLeftRange(this.minRange);this.setRightRange(this.maxRange)},clearState:function(){this.leftRange=this.rightRange=this.minRange=this.maxRange=void 0},validateValues:function(a){if("function"===typeof this.options.onValidate)return this.options.onValidate(a);var c=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!c?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:
!1},updateDisplay:function(a,c){var b=this.options.formatValues([this.leftRange,this.rightRange],this),d=b[0],b=b[1],e=this.options.displayFormat;if("function"===typeof e)d=e(d,!0),b=e(b,!1);else if("string"===typeof e)d=e.format(d),b=e.format(b);else throw"Must pass a valid display formula [function || string]";this.leftDisplay.html(d);this.options.useAndUp&&this.andUpMin.html(d);this.rightDisplay.html(b);this.options.useAndUp&&(this.rightRange==this.maxRange?(this.rightDisplay.hide(),this.separatorDisplay.hide(),
this.leftDisplay.hide(),this.andUpDisplay.show()):(this.andUpDisplay.hide(),this.leftDisplay.show(),this.separatorDisplay.show(),this.rightDisplay.show()),this.options.andUpMax&&(this.leftRange>this.options.andUpMax?this.andUpText.hide():this.andUpText.show()));e=[this.leftRange,this.rightRange];this.options.maxValueSlider&&(e[0]=this.rightRange);this.widget.setHandleAttribute("valuetext",this.options.maxValueSlider?b:d,0);this.widget.setHandleAttribute("valuetext",b,1);a&&(c&&c.useCustomDistribution?
this.widget.setCustomDistribution(c):c&&!1===c.useCustomDistribution&&this.widget.resetCustomDistribution(),this.widget.setValues(e));this.textInputForm&&this.updateTextInput(e)},openTextInput:function(a){if(this.textInputForm&&!(1>this.textInputForm.length)){var c=f(a.target).is(".max")?this.textInputMax:this.textInputMin;this.resetTextInput();this.textInputForm.removeClass("hidden");this.displayLabel.addClass("hidden");this.textInputOpen=!0;setTimeout(function(){c.focus()},10)}},closeTextInput:function(){!this.textInputForm||
1>this.textInputForm.length||(this.displayLabel.removeClass("hidden"),this.textInputForm.addClass("hidden"),this.textInputOpen=!1)},receiveMaxValue:function(a){a=[this.options.min,Math.round(Number(a))];if(!this.validateValues(a))return this.resetTextInput(),!1;this.widget.options.stop(null,a,a[0]!==this.leftRange||a[1]!==this.rightRange)},submitTextInput:function(a){a.preventDefault();var c=Math.round(Number(this.textInputMin.val())),b=Math.round(Number(this.textInputMax.val())),c=[c,b];if(!this.validateValues(c))return this.resetTextInput(),
!1;this.widget.options.stop(a,c,c[0]!==this.leftRange||c[1]!==this.rightRange);this.closeTextInput();return!1},updateTextInput:function(a){this.textInputMin.val(a[0]).attr("min",this.minRange).attr("max",a[1]);this.textInputMax.val(a[1]).attr("min",a[0]).attr("max",this.maxRange)},resetTextInput:function(){this.textInputMin.val(this.leftRange);this.textInputMax.val(this.rightRange)},destroy:function(){this.base();f("body").off("click.exceptPriceFilter")}})})(window.R9,window.jQuery);(function(e,n){e.createComponentClass("common.results.filters.SimpleRangeFilter","common.results.filters.Filter",{options:{min:void 0,max:void 0,step:1,snap:!1,maxValueSlider:!1,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",duration:!1,durationFormat:"",logarithmic:!1,useTextInput:!1,isMultiValueSet:null,triggerFilteredLabel:!1,useAndUp:!1,andUpString:""},leftRange:null,rightRange:null,minRange:null,maxRange:null,slider:void 0,sliding:!1,init:function(){this.base();this.eventPrefix=
"filters.%s.".format(this.options.name);this.initSliderComponents()},getFormatFcn:function(){return this.options.duration?this.formatDuration.bind(this):this.formatThousands.bind(this)},initSliderComponents:function(){var a=this,b=this.getFormatFcn();this.slider=e.question.ask("RangeFilterSlider.init."+this.id("slider"),{step:this.options.step,snapToValue:this.options.snap,maxValueSlider:this.options.maxValueSlider,displayFormat:this.options.displayFormat,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,
triggerFilteredLabel:this.options.triggerFilteredLabel,useAndUp:this.options.useAndUp,andUpString:this.options.andUpString,formatValues:function(a){return a.map(b)},onStart:function(){a.sliding=!0},onStop:function(b,c,e){a.logUserInteraction(null,b,e);e&&(b={},a.options.maxValueSlider?(a.rightRange=c[0],b.field="right"):(b.field=a.leftRange!==c[0]?"left":"right",a.leftRange=c[0],a.rightRange=c[1]),b.value=a[-1<b.field.indexOf("left")?"leftRange":"rightRange"],a.setLastUserInteraction(!0),a.pushStateChange(null,
{changeData:b}));a.sliding=!1;a.publishHoverState(!1)}});this.addSliderEventHandlers()},addEventHandlers:function(){this.base();var a=this;this.subscribe(this.eventPrefix+"resetitem",function(a){e.events.publish("filter.reset",{name:a})});this.subscribe(this.eventPrefix+"setMaxValue",function(b){a.receiveMaxValue(b.minValue)});this.subscribe(this.eventPrefix+"updateRange",this.updateRange.bind(this))},receiveMaxValue:function(a){this.slider.receiveMaxValue(a)},updateRange:function(a){if(a){var b=
!1;a.leftRange&&a.leftRange>this.slider.minRange&&(this.leftRange=a.leftRange,b=!0);a.rightRange&&a.rightRange<this.slider.maxRange&&(this.rightRange=a.rightRange,b=!0);b&&this.pushStateChange()}},addSliderEventHandlers:function(){var a=this;this.slider.element.on("mouseenter",this.publishHoverState.bind(this,!0));this.slider.element.on("mouseleave",function(){a.sliding||a.publishHoverState(!1)});this.subscribe("sliders.redraw",function(){e.dom.schedule(function(){a.slider.widget.drawActiveRange()})})},
destroy:function(){this.base();this.slider=void 0},logUserInteraction:function(a,b,d){if("ga"===this.options.loggingType){a="reset"===a?"showall":"";var c=null!=this.options.loggingAction?this.options.loggingAction:this.name;d&&(a=n(b.target).hasClass("right")?"max-adjust":"min-adjust");this.base({category:this.trackCategory,action:c,label:this.options.loggingLabel||a})}else this.base(a)},setDisabled:function(a){this.base(a);e.dom.toggleOneClass(this.slider.widget.element,"Disabled",a)},shouldBeVisible:function(a){return!(isNaN(parseInt(a.minRange))||
isNaN(parseInt(a.maxRange)))},willReset:function(){this.slider.setLeftRange(this.slider.minRange,!0);this.slider.setRightRange(this.slider.maxRange,!0)},cleanupExistingState:function(){this.slider.leftRange=this.slider.rightRange=this.slider.minRange=this.slider.maxRange=void 0},update:function(a){var b=this,d=parseInt(a.minRange),c=parseInt(a.maxRange),g=parseInt(a.leftRange),f=parseInt(a.rightRange),h=null===this.slider.leftRange||void 0===this.slider.leftRange||void 0===this.slider.minRange||this.slider.leftRange===
this.slider.minRange,k=null===this.slider.rightRange||void 0===this.slider.rightRange||void 0===this.slider.maxRange||this.slider.rightRange===this.slider.maxRange,l=!0,m=!0;isNaN(d)||isNaN(c)||(this.options.maxValueSlider&&d!==this.slider.leftRange&&(h=!0),this.options.maxValueSlider&&f!=this.slider.rightRange&&e.config.getBoolean("ui.maxValueSlider.fix",!0)&&(k=!0),this.minRange=d,this.maxRange=c,isNaN(g)?h?this.leftRange=d:l=!1:this.leftRange=g,isNaN(f)?k?this.rightRange=c:m=!1:this.rightRange=
f,e.dom.schedule(function(){b.options.collapsible||(a.updateTitle?b.getChildElement("title").html(b.options.title2):b.getChildElement("title").html(b.options.title));b.slider.setMinRange(b.minRange);b.slider.setMaxRange(b.maxRange);l&&b.slider.setLeftRange(b.leftRange,!0);m&&b.slider.setRightRange(b.rightRange,!0);b.element.removeClass("empty")}))},getState:function(){var a={max:this.rightRange};this.options.maxValueSlider||(a.min=this.leftRange);return a},getStateForFilterHistory:function(){var a=
{};this.slider.isRightRangeManipulated()&&(a.max=this.rightRange);!this.options.maxValueSlider&&this.slider.isLeftRangeManipulated()&&(a.min=this.leftRange);return{displayName:this.options.title,type:e.question.ask("filters.FilterHistory.type.slider"),subType:this.getHistoryFilterViewSubtype(),state:a,displayValue:{min:a.min&&this.formatValues([a.min]),max:a.max&&this.formatValues([a.max])}}},formatThousands:function(a){if("undefined"===typeof a||null===a)return a;var b=this.options.thousandsDelimiter,
d=this.options.decimalDelimiter,c=a.toString().split(".");a=c[0];d=1<c.length?d+c[1]:"";c=/(\d+)(\d{3})/;if(0<b.length)for(;c.test(a);)a=a.replace(c,"$1"+b+"$2");return a+d},formatDuration:function(a){var b=a%60;10>b&&(b="0"+b);return e.Common.Utils.String.replaceArgs(this.options.durationFormat,(a-b)/60,b)},getHistoryFilterViewState:function(a){var b=this.getState(),d=!1,c=!1,e=function(a,b){a()?(null==c&&(c=!0),d=!1):b()&&null==d&&(d=!0)};a.min&&a.max?e(function(){return b.max>a.max&&b.min&&b.min<
a.min},function(){return b.min&&a.min==b.min&&a.max==b.max}):a.min?e(function(){return b.min<a.min&&a.min<b.max},function(){return b.min==a.min}):a.max&&e(function(){return b.max>a.max&&a.max>b.min},function(){return b.max==a.max});return{isAlreadyApplied:d,disabled:!c}},setStateFromPrevious:function(a){var b="left"===a.key;a=a.reset?b?this.slider.minRange:this.slider.maxRange:parseInt(a.value);var d=this.slider.widget.getValues();b?(this.slider.setLeftRange(a),this.leftRange=d[0]=a):(this.slider.setRightRange(a),
this.rightRange=d[1]=a);this.slider.widget.setValues(d)},updatePreviousFilters:function(a){a?(a.hasOwnProperty("min")&&this.previousFilters.hasOwnProperty("left")&&this.previousFilters.left!==a.min&&this.removePreviousFilter("left"),a.hasOwnProperty("max")&&this.previousFilters.hasOwnProperty("right")&&this.previousFilters.right!==a.max&&this.removePreviousFilter("right")):this.removePreviousFilter()},getHistoryFilterViewSubtype:function(){return e.question.ask("filters.FilterHistory.type.numeric")},
formatValues:function(a){var b=this;return a.map(function(a){return b.formatDuration(a)})}})})(R9,jQuery);(function(d,f){d.createComponentClass("common.results.filters.FilterSection",{filters:void 0,numDirtyFilters:0,options:{filters:[],collapsible:!1,collapsed:!1,filteredLabelTargets:null,collapsibleFiltersEnabled:!1,useFilterLabelHidesReset:!1,onFilterDirtySkipNonDirtyCheck:!0},resetLink:void 0,init:function(){this.resetLink=this.getChildElement("reset");this.title=this.getChildElement("title");this.content=this.getChildElement("content")},inlineComponentsReady:function(){this.filterDOMIds=f.map(this.element.find(".Common-Results-Filters-Filter"),
function(a){return a.id});this.options.collapsible&&!this.options.collapsed&&this.element.addClass("open")},addEventHandlers:function(){var a=this;this.subscribe("search.startSearch",function(b){"undefined"!==typeof b&&b.preserveFilters||a.element.addClass("inactive")});this.resetLink.click(function(b){b.stopPropagation();a.resetAll()});this.resetLink.keydown(function(b){switch(b.which){case d.globals.keyCodes.RETURN:case d.globals.keyCodes.SPACE:b.preventDefault(),a.resetLink.click()}});this.dedupeSubscribe("filter.dirty",
"dirty",function(b){b?(a.options.collapsibleFiltersEnabled&&a.element.addClass("open"),a.resetHiddenByLabel||a.resetLink.show(),a.resetWasDirty=!0):(a.resetLink.hide(),a.resetWasDirty=!1)});this.dedupeSubscribe("filter.enabled","enabled",function(b){a.toggleFilterSection({visible:b})});this.subscribe("filters.disabled",function(b){b&&a.resetLink.hide()});this.subscribe("filter.label.update",this.onFilterLabelUpdate.bind(this));var c=this.getChildElement("skip");c.length&&c.click(function(b){b=f("[tabbable]:visible");
var c=b.index(a.element)+1;c>=b.length&&(c=0);b.eq(c).get(0).focus()});this.subscribe("filter.dirty",this.onFilterDirty.bind(this));this.options.filters.forEach(function(b){a.subscribe("filters.changed",{name:b},a.onPushedStateChange.bind(a))});if(this.options.collapsible){var e=function(){var b=a.element.hasClass("open")?"hide":"show";d.Analytics.api.trackEvent({category:"Filter-Collapsible",action:b,label:a.options.filters.join(",")});a.element.toggleClass("open");a.title.attr("aria-pressed","show"===
b);a.title.attr("aria-expanded","show"===b);d.globals.testMode&&a.title.attr("data-test-filter-collapsed","show"===b);d.events.publish("horizon.filters.opened")};this.title.click(e);this.title.keypress(function(a){a.keyCode!==d.globals.keyCodes.RETURN&&a.keyCode!==d.globals.keyCodes.SPACE||e()})}},resetAll:function(a){var c=this;this.options.filters.forEach(function(e){c.skipFilter(e)||(e={name:e},a&&(e.type="showAll"),d.events.publish("filter.reset",e))});this.resetLink.hide()},onFilterDirty:function(a){!(this.options.onFilterDirtySkipNonDirtyCheck&&
a&&a.hasOwnProperty("dirty")&&!1===a.dirty)&&0<=this.options.filters.indexOf(a.name)&&(this.numDirtyFilters+=a.dirty?1:0,this.element.toggleClass("isDirty",0<this.numDirtyFilters))},onPushedStateChange:function(a){var c=a.elemId;a=a.reset;this.numDirtyFilters=0;0<=this.filterDOMIds.indexOf(c)&&this.element.toggleClass("isDirty",!a)},dedupeSubscribe:function(a,c,e){var b=null,d=null,f=this;this.options.filters.forEach(function(g){f.subscribe(a,{name:g},function(a){f.skipFilter(g)||(!d&&a[c]&&(d=!0),
clearTimeout(b),b=setTimeout(function(){e(d);d=null},100))})})},onFilterLabelUpdate:function(a){var c=this.options.filteredLabelTargets&&this.options.filteredLabelTargets.length?this.options.filteredLabelTargets:this.options.filters;a&&a.name&&c&&c.indexOf&&!(0>c.indexOf(a.name))&&this.options.useFilterLabelHidesReset&&this.resetLink&&this.resetLink.length&&(this.subscribe("filter.label.cleared."+a.name,this.onFilterLabelCleared.bind(this)),this.resetHiddenByLabel=!0,this.resetLink.is(":visible")&&
(this.resetWasDirty=!0),this.resetLink.hide())},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.resetHiddenByLabel=!1;this.resetWasDirty&&(this.resetWasDirty=!1,this.resetLink.show())},toggleFilterSection:function(a){this.element.toggleClass("inactive",!a.visible)},skipFilter:function(a){return!1}})})(window.R9,window.jQuery);(function(b){b.createComponentClass("flights.results.filters.StopsFilter","common.results.filters.ValueSetFilter",{addEventHandlers:function(){this.base();var c=this;this.answer("filters.stops.hasNonStop",function(){var a=c.getRenderedFilterOptions();return a.hasOwnProperty("0")&&!a["0"].state.disabled});b.config.getBoolean("ui.horizontal-filters.stickybar.enabled",!1)&&b.events.subscribe("common.results.filters.StopsFilterExposed.setfilter",this.updateExposedStops.bind(this));b.config.getBoolean("ui.filters.StopsFilterRadioSet.enabled",
!1)&&(c=this,b.events.subscribe("common.results.filters.StopsFilterRadioSet.setfilter",function(a){if(!1!==c.interactable){var d=c.getRenderedFilterOptions();a=a||"";-1<a.indexOf("uptoonestop")&&("undefined"!==typeof d[0].state.disabled&&!0===d[0].state.disabled?d[1].setChecked(2,"only"):(d[0].setChecked(1,"select"),d[1].setChecked(1,"select"),"undefined"!==typeof d[2]&&d[2].setChecked(0,"unselect")));-1<a.indexOf("direct")&&(d[0].setChecked(1,"only"),d[1].setChecked(0,!1),"undefined"!==typeof d[2]&&
d[2].setChecked(0,!1));-1<a.indexOf("any")&&b.events.publish("filter.reset",{name:"stops"})}}))},update:function(c){this.base(c);var a=!1;this.forEachItem(function(c,b){if("0"===c){if(1===b.state.selected||2===b.state.selected)a=!0}else if(1===b.state.selected||2===b.state.selected)a=!1},a);this.disableLayover(a);b.config.getBoolean("ui.horizontal-filters.stickybar.enabled",!1)&&b.events.publish("common.results.filters.StopsFilterExposed.state",this.makeDataFrom(c));b.events.publish("common.results.filters.StopsFilterRadioSet.state",
this.makeDataFrom(c))},disableLayover:function(c){b.events.publish("filter.disabled",{name:"layoverdur",disabled:c})},updateExposedStops:function(c){var a=this.getRenderedFilterOptions();"uptoonestop"===c&&("undefined"!==typeof a[0].state.disabled&&!0===a[0].state.disabled?a[1].setChecked(2,"only"):(a[0].setChecked(1,"select"),a[1].setChecked(1,"select"),"undefined"!==typeof a[2]&&a[2].setChecked(0,!1)),b.Analytics.api.trackEvent("filters/stops/exposed/uptoonestop"));"nonstop"===c&&(a[0].setChecked(1,
"only"),a[1].setChecked(0,!1),"undefined"!==typeof a[2]&&a[2].setChecked(0,!1),b.Analytics.api.trackEvent("filters/stops/exposed/nonstoponly"));"anystops"===c&&(a[0].setChecked(1,"select"),a[1].setChecked(1,"select"),"undefined"!==typeof a[2]&&a[2].setChecked(1,"select"),b.Analytics.api.trackEvent("filters/stops/exposed/anystops"))},makeDataFrom:function(c){var a={},b={},f={};this.forEachItem(function(d,e){a[d]=e.state.selected;b[d]="undefined"!==typeof c.valueMap[d].minPrice&&null!==c.valueMap[d].minPrice?
c.valueMap[d].minPrice:e.state.minPrice;f[d]=e.state.disabled});return{state:a,minPrice:b,disabled:f}}})})(R9);(function(d){R9.extend("Widgets",{RadiobuttonSet:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!b||b.dontValidate||this.validateElement())this.options=d.extend({},this.options,b),this.init()}});R9.extend("Widgets.RadiobuttonSet",{isRadiobuttonSet:function(a){return a&&a.nodeName&&"span"===a.nodeName.toLowerCase()},isWidgetControlled:function(a){return d(a).hasClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass)},findLabelNode:function(a){return document.getElementById(a.id+
"-label")},findRadiobuttonSetNode:function(a){return null!=a?a.parentNode:null},refresh:function(a){var b=!1;a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).each(function(){var a=d(R9.Widgets.RadiobuttonSet.findLabelNode(this)),e=d(this);e.prop("checked")?(b=!0,a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked")):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked");e.prop("disabled")?a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+
"-label-disabled"):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-disabled")});b||(a=a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).first(),a.prop("checked",!0),d(R9.Widgets.RadiobuttonSet.findLabelNode(a[0])).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked"))},applyCallback:function(a,b,c,e){a&&(d.isFunction(a)?a.apply(b,c):(a=a[e.target.value],d.isFunction(a)&&a.apply(b,c)))}});R9.extend("Widgets.RadiobuttonSet.prototype",
{widgetName:"radiobuttonset",widgetBaseClass:"r9-radiobuttonset",elementNode:null,element:null,options:{change:null,click:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.handleElementClickEvent);this.element.data(this.widgetName,this);R9.Widgets.RadiobuttonSet.refresh(this.element)},bindInputEvent:function(a,b){var c="input."+
this.widgetBaseClass;a+="."+this.widgetName;var d=this;this.element.off(a,c).on(a,c,function(a){b.call(d,this,R9.Widgets.RadiobuttonSet.findLabelNode(this),a)})},validateElement:function(){return R9.Widgets.RadiobuttonSet.isRadiobuttonSet(this.elementNode)&&R9.Widgets.RadiobuttonSet.isWidgetControlled(this.element)&&void 0===this.element.data(this.widgetName)},handleElementFocusEvent:function(a,b,c){a.disabled||d(b).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementBlurEvent:function(a,
b,c){a.disabled||d(b).removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementChangeEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.change,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))},handleElementClickEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.click,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))}})})(jq||jQuery);
(function(d){R9.createWidgetClass("radio.StyleJamRadioButtonSet",d.extend({},R9.Widgets.RadiobuttonSet.prototype,{currentRadio:null,isTabList:!1,init:function(a){setTimeout(this.refresh.bind(this),1);this.currentRadio=this._getLabelForButton(this._getButtons().filter(":checked"));this.isTabList="tablist"===this.element.attr("role")},refresh:function(){R9.Widgets.RadiobuttonSet.refresh(this.element);var a=this.getEnabledRadios().filter("[aria-checked\x3dtrue]");a.length&&this.element.attr("aria-activedescendant",
a.attr("id"));this.focusRadio();this.isTabList&&window.setTimeout(function(){var a=this.getCheckedButton();this._getButtons().attr("aria-selected",!1);a.attr("aria-selected",!0);this._setActiveTabPanel(a)}.bind(this),1)},addEventHandlers:function(a){this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.onClick);this.element.on("focus",this.onFocus.bind(this));this.element.on("blur",this.onBlur.bind(this));this.element.on("keydown",this.onKeyDown.bind(this))},
onClick:function(a,b,c){this.handleElementClickEvent(a,b,c);this.isTabList&&this._getButtons().each(function(b,c){a===c&&this._setButtonCheckedById(c.id)}.bind(this));this.focusRadio()},focusRadio:function(a){a&&a.length||(a=this._getLabelForButton(this._getButtons().filter(":checked")));a.length&&(this.element.attr("aria-activedescendant",a.attr("id")),this.handleActiveLabel(a),a.attr("aria-checked","false"!==a.attr("aria-checked")),this.currentRadio=a)},getAllRadios:function(){return this.element.find("label")},
getEnabledRadios:function(){return this.element.find("label").filter('[data-is-label-disabled\x3d"false"]')},focusButtonSet:function(){this.getChildElement("set").focus()},onFocus:function(){var a=this.element.attr("aria-activedescendant");"undefined"===typeof a&&0<this.getEnabledRadios().length&&(a=this.getEnabledRadios().get(0).id);a&&this.focusRadio(d("#"+a));this.element.addClass("focused")},onBlur:function(){this.element.removeClass("focused")},onKeyDown:function(a){switch(a.which){case R9.globals.keyCodes.SPACE:this.checkCurrentRadio();
break;case R9.globals.keyCodes.UP:case R9.globals.keyCodes.LEFT:this.focusPreviousRadio();break;case R9.globals.keyCodes.DOWN:case R9.globals.keyCodes.RIGHT:this.focusNextRadio();break;default:return!0}return!1},checkCurrentRadio:function(){this.currentRadio&&this.checkRadio(this.currentRadio)},focusPreviousRadio:function(){var a=this.getPrevButtons(),b=this.getEnabledRadios(),a=a.length?d(a.get(0)):d(b.get(b.length-1));this.checkRadio(a)},focusNextRadio:function(){var a=this.getNextButtons(),a=a.length?
d(a.get(0)):d(this.getEnabledRadios().get(0));this.checkRadio(a)},checkRadio:function(a){a.click();this.currentRadio.attr("aria-checked",!1);this.focusRadio(a);this.currentRadio.attr("aria-checked",!0)},getCheckedButton:function(){var a=this._getButtons().get(0);this._getButtons().get().some(function(b){if(!0===d(b).prop("checked"))return a=b,!0});return d(a)},getPrevButtons:function(){return this.currentRadio.prevAll("label:visible")},getNextButtons:function(){return this.currentRadio.nextAll("label:visible")},
getCheckedPair:function(){var a=this.getCheckedButton();return{value:a.val(),title:this._getLabelForButton(a).attr("title")}},isButtonChecked:function(a){return!0===this._getButtonByValue(a).prop("checked")},isButtonEnabled:function(a){return!1===this._getButtonByValue(a).prop("disabled")},getRadioButtonAmount:function(){return this.element.find("input").length},getValue:function(){return this.getCheckedButton().val()},setValue:function(a){this.setButtonCheckedByValue(a)},setInnerLabelText:function(a,
b){this._getInnerLabelByValue(a).text(b)},setButtonCheckedByValue:function(a){this._setButtonChecked(function(b){return b.val()===a})},setButtonEnabledByValue:function(a,b){this._setButtonEnabled(function(b){return b.val()===a},b)},_setButtonCheckedById:function(a){this._setButtonChecked(function(b){return b.attr("id")===a})},_setButtonEnabledById:function(a,b){this._setButtonEnabled(function(b){return b.attr("id")===a},b)},_setButtonChecked:function(a){var b=this;this._getButtons().each(function(c,
e){c=d(e);e=!!a(c);c.prop("checked",e);c.attr("aria-checked",e);b.handleActiveLabel(b.getAllRadios().filter("[for\x3d'"+c.attr("id")+"']"))});this.refresh()},_setButtonEnabled:function(a,b){var c=this;this._getButtons().each(function(){var e=d(this);!0===a(e)&&(e.prop("disabled",!1===b),e.attr("aria-disabled",!1===b),c.handleDisabledLabel(c.getAllRadios().filter("[for\x3d'"+e.attr("id")+"']"),b))});this.refresh()},_setActiveTabPanel:function(a){a=d("[id\x3d'%s']".format(a.attr("aria-controls")));
a.length&&(this._getButtons().get().reduce(function(a,c){c=d(c).attr("aria-controls");return a.add(d("[id\x3d'%s']".format(c)))},d()).attr("aria-expanded",!1),a.attr("aria-expanded",!0))},_getButtons:function(){return this.element.find("input."+this.widgetBaseClass)},_getButtonByValue:function(a){return this._getButtons().filter('[value\x3d"'+a+'"]')},_getInnerLabelByValue:function(a){return this._getLabelForButton(this._getButtonByValue(a)).find(".js-inner-label")},_getLabelForButton:function(a){return a.next(".js-label")},
handleActiveLabel:function(a){this.getAllRadios().attr("aria-checked",!1);R9.dom.swapClasses(this.getAllRadios(),a.data("active-state"),a.data("default-state"));R9.dom.swapClasses(a,a.data("default-state"),a.data("active-state"))},handleDisabledLabel:function(a,b){a.attr("data-is-label-disabled",!b);b?R9.dom.swapClasses(a,a.data("disabled-state"),a.data("default-state")):R9.dom.swapClasses(a,a.data("default-state"),a.data("disabled-state"))},addNewRadioButton:function(a,b,c,d,g,k,h){if(a){var e=this.element.find("input").first().clone(),
f=this.element.find("label").first().clone();e.attr("id",a);f.attr("id",a+"-label");f.attr("for",a);b&&e.attr("value",b);c&&e.attr("name",c);g&&f.attr("title",g);d&&f.find(".label-text").text(d);this.element.append(e,f);h&&this._setButtonEnabledById(a,h);k&&this._setButtonCheckedById(a);this.refresh()}},deleteRadioButtonByValue:function(a){if(a&&(a=this.element.find("input[value\x3d"+a+"]"))){var b=this.element.find("label[id\x3d"+a.attr("id")+"-label]");d(a).remove();b&&b.remove();this.refresh()}}}))})(jQuery);(function(g,f){var m=JSON.parse('{"legs":[{"cutoffPercentage":0.7,"leftRange":110,"useCustomDistribution":true,"ranges":[{"min":110,"max":144,"minPrice":128.09,"count":4},{"min":144,"max":178,"minPrice":161.8,"count":15},{"min":178,"max":212,"minPrice":200.59,"count":7},{"min":212,"max":246,"minPrice":232.36,"count":16},{"min":246,"max":280,"minPrice":261.16,"count":17},{"min":280,"max":314,"minPrice":301.32,"count":11},{"min":314,"max":348,"minPrice":322.96,"count":26},{"min":348,"max":382,"minPrice":358.16,"count":36},{"min":382,"max":416,"minPrice":414.54,"count":19},{"min":416,"max":450,"minPrice":432.79,"count":18},{"min":450,"max":484,"minPrice":464.27,"count":7},{"min":484,"max":518,"minPrice":555.09,"count":7},{"min":518,"max":552,"minPrice":594.41,"count":6},{"min":552,"max":556,"minPrice":-1,"count":0},{"min":556,"max":567,"minPrice":661.45,"count":1},{"min":567,"max":612,"minPrice":665.27,"count":5},{"min":612,"max":788,"minPrice":700.47,"count":11},{"min":788,"max":1479,"minPrice":857.45,"count":7}],"isUserManipulated":false,"maxRange":1479,"rightRange":1479,"maxCount":36,"enabled":true,"isDirty":false,"isFiltering":false,"maxIndex":0,"minIndex":0,"maxPrice":857.45,"cutoff":552,"updateTitle":false,"minRange":110,"exponent":1.366390713113171}],"isUserManipulated":false,"maxPrice":[857.45],"filteredResults":213}');
g.createComponentClass("common.results.filters.SimpleRangeGraphFilter","common.results.filters.Filter",{Graph:null,legs:void 0,legCount:1,filteredResults:null,options:{showOutliers:!1,outlierDeviation:18,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",showGraphOverlay:!1,activeLeg:-1,yAxisDisplay:"count",min:void 0,max:void 0,step:1,useTextInput:!1,triggerFilteredLabel:!1,showYLines:!1,graphHeight:72,xAxisSteps:0,yAxisTicks:0,hasCursor:!1,minimumResults:0,forceHideGraph:!1,forceDisableOnSingleResult:!0,
disableOnSingle:!0,usePlaceholderData:!1,showCurrencyCodes:!1,isRtl:!1},textInput:null,init:function(){this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.eventPrefix="filters.%s.".format(this.options.name)},inlineComponentsReady:function(){this.base();var a=this;this.element.find(".graphFilterSection").each(function(b){a.legs[b]={slider:g.question.ask("RangeFilterSlider.init."+
a.id("slider-"+b),{min:a.options.min,max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(c,d){return a.sliderDidStart(b,d)},onSlide:function(c,d){return a.sliderDidSlide(b,d)},onStop:function(c,d,e){a.publishHoverState(!1,{leg:b});d={};var h=a.legs[b].slider;h&&(d.field=(f(c.target).hasClass("left")?"left":"right")+b,d.value=h[-1<d.field.indexOf("left")?
"leftRange":"rightRange"]);return a.sliderDidStop(b,e,{changeData:d})},onValidate:function(b){return a.validateValues(b)}}),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:f(this)}});this.options.usePlaceholderData&&(this.update(m),this.showGraph(0))},addEventHandlers:function(){this.base();this.subscribe(this.eventPrefix+"resetitem",this.reset.bind(this))},formatValues:function(a){var b=this;return a.map(function(a){return"undefined"===typeof a?a:g.Common.Utils.formatOptionalPrice(Math.round(a),
!0,b.options.showCurrencyCodes)})},update:function(a){var b=this;a&&(a.hasOwnProperty("filteredResults")&&(this.filteredResults=a.filteredResults),a.legs?a.legs.forEach(b.updateLeg.bind(b)):this.updateLeg(a,0),a.sectionLabels?a.sectionLabels.forEach(function(a,d){b.legs[d].label.html(a)}):1===b.legs.length&&(b.legs[0].label.html(this.options.title),b.legs[0].label.addClass("only-label")),this.disabledPriceGraphFilter(a))},updateLeg:function(a,b){this.updateLegSlider(a,b);this.legs[b].ranges=a;this.legs[b].graph=
void 0;var c=this.lookupGraphYKeys(this.options.yAxisDisplay);(c=a[c.max])&&c.length?this.legs[b].maxYVal=c[b]:f.isArray(c)||(this.legs[b].maxYVal=c);this.showGraph(b);this.updateGraph(b,[parseInt(a.leftRange),parseInt(a.rightRange)])},validateValues:function(a){var b=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!b?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:!1},willReset:function(){this.legs.forEach(function(a){a.slider.reset()})},lookupGraphYKeys:function(a){var b={count:{value:"count",
max:"maxCount"},price:{value:"minPrice",max:"maxPrice"}};return"string"===typeof a&&b[a]?b[a]:b.count},updateLegSlider:function(a,b){var c=this.legs[b].slider,d=parseInt(a.minRange),e=parseInt(a.maxRange),h=parseInt(a.leftRange),f=parseInt(a.rightRange),n=void 0===c.leftRange||void 0===c.minRange||c.leftRange===c.minRange,p=void 0===c.rightRange||void 0===c.maxRange||c.rightRange===c.maxRange;if(!isNaN(d)&&!isNaN(e)){c.setMinRange(d);c.setMaxRange(e);this.minRange=d;this.maxRange=e;isNaN(h)?n&&c.setLeftRange(c.minRange,
!0):c.setLeftRange(h,!0);isNaN(f)?p&&c.setRightRange(c.maxRange,!0):c.setRightRange(f,!0);c.updateDisplay(!0,a);var l=this;g.dom.schedule(function(){l.getChildElement("section-"+b).removeClass("hidden");l.getChildElement("legToggle").find("[name\x3d%s]".format(b+1)).addClass("active");l.element.removeClass("hidden")})}},getValuesFromRanges:function(a){var b=[];a.forEach(function(a,d,e){b[d]=a.min;e.length===d+1&&(b[d+1]=a.max)});return b},sliderDidStop:function(a,b,c){b&&(this.pushStateChange(null,
c),this.updateFilterHistory(),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidSlide:function(a,b){void 0!==this.legs[a].graph&&this.updateGraph(a,b)},sliderDidStart:function(a){this.isGraphable(a)&&this.updateGraph(a,this.legs[a].slider.widget.options.values)},getLegResultCount:function(a){var b=0;a.forEach(function(a){b+=a.count});return 1E4<b?null:b},calculateRangeMean:function(a,b){var c=0;a.forEach(function(a){c+=a.max*a.count});return c/b},calculateRangeStdDev:function(a,
b,c){var d=0,e=0;a.forEach(function(a){e=a.max*a.count;d+=(e-c)*(e-c)/b});return Math.sqrt(d/b)},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+a).html(this.generateGraph(a,b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").addClass("open");this.filteredResults>=this.options.minimumResults&&!this.options.forceHideGraph?this.legs[a].graph.removeClass("force-hidden"):this.legs[a].graph.addClass("force-hidden")},
getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};b.min=a.slider.leftRange.toString();b.max=a.slider.rightRange.toString();return b})}},updateGraph:function(a,b){this.legs[a].graph.find(".bars .bar").each(function(){var a=parseInt(f(this).data("boundary"));b[0]>a||b[1]<a?f(this).addClass("inactive"):f(this).removeClass("inactive")})},isGraphable:function(a){if(!this.legs[a]||
!this.legs[a].ranges||!this.legs[a].ranges.ranges)return!1;a=this.legs[a].ranges.ranges;var b=2>a.length,c=!1,d=!1;if(!this.options.showOutliers){var e=this.getLegResultCount(a);e?c=this.getHasOutliers(a,e):d=!0}return!b&&!c&&!d},getHasOutliers:function(a,b){var c=this.calculateRangeMean(a,b);a=this.calculateRangeStdDev(a,b,c);return(this.maxRange-c)/a>this.options.outlierDeviation},generateGraph:function(a,b){return(new this.Graph({minRange:b.minRange,maxRange:b.maxRange,yKey:this.lookupGraphYKeys(this.options.yAxisDisplay).value,
yMax:this.legs[a].maxYVal,ranges:b.ranges,showYLines:this.options.showYLines,height:this.options.graphHeight,xAxisSteps:this.options.xAxisSteps,yAxisTicks:this.options.yAxisTicks,hasCursor:this.options.hasCursor,yMaxPixels:this.options.graphHeight-2,isRtl:this.options.isRtl})).render()},makeGraphClass:function(){var a=function(a){this.options=f.extend(this.options,a);this.init()};a.prototype=f.extend(a.prototype,{xUnitScale:1,yUnitScale:1,xLabelPixels:void 0,yLabelPixels:void 0,xPixelPadding:5,xMaxPixels:g.config.getInt("ui.range.filter.graph.xAxisMax",
179),options:{},init:function(){this.findAxisTextWidths();0<this.xAxisSteps&&this.adjustXAxisSteps();0<this.options.yAxisTicks&&this.adjustYAxisTicks()},formatX:function(a){return g.Common.Utils.formatPrice(Math.round(a),!0)},formatY:function(a){return a},rawX:function(a){return a},rawY:function(a){return a},pixelScaleY:function(a){return 0>a?1:this.options.yMaxPixels/this.options.yMax*a},findAxisTextWidths:function(){if(!(this.xLabelPixels&&this.yLabelPixels||null==this.options.ranges)){var a=this.formatX(this.options.ranges[this.options.ranges.length-
1]&&this.options.ranges[this.options.ranges.length-1].max),c=this.formatY(this.options.yMax),a=f("\x3cspan\x3e").html(a).addClass("xLabel").css("font-size","9px"),c=f("\x3cspan\x3e").html(c).addClass("yLabel").css("font-size","10px"),d=f("\x3cdiv\x3e").css("position","absolute").css("left","-9999px").css("top","-9999px").css("opacity","0");d.append(a).append(c);f("body").append(d);this.xLabelPixels=a.outerWidth()+5;this.yLabelPixels=c.outerWidth()+5;d.remove()}},adjustXAxisSteps:function(){for(;0<
this.options.xAxisSteps&&!(this.xMaxPixels/(this.options.xAxisSteps+1)>this.xLabelPixels);this.options.xAxisSteps--);2>=this.options.xAxisSteps&&(this.options.xAxisSteps=2)},adjustYAxisTicks:function(){var a=this.options.yMax,c=Number(this.options.yAxisTicks);if(0!==a%c)for(this.options.yAxisTicks=8>a?a:8;1<this.options.yAxisTicks&&0!==this.options.yMax%this.options.yAxisTicks;this.options.yAxisTicks--)1===this.options.yAxisTicks&&(this.options.yAxisTicks=8<this.options.yAxisTicks?c:this.options.yMax)},
renderYAxis:function(){if(1>this.options.yAxisTicks)return"";var a=this.options.height/this.options.yAxisTicks,c=f("\x3cdiv\x3e");if(0<this.options.yAxisTicks){for(var d=f("\x3cdiv class\x3d'y-axis'\x3e\x3c/div\x3e"),e,h=0;h<this.options.yAxisTicks;h++)e=this.renderYAxisLabel(h).css("height",a+"px").css("width",this.yLabelPixels+"px"),d.append(e);d.css("width",this.yLabelPixels);c.append(d)}if(this.options.showYLines)for(h=0;h<this.options.yAxisTicks;h++)d=f("\x3cdiv\x3e\x3c/div\x3e").addClass(h+
1===this.options.yAxisTicks?"line last":"line").css("top",h*a+"px").css("height",a-1+"px").css("left",this.yLabelPixels+this.xPixelPadding+"px"),c.append(d);return c.html()},renderYAxisLabel:function(a){return f("\x3cdiv class\x3d'label'\x3e"+this.formatY(this.options.yMax-this.options.yMax*a/this.options.yAxisTicks)+"\x3c/div\x3e")},renderXAxis:function(){if(0<this.options.xAxisSteps){for(var a=this.rawX(this.options.minRange),c=this.rawX(this.options.maxRange),d=Math.max(Math.ceil((c-a)/this.options.xAxisSteps),
this.xUnitScale),a=Math.min((c-a)/d+1,8),c="",e=0;e<a;e++)c+=this.renderXAxisLabel(e,d);return"\x3cdiv class\x3d'x-axis' style\x3d'left: "+(this.yLabelPixels+2)+"px'\x3e"+c+"\x3c/div\x3e"}return""},renderXAxisLabel:function(a,c){a=this.rawX(this.options.minRange)+a*c;return"\x3cspan class\x3d'x-label'\x3e"+this.formatX(a)+"\x3c/span\x3e"},renderGraphBars:function(){for(var a="",c=(this.yLabelPixels+this.xPixelPadding)/2,d=this.options.isRtl?"flex-direction: row-reverse":"",e=0,f=this.options.ranges.length;e<
f;e++)var g=this.options.ranges[e],a=a+("\x3cspan class\x3d'bar' data-boundary\x3d'"+g.min+"' style\x3d'height: "+this.pixelScaleY(g[this.options.yKey])+"px'\x3e\x3c/span\x3e");return this.options.hasCursor?"\x3cdiv class\x3d'bars' style\x3d'right: "+c+"px'\x3e"+a+"\x3cspan class\x3d'cursor'\x3e\x3c/span\x3e\x3c/div\x3e":"\x3cdiv class\x3d'bars' style\x3d'right: "+c+"px; "+d+"'\x3e"+a+"\x3c/div\x3e"},render:function(){return f("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+this.renderGraphBars()+
this.renderXAxis())}});return a},getHistoryFilterViewState:function(a){var b=this,c=this.legCount,d=null,e=null,h=[],g=function(a,b){b()?null===d&&(d=!0):a()&&(null===e&&(e=!0),d=!1)};a.legs.forEach(function(a,d){if(!(d>=c)){var f=b.legs[d].ranges?{min:b.legs[d].ranges.minRange,max:b.legs[d].ranges.maxRange}:{},k=b.legs[d].ranges?{min:b.legs[d].ranges.leftRange,max:b.legs[d].ranges.rightRange}:{};a.min&&a.max?g(function(){return a.min>f.min&&a.max<f.max},function(){return a.min==k.min&&a.max==k.max}):
a.min?g(function(){return a.min<f.max},function(){return a.min==k.min}):a.max?g(function(){return a.max>f.min},function(){return a.max==k.max}):e=!1;h.push(a)}});return f.extend(this.base(),{state:{legs:h},isAlreadyApplied:d,disabled:!e})},getStateForFilterHistory:function(){var a=this,b={legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};a.slider.isLeftRangeManipulated()&&(b.min=a.slider.leftRange.toString());
a.slider.isRightRangeManipulated()&&(b.max=a.slider.rightRange.toString());return b})};return{displayName:this.options.title,state:b,type:g.question.ask("filters.FilterHistory.type.slider"),subtype:this.getFilterHistoryDisplayViewSubtype(),displayValue:b.legs.map(function(b,d){return{displayName:a.getLegDisplayName(d),min:b.min&&a.formatValues([parseInt(b.min)]),max:b.max&&a.formatValues([parseInt(b.max)])}})}},getLegDisplayName:function(){return null},getFilterHistoryDisplayViewSubtype:function(){return g.question.ask("filters.FilterHistory.type.numeric")},
setDisabled:function(a){a=a||this.options.forceDisableOnSingleResult&&this.options.disableOnSingle&&1>=this.filteredResults;this.base(a);this.legs&&this.legs.forEach(function(b){b.slider.element.find(".r9RangeSlider").toggleClass("Disabled",a)})},disabledPriceGraphFilter:function(a){this.setDisabled(0===a.legs.length);this.element.hasClass("Disabled")?g.events.publish("results.filter.disablePriceGraph"):g.events.publish("results.filter.enablePriceGraph")},setStateFromPrevious:function(a){var b=parseInt(a.key[a.key.length-
1]);if(this.legs&&b<this.legs.length){var b=this.legs[b].slider,c=a.key.startsWith("left");a=a.reset?c?b.minRange:b.maxRange:parseInt(a.value);var d=b.widget.getValues();c?(b.setLeftRange(a),d[0]=a):(b.setRightRange(a),d[1]=a);b.widget.setValues(d)}},updatePreviousFilters:function(a){a?a.legs.forEach(function(a,c){var b="left"+c;c="right"+c;a.hasOwnProperty("min")&&this.previousFilters.hasOwnProperty(b)&&this.previousFilters[b]!==a.min&&this.removePreviousFilter(b);a.hasOwnProperty("max")&&this.previousFilters.hasOwnProperty(c)&&
this.previousFilters[c]!==a.max&&this.removePreviousFilter(c)},this):this.removePreviousFilter()}})})(R9,jQuery);(function(g,f){g.createComponentClass("common.results.filters.RangeGraphFilter","common.results.filters.SimpleRangeGraphFilter",{options:{showYLines:!0,xAxisSteps:6,yAxisTicks:4,hasCursor:!0},init:function(){this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.eventPrefix="filters.%s.".format(this.options.name)},inlineComponentsReady:function(){var a=this;this.element.find(".graphFilterSection").each(function(b){var d=
!1;a.legs[b]={slider:g.question.ask("RangeFilterSlider.init."+a.id("slider-"+b),{min:a.options.min,max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(c,e){d=!0;return a.sliderDidStart(b,e)},onSlide:function(c,e){return a.sliderDidSlide(b,e)},onStop:function(c,e,g){d=!1;a.publishHoverState(!1,{leg:b});e={};var h=a.legs[b].slider;h&&(e.field=
(f(c.target).hasClass("left")?"left":"right")+b,e.value=h[-1<e.field.indexOf("left")?"leftRange":"rightRange"]);return a.sliderDidStop(b,g,{changeData:e})},onValidate:function(b){return a.validateValues(b)}}),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:f(this)};a.legs[b].element.on("mouseenter",a.publishHoverState.bind(a,!0,{leg:b}));a.legs[b].element.on("mouseleave",function(){d||a.publishHoverState(!1,{leg:b})})});this.confineDisplayToLeg(this.options.activeLeg)},addEventHandlers:function(){this.base();
var a=this;this.subscribe("common.results.filters.activeLeg.changed",function(b){a.confineDisplayToLeg(b)});this.subscribe("common.results.filters.legCount.set",this.setLegCount.bind(this))},setLegCount:function(a){this.legCount!==a&&"number"===typeof a&&(this.legCount=a,1===this.legCount?this.confineDisplayToLeg(0):2===this.legCount&&this.confineDisplayToLeg(-1))},updateLeg:function(a,b){this.updateLegSlider(a,b);this.hideGraph(b);this.legs[b].ranges=a;this.legs[b].graph=void 0;var d=this.lookupGraphYKeys(this.options.yAxisDisplay);
(a=a[d.max])&&a.length?this.legs[b].maxYVal=a[b]:f.isArray(a)||(this.legs[b].maxYVal=a)},sliderDidStop:function(a,b,d){this.hideGraph(a);b&&(this.pushStateChange(null,d),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidStart:function(a){this.isGraphable(a)&&(this.showGraph(a),this.updateGraph(a,this.legs[a].slider.widget.options.values))},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+a).html(this.generateGraph(a,
b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").css({display:"block",height:"82px"})},getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};a.slider.isLeftRangeManipulated()&&(b.min=a.slider.leftRange.toString());a.slider.isRightRangeManipulated()&&(b.max=a.slider.rightRange.toString());return b})}},updateGraph:function(a,
b){a=this.legs[a];a.graph.find(".bars .bar").each(function(){var a=parseInt(f(this).data("boundary"));b[0]>a||b[1]<a?f(this).addClass("inactive"):f(this).removeClass("inactive")});var d=a.graph.find(".bars").width(),c=a.slider.minRange,c=d*(b[a.slider.widget.activeHandleIndex]-c)/(a.slider.maxRange-c);c>d-1&&(c=d-1);0>c&&(c=0);a.graph.find(".bars .cursor").css({left:c+"px"})},confineDisplayToLeg:function(a){if(!this.options.isMulticity&&0>a)this.element.find(".graphFilterSection").removeClass("inactive");
else{a=0>a?0:a;for(var b=0;b<this.legs.length;b++)this.legs[b].element.toggleClass("inactive",b!==a)}},shouldBeVisible:function(a){if(a.legs)for(var b=0;b<a.legs.length;b++)if(!isNaN(parseInt(a.legs[b].minRange))&&!isNaN(parseInt(a.legs[b].maxRange)))return!0;return!1},setDisabled:function(a){this.base(a);this.legs.forEach(function(b){g.dom.toggleOneClass(b.slider.widget.element,"Disabled",a)})},cleanupExistingState:function(){this.legs.forEach(function(a){a.slider.clearState();a.ranges=a.graph=a.maxYVal=
void 0})},hideGraph:function(a){void 0!==this.legs[a].graph&&(this.legs[a].graph.find(".filterGraph").css({display:"none",height:"0"}),this.getChildElement("section-"+a).removeClass("showGraph"))}})})(R9,jQuery);(function(e,f){e.createComponentClass("flights.results.filters.FlightTimesFilter","common.results.filters.RangeGraphFilter",{Graph:null,legs:void 0,legCount:2,legSections:null,isFlexDates:!1,flexRangeLegs:{},hasWeekendDefaultState:!1,options:{canToggleFlexOptIn:!1,flexOptInClientTemplate:"",fullMeridiem:!0,isMulticity:!1,yAxisDisplay:"price"},init:function(){this.base();this.element.data("component",this);this.eventPrefix="filters.%s.".format(this.options.name);this.legSections=this.element.find(".js-legSection")},
addEventHandlers:function(){this.base();var a=this;this.subscribe("flights.filters.multicity.setLeg",function(b){a.confineDisplayToLeg(b)});this.subscribe("flights.filters.takeoffLanding.setCategory",this.confineDisplayToTakeoffLanding.bind(this));this.subscribe("search.poll.response",function(b){b.hasOwnProperty("isMulticity")&&(a.options.isMulticity=b.isMulticity)});this.answer("FlightTimesFilter.getLegs"+a.name,function(){return a.legs})},confineDisplayToLeg:function(a){if(-1!==a)this.base(a);
else{a=2;for(var b=0;b<this.legs.length;b++)this.legs[b].element.toggleClass("inactive",b>=a)}},confineDisplayToTakeoffLanding:function(a){var b=this;this.element.toggleClass("inactive",{takeoff:0,landing:1}[this.name]!==a&&-1!==a);this.legs.forEach(function(a,g){a.element.removeClass("inactive").toggleClass("hidden",g>=b.legCount)})},cleanupExistingState:function(){this.base();this.options.isMulticity=!1},update:function(a){this.isFlexDates=a.isFlexDates;this.hasWeekendDefaultState=a.hasWeekendDefaultState;
a.legs&&this.setLegCount(a.legs.length);this.base(a);a.hasOwnProperty("airports")&&e.events.publish("flights.filters.%s.airports".format(this.name),{airports:a.airports});a.flexRangeLegs&&(this.flexRangeLegs=a.flexRangeLegs,this.options.canToggleFlexOptIn&&this.updateFlexOptInToggles(a.flexRangeLegs));this.options.isMulticity&&a.sectionLabels&&1===a.sectionLabels.length&&this.legs.forEach(function(b){b.label.html(a.sectionLabels[0])})},updateFlexOptInToggles:function(a){var b=this.element.find(".js-flexOptIn");
this.legSections.each(function(c,g){var d=b.eq(c);"boolean"!==typeof a[c]?d.length&&d.remove():(d.length||(d=this.renderFlexOptInToggle(f(g),c),this.initFlexOptInCheckbox(d,c+"")),d.find('input[type\x3d"checkbox"]').getWidget().setChecked(a[c]))}.bind(this))},renderFlexOptInToggle:function(a,b){b=e.template.renderElement(this.options.flexOptInClientTemplate,{name:this.name,legNumber:b});a.append(b);return b},initFlexOptInCheckbox:function(a,b){a=a.find('input[type\x3d"checkbox"]');a.length&&a.checkbox({change:this.onFlexOptInChange.bind(this,
b)})},onFlexOptInChange:function(a,b){b=f(b).getWidget().getValue();if(this.flexRangeLegs[a]!==b){var c={};c[a]=b;this.flexRangeLegs=f.extend({},this.flexRangeLegs,c);this.pushStateChange();this.setLastUserInteraction(!0)}this.logUserInteraction()},pushStateChange:function(a,b){this.hasWeekendDefaultState&&a?this.base(!1,b,{legs:this.legs.slice(0,this.legCount).map(function(a){return a.slider?{min:a.slider.minRange.toString(),max:a.slider.maxRange.toString()}:{}}),flexRangeLegs:Object.keys(this.flexRangeLegs).slice(0,
this.legCount).reduce(function(a,b){a[b]=!1;return a},{})}):this.base(a,b,null)},willReset:function(){this.flexRangeLegs={}},filterDataChanged:function(a){var b=this.element.hasClass("inactive");this.base(a);this.element.toggleClass("inactive",b)},showGraph:function(a){var b=this.element.find(".timesFilterSection").eq(a),c=b.outerHeight(),g=-24,d=b.find(".js-flexOptIn");d.length&&(c+=6,g+=d.outerHeight()+18);this.base(a);b.css("height",c).find(".timesFilterSectionInner").css("bottom",g)},hideGraph:function(a){this.base(a);
this.element.find(".timesFilterSection").eq(a).css("height","").find(".timesFilterSectionInner").css("bottom","")},getState:function(){return f.extend({},this.base(),{flexRangeLegs:this.flexRangeLegs})},formatValues:function(a,b){var c=this,g=this.spansDays(a);return a.map(function(b,f){var d=c.getSliderHandleDateFormat(b,f,g),e=moment.utc(b);-1!==d.indexOf("d")&&f===a.length-1&&0===e.minute()&&0===e.hour()&&(e.subtract(1,"minutes"),g=c.spansDays([a[0],e.valueOf()]),d=c.getSliderHandleDateFormat(b,
f,g));return c.formatHourTime(e.format(d))})},getSliderHandleDateFormat:function(a,b,c){return 864E5>a||!c&&0!==b?"LT":"ddd LT"},formatHourTime:function(a){return this.options.fullMeridiem?a:this.shortenMeridiem(a)},shortenMeridiem:function(a){var b=/[ ]?([aApP])[mM]$/g,c=b.exec(a);c&&1<c.length&&(a=a.replace(b,c[1].toLowerCase()));return a},spansDays:function(a){return moment.utc(a[0]).day()!==moment.utc(a[1]).day()},makeGraphClass:function(){var a=this.base(),b=this,c=function(b){this.options=f.extend(a.options,
b);this.findAxisTextWidths()};c.prototype=f.extend(a.prototype,c.prototype,{xUnitScale:36E5,yUnitScale:1,formatX:function(a){return b.formatHourTime(moment.utc(a).format("ha"))},formatY:function(a){return e.Common.Utils.formatPrice(Math.round(a),!0)},rawX:function(a){return moment(a).utc().startOf("hour")._d.getTime()},render:function(){return f("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+this.renderGraphBars()+this.renderXAxis())}});return c},getFilterHistoryDisplayViewSubtype:function(){return e.question.ask("filters.FilterHistory.type.time")},
getLegDisplayName:function(a){return"Leg "+(a+1)}})})(R9,jQuery);(function(c,g){c.createComponentClass("flights.results.filters.TimesFilterSection","common.results.filters.FilterSection",{landingEl:null,legToggleButtonSet:null,setCategoryEvent:"",options:{isMulticity:!1,takeoffLandingTabs:!1,legCount:2},init:function(){this.base();this.landingEl=this.getChildElement("showLanding");this.legToggleButtonSet=this.getChildElement("legToggle");this.airportsSection=this.getChildElement("airportsSection");this.setCategoryEvent=this.options.takeoffLandingTabs?"flights.filters.takeoffLanding.setCategory":
"flights.filters.multicity.setLeg"},addEventHandlers:function(){this.base();var a=this;this.landingEl.click(this.openLandingSection.bind(this));this.landingEl.keypress(function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.openLandingSection(a)});this.subscribe("resultspage.searchId.changed",function(){a.element.removeClass("expanded");a.landingEl.removeClass("hidden");a.legToggleButtonSet.addClass("hidden")});this.options.takeoffLandingTabs||this.legToggleButtonSet.radioButtonSet();this.legToggleButtonSet.getWidget().setOption("change",
function(b){c.events.publish(a.setCategoryEvent,parseInt(b.value)-1)});this.subscribe("flights.filters.setLeg",function(b){a.legToggleButtonSet.getWidget().setButtonCheckedByValue(b+"")});this.subscribe("search.poll.response",this.handleSearchPollResponse.bind(this))},onPushedStateChange:function(a){var b=a.reset;0<=this.filterDOMIds.indexOf(a.elemId)&&!this.skipFilter(a.name)&&(this.element.toggleClass("isDirty",!b),this.element.find(".horizontalFilterHead").toggleClass("isDirty",!b))},inlineComponentsReady:function(){this.base();
(this.options.isMulticity||this.options.takeoffLandingTabs&&1<this.options.legCount)&&this.setupLegTabs(this.options.legCount)},openLandingSection:function(){this.element.addClass("expanded");this.landingEl.addClass("hidden");c.Analytics.api.trackEvent({category:"Filter",action:"times",label:"show-landing"})},setupLegTabs:function(a){var b=this,f=this.getChildElement("dropdown_content");this.options.takeoffLandingTabs?1===f.length&&f.addClass("multicity"):this.element.parent().find(".legToggle").addClass("visible");
this.legToggleButtonSet.parent().addClass("visible");this.airportsSection.addClass("visible");this.element.addClass("multicity");this.options.isMulticity=!0;this.legCount=a;this.legToggleButtonSet.find("label").each(function(d,e){e=g(e);0===d&&(c.events.publish(b.setCategoryEvent,d),b.legToggleButtonSet.getWidget().setValue(e.prev().val()));e.toggleClass("active",d<a);b.legToggleButtonSet.getWidget().setButtonEnabledByValue(function(){return d<=b.legCount},d);d===a&&e.addClass("borderless")})},clearMulticityFilters:function(){this.options.isMulticity=
!1;this.element.removeClass("multicity");this.legToggleButtonSet.find("label.active").removeClass("active");this.element.parent().find(".legToggle").removeClass("visible");this.airportsSection.removeClass("visible")},clearTakeoffLandingTabs:function(){c.events.publish(this.setCategoryEvent,-1);this.legToggleButtonSet.parent().removeClass("visible")},handleSearchPollResponse:function(a){a.searchStartedThisPoll&&(this.options.takeoffLandingTabs?a.isOneWay?this.clearTakeoffLandingTabs():this.setupLegTabs(a.legCount):
a.isMulticity?this.setupLegTabs(a.legCount):this.clearMulticityFilters(),c.events.publish("flights.filters.multicity",a.isMulticity))},skipFilter:function(a){return!this.element.hasClass("multicity")&&"airports"===a}})})(window.R9,window.jQuery);(function(d,f){var e=[d.globals.keyCodes.MOUSE_LEFT,d.globals.keyCodes.RETURN,d.globals.keyCodes.SPACE];d.createComponentClass("flights.results.filters.AirlinesFilter","common.results.filters.ValueSetFilter",{appliedFiltersToastShownForSearch:!1,canOpenUserPreferencesPanel:!0,isLoggedIn:null,openUserPreferencesPanelCode:"",userAvoidAirlines:[],options:{addAvoidAirlineUrl:"",isLoggedIn:!1,restoreMultAfterOnly:!1,saveUserPreferencesAvoid:!1,userAvoidAirlines:[],messages:{filtersApplied:"",loginToSavePreferences:"",
loginToSavePreferencesSubheading:""}},init:function(){this.base();this.canOpenUserPreferencesPanel=this.options.saveUserPreferencesAvoid;this.isLoggedIn=this.options.isLoggedIn;this.userAvoidAirlines=this.options.userAvoidAirlines},addEventHandlers:function(){this.base();this.options.saveUserPreferencesAvoid&&(this.registerEvent("click keydown","#"+this.id("user-preferences-hide-button"),this.handleUserHideAirlinePanel.bind(this)),this.registerEvent("click keydown","#"+this.id("user-preferences-hide-close"),
this.removeUserHideAirlinePanel.bind(this,!1)),this.registerEvent("click keydown","#"+this.id("user-preferences-account-link"),this.trackEvent.bind(this,"click","p13n-avoid-airline-panel-accountlink")),this.subscribe("search.searchStarted",function(){this.appliedFiltersToastShownForSearch=!1;this.canOpenUserPreferencesPanel=this.options.saveUserPreferencesAvoid}.bind(this)))},update:function(a){this.base(a);var b=this;setTimeout(function(){b.appliedFiltersToastShownForSearch||b.notifyUserAppliedFilters()},
25)},unsetOnlyOption:function(a){this.base(a);null===this.only&&this.options.restoreMultAfterOnly&&(a=this.getRenderedFilterOptions().MULT)&&a.setChecked(1)},notifyUserAppliedFilters:function(){var a=this;this.getState()&&this.userAvoidAirlines&&this.userAvoidAirlines.some(function(b){return 0===a.getState()[b]})&&(d.events.publish("resultspage.notify",{content:this.options.messages.filtersApplied}),this.appliedFiltersToastShownForSearch=!0)},canAddUserPreferencesPanel:function(a){return this.options.saveUserPreferencesAvoid&&
this.canOpenUserPreferencesPanel&&!a.meta&&a.code&&-1===this.userAvoidAirlines.indexOf(a.code)},canRemoveUserPreferencesPanel:function(a){return this.options.saveUserPreferencesAvoid&&!this.canOpenUserPreferencesPanel&&!a.meta&&a.code&&this.openUserPreferencesPanelCode===a.code},addUserHideAirlinePanel:function(a){var b=d.template.renderElement("UserPreferencesHidePanel",{code:a.state.code,name:a.state.displayValue});a.element.after(b);this.canOpenUserPreferencesPanel=!1;this.openUserPreferencesPanelCode=
a.state.code;this.trackEvent("impression","p13n-save-avoid-airline",a.state.code)},removeUserHideAirlinePanel:function(a,b){if(b){if(-1===e.indexOf(b.which))return;this.trackEvent("click","p13n-close-avoid-airline-panel")}this.getChildElement("userPreferencesHidePanel").remove();this.canOpenUserPreferencesPanel=a;this.openUserPreferencesPanelCode=""},filterItemDidChange:function(a,b,c,d){this.base(a,b,c,d);c&&c.state&&(0===c.state.selected&&this.canAddUserPreferencesPanel(c.state)?this.addUserHideAirlinePanel(c):
this.canRemoveUserPreferencesPanel(c.state)&&this.removeUserHideAirlinePanel(!0,null))},handleUserHideAirlinePanel:function(a){if(-1!==e.indexOf(a.which)){var b=this,c=a.currentTarget.dataset;b.isLoggedIn?f.ajax({type:"POST",url:this.options.addAvoidAirlineUrl,data:{code:c.code},headers:{"X-CSRF":d.globals.formtoken}}).then(b.handleUserHideAirlineSuccess.bind(b,a,c.code,c.name)).catch(function(){b.logger.error("Error adding airline to avoid. Airline code: "+c.code);b.trackEvent("failed","p13n-save-avoid-airline",
c.code)}):(this.trackEvent("opened","p13n-avoid-airline-login-dialog"),d.authentication.showLogin({customHeading:this.options.messages.loginToSavePreferences,customSubheading:this.options.messages.loginToSavePreferencesSubheading,onClose:function(){setTimeout(function(){b.isLoggedIn||b.trackEvent("cancelled-logging-in","p13n-avoid-airline-login-dialog")},1E3)},success:function(){d.events.publish("social.response.loaded",!0);b.isLoggedIn=!0;b.handleUserHideAirlinePanel(a)}}))}},handleUserHideAirlineSuccess:function(a,
b,c){this.removeUserHideAirlinePanel(!0);this.canOpenUserPreferencesPanel=!0;this.userAvoidAirlines.push(b);this.openP13nHiddenToast(c);this.trackEvent("saved","p13n-save-avoid-airline",b)},openP13nHiddenToast:function(a){d.events.publish("resultspage.notify",{content:d.template.renderElement("userPreferencesHiddenToast",{name:a})})},trackEvent:function(a,b,c){d.Analytics.api.trackEvent({category:"airlines-filter",action:a,label:b,value:c})}})})(R9,jQuery);(function(c,f){c.createComponentClass("flights.results.filters.PerLegValueSetFilter","common.results.filters.ValueSetFilter",{activeLegIndex:0,activeLegOverride:null,legsContainer:void 0,legRenderedFilterOptions:void 0,legCount:1,isMulticity:!1,init:function(){this.base();this.legRenderedFilterOptions=[];this.legsContainer=this.getChildElement("legs")},addEventHandlers:function(){var a=this;this.base();this.subscribe(["common.results.filters.activeLeg.changed","flights.filters.multicity.setLeg"],
this.setActiveLegIndex.bind(this));this.subscribe("flights.filters.changeLeg",{id:this.id()},this.changedActiveLegIndex.bind(this));this.subscribe("flights.filters.multicity",function(b){a.isMulticity=b})},inlineComponentsReady:function(){this.isMulticity="m"===c.question.ask("flights.resultspage.oneway")},shouldBeVisible:function(a){return(a=a.legValues)&&a.reduce(function(a,d){return a&&0<Object.keys(d).length},!0)},update:function(a){a=a.legValues;this.legCount=a.length;for(var b=0;b<this.legCount;b++)this.legsContainer.children().length<=
b&&(this.legsContainer.append(f("\x3cdiv class\x3d'leg-%s'/\x3e".format(b))),this.legRenderedFilterOptions.push({})),this.activeLegOverride=b,this.base(a[b]);this.activeLegOverride=null;this.legsContainer.find(".leg-"+this.getActiveLeg()).addClass("active")},cleanupExistingState:function(){this.base();this.legRenderedFilterOptions=[];this.legsContainer.children().remove()},reset:function(a){if(this.isMulticity){a=f.extend({},a,{silent:!0});for(var b=0;b<this.legCount;b++)this.activeLegOverride=b,
this.base(a);this.pushStateChange(null,{reset:!0});c.events.publish("flights.filters.setLeg",1);this.setActiveLegIndex(0)}else this.base(a)},getState:function(){var a={},b=0,d=this.legCount;this.legRenderedFilterOptions.forEach(function(g){b<d&&Object.keys(g).forEach(function(e){var c=g[e].getState();a.hasOwnProperty(e)&&a[e].length===d||(a[e]=Array.apply(null,Array(d)).map(String.prototype.valueOf,"null"));"number"===typeof c&&(a[e][b]=c.toString())});b++});Object.keys(a).forEach(function(b){0===
a[b].filter(function(a){return"null"!==a}).length&&delete a[b]});return 0<Object.keys(a).length?a:null},getOptionsContainer:function(){return this.legsContainer.find(".leg-"+this.getActiveLeg())},getRenderedFilterOptions:function(){var a=this.legRenderedFilterOptions[this.getActiveLeg()];void 0===a&&(a={});return a},getActiveLeg:function(){return null!==this.activeLegOverride?this.activeLegOverride:this.activeLegIndex},changedActiveLegIndex:function(a){a&&this.setActiveLegIndex(a.legIndex)},setActiveLegIndex:function(a){this.activeLegIndex=
-1<a?a:0;this.legsContainer.children().removeClass("active");this.legsContainer.find(".leg-"+this.activeLegIndex).addClass("active")}})})(R9,jQuery);(function(d,e){d.createComponentClass("flights.results.filters.AirportsFilterSection","common.results.filters.FilterSection",{legToggleSetElem:null,legToggleSetWidget:null,lastLegCount:null,enabledForSearch:!1,init:function(){this.base();this.legToggleSetElem=this.getChildElement("leg-toggle")},addEventHandlers:function(){this.base();this.subscribe("search.startSearch",this.onSearchStart.bind(this));this.subscribe("flights.filters.setLeg",this.onSetLegSelection.bind(this));this.subscribe("search.poll.response",
this.onSearchPollResponse.bind(this))},inlineComponentsReady:function(){this.base();this.legToggleSetElem.length&&(this.legToggleSetWidget=this.legToggleSetElem.styleJamRadioButtonSet({change:this.onChangedLegRadio.bind(this)}).getWidget())},toggleFilterSection:function(a){this.base(a);this.element.closest(".hfilter").toggleClass("inactive",!a.visible)},onSearchStart:function(){this.enabledForSearch=!1;this.setupLegTabs(0);this.toggleFilterSection({visible:!1})},onChangedLegRadio:function(a){a&&this.triggerChangeLegDisplay(a.value)},
onSetLegSelection:function(a){this.legToggleSetWidget&&this.legToggleSetWidget.setButtonCheckedByValue(a+"");this.triggerChangeLegDisplay(a)},triggerChangeLegDisplay:function(a){d.events.publish("flights.filters.changeLeg",{id:this.id("airports"),legIndex:parseInt(a)-1})},setupLegTabs:function(a){this.lastLegCount=a;if(2>a)this.legToggleSetElem.toggleClass("inactive",!0),this.triggerChangeLegDisplay(0);else if(this.legToggleSetElem.toggleClass("inactive",!1),this.legToggleSetWidget)for(var b=this.legToggleSetWidget.getAllRadios().length,
c=0;c<b;c++)this.legToggleSetWidget.setButtonEnabledByValue(c+1+"",c<a)},onSearchPollResponse:function(a){var b=a&&a.isMulticity?parseInt(a.legCount):0;a=!!(a&&a.filtersData&&a.filtersData.airports&&a.filtersData.airports.enabled);if(this.enabledForSearch!==a||b!==this.lastLegCount)this.enabledForSearch=a,this.setupLegTabs(a&&!isNaN(b)?b:0)}})})(R9,jQuery);(function(a,b){a.createComponentClass("flights.results.filters.FlightQualityFilterSection","common.results.filters.FilterSection",{})})(R9,jQuery);(function(a,b){a.createComponentClass("flights.results.filters.FlightEquipmentSection","common.results.filters.FilterSection",{})})(R9,jQuery);(function(c){c.createComponentClass("flights.results.filters.BookingProvidersFilter","common.results.filters.ValueSetFilter",{options:{directOnlyEnabled:!1,directOnlyKey:"",directBookingToolTipText:"",featureClass:""},addFilterItem:function(b,a,c){this.base(b,a,c);this.options.directOnlyEnabled&&(b=this.getRenderedFilterOptions()[this.options.directOnlyKey])&&(a=0<=this.options.featureClass.indexOf("kayak-flights"),b.element.toolTip({content:this.options.directBookingToolTipText,position:"top",orientation:a?
"start":"middle",showImmediately:!1,extraClass:a?"uikit":"",size:a?"uikit":""}),b.element.addClass("directProvidersOnlyOption"))}})})(R9);(function(d,e){d.createComponentClass("flights.results.filters.SpecificLegFilter","common.results.filters.Filter",{name:"specificleg",state:null,specificLegs:null,activeLeg:-1,init:function(){this.base();this.specificLegs={};this.state={}},addEventHandlers:function(){this.base();var a=this;this.subscribe("common.results.filters.specificleg.change",this.handleSpecificLegChange.bind(this));this.subscribe("common.results.filters.activeLeg.changed",function(b){a.activeLeg=b})},handleSpecificLegChange:function(a){a.checked?
this.addSpecificLeg(a):this.removeSpecificLeg(a);this.pushStateChange()},addSpecificLeg:function(a){var b=this;a.removeOld&&Object.keys(this.state).forEach(function(c){c=c.split(":");parseInt(c[1])===a.leg&&b.removeSpecificLeg({signature:c[0],leg:c[1]})});this.state[a.signature+":"+a.leg]=!0;this.specificLegs[a.leg]=a.resultId},removeSpecificLeg:function(a){var b=a.signature+":"+a.leg;this.state.hasOwnProperty(b)&&(delete this.state[b],delete this.specificLegs[a.leg])},cleanupExistingState:function(){this.specificLegs=
{};this.state={}},reset:function(a){var b=d.question.ask("flights.resultspage.currentview");a&&"showAll"===a.type&&(-1<this.activeLeg||"segment"===b||"customticket"===b)||this.base(a)},willReset:function(){this.specificLegs={};this.state={};this.activeLeg=-1},update:function(a){a.hasOwnProperty("signatures")&&(this.cleanupExistingState(),Object.keys(a.signatures).forEach(function(b){this.state[a.signatures[b]+":"+b]=!0;a.hasOwnProperty("legs")&&(this.specificLegs[b]=a.legs[b])},this))},getState:function(){var a=
Object.keys(this.state);return 0<a.length?{signatures:a,legs:this.specificLegs}:null}})})(R9,jQuery);(function(b){b.createComponentClass("common.results.filters.FilterList",{filtersSection:null,filterTabs:null,placeholderList:null,isPlaceholderEnabled:null,filterLayout:{},options:{searchCompleted:!1,primaryFilterList:[],moreFilterList:[],hideDelay:0},init:function(){this.filtersSection=this.getChildElement("filtersSection");this.placeholderList=this.getChildElement("placeholderList");this.filterTabs=this.element.find(".filterTab");this.isPlaceholderEnabled=this.placeholderList&&0<this.placeholderList.length;
this.hideFilterList()},addEventHandlers:function(){var a=this;this.subscribe("resultspage.streaming.done",this.showFilterList.bind(this));this.subscribe(["search.startSearch","resultspage.streaming.start"],this.streamingStarted.bind(this));this.subscribe("resultspage.filtersData.changed",this.handleFilterResponse.bind(this));this.subscribe("search.searchFailed",this.hideAll.bind(this));this.subscribe("resultspage.filterList.show",this.showFilterList.bind(this));this.filterTabs.keydown(this.handleTabKeydown.bind(this));
this.element.on("click",".fullscreen-dialog-header",function(){a.element.toggleClass("active")})},handleFilterResponse:function(a){a&&Object.keys(a).length&&a[Object.keys(a)[0]].enabled&&(this.showFilterList(),b.events.publish("resultspage.filters.show"))},showFilterList:function(){this.element.removeClass("loading");this.filtersSection.removeClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden")},handleTabKeydown:function(a){switch(a.which){case b.globals.keyCodes.RETURN:case b.globals.keyCodes.SPACE:a.currentTarget.click();
break;case b.globals.keyCodes.RIGHT:this.focusNextTab($(a.currentTarget));break;case b.globals.keyCodes.LEFT:this.focusPrevTab($(a.currentTarget))}},focusNextTab:function(a){!a.next().is(a)&&a.next().is(".filterTab")?a.next().click().focus():this.filterTabs.eq(0).click().focus()},focusPrevTab:function(a){!a.prev().is(a)&&a.prev().is(".filterTab")?a.prev().click().focus():this.filterTabs.eq(-1).click().focus()},streamingStarted:function(a){"undefined"!==typeof a&&a.preserveFilters||(this.options.hideDelay?
setTimeout(this.hideFilterList.bind(this),this.options.hideDelay):this.hideFilterList())},hideFilterList:function(){this.element.addClass("loading");this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.removeClass("hidden");b.events.publish("resultspage.filters.hide")},hideAll:function(){this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden");b.events.publish("resultspage.filters.hide")}})})(R9);(function(c,e){var h=c.config.getBoolean("ui.horizon.flights.filters.cabinHoist.target","times-section");c.createComponentClass("flights.results.filters.FlightFilterList","common.results.filters.FilterList",{searchId:void 0,initialSearchId:null,forceAjaxUpdateInterval:null,priceFilterStub:null,filterWrappers:null,filtersContainer:null,myFilters:null,airportsPrevFilter:null,airportsFilterTop:!1,options:{isMulticity:!1,travelers:1,legCount:2,priceTypeEnabled:!1,filterTabView:!1,hoistCabin:!1},init:function(){var a=
this;this.base();if(this.options.searchCompleted)var b=c.events.subscribe("resultspage.filtersData.changed",function(){a.showFilterList();c.events.unsubscribe("resultspage.filtersData.changed",b)});this.filterWrappers={};this.element.find(".filterWrapper").each(function(){a.filterWrappers[this.getAttribute("data-name")]=e(this)});this.options.multiAirportFilterTop&&(this.options.displayMyFilters?this.myFilters=this.element.find(".myfilters")[0]:this.filtersContainer=this.element.find(".filterContainer")[0],
this.airportsPrevFilter=this.element.find(".filterContainer .filterWrapper:nth-child("+(this.options.isMultiAirport?this.options.airportsFilterPosition+1:this.options.airportsFilterPosition)+")")[0],this.options.isMultiAirport&&(this.airportsFilterTop=!0))},addEventHandlers:function(){this.base();var a=this,b=this.getChildElement("topList"),f=this.getChildElement("moreList");this.subscribe(["search.startSearch","search.searchFailed"],function(){a.options.searchCompleted=!1});this.options.multiAirportFilterTop&&
this.subscribe("resultspage.multiAirport.changed",this.setAirportsFilterTop.bind(this));this.setupPriceFilterPositionHandlers();this.getChildElement("moreToggle").click(function(){a.element.toggleClass("expanded");a.publishMoreFilterToggle(a.element.hasClass("expanded"))});this.getChildElement("filterTabs").on("click",".filterTab",function(){if(!e(this).is(".selectedTab")){var d=e(this).is(".moreListTab");a.element.toggleClass("show-more-tab",d);a.element.find(".filterTab").toggleClass("selectedTab").attr("aria-selected",
function(a,d){return"true"===d?"false":"true"});d&&f.removeClass("hidden").attr("aria-expanded",!0);a.options.filterTabView&&(b.attr("aria-expanded",!d),f.attr("aria-expanded",d));a.publishMoreFilterToggle(d)}});this.getChildElement("airlinefees").click(function(){c.Analytics.api.trackEvent({category:"Filters",action:"airlinefees"})});this.subscribe("search.poll.response",function(d){d.hasOwnProperty("isMulticity")&&a.setMulticityMode(d.isMulticity);d.hasOwnProperty("showPlusMinusThree")&&a.getChildElement("flexmatrix").parent().toggleClass("hidden",
!d.showPlusMinusThree);d.hasOwnProperty("showAirlineMatrix")&&a.getChildElement("airline-matrix").toggleClass("hidden",!d.showAirlineMatrix);d.hasOwnProperty("showAirlineFees")&&a.getChildElement("airlinefees").toggleClass("hidden",!d.showAirlineFees)});this.subscribe("resultspage.searchId.changed",function(d){a.searchId=d.searchId});this.getChildElement("flexmatrix").off("click").click(function(){f.hasClass("Disabled")||c.events.publish("flights.results.toggle.flex_matrix")});this.getChildElement("airline-matrix").off("click").click(function(){f.hasClass("Disabled")||
c.events.publish("flights.results.toggle.airline_matrix")});this.subscribe("filters.disabled",function(a){f.toggleClass("Disabled",a).find("a.matrix, .flex-features \x3e a").attr("disabled","disabled")});this.subscribe("resultspage.streaming.done",function(d){a.element.find(".dispCt").removeClass("hidden")});this.options.hoistCabin&&this.setupCabinFilterPositionHandler()},handleFilterResponse:function(a){this.options.multiAirportFilterTop&&this.airportsFilterTop&&!this.options.displayMyFilters?a&&
a.airports&&a.airports.enabled&&(this.showFilterList(),c.events.publish("resultspage.filters.show")):this.base(a)},setupCabinFilterPositionHandler:function(){var a=this.filterWrappers.cabin.prev(),b=function(b){(b=b?this.filterWrappers[h]:a)&&!this.filterWrappers.cabin.prev().is(b)&&(this.filterWrappers.cabin.detach().insertAfter(b),this.filterWrappers.cabin.children().addClass("open"))};this.subscribe("resultspage.cleanup",b.bind(this,!1));this.subscribe("flights.filters.hoistCabin",b.bind(this,
!0))},setupPriceFilterPositionHandlers:function(){var a=c.config.getBoolean("ui.non-price-sort-price-filter.enabled",!0),b=this.filterWrappers.price;if((this.options.priceTypeEnabled||a)&&b){b.prev();var f=/duration|depart|arrive/,d=this,g={sortCode:c.question.ask("resultspage.sortMode.get"),travelers:this.options.travelers},e=function(c,e){e=null;a&&c.hasOwnProperty("sortCode")&&f.test(c.sortCode)?e=d.filterWrappers.stops:d.options.priceTypeEnabled&&c.hasOwnProperty("travelers")&&1<c.travelers&&
(e=d.filterWrappers["airlines-section"]);e&&!b.prev().is(e)&&(b.detach().insertAfter(e),b.children().addClass("open"))};this.options.priceTypeEnabled&&this.subscribe("search.startSearch",function(a){g.travelers=a.travelers;e(g)});a&&this.subscribe("resultsHeader.sortType.set",function(a){g.sortCode=a.sortCode;e(g)});e(g)}},streamingStarted:function(a){this.options.searchCompleted||this.base(a);this.element.find(".dispCt").addClass("hidden")},publishMoreFilterToggle:function(a){c.Analytics.api.trackEvent({category:"Filters",
action:"more-filters",label:a?"show":"hide"});window.setMetaCookie("showAllFilters.flight",a?"true":"false");c.events.publish("sliders.redraw");c.events.publish("moreFilters.toggle",a)},setMulticityMode:function(a){a&&this.getChildElement("airports").hide()},setFilterMatrixView:function(a,b){var c=e("#aboveHeaderContainer");e("html, body").animate({scrollTop:0},500);"plusminusthree"===a?(this.isFlexOpen=b,this.isAirlineMatrixOpen=!b):"airlinestops"===a&&(this.isAirlineMatrixOpen=b,this.isFlexOpen=
!b);c.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")});b&&c.addClass("vm-"+a)},toggleAirlineMatrix:function(a){this.setFilterMatrixView("airlinestops",a);this.airlineMatrixLoaded?c.events.publish("flights.results.airlinestops.show",a):c.events.publish("flights.resultspage.getairlinematrix");this.logMatrixInteraction("airlinestops",a)},togglePlusMinusThree:function(a){this.setFilterMatrixView("plusminusthree",a);this.flexDialogLoaded?c.events.publish("flights.results.flexmatrix.show",
a):c.events.publish("flights.resultspage.getflex");this.logMatrixInteraction("plusminusthree",a)},setAirportsFilterTop:function(a){if(a!==this.airportsFilterTop){var b=this.filterWrappers["airports-section"];a?this.options.displayMyFilters?b.detach().insertAfter(this.myFilters):b.detach().prependTo(this.filtersContainer):b.detach().insertAfter(this.airportsPrevFilter);this.airportsFilterTop=a}},logMatrixInteraction:function(a,b){var e=b?"show":"hide",d=a;"plusminusthree"==a&&(d="fleview-plusminus");
"airlinestops"==a&&(d="airlinematrix",e=b?"open":"close");c.Analytics.api.trackEvent({category:"Filters",action:d,label:e});c.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:a,value:b?"true":"false"})}})})(R9,jQuery);(function(a,c){a.createComponentClass("common.kn.Display",{options:{},addEventHandlers:function(){var b=this;this.subscribe("displayads.register",{type:b.options.type},function(a){b.registerDisplay()});b.options.destroyable&&this.subscribe("displayads.destroy",function(){a.events.publish("displayad.sra.destroy",b.getSlotParams())})},inlineComponentsReady:function(){this.options.lazyLoad||this.registerDisplay()},registerDisplay:function(){a.events.publish("displayad.sra.register",c.extend(this.getSlotParams(),
this.options))},destroy:function(){a.events.publish("displayad.sra.destroy",this.getSlotParams());this.base()},getSlotParams:function(){return{adDivId:this.id()}}})})(R9,jQuery);(function(f,c){var h=f.config.getBoolean("ui.horizon.rails.fuzzyComparisons",!0);f.createComponentClass("base.results.Rail",{options:{pinnable:!0,sticky:!1,debug:!1,debounceDelay:5,handleHorizontalScroll:!0,repositionTimeout:200,fixedTopPosition:0,preventDynamicPositioning:!1,defaultRailWidth:300,isBusinessMode:!1,appliedTravelPolicyIds:[]},prevScroll:0,upScroll:!1,stickTop:!1,stickBottom:!1,originalNode:null,staticPosition:0,pinnedContentHeight:0,enabled:!0,isFullScreenMapV3:!1,init:c.noop,addEventHandlers:c.noop,
inlineComponentsReady:function(){var a=this;a.originalNode=a.element.get(0);this.bindWindowEvents();this.element.hasClass("fullscreen-drawer")&&(this.isFullScreenMapV3=!0);this.options.pinnable&&this.subscribe("resultspage.streaming.done moreFilters.toggle filterTab.changed filter.overflow.toggle displayad.loaded textad.loaded pinnedContent.heightChanged horizon.filters.opened resultspage.requestResults.completed horizon.filters.FiltersDialog.itemToggled".split(" "),function(){a.onScroll()});this.subscribe("pinnedContent.enable",
function(b){a.enabled=b});this.subscribe(["pinnableBar.pinnedChange","pinnedContent.heightChanged"],function(){a.setPinnedContentHeight()});this.subscribe("pinnedContent.reset",function(){a.resetPosition()});this.subscribe("rail.update.preventDynamicPositioning",this.updatePreventDynamicPositioning.bind(this))},onScroll:function(){!1!==this.enabled&&(this.isRailAttached()?this.handleScroll():this.unbindWindowEvents())},handleScroll:function(){var a=this.getWindowScroll(),b=this.getParentScroll();
this.upScroll=this.prevScroll>a;this.prevScroll=a;(a=this.getPositionCSS(a,b,this.isElementTallerThanScreen()))&&this.element.css(a)},unbindWindowEvents:function(){c(window).off("scroll.pinrails-"+this.id());c(window).off("resize.pinrails-"+this.id())},bindWindowEvents:function(){var a;this.options.pinnable&&(0<this.options.repositionTimeout&&this.element.css("transition","transform %sms ease-in-out".format(this.options.repositionTimeout)),a=0<this.options.debounceDelay?f.Common.Utils.debounce(this.onScroll.bind(this),
this.options.debounceDelay):this.onScroll.bind(this),this.registerEvent("scroll.pinrails-"+this.id(),c(window),a),this.registerEvent("resize.pinrails-"+this.id(),c(window),a))},testBottom:function(a,b){return b?a<this.getParentHeight()-this.getWindowHeight():a+this.getElementHeight()<this.getParentHeight()},testTop:function(a,b){return a>this.getParentTop()-this.pinnedContentHeight-this.options.fixedTopPosition},isElementTallerThanScreen:function(){return this.getElementHeight()>this.getWindowHeight()},
calculateScrollPosition:function(a,b){return!b||this.upScroll&&this.fuzzyCompare(this.getElementTop()-this.getParentTop()-this.pinnedContentHeight,a)?{position:"top"}:!this.upScroll&&this.fuzzyCompare(a+this.getWindowHeight(),this.getElementBottom()-this.getParentTop())?{position:"bottom"}:{translate:this.staticPosition}},fuzzyCompare:function(a,b){if(!h)return a>=b;a-=b;return 0<a||1>=Math.abs(a)},resetPosition:function(){var a=c.extend(!0,{},{position:"relative",top:"auto",bottom:"auto"},this.makeTransformCSS("translate(0,0)"));
this.element.css(a)},getPositionCSS:function(a,b,g){if(!this.isRailSticky()&&!this.isFullScreenMapV3){var d=0,e={position:"relative",top:"auto",bottom:"auto","padding-top":""};a=this.testTop(a,g);var f=this.testBottom(b,g);this.staticPosition=this.getElementTop()-this.getParentTop();if(a&&f)if(b=this.calculateScrollPosition(b,g),b.translate&&(d=b.translate),b.position){if(this.options.preventDynamicPositioning)return;"top"===b.position?(e={position:"fixed",top:this.options.fixedTopPosition,bottom:"auto",
width:this.getParentWidth()},d=this.pinnedContentHeight):(e={position:"fixed",bottom:0,top:"auto",width:this.getParentWidth()},d=0)}else e=c.extend({},e);else d=a?this.getParentHeight()-this.getElementHeight():0,e=c.extend({},e);b="translateY(%spx)".format(Math.max(0,d));this.options.handleHorizontalScroll&&"fixed"===e.position&&(g=this.getLeftScroll(),0<g&&(b="translate(-%spx, %spx)".format(g,d)));return c.extend({},e,this.makeTransformCSS(b))}},getParentWidth:function(){return this.element.parent().width()},
makeTransformCSS:function(a){return{msTransform:a,transform:a}},destroy:function(){this.unbindWindowEvents();this.base()},isRailAttached:function(){return this.element&&c.contains(window.document,this.originalNode)},isRailSticky:function(){var a=this.element.css("position");return"sticky"===a||"-webkit-sticky"===a},getElementHeight:function(){return Math.round(this.element.outerHeight())},getElementBottom:function(){return this.getElementTop()+this.getElementHeight()},getElementTop:function(){return Math.round(this.element.offset().top)},
getWindowHeight:function(){return Math.round(c(window).outerHeight())},getWindowScroll:function(){return Math.round(c(window).scrollTop())},getParentHeight:function(){return Math.round(this.element.parent().outerHeight())},getParentTop:function(){return Math.round(this.element.parent().offset().top)},getLeftScroll:function(){return Math.round(c(window).scrollLeft())},getParentBottom:function(){return this.getParentTop()+this.getParentHeight()},getParentScroll:function(){return this.getWindowScroll()-
this.getParentTop()},setPinnedContentHeight:function(){var a=f.question.ask("pinnedContent.height");null!==a?this.pinnedContentHeight=a:0!==this.pinnedContentHeight&&(this.pinnedContentHeight=0)},updatePreventDynamicPositioning:function(a){a&&a.hasOwnProperty("preventDynamicPositioning")&&(this.options.preventDynamicPositioning=a.preventDynamicPositioning)},subscribeForUpdatingPolicyInfo:function(a,b){if(this.options.isBusinessMode){var c=this,d=this.getChildElement(b);this.subscribe("search.poll.response",
function(b){b=c.getNewPolicies(b.appliedTravelPolicyIds);b.length&&(Array.prototype.push.apply(c.options.appliedTravelPolicyIds,b),f.ajax.execute("common/results/mercury/"+a,{data:{appliedTravelPolicyIds:JSON.stringify(c.options.appliedTravelPolicyIds)},appendTo:d,replace:!0,afterScript:function(){d.show()}}))});this.subscribe("search.startSearch",function(){c.options.appliedTravelPolicyIds=[];d.hide()})}},getNewPolicies:function(a){if(!a)return[];var b=this.options.appliedTravelPolicyIds;if(!b)return a;
var c=[];a.forEach(function(a){-1===b.indexOf(a)&&c.push(a)});return c}})})(R9,jQuery);(function(c,d){c.createComponentClass("flights.results.FlightLeftRail","base.results.Rail",{priceAlertsEnabled:!0,addEventHandlers:function(){var a=this;this.base();this.subscribe("search.searchFailed",function(){a.element.addClass("searchFailed")});this.subscribe("resultspage.refreshed",function(){a.element.removeClass("searchFailed")});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setAlertsEnabled(b.enabled&&b.visible)})},setAlertsEnabled:function(a){this.getChildElement("priceAlertsContainer").css("display",
a?"block":"none");this.priceAlertsEnabled=a}})})(R9,jQuery);(function(c){c.createComponentClass("flights.results.brands.momondo.FlightLeftRail","flights.results.FlightLeftRail",{addEventHandlers:function(){var a=this;this.base();this.subscribe("resultspage.streaming.start",function(b){b&&a.setPredictionElementVisibility(!b.isMulticity)});this.subscribe("flights.results.alerts.visibility",function(b){a.setPredictionElementVisibility(b)})},setPredictionElementVisibility:function(a){this.element.find(".predictionContainer").toggleClass("hidden",!a)}})})(R9);(function(b,c){b.createWidgetClass("loader.AriaLoadMessage",{options:{message:""},init:function(){this.message=this.getChildElement("message")},deactivateLoadMessage:function(a){this.message.text(a);this.message.attr("aria-label",a)},activateLoadMessage:function(a){"undefined"!==typeof a?this.message.text(a):this.message.text(this.options.message);"undefined"!==typeof a?this.message.attr("aria-label",a):this.message.attr("aria-label",this.options.message)}})})(R9,jQuery);(function(c,e){c.createComponentClass("common.trips.MoveEventDialog",{dialog:null,contentEl:null,loaderEl:null,resultId:null,tripId:null,eventId:null,legNum:-1,templates:{moveEventDialogContent:"moveEventDialogContent",moveEventActionContent:"moveEventSuccessContent",moveErrorContent:"moveEventError"},options:{msg:{upcomingTripsOptionHeader:void 0,pastTripsOptionHeader:void 0,unexpectedErrorMessage:void 0,unexpectedErrorTitle:void 0,accessDeniedTitle:void 0,accessDeniedMessage:void 0},optimisticUpdatesEnabled:!1},
init:function(){this.contentEl=this.getChildElement("contentPlaceholder");this.loaderEl=this.getChildElement("loader");this.options.optimisticUpdatesEnabled=c.config.getBoolean("ui.trips-optimistic-updates.enabled",!1)},inlineComponentsReady:function(){this.dialog=this.element.getWidget()},addEventHandlers:function(){var a=this;this.subscribe("trips.move.dialog.open",e.proxy(this.processOpenEvent,this));this.subscribe("trips.move.dialog.close",function(){a.dialog.close()})},showGeneralError:function(a,
b){var f=this;b=b||this.options.msg.unexpectedErrorMessage;a=a||this.options.msg.unexpectedErrorTitle;this.loaderEl.hide();a=c.template.renderElement(this.templates.moveErrorContent,{title:a,message:b});this.contentEl.html(a);this.dialog.isOpen()||this.dialog.open();this.getChildElement("closeBtn").on("click",function(){f.dialog.close()})},handleGeneralError:function(a){a=a&&403===a.status;this.showGeneralError(a?this.options.msg.accessDeniedTitle:this.options.msg.unexpectedErrorTitle,a?this.options.msg.accessDeniedMessage:
this.options.msg.unexpectedErrorMessage)},processOpenEvent:function(a){this.clearData();if(a.tripId&&a.eventId&&a.resultId)this.tripId=a.tripId,this.eventId=a.eventId,this.resultId=a.resultId,a.legNum&&(this.legNum=a.legNum),c.action.execute("common.trips.ajax.EventData",{tripId:a.tripId,eventId:a.eventId}).done(e.proxy(this.onEventContentData,this)).fail(e.proxy(this.handleGeneralError,this)),this.contentEl.html(""),this.loaderEl.show(),this.dialog.open();else throw Error("tripId, eventId and resultId are required");
},generateDropdownOptions:function(a,b){var f=this,d=[];a=a||[];0<a.length&&(d.push({value:null,text:c.Common.Utils.String.formatString(b,a.length),checked:!1,disabled:!0}),e.each(a,function(a,b){d.push({value:b.id,text:b.title,checked:b.id===f.tripId,disabled:!1})}));return d},onEventContentData:function(a){this.loaderEl.hide();var b=a.data;a=this.generateDropdownOptions(b.upcomingTrips,this.options.msg.upcomingTripsOptionHeader);var f=this.generateDropdownOptions(b.pastTrips,this.options.msg.pastTripsOptionHeader),
d=b.event&&b.event.type||b.legs&&b.legs.length&&b.legs[0].type||"generic",b=c.template.renderElement(this.templates.moveEventDialogContent,{hasLegs:null!=b.legs,hasTrips:0<b.upcomingTrips.length||0<b.pastTrips.length,legs:b.legs,event:b.event,showLegTabs:0<=this.legNum,oneLeg:0<=this.legNum&&null!=b.legs?b.legs[this.legNum]:null,eventType:d,eventIsHotel:"hotel"===d,eventIsFlight:"flight"===d,eventIsCar:"car"===d,eventIsUnknown:"generic"===d});this.contentEl.html(b);this.dialog.isOpen()||this.dialog.open();
this.bindMoveEventDialog(a.concat(f))},bindMoveEventDialog:function(a){var b=this,f=new c.common.widgets.dropdown.Dropdown(this.id("dropdown"),{change:function(){c.Analytics.api.trackEvent("move-event/trip-picker ")}});0<a.length&&f.setOptions(a);this.setTabs();var d=this.getChildElement("legs"),k=this.getChildElement("trips"),n=this.getChildElement("tripName"),l=this.getChildElement("error"),h=this.getChildElement("moveBtn");k.on("tabs.change",function(){var b=e(this).data("active");0===b&&0===a.length?
h.attr("disabled","disabled"):h.removeAttr("disabled");c.Analytics.api.trackEvent(0===b?"move-event/existing-trip":"move-event/new-trip")});d.on("tabs.change",function(){var a=e(this).data("active");c.Analytics.api.trackEvent(0===a?"move-event/select-all-legs":"move-event/select-one-leg")});h.on("click",function(){function a(){h.off("click");f.destroy()}c.Analytics.api.trackEvent("move-event/move");b.options.optimisticUpdatesEnabled?b.dialog.close():(b.loaderEl.show(),l.hide());var e=1===d.data("active")?
b.legNum:null,g=1===k.data("active")?n.val():null,m=0===k.data("active")?f.getValue():null;c.action.execute("common.trips.ajax.MoveEventAction",b.getMoveRequestData(m,g,e)).done(function(d){d.success?(a(),b.onEventMove(d)):b.options.optimisticUpdatesEnabled?(a(),b.handleGeneralError(),c.events.publish("trips.move.event.failed")):(b.loaderEl.hide(),l.text(d.data.errorMsg),l.show())}).fail(function(d){a();b.handleGeneralError(d);c.events.publish("trips.move.event.failed")});b.options.optimisticUpdatesEnabled&&
(g||(g=f.getText().split("\u2013")[0].trim()),c.events.publish("trips.move.event.finished",{oldTripId:b.tripId,newTripId:m,newTripName:g,resultId:b.resultId,tripId:m,tripName:g,optimisticMove:!0}))})},onEventMove:function(a){var b=this;c.events.publish("trips.move.event.finished",{oldTripId:this.tripId,newTripId:a.data.newTripId,newTripName:a.data.newTripName,resultId:this.resultId,tripId:a.data.newTripId,tripName:a.data.newTripName,tripUrl:a.data.tripUrl,responseData:a.data});c.events.publish("trips.auto.save.data",
{tripId:a.data.newTripId,tripName:a.data.newTripName});this.options.optimisticUpdatesEnabled||(this.loaderEl.hide(),a=c.template.renderElement(this.templates.moveEventActionContent,a.data),this.contentEl.html(a),this.dialog.isOpen()||this.dialog.open(),this.getChildElement("closeBtn").on("click",function(){b.dialog.close();c.Analytics.api.trackEvent("move-event/success-close")}),this.getChildElement("tripLink").on("click",function(){c.Analytics.api.trackEvent("move-event/success-go-to-new")}))},clearData:function(){this.eventId=
this.tripId=null;this.legNum=-1},setTabs:function(){function a(a){a.data("active",a.find("li.selected").index())}this.element.find(".tabs").parent().each(function(){var b=e(this),c=b.find(".tabs li");a(b);c.click(function(){var d=e(this);b.data("active")!==d.index()&&(c.removeClass("selected"),d.addClass("selected"),b.find(".tab").hide(),b.find("#"+d.attr("rel")).show(),a(b),b.trigger("tabs.change"))})})},getMoveRequestData:function(a,b,c){a={oldTripId:this.tripId,newTripId:a,newTripName:b,eventId:this.eventId,
legNum:c};for(var d in a)null===a[d]&&delete a[d];return a}})})(window.R9,window.jQuery);(function(d,e){d.createComponentClass("common.trips.ResultsSavedItems",{savedItemsListContainer:null,savedItemsListEl:null,savedItemsHeader:null,goToTripEl:null,shareToTripsEl:null,compareLink:null,expiryMessageEl:null,headerTitleEl:null,isExpanded:!1,clickElementsToAvoid:null,options:{tripsURL:void 0,globalUrl:null,tripsFullUrl:null,showShareTripIcon:!1,sharingDialogTitle:"",msg:{viewTrip:void 0,viewTrips:void 0,savedToTripItems:void 0,savedToTripsItems:void 0,tripsCounter:void 0},stickyEnabled:!1,
isSaveInPlaceEnabled:void 0,vertical:void 0,searchPollURL:null,optimisticUpdatesEnabled:!1,extraPollRequest:!0,watchlistMakeoverEnabled:!1,tripToastEnabled:!0},listSize:0,tripsMap:{},searchId:void 0,hasNewSearchId:!1,savedItemsHeaderPlaceholder:null,resultItemClass:d.strings.encodeClassName("Base-Results-HorizonResult"),init:function(){this.goToTripEl=this.getChildElement("tripsLink");this.options.showShareTripIcon&&(this.shareToTripsEl=this.getChildElement("shareTripsLink"));this.savedItemsHeader=
this.getChildElement("header");this.savedItemsHeaderPlaceholder=this.getChildElement("headerPlaceholder");this.tripsToggleEl=this.getChildElement("savedItemsList");this.savedItemsListContainer=this.getChildElement("savedItemsList");this.savedItemsListEl=this.savedItemsListContainer.find(".list");this.compareLink=this.getChildElement("CompareLink");this.expiryMessageEl=this.getChildElement("expiryMessage");this.headerTitleEl=this.getChildElement("headerTitle");this.options.isSaveInPlaceEnabled&&this.savedItemsListContainer.hide();
this.options.optimisticUpdatesEnabled=d.config.getBoolean("ui.trips-optimistic-updates.enabled",!1)},inlineComponentsReady:function(){},initSticky:function(){this.options.stickyEnabled&&this.createStickyHeader()},resultsHeaderChanged:function(a){this.hideSavedItemList();var b=!(!a.hasOwnProperty("refreshResults")||!a.refreshResults);this.onSearchPollResponse(a,b)},addEventHandlers:function(){var a=this;this.subscribe("resultItem.saved",e.proxy(this.onItemSaved,this));this.subscribe("resultItem.removed",
e.proxy(this.onItemRemoved,this));this.subscribe(["resultspage.streaming.done","resultspage.refreshed"],e.proxy(this.onSearchPollResponse,this));this.subscribe(this.options.vertical+".results.savedItems.update",this.onSavedResultsUpdate.bind(this));this.subscribe("resultspage.searchId.changed",e.proxy(this.onSearchIdChange,this));this.subscribe("filters.changed",e.proxy(this.onFiltersChange,this));this.subscribe("resultsHeader.changed",e.proxy(this.resultsHeaderChanged,this));this.subscribe("resultspage.streaming.start",
e.proxy(this.initSticky,this));this.subscribe("trips.move.event.finished",e.proxy(this.onItemMoved,this));this.subscribe("trips.move.event.failed",e.proxy(this.onItemMoveFailed,this));this.subscribe("resultsSavedItems.show",e.proxy(this.updateVisibility,this));this.subscribe("resultsSavedItems.hide",e.proxy(this.hideSavedItemList,this));this.savedItemsListEl.on("click",".bookingLink",this.logBookit);this.goToTripEl.on("click",this.logGoToTrip);var b=this.options;if(b.showShareTripIcon)this.shareToTripsEl.on("click",
function(c){c.stopPropagation();c.preventDefault();var f=a.getFirstTrip();c=a.savedItemsListContainer.find("div[data-resultid]").data("resultid");var g=0===f.tripUrl.indexOf("http")?f.tripUrl:a.options.globalUrl+f.tripUrl,f=e("\x3cdiv\x3e").text(f.tripName).html();d.events.publish("share",{page:b.vertical,sourceId:"saveditems-sharetrip",searchId:a.searchId,resultId:c,tripShareUrl:g,tripSourceName:"\x3cdiv\x3e"+f+"\x3c/div\x3e",hideSharingForm:!0,sharingDialogTitle:b.sharingDialogTitle})});e("#"+this.id("expiryMessage")).click(function(){d.events.publish("show.login.options.dialog",
{forceLogin:!0,trackingLabel:"urgency-message"})});if(d.config.getBoolean("trips.cleanupAfterSearch",!0)){var c=this;this.subscribe("resultspage.cleanup",function(a){a===c.searchId&&c.clearState()})}},onItemMoved:function(a){this.addItemToMap(a.newTripId,a.newTripName,a.responseData.tripUrl,a.optimisticMove);this.removeItemFromMap(a.oldTripId,a.optimisticMove);this.updateTripsLinkAndHeader(this.listSize)},onItemMoveFailed:function(){this.restoreTripsMap();this.updateTripsLinkAndHeader(this.listSize)},
logBookit:function(){d.Analytics.api.trackEvent({subPageId:"saved",category:"clickthrough"})},logGoToTrip:function(){d.Analytics.api.trackEvent({subPageId:"saved",category:"go-to-trip"})},onFiltersChange:function(){this.setShowHideListState(!1,!1)},hideSavedItemList:function(){this.element.removeClass("visible")},onSearchIdChange:function(a){this.searchId!==a.searchId&&this.clearState()},clearState:function(){this.hideSavedItemList();this.listSize=0;this.tripsMap={}},onSearchPollResponse:function(a,
b){null==b&&(b=!1);var c=a.searchId&&0<a.searchId.length&&!a.streaming&&this.searchId!==a.searchId;b=b&&this.searchId&&0<this.searchId.length;this.setShowHideListState(this.tripsToggleEl.data("toggle"),!0);c&&(this.searchId=a.searchId);c||b?(c={searchId:this.searchId},a.hasOwnProperty("priceType")&&e.extend(c,{priceType:a.priceType}),this.ajaxSavedSearchPoll(c)):(this.options.watchlistMakeoverEnabled||this.updateVisibility(),a=this.getFirstTripId(),this.tripsMap.hasOwnProperty(a)&&d.events.publish("trips.auto.save.data",
{tripId:a,tripName:this.tripsMap[a].tripName}))},ajaxSavedSearchPoll:function(a){if(this.options.extraPollRequest){var b=this;a&&(a={data:a,beforeScript:function(){b.savedItemsListEl.empty();b.destroyOldResults.bind(b)},enforceCaptcha:d.config.getBoolean("ui.ajax.enforceCaptcha.savedSearchPoll",!0),appendTo:this.options.isSaveInPlaceEnabled?e("\x3cdiv\x3e"):b.savedItemsListEl},d.ajax.execute(b.options.searchPollURL,a))}},destroyOldResults:function(){this.savedItemsListEl.find("."+this.resultItemClass).each(function(){d.ComponentManager.remove(e(this).attr("id"))})},
onSavedResultsUpdate:function(a){this.listSize=a.listSize;this.tripsMap=a.tripsMap;a.savedSearchId&&this.searchId!==a.savedSearchId&&(this.searchId=a.savedSearchId);var b=this.getFirstTripId();this.tripsMap.hasOwnProperty(b)&&d.events.publish("trips.auto.save.data",{tripId:b,tripName:this.tripsMap[b].tripName});this.updateTripsLinkAndHeader(this.listSize);d.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.options.stickyEnabled&&d.events.publish("trips.counter.setValue",{id:this.id("TripsCounter"),
value:this.listSize});this.updateVisibility();this._toggleCompareLink();var c=this.options.vertical;Object.keys(a.openDetails||{}).each(function(a){d.events.publish(c+".inline.detail.heightChanged",{resultId:a})});this.setExpiryMessage(a.expiryMessage)},_toggleCompareLink:function(){this.compareLink.toggleClass("visible",1<this.listSize)},updateVisibility:function(){this.element.toggleClass("visible",0<this.listSize);0<this.listSize&&d.events.publish("trips.updateHeader")},setShowHideListState:function(a,
b){b&&this.tripsToggleEl.data("toggle",a);this.savedItemsListContainer.toggleClass("visible",a)},showToast:function(a){a=e.extend({},a);!a.eventId&&a.eventID&&(a.eventId=a.eventID);a=d.template.render("saveToTripToast",a);d.Widgets.Toaster.addToast(a,{button:!1,escaped:!0,theme:"centered"})},onItemSaved:function(a){var b=this,c=e("#"+a.resultItemElId);c.length||(c=e('[data-resultid\x3d"'+a.resultItemId+'"]'));var g=d.question.ask("resultsHeader.sortMode"),f=this.options.watchlistMakeoverEnabled&&
"watchlist"!==g.sortType,h=c.hasClass("OpenFlex"),g=function(){var a=f||h?c.clone(!0,!0):c.detach();a.show();a.find(".removeItemOverlay").remove();f&&a.find(".Common-Trips-ResultItemSaveToTrips").trigger("forceSaved",a);b.savedItemsListEl.append(a);a=b.savedItemsListEl.find("a.save");a.html(a.html());a=b.savedItemsListEl.find("a.share");a.html(a.html())};0!==this.listSize||f||this.element.addClass("visible");this.listSize++;this.options.isSaveInPlaceEnabled?c.find(".removeItemOverlay").remove():f||
(h?(g(),d.events.publish("filters.changed",{})):c.fadeOut({duration:100,complete:g}));this.options.stickyEnabled&&(d.events.publish("trips.counter.notification.show",{id:b.id("TripsCounter")}),d.events.publish("trips.counter.increase",{id:b.id("TripsCounter")}),setTimeout(function(){d.events.publish("trips.counter.notification.clear",{id:b.id("TripsCounter")})},3E3));!b.options.watchlistMakeoverEnabled&&b.options.tripToastEnabled&&this.showToast(a);d.events.publish("savedItemsListUpdated",{listSize:this.listSize});
this.addItemToMap(a.tripId,a.tripName,a.tripUrl);this.updateTripsLinkAndHeader(this.listSize);this._toggleCompareLink();this.setExpiryMessage(a.responseData.expiryMessage)},onItemRemoved:function(a){var b=this.getResultItemElement(a.resultItemId,this.savedItemsListContainer);this.listSize--;0===this.listSize&&this.element.removeClass("visible");d.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.removeItemFromMap(a.tripId);this.updateTripsLinkAndHeader(this.listSize);this.options.isSaveInPlaceEnabled?
(b=this.getResultItemElement(a.resultItemId),b.find(".removeItemOverlay").remove(),d.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,remove:!0})):this.options.optimisticUpdatesEnabled?(b.detach(),e("#searchResultsList").find(".normalResults").prepend(b),b.find(".removeItemOverlay").remove(),d.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,remove:!0})):b.remove();this._toggleCompareLink();this.options.stickyEnabled&&d.events.publish("trips.counter.decrease",
{id:this.id("TripsCounter")})},removeItemFromMap:function(a,b){var c=this.tripsMap[a];if(b)this.tripsMap.optimisticRemove=c;else if(this.tripsMap.optimisticRemove){delete this.tripsMap.optimisticRemove;return}c&&(c.savedItemsCounter--,0===c.savedItemsCounter&&delete this.tripsMap[a])},addItemToMap:function(a,b,c,d){b={tripId:a,savedItemsCounter:1,tripName:b,tripUrl:c};a=a||"idStub";c=this.tripsMap[a];if(d)this.tripsMap.optimisticSave=b;else if(this.tripsMap.optimisticSave){this.tripsMap.idStub&&(this.tripsMap[a]=
b,delete this.tripsMap.idStub);delete this.tripsMap.optimisticSave;return}c?c.savedItemsCounter++:this.tripsMap[a]=b},restoreTripsMap:function(){var a=this.tripsMap.optimisticSave,b=this.tripsMap.optimisticRemove,c=this.tripsMap[b.tripId];c?c.savedItemsCounter++:this.tripsMap[b.tripId]=b;delete this.tripsMap.optimisticRemove;if(c=this.tripsMap[a.tripId])c.savedItemsCounter--,0===c.savedItemsCounter&&delete this.tripsMap[a.tripId];delete this.tripsMap.optimisticSave},getTripsIds:function(){var a=/^(optimisticRemove|optimisticSave)$/;
return Object.keys(this.tripsMap).filter(function(b){return-1===b.search(a)})},getTripsCount:function(){return this.getTripsIds().length},getFirstTrip:function(){return this.tripsMap[this.getTripsIds()[0]]},getFirstTripId:function(){return this.getTripsIds()[0]||null},updateTripsLinkAndHeader:function(a){var b=this.getTripsIds(),c=b.length;if(c){var e="\x3cstrong\x3e%s\x3c/strong\x3e".format(a),f=this.options.tripsURL;1===c?(b=this.tripsMap[b[0]],c=d.utils.escapeHTML(b.tripName),this.goToTripEl.html(this.options.msg.viewTrip),
this.goToTripEl.attr("href",b.tripUrl),this.headerTitleEl.html(d.Common.Utils.String.formatChoice(this.options.msg.savedToTripItems,a,e,c,b.tripUrl))):(this.goToTripEl.html(this.options.msg.viewTrips),this.goToTripEl.attr("href",f),this.headerTitleEl.html(d.Common.Utils.String.formatChoice(this.options.msg.savedToTripsItems,a,e,c,f)));this.setTripShareUrl(this.getFirstTrip().tripUrl);this.headerTitleEl.find("a").attr("target","_blank");this.goToTripEl.attr("target","_blank")}},setTripShareUrl:function(a){this.options.showShareTripIcon&&
this.shareToTripsEl.attr("href",a)},clearSticky:function(){this.savedItemsHeaderPlaceholder.hide();this.savedItemsHeader.removeClass("sticky layer-sticky")},setSticky:function(){this.savedItemsHeaderPlaceholder.show();this.savedItemsHeader.addClass("sticky layer-sticky");this.savedItemsHeader.css("width",this.element.width())},createStickyHeader:function(a){var b=this;"function"!==typeof a&&(a=e.noop);var c=null;e(document).off("scroll.sticky").on("scroll.sticky",function(){b.savedItemsHeader.is(":visible")&&
null===c&&(c=b.savedItemsHeader.offset().top,b.savedItemsHeaderPlaceholder.height(b.savedItemsHeader.outerHeight()));null!==c&&(e(window).scrollTop()<c?b.clearSticky():b.setSticky())});setTimeout(function(){a()},500)},isSavedItemsOnScreen:function(){return e(window).scrollTop()<this.savedItemsHeader.offset().top+this.savedItemsHeader.outerHeight()},getResultItemElement:function(a,b){a="div[data-resultid\x3d'"+a+"']";return b?b.find(a):e(a)},setExpiryMessage:function(a){this.expiryMessageEl&&(1<this.getTripsCount()?
this.expiryMessageEl.hide():a&&(this.expiryMessageEl.text(d.utils.escapeHTML(a)),this.expiryMessageEl.show()))},avoidElementClick:function(a){return e(a.target).closest(this.clickElementsToAvoid).length}})})(R9,jQuery);(function(b,e){b.createComponentClass("flights.results.scripts.FlightAboveHeaderContent",{options:{searchId:void 0,flexDialogLoaded:!1,airlineMatrixLoaded:!1},flexDialogLoaded:!1,airlineMatrixLoaded:!1,aboveHeadContainer:null,flexMatrixWrapper:null,airlineWrapper:null,init:function(){this.aboveHeadContainer=this.element.closest("#aboveHeaderContainer");this.flexMatrixWrapper=this.element.find(".flexMatrixWrapper");this.airlineWrapper=this.element.find(".airlineWrapper");this.searchId=this.options.searchId;
(this.airlineMatrixLoaded=this.options.airlineMatrixLoaded)&&this.aboveHeadContainer.hasClass("vm-airlinestops")&&this.toggleAirlineMatrix(!0);(this.flexDialogLoaded=this.options.flexDialogLoaded)&&this.aboveHeadContainer.hasClass("vm-plusminusthree")&&this.togglePlusMinusThree(!0)},addEventHandlers:function(){var a=this;this.subscribe("flights.results.flexmatrix.hide",function(){a.togglePlusMinusThree(!1)});this.subscribe("flights.results.airlinestops.hide",function(){a.toggleAirlineMatrix(!1)});
this.subscribe("flights.results.toggle.flex_matrix",function(){a.togglePlusMinusThree()});this.subscribe("flights.results.toggle.airline_matrix",function(){a.toggleAirlineMatrix()});this.subscribe(["search.startSearch","search.searchFailed"],function(){a.flexDialogLoaded=!1;a.airlineMatrixLoaded=!1});this.subscribe("flights.resultspage.flexloaded",function(){a.flexDialogLoaded=!0});this.subscribe("flights.resultspage.airlinestopsloaded",function(){a.airlineMatrixLoaded=!0});this.subscribe("resultspage.searchId.changed",
function(c){a.searchId=c.searchId})},setFilterMatrixView:function(a,c){var b=this.aboveHeadContainer,d="plusminusthree"===a?this.flexMatrixWrapper:"airlinestops"===a?this.airlineWrapper:null;if(!b.hasClass("vm-"+a)||!c)if(e("html, body").animate({scrollTop:0},500),null!=d){if(c){b.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")});d.height(0);b.addClass("vm-"+a);var f=d.children("div").height();d.animate({height:f},function(){d.height("auto")})}else d.animate({height:0},function(){b.removeClass("vm-"+
a)});d.attr("aria-expanded",c)}},toggleAirlineMatrix:function(a){a&&this.aboveHeadContainer.hasClass("vm-airlinestops")||("undefined"===typeof a&&(a=!this.aboveHeadContainer.hasClass("vm-airlinestops")),this.setFilterMatrixView("airlinestops",a),this.airlineMatrixLoaded?(b.events.publish("flights.results.airlinestops.show",a),this.logMatrixInteraction("airlinestops",a)):b.events.publish("flights.resultspage.getairlinematrix"))},togglePlusMinusThree:function(a){a&&this.aboveHeadContainer.hasClass("vm-plusminusthree")||
("undefined"===typeof a&&(a=!this.aboveHeadContainer.hasClass("vm-plusminusthree")),this.setFilterMatrixView("plusminusthree",a),this.flexDialogLoaded?(b.events.publish("flights.results.flexmatrix.show",a),this.logMatrixInteraction("plusminusthree",a)):b.events.publish("flights.resultspage.getflex"))},logMatrixInteraction:function(a,c){b.Analytics.api.trackEvent(a+"/"+(c?"show":"hide"));b.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:a,
value:c?"true":"false"})}})})(R9,jQuery);var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){return function(e,c){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=[],b=!0,f=!1,d=void 0;try{for(var g=e[Symbol.iterator](),h;!(b=(h=g.next()).done)&&(a.push(h.value),!c||a.length!==c);b=!0);}catch(k){f=!0,d=k}finally{try{if(!b&&g["return"])g["return"]()}finally{if(f)throw d;
}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();
(function(e,c){e.createComponentClass("common.results.SortTabContainer",{unrolledTabs:null,rolledTabs:null,moreDropdown:null,slider:null,currentSortState:"",activeTabElement:null,lastUnrolledTab:null,watchListTab:null,watchListCountEl:null,watchListCount:0,unrolledTabsSize:0,watchListAddedMessage:"",firstLoad:!0,watchListMsgTimeoutId:null,distanceTab:null,currentSortBase:"",infoTooltip:null,sortTabSeparator:"_",ascendingDirection:"a",descendingDirection:"b",options:{activeSortTab:"rank_a",showDropdown:!0,
maxUnrolledTabs:3,accountMessage:"",pricePlusMessage:"",priceFromMessage:"",bestValueTabCls:"bestflightTab",formatPrice:!0,watchlistMakeoverEnabled:!1,watchListSortMax:"",watchListAccMsgHide:!1,watchListMsgDuration:2E3,toolTipExtraCssClass:"",customTicketEnabled:!1,customTicketStr:"customTicket_a",showSlideOverlay:!1,sortDirection:""},init:function(){this.unrolledTabs=this.getChildElement("unrolledTabs");this.rolledTabs=this.getChildElement("rolledTabs");this.lastUnrolled=this.getChildElement("lastUnrolled");
this.moreDropdown=this.getChildElement("moreDropdown").getWidget();this.unrolledTabsSize=this.unrolledTabs.attr("data-size");this.options.watchlistMakeoverEnabled&&(this.watchListTab=this.getChildElement("watchlistTab"),this.watchListCountEl=this.getChildElement("watchlistCount"),this.unrolledTabsSize=this.unrolledTabs.attr("data-size"),this.watchListAddedMessage=this.watchListCountEl.parent().attr("data-added"));this.options.showSlideOverlay&&(this.slider=this.getChildElement("slider"));this.ascendingDirection&&
(this.options.sortDirection=this.ascendingDirection)},addEventHandlers:function(){var a=this,b=this;this.subscribe(["resultsHeader.changed","resultspage.sortMode.changed"],this.handleSortModeChange.bind(this));this.subscribe("results.distance.sort.hide",function(){b.element.find("[data-code\x3d'distance']");var a=c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']");c(".rolledTabs").find("[data-code\x3d'distance']");var d=c(".rolledTabs").find("li a:not([data-code\x3d'distance'])").first();
0<a.length&&0<d.length&&b.moveSelectedRolledTab(d);c(".rolledTabs").find("li \x3e a[data-code\x3d'distance']").parent().hide();c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']").parent().addClass("col-hidden");0==c(".rolledTabs").find("li \x3e a:not([data-code\x3d'distance'])").length&&(c(".col-overflow").addClass("col-hidden"),b.element.find(".tabGrid").removeClass("withDropdown"));a=c(".unrolledTabGrid").find("div.col-tab:not('.col-hidden')").length;d=parseInt(b.unrolledTabsSize,
10);b.options.showSlideOverlay&&a!==d&&a<d&&c("div.unrolledTabGrid").removeClass("unrolledCount"+d).addClass("unrolledCount"+a)});this.subscribe("results.distance.sort.show",function(){if("distance"==b.getSortTypeAndDirection(b.options.activeSortTab)[0]){var a=c(".rolledTabs").find("[data-code\x3d'distance']").first();1==a.length&&(a.parent().show(),b.moveSelectedRolledTab(a));0==c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']").length&&(a=c(".unrolledTabGrid").find("div.col-hidden \x3e [data-code\x3d'distance']"),
0<a.length&&a.first().parent.removeClass("col-hidden"))}else c(".unrolledTabGrid").find("div.col-hidden \x3e [data-code\x3d'distance']").parent().removeClass("col-hidden"),c(".rolledTabs").find("[data-code\x3d'distance']").first().parent().show();0<c(".rolledTabs").find("li \x3e a").length&&(c(".col-overflow").removeClass("col-hidden"),b.element.find(".tabGrid").addClass("withDropdown"))});this.element.find("a.sortTab").each(function(b,d){c(d).click(function(b){return a.onSortTabClicked(d,b)});c(d).keypress(function(a){a.preventDefault();
switch(a.which){case e.globals.keyCodes.RETURN:case e.globals.keyCodes.SPACE:c(d).click()}});b=c(d).find(".js-infoTooltip");0!==b.length&&b.toolTip({content:b.data("tooltip"),extraClass:"mm-style sortTabInfoTooltip",position:"bottom"})});this.subscribe("resultspage.searchId.changed",function(b){a.setActiveTab()});this.options.watchlistMakeoverEnabled&&this.watchListTab&&this.watchListTab.length&&(this.subscribe("savedItemsListUpdated",this.enableWatchTab.bind(this)),"watchlist_a"===this.options.activeSortTab&&
this.showWatchList());this.subscribe("search.poll.response",this.handleResultsResponse.bind(this))},onSortTabClicked:function(a,b){var f=c(b.currentTarget).attr("data-sort"),d=this.options.activeSortTab,g=this.getSortTypeAndDirection(d),h=_slicedToArray(g,2),g=h[0],h=h[1],k={};this.options.customTicketEnabled&&(k.customTicket=f===this.options.customTicketStr);e.config.getBoolean("ui.horizon.sortTab.arrowFix.enabled",!1)&&"rank"===a.dataset.code&&(f="rank_a");this.updateSortState(this.activeTabElement||
a,this.options.activeSortTab===f&&"watchlist_a"!==f&&f!==this.options.customTicketStr);f=c(b.currentTarget).attr("data-sort");this.fromCustomTicket(a.dataset.code)&&(f=a.dataset.code+("happinessScore"===a.dataset.code?"_"+this.descendingDirection:"_"+this.ascendingDirection),k.forceChange=!0);e.config.getBoolean("ui.horizon.sortTab.arrowFix.enabled",!1)&&"rank"===a.dataset.code&&(f="rank_a");this.activeTabElement=a;this.options.activeSortTab=f;this.currentSortBase=c(b.currentTarget).attr("data-code");
c(a).parent().hasClass("rolledContainer")&&this.moveSelectedRolledTab(a);a.dataset.sort===d||a.dataset.code===g&&h!==this.options.sortDirection&&!this.isReverseClickSortEnabled()||this.setSortMode(this.options.activeSortTab,k)},handleSortModeChange:function(a){if(a&&a.sortCode){var b=this.getSortTypeAndDirection(a.sortCode)[0];""!==this.currentSortBase&&b===this.currentSortBase||this.updateSortLayout(b);this.setActiveTab(a.customTicket?this.options.customTicketStr:a.sortCode)}},handleResultsResponse:function(a){if(a=
a.sortTabData){this.element.find(".sortTab:not([data-sub-text])").addClass("hideSubTitle");if(a.cheapestPrice){var b=this.element.find(".priceTab"),c="true"===a.useFromMessage?this.options.priceFromMessage:this.options.pricePlusMessage;b.find(".price").text(this.getFormattedSortTabPrice(a.cheapestPrice,c));b.removeClass("hideSubTitle")}a.cheapestBestFlight&&(b=this.element.find("."+this.options.bestValueTabCls),b.find(".price").text(this.getFormattedSortTabPrice(a.cheapestBestFlight)),b.removeClass("hideSubTitle"));
a.shortestDurationFlightPrice&&(b=this.element.find(".durationTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.shortestDurationFlightPrice)),b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightPrice&&(b=this.element.find(".happinessScoreTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestHappinnessScoreFlightPrice)),b.removeClass("hideSubTitle"));a.highestRankHotel&&(b=this.element.find(".rankTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestRankHotel,
this.options.priceFromMessage)),b.removeClass("hideSubTitle"));a.highestUserRatingHotel&&(b=this.element.find(".userratingTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestUserRatingHotel,this.options.priceFromMessage)),b.removeClass("hideSubTitle"));a.cheapestFlightDuration&&(b=this.element.find(".priceTab"),b.find(".duration").text(a.cheapestFlightDuration),b.removeClass("hideSubTitle"));a.shortestDurationFlightDuration&&(b=this.element.find(".durationTab"),b.find(".duration").text(a.shortestDurationFlightDuration),
b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightDuration&&(b=this.element.find(".durationAndPriceRatioTab"),b.find(".duration").text(a.highestHappinnessScoreFlightDuration),b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightDuration&&(b=this.element.find(".happinessScoreTab"),b.find(".duration").text(a.highestHappinnessScoreFlightDuration),b.removeClass("hideSubTitle"));a.bestflightDuration&&(b=this.element.find("."+this.options.bestValueTabCls),b.find(".duration").text(a.bestflightDuration),
b.removeClass("hideSubTitle"))}},getFormattedSortTabPrice:function(a,b){return!0===this.options.formatPrice?(b&&0!==b.length||(b=this.options.pricePlusMessage),e.Common.Utils.String.formatString(b,a)):a},isWatchListActive:function(){return"watchlist"===this.getSortTypeAndDirection(this.options.activeSortTab)[0]},toggleSavedItems:function(a){a?(this.showNavMenuMessage(),e.events.publish("resultsSavedItems.show")):e.events.publish("resultsSavedItems.hide")},enableWatchTab:function(a){if(a){var b=this.watchListCount;
this.watchListCount=a.listSize;0<this.watchListCount?this.showWatchList(b):this.hideWatchList()}this.firstLoad=!1},showWatchList:function(a){this.watchListTab.hasClass("col-hidden")&&(this.watchListTab.removeClass("col-hidden"),this.unrolledTabs.removeClass("unrolledCount"+this.unrolledTabsSize).addClass("unrolledCount"+(this.unrolledTabsSize+1)));this.watchListCountEl[this.watchListCount?"show":"hide"]();this.watchListCountEl.text(9<this.watchListCount?this.options.watchListSortMax:this.watchListCount);
this.showWatchListMessage(a)},hideWatchList:function(){this.watchListTab.hasClass("col-hidden")||(this.watchListTab.addClass("col-hidden"),this.unrolledTabs.removeClass("unrolledCount"+(this.unrolledTabsSize+1)).addClass("unrolledCount"+this.unrolledTabsSize));this.watchListCountEl.text(0);this.isWatchListActive()&&this.watchListTab.next().children().trigger("click")},showWatchListMessage:function(a){this.removeWatchListMessage();clearTimeout(this.watchListMsgTimeoutId);!this.watchListAddedMessage||
this.firstLoad||a>=this.watchListCount||(this.inViewport()?this.showWatchListToolTip():this.animateInView(this.showWatchListToolTip.bind(this)))},showWatchListToolTip:function(a){var b=this;this.watchListCountEl.toolTip({subNameSpace:"watchListAdded",content:this.watchListAddedMessage,position:"bottom",activation:"click",showImmediately:!0,closeOnBodyClick:!1,offsetAgainstEdge:!1,appendTo:"#"+b.watchListTab.attr("id")});this.watchListMsgTimeoutId=setTimeout(function(){b.removeWatchListMessage();"function"===
typeof a&&a()},this.options.watchListMsgDuration)},showNavMenuMessage:function(){this.options.watchListAccMsgHide||(this.options.watchListAccMsgHide=!0,setMetaCookie("watchListAccMsgHide","true"),e.Analytics.api.trackEvent({category:"watchlist",action:"NavMenu-msg-show"}),e.events.publish("NavMenu.showMessage",{id:"profileIcon",text:this.options.accountMessage}))},removeWatchListMessage:function(){this.watchListCountEl.data("toolTip")&&this.watchListCountEl.data("toolTip").removeWidget()},inViewport:function(){var a,
b;a=c(window).scrollTop();b=a+c(window).height();var f,d;f=this.element.offset().top;d=f+this.element.outerHeight();return f<=b&&d>=a},animateInView:function(a){var b=this,f=this.element.children(".tabGrid"),d=this.element.outerHeight();this.element.css("height",d);f.addClass("fixed down");c(window).on("scroll.SortTabContainer",function(){b.inViewport()&&(f.removeClass("fixed down"),c(window).off("scroll.SortTabContainer"))});setTimeout(function(){a(function(){f.removeClass("down");c(window).off("scroll.SortTabContainer");
setTimeout(function(){f.removeClass("fixed");b.element.css("height","")},500)})},500)},updateSortLayout:function(a){a=this.rolledTabs.find("[data-code\x3d'"+a+"']");a.length&&a.attr("data-rank")>this.options.maxUnrolledTabs&&this.moveSelectedRolledTab(a)},moveSelectedRolledTab:function(a){this.lastUnrolledTab=this.lastUnrolled.find(".sortTab");var b=(c(this.lastUnrolledTab).attr("data-rank")||this.options.maxUnrolledTabs)-this.options.maxUnrolledTabs;c(a).detach().appendTo(c(this.lastUnrolled));a=
"li:eq("+b+")";c(this.lastUnrolledTab).detach().appendTo(c(this.rolledTabs.find(a)))},setSortMode:function(){var a=c.extend({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{sortCode:0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.activeSortTab});e.events.publish("resultsHeader.sortType.set",a)},setActiveTab:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.activeSortTab;this.options.activeSortTab=b;var f=this.getSortTypeAndDirection(b);
this.element.find("a.sortTab").each(function(b,e){var d=c(e).attr("data-code")===f[0],g="watchlist"===c(e).attr("data-code");c(e).toggleClass("active",d);c(e).attr("aria-selected",d);a.options.showSlideOverlay&&d&&a.slider.css("transform","translate("+100*b+"%)");d&&a.options.activeSortTab!==c(e).attr("data-sort")&&a.updateSortState(e,!0);a.options.watchlistMakeoverEnabled&&g&&a.toggleSavedItems(d)})},enableTab:function(a){a&&("object"===("undefined"===typeof a?"undefined":_typeof(a))?a.removeClass("disabled"):
this.element.find("a.sortTab[data-code\x3d'"+a+"']").removeClass("disabled"))},disableTab:function(a){a&&("object"===("undefined"===typeof a?"undefined":_typeof(a))?a.addClass("disabled"):this.element.find("a.sortTab[data-code\x3d'"+a+"']").addClass("disabled"))},isDisabledTab:function(a){return a?this.element.find("a.sortTab[data-code\x3d'"+a+"']").hasClass("disabled"):!1},isReverseClickSortEnabled:function(){return e.config.getBoolean("ui.horizon.sortTab.reverseClickSort.enabled",!0)},getSortTypeAndDirection:function(){return(0<
arguments.length&&void 0!==arguments[0]?arguments[0]:"rank_a").split(this.sortTabSeparator)},updateSortState:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.activeTabElement,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1,e,d;b?(e=this.getSortTypeAndDirection(c(a).attr("data-sort")),d=_slicedToArray(e,2),e=d[0],(d=d[1])&&(d=d===this.ascendingDirection?this.descendingDirection:this.ascendingDirection)):(e=c(a).attr("data-code"),d=c(a).attr("data-direction"));
d&&e&&(c(a).attr("data-sort",e+"_"+d),c(a).attr("data-direction",""+d),c(a).toggleClass("ascending",b?!c(a).hasClass("ascending"):c(a).attr("data-icon")===this.ascendingDirection),c(a).attr("aria-label","a"===d?c(a).attr("data-lbl-asc"):c(a).attr("data-lbl-dsc")),this.options.sortDirection=d)},fromCustomTicket:function(a){return this.options.customTicketEnabled&&this.options.activeSortTab===this.options.customTicketStr&&a!==this.currentSortBase}})})(window.R9,window.jq||window.jQuery);var _slicedToArray=function(){return function(c,d){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c)){var a=[],b=!0,f=!1,g=void 0;try{for(var e=c[Symbol.iterator](),h;!(b=(h=e.next()).done)&&(a.push(h.value),!d||a.length!==d);b=!0);}catch(k){f=!0,g=k}finally{try{if(!b&&e["return"])e["return"]()}finally{if(f)throw g;}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();
(function(c,d){c.createComponentClass("base.results.ResultsListHeader",{searchId:null,activeSortMode:{sortType:null,ascending:null},overriddenSortMode:null,options:{sortType:"rank_a",sortUnrolled:!1,quickLinkSort:!1},init:function(){var a=this;this.activeSortMode=this.getSortDataFromString(this.options.sortType);this.answer("resultsHeader.sortMode",function(){return a.activeSortMode})},addEventHandlers:function(){var a=this;this.subscribe("resultsHeader.changed",function(b){return a.onChange(b)});
this.subscribe("resultspage.sortMode.changed",function(b){return a.onChange(b)});this.subscribe("resultsHeader.sortType.set",this.setSortType.bind(this));this.subscribe("resultsHeader.sortType.force",this.forceSortType.bind(this));this.subscribe("resultsHeader.sortType.resetForced",this.resetForcedSortType.bind(this))},onChange:function(a){a.sort?this.activeSortMode=a.sort:a.sortCode&&(this.activeSortMode=this.getSortDataFromString(a.sortCode))},setSortType:function(a){(a=this.processSortParams(a))&&
(a.sortCode!==this.getStringFromSortData(this.activeSortMode)||a.reviewType||a.forceChange)&&(a.isForcedSort||(this.overriddenSortMode=null),a.silent||this.pushSortUpdates(a))},processSortParams:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(a.reviewType)a.sortCode="userrating";else if(!a.sortCode)return this.log.console('missing data sent in "resultsHeader.sortType.set" event.\n                Please publish an object with at least a sortCode or a reviewType property.'),
null;a.sort=this.getSortDataFromString(a.sortCode);"customTicket"===a.sort.sortType&&(a.customTicket=!0);return a},pushSortUpdates:function(a){this.logSortTypeChange(a);c.events.publish("resultsHeader.changed",a)},forceSortType:function(a){if(this.getStringFromSortData(this.activeSortMode)!==a.sortCode){var b=this.activeSortMode;a=d.extend({},a,{isForcedSort:!0});c.events.publish("resultsHeader.sortType.set",a);this.overriddenSortMode=b}},resetForcedSortType:function(){if(this.overriddenSortMode){var a=
{sortCode:this.getStringFromSortData(this.overriddenSortMode)};c.events.publish("resultsHeader.sortType.set",a)}},getSortDataFromString:function(a){a=a.split("_");a=_slicedToArray(a,2);var b=a[1];return{sortType:a[0],ascending:b?"a"===b:null}},getStringFromSortData:function(a){var b=a.sortType;a=a.ascending;return"undefined"===typeof a||null===a?b:b+"_"+(a?"a":"b")},logSortTypeChange:function(a){a.sort&&a.sort.sortType&&a.sort.ascending&&c.Analytics.api.trackEvent({category:"Sort",action:a.sort.sortType,
label:this.generateSortLoggingLabel(a.sort.sortType,a.sort.ascending)})},generateSortLoggingLabel:function(a,b){return a+"_"+(b?"ascending":"descending")}})})(window.R9,window.jq||window.jQuery);(function(d,c){d.createComponentClass("flights.results.FlightResultsListHeader","base.results.ResultsListHeader",{addEventHandlers:function(){this.base();var b=this.element;b.find(".col-views \x3e a").click(function(){b.find(".active").removeClass("active").attr("aria-selected",!1);c(this).addClass("active").attr("aria-selected",!0);d.events.publish("flights.results.setView",c(this).data("view"))});b.find(".col-views \x3e .switch").click(function(){var a=b.find(".col-views \x3e a"),e=a.filter(".active")[0],
a=a.not(".active")[0];c(e).removeClass("active").attr("aria-selected",!1);c(a).addClass("active").attr("aria-selected",!0);d.events.publish("flights.results.setView",c(a).data("view"))});this.subscribe("flights.results.header.setView",function(a){b.find(".col-views \x3e a").removeClass("active").attr("aria-selected",!1);b.find(".col-views \x3e a[data-view\x3d%s]".format(a)).addClass("active").attr("aria-selected",!0)})},generateSortLoggingLabel:function(b,a){switch(b){case "price":return a?"cheapest":
"mostexpensive";case "recommended":return a?"best":"worst";case "duration":return a?"shortest":"longest";case "airline":return a?"AtoZ":"ZtoA";case "depart-takeoff":return a?"early":"late";case "depart":return a?"early":"late";case "return-takeoff":return a?"early":"late";case "return":return a?"early":"late"}}})})(R9,jQuery);(function(b){b.createComponentClass("common.results.CurrencyConversionInfo",{options:{vertical:null,dialogContainerId:"currencyConversionInfoDialogContent",linkSelector:"a.dialog",collapseButtonEnabled:!1},dialog:null,addEventHandlers:function(){this.base();var a=this;this.element.find(this.options.linkSelector).click(function(b){b.preventDefault();a.showDialog()});this.options.collapseButtonEnabled&&a.getChildElement("expand-disclaimer-trigger").click(function(){a.element.toggleClass("collapsed");
a.getChildElement("read-more").toggleClass("hidden");a.getChildElement("collapse").toggleClass("hidden")})},destroyDialog:function(){this.dialog&&(this.dialog.close(),this.dialog=null)},showDialog:function(){this.destroyDialog();this.dialog=this.getChildElement(this.options.dialogContainerId).dialog({}).getWidget();this.dialog.open()}})})(R9);(function(a){a.createComponentClass("common.results.Compliance",{options:{collapse:"",expand:"",showCollapse:!1,defaultCollapsed:!1},block:null,toggleCollapse:null,collapsed:!1,init:function(){this.block=this.getChildElement("frenchWarning");this.toggleCollapse=this.getChildElement("collapse");this.options.defaultCollapsed&&this.options.showCollapse&&!this.collapsed&&this.toggleCollapsed()},addEventHandlers:function(){if(this.options.showCollapse)this.toggleCollapse.on("click",this.toggleCollapsed.bind(this))},
toggleCollapsed:function(){this.collapsed=!this.collapsed;this.block.toggleClass("collapsed",this.collapsed);this.toggleCollapse.text(this.options[this.collapsed?"expand":"collapse"])}})})(R9);(function(d,e){d.createComponentClass("flights.results.PlaceholderList",{options:{legs:2,classes:null,isExpandable:!1},$results:null,init:function(){this.cards=this.element.find(".js-card")},addEventHandlers:function(){var b=this;this.options.isExpandable||this.subscribe(["searchform.submit","multilocale.search.submit"],function(c){b.morphResults(c.legCount)});this.options.isExpandable&&this.subscribe("placeholderlist.expand",{id:this.id()},this.expandList.bind(this));this.$results=this.element.children()},
expandList:function(){function b(){d.dom.swapClasses(e(c.cards[a]),d.stylejam.flights.results.PlaceholderList.expandingCardHidden,d.stylejam.flights.results.PlaceholderList.expandingCardShown);a++;a<f&&setTimeout(b,10)}var c=this,a=0,f=c.cards.length;b()},morphResults:function(b){var c=this.getStlClasses();c&&this.$results.each(function(){var a=e(this).find(".js-leg").parent(),f=a.children().length;if(f<b)for(var g=a.children().eq(0);f++<b;)g.clone().appendTo(a);a.children().each(function(a){d.dom.swapChildrenClasses(e(this),
c,"solo","default");d.dom.swapChildrenClasses(e(this),c,a>=b?"visible":"hidden",a>=b?"hidden":"visible")});1==b&&d.dom.swapChildrenClasses(a.children().eq(0),c,"default","solo")})}})})(R9,jQuery);(function(a,c){a.createComponentClass("common.results.BookingLinksExpiredDialog",{expiredResultsDialog:null,options:{redirectUrl:""},addEventHandlers:function(){a.events.subscribe("search.expired",this.showBookingLinksExpiredDialog.bind(this))},showBookingLinksExpiredDialog:function(){var b=this;if(null===this.expiredResultsDialog){this.expiredResultsDialog=this.element.dialog({onClose:function(){a.events.publish("resultspage.transition.remove")}}).getWidget();var d=this.options.redirectUrl?this.options.redirectUrl:
"/";this.getChildElement("home-btn").click(function(){a.Analytics.api.trackEvent("booklinkexpired/homepage");window.location=d});this.getChildElement("refresh-btn").click(function(){c(document.body).css("cursor","wait");a.Analytics.api.trackEvent("booklinkexpired/refresh");a.config.getInt("ui.rp.limitExpiredReload",!0)?(a.events.publish("user.refresh.expired"),b.expiredResultsDialog&&b.expiredResultsDialog.close()):window.location.reload()})}this.expiredResultsDialog.open()}})})(R9,jQuery);(function(b){window.showUsSanctionedCountriesPopup=function(){window.open("http://www.treasury.gov/resource-center/sanctions/Programs/Pages/Programs.aspx","_blank")};b.createComponentClass("common.results.SearchFailed",{defaultErrorMessage:null,hasUniqueNoResultsMessage:!1,failureTypes:{BAD_QUERY:"query",NO_RESULTS:"noresults",SERVER_ISSUE:"server",TIMEOUT:"timeout"},init:function(){var a=this;this.defaultErrorMessage=this.getChildElement("reason").html();b.events.when(["common.results.NoResults.ready",
"rentals.results.RentalNoResults.ready"],function(){a.hasUniqueNoResultsMessage=!0})},addEventHandlers:function(){var a=this;b.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this));b.events.subscribe("search.startSearch",this.hideSearchFailedView.bind(this));b.events.subscribe("resultspage.requestResults",this.hideSearchFailedView.bind(this));b.question.answer("SearchFailed.isNoResultsStatus",function(b){return a.failureTypes.NO_RESULTS===b})},handleSearchFailure:function(a){this.hasUniqueNoResultsMessage&&
a&&a.type===this.failureTypes.NO_RESULTS?this.hideSearchFailedView():this.showSearchFailedView(a&&a.userDisplayMessage?a.userDisplayMessage:this.defaultErrorMessage)},showSearchFailedView:function(a){this.getChildElement("reason").html(a);this.element.show()},hideSearchFailedView:function(){this.element.hide()}})})(R9);(function(a){a.createComponentClass("common.results.NoResults","common.results.SearchFailed",{options:{vertical:null},addEventHandlers:function(){this.base();var b=this;a.events.ready("common.results.NoResults.ready",this.element);this.getChildElement("newSearchLink").click(function(c){c.preventDefault();a.events.publish(b.options.vertical+".inline.search.form.show",{focus:!0});return!1});a.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this))},handleSearchFailure:function(a){a&&
a.type===this.failureTypes.NO_RESULTS&&this.showSearchFailedView()}})})(R9);(function(d,c){d.createComponentClass("common.results.Paginator",{trackCategory:"Pagination",activeIndex:0,pageCount:0,pageNumberTemplateId:"paginatorItem",numbered:!0,loader:null,loading:!1,activeSearch:!1,options:{button:!1,buttonInfinite:!0,infinite:!1,silent:!1,maxPages:5,infiniteScrollingOffset:0,logUserInteraction:!1,disableDuringPolling:!1},init:function(){this.numbered=!this.options.button&&!this.options.infinite;this.numbered||(this.loader=this.getChildElement("loader"))},addEventHandlers:function(){var a=
this;this.subscribe("resultspage.searchId.changed",function(){a.activeSearch=!0});this.subscribe("resultspage.pageNumber.changed",function(b){a.setIndex(b);a.updateDOM()});this.subscribe("paginator.update",function(b){a.setIndex(b.pageNumber);a.updateBounds(b.pageCount);if(a.options.infinite)if(b.pageNumber===b.pageCount)c(window).off("scroll.pagination");else if(1===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));if(a.options.button){if(b.pageNumber>=b.pageCount||1===b.pageNumber||
!a.options.buttonInfinite)c(window).off("scroll.pagination");else if(2===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));b.pageNumber>=b.pageCount||0===b.pageCount?a.element.removeClass("visible"):a.element.addClass("visible")}a.updateDOM();a.getChildElement("loadMore").blur()});this.subscribe("paginator.hide",function(){a.element.removeClass("visible")});this.numbered?(this.element.find("a.page-Previous").click(function(b){1>=a.activeIndex?b.preventDefault():(a.options.logUserInteraction&&
a.logUserInteraction("Prev"),a.userChangedIndex(--a.activeIndex))}),this.element.find("a.page-Next").click(function(b){a.activeIndex>=a.pageCount?b.preventDefault():(a.options.logUserInteraction&&a.logUserInteraction("Next"),a.userChangedIndex(++a.activeIndex))})):this.subscribe("search.poll.response",function(){a.element.removeClass("loading");a.loading=!1});this.options.button&&(this.getChildElement("loadMore").click(function(){a.element.addClass("loading");a.logUserInteraction("More");a.userChangedIndex(++a.activeIndex)}),
this.getChildElement("loadMore").keypress(function(b){switch(b.which){case d.globals.keyCodes.RETURN:case d.globals.keyCodes.SPACE:a.getChildElement("loadMore").click()}}),this.subscribe("paginator.text.set",function(b){a.getChildElement("loadMore").text(b)}));if(this.options.infinite)c(window).on("scroll.pagination",a.scrollPagination.bind(a));this.options.disableDuringPolling&&(this.subscribe("resultspage.streaming.start",this.disablePaginator.bind(this,!0)),this.subscribe("resultspage.streaming.done",
this.disablePaginator.bind(this,!1)))},logUserInteraction:function(a,b){d.Analytics.api.trackEvent({category:this.trackCategory,action:a,label:b})},scrollPagination:function(){!this.loading&&this.activeSearch&&this.element.offset().top<c(window).scrollTop()+(c(window).height()+this.options.infiniteScrollingOffset)&&(this.element.addClass("loading"),this.loading=!0,this.userChangedIndex(++this.activeIndex))},disablePaginator:function(a){this.element.toggleClass("disabled",a)},userChangedIndex:function(a){this.setIndex(a);
d.events.publish("paginator.change",{pageNumber:a,append:this.options.button||this.options.infinite})},setIndex:function(a){this.activeIndex=a},getIndex:function(){return this.activeIndex},updateBounds:function(a){this.pageCount!==a&&(this.pageCount=a)},updateDOM:function(){var a=this;this.numbered&&!this.options.silent&&c("[page-idx]").each(function(){parseInt(c(this).attr("page-idx"))===a.activeIndex?c(this).removeClass("Paginator-Item-Hidden"):c(this).addClass("Paginator-Item-Hidden")});this.options.infinite||
this.options.button||(1<this.pageCount?(this.element.addClass("visible"),this.numbered&&(this.renderDisplayRange(),this.element.find("a.page-Next, a.page-Previous").removeClass("disabled"),this.activeIndex===this.pageCount?this.element.find("a.page-Next").addClass("disabled"):1===this.activeIndex&&this.element.find("a.page-Previous").addClass("disabled"))):this.element.removeClass("visible"))},renderPageLink:function(a){return d.template.render(this.pageNumberTemplateId,{index:a,cssClass:a===this.activeIndex?
"active":""})},renderEllipsis:function(){return"\x3cspan\x3e\x26nbsp;\x26hellip;\x26nbsp;\x3c/span\x3e"},renderDisplayRange:function(){var a=this,b=this.element.find("div.page-Numbers");b.html("");var d=this.renderPageLink(1),e=0<this.activeIndex-1?this.activeIndex-1:1,f=e+this.options.maxPages-1;f>=this.pageCount&&(f=this.pageCount,e=f-this.options.maxPages+1);for(2<e?d+=this.renderEllipsis():2>e?e=2:--f;e<f;e++)d+=this.renderPageLink(e);f<this.pageCount&&(d+=this.renderEllipsis());d+=this.renderPageLink(this.pageCount);
b.html(d).find("a").click(function(){c(this).parent().hasClass("active")||(a.options.logUserInteraction&&a.logUserInteraction("Page",c(this).data("idx")),a.userChangedIndex(c(this).data("idx")),c(this).parent().addClass("active"))})}})})(R9,jQuery);(function(b,d){b.createComponentClass("flights.results.FlightResultsFooterDisclaimers",{options:{totalPriceEnabled:!1},addEventHandlers:function(){if(this.options.totalPriceEnabled){var c=this.getChildElement("priceDisclaimers");this.subscribe("searchform.submit",function(a){c.toggleClass("fullPrice",0<a.lapInfant)});this.subscribe("resultsHeader.changed",function(a){a.hasOwnProperty("priceType")&&c.toggleClass("fullPrice","totaltaxes"===a.priceType)})}var b=this.getChildElement("hackerFares");this.subscribe("resultspage.streaming.done",
function(){b.removeClass("hidden")})}})})(R9,jQuery);(function(c,f){c.createComponentClass("common.results.AfterclickContainer",{options:{searchId:"",url:"",rateLimitCount:c.config.getInt("ui.afterclick.rate_limited_occurrence",2),rateLimitPeriod:864E5,rateLimitStorageKey:"hotel_afterclick_last",inMemory:!1,ignore:!1,rateLimited:!0},memory:[],dialogContent:null,dialog:null,init:function(){var a=this.options;this.dialogContent=this.getChildElement("content");a.rateLimitStorageKey||(a.rateLimitStorageKey="hotel_afterclick_last")},addEventHandlers:function(){var a=
this,b=a.options;a.subscribe("multibook.providerClicked",function(d){d&&d.afterclickIgnore||b.ignore||a.openAfterclick(d.resultId)});a.subscribe("resultspage.searchId.changed",function(d){var c=b.searchId;d&&c!==d.searchId&&(b.searchId=d.searchId,a.update())})},update:function(){var a=this;c.ajax.execute("common/results/AfterclickContainer",{data:a.options,replace:!0,customUpdate:function(b){a.destroy();a.element.replaceWith(b.innerHTML);return!0}})},rateLimit:function(){var a=this.options,b=a.rateLimitStorageKey;
return"prevent"===c.storage.get("prevent-afterclick")?(c.storage.remove("prevent-afterclick"),!0):a.rateLimited?a.inMemory?(b=this.getTimeList(this.memory))?(this.memory=b,!1):!0:c.storage.isAvailable()&&b?(a=this.getTimeList(c.storage.get(b)))?(c.storage.set(b,a),!1):!0:!1:!1},getTimeList:function(a){var b=new Date,d=this.options,c=isNaN(d.rateLimitCount)?2:d.rateLimitCount,d=isNaN(d.rateLimitPeriod)?864E5:d.rateLimitPeriod;if(0===c)return null;"string"===typeof a&&(a=[]);if(!a||a.length<c)return a?
a.concat(b.getTime()):[b.getTime()];for(var e=0;e<c;e++){if(isNaN(a[e]))return[b.getTime()];if(b.getTime()-(new Date(a[e])).getTime()>d)return a[e]=b.getTime(),a}return null},openAfterclick:function(a){var b=this;b.dialog&&b.dialog.isOpen()||!b.options.url||!b.options.searchId||b.rateLimit()||(a={resultId:a,searchId:b.options.searchId},c.Analytics.api.trackEvent({category:"AfterClick",action:"request"}),c.ajax.execute(b.options.url,{data:a,appendTo:this.dialogContent,replace:!0}).then(function(a){b.dialog=
b.getChildElement("afterclickdialog").dialog({extraCssClass:"afterclickModal"}).getWidget();a=b.getChildElement("content").children().eq(0);if(f("#acerror").length){try{c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:f("#acerror").get(0).innerText.trim()})}catch(g){}console.log(f("#acerror").get(0).innerText)}else c.Analytics.api.trackEvent({category:"AfterClick",action:"displayed"}),b.options.responsive?(b.dialog.setContentDimensions(a.outerWidth(),a.outerHeight(),"95%"),
b.dialog.setViewPortOverflow("hidden")):b.dialog.setContentDimensions(a.outerWidth(),a.outerHeight()),b.dialog.setOption("onClose",function(){c.Analytics.api.trackEvent({category:"AfterClick",action:"closed"})}),b.dialog.open(),c.events.publish("afterclick.dialog.opened")}).fail(function(a){c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:"ajax"})}))}})})(window.R9,window.jQuery||window.jq);(function(g,c){g.createWidgetClass("text.EmailInput",{options:{maxEmails:-1,placeholder:"",readonly:!1},inputElem:null,init:function(){this.inputElem=this.getChildElement("inputEl");var a=this;setTimeout(function(){a.processValue(a.inputElem.val())},1)},addEventHandlers:function(){var a=this;this.addInputEventHandlers();this.element.on("click",".email",function(){c(this).remove();a.checkRestrictions();a.updateValue()})},addInputEventHandlers:function(){var a=this,d=!0;a.inputElem.on("keyup",function(b){switch(b.which){case 32:a.handleSpaceKey();
break;case 8:b=a.inputElem.val();var e=b.split(" "),e=a.addEmail(e);c.trim(b)!==c.trim(e)&&a.inputElem.val(e);d=!0;break;default:a.checkComma()}}).on("keydown",function(b){switch(b.which){case 13:case 9:a.handleReturnKey(b);break;case 8:0===a.getCaretPosition()&&d&&(a.element.find(".email").last().remove(),a.checkRestrictions(),a.updateValue()),d=!1}}).on("focus",function(){a.element.addClass("focused")}).on("blur",function(b){a.handledReturnID||a.handleReturnKey(b);a.element.removeClass("focused")})},
checkComma:function(){var a=c.trim(this.inputElem.val());","===a[a.length-1]&&(a=this.addEmail([a.substring(0,a.length-1)]),""===c.trim(a)&&this.inputElem.val(""))},handleSpaceKey:function(){""===this.addEmail([this.inputElem[0].value])&&(this.inputElem[0].value="")},handleReturnKey:function(a){var d=this;d.handledReturnID&&clearTimeout(d.handledReturnID);this.handledReturnID=setTimeout(function(){d.handledReturnID=null},100);var b=this.inputElem[0].value,e=b.split(" ");this.addEmail(e,!0);this.inputElem[0].value=
"";if(13===a.which||""!==c.trim(b))a.stopPropagation(),a.preventDefault()},getCaretPosition:function(){var a=0,d=this.inputElem[0];if(document.selection)d.focus(),a=document.selection.createRange(),a.moveStart("character",-d.value.length),a=a.text.length;else if(d.selectionStart||"0"==d.selectionStart)a=d.selectionStart;return a},val:function(a){if("undefined"!==typeof a)this.processValue(a);else return this.getValue()},processValue:function(a){this.element.find(".email").remove();this.inputElem[0].value=
a?this.addEmail(a.split(",")):"";this.updateValue()},isValidEmail:function(a){a=c.trim(a);return"function"===typeof window.validateEmail?validateEmail(a):/^[a-zA-Z0-9.!#$%&\u2019*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)},prepareEmailElem:function(a){a=c.trim(a);if(!a)return!1;var d=c("\x3cdiv class\x3d'email'\x3e\x3c/div\x3e");c(document.createTextNode(a)).appendTo(d);return d},addEmail:function(a,d){var b=this,e="";c.each(a,function(c,f){if(0<b.options.maxEmails&&c>=b.options.maxEmails)return!1;
if(b.isValidEmail(f)){if(c=b.prepareEmailElem(f))c.insertBefore(b.inputElem),b.checkRestrictions(),b.updateValue()}else{a.splice(0,c);c=a.join(" ");if(d){if(c=b.prepareEmailElem(c))c.insertBefore(b.inputElem),b.checkRestrictions(),b.updateValue()}else e=c;return!1}});return e},updateValue:function(){var a=this.element.find(".email").map(function(){return c(this).text()}).get().join();this.element.val(a);this.getChildElement("hidnEl").val(a)},getValue:function(){var a=this.element.val(),d=c.trim(this.inputElem.val());
""!==d&&(a+=","+d);return a},checkRestrictions:function(){var a=this.element.find(".email").length;0<this.options.maxEmails&&(a>=this.options.maxEmails?(this.element.addClass("disabled"),this.inputElem.prop("disabled",!0)):(this.element.removeClass("disabled"),this.inputElem.prop("disabled",!1)));a?(this.inputElem.prop("placeholder",""),this.options.readonly&&this.inputElem.prop("readonly","readonly")):(this.inputElem.prop("placeholder",this.options.placeholder),this.options.readonly&&this.inputElem.prop("readonly",
""))}})})(window.R9,window.jq||window.jQuery);/*
 clipboard.js v1.7.1
 https://zenorocha.github.io/clipboard.js

 Licensed MIT © Zeno Rocha
*/
(function(m){"object"==typeof exports&&"undefined"!=typeof module?module.exports=m():"function"==typeof define&&define.amd?define([],m):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=m()})(function(){return function f(h,k,a){function b(d,g){if(!k[d]){if(!h[d]){var c="function"==typeof require&&require;if(!g&&c)return c(d,!0);if(e)return e(d,!0);g=Error("Cannot find module '"+d+"'");throw g.code="MODULE_NOT_FOUND",g;}g=k[d]={exports:{}};
h[d][0].call(g.exports,function(a){return b(h[d][1][a]||a)},g,g.exports,f,h,k,a)}return k[d].exports}for(var e="function"==typeof require&&require,l=0;l<a.length;l++)b(a[l]);return b}({1:[function(f,h,k){"undefined"==typeof Element||Element.prototype.matches||(f=Element.prototype,f.matches=f.matchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector||f.webkitMatchesSelector);h.exports=function(a,b){for(;a&&9!==a.nodeType;){if("function"==typeof a.matches&&a.matches(b))return a;
a=a.parentNode}}},{}],2:[function(f,h,k){function a(a,l,d,g){return function(c){c.delegateTarget=b(c.target,l);c.delegateTarget&&g.call(a,c)}}var b=f("./closest");h.exports=function(b,l,d,g,c){var e=a.apply(this,arguments);return b.addEventListener(d,e,c),{destroy:function(){b.removeEventListener(d,e,c)}}}},{"./closest":1}],3:[function(f,h,k){k.node=function(a){return void 0!==a&&a instanceof HTMLElement&&1===a.nodeType};k.nodeList=function(a){var b=Object.prototype.toString.call(a);return void 0!==
a&&("[object NodeList]"===b||"[object HTMLCollection]"===b)&&"length"in a&&(0===a.length||k.node(a[0]))};k.string=function(a){return"string"==typeof a||a instanceof String};k.fn=function(a){return"[object Function]"===Object.prototype.toString.call(a)}},{}],4:[function(f,h,k){function a(a,b,c){return a.addEventListener(b,c),{destroy:function(){a.removeEventListener(b,c)}}}function b(a,b,c){return Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)}),{destroy:function(){Array.prototype.forEach.call(a,
function(a){a.removeEventListener(b,c)})}}}var e=f("./is"),l=f("delegate");h.exports=function(d,g,c){if(!d&&!g&&!c)throw Error("Missing required arguments");if(!e.string(g))throw new TypeError("Second argument must be a String");if(!e.fn(c))throw new TypeError("Third argument must be a Function");if(e.node(d))return a(d,g,c);if(e.nodeList(d))return b(d,g,c);if(e.string(d))return l(document.body,d,g,c);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");
}},{"./is":3,delegate:2}],5:[function(f,h,k){h.exports=function(a){if("SELECT"===a.nodeName)a.focus(),a=a.value;else if("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName){var b=a.hasAttribute("readonly");b||a.setAttribute("readonly","");a.select();a.setSelectionRange(0,a.value.length);b||a.removeAttribute("readonly");a=a.value}else{a.hasAttribute("contenteditable")&&a.focus();var b=window.getSelection(),e=document.createRange();e.selectNodeContents(a);b.removeAllRanges();b.addRange(e);a=b.toString()}return a}},
{}],6:[function(f,h,k){function a(){}a.prototype={on:function(a,e,l){var b=this.e||(this.e={});return(b[a]||(b[a]=[])).push({fn:e,ctx:l}),this},once:function(a,e,l){function b(){g.off(a,b);e.apply(l,arguments)}var g=this;return b._=e,this.on(a,b,l)},emit:function(a){for(var b=[].slice.call(arguments,1),l=((this.e||(this.e={}))[a]||[]).slice(),d=0,g=l.length;d<g;d++)l[d].fn.apply(l[d].ctx,b);return this},off:function(a,e){var b=this.e||(this.e={}),d=b[a],g=[];if(d&&e)for(var c=0,f=d.length;c<f;c++)d[c].fn!==
e&&d[c].fn._!==e&&g.push(d[c]);return g.length?b[a]=g:delete b[a],this}};h.exports=a},{}],7:[function(f,h,k){(function(a,b){if(void 0!==k)b(h,f("select"));else{var e={exports:{}};b(e,a.select);a.clipboardAction=e.exports}})(this,function(a,b){var e=b&&b.__esModule?b:{default:b},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){return b&&a(c.prototype,b),d&&a(c,d),c}}();b=function(){function a(c){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.resolveOptions(c);this.initSelection()}return d(a,[{key:"resolveOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=a.action;
this.container=a.container;this.emitter=a.emitter;this.target=a.target;this.text=a.text;this.trigger=a.trigger;this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var a=this,b="rtl"==document.documentElement.getAttribute("dir");this.removeFake();this.fakeHandlerCallback=function(){return a.removeFake()};this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0;this.fakeElem=
document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[b?"right":"left"]="-9999px";this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;this.container.appendChild(this.fakeElem);this.selectedText=(0,e.default)(this.fakeElem);this.copyText()}},
{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null);this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,e.default)(this.target);this.copyText()}},{key:"copyText",value:function(){var a=void 0;try{a=document.execCommand(this.action)}catch(p){a=!1}this.handleResult(a)}},{key:"handleResult",value:function(a){this.emitter.emit(a?
"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus();window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){if(this._action=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"copy","copy"!==this._action&&"cut"!==this._action)throw Error('Invalid "action" value, use either "copy" or "cut"');
},get:function(){return this._action}},{key:"target",set:function(a){if(void 0!==a){if(!a||"object"!==(void 0===a?"undefined":f(a))||1!==a.nodeType)throw Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&a.hasAttribute("disabled"))throw Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(a.hasAttribute("readonly")||a.hasAttribute("disabled")))throw Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');
this._target=a}},get:function(){return this._target}}]),a}();a.exports=b})},{select:5}],8:[function(f,h,k){(function(a,b){if(void 0!==k)b(h,f("./clipboard-action"),f("tiny-emitter"),f("good-listener"));else{var e={exports:{}};b(e,a.clipboardAction,a.tinyEmitter,a.goodListener);a.clipboard=e.exports}})(this,function(a,b,e,f){function d(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a,b){a="data-clipboard-"+a;if(b.hasAttribute(a))return b.getAttribute(a)}var h=d(b);b=d(e);var k=d(f),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},
n=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){return d&&a(b.prototype,d),c&&a(b,c),b}}();f=function(a){function b(a,d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var c;c=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
c=!c||"object"!=typeof c&&"function"!=typeof c?this:c;return c.resolveOptions(d),c.listenClick(a),c}return g(b,a),n(b,[{key:"resolveOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof a.action?a.action:this.defaultAction;this.target="function"==typeof a.target?a.target:this.defaultTarget;this.text="function"==typeof a.text?a.text:this.defaultText;this.container="object"===l(a.container)?a.container:document.body}},{key:"listenClick",
value:function(a){var b=this;this.listener=(0,k.default)(a,"click",function(a){return b.onClick(a)})}},{key:"onClick",value:function(a){a=a.delegateTarget||a.currentTarget;this.clipboardAction&&(this.clipboardAction=null);this.clipboardAction=new h.default({action:this.action(a),target:this.target(a),text:this.text(a),container:this.container,trigger:a,emitter:this})}},{key:"defaultAction",value:function(a){return c("action",a)}},{key:"defaultTarget",value:function(a){if(a=c("target",a))return document.querySelector(a)}},
{key:"defaultText",value:function(a){return c("text",a)}},{key:"destroy",value:function(){this.listener.destroy();this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],b=!!document.queryCommandSupported;return("string"==typeof a?[a]:a).forEach(function(a){b=b&&!!document.queryCommandSupported(a)}),b}}]),b}(b.default);a.exports=f})},{"./clipboard-action":7,
"good-listener":4,"tiny-emitter":6}]},{},[8])(8)});(function(d,e){var f={hotels:"hotels/results/HotelShare",cruises:"cruises/results/CruiseShare",cars:"cars/results/CarShare",rentals:"rentals/results/RentalShare",flights:"flights/results/FlightShare",trains:"trains/results/TrainShare"};d.createComponentClass("common.results.Sharing",{dialog:null,urlInput:null,clipper:null,copyTooltip:null,emailFrom:null,emailTo:null,emailMessage:null,message:null,form:null,send:null,hid:null,rating:null,photoColumn:null,cityName:"",cityImageUrl:"",options:{vertical:"hotels",
sourceId:void 0,messages:{},photoColumn:!1,hasRating:!1,useStars:!0,smartEmail:!1},init:function(){this.form=this.getChildElement("form");this.urlInput=this.getChildElement("url");this.urlInput.attr("data-clipboard-target","#"+this.id("url"));"undefined"!==typeof window.Clipboard?this.clipper=new Clipboard(".clipboardTrigger"):(this.element.find(".col-copy").hide(),this.element.find(".col-url").removeClass("col-url").addClass("col"));this.copyTooltip=this.getChildElement("tooltip");this.emailFrom=
this.getChildElement("emailFrom");this.emailTo=this.getChildElement("emailTo");this.emailMessage=this.getChildElement("emailMessage");this.hid=this.getChildElement("sharing_email_resultid");this.send=this.getChildElement("send");this.options.photoColumn&&(this.options.hasRating&&(this.rating=this.getChildElement("rating").children()),this.photoColumn=this.getChildElement("photoColumn"))},addEventHandlers:function(){var a=this;if(null!==this.clipper)this.clipper.on("success",function(b){d.Analytics.api.trackEvent({category:"Share",
action:"copy-link"});a.copyTooltip.addClass("show");setTimeout(function(){a.copyTooltip.removeClass("show")},2E3)});d.events.subscribe("share",function(b){if(b&&("flighttracker"===b.page||"explore"===b.page))return b.sourceId&&b.sourceId!==a.options.sourceId||(a.createDialog(),a.dialog.open(),setTimeout(function(){a.urlInput.val(b.url);a.urlInput.focus()},100)),!1;var c=f[a.options.vertical];c?a.openForm(b,c):console.warn("No share component found for current vertical: "+a.options.vertical)});this.form.on("submit",
function(b){a.options.smartEmail?(a.emailTo.getWidget().val(a.emailTo.val().replace(" ","")),a.emailFrom.getWidget().val(a.emailFrom.val().replace(" ",""))):(a.emailTo.val(a.emailTo.val().replace(" ","")),a.emailFrom.val(a.emailFrom.val().replace(" ","")));b=validateEmail(a.emailFrom.val());var c=a.validateToField();a.emailTo.toggleClass("form-error",!c);a.emailFrom.toggleClass("form-error",!b);c&&b?(a.send.attr("disabled","disabled"),a.showMessage("SHARING_PROGRESS"),e.ajax({type:"POST",url:d.globals.remoteHost+
"/s/emailresult",data:a.form.serialize(),headers:{"X-CSRF":d.globals.formtoken},success:function(){d.events.publish("share.success",a.getChildElement("sharing_email_resultid").val());a.send.removeAttr("disabled");a.dialog&&a.showSuccess("SHARING_SUCCESS");d.Analytics.api.trackEvent({category:"Share",action:"share-result"})},error:function(){a.showError("SHARING_ERROR");a.send.removeAttr("disabled")}})):(a.showError("EMAIL_ERROR"),a.options.smartEmail&&(a.emailTo.getWidget().checkRestrictions(),a.emailFrom.getWidget().checkRestrictions()));
return!1})},createDialog:function(){var a=this;this.dialog=this.dialog||this.getChildElement("dialog").dialog({isOpenTopZindex:!0,onClose:function(){a.emailTo.removeClass("form-error");a.emailFrom.removeClass("form-error");a.clearMessage();d.Analytics.api.trackEvent({category:"Share",action:"close-share"});a.options.photoColumn&&a.clearSharingData()}}).getWidget()},openForm:function(a,b){var c=this;this.options.hasRating=null;d.action.execute(b,{searchId:a.searchId,resultId:a.resultId,filterState:d.question.ask("resultspage.urlFilterState.get")},
function(b){var d=a.tripShareUrl?a.tripShareUrl:b.url;a.sharingDialogTitle&&""!==a.sharingDialogTitle&&c.getChildElement("title").html(a.sharingDialogTitle);c.urlInput.val(d);c.createDialog();c.dialog.open();c.urlInput.focus();c.getChildElement("sharing_email_fs").val(b.fs);c.getChildElement("sharing_email_subject").val(b.emailSubject);c.getChildElement("sharing_email_searchid").val(a.searchId);c.getChildElement("sharing_email_resultid").val(a.resultId);c.options.photoColumn&&c.addSharingData(e.extend({},
a,b));a.hideSharingForm&&(c.element.addClass("no-sharing-form"),c.getChildElement("sharingForm").hide())})},addSharingData:function(a){a.hasOwnProperty("tripSourceName")?this.getChildElement("sourceName").html(a.tripSourceName):a.hasOwnProperty("sourceName")&&this.getChildElement("sourceName").html(a.sourceName);a.hasOwnProperty("hotelName")&&this.getChildElement("sourceName").html(a.hotelName);a.hasOwnProperty("sourceImageUrl")?(this.photoColumn.removeClass("hidden").css({"background-image":"none"}),
this.photoColumn.animate({opacity:0},0).css({"background-image":'url("'+a.sourceImageUrl+'")'}).animate({opacity:1},1E3)):d.Common.Utils.String.isEmpty(this.cityImageUrl)&&this.photoColumn.addClass("hidden");this.rating&&(a.hasOwnProperty("rating")?(this.rating.removeClass(function(a,c){return(c.match(/(^|\s)count-\S+/g)||[]).join(" ")}),this.rating.addClass("count-"+a.rating),this.rating.attr("data-count",a.rating),!a.useStars&&this.options.useStars&&this.rating.removeClass("starIcon").addClass("circleIcon"),
a.useStars||this.options.useStars?this.rating.find(".star").removeClass("circle"):this.rating.find(".star").addClass("circle")):this.rating.attr("aria-hidden","true"))},validateToField:function(){var a=this.emailTo.val().split(","),b=!0;e.each(a,function(a,d){validateEmail(d.replace(" ",""))||(b=!1)});return b},showMessage:function(a){this.getChildElement("message").removeClass("success error").html(this.options.messages[a])},showError:function(a){this.getChildElement("message").removeClass("success").addClass("error").html(this.options.messages[a])},
showSuccess:function(a){this.getChildElement("message").removeClass("error").addClass("success").html(this.options.messages[a])},clearMessage:function(){this.getChildElement("message").html("")},clearSharingData:function(){this.photoColumn.hasClass("hidden")&&this.photoColumn.removeClass("hidden");this.options.hasRating&&null!==this.rating&&this.rating.hasClass("circleIcon")&&this.rating.removeClass("circleIcon").addClass("starIcon")}})})(window.R9,window.jq||window.jQuery);(function(d,b){d.createComponentClass("common.results.ResultsPageNotifications",{options:{openDuration:6E3,priceAlertUiUpdate:!1},open:!1,queue:null,showTimeoutId:null,messageContainer:null,init:function(){this.queue=[];this.messageContainer=this.getChildElement("container").detach()},inlineComponentsReady:function(){this.toolTip=this.getChildElement("target").getWidget();this.toolTip.setOption("onClose",this.closeMessage.bind(this));this.toolTip.setOption("keepOpenOnContentHover",!0);this.toolTip.setOption("closeOnBodyClick",
!1);this.toolTip.setOption("fixedPositioning",{bottom:"50px",top:"inherit"})},addEventHandlers:function(){var a=this;this.options.priceAlertUiUpdate||this.subscribe("resultspage.notify",this.queueMessage.bind(this));b(document).on("click.notificationTooltip","#r9-tooltiprpnotify-wrapper .js-close",function(){a.open&&a.toolTip.close()})},destroy:function(){this.base();b(document).off("click.notificationTooltip")},queueMessage:function(a){this.queue.push(a);this.open||this.showNextMessage()},showNextMessage:function(){this.showTimeoutId&&
window.clearTimeout(this.showTimeoutId);this.showTimeoutId=window.setTimeout(this.handleNextMessage.bind(this),100)},handleNextMessage:function(){var a=this.queue.splice(0,1)[0];if(a&&a.content){this.messageContainer.find(".js-content").empty().append(a.content);this.toolTip.setContent(this.messageContainer);this.toolTip.open();this.open=!0;var c="number"===typeof a.openDuration?a.openDuration:this.options.openDuration;if(a.keepOpen||a.openWhileIdle){if(a.openWhileIdle)b(document).one("mousemove scroll click",
function(){this.toolTip.closeAfter(c)}.bind(this))}else this.toolTip.closeAfter(c)}},prepareMessage:function(a){this.messageContainer.find(".js-content").empty().append(a);return this.messageContainer},closeMessage:function(){this.open=!1;this.queue.length&&this.showNextMessage()}})})(R9,jQuery);(function(d,f){d.createComponentClass("common.compareto.v3.RightRailCompareTo",{options:{pageOrigin:null,searchId:null,noUpdateFlash:!1,compareToItems:[],placement:{},type:"",vertical:""},updatePromise:"",path:"common/compareto/v3/RightRailCompareTo",init:function(){this.button=this.getChildElement("all")},addEventHandlers:function(){var b=this,a=b.options;b.subscribe("resultspage.searchId.changed",function(e){var c=a.searchId;e&&c!==e.searchId&&(b.destroy(),a.searchId=e.searchId,a.noUpdateFlash||
b.element.html(""),b.update())});var c={type:a.type,placement:a.placement,searchId:a.searchId};b.button.on("click",function(){window["@r9/cmp2-ui"].onDirectClick(a.compareToItems,c)});b.button.on("mouseup",function(){window["@r9/cmp2-ui"].onDirectMouseUp(a.compareToItems,c)});b.button.on("mousedown",function(){window["@r9/cmp2-ui"].onDirectMouseDown(a.compareToItems,c)});f(".provider-item-row",b.element).on("click",function(a){a=f(a.currentTarget);d.events.publish("ecommerce.track",{event:"cmp2.rr"});
d.events.publish("gtm.update",{event:"compareTo",providerName:a.data("providername")});return!1});d.events.publish("hotels.results.cmp2.rightrail.loaded",{cmp2Items:this.options.compareToItems,searchId:this.options.searchId});d.question.answer("hotels.results.cmp2.data",function(){return{cmp2Items:b.options.compareToItems,searchId:b.options.searchId}})},update:function(b){var a=this,c=a.options,e=a.element;a.updatePromise&&a.updatePromise.abort();a.updatePromise=d.ajax.execute(a.path,{data:f.extend(!0,
{},{pageOrigin:c.pageOrigin,searchId:c.searchId,vertical:c.vertical},b||{}),replace:!0,customUpdate:function(b){a.destroy();e.replaceWith(b.innerHTML)}}).fail(function(){e.html("")})}})})(window.R9,window.jQuery||window.jq);(function(d,f,e){d.createComponentClass("common.kn.AdsenseService",{widgets:{},locations:{right:0,bottom:1},init:function(){this.defaultPageOptions={linkTarget:"_blank",adsResponseCallback:this._handleResponseCallback.bind(this),adLoadedCallback:this._handleAdLoadedCallback.bind(this)};this._doAdsenseRefresh=d.Common.Utils.debounce(this._doAdsenseRefresh.bind(this),1E3)},addEventHandlers:function(){this.subscribe("adsense.register.text.widget",this._handleRegisterWidget.bind(this));this.subscribe("adsense.update.text.widget",
this._handleUpdateWidget.bind(this));this.subscribe("adsense.trigger",this._triggerAdsenseRefresh.bind(this));this.subscribe("adsense.update.text.options",this._onUpdateTextOptions.bind(this))},_handleRegisterWidget:function(a){a&&a.id&&!this.widgets[a.id]&&this._addOrUpdateWidget(a)},_handleUpdateWidget:function(a){a&&a.id&&this.widgets[a.id]&&(this.widgets[a.id].refreshed=!1)},_addOrUpdateWidget:function(a){var b=Object.getOwnPropertyNames(this.widgets).length;d.config.getBoolean("ui.horizon.common.kn.adsense.single.req.widget.order.from.location",
!1)&&a.pageLocation&&this.locations.hasOwnProperty(a.pageLocation)&&(b=this.locations[a.pageLocation]);this.widgets[a.id]=e.extend({},{order:b,refreshed:!1},a)},_triggerAdsenseRefresh:function(){var a=this,b=Object.getOwnPropertyNames(this.widgets).map(function(b){return a.widgets[b]});b.filter(function(a){return!a.refreshed}).length===b.length&&this._doAdsenseRefresh()},_doAdsenseRefresh:function(){if(f._googCsa){var a=["ads",this.pageOptions].concat(this._getAdBlocks());f._googCsa.apply(null,a)}},
_handleResponseCallback:function(a){var b=this;a&&Object.getOwnPropertyNames(this.widgets).forEach(function(c){a.hasOwnProperty(c)&&(c=b.widgets[c].impressionURL+a[b.id("ads")],e.get(c))})},_handleAdLoadedCallback:function(a,b){b&&this.widgets.hasOwnProperty(a)&&(this.widgets[a].refreshed=!0,this.widgets[a].adLoadedCallback(a,b))},_getAdBlocks:function(){var a=this;return Object.getOwnPropertyNames(this.widgets).sort(function(b,c){return a.widgets[b].order-a.widgets[c].order}).map(function(b){return a.widgets[b].textAdSettings()}).filter(function(a){return null!=
a})},_onUpdateTextOptions:function(a){var b=a.id;this.widgets[b]&&(this.widgets[b]=e.extend({},this.widgets[b],{impressionURL:a.impressionURL}));this.pageOptions=e.extend({},this.defaultPageOptions,a.pageOptions)}});d.publish("common.kn.AdsenseTextService",{_instance:null,initialize:function(){null===this._instance&&(this._instance=new d.common.kn.AdsenseService)}})})(R9,window,jQuery);(function(b,c){b.createComponentClass("common.kn.Text",{options:{displayOptions:{colorBackground:"#FAFAFC",fontSizeTitle:15,colorTitleLink:"#1E93F5",colorDomainLink:"#D8580B",colorText:"#444",noTitleUnderline:!0,width:void 0},adBlockOptions:null,pageOptions:null,pageLocation:null,title:null,minRefreshRate:null,gptIframeTitle:null,order:null},adTimeout:null,init:function(a){a=new b.common.kn.Mixin;a.loadGPT();a.loadAdsense();this.title=this.getChildElement("title");this.showTitle(!1);this.isAdsenseSingleReqEnabled()&&
b.common.kn.AdsenseTextService.initialize();this.publishAdsRequest()},addEventHandlers:function(){this.subscribe("resultspage.ads.update",this.onResultsPageAdsUpdate.bind(this));this.subscribe("resultspage.adinfo.empty",this.publishAdsRequest.bind(this))},inlineComponentsReady:function(){this.publishAdsRequest();this.hasPageOptions()&&this.checkQAd()},publishAdsRequest:function(){b.events.publish("ads.request",{adType:"textAd",pageLocation:this.options.pageLocation,now:!this.hasPageOptions(),events:["searchform.submit",
"resultsHeader.changed","filters.changed","paginator.change"],minRefreshRate:this.options.minRefreshRate});this.isAdsenseSingleReqEnabled()&&b.events.publish("adsense.register.text.widget",{id:this.id("ads"),pageLocation:this.options.pageLocation,textAdSettings:this.getTextAdSettings.bind(this),adLoadedCallback:this.adLoadedCallback.bind(this)})},onResultsPageAdsUpdate:function(a){if(a=(new b.common.kn.Mixin).findAdDataForType("textAd",this.options.pageLocation,a))this.options.pageOptions=a.pageOptions,
this.options.adBlockOptions=a.adBlockOptions,this.options.impressionURL=a.impressionURL,this.isAdsenseSingleReqEnabled()&&this.hasPageOptions()&&(b.events.publish("adsense.update.text.options",{id:this.id("ads"),pageOptions:a.pageOptions,impressionURL:a.impressionURL}),b.events.publish("adsense.update.text.widget",{id:this.id("ads")})),window.clearTimeout(this.adTimeout),this.adTimeout=window.setTimeout(this.checkQAd.bind(this),b.config.getInt("ui.horizon.ads.delay",1E3))},hasPageOptions:function(){return this.options.pageOptions&&
!c.isEmptyObject(this.options.pageOptions)},getPageOptions:function(){var a=this;return c.extend({linkTarget:"_blank",adsResponseCallback:function(b){b&&b.hasOwnProperty(a.id("ads"))&&a.options&&a.options.impressionURL&&(b=a.options.impressionURL+b[a.id("ads")],c.get(b))},adLoadedCallback:this.adLoadedCallback.bind(this)},this.options.pageOptions||{})},adLoadedCallback:function(a,c){c&&(b.events.publish("textad.loaded"),this.showTitle(!0),this.addFrameTitle())},getTextAdSettings:function(){return this.hasPageOptions()?
c.extend({},this.options.adBlockOptions||{},this.options.displayOptions||{},{container:this.id("ads")}):null},checkQAd:function(){window._googCsa&&this.hasPageOptions()&&(this.isAdsenseSingleReqEnabled()?b.events.publish("adsense.trigger"):window._googCsa("ads",this.getPageOptions(),this.getTextAdSettings()))},showTitle:function(a){null!==this.title&&(a?this.title.removeClass("hidden"):this.title.addClass("hidden"))},addFrameTitle:function(){null!==this.options.gptIframeTitle&&this.getChildElement("ads").find("iframe").first().attr("title",
this.options.gptIframeTitle)},isAdsenseSingleReqEnabled:function(){return b.config.getBoolean("ui.horizon.common.kn.adsence.single.req.enabled",!1)}})})(R9,jQuery);(function(a,c){a.createComponentClass("flights.results.FlightRightRail","base.results.Rail",{adsContainer:null,addEventHandlers:function(){this.subscribe("right.rail.hide",c.proxy(this.hide,this));this.subscribe("right.rail.show",c.proxy(this.show,this));if(-1<this.options.components.indexOf("price-prediction")){var a=this;this.subscribe("flights.results.priceAlertEnabled",function(b){a.getChildElement("priceAlertsContainer").css("display",b.enabled&&b.visible?"block":"none")})}this.subscribeForUpdatingPolicyInfo("FlightPolicyInformation",
"flightPolicyInfo")},hide:function(){var d=this,b=c.Deferred(),e=b.promise();this.unbindWindowEvents();this.hasAnimation()?(this.element.on(a.Common.Utils.Browsers.ANIMATION_END,function(){b.resolve();d.element.off(a.Common.Utils.Browsers.ANIMATION_END)}),this.element.addClass("animate")):b.resolve();e.then(function(){d.element.addClass("is-hidden");a.events.publish("right.rail.hideAnimationDone")})},show:function(){this.bindWindowEvents();this.element.removeClass("animate");this.element.removeClass("is-hidden");
this.onScroll()},hasAnimation:function(){return"0s"!==this.element.css("animationDuration")}})})(R9,jQuery);(function(f,d){f.createComponentClass("common.compareto.dialog.TimeOutRightRailsTrigger",{options:{pageOrigin:"",searchId:"",timeOutTime:3E3,startAfterSteaming:!1,triggerOnTabExit:!1,exitActivationTime:5E3,eventsGroupName:".TimeOutRightRailsDialog",events:"mousemove keydown scroll touchstart touchmove touchend touchcancel".split(" "),destroyEvents:["click"]},destroySuffix:"destroy",idleTimer:null,destroyedTimer:!1,init:function(){var a=this.options;a.eventsGroupName=a.eventsGroupName+"_"+this.id();
this.eventsListeners=this.getEventsWithGroup(a.events);this.eventsDestroyListeners=this.getEventsWithGroup(a.destroyEvents,!0)},addEventSuffix:function(a){return a?this.destroySuffix:""},getEventsWithGroup:function(a,b){var g=this.options.eventsGroupName;b=this.addEventSuffix(b);for(var e=[],c=0,d=a.length;c<d;c++)e.push(a[c]+g+b);return 0<e.length?e.join(" "):null},addEventHandlers:function(){var a=this,b=a.options,g=b.events;if(g&&0!==g.length&&(a.subscribe("resultspage.searchId.changed",function(e){var c=
b.searchId;e&&c!==e.searchId&&(b.searchId=e.searchId,a.update())}),b.searchId)){if(a.eventsDestroyListeners)d(document).on(a.eventsDestroyListeners,function(){a.destroyedTimer=!0;a.destroyTimer();a.offEvents()});a.subscribe("resultspage.cleanup",function(){b.searchId=null;a.destroyTimer();a.offEvents()});a.subscribe(["clickout.open","multibook.providerClicked"],function(){a.destroyedTimer=!0;a.destroyTimer();a.offEvents()});b.startAfterSteaming?a.subscribe("resultspage.streaming.done",function(){a.startTimer()}):
a.startTimer();a.subscribe("TimeOutRightRailsDialog.createTimeOut",function(){a.startTimer()});d(document).on(a.eventsListeners,function(){a.startTimer()});b.triggerOnTabExit&&setTimeout(function(){var b=9999,c=!1;d(document).on("mousemove",function(a){b=a.clientY});d(document).on("mouseleave",function(){100>b&&!c&&(setMetaCookie("TIMEOUT_RIGHT_RAIL_EXIT",!0),c=!0,a.openDialog())})},b.exitActivationTime)}},startTimer:function(){var a=this,b=a.options.timeOutTime;a.destroyedTimer||(a.destroyTimer(),
a.idleTimer=setTimeout(function(){a.offEvents();a.openDialog()},b))},destroyTimer:function(){this.idleTimer&&clearTimeout(this.idleTimer)},openDialog:function(){var a=this.options;f.ajax.execute("common/compareto/dialog/TimeOutRightRailsDialog",{data:{pageOrigin:a.pageOrigin,searchId:a.searchId},replace:!0}).then(function(){f.events.publish(["common.dropdown.closeAll","common.widgets.tooltip.closeAll"])})},update:function(){var a=this,b=a.options;a.updatePromise&&a.updatePromise.abort();a.destroyTimer();
a.updatePromise=f.ajax.execute("common/compareto/dialog/TimeOutRightRailsTrigger",{data:{pageOrigin:b.pageOrigin,searchId:b.searchId},replace:!0,customUpdate:function(b){a.destroy();a.element.replaceWith(b.innerHTML);return!0}})},offEvents:function(){var a=this.options.eventsGroupName;d(document).off(a).off(a+this.addEventSuffix(!0))},destroy:function(){this.offEvents();this.base();this.destroyTimer()}})})(R9,jQuery);
//
(function(q){q=q||{};q.CompareTo=q.CompareTo||{};window.R9=q;var m={};(function(h){h.apply=function(f,c){if(f&&c&&"object"===typeof c)for(var g in c)f[g]=c[g];return f};h.applyIf=function(f,c){if(f&&c&&"object"===typeof c)for(var g in c)void 0===f[g]&&(f[g]=c[g]);return f}})(m);(function(h){h.extend=function(f,c){var g={},b=!1,a=0,e=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],a++);for(;a<e;a++){var d=void 0,p=arguments[a];for(d in p)Object.prototype.hasOwnProperty.call(p,
d)&&(b&&"[object Object]"===Object.prototype.toString.call(p[d])?g[d]=h.extend(!0,g[d],p[d]):g[d]=p[d])}return g}})(m);(function(h){var f=Array.prototype.slice,c;h.Functions=c={bind:function(c,b,a,e){return 2>arguments.length?c:3>arguments.length?c.bind(b):4>arguments.length?Function.prototype.bind.apply(c,[].concat(b,a)):function(){var d=a||arguments;!0===e&&(d=f.call(arguments,0),d=d.concat(a));return c.apply(b||global,d)}},pass:function(c,b,a){return function(){var e=b.slice();e.push.apply(e,arguments);
return c.apply(a||this,e)}},createBarrier:function(c,b,a){return function(){--c||b.apply(a,arguments)}},processSequenceWithTimeOut:function(f,b,a,e,d){var p=f.shift();p&&(d=a||e||d?c.bind(p,a,e,d):p,d(),setTimeout(function(){c.processSequenceWithTimeOut(f,b,a,e)},b||1E3))}}})(m);(function(h){var f=Object.create||function(){var a=function(){};return function(e){a.prototype=e;return new a}}(),c=[],g,b;h.Base=b=function(){};h.apply(b,{$staticsMembers:c,$_isClass:!0,deepExtend:!1,extend:function(a){var e,
d;e=this.prototype=f(a.prototype);if(!a.$_isClass)for(d in a=b.prototype,a)a.hasOwnProperty(d)&&d in e&&(e[d]=a[d])},addMembers:function(a,e){e=e?this:this.prototype;var d,b;for(d in a)a.hasOwnProperty(d)&&(b=a[d],"object"===typeof b&&"undefined"!==typeof e.deepExtend&&!0===e.deepExtend&&(b=h.extend(!0,{},e[d]||{},b||{})),e[d]=b);return this},mixin:function(a,e){var d,b,c;if("string"!==typeof a){for(d in a)a.hasOwnProperty(d)&&this.mixin(d,a[d]);return this}if(!e)return this;e=e.prototype;d=this.prototype;
d.hasOwnProperty("mixins")||(d.mixins="mixins"in d?f(d.mixins):{});for(b in e)e.hasOwnProperty(b)&&(c=e[b],"mixins"===b?h.applyIf(d.mixins,c):"mixinId"!==b&&void 0===d[b]&&(d[b]=c));d.mixins[a]=e;return this}});for(g in b)b.hasOwnProperty(g)&&c.push(g);b.$staticsMembers=c;b.addMembers({$className:"CompareTo.Base",deepExtend:!0,constructor:function(a){}})})(m);(function(h){function f(){return function(){return this.constructor.apply(this,arguments)||null}}var c,g=h.Base,b=g.$staticsMembers;h.ClassCreator=
c=function(a,e,d){e||(e={});var b=c.createClass(a);c.process(a,e,d);return b};h.apply(c,{makeConstructor:f,onBeforeCreated:function(a,e,d){a.addMembers(e);d.onCreated.call(a,a)},createClass:function(a){var e,d=b.length;for(a||(a=f());d--;)e=b[d],a[e]=g[e];return a},process:function(a,e,d){var b=c.orderPreprocessors,n=c.preprocessors,f=[],k,l,g={onBeforeCreated:c.onBeforeCreated,preprocessors:f,onCreated:d};k=0;for(l=b.length;k<l;k++)d=b[k],"string"===typeof d&&(d=n[d],"function"===typeof d&&f.push(d));
g.preprocessors=f;c.doProcess(a,e,g)},doProcess:function(a,e,d){for(var b=d.preprocessors,n=b.shift(),f=c.doProcess;n;n=b.shift())if(!1===n.call(c,a,e,d,f))return;d.onBeforeCreated.apply(c,arguments)},orderPreprocessors:[],preprocessors:{},registerProcessor:function(a,e,d,b){d||(d="last");c.preprocessors[a]=e;c.setPreprocessorPosition(a,d,b);return c},setPreprocessorPosition:function(a,e,d){var b=c.orderPreprocessors,n;if("string"===typeof e){if("first"===e)return b.unshift(a),c;if("last"===e)return b.push(a),
c;n="after"===e?1:-1}e=b.indexOf(d);-1!==e?b.splice(Math.max(0,e+n),0,a):b.push(a);return c}});c.registerProcessor("extend",function(a,e){var d=g.prototype,b=e.extend,c;if(b&&"string"===typeof b)throw Error("Extend class not found maybe you need to change extending order?");delete e.extend;e=b&&b!==Object?b:g;if(!e.$_isClass)for(c in b=e.prototype,d)d.hasOwnProperty(c)&&!b[c]&&(b[c]=d[c]);a.extend(e)});c.registerProcessor("mixins",function(a,e,d){if(e.mixins){var b=e.mixins,c=d.onCreated;delete e.mixins;
d.onCreated=function(){d.onCreated=c;a.mixin(b);return d.onCreated.apply(this,arguments)}}})})(m);(function(h){var f=h.ClassCreator,c=h.Functions,g,b=[],a={};h.ClassManager=g={classes:{},enableNamespaceParseCache:!0,namespaceParseCache:{},dependencies:{},parseNamespace:function(e){if("string"!==typeof e)throw Error("[Manager#parseNamespace] Invalid namespace, must be a string");var a=g.namespaceParseCache,b;if(g.enableNamespaceParseCache&&a.hasOwnProperty(e))return a[e];b=[];b.push(h);b=b.concat(e.split("."));
g.enableNamespaceParseCache&&(a[e]=b);return b},setNamespace:function(e,a){var d=h;e=g.parseNamespace(e);var b=e.length-1,c=e[b],k,l;for(k=0;k<b;k++)l=e[k],"string"!==typeof l?d=l:(d[l]||(d[l]={}),d=d[l]);d[c]=a;return d[c]},set:function(e,a){g.classes[e]=g.setNamespace(e,a);return g},get:function(a){var e=g.classes,b,c,f;if(e[a])return e[a];e=h;a=g.parseNamespace(a);c=0;for(f=a.length;c<f;c++)if(b=a[c],"string"!==typeof b)e=b;else{if(!e||!e[b])return null;e=e[b]}return e},getDependencies:function(a){var e=
g.dependencies;if(e[a])return e[a];throw Error("Can't get class"+a);},setDependency:function(a,d){var e=g.getName(a);g.dependencies[e]||(g.dependencies[e]={});g.dependencies[e][d]=a[d]},isCreated:function(a){if(!g.get(a,!1))return!1;g.triggerCreated(a);return!0},getName:function(a){return a&&a.$className||""},createClass:function(a,d){if(null!==a&&"string"!==typeof a)throw Error("Invalid class name '"+a+"' specified, must be a non-empty string");var e=f.makeConstructor();d.$className=a;return f(e,
d,function(e){a&&g.set(a,e);d.singleton&&g.set(a,new e);a&&g.triggerCreated(a)})},notify:function(a,d,b){var e=[a],c,k,l,p,f;c=0;for(k=d.length;c<k;c++)p=d[c],p.fn.call(p.scope,a);c=0;for(k=e.length;c<k;c++)if(f=e[c],d=b[f]){a=0;for(l=d.length;a<l;a++)p=d[a],p.fn.call(p.scope,f);delete b[f]}},onCreated:function(e,d,c){g.addListener(e,d,c,b,a)},triggerCreated:function(e){g.notify(e,b,a)},addListener:function(a,d,b,f,r){if(b instanceof Array){var e=c.createBarrier(b.length,a,d);a=0;for(d=b.length;a<
d;a++)g.addListener(e,null,b[a],f,r)}else e={fn:a,scope:d},b?g.isCreated(b)?a.call(d,b):(r[b]||(r[b]=[]),r[b].push(e)):f.push(e)}};h.apply(h,{define:function(a,d,b){return g.createClass.apply(g,arguments)}})})(m);(function(h){var f=h.ClassCreator,c=h.ClassManager,g=["extend","requires","mixins"],b=function(){};h.apply(b,{require:function(a,d){var e=[],f,g,k;f=0;for(g=a.length;f<g;f++)k=a[f],c.isCreated(k)||e.push(k);if(e.length)c.onCreated(function(){d&&d()},b,a);else d&&d()}});var a=function(a,d){var e,
b,c;d||(d=[]);if(!a)return d;"string"===typeof a&&d.push(a);if(a instanceof Array)for(b=a.length,c=0;c<b;c++)e=a[c],"string"===typeof e&&d.push(e);if("string"!==typeof a&&!(a instanceof Array)&&"function"!==typeof a)for(c in a)a.hasOwnProperty(c)&&(e=a[c],"string"===typeof e&&d.push(e));return d};f.registerProcessor("loader",function(e,d,f,n){var p=this,k=[],l,h,v,w,m=[];l=0;for(h=g.length;l<h;l++)v=g[l],d.hasOwnProperty(v)&&(w=d[v],k=a(w,k));if(0!==k.length)return b.require(k,function(){l=0;for(h=
g.length;l<h;l++)if(v=g[l],d.hasOwnProperty(v)){w=d[v];var a=void 0,b,k,r=d,t=v,u=w,q=m;q||(q=[]);if(u){"string"===typeof u&&(k=c.get(u),r[t]=k,q.push(k));if(u instanceof Array)for(b=u.length,a=0;a<b;a++)k=u[a],"string"===typeof k&&(k=c.get(k),r[t][a]=k,q.push(k));if("string"!==typeof u&&!(u instanceof Array)&&"function"!==typeof u)for(a in u)u.hasOwnProperty(a)&&(k=u[a],"string"===typeof k&&(k=c.get(k),r[t][a]=k,q.push(k)))}m=q;c.setDependency(d,v)}n.call(p,e,d,f)}),!1},"first")})(m);(function(h){h.define("BrowserConfig",
{singleton:!0,getString:function(f,c){return q.globals&&q.globals.browserCapabilities&&"undefined"!==typeof q.globals.browserCapabilities[f]?q.globals.browserCapabilities[f]:c},getBoolean:function(f,c){return(f=this.getString(f,""))?"true"===f.toLowerCase():c},getInt:function(f,c){return(f=this.getString(f,""))?parseInt(f):c}})})(m);(function(h){h.define("Config",{singleton:!0,getString:function(f,c){return q.config&&"function"===typeof q.config.getString?q.config.getString(f,c):c},getBoolean:function(f,
c){return q.config&&"function"===typeof q.config.getBoolean?q.config.getBoolean(f,c):c},getInt:function(f,c){return q.config&&"function"===typeof q.config.getInt?q.config.getInt(f,c):c}})})(m);(function(h){var f=/[^\x20\t\r\n\f]+/g,c=function(b){return(b.match(f)||[]).join(" ")},g=function(b){return b.getAttribute&&b.getAttribute("class")||""};(function(b){"function"!==typeof b.matches&&(b.matches=b.msMatchesSelector||b.mozMatchesSelector||b.webkitMatchesSelector||function(a){a=(this.document||this.ownerDocument).querySelectorAll(a);
for(var e=0;a[e]&&a[e]!==this;)++e;return!!a[e]});"function"!==typeof b.closest&&(b.closest=function(a){for(var e=this;e&&1===e.nodeType;){if(e.matches(a))return e;e=e.parentNode}return null})})(window.Element.prototype);h.define("Dom.Element",{singleton:!0,hasClass:function(b,a){return b?(a=" "+a+" ",1===b.nodeType&&-1<(" "+c(g(b))+" ").indexOf(a)):!1},addClass:function(b,a){if(b){var e,d,p,n;e=g(b);if(d=1===b.nodeType&&" "+c(e)+" "){p=a.match(f)||[];for(n=0;a=p[n++];)0>d.indexOf(" "+a+" ")&&(d+=
a+" ");d=c(d);e!==d&&b.setAttribute("class",d)}}},removeClass:function(b,a){if(b){var e,d,p,n;e=g(b);if(d=1===b.nodeType&&" "+c(e)+" "){p=0;for(n=a.match(f)||[];a=n[p++];)for(;-1<d.indexOf(" "+a+" ");)d=d.replace(" "+a+" "," ");d=c(d);e!==d&&b.setAttribute("class",d)}}},children:function(b){var a=[];for(b=b.firstChild;b;b=b.nextSibling)1===b.nodeType&&a.push(b);return a},isLastChild:function(b){if(b.parentNode){var a=b.parentNode.childNodes;return a[a.length-1]===b}throw"There is not parent node in element";
},closest:function(b,a){return b.closest(a)},isVisible:function(b){return!!(b.offsetWidth||b.offsetHeight||b.getClientRects().length)}})})(m);(function(h){var f=document.createElement("div"),c;c=f.addEventListener?function(b,a,e){"undefined"===typeof b._eventListeners&&(b._eventListeners=[]);b.addEventListener(a,e,!1);var d=b._eventListeners;d.push({type:a,fn:e});b._eventListeners=d}:function(){};var g=function(b,a){return"function"===typeof b.matches?b.matches(a):"function"===typeof b.webkitMatchesSelector?
b.webkitMatchesSelector(a):"function"===typeof b.mozMatchsSelector?b.mozMatchesSelector(a):"function"===typeof b.msMatchesSelector?b.msMatchesSelector(a):!1};h.define("Dom.Event",{singleton:!0,addEvent:c,removeEvent:f.removeEventListener?function(b,a,e){if("undefined"!==typeof b._eventListeners){b.removeEventListener(a,e);for(var d=b._eventListeners,c,f=[],g=0,k=d.length;g<k;g++)c=d[g],c.type!==a&&c.fn!==e&&f.push(d[g]);b._eventListeners=d}}:function(){},removeAllEvents:function(b,a){if("undefined"!==
typeof b._eventListeners){for(var e=b._eventListeners||[],d,c=[],f=0,g=e.length;f<g;f++)d=e[f],a&&d.type!==a?c.push(d):b.removeEventListener(d.type,d.fn);b._eventListeners=e}},delegateEvent:function(b,a,e,d){c(b,a,function(a){for(var c=a.target;b!==c&&!g(c,"html");){if(g(c,e)){d(c,a);break}c=c.parentNode}})}})})(m);(function(h){var f=function(a){var e={},b,d=a.length;for(b=0;b<d;b++)b in a&&(e[b]=a[b]);return e},c=/#.*$/,g,b,a=/\?/,e=/([?&])_=[^&]*/;h.define("Helper.Url.Param",{singleton:!0,update:function(d,
f,n){f&&"string"!==f&&(f=this.get(f));d||(d="");g=d.replace(c,"");b=d.slice(g.length);f&&(g+=(a.test(g)?"\x26":"?")+f);!1===n&&(g=g.replace(e,"$1"),b=(a.test(g)?"\x26":"?")+"_\x3d"+(new Date).getTime()+b);return g+b},get:function(a,e){var b=[],d,c,l,g=Object.prototype.hasOwnProperty;for(c in a)if(g.call(a,c)){l=a[c];d=e?e+"["+c+"]":c;switch(typeof l){case "object":d=this.get(l,d);break;case "array":d=this.get(f(l),d);break;default:d=d+"\x3d"+encodeURIComponent(l)}l&&b.push(d)}return b.join("\x26")}})})(m);
(function(h){h.define("Helper.Browser",{singleton:!0,chromePDFInstalled:null,isChromePDFInstalled:function(){if(null===this.chromePDFInstalled){var f=!1,c=!1,g=navigator.plugins,b,a;for(a=0;b=g[a];a++)"Chrome PDF Viewer"===b.name&&"internal-pdf-viewer"===b.filename&&(f=!0),"Chrome PDF Viewer"===b.name&&"mhjfbmdgcfjbbpaeojofohoefgiehjai"===b.filename&&(c=!0);this.chromePDFInstalled=f&&c}return this.chromePDFInstalled},isDevToolsOpened:function(){var f=!1,c=new Image;Object.defineProperty(c,"id",{get:function(){f=
!0}});console.debug("%c",c);return f}})})(m);(function(h){var f={0:200,1223:204};h.define("Helper.HttpRequest",{singleton:!0,handleResponses:function(c){if(c&&c.text&&"string"===typeof c.text)try{return{state:"success",data:JSON.parse(c.text)}}catch(g){return{state:"parsererror",error:g}}return{state:"success",data:c}},sanitizeResponse:function(c,f,b){var a,e=f;f=200<=c&&300>c||304===c;b=this.handleResponses(b);if(f)204===c?e="nocontent":304===c?e="notmodified":(e=b.state,a=b.error,f=!a);else if(a=
e,c||!e)e="error";return{success:f,status:c,data:b.data,error:a,statusText:e}},request:function(c){var g,b=this,a,e,d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open(c.type,c.url,c.async);c.headers||(c.headers={});c.crossDomain||c.headers["X-Requested-With"]||(c.headers["X-Requested-With"]="XMLHttpRequest");for(g in c.headers)c.headers.hasOwnProperty(g)&&d.setRequestHeader(g,c.headers[g]);"function"!==typeof c.complete&&(c.complete=null);a=function(p){return function(){a&&
(a=e=d.onload=d.onerror=d.onabort=d.ontimeout=d.onreadystatechange=null,"abort"===p?d.abort():"error"===p?"number"!==typeof d.status?c.complete&&c.complete(b.sanitizeResponse(0,"error")):c.complete&&c.complete(b.sanitizeResponse(d.status,d.statusText)):c.complete&&c.complete(b.sanitizeResponse(f[d.status]||d.status,d.statusText,"text"!==(d.responseType||"text")||"string"!==typeof d.responseText?{binary:d.response}:{text:d.responseText})))}};d.onload=a();e=d.onerror=d.ontimeout=a("error");void 0!==
d.onabort?d.onabort=e:d.onreadystatechange=function(){4===d.readyState&&window.setTimeout(function(){a&&e()})};a=a("abort");try{d.send(c.data||null)}catch(p){if(a)throw p;}return d}})})(m);(function(h){var f,c,g=h.ClassManager;h.define("Helper.Http",{requires:["Helper.Url.Param","Helper.HttpRequest"],singleton:!0,hostname:"",crossDomain:!1,constructor:function(){var b=g.getDependencies("Helper.Http").requires;f=b[0];c=b[1]},changeHostName:function(b){this.hostname=b.replace(/^(.+?)\/*?$/,"$1");this.crossDomain=
!0},getHostName:function(){return this.hostname},isCrossDomain:function(){return this.crossDomain},getUrl:function(b){return(b=b.replace(/(^[\/#]*|[\/#]*$)/g,""))&&b.startsWith("http")?b:this.getHostName()+"/"+b},updateUrl:function(b,a,e){return this.isCrossDomain()?this.getUrl(f.update(b,a,e)):f.update(b,a,e)},handleResponse:function(b,a,e){b.success?a&&"function"===typeof a&&a.call(null,b.data):e&&"function"===typeof e&&e.call(null,b.error,b.statusText)},get:function(b,a,e,d){var f=this;return c.request({type:"GET",
url:f.updateUrl(b,a,!1),crossDomain:f.crossDomain,async:!0,complete:function(a){f.handleResponse(a,e,d)}})},post:function(b,a,e,d){var g=this;return c.request({type:"POST",crossDomain:g.crossDomain,url:g.getUrl(b),async:!0,data:"string"===typeof a?a:f.get(a),headers:{"Content-Type":"application/x-www-form-urlencoded"},complete:function(a){g.handleResponse(a,e,d)}})}})})(m);(function(h){h.define("Helper.Location",{singleton:!0,origin:function(){var f=window.location;return f.protocol+"//"+f.host}})})(m);
(function(h){h.define("Helper.ObjectProgress",{mixinId:"objectProgress",objectProgressStatus:1,constructor:function(){this.objectProgressStatus=2},stopObjectProgress:function(){this.objectProgressStatus=1},startObjectProgress:function(){this.objectProgressStatus=3},isObjectInProgress:function(){return 3===this.objectProgressStatus}})})(m);(function(h){h.define("Helper.Observer",{mixinId:"observer",events:{},constructor:function(){this.events={}},on:function(f,c){var g=this.events[f];g||(this.events[f]=
g=[]);g.push(c);return this},off:function(f,c){var g=this.events[f];if(!g)return this;"undefined"===typeof c?delete this.events[f]:this.events[f]=g.filter(function(b){if(b!==c)return b});return this},publish:function(f,c){if(c&&!c instanceof Array)throw Error("args must be array or empty");var g=this;f=g.events[f];if(!f)return g;f.forEach(function(b){b.apply(g,c||[])});return g}})})(m);(function(h){var f=h.ClassManager,c,g=h.extend,b={};h.define("Helper.ResponseSanitizer",{requires:["Helper.Storage"],
mixins:{observer:"Helper.Observer"},options:{},constructor:function(a){var e=f.getDependencies("Helper.ResponseSanitizer"),d=e.requires;e.mixins.observer.prototype.constructor.call(this);c=d[0];b=c.get("cmp2.state")||{};this.bindEvents();this.updateOptions(a)},bindEvents:function(){var a=this;a.on("updateOptions",function(e){a.updateOptions(e)});a.on("input.event",function(e,d){if("change"===e){e=d.data;var f=e.checked;a.persistItemsState(d,f);b[e.id]=f;c.set("cmp2.state",b)}})},updateOptions:function(a){this.options=
g(!0,{},this.options,a)},persistItemsState:function(a,e){var b=a.checkedItems&&0===a.checkedItems.length;e&&(b=a.checkedItems&&a.displayItems&&a.checkedItems.length===a.displayItems.length);b?c.set("cmp2.check.all",e):c.remove("cmp2.check.all")},onPrepareRendering:function(a){var e=this.options,d=0,f=0,g=Math.min(e.maxCheckedItems,e.maxPreCheckItems);a=a.items;for(var h=c.get("cmp2.check.all"),k=0;k<a.length;k+=1){var l=a[k];if(l.visible){var t=l.checked;e.storeStateSession&&b&&b.hasOwnProperty(l.id)&&
(l.checked=t=b[l.id]);e.limited&&!l.checked&&l.prechecked&&(f>=g&&(l.prechecked=!1),f+=1);t||(t=l.prechecked&&e.usePreCheckItems);null!==h&&(t=h);(l.checked=t)&&d++;e.limited&&d>e.maxCheckedItems&&(l.checked=!1)}}}})})(m);(function(h){var f,c=h.ClassManager;h.define("Helper.Cookie",{requires:["Helper.Http"],singleton:!0,constructor:function(){f=c.getDependencies("Helper.Cookie").requires[0]},get:function(c){c+="\x3d";for(var b=document.cookie.split(";"),a=0;a<b.length;a++){for(var e=b[a];" "===e.charAt(0);)e=
e.substring(1);if(0===e.indexOf(c))return e.substring(c.length,e.length)}return""},set:function(c,b,a,e,d){if(f.isCrossDomain())f.post("/s/horizon/common/compareto/CompareTosSave",b,function(a){d&&"function"===typeof d&&d(a)});else{var g="";a&&(g=new Date,g.setTime(g.getTime()+a),g="; expires\x3d"+g.toUTCString());"object"===typeof b&&(b=JSON.stringify(b));a=e?"; domain\x3d"+e:"";document.cookie=c+"\x3d"+encodeURIComponent(decodeURIComponent(b))+g+a+"; path\x3d/";d&&"function"===typeof d&&d({})}}})})(m);
(function(h){var f=!1,c,g;try{c=window.localStorage}catch(b){}try{c&&(c.setItem("vendor-support-test","success?"),g=c.getItem("vendor-support-test"),c.removeItem("vendor-support-test")),"success?"===g&&(f=!0)}catch(b){}h.define("Helper.Storage",{singleton:!0,get:function(b){if(f&&c){b=c.getItem(b);try{return JSON.parse(b)}catch(a){return b}}return null},set:function(b,a){try{f&&c&&(null!==a&&"object"===typeof a?c.setItem(b,JSON.stringify(a)):c.setItem(b,a))}catch(e){}},remove:function(b){try{f&&c&&
c.removeItem(b)}catch(a){}},clear:function(){f&&c&&c.clear()}})})(m);(function(h){h.define("Helper.UUID",{singleton:!0,get:function(){var f=(new window.Date).getTime();return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){var g=(f+16*Math.random())%16|0;f=Math.floor(f/16);return("x"===c?g:g&3|8).toString(16)})},randomString:function(f){var c="";f=f||5;for(var g=0;g<f;g++)c+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*Math.random()));return c}})})(m);
(function(h){var f,c=h.ClassManager,g={scrollbars:1,location:1,statusbar:1,menubar:0,resizable:1},b=h.extend;h.define("Helper.Window",{requires:["Helper.Http"],singleton:!0,getSpinnerPath:function(){return f.getUrl("/s/compareresults/spinner")},constructor:function(){f=c.getDependencies("Helper.Window").requires[0]},getMultipleProvidersUrl:function(a){if(!a)return null;var e=a.compareTos||[],b=[],c="";if(0<e.length){for(var g=0,r;r=e[g];g++)"CLOSE"!==r.deepLink&&(b.push(r.code),c=r.deepLink);if(0<
b.length)return e=b.length,1===e?c:f.updateUrl("/s/compareresults/multi",h.apply({forcehttp:!0,providerCodes:b.join(",")},a.extra||{}))}return null},getWindowInformation:function(a){try{a=a?a:window;var e=a.document,b=a.screen,c=e.documentElement,f=e.getElementsByTagName("body")[0];return{y:"screenY"in a?a.screenY:a.screenTop,x:"screenX"in a?a.screenX:a.screenLeft,width:a.innerWidth||c.clientWidth||f.clientWidth,height:a.innerHeight||c.clientHeight||f.clientHeight,availTop:"availTop"in b?b.availTop:
0,availLeft:"availLeft"in b?b.availLeft:0,screenWidth:b.availWidth,screenHeight:b.availHeight}}catch(r){}return{y:0,x:0,width:window.screen.availWidth||800,height:window.screen.availHeight||600,availTop:0,availLeft:0,screenWidth:window.screen.availWidth||800,screenHeight:window.screen.availHeight||600}},tiled:function(a,b,d,c){return{url:this.getUrl(a),name:a.code,features:this.featuresForTiled(b,d,c)}},hidden:function(a,b){return{url:this.getUrl(a),name:a.code,features:this.featuresForHidden(!1,
b)}},getUrl:function(a){if("undefined"!==typeof a.useDeepLink&&!0===a.useDeepLink&&"undefined"!==typeof a.deepLink)return a.deepLink;var b="";a.verticalName&&(b="\x26vertical\x3d"+a.verticalName);return f.getUrl("/s/compareresults/spinner?code\x3d"+encodeURIComponent(a.code)+b)},featuresForHidden:function(a,e){var d=Math.min(1024,e.height-20),c=Math.min(1280,e.width-20),f=e.y+10,h=e.x+10;a&&(c=d=160,f=e.y+(e.height-110),h=e.x+(e.width-185));return b({},g,{top:f,left:h,height:d,width:c})},featuresForTiled:function(a,
e,d){e=Math.floor(d.screenWidth/e-10);return b({},g,{left:Math.floor((e+5)*a),top:0,height:Math.floor(d.screenHeight),width:e})},open:function(a,b,d,c){"object"===typeof d&&(d=this.objectToFeatureString(d));return open(a,this.getWindowName(b),d,c)},getWindowName:function(a){return a.replace(/[^a-z0-9]+/gi,"")},objectToFeatureString:function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d+"\x3d"+a[d]);return b.join(",")},features:function(a,e){var d=!0===a.top||!1,c=!0===a.bottom||!1,f=!0===
a.left||!1,h=!0===a.right||!1,k=a.height||150;a=a.width||250;var l=0,t=0;c&&(l+=d?0:e.height);h&&(t+=f?0:e.width);l+=d?10:-k;t+=h?-a:10;f&&h&&(a=e.width-20,t=10);d&&c&&(k=e.height+40,l=10);return b({},g,{top:e.y+l,left:e.x+t,height:k,width:a})},cloneHandleDimensions:function(a){var e=this.getWindowInformation(a);a=e.height;var d=e.width,c=e.y+5,e=e.x+5;return b({},g,{screenX:e,screenY:c,top:c,left:e,innerHeight:a,innerWidth:d,height:a,width:d})}})})(m);(function(h){var f=h.ClassManager;h.define("Type.CheckBoxButtonGroup",
{requires:["Dom.Element"],mixins:{observer:"Helper.Observer"},constructor:function(){var c=this,g=f.getDependencies("Type.CheckBoxButtonGroup"),b=g.requires[0];g.mixins.observer.prototype.constructor.call(this);c.on("click",function(a){b.hasClass(a,"checked")?(b.removeClass(a,"checked"),c.publish("deselect",[a,"deselect"])):(b.addClass(a,"checked"),c.publish("select",[a,"select"]));c.publish("change",[a,"change"])})}})})(m);(function(h){var f=h.ClassManager;h.define("Type.RadioButtonGroup",{requires:["Dom.Element",
"Config"],mixins:{observer:"Helper.Observer"},constructor:function(){var c=this,g=f.getDependencies("Type.RadioButtonGroup"),b=g.requires,a=b[0],e=b[1],d;g.mixins.observer.prototype.constructor.call(this);c.on("click",function(b){d&&b!==d&&(a.removeClass(d,"checked"),c.publish("change",[d,"change"]),c.publish("deselect",[d,"deselect"]));a.hasClass(b,"checked")?e.getBoolean("cmp2.radio.buttons.allow.deselect",!1)&&(d=0,a.removeClass(b,"checked"),c.publish("change",[b,"change"]),c.publish("deselect",
[b,"deselect"])):(d=b,a.addClass(b,"checked"),c.publish("change",[b,"change"]),c.publish("select",[b,"select"]))});c.on("repaint",function(b){if(b){var e=b.length,c,k;for(c=d=0;c<e;c++)k=b[c],a.hasClass(k,"checked")&&!d?d=k:a.removeClass(k,"checked")}})}})})(m);(function(h){var f={},c,g=h.ClassManager,b=h.extend;h.define("Workaround.Core",{requires:["Helper.Window"],mixins:{observer:"Helper.Observer"},options:{},blank:"about:blank",constructor:function(a){var e=g.getDependencies("Workaround.Core"),
d=e.requires;e.mixins.observer.prototype.constructor.call(this);c=d[0];this.options=b(!0,{},this.options,a);this.bindEvents()},bindEvents:function(){var a=this;a.on("input.event",function(b,d){switch(b){case "change":a.onChange(d);break;case "click":a.onClick(d);break;case "mousedown":a.onMouseDown(d);break;case "mouseup":a.onMouseUp(d);break;case "deselect":a.onDeselect(d);break;case "select":a.onSelect(d)}})},onChange:function(){},onClick:function(){},onMouseDown:function(){},onMouseUp:function(){},
onDeselect:function(){},onSelect:function(){},onResultPageOpen:function(a){var b=a.preOpen,d=a.preOpenItem,f=a.postOpenItem,g=a.postOpen;"function"===typeof b&&b.call(this,a);var b=this.getActiveProviderList(a.compareTos||[],!0),h=b.length,k=c.getWindowInformation(),l,t,v,w,u,m=c.featuresForTiled;for(l=0;t=b[l];l++)try{u={url:t.deepLink,name:t.code,features:m(l,h,k)},"function"===typeof d&&d.call(this,u,a),w=t.code,v=this.getHandle(w),v||(v=c.open(this.blank,w,u.features),this.addHandle(w,v)),this.tilingWindow(v,
u.features),v&&(v.location.href=u.url),"function"===typeof f&&f.call(this,u,v,a)}catch(x){}"function"===typeof g&&g.call(this,a)},getActiveProviderList:function(a,b){for(var e=[],c=0,f;f=a[c];c++)f.deepLink&&"CLOSE"===f.deepLink&&b&&this.closeWindow(f.code),f.deepLink&&"CLOSE"!==f.deepLink&&e.push(f);return e},closeWindow:function(a){try{c.open(this.blank,a).close()}catch(e){}},onDirectOpen:function(a,b){if("click"===a.type)this.onResultPageOpen({compareTos:b})},onSubmit:function(a){this.fireSubmitEvent(a)},
fireSubmitEvent:function(a){if("undefined"===typeof a)throw"Need specify data parameter for submit event";this.publish("onSubmit",[a])},addHandle:function(a,b){f[a]=b},getHandles:function(){return f},setHandles:function(a){f=a},getHandle:function(a){try{var b=f[a];return!b||b.closed?null:b}catch(d){return null}},tilingWindow:function(a,b){if("undefined"!==typeof b&&a){var d;this.options.resizeBeforeOpening?"undefined"!==typeof b.left&&"undefined"!==typeof b.top&&(a.resizeTo(100,100),a.moveTo(-1E7,
-1E7),d=["screenX"in a?a.screenX:a.screenLeft,"screenY"in a?a.screenY:a.screenTop],a.moveTo(d[0]+b.left,d[1]+b.top)):"undefined"!==typeof b.left&&"undefined"!==typeof b.top&&a.moveTo(b.left,b.top);"undefined"!==typeof b.width&&"undefined"!==typeof b.height&&a.resizeTo(b.width,b.height)}}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.AsyncOpen",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.AsyncOpen"),a=b.requires;
g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type){var e=this;b=f.getWindowInformation();for(var d=a.length,c=0,g;g=a[c];c++)g=f.tiled(g,c,d,b),this.open(g);setTimeout(function(){e.onResultPageOpen({compareTos:a})},1)}},open:function(b){setTimeout(function(){try{f.open(b.url,b.name,b.features)}catch(a){}},0)},onSubmit:function(b){var a=this,e,d,c,g;g=b.checkedItems.length;c=f.getWindowInformation();for(d=0;e=b.checkedItems[d];d++)e=f.tiled(e,
d,g,c),a.open(e);setTimeout(function(){var a=window.open("","_self");a&&!a.closed&&a.focus()},0);setTimeout(function(){a.fireSubmitEvent(b)},1)}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.AsyncOpenLastClose",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.AsyncOpenLastClose"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type){var e=this;
b=f.getWindowInformation();for(var d=a.length,c=0,g;g=a[c];c++)g=f.tiled(g,c,d,b),delete g.features,this.open(g);setTimeout(function(){e.onResultPageOpen({compareTos:a})},1)}},open:function(b){setTimeout(function(){try{f.open(b.url,b.name,b.features)}catch(a){}},0)},onSubmit:function(b){var a=this,e,d,c,g;g=b.checkedItems.length;c=f.getWindowInformation();for(d=0;e=b.checkedItems[d];d++)e=f.tiled(e,d,g,c),delete e.features,a.open(e);setTimeout(function(){var a=window.open("about:blank","_blank");
a&&!a.closed&&a.close()},0);setTimeout(function(){a.fireSubmitEvent(b)},1)}})})(m);(function(h){var f,c,g=h.ClassManager,b;h.define("Workaround.ChangeWindowName",{requires:["Helper.UUID","Helper.Window"],extend:"Workaround.Core",constructor:function(a){var e=g.getDependencies("Workaround.ChangeWindowName"),d=e.requires;b=e.extend.prototype;b.constructor.apply(this,arguments);f=d[0];c=d[1]},onResultPageOpen:function(a){if(a.compareTos&&0<a.compareTos.length){var e=f.get();window.name=e;a.postOpenItem=
function(){c.open("",e,"")};a.postOpen=function(){c.open("",e,"")};b.onResultPageOpen.call(this,a)}},onSubmit:function(a){var b=f.get(),d,g,h,r,k;window.name=b;r=a.checkedItems.length;k=c.getWindowInformation();for(d=0;g=a.checkedItems[d];d++)try{h=c.tiled(g,d,r,k),c.open(h.url,h.name,h.features),c.open("",b,"")}catch(l){}this.fireSubmitEvent(a)}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.DocumentFocus",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=
c.getDependencies("Workaround.DocumentFocus"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0];this.blank=f.getSpinnerPath()},onSelect:function(b){g.onSelect.call(this,b);try{var a=b.data,e=f.getWindowInformation(),d=f.hidden(a,e);d.features=f.features({bottom:!0},e);var c=f.open(d.url,d.name,d.features);this.addHandle(d.name,c);this.windowFocus(c)}catch(n){}},onDeselect:function(b){g.onDeselect.call(this,b);try{var a=this.getHandle(b.data.code);a&&a.close()}catch(e){}},
focusInterval:null,windowFocus:function(b){this.focusInterval&&clearInterval(this.focusInterval);var a=0,e=this.focusInterval=setInterval(function(){try{b&&(b.blur(),b.opener.focus()),window.self.focus(),window.focus(),document.focus()}catch(d){}a++;10<a&&e&&clearInterval(e)},300)},onSubmit:function(b){var a=f.getWindowInformation(),e,d,c,g;for(e=0;d=b.checkedItems[e];e++)try{c=f.hidden(d,a),c.features=f.features({bottom:!0},a),g=f.open(c.url,c.name,c.features),this.addHandle(c.name,g),this.windowFocus(g)}catch(r){}this.fireSubmitEvent(b)}})})(m);
(function(h){var f,c=h.ClassManager,g;h.define("Workaround.HandleOpen",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.HandleOpen"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type)this.onResultPageOpen({compareTos:a,postOpenItem:function(a,b){b&&!b.closed&&b.open("about:blank").close()}})},onSubmit:function(b){var a,e,d,c,g,h,k;k=b.checkedItems.length;h=f.getWindowInformation();
for(e=0;g=b.checkedItems[e];e++)try{a=f.tiled(g,e,k,h),(d=f.open(a.url,a.name,a.features))&&!d.closed&&(c=d.open("about:blank"),c.close())}catch(l){}this.fireSubmitEvent(b)}})})(m);(function(h,f){function c(a){return a.charCodeAt(0)}function g(a,b,d){b=b||"";d=d||1024;for(var e=[],f=0;f<a.length;f+=d){var k=a.slice(f,f+d),k=Array.prototype.map.call(k,c),k=new Uint8Array(k);e.push(k)}return new Blob(e,{type:b})}var b,a,e,d,p=h.ClassManager,n,r=[];h.define("Workaround.PdfAlert",{requires:["Helper.UUID",
"Helper.Window","Helper.Browser","Dom.Event"],extend:"Workaround.Swapper",constructor:function(){var c=p.getDependencies("Workaround.PdfAlert"),l=c.requires,g=l[2];n=c.extend.prototype;n.constructor.apply(this,arguments);b=l[0];e=l[1];a=l[3];d=g.isChromePDFInstalled();a.addEvent(f,"message",function(a){a.origin===f.location.origin&&a.data&&"undefined"!==typeof a.data.cmp2&&f.focus()})},options:{timer:1E3},timer:null,onResultPageOpen:function(a){if(!d)return n.onResultPageOpen.apply(this,arguments);
var b=e.getMultipleProvidersUrl(a);if(b){var c=e.open("",f.name+"popUnderWindow");c&&(c.location.href=b)}},focusWindow:function(){var c=this,d=c.options.timer,e=0,h=!1,n=function(b){a.removeEvent(f,"focus",n);h=!1;var d,e,k;for(d=0;e=r[d];d++)(k=e.dom)&&k.parentNode&&k.parentNode.removeChild(k),URL.revokeObjectURL(e.source);r=[];c.timer&&clearInterval(c.timer);"boolean"!==typeof b&&c.fireSubmitEvent(c.data)},p=function(){if(e++>d)n();else if(document.hasFocus())h&&n();else{var a;if(!(a=h)){a=b.get();
var c=b.get();a=["%PDF-1.7","%\u00e2\u00e3\u00cf\u00d3","5 0 obj","\x3c\x3c/Filter/FlateDecode/Length 8\x3e\x3estream",atob("eJwDAAAAAAE\x3d"),"endstream","endobj","4 0 obj","\x3c\x3c/Contents 5 0 R/MediaBox[0 0 595 842]/Parent 2 0 R/Resources\x3c\x3c\x3e\x3e/TrimBox[0 0 595 842]/Type/Page\x3e\x3e","endobj","1 0 obj","\x3c\x3c/OpenAction 6 0 R/Pages 2 0 R/Type/Catalog\x3e\x3e","endobj","3 0 obj","\x3c\x3c\x3e\x3e","endobj","2 0 obj","\x3c\x3c/Count 1/Kids[4 0 R]/Type/Pages\x3e\x3e","endobj","6 0 obj",
"\x3c\x3c/JS(app.alert('Please wait...', 4);)/S/JavaScript/Type/Action\x3e\x3e","endobj","xref","0 7","0000000000 65535 f.","0000000203 00000 n.","0000000285 00000 n.","0000000265 00000 n.","0000000088 00000 n.","0000000015 00000 n.","0000000336 00000 n.","trailer","\x3c\x3c/ID [\x3c"+a+"\x3e\x3c"+c+"\x3e]/Info 3 0 R/Root 1 0 R/Size 7\x3e\x3e","startxref","419","%%EOF"];a=URL.createObjectURL(g(a.join("\n"),"application/pdf"));c=document.createElement("object");c.setAttribute("data",a);c.setAttribute("type",
"application/pdf");c.setAttribute("style","visibility:visible;width:0;height:0;opacity:0;position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;");var f=document.createElement("iframe");document.body.appendChild(f);f.contentWindow.document.open();f.contentWindow.document.write(c.outerHTML);f.contentWindow.document.close();r.push({dom:f,source:a});a=!0}h=a}};c.timer&&n(!1);c.timer=setInterval(function(){p()},1);a.addEvent(f,"focus",n);p()},onSubmit:function(a){var c=this;if(d){if(0!==a.checkedItems.length){c.data=
a;var k=b.get();f.name=k;e.open(e.getSpinnerPath(),k+"popUnderWindow");a.callback=function(){c.focusWindow()}}c.fireSubmitEvent(a)}else n.onSubmit.call(c,a)}})})(m,window);(function(h){var f,c=h.ClassManager,g,b,a,e,d,p=h.Functions;h.define("Workaround.PostMessage",{requires:["Helper.Window","Dom.Event","Helper.UUID","Helper.Browser","Helper.Http"],extend:"Workaround.Core",handles:[],constructor:function(){var h=this,p=c.getDependencies("Workaround.PostMessage"),k=p.requires;g=p.extend.prototype;
g.constructor.apply(h,arguments);f=k[0];b=k[1];e=k[2];d=k[3];a=k[4];h.id=e.get();b.addEvent(window,"message",function(a){a=a.data;var b=a.id;"open"===a.method&&h.id===b&&h.createWindow(a)})},createWindow:function(a){var b=this,c,d=!1;"tab"===b.options.method&&!0!==a.direct?d=(c=open("about:blank",a.name))&&!c.closed:(d=(c=open("about:blank",a.name,a.options||""))&&!c.closed,a.close&&(c&&!c.closed&&c.close(),c=null,d=!1));d&&setTimeout(function(){c&&!c.closed&&(a.direct||b.handles.push(c),c.location=
a.url,b.notifyCreate&&b.notifyCreate())},b.options.delay)},onDirectOpen:function(a,b){if(!d.isDevToolsOpened()&&"click"===a.type){var c=this;a=f.cloneHandleDimensions();c.handles=[];for(var e=0,g;g=b[e];e++)c.fireOpen({url:g.deepLink,name:f.getWindowName(g.code),options:a,direct:!0});setTimeout(function(){c.onResultPageOpen({compareTos:b})},0)}},fireOpen:function(a){window.postMessage({method:"open",id:this.id,url:a.url||"",name:a.name||"_blank",options:a.options||"",close:a.close||!1,direct:a.direct||
!1},window.location.origin)},renameHandles:function(b,c){var d,e,g=0,h,p=this.handles;p.unshift(window);for(d=0;e=p[d];d++)if(e&&!e.closed){if(h=b[g])e.name=f.getWindowName(h.code);h=e;g+=1}h&&(h.name="k"+this.id,h.location=c);window!==h&&(window.location=a.getUrl("/s/compareresults/spinner"))},onSubmit:function(a){if(d.isDevToolsOpened()||0===a.checkedItems.length)a.checkedItems=[],this.fireSubmitEvent(a);else{var b=this,c=0,e,g,h=a.checkedItems.length,n=!1,m=!1,q,x=f.getWindowInformation();window.name=
"k"+b.id;b.handles=[];"tab"===b.options.method&&(q=setTimeout(function(){b.renameHandles(a.checkedItems,a.url)},1E3),b.notifyCreate=p.createBarrier(h,function(){n=!0;m&&(q&&clearTimeout(q),b.renameHandles(a.checkedItems,a.url))},b));for(;e=a.checkedItems[c];c++)try{g=f.tiled(e,c,h,x),b.fireOpen({url:g.url,name:f.getWindowName(e.code),options:g.features})}catch(y){}"tab"===b.options.method?a.callback=function(a){m=!0;n&&(q&&clearTimeout(q),b.renameHandles(a.checkedItems,a.url))}:b.fireOpen({url:"about:blank",
close:!0});b.fireSubmitEvent(a)}}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.SelfTarget",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.SelfTarget"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type){b=window.open("","_self");for(var c=f.getWindowInformation(),d=0,g;g=a[d];d++)g=f.hidden(g,c),f.open(g.url,g.name,g.features),b.focus();this.onResultPageOpen({compareTos:a})}},
onSubmit:function(b){var a=window.open("","_self"),c=f.getWindowInformation(),d,g,h;for(g=0;h=b.checkedItems[g];g++)try{d=f.hidden(h,c),d.features=f.features({bottom:!0},c),f.open(d.url,d.name,d.features),a.focus()}catch(r){}this.fireSubmitEvent(b)}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.SimpleOpen",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.SimpleOpen"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,
arguments);f=a[0]},onSelect:function(b){g.onSelect.call(this,b);try{var a=f.tiled(b.data,0,2,f.getWindowInformation()),c=f.open(a.url,a.name,a.features);this.addHandle(a.name,c)}catch(d){}},onDeselect:function(b){g.onDeselect.call(this,b);try{var a=this.getHandle(b.data.code);a&&a.close()}catch(e){}},onSubmit:function(b){var a=f.getWindowInformation(),c,d,g,h;for(c=0;d=b.checkedItems[c];c++)try{g=f.hidden(d,a),g.features=f.features({bottom:!0},a),h=f.open(g.url,g.name,g.features),this.addHandle(g.name,
h)}catch(r){}this.fireSubmitEvent(b)}})})(m);(function(h){function f(a){(a=a.originalEvent?a.originalEvent:a)&&a.state&&a.state.hasOwnProperty("cmp2BackUrl")&&location.replace(a.state.cmp2BackUrl)}var c,g,b,a=h.ClassManager,e,d;h.define("Workaround.Swapper",{requires:["Helper.Window","Helper.Storage","Dom.Event","Helper.Location","Helper.Http"],extend:"Workaround.Core",constructor:function(){var h=a.getDependencies("Workaround.Swapper"),n=h.requires,r=n[2];e=h.extend.prototype;e.constructor.apply(this,
arguments);g=n[0];c=n[1];d=n[3];b=n[4];r.removeEvent(window,"popstate",f);r.addEvent(window,"popstate",f)},onDirectOpen:function(a,b,c){"click"===a.type&&(a=g.getMultipleProvidersUrl({compareTos:b,extra:c}))&&g.open(a,"rr_compare",g.cloneHandleDimensions())},onResultPageOpen:function(a){window.opener&&(a=g.getMultipleProvidersUrl(a))&&window.opener&&!window.opener.closed&&(this.options.loadAfterPageLoaded?window.opener.postMessage({type:"cmp2ResultPageOpen",url:a},d.origin()):window.opener.location.replace(a),
this.changeBrowserHistory())},changeBrowserHistory:function(){try{var a=window.location.href,b=c?c.get("cmp2.back.url"):0;c&&c.remove("cmp2.back.url");if(b){var d={};d.cmp2BackUrl=b;window.history.replaceState(d,"",b);b={};b.cmp2BackUrl=a;window.history.pushState(b,"",a)}}catch(k){}},onSubmit:function(a){if(0!==a.checkedItems.length){var d=window.location.href,e=window.open(g.getSpinnerPath(),"_blank");e&&(c&&c.set("cmp2.back.url",d),a.callback=function(a){a.url&&0<=a.url.indexOf("%s")&&("function"===
typeof q.logger?new q.logger:window.Rollbar||window.console).error("CompareTo.Workaround.Swapper submit url has invalid %s parameter");e.location.href=b.getUrl(a.url);window.location.href=b.getUrl("/s/compareresults/spinner")})}this.fireSubmitEvent(a)}})})(m);(function(h){var f,c,g=h.ClassManager,b=h.Functions,a;h.define("Workaround.SwapperCookie",{requires:["Helper.UUID","Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=g.getDependencies("Workaround.SwapperCookie"),d=b.requires;
a=b.extend.prototype;a.constructor.apply(this,arguments);f=d[0];c=d[1]},onResultPageOpen:function(a){if(a.compareTos&&0<a.compareTos.length){var b=window.name,e=c.getMultipleProvidersUrl(a),f=c.open("","popUnderName"+b);c.open("",b,"");f&&this.createSequence(f,this.getActiveProviderList(a.compareTos||[]),e,function(a,b){a&&!a.closed&&(a.location.href=b);c.open("",window.name,"")})}},onDirectOpen:function(a,b,f){"click"===a.type&&(f=c.getMultipleProvidersUrl({compareTos:b,extra:f}))&&(a=c.open("",
"rr_compare",c.cloneHandleDimensions()),this.createSequence(a,this.getActiveProviderList(b||[]),f,function(a,b){a&&!a.closed&&(a.location.href=b)}))},createSequence:function(a,c,f,g){var d,e,l=[];if(1===c.length)g.call(this,a,f);else{for(e=0;d=c[e];e++)l.push(b.pass(g,[a,d.deepLink],this));l.push(b.pass(g,[a,f],this));b.processSequenceWithTimeOut(l,this.options.delay||1E3)}},onSubmit:function(a){var b=f.get(),e,g=c.getWindowInformation();window.name=b;if(a.checkedItems&&0<a.checkedItems.length)try{e=
c.tiled(a.checkedItems[0],0,1,g),c.open(e.url,"popUnderName"+b,e.features),c.open("",b,"")}catch(r){}this.fireSubmitEvent(a)}})})(m);(function(h){var f=h.ClassManager,c;h.define("Workaround",{requires:"Workaround.Core Workaround.ChangeWindowName Workaround.DocumentFocus Workaround.HandleOpen Workaround.PdfAlert Workaround.PostMessage Workaround.SelfTarget Workaround.Swapper Workaround.SwapperCookie".split(" "),singleton:!0,constructor:function(){c=f.getDependencies("Workaround").requires[0]},get:function(g){var b=
"Workaround."+(g?g.name:"Core"),a;f.isCreated(b)&&(b=f.get(b))&&(a=new b(g));a||(a=new c(g));return a instanceof c?a:null}})})(m);(function(h){var f=h.Dom.Element,c=h.Dom.Event,g=h.ClassManager,b=h.extend,a=h.Helper.Cookie,e=h.Config,d=h.Helper.Http,p=h.Workaround,n=h.Type.RadioButtonGroup,r=h.Type.CheckBoxButtonGroup;h.define("Items",{requires:["Requests","Helper.ResponseSanitizer"],mixins:{observer:"Helper.Observer",objectProgress:"Helper.ObjectProgress"},element:"",itemsElement:"",controlsElements:null,
options:{serverSideOptions:!1,limited:!0,radioButtons:!1,workaround:{},rendering:{},template:{none:"\x3cspan class\x3d'span-button-wrapper'\x3e\x3cspan class\x3d'input'\x3e\x3cspan class\x3d'icon'\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e\x3c/span\x3e",checked:"\x3cspan class\x3d'span-button-wrapper'\x3e\x3cspan class\x3d'input checked' role\x3d'checkbox' aria-checked\x3d'true' data-code\x3d'{code}' tabindex\x3d'0'\x3e\x3cspan class\x3d'icon'\x3e\x3c/span\x3e{label}\x3c/span\x3e\x3c/span\x3e",unChecked:"\x3cspan class\x3d'span-button-wrapper'\x3e\x3cspan class\x3d'input' role\x3d'checkbox' aria-checked\x3d'false' data-code\x3d'{code}' tabindex\x3d'0'\x3e\x3cspan class\x3d'icon'\x3e\x3c/span\x3e{label}\x3c/span\x3e\x3c/span\x3e"},
compareToHiddenClass:"compareToHidden",source:"",pageOrigin:"",enabled:!0,cookieLifetime:6E4,cookieDomain:"",minItemsToShowControls:3},itemsBlock:".items",requests:null,requestData:[],requestToken:"",workaround:null,lastServerResult:null,responseSanitizer:null,constructor:function(a,b){var c=g.getDependencies("Items"),d=c.requires,e=d[0],d=d[1];c.mixins.observer.prototype.constructor.call(this);c.mixins.objectProgress.prototype.constructor.call(this);this.requests=new e({pageOrigin:b.pageOrigin,showOn:b.showOn,
radioButtonsKey:b.radioButtonsKey});this.responseSanitizer=new d(b.rendering);this.element=null;a&&("string"===typeof a?this.element=document.getElementById(a):"nodeType"in a&&1===a.nodeType?this.element=a:"jquery"in a&&(this.element=a[0]));this.element&&(a=this.element.querySelectorAll(this.itemsBlock),1===a.length&&(this.itemsElement=a[0]),this.controlsElements=this.element.querySelectorAll(".CompareTo-Controls .control"),f.addClass(this.element,b.compareToHiddenClass||this.options.compareToHiddenClass),
this.pullServerSideOptions(),this.updateOptions(b),this.stopObjectProgress(),this.element.compareToItems=this)},pullServerSideOptions:function(){var a=this;(q.globals&&q.globals.isSeo||a.options.serverSideOptions)&&a.requests.optionsFromServer(function(b){if(b){a.publish("cmp2.options.update",[b]);var c=setInterval(function(){a.isObjectInProgress()||(clearInterval(c),a.updateOptions(b.settings),b.formToken&&q&&q.globals&&(q.globals.formtoken=b.formToken))},500)}})},setWorkaround:function(){var a=
this;a.workaround=p.get(a.options.workaround);a.workaround.on("onSubmit",function(b){if(a.isVisible()){for(var c=a.getRequestData()||[],e=a.getDisplayItemsMap(),f=b.checkedItems&&0<b.checkedItems.length,g=0,k;k=c[g];g++)"undefined"!==typeof e[k.code]&&(k.checked=f?e[k.code].checked:!1);d.isCrossDomain()&&!f?(b.url=d.updateUrl(b.url),a.fireSubmitEvent(b)):a.setCookie(c,function(c){b.url=d.updateUrl(b.url,c);a.fireSubmitEvent(b)})}else a.fireSubmitEvent(b)})},fireSubmitEvent:function(a){var b=a.callback;
b&&"function"===typeof b?b.call(null,a):this.publish("form.submit",[a])},updateOptions:function(a){var c=this.options=b(!0,{},this.options,a||{}),d=this.element;a=a&&"undefined"!==typeof a.radioButtons?a.radioButtons:f.hasClass(d,"radio")?!0:c.radioButtons;c.radioButtons=a;c.radioButtons?(f.addClass(d,"radio"),c.limited=!0):f.removeClass(d,"radio");this.responseSanitizer.publish("updateOptions",[c.rendering]);this.requests.updateOptions({pageOrigin:c.pageOrigin,showOn:c.showOn,radioButtonsKey:c.radioButtonsKey});
this.setWorkaround();this.bindEvents();this.lastServerResult&&this.isEnabled()&&this.displayServerResults(this.lastServerResult)},handleSubmit:function(a){a.displayItems=this.getDisplayItems();a.checkedItems=this.getCheckedItems();if(0===a.checkedItems.length)this.workaround.fireSubmitEvent(a);else this.workaround.onSubmit(a)},cleanUp:function(){var a=this.itemsElement;a&&(a.innerHTML="");this.displayBlock(0);this.requests.cleanUp()},setCookie:function(b,c){for(var d=this.options,e=b.length||0,f=
[],g={c2s:null,origin:d.pageOrigin,src:d.source,where:d.showOn,token:this.getRequestToken()},h=0;h<e;h++){var k=b[h],l=[],r;l.push(k.id);r=this.createBinaryMask(k.prechecked,"-1"!==k.termId,k.visible,k.checked);l.push(r.toString(16));l.push(k.rank);f.push(l.join("|"))}g.c2s=f.join(";");a.set("compareTos",g,d.cookieLifetime,d.cookieDomain,c)},createBinaryMask:function(){for(var a=0,b=0,c=32<arguments.length?32:arguments.length;b<c;b++)a|=arguments[b]<<b;return a},bindEvents:function(){var a=this,b=
a.element,d,e,g,h;d=a.options.radioButtons?new n:new r;a.inputType=d;var p=["change","deselect","select"];e=0;for(g=p.length;e<g;e++)h=p[e],d.on(h,function(b,c){a.handleUserEvent(c,b)});c.removeAllEvents(b);d=["click","mousedown","mouseup","mouseover","mouseout"];e=0;for(g=d.length;e<g;e++)h=d[e],c.delegateEvent(b,h,".input",function(b,c){a.handleUserEvent(c.type,b)});c.delegateEvent(b,"keydown",".input",function(b,c){var d=c.which;return 32===d||13===d?(c.preventDefault(),c=document.createEvent("Event"),
c.initEvent("click",!0,!0),b.dispatchEvent(c),!1):9===d&&f.isLastChild(b.parentElement)?(c.preventDefault(),a.publish("LastItem.focusOut"),!1):!0});h=a.controlsElements;e=0;for(g=h.length;e<g;e++)d=h[e],c.removeAllEvents(d),c.addEvent(d,"click",function(b){b.preventDefault();a.handleCheckAllNoneClick(b.target)});c.delegateEvent(b,"keydown",".CompareTo-Controls .control",function(b,c){var d=c.which;return 32===d||13===d?(c.preventDefault(),a.handleCheckAllNoneClick(b),!1):!0})},handleUserEvent:function(a,
b){"click"===a&&this.inputType.publish("click",[b]);"change"===a&&(this.changeItemState(b),b.setAttribute("aria-checked",f.hasClass(b,"checked")),this.publish("input.stateChanged",[b,f.hasClass(b,"checked"),this.options.radioButtons]));var c={item:b,data:this.getItemData(b),checkedItems:this.getCheckedItems(),displayItems:this.getDisplayItems()};this.workaround.publish("input.event",[a,c]);this.responseSanitizer.publish("input.event",[a,c,b]);"change"===a&&this.updateControlsStatus(c.displayItems.length,
c.checkedItems.length);this.publish("input.event",[b,a])},updateControlsStatus:function(a,b){var c=this.controlsElements,d=c.length,e=!0,g=!0;if(0!==a)for(a===b&&(e=!1,g=!0),0===b&&(e=!0,g=!1),a=0;a<d;a++){b=c[a];var h=f.hasClass(b,"check-all")?e:g;b.setAttribute("aria-disabled",!h);b.disabled=!h}},handleCheckAllNoneClick:function(a){a=f.hasClass(a,"check-all");for(var b,c=this.element.querySelectorAll(".input"),d=0;b=c[d];d++)if(this.getItemData(b).checked!==a){var e=document.createEvent("Event");
e.initEvent("click",!0,!0);b.dispatchEvent(e)}this.publish("controls.click",[a]);this.publish("checkall.focus")},changeItemState:function(a){a=this.getItemData(a);this.options.rendering.storeStateSession||this.requests.saveItemState({item:a})},getItemData:function(a){a.data.checked=f.hasClass(a,"checked");return a.data},getItems:function(a){var b=this;b.isEnabled()&&(b.printItems([]),b.startObjectProgress(),b.requests.loadItems(a,function(a){b.displayServerResults(a);b.lastServerResult=a;b.stopObjectProgress()}))},
displayServerResults:function(a){if(a&&a.success){var b={items:a.compareTos};this.responseSanitizer.onPrepareRendering(b);this.setRequestData(b.items);this.setRequestToken(a.requestToken);this.printItems(b.items)}else this.printItems([])},printItems:function(a){var b=0,c=[],d=0,f=this.itemsElement,g={items:a,domItems:[]};if(f&&this.isEnabled()){this.publish("cmp2.rendering.start",[g]);f.innerHTML="";for(var h=0,k;k=a[h];h++)if(k.visible){var r=this.getItemDom(k);c.push(r);f.appendChild(r);k.checked&&
(d+=1);b+=1}this.displayBlock(b);this.options.radioButtons&&(e.getBoolean("cmp2.radio.button.add.none",!0)&&f.appendChild(this.getItemDom({name:"",code:"",visible:!1,checked:!1,none:!0})),this.inputType.publish("repaint",[this.element.querySelectorAll(".input")]));g.domItems=c;this.updateControlsStatus(b,d);this.publish("cmp2.rendering.finished",[g])}},displayBlock:function(a){var b=this.options,c=this.element,d=!1===b.radioButtons&&a>=b.minItemsToShowControls&&!b.limited;0<a?(this.publish("cmp2.shown"),
a=c.querySelector(".CompareTo-Controls"),a.style.display=d?"":"none",f.hasClass(c,b.compareToHiddenClass)&&f.removeClass(c,b.compareToHiddenClass)):(this.publish("cmp2.hidden"),f.hasClass(c,b.compareToHiddenClass)||f.addClass(c,b.compareToHiddenClass))},getItemDom:function(a){var c,d;d=this.options.template;c=d.unChecked;var e={name:"",label:a.name,code:a.code,checked:a.checked};e.checked&&(c=d.checked);a.none&&(c=d.none||"");c=c.replace(/(\{label}|\{name}|\{code})/gi,function(a){a=a.substr(1,a.length-
2);a=e[a];return"undefined"!==typeof a?a:""});d=document.createElement("div");d.innerHTML=c;if(c=d.querySelector(".input"))c.data=b({},a);a=d.children;return 1===a.length?a[0]:""},setRequestData:function(a){this.requestData=a},getRequestData:function(){return this.requestData},setRequestToken:function(a){this.requestToken=a},getRequestToken:function(){return this.requestToken},isVisible:function(){return f.isVisible(this.element)},isEnabled:function(){return this.element&&this.options.enabled},getDisplayItems:function(){var a=
[],b,c,d;if(this.isVisible())for(b=this.element.querySelectorAll(".input"),c=0;d=b[c];c++)(d=this.getItemData(d))&&d.visible&&a.push(d);return a},getDisplayItemsMap:function(){var a={},b,c,d;if(this.isVisible())for(b=this.element.querySelectorAll(".input"),c=0;d=b[c];c++)(d=this.getItemData(d))&&d.visible&&(a[d.code]=d);return a},getCheckedItems:function(){var a=[],b,c,d;if(this.isVisible())for(b=this.element.querySelectorAll(".input.checked"),c=0;d=b[c];c++)(d=this.getItemData(d))&&d.visible&&a.push(d);
return a}})})(m);(function(h){var f=h.Helper.Http,c=h.Helper.Url.Param,g=h.extend,b="flights trains hotels cars cruises rentals packages packagetours".split(" "),a=Array.prototype.indexOf,e=function(b,c,d){var e;if(c){if(a)return a.call(c,b,d);e=c.length;for(d=d?0>d?Math.max(0,e+d):d:0;d<e;d++)if(d in c&&c[d]===b)return d}return-1},d=!1,p=[],n=null;h.define("Requests",{options:{},constructor:function(a){this.options=g(!0,{},this.options,a||{})},updateOptions:function(a){this.options=g(!0,{},this.options,
a||{})},lastRequestString:"",lastRequestData:null,xhr:null,cleanUp:function(){this.lastRequestString=""},loadItems:function(a,d){var h=this;if(h.lastRequestString===c.get(a))d(h.lastRequestData);else{var k=h.xhr;k&&4!==k.readyState&&"function"===typeof k.abort&&k.abort();-1===e(a.vertical,b)?"function"===typeof d&&d(null):(h.lastRequestString=c.get(a),a=h.sanitizeParams(g(!0,{},a)),h.xhr=f.get("/s/cmp2chk/items",a,function(a){"function"===typeof d&&(h.lastRequestData=a,d(a))},function(){"function"===
typeof d&&d(null)}))}},sanitizeParams:function(a){var b=this.putValues,c=this.options,c={ptype:a.vertical,show_on:c.showOn,page_origin:c.pageOrigin};a.url&&(c.url=a.url);switch(a.vertical){case "flights":case "trains":b(a,c,"depart_date return_date depart_date_canon return_date_canon origin origincode destination destinationcode destcode cabin student travelers oneway adults child lapInfant seniors youth seatInfant".split(" "));break;case "hotels":case "rentals":b(a,c,"checkin_date checkout_date checkin_date_canon checkout_date_canon location othercity citycode lmid nhid hid frid rid cid rooms guests adults children".split(" "));
break;case "cars":b(a,c,"pickup_date dropoff_date pickup_date_canon dropoff_date_canon location location1 citycode1 location2 citycode2 pickup_hour dropoff_hour oneway".split(" "));break;case "packages":case "packagetours":c.ptype="packagetours";b(a,c,"depart_date return_date depart_date_canon return_date_canon origincode destcode pt_geo_id".split(" "));break;case "cruises":b(a,c,"destination destinationId cruiseLine sailDate sailDate_canon tripLength".split(" "))}return c},putValues:function(a,b,
c){for(var d=0,e;e=c[d];d++)a.hasOwnProperty(e)&&(b[e]=a[e])},saveItemState:function(a){f.isCrossDomain()||f.post("/s/horizon/common/compareto/CompareTosCheckedState",{name:a.item.code,checked:a.item.checked})},optionsFromServer:function(a){n?a&&a(n):("function"===typeof a&&p.push(a),d||(d=!0,f.post("/s/horizon/common/compareto/CompareTosOptions",this.options,function(a){n=a;d=!1;for(var b=0,c;c=p[b];b++)"function"===typeof c&&c(a);p=[]})))}})})(m);(function(h){var f=h.Helper.Location,c=h.Workaround,
g=h.extend,b=h.Helper.Http;h.define("ResultPage",{options:{workaround:{}},workaround:null,constructor:function(a){a=this.options=g(!0,{},this.options,a);this.workaround=c.get(a.workaround)},open:function(a){var b=this.workaround;if(b)b.onResultPageOpen(a)},delayLoad:function(){window.opener&&!window.opener.closed&&window.opener.postMessage({type:"cmp2DelayLoad"},f.origin())},ajaxOpen:function(a,c){var d=this;b.get("/s/cmp2chk/open",a,function(a){c&&c(a);d.open({compareTos:a.compareTos,extra:{pageOrigin:a.pageOrigin,
searchId:a.searchId}})})}})})(m);(function(h){var f=h.extend,c=h.ClassManager;h.define("RightRails",{requires:["Workaround","Dom.Event"],options:{selector:null,items:[],workaround:{},extra:{}},workaround:null,constructor:function(g){var b=this,a=c.getDependencies("RightRails").requires,e=a[0],a=a[1],d=f({},b.options,g),h=d.workaround,n=d.selector,m,k;g=["click","mousedown","mouseup"];var l=g.length;b.options=d;m=e.get(h);"string"===typeof n?k=document.querySelectorAll(n):"object"===typeof n&&n.jquery&&
(k=[],n.each(function(a,b){k.push(b)}));d=k.length;for(h=0;h<d;h++)for(e=k[h],n=0;n<l;n++)a.addEvent(e,g[h],function(a){b.domEvent(m,a)})},domEvent:function(c,b){if(c)c.onDirectOpen(b,this.options.items,this.options.extra)}})})(m);q.CompareTo.Items=m.Items;q.CompareTo.ResultPage=m.ResultPage;q.CompareTo.RightRails=m.RightRails})(window.R9); (function(c){c.createComponentClass("common.compareto.core.ResultPage",{options:{searchId:"",workaround:{}},resultPage:null,init:function(){var a=this.options,b=a.searchId,a=this.resultPage=new c.CompareTo.ResultPage({workaround:a.workaround});b&&a.ajaxOpen({searchId:b},function(a){if(a&&a.compareTos&&0<a.compareTos.length)for(var b=0;b<a.compareTos.length;b++)c.events.publish("ecommerce.track",{event:"cmp2.fd"})})},addEventHandlers:function(){this.base();var a=this;this.subscribe("resultspage.searchId.changed",
function(b){b&&b.searchId&&b.searchId!==a.options.searchId&&(c.ajax.execute("common/compareto/core/ResultPage",{data:{searchId:b.searchId}}),c.ComponentManager.removeSingleton(a._namespace))});this.subscribe("resultspage.simulate.changed",function(b){c.ajax.execute("common/compareto/core/ResultPage",{data:{searchId:b.searchId}});c.ComponentManager.removeSingleton(a._namespace)});a.options.workaround.loadAfterPageLoaded&&this.subscribe("resultspage.streaming.done",function(){a.resultPage.delayLoad()})}})})(window.R9);(function(c){c.createComponentClass("common.compareto.v3.ResultPage",{options:{searchId:"",vertical:""},init:function(){var a=this.options.searchId;if(a)window["@r9/cmp2-ui"].onResultPage({placement:null,requestInformation:null,type:this.getVertical(),searchId:a})},getVertical:function(){var a="";switch(this.options.vertical){case "flights":a="F";break;case "hotels":a="H";break;case "cars":a="C";break;case "packages":a="P";break;case "cruises":a="R";break;case "trains":a="T"}return a},addEventHandlers:function(){var a=
this,d=a.options;a.subscribe("resultspage.cleanup",function(){d.searchId=null});a.subscribe("resultspage.searchId.changed",function(b){b&&b.searchId&&b.searchId!==d.searchId&&(c.ComponentManager.removeSingleton(a._namespace),c.ajax.execute("common/compareto/v3/ResultPage",{data:{searchId:b.searchId,vertical:d.vertical}}))})}})})(window.R9);(function(b,d){b.createComponentClass("framework.JavaScriptComponent",{options:{vertical:null,global:!1},addEventHandlers:function(){var a=this;this.subscribe("resultspage.JavaScriptComponent.cleanup",function(c){a.options.vertical===c||a.options.global?a.options.vertical=c:a.options.singleton?b.ComponentManager.removeSingleton(a._namespace):a.destroy()})}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.booking.SearchIdExpirationChecker","framework.JavaScriptComponent",{options:{},searchId:null,searchIdLikelyValid:!0,checkTimer:null,init:function(){this.options.searchId&&(this.searchId=this.options.searchId)},addEventHandlers:function(){var a=this;this.base();this.subscribe("resultspage.streaming.done",this.searchEnded.bind(this));this.subscribe("resultspage.refreshed",this.searchEndedWait.bind(this));this.subscribe(["search.startSearch","resultspage.searchId.changed",
"search.expired","results.expired"],this.clearCheckTimer.bind(this));d("a.bookingLink").click(function(){return a.interceptClick()})},interceptClick:function(){if(this.searchIdLikelyValid)return!0;b.Analytics.api.trackEvent("searchidexpired/booklink");b.events.publish("results.expired");return!1},clearCheckTimer:function(){this.checkTimer&&(clearTimeout(this.checkTimer),this.checkTimer=null)},searchEndedWait:function(a){var b=this;setTimeout(function(){b.searchEnded(a)},100)},searchEnded:function(a){this.clearCheckTimer();
a&&a.searchId?(this.searchId=a.searchId,this.searchIdLikelyValid=!0,this.startCheckTimer()):a&&"streaming"in a&&!a.streaming?this.startCheckTimer():this.searchId=null},startCheckTimer:function(){if(!this.checkTimer){var a=this;this.checkTimer=setTimeout(function(){a.validateFromServer();a.checkTimer=null},this.options.checkTimeout)}},validateFromServer:function(){if(this.searchId){var a=this;d.ajax({type:"POST",url:"/s/horizon/common/booking/SearchIdValidationAction",headers:{"X-CSRF":b.globals.formtoken},
data:{searchId:this.searchId},success:function(c){c&&(a.searchIdLikelyValid=!c.isExpired,c.isExpired&&b.events.publish("searchid.expiration.check.failed"))}})}}})})(R9,jQuery);(function(b,k){b.createComponentClass("flights.results.SplitBookingHelper","framework.JavaScriptComponent",{searchId:null,componentPath:"flights/results/SplitBookingDialog",pendingRequests:{},dialogsOpened:[],addEventHandlers:function(){var a=this;this.base();this.subscribe(["multibook.splitProvider.click","SplitBooking.request"],this.requestSplitBookingDialog.bind(this));this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("filters.changed",this.onFiltersChanged.bind(this))},
onFiltersChanged:function(a){this.dialogsOpened.length&&b.dom.schedule(this.clearDialogs.bind(this))},clearDialogs:function(){this.dialogsOpened.length&&(this.dialogsOpened.forEach(function(a){a&&b.events.publish("SplitBookingDialog.remove",{resultId:a})}),this.dialogsOpened=[])},requestSplitBookingDialog:function(a){var l=a.searchId||this.searchId,d=k(a.element),g=!!a.replaceElement,c=a.targetElementId||d.length&&d.attr("id"),h=this;d.length&&!c&&(c="tmp-"+Math.round(1E5*Math.random()),d.attr("id",
c));c||this.log.error("SplitBookingDialog requested, but no target supplied");b.Analytics.api.trackEvent({action:"buttonClick",category:"splitProvider"});var f=c+"_"+a.resultId;if(b.question.ask("SplitBookingDialog.%s.exists".format(a.resultId)))b.events.publish("SplitBookingDialog.open",{targetElementId:c,resultId:a.resultId});else if(!this.pendingRequests[f]){this.pendingRequests[f]=!0;var e=b.question.ask("resultspage.filterState.is");e&&(e=JSON.stringify(e));b.events.publish("SplitBookingDialog.remove",
{resultId:a.resultId});b.ajax.execute(a.splitComponentPath||this.componentPath,{data:{searchId:l,resultId:a.resultId,filterState:e,targetElementId:c},handleSearchExpired:!0,replace:g,appendTo:g?d:void 0}).then(function(){b.events.publish("SplitBookingDialog.loaded",{resultId:a.resultId});h.dialogsOpened.push(a.resultId)}).fail(function(){b.events.publish("SplitBookingDialog.error",{resultId:a.resultId})}).always(function(){delete h.pendingRequests[f]})}}})})(R9,jQuery);(function(c,e){function g(a){return Object.keys(a).map(function(b){return 0<a[b].selected?b:null}).filter(function(a){return null!==a}).join(",")}function f(a,b){return a.hasOwnProperty(b)&&0<a[b].selected}c.publish("flights.results.FlightPriceAlertsUtils",{showEmailAlertError:function(a){c.events.publish("error.alert",{messages:a})},emailAlertSaveSuccess:function(a){c.events.publish("alertsaved.success",{alertid:a})},showDuplicateEmailAlertError:function(a,b){c.events.publish("alertsaved.error",
{errorid:a,error:b})}});c.createComponentClass("flights.results.FlightPriceAlertsController","framework.JavaScriptComponent",{options:{anonUser:!0,includeMaxPrice:!1,alertSavedMessage:null,alertSavedMessageShort:null,alertUpdatedMessage:null,alertManageLinkMessage:null,showManageLink:!1,isPriceAlertsAnon:!1,killWatchlist:!1,priceAlertUiUpdate:!1,initialFormData:null,isAccountWatchListEnabled:!1,showAlertFeedbackMessaging:!0},shortDepartDate:null,shortReturnDate:null,isOneWay:!1,updateSavedAlert:!1,
showFeedbackMessage:!1,searchId:null,alertFormData:{ac:null,alertid:null,action:null,alertsrc:null,hsrc:null,code:null,dest:null,desthint:null,destlist:null,depart_date:null,return_date:null,depart_flex:null,return_flex:null,numtrav:null,travadl:null,travsen:null,travyth:null,travchd:null,travsinf:null,travlinf:null,cabin:null,Enonstop:!1,oneway:null,dt:"e",ns:null,"1s":null,"2s":null,depairports:null,retairports:null,airlines:null,max:null,dtakeoffmin:null,dtakeoffmax:null,atakeoffmin:null,atakeoffmax:null,
dlandingmin:null,dlandingmax:null,alandingmin:null,alandingmax:null,removeHistory:null,createFromButton:null},init:function(){window.alerts=this;this.alertFormData=e.extend({},this.alertFormData,this.options.initialFormData);this.options.initialFormData&&(this.shortDepartDate=this.options.initialFormData.shortDepartDate,this.shortReturnDate=this.options.initialFormData.shortReturnDate,this.isOneWay=this.options.initialFormData.isOneWay)},addEventHandlers:function(){var a=this;this.base();this.subscribe("searchform.submit",
function(b){a.syncSearchParams(b)});this.subscribe("resultspage.filtersData.changed",function(b){a.syncFilterState(b);a.updateSavedAlert&&!a.options.anonUser&&(a.alertFormData.removeHistory=!0,a.getShowAlertFiltersUpdate(b)&&(a.showFeedbackMessage=!0),a.saveEmailPriceAlert(),a.updateSavedAlert=!1)});this.options.isPriceAlertsAnon&&this.options.anonUser?this.subscribe("flights.results.alerts.create",this.showDriveByEmailAlert.bind(this)):this.subscribe("flights.results.alerts.create",this.createPriceAlert.bind(this));
this.subscribe("flights.results.alerts.delete",this.deletePriceAlert.bind(this));this.subscribe("flights.results.alerts.driveby",this.saveDriveByEmailAlert.bind(this));this.subscribe("flights.results.alerts.multiFlightDriveby",this.saveMultiFlightDriveByEmailAlert.bind(this));this.subscribe("flights.results.existingAlert",function(b){a.alertFormData.alertid=b;c.events.publish("flights.priceAlert.setview",{view:"edit"})});this.subscribe("resultspage.streaming.done",function(){setTimeout(function(){!a.options.anonUser&&
a.alertFormData.alertid&&0<a.alertFormData.alertid.length&&(a.alertFormData.removeHistory=!1,a.saveEmailPriceAlert())},500)});this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("explorepage.flight.changed",function(b){a.searchId=b.searchId;b={code:b.origincode,dest:b.destinationCode,desthint:b.destinationCode,destlist:b.destinationCode,depart_dateISO:b.departureDate,return_dateISO:b.returnDate,shortDepartDate:moment(b.departureDate).format("ddd, MMM D"),
shortReturnDate:moment(b.returnDate).format("ddd, MMM D")};a.alertFormData=e.extend({},a.alertFormData,b,{numtrav:1,travadl:1,hsrc:"y",travsen:0,travyth:0,travchd:0,travsinf:0,travlinf:0,cabin:"e",Enonstop:!1,oneway:"n",dt:"e",ns:"Y","1s":"Y","2s":"Y",airlines:"ALL",dtakeoffmin:"NONE",dtakeoffmax:"NONE",atakeoffmin:"NONE",alandingmax:"NONE"})});this.subscribe("alertauth.show",this.showAlertAuth.bind(this));this.subscribe("alertsaved.success",function(b){a.showPriceAlertSaved(b.alertid)});this.subscribe("alertsaved.error",
function(b){a.showPriceAlertSaved(b.errorid,b.error)});this.subscribe("filters.changed",function(){a.alertFormData.alertid&&a.alertFormData.alertid.length&&(a.updateSavedAlert=!0)});this.answer("flights.results.alerts.existingAlert",function(){return a.alertFormData.alertid})},clearFormData:function(){Object.keys(this.alertFormData).forEach(function(a){this.alertFormData[a]=null},this);this.shortDepartDate=this.shortReturnDate=null;this.isOneWay=!1;this.alertFormData.dt="e"},getFlexParam:function(a){return a&&
"exact"!==a?a:null},syncSearchParams:function(a){this.clearFormData();this.alertFormData.depart_date=a.depart_date;this.alertFormData.return_date=a.return_date;this.alertFormData.depart_flex=this.getFlexParam(a.depart_date_flex);this.alertFormData.return_flex=this.getFlexParam(a.return_date_flex);this.alertFormData.code=a.origincode?a.origincode.split("/")[0]:"";this.alertFormData.dest=this.alertFormData.desthint=this.alertFormData.destlist=a.destinationcode?a.destinationcode.split("/")[0]:"";this.alertFormData.numtrav=
a.travelers;this.alertFormData.travadl=a.adults;this.alertFormData.travsen=a.seniors;this.alertFormData.travyth=a.youth;this.alertFormData.travchd=a.child;this.alertFormData.travlinf=a.lapInfant;this.alertFormData.travsinf=a.seatInfant;this.isOneWay=a.oneway;this.alertFormData.cabin=a.cabin;this.alertFormData.oneway=a.oneway?"y":a.isMulticity?"m":"weekend"===a.flex_category?"w":"n";this.shortDepartDate=moment(a.depart_date_canon).format("MMM D");this.isOneWay||(this.shortReturnDate=moment(a.return_date_canon).format("MMM D"))},
syncFilterState:function(a){this.alertFormData.dtakeoffmin=this.alertFormData.dtakeoffmax=this.alertFormData.atakeoffmin=this.alertFormData.alandingmax="NONE";this.alertFormData.airlines="ALL";this.alertFormData.depairports=this.alertFormData.retairports=this.alertFormData.max=null;this.alertFormData.max=null;a.hasOwnProperty("stops")&&(this.alertFormData.ns=f(a.stops.valueMap,"0")?"Y":"N",this.alertFormData["1s"]=f(a.stops.valueMap,"1")?"Y":"N",this.alertFormData["2s"]=f(a.stops.valueMap,"2")?"Y":
"N");if(a.hasOwnProperty("airports")&&a.airports.isDirty){var b=a.airports.legValues[0];this.alertFormData.depairports=g(b.headingValueMap[b.orderedHeadings[0]]);1<b.orderedHeadings.length&&(this.alertFormData.retairports=g(b.headingValueMap[b.orderedHeadings[1]]))}a.hasOwnProperty("airlines")&&a.airlines.isDirty&&(b=Object.keys(a.airlines.valueMap).filter(function(b){var d=a.airlines.valueMap[b];return 0===d.selected&&!d.disabled&&"MULT"!==b&&"operators"!==b}),this.alertFormData.airlines=0<b.length?
b.join(","):"ALL");a.hasOwnProperty("takeoff")&&a.takeoff.isDirty&&(this.alertFormData.dtakeoffmin=a.takeoff.legs[0].leftRange,this.alertFormData.dtakeoffmax=a.takeoff.legs[0].rightRange,1<a.takeoff.legs.length&&(this.alertFormData.atakeoffmin=a.takeoff.legs[1].leftRange,this.alertFormData.atakeoffmax=a.takeoff.legs[1].rightRange));a.hasOwnProperty("landing")&&a.landing.isDirty&&(this.alertFormData.alandingmin=a.landing.legs[0].leftRange,this.alertFormData.alandingmax=a.landing.legs[0].rightRange,
1<a.landing.legs.length&&(this.alertFormData.dlandingmin=a.landing.legs[1].leftRange,this.alertFormData.dlandingmax=a.landing.legs[1].rightRange));this.options.includeMaxPrice&&a.hasOwnProperty("price")&&a.price.isDirty&&(this.alertFormData.max=a.price.rightRange)},serialize:function(){var a=this;return Object.keys(a.alertFormData).map(function(b){var d=a.alertFormData[b];return null===d||void 0===d||""===d?"":encodeURIComponent(b)+"\x3d"+encodeURIComponent(d)}).join("\x26")},createPriceAlert:function(a){this.options.anonUser?
this.showAlertAuth():(this.showFeedbackMessage=!0,this.alertFormData.createFromButton=!0,this.saveEmailPriceAlert());a&&a.vsLog&&c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",action:"create",value:"new"})},deletePriceAlert:function(a){a&&a.alertId&&!this.alertFormData.alertid&&(this.alertFormData.alertid=a.alertId);this.options.anonUser&&!this.alertFormData.alertid?this.showAlertAuth():(this.showFeedbackMessage=!0,this.deleteEmailPriceAlert(a));a&&a.vsLog&&
c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",action:"delete",value:this.alertFormData.alertid})},renderSearchDataForLogin:function(a){var b=e(a.elementNode).find(".flightCities");a=e(a.elementNode).find(".flightDates");b.empty();a.empty();b.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.alertFormData.code)));b.append(e("\x3cspan class\x3d'%s'/\x3e".format(this.isOneWay?"arrow singleArrow":"arrow doubleArrow")));b.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.alertFormData.dest)));
a.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.shortDepartDate)));this.isOneWay||(a.append(e("\x3cspan\x3e - \x3c/span\x3e")),a.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.shortReturnDate))))},showAlertAuth:function(a,b){var d=this;a=e.extend({},a,{promoType:"alerts"});a={promo:"priceAlert",promoType:a.promoType,username:a.username,aftershow:this.renderSearchDataForLogin.bind(this),success:function(){c.authentication.cached_dialog.dialog.close();d.showFeedbackMessage=!0;d.alertFormData.createFromButton=
!0;d.saveEmailPriceAlert().done(function(){window.location.reload()}).fail(function(){d.log.error("Save email price alert failed")})}};b?c.authentication.showLogin(a):c.authentication.showSignup(a)},saveEmailPriceAlert:function(a){var b=e.Deferred();this.alertFormData.action="save";this.alertFormData.hsrc="y";this.alertFormData.alertsrc=a||"toolbox";e.ajax({type:"POST",headers:{"X-CSRF":c.globals.formtoken},url:"/k/alertajax",data:this.serialize(),dataType:"script",error:function(a,e){c.events.publish("error.alert",
{messages:e});b.reject()},success:function(){b.resolve()}});return b},deleteEmailPriceAlert:function(a){var b=this;e.ajax({type:"POST",url:"/h/hermes/prefs/ajax/alert/v1",headers:{"X-CSRF":c.globals.formtoken},data:{action:"delete",alertid:this.alertFormData.alertid},success:function(){b.alertFormData.alertid="";c.events.publish("flights.priceAlert.deleted");a&&a.success&&a.success()},error:function(a,b){c.events.publish("error.alert",{messages:b})}})},showDriveByEmailAlert:function(a){if(!this.openExistingDriveby(a)){var b=
a&&a.popover,d={data:{searchId:this.searchId,forceShow:!0,popover:b},replace:!0};a&&a.hasOwnProperty("sourceId")&&(d.data.sourceId=a.sourceId);b&&(d.appendTo=a.appendTo);c.ajax.execute("flights/results/"+(b?"ForzaFlightPriceAlertDriveBy":"FlightPriceAlertDriveBy"),d).then(function(){a&&a.success&&a.success()})}},openExistingDriveby:function(a){var b=a&&a.popover?"pricealert.driveby.popover":"pricealert.driveby",d=c.question.ask(b);if(null===d)return!1;if(d===this.searchId)return c.events.publish(b+
".show",a),!0;c.events.publish(b+".destroy");return!1},saveDriveByEmailAlert:function(a){var b=this;this.alertFormData.action="driveby";this.alertFormData.alertsrc="driveby";e.ajax({type:"POST",url:"/k/run/drivebyalert/createflightpricealert",headers:{"X-CSRF":c.globals.formtoken},data:{searchid:this.searchId,email:a.email,optin:a.optin,regurl:a.sourceId||"drivebysave",noforcelogin:b.options.isPriceAlertsAnon},success:function(d){d&&d.success?(c.Analytics.api.trackEvent({category:a.vsCategory||"Drive-By",
action:"signup"}),b.alertFormData.alertid=d.alertid,c.events.publish("flights.priceAlert.setview",{view:"edit"}),c.events.publish("flights.priceAlert.created",{alertId:d.alertid,searchId:b.searchId}),"function"===typeof a.success?a.success():b.showAlertCompleteFeedback(!0,!0),c.authentication.needsRefresh=!0):d&&!d.success&&d.existingUser&&b.showAlertAuth(null,!0)},cache:!1})},saveMultiFlightDriveByEmailAlert:function(a){var b=this;this.alertFormData.action="driveby";this.alertFormData.alertsrc="driveby";
e.ajax({type:"POST",url:"/k/run/drivebyalert/createflightpricealerts",headers:{"X-CSRF":c.globals.formtoken},data:{flights:JSON.stringify(a.flights),email:a.email,optin:a.optin,regurl:a.sourceId||"drivebysave",noforcelogin:b.options.isPriceAlertsAnon},success:function(a){a&&a.success?(b.alertFormData.alertid=a.alertid,b.showAlertCompleteFeedback(!0,!0),c.Analytics.api.trackEvent({category:"Drive-By",action:"signup"}),c.events.publish("flights.priceAlert.setview",{view:"edit"}),c.authentication.needsRefresh=
!0):a&&!a.success&&a.existingUser&&b.showAlertAuth(null,!0)},cache:!1})},showPriceAlertSaved:function(a){c.events.publish("flights.priceAlert.setview",{view:"edit"});c.events.publish("flights.priceAlert.created",{searchId:this.searchId,alertId:a});if(this.alertFormData.alertid&&0<this.alertFormData.alertid.length)this.showFeedbackMessage&&(this.showAlertCompleteFeedback(!1),this.showFeedbackMessage=!1);else{c.Analytics.api.trackEvent("pricealert/exactdate/create");var b=c.question.ask("flights.results.prediction.is");
b&&"none"!==b.advice?c.Analytics.api.trackEvent("pricealert/prediction/"+(b.buy?"buy":"hold")):c.Analytics.api.trackEvent("pricealert/prediction/nodata");this.alertFormData.alertid=a;this.showAlertCompleteFeedback(!0)}},getShowAlertFiltersUpdate:function(a){return a.stops.isDirty||a.airlines.isDirty||a.airports.isDirty||a.landing.isDirty||a.takeoff.isDirty||a.price.isDirty?!0:!1},showAlertCompleteFeedback:function(a,b){if(this.options.showAlertFeedbackMessaging&&!this.options.killWatchlist&&!this.options.priceAlertUiUpdate){var d=
e(".belowSearchContainer .warningsContainer"),f=a?this.options.alertSavedMessage:this.options.alertUpdatedMessage,g=a?"alertSavedWarning":"alertUpdatedWarning";a&&b&&(f=this.options.alertSavedMessageShort);this.options.showManageLink&&(f+=" \x3ca href\x3d'"+(this.options.isAccountWatchListEnabled?"/watchlist":"/alerts")+"' target\x3d'_blank' class\x3d'manageLink'\x3e"+this.options.alertManageLinkMessage+"\x3c/a\x3e",c.Analytics.api.trackEvent({category:"pricealert/managelink/impression",action:"impression"}));
d.empty();d.append("\x3cdiv class\x3d'%s'\x3e\x3cspan\x3e%s\x3c/span\x3e\x3c/div\x3e".format(g,f));e(".manageLink",d).on("click.manageLink",function(){c.Analytics.api.trackEvent({category:"pricealert/managelink/click",action:"click"})});d.addClass("visible");e(document).one("click",function(){d.removeClass("visible");e(".manageLink",d).off("click.manageLink")});a||setTimeout(function(){d.removeClass("visible")},8E3)}c.events.publish("watching",{searchId:this.searchId})}})})(R9,jQuery);(function(d,f){var k=d.config.getBoolean("ui.whisky.modal.enabled",!1);d.createComponentClass("common.booking.ClickoutController","framework.JavaScriptComponent",{options:{postClickDelay:200},resultsOrderLogString:null,searchIdExpirationCheckFailed:!1,hotelCarsPostClickXSellRequested:!1,addEventHandlers:function(){this.base();var a=this;this.subscribe("clickout.open",function(b){a.searchIdExpirationCheckFailed?(d.Analytics.api.trackEvent("searchidexpired/bestclick"),d.events.publish("results.expired")):
a.open(b)});this.subscribe("clickout.resultsOrder.update",function(b){a.resultsOrderLogString=b});this.subscribe("searchid.expiration.check.failed",function(){a.searchIdExpirationCheckFailed=!0});this.subscribe("resultspage.cleanup",function(){a.searchIdExpirationCheckFailed=!1})},open:function(a){var b=a.data||{},c=f(a.element),e=a.event;a=a.callback||f.noop;var g=e&&(e.metaKey||e.ctrlKey);c.length&&("A"!==c.get(0).nodeName&&(c=c.find("a").eq(0)),b.target=b.target||c.attr("target"),b.url=b.url||
c.attr("href"),b.name=b.name||c.data("name"),b.code=b.code||c.data("code"),b.splitProvider=b.splitProvider||c.data("split-provider"),b.element=c,b.showWhiskyModal=!!b.showWhiskyModal,void 0===b.clickoutWarningDialog&&(b.clickoutWarningDialog=c.data("clickout-warning-dialog")));e&&e.preventDefault();b.noExternalRedirect=b.noExternalRedirect||b.splitProvider||b.clickoutWarningDialog||b.clickoutDetailsDialog;"undefined"===typeof b.showAfterclick&&(b.showAfterclick=!b.noExternalRedirect);b.noExternalRedirect?
this.postClick(b,a,g):(b.target=b.target||"_blank",(c="self"===b.target)&&this.postClick(b,a,g),e=b.url,this.resultsOrderLogString&&(e+=(1>e.indexOf("?")?"?":"\x26")+"resultsOrder\x3d"+encodeURIComponent(this.resultsOrderLogString)),k&&b.showWhiskyModal?d.events.publish("cars.whisky.modal.startWatching",{url:e+"\x26_kw_whiskyModal\x3dtrue"}):window.open(e,b.target),c||setTimeout(this.postClick.bind(this,b,a,g),this.options.postClickDelay))},postClick:function(a,b,c){var e=!1,g=function(){e=!0},h;
a.clickoutDetailsDialog||d.events.publish(["multibook.providerClicked","provider.book.click"],f.extend({resultId:a.resultId,uiResultId:a.uiResultId,providerName:a.name,providerCode:a.code,splitProvider:a.splitProvider,clickoutDetailsDialog:a.clickoutDetailsDialog,clickoutWarningDialog:a.clickoutWarningDialog,afterclickIgnore:!a.showAfterclick||c},a.customPostClickData));a.clickoutDetailsDialog?(h=f.extend({},a,this.getSubscriptionResetData(g)),d.events.publish("multibook.modalDetailsDialog.show",
h)):a.splitProvider?d.events.publish("multibook.splitProvider.click",{resultId:a.resultId,element:a.element}):a.clickoutWarningDialog&&(h=f.extend({},a,this.getSubscriptionResetData(g)),d.events.publish("multibook.clickoutWarning.show",h));if(h&&!e)this.onClickoutWarningFailure(h);!a.noExternalRedirect&&"flights"===this.options.vertical&&d.config.getBoolean("ui.post.click.xsell.enabled",!1)&&this.launchPostClickXSell(a);b(a)},getSubscriptionResetData:function(a){return{clickoutWarningDialog:!1,clickoutDetailsDialog:!1,
noExternalRedirect:!1,verifySubscriptionCallback:a}},onClickoutWarningFailure:function(a){var b=f.extend({},a,this.getSubscriptionResetData(void 0)),c;try{c=JSON.stringify(a)}finally{this.open({data:b}),this.log.error("Failed to open clickout dialog. Subscription for result "+a.resultId+" not registered.\nPublish data: "+c)}},launchPostClickXSell:function(a){if(!this.hotelCarsPostClickXSellRequested){this.hotelCarsPostClickXSellRequested=!0;d.Analytics.api.trackEvent("flight-hotel-xsell/impression");
var b=a.element.parents("."+d.strings.encodeClassName("Base-Results-HorizonResult"));b.length&&d.ajax.execute("flights/results/xsells/HotelCarsPostClickXSell",{data:{searchId:a.searchId},appendTo:b,insertBefore:!0,replace:!1})}}})})(R9,jQuery);(function(b,a){b.createComponentClass("common.authentication.LoginOptionsDialog",{trackingCategory:"anon-trips-login",trackingLabel:null,init:function(){this.optionsDialog=this.element.dialog().getWidget();this.confirmationDialog=a("#"+this.id("confirmation")).dialog().getWidget()},addEventHandlers:function(){b.events.subscribe("show.login.options.dialog",a.proxy(this.openDialog,this));a("#"+this.id("regularAuth")).click(a.proxy(this.regularAuth,this));a("#"+this.id("guestAuth")).click(a.proxy(this.guestAuth,
this));a("#"+this.id("guestConfirmation")).click(a.proxy(this.continueAsGuest,this));a("#"+this.id("googleAuth")).click(a.proxy(this.googleAuth,this));a("#"+this.id("fbAuth")).click(a.proxy(this.fbAuth,this));a("#"+this.id("signUp")).click(a.proxy(this.signUp,this))},openDialog:function(a){a=a||{};this.trackingLabel=a.trackingLabel||null;a.forceLogin||!this.stayAnon?this.showDialog():this.continueAsGuest()},showDialog:function(){this.track("display-dialog");var c=this;a.when(b.Social.FB.ensureAPILoaded(),
b.Social.Google.ensureAPILoaded()).always(function(){c.optionsDialog.open()})},closeOptionsDialog:function(){b.events.unsubscribe("continue.as.guest");this.optionsDialog.close()},regularAuth:function(){this.track("use-email-address");this.closeOptionsDialog();b.authentication.showLogin()},continueAsGuest:function(){this.track("continue-as-guest");this.confirmationDialog.close();b.events.publish("continue.as.guest");this.stayAnon=!0;this.closeOptionsDialog()},guestAuth:function(){this.track("guest-confirm");
this.optionsDialog.close();b.config.getBoolean("ui.trips.anon.second-step-dialog.enabled",!1)?this.continueAsGuest():this.confirmationDialog.open()},signUp:function(){this.track("guest-sign-me-up");this.confirmationDialog.close();this.optionsDialog.open()},fbAuth:function(){this.closeOptionsDialog();b.events.subscribe("fbauth.login.success",function(){window.location.reload(!0)});b.authentication.external.facebook.login(null,null,null,null,{category:this.trackingCategory,label:this.trackingLabel})},
googleAuth:function(){this.closeOptionsDialog();b.events.subscribe("googleauth.login.success",function(){window.location.reload(!0)});b.authentication.external.google.login(null,null,null,{category:this.trackingCategory,label:this.trackingLabel})},track:function(a){b.Analytics.api.trackEvent({category:this.trackingCategory,action:a,label:this.trackingLabel})}})})(R9,jQuery);(function(c,e,f){var g=c.config.getBoolean("ui.horizon.results.searchPoll.includePollNumberInQuery",!0),h={trains:"trains/results/TrainsSearchPoll",flights:"flights/results/FlightSearchPoll",hotels:"hotels/results/HotelSearchPoll",packages:"packages/results/PackageSearchPoll",cars:"cars/results/CarSearchPoll",deals:"deals/results/DealSearchPoll",cruises:"cruises/results/CruiseSearchPoll",rentals:"rentals/results/RentalSearchPoll",activities:"activities/results/ActivitiesSearchPoll",cityhotels:"hotels/cityhotels/CityHotelsPoll",
restaurants:"restaurants/results/RestaurantSearchPoll"},k={trains:"trains/results/TrainsResultDetails",flights:"flights/results/FlightResultDetails",hotels:"hotels/results/HotelResultDetails",packages:"packages/results/PackageResultDetails",rentals:"rentals/results/HotelResultDetails",activities:"activities/results/ActivitiesResultDetails"};c.publish("base.results.AjaxSearchPoll",f.extend({searchUrl:null,detailsUrl:null,options:{vertical:null,searchId:null,appendTo:null},pollNumber:0,searchId:null,
constructor:function(a){this.options=e.extend({},this.options,a);if(!a.vertical)throw"AjaxSearchPoll requires a vertical to be properly initialized";this.searchId=this.options.searchId;this.searchUrl=h[this.options.vertical];this.detailsUrl=k[this.options.vertical];"cityhotels"===this.options.vertical&&this.options.citycode&&(this.searchUrl+="?citycode\x3d"+this.options.citycode)},fetchResults:function(a,b){a=e.extend({data:e.extend({searchId:this.searchId,poll:!0,pollNumber:this.pollNumber},a||{}),
appendTo:this.options.appendTo,replace:!1,logServerErrors:c.config.getBoolean("ui.ajax.logServerErrors.searchPoll",!1),enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.searchPoll",!0)},b||{});c.config.getBoolean("ui.ssajax.last.action.abort",!1)&&(a.data.ajaxts=(new Date).getTime());b=this.searchUrl;g&&(b+="?p\x3d"+this.pollNumber);this.searchId=a.data.searchId;this.pollNumber++;return c.ajax.execute(b,a)},fetchDetails:function(a,b){b={data:{resultId:a,searchId:this.searchId},appendTo:b,
enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.inlineDetails",!0)};if(null===b.searchId)throw"Cannot request result details for %s: No searchId tied to this instance of AjaxSaerchPoll.".format(a);return c.ajax.execute(this.detailsUrl,b)}}));c.publish("resultsMetaData",{PROPERTIES:"code selected minPrice count displayValue displayOrder resetState defaultSelectedState dynamicFilteredStatus ignoreOnly hideOnly href noSelect disabled cssClass showAllState noPrice pluralDisplayValue minDuration minDurationValue meta".split(" "),
publish:function(a){a.hasOwnProperty("filtersData")&&this.remapFilters(a.filtersData);c.events.publish("search.poll.response",a)},remapFilters:function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=a[b[c]];d.valueMap||d.headingValueMap?this.remapValueSetFilter(d):(d.legValues||d.legHeadingValues)&&this.remapPerLegValueSetFilter(d)}},remapValueSetFilter:function(a){if(a.valueMap)Object.values(a.valueMap).forEach(this.remapValueData.bind(this));else if(a.headingValueMap)for(var b in a.headingValueMap)Object.values(a.headingValueMap[b]).forEach(this.remapValueData.bind(this))},
remapPerLegValueSetFilter:function(a){if(a.legValues)Object.values(a.legValues).forEach(this.remapValueSetFilter.bind(this));else if(a.legHeadingValues)for(var b=0;b<a.legHeadingValues.length;b++)Object.values(a.legHeadingValues[b]).forEach(this.remapValueSetFilter.bind(this))},remapValueData:function(a){for(var b=a.rawState?a.rawState.split(";"):[],c=0;c<b.length;c++){var d=b[c];d.length&&(a[this.PROPERTIES[c]]=this.castValue(this.PROPERTIES[c],d))}if(a.hasOwnProperty("dynamicFilteredStatus")){a.filtered=
!1;a.partiallyFiltered=!1;switch(a.dynamicFilteredStatus){case 1:a.filtered=!0;break;case 2:a.partiallyFiltered=!0}delete a.dynamicFilteredStatus}a.hasOwnProperty("noPrice")&&a.noPrice&&(a[a.noPrice]=!0,delete a.noPrice);delete a.rawState},castValue:function(a,b){switch(a){case "code":case "displayValue":case "minPrice":case "pluralDisplayValue":case "cssClass":case "minDuration":case "href":case "noPrice":return b;case "selected":case "count":case "displayOrder":case "showAllState":case "resetState":case "defaultSelectedState":case "minDurationValue":case "dynamicFilteredStatus":return parseInt(b);
case "ignoreOnly":case "hideOnly":case "noSelect":case "disabled":return"1"===b;default:return b}}})})(R9,jQuery,base2.Base);(function(f,k,l){var m=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDetails",!0),n=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDialogs",!0);f.publish("base.results.ResultsPageDOMUtils",{mergeOpenResults:function(a,d){if(m){var c=a.find(".Base-Results-HorizonResult.DetailOpen");c.length&&this.mergeOpenDetails(c,a)}n&&(c=k(".Common-Widgets-Dropdown-DropdownDialog-Content.open"),c.length&&this.mergeOpenDialogs(c,a,d))},mergeOpenDialogs:function(a,d,c){for(var b=0;b<a.length;b++){var e=
a[b].getAttribute("data-dropdown-owner");if(e&&d.find("#"+e).length){e=c.find("#"+a[b].id);if(e.length){var g=e.attr("id").split("-")[0],h=k("#"+g),g=c.find("#"+g);if(h.length&&g.length&&h.index()===g.index()){a[b].setAttribute("reconcile-ignore","attributes");f.dom.merge(a[b],e[0]);e[0].remove();continue}}a[b].remove()}}},mergeOpenDetails:function(a,d){for(var c=0;c<a.length;c++)if(!d.find("#"+a[c].id).hasClass("DetailOpen")){a[c].setAttribute("reconcile-ignore","attributes");var b=a[c].getElementsByClassName("detailsWrapper");
1===b.length&&(b[0].setAttribute("reconcile-ignore","all"),b=b[0].getElementsByClassName("detailsContent"),b.length&&b[0].children.length&&b[0].children[0].setAttribute("do-not-destroy","true"))}}});f.publish("base.results.AdsHelper",l.extend({adRequestInfo:null,adsResponseDate:null,adUpdateTimerID:null,constructor:function(a){this.adRequestInfo={}},updateAds:function(a){f.config.getBoolean("ui.ads.copyPollAdsData",!0)&&(a=k.extend(!0,{},a));if(f.config.getBoolean("ui.ads.nowAfterResponse",!0)&&this.adRequestInfo)for(var d in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(d)){var c=
this.adRequestInfo[d];if(c)for(var b=0;b<c.length;b++)c[b].now=0}this.adsResponseDate=Date.now();window.clearTimeout(this.adUpdateTimerID);this.adUpdateTimerID=setTimeout(function(){f.events.publish("resultspage.ads.update",a)},f.config.getInt("ui.horizon.resultspage.ads.updateDelay",100))},requiresAdsPoll:function(){if(!f.config.getBoolean("ui.horizon.resultspage.requireAdsPoll",!0)||this.adsResponseDate||!this.adRequestInfo)return!1;for(var a in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(a)){var d=
this.adRequestInfo[a];if(d&&d.pop)for(var c=0;c<d.length;c++)if(d[c].now)return!0}return!1},clearAdRequestInfo:function(a){this.adRequestInfo&&(this.adRequestInfo[a]=[])},onSetupAdsRequest:function(a){if(a&&a.adType&&a.pageLocation){this.adRequestInfo||(this.adRequestInfo={});this.adRequestInfo[a.adType]||(this.adRequestInfo[a.adType]=[]);for(var d=this.adRequestInfo[a.adType],c,b=0;b<d.length;b++)d[b]&&d[b].pageLocation===a.pageLocation&&(c=1,d[b]=a);c||d.push(a)}},setAdRequestSearchOptions:function(a,
d){if(a&&this.adRequestInfo){var c="",b="",e,g,h=function(a){if(!a||!a.length)return"";for(var c="",b,e=0;e<a.length;e++)(b=a[e])&&b.pageLocation&&(!isNaN(b.minRefreshRate)&&(0<b.minRefreshRate||0===b.minRefreshRate)&&(g=void 0===g?b.minRefreshRate:Math.min(g,b.minRefreshRate)),b.now||b.events&&b.events.pop&&"string"===typeof d&&0<=b.events.indexOf(d))&&(f.config.getBoolean("ui.ads.nowAfterResponse",!0)||(b.now=0),c+=b.pageLocation+",");return c};for(e in this.adRequestInfo)this.adRequestInfo.hasOwnProperty(e)&&
("displayAd"===e?c=h(this.adRequestInfo[e]):"textAd"===e&&(b=h(this.adRequestInfo[e])));d&&f.events.publish("resultspage.ads.options");!a.forceRefreshAds&&this.adsResponseDate&&0<g&&Date.now()-this.adsResponseDate<g||(b&&(a.textAdPageLocations=b.substr(0,b.length-1)),c&&(a.displayAdPageLocations=c.substr(0,c.length-1)),a.existingAds=!!this.adsResponseDate)}}}))})(R9,jQuery,base2.Base);(function(b,e){var l=/attempt=([0-9]+)/,m=/lastms=([0-9]{13})/,p=b.config.getBoolean("ui.ajax.logServerErrors.searchPoll",!1);b.createComponentClass("base.results.ResultsPage",{searchRunner:null,searchId:null,priceType:null,searchStartParams:null,vertical:null,urlSearchStartSupported:!1,loggingPrefix:"resultspage",poll:{pollingId:null,sent:0,activeRequest:null,ended:!1,nextPollTimeoutId:null,firstPhaseCompleted:!1,consecutiveEmptyResponses:0,lastPollTotalCount:-1,started:null,usingPreservedFilters:!1,
reason:"POLL"},filterState:null,urlFilterState:null,filtersData:null,useUrlFilterState:!0,resultsList:e(),listBody:e(),listCol:null,progressBar:null,paginator:null,viewState:null,leftRail:null,rightRail:null,backToTop:null,clientTimeoutId:null,idleTimeoutId:null,secondPhaseTimeoutId:null,frenchWarning:null,ariaResultMsgWidget:null,ajaxAppendTo:null,preserveFilters:!1,preservedFilters:null,adsHelper:null,lastLimitedDateMs:null,lastLimitedMinMS:18E5,options:{infinite:!1,button:!1,startSearchImmediately:!1,
searchParams:null,ajaxParams:null,poll:!0,pageNumber:1,searchId:null,completed:!1,sortMode:null,quickLinkType:null,ascending:null,priceType:null,centerPointLat:null,centerPointLong:null,urlFilterState:null,pollingTimeout:16E3,exponentialBackoffDelay:!1,pollDelay:250,maxPollDelay:5E3,pollingId:null,windowScroll:"",persistWindowScroll:!1,filtersData:null,quickLinkData:null,useTwoPhasePolling:!1,visible:!1,useBuzz:!1,fastCover:!1,showExpiredResultsMessage:!0,secondPhaseWait:null,secondPhaseTimeout:null,
idleExpireMinutes:120,enforceIdleTimeout:!0,showFilteredButSimilar:!1,scrollTopOnFilterChange:!1,defaultSortType:null,useUrlSortMode:!1,msg:{expired_search:"",filters_removed:""},ariaMsg:{resultsLoading:"",resultsReady:"",noResultsFound:""},nonClearablePreservedFilters:[],forceLoadingTreatmentSkip:!1,placeholderDelay:0,defaultPaddingLeft:30,watchedResultId:"",animateInlineSearch:!0,searchAndScrollEnabled:!1},init:function(){this.appendResults=this.options.infinite||this.options.button;this.filterState=
{};this.viewState={openDetails:{}};this.leftRail=this.getChildElement("leftRail");this.rightRail=this.getChildElement("rightRail");this.backToTop=this.getChildElement("backToTop");this.resultsList=this.getChildElement("list");this.listBody=this.element.find(".listBody");this.listCol=this.getChildElement("listCol");this.resultsListCover=this.listBody.find(".resultsListCover");this.loadingMessage=this.element.find(".loadingMessage");this.progressBar=this.getChildElement("progress");this.frenchWarning=
this.getChildElement("frenchWarning");this.searchId=this.options.searchId;this.priceType=this.options.priceType;this.poll.pollingId=this.options.pollingId;this.urlFilterState=this.options.urlFilterState;this.searchStartParams=this.options.searchStartParams||{};this.ariaResultMsgWidget=this.getChildElement("aria-result-msg").getWidget();b.events.publish("paginator.hide");this.options.filtersData&&b.resultsMetaData.remapFilters(this.options.filtersData)},addEventHandlers:function(a){var c=this,d=null,
k=function(){null!==d&&clearTimeout(d);d=setTimeout(function(){b.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:c.searchId,key:"openDetails",value:JSON.stringify(c.viewState.openDetails)})},1E3)};this.subscribe(["searchform.submit","multilocale.search.submit"],this.startSearchFromSearchForm.bind(this));a=this.onFilterStateChange.bind(this);a.priority=0;this.subscribe("filters.changed",a);this.subscribe("filters.changed.all",this.onAllFilterStateChange.bind(this));
a=this.preprocessResponse.bind(this);a.priority=0;this.subscribe("search.poll.response",a);this.subscribe("resultspage.filters.sync",this.syncFilterState.bind(this));this.subscribe("paginator.change",this.onPaginatorChange.bind(this));this.subscribe("resultsHeader.changed",this.onResultsListHeaderChange.bind(this));this.subscribe("resultspage.view.setvisible",this.setVisible.bind(this));this.subscribe("resultspage.results.refresh",this.refreshResults.bind(this));this.subscribe("resultspage.transition.remove",
this.removeTransitionClass.bind(this));this.subscribe(["result.details.opened","result.details.tab.changed"],function(a){c.viewState.openDetails[a.resultId]=a.activeTab||"overview";k()});this.subscribe("result.details.closed",function(a){delete c.viewState.openDetails[a.resultId];k()});this.options.searchAndScrollEnabled&&(this.subscribe("form.changedState",this.enableSearchAndScrollEvent.bind(this)),this.subscribe("unbind.scroll.search.event",this.unbindScrollAndSearchListener.bind(this)));this.subscribe(["results.expired",
"user.refresh.expired"],this.reloadExpiredResults.bind(this));this.subscribe("resultspage.showLowest",function(){b.events.publish("filters.reset",{type:"showAll"});b.events.publish("resultsHeader.sortType.set",{sortCode:"price_a"})});this.subscribe("ads.request",function(a){c.getAdsHelper().onSetupAdsRequest(a)});this.subscribe("results.quickLinkType.setDefault",function(a){a.hasOwnProperty("quickLinkType")&&(c.options.quickLinkType=a.quickLinkType)});this.answer("resultspage.filterState.is",function(a){return a&&
c.filterState?c.filterState[a]:c.filterState});this.answer("resultspage.filterData.get",function(){return c.filtersData?c.filtersData:c.options.filtersData});this.answer("resultspage.priceType.get",function(){return c.priceType});this.answer("resultspage.sortMode.get",function(){return c.options.sortMode});this.answer("resultspage.searchFailed",function(){return c.listBody.hasClass("failed")});this.answer("resultspage.urlFilterState.get",function(){return c.urlFilterState});this.answer("resultspage.leftMargin",
this.getPageContainerLeftMargin.bind(this));this.answer("resultspage.poll.ended",function(){return c.poll.ended});this.appendResults&&(this.backToTop.click(function(){e(window).scrollTop(0).trigger("scroll");b.Analytics.api.trackEvent({subPageId:"ResultsPage",category:"backToTop",action:"click"})}),this.subscribe("resultspage.pageNumber.changed",function(){var a=e(window).scrollTop();e(window).unbind("scroll.backToTop").bind("scroll.backToTop",function(){var b=e(this).scrollTop();b>2*e(this).height()&&
a>b?c.backToTop.addClass("visible"):c.backToTop.removeClass("visible");a=b})}));this.subscribe("results.leftRail.toggleCollapsed",this.toggleLeftRailCollapsed.bind(this));e(window.document).on("mouseleave.horizonResult",function(){b.events.publish("document.mouseLeave")});e(window).on("keydown.landmark_nav",function(a){var b=a.which,d=a.shiftKey,k=a.altKey,f=a.metaKey;a=a.ctrlKey;if(9===b&&k&&f||9===b&&k&&a)if(a=e("*:focus"),b=e("[role\x3dform],[role\x3dsearch],[role\x3dmain]"),k=d?-1:b.length,f=
d?b.length-1:0,d=d?-1:1,a.length){var n=a.closest("[role\x3dform],[role\x3dsearch],[role\x3dmain]");n.length?(a=e(n[0]).index("[role\x3dform],[role\x3dsearch],[role\x3dmain]"),d=a+d,d===k&&(d=f),b[d].focus()):(d=c.nextInDOM("[role\x3dform],[role\x3dsearch],[role\x3dmain]",a))&&null!=d&&d.focus()}else b[0].focus()})},nextInDOM:function(a,c){for(c=this.getNext(c);0!=c.length;){var b=this.searchFor(a,c);if(null!=b)return b;c=this.getNext(c)}return null},getNext:function(a){return 0<a.next().length?a.next():
this.getNext(a.parent())},searchFor:function(a,c){if(c.is(a))return c;var b=null;c.children().each(function(){b=searchFor(a,e(this));if(null!=b)return!1});return b},inlineComponentsReady:function(){b.config.getBoolean("ui.rp.alwaysReqAdSetup",!0)&&b.events.publish("resultspage.adinfo.empty");this.options.visible&&b.events.publish("resultspage.view.setvisible",!0);if(this.options.searchId){b.utils.performance.setEnabled(this.shouldTrackStreamingPerformance());this.setupStreaming(this.options.searchId,
this.options.completed);if(this.options.windowScroll&&0<this.options.windowScroll.length&&this.options.persistWindowScroll){var a=this.options.windowScroll.split(";");e(window).scrollTop(a[0]);e(window).scrollLeft(a[1])}null!==this.options.quickLinkData&&b.events.publish("resultspage.quickLinkData.changed",this.options.quickLinkData)}else this.options.startSearchImmediately&&this.startSearch(this.options.searchParams,this.options.ajaxParams)},setVisible:function(a){(this.options.visible=a)?this.element.addClass("ResultsVisible"):
this.element.removeClass("ResultsVisible");this.setColumnsVisible(a,400)},setupStreaming:function(a,c){this.searchId=this.options.searchId;this.searchRunner=new b.base.results.AjaxSearchPoll({searchId:a,vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList,replace:!this.appendResults});b.events.publish("resultspage.searchId.changed",{searchId:this.searchId});window.SearchID=this.searchId;null!==this.options.filtersData&&(this.filtersData=this.options.filtersData,b.events.publish("resultspage.filtersData.changed",
this.filtersData));c&&this.getAdsHelper().requiresAdsPoll()&&(c=!1);this.logSmartyInteractions();c&&b.config.getBoolean("ui.horizon.resultspage.%s.handleCompleted".format(this.vertical||"base"),!1)?this.endPolling():(b.events.publish("resultspage.streaming.start"),this.listBody.addClass("streaming-in-progress"),this.resultsReason="init",this.poll.reason="POLL",this.getResults(),this.startedStreaming())},logSmartyInteractions:function(){b.config.getBoolean("ui.smarty.r9LogOptions",!0)&&this.searchId&&
b.events.publish("smartylogger.log.searchId",this.searchId)},startSearchFromSearchForm:function(a){this.resultsReason="searchform.submit";if(a.tab!==this.vertical)b.Analytics.api.trackEvent("resultspage/search/vertical-mismatch"),window.location.href=a.url;else{if(a.searchFormFilterState){var c="";Object.keys(a.searchFormFilterState).each(function(b){c&&(c+=";");c+=b+"\x3d"+a.searchFormFilterState[b]});this.urlFilterState=c;this.useUrlFilterState=!!c}else this.urlFilterState=null;this.useUrlFilterState?
this.clearPreservedFilters():(this.preserveFilters=a.preserveFilters)?this.setPreservedFilterState(a):this.preservedFilters=null;delete a.searchFormFilterState;this.options.visible&&this.options.animateInlineSearch&&this.bounceResults();a.navigateToResults||this.startSearch(a)}},startSearch:function(a){this.ariaResultMsgWidget.activateLoadMessage(this.options.ariaMsg.resultsLoading);this.resultsList.attr("aria-busy",!0);if(a.url&&b.authentication.needsRefresh)window.location="/"===a.url[0]?a.url:
"/"+a.url;else{b.events.publish("search.startSearch",a);b.events.publish("resultspage.streaming.start",a);this.resultsList.removeClass("hidden");this.searchRunner=new b.base.results.AjaxSearchPoll({vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList});this.searchId&&this.cleanupExistingSearch();this.poll.sent=0;this.poll.ended=!this.options.poll;this.poll.pollingId=""+Math.floor(65536*Math.random())+1;this.poll.lastPollTotalCount=-1;this.poll.consecutiveEmptyResponses=
0;this.preservedFilters&&Object.keys(this.preservedFilters).length&&(this.poll.usingPreservedFilters=!0);this.options.pageNumber=1;var c=e.extend(this.options.searchParams,a);this.getAdsHelper().setAdRequestSearchOptions(c,this.resultsReason);this.searchStartParams=c;b.utils.performance.setEnabled(this.shouldTrackStreamingPerformance());b.utils.performance.clearMarks(["search_start","first_result","first_phase_complete","polling_complete","first_result_rendered"]);this.getResults(0,c);this.skipLoadingTreatment()||
this.addTransitionClass(a)}},cleanupExistingSearch:function(){this.poll.activeRequest&&this.poll.activeRequest.abort();b.events.publish("resultspage.cleanup",this.searchId);this.stopIdleTimeout();this.destroyOldResults();this.resultsList.find("#searchResultsList").html("");this.listBody.removeClass("failed").attr("aria-hidden",!1);this.searchId=null;this.poll.pollingId=null;this.preserveFilters||(this.filterState={});this.priceType=null;b.events.publish("paginator.hide");this.poll.firstPhaseCompleted=
!1;this.poll.lastPollTotalCount=-1;this.poll.consecutiveEmptyResponses=0;this.poll.reason=null;this.poll.usingPreservedFilters=!1;this.options.filtersData=null;this.options.completed=!1;this.searchStartParams={};this.lastLimitedDateMs=null;!this.preservedFilters&&this.options.defaultSortType&&this.resetSortTypeForNewSearch(this.options.defaultSortType);this.options.watchedResultId=null},resetSortTypeForNewSearch:function(a){this.options.sortMode=null;b.events.publish("resultsHeader.sortType.set",
{sortCode:a,silent:!0})},destroyOldResults:function(a){b.ComponentManager.remove(this.resultsList.find("#searchResultsList"),!1);a=this.element.find("#savedResultsListContainer");a.length&&b.ComponentManager.remove(a,!1)},destroyBuzzResults:function(){},beforeAppendNewResults:function(){},beforeUpdateDOM:function(a,c){a=e(a.parsedContent);if(c)return this.beforeAppendNewResults();0===a.length&&b.config.getBoolean("ui.horizon.rp.skipEmptyPoll",!0)||(!this.poll.ended&&a.find(".Base-Results-HorizonResult").length&&
b.utils.performance.mark("first_result"),this.doCustomUpdate({append:c})&&b.base.results.ResultsPageDOMUtils.mergeOpenResults(this.listBody,a),this.destroyOldResults(a))},publishAfterUpdateDOMEvent:function(){},getResults:function(a,c,d,k){var f=this,g=e.extend(this.getFetchResultsOpts(c&&c.fetchOpsParams),c);a=void 0!==a?a:this.options.pollDelay;var h={beforeScript:function(){f.beforeUpdateDOM(this.response,g.append)},replace:!g.append,afterUpdateDOM:function(){f.publishAfterUpdateDOMEvent();f.poll.ended&&
f.removeTransitionClass();if(g.append&&b.config.getBoolean("ui.resultspage.aria.focusOnPaginate",!0)){var a=f.resultsList.find("#"+f.options.searchId+"-"+f.options.pageNumber).children("[tabbable]").eq(0);a.length&&a.get(0).focus()}"function"===typeof k&&k()}};c=c||{};this.preservedFilters&&Object.keys(this.preservedFilters).length&&(g.filterState=JSON.stringify(this.preservedFilters));this.doCustomUpdate(g)&&(h=e.extend(h,{customUpdate:f.updateDOM.bind(this)}));h=this.addCustomPollAjaxParams(h);
d&&(g.isSecondPhase=!1);this.poll.activeRequest&&this.poll.activeRequest.abort();c.resetFilters&&(g=e.extend({},g,{useViewStateFilterState:!1}));c=function(){b.utils.performance.mark("search_start");f.poll.sent++;var a=f.searchRunner.fetchResults(g,h);a.then(function(a,c){f.checkSearchExpired(a,c);delete f.poll.activeRequest}).fail(function(a,c){var b=e.extend({type:"ajax"},a||{});a.type&&(b.ajaxErrorType=a.type);c&&!b.status&&(b.status=c);f.handleError(b)});f.poll.activeRequest=a;b.events.publish("resultspage.requestResults")};
clearTimeout(this.poll.nextPollTimeoutId);0<a||b.config.getBoolean("ui.horizon.resultspage.pollTimeout.always",!1)?this.poll.nextPollTimeoutId=setTimeout(c,a):c()},checkSearchExpired:function(a,c){c&&202===c.status&&(this.endPolling(),b.events.publish("search.expired"))},doCustomUpdate:function(a){return!1},addCustomPollAjaxParams:function(a){return a},endPolling:function(a,c,d){this.ariaResultMsgWidget.deactivateLoadMessage(this.options.ariaMsg.resultsReady);this.poll.ended||(b.utils.performance.mark("polling_complete"),
this.poll.ended=!0,this.log.console("Ended polling"),this.removeTransitionClass(),this.listBody.removeClass("streaming-in-progress"),this.stopClientTimeout(),this.stopSecondPhaseTimeout(),b.events.publish("resultspage.streaming.done",{searchId:this.searchId,reason:a,error:c}),a&&(c&&"object"===typeof c&&c.type&&(a+="/"+c.type),b.Analytics.api.trackEvent({category:"ResultsPage",action:"search_finished",label:a})),this.resultsList.attr("aria-busy",!1),this.useUrlFilterState=!1)},clearPreservedFilters:function(){this.preservedFilters=
null;this.preserveFilters=!1},handleError:function(a){if(!a||"object"!==typeof a||0!==a.status&&!a.aborted){if("object"===typeof a){if(a.searchExpired&&!a.avoidReload){this.reloadExpiredResults();return}if(a.type){var c=a.message||a.status;"ajax"===a.type?(p||!a.status||500>a.status)&&this.log.error("RP ajax error:"+(c?" ("+c+")":""),a):"limitreload"===a.type&&b.config.getBoolean("ui.rp.limitReloadError",!1)?this.log.error(a.message,a):b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"error",
label:a.type,value:c})}}this.endPolling("error",a);this.resultsList.addClass("hidden");b.events.publish("paginator.hide");this.removeTransitionClass();this.listBody.addClass("failed").attr("aria-hidden",!0);b.events.publish("search.searchFailed",a);a&&"noresults"===a.type&&a.response&&a.response.filtersData&&(a=Object.keys(a.response.filtersData),0<a.length&&(a.forEach(function(a){b.events.publish("filter.show",{name:a})}),b.events.publish("resultspage.filterList.show")))}},getFetchResultsOpts:function(a){a=
e.extend(a||{},{applyFilters:!0,filterState:null,useViewStateFilterState:this.useUrlFilterState,pageNumber:this.options.pageNumber,watchedResultId:this.options.watchedResultId});a.append=1<this.options.pageNumber&&this.appendResults;null!==this.poll.pollingId&&(a.pollingId=this.poll.pollingId);null!==this.options.sortMode&&(a.sortMode=this.options.sortMode,null!==this.options.ascending&&(a.ascending=this.options.ascending));null!==this.priceType&&(a.priceType=this.priceType);this.useUrlFilterState&&
this.urlFilterState?a.filterState=this.urlFilterState:this.filterState&&0<Object.keys(this.filterState).length&&(a.filterState=JSON.stringify(this.filterState));this.changingFilter&&(a.changingFilter=JSON.stringify(this.changingFilter),this.changingFilter=null);if(this.options.persistWindowScroll&&this.poll.ended&&(!this.appendResults||1===this.options.pageNumber)){var c=e(window).scrollTop().toFixed(),b=e(window).scrollLeft().toFixed();a.windowScroll=""+(0<c?c:0)+";"+(0<b?b:0)}!this.poll.ended&&
-1<this.poll.lastPollTotalCount&&(a.lastPollTotalCount=this.poll.lastPollTotalCount);a.requestReason="string"===typeof this.poll.reason?this.poll.reason:"POLL";this.options.phoenixRising&&(a.phoenixRising=!0);a.isSecondPhase=this.poll.firstPhaseCompleted;this.getAdsHelper().setAdRequestSearchOptions(a,this.resultsReason);a.openDetails=this.viewState.openDetails;return a},setupNewlyCreatedSearch:function(a){this.searchRunner.searchId=this.searchId=a.searchId;this.log.console("setting up searchId",
this.searchId);b.events.publish("resultspage.searchId.changed",{searchId:this.searchId});window.SearchID=this.searchId;"pageTitle"in a&&(document.title=a.pageTitle);"viewState"in a&&"priceType"in a.viewState&&(this.priceType=a.viewState.priceType,b.events.publish("resultspage.priceType.changed",{priceType:this.priceType}));this.logSmartyInteractions();this.options.pollingTimeout=a.uiTimeout;this.startedStreaming()},firstResultsRendered:function(a){},isFirstResults:function(a,c){return a&&c&&0<c.totalCount&&
0>this.poll.lastPollTotalCount},preprocessResponse:function(a){if(this.searchId||"searchId"in a){var c=this.options.poll&&!this.poll.ended,d=this.isFirstResults(c,a);if(a&&(!this.poll.firstPhaseCompleted||!a.secondPhaseWait||a.completed||a.error)){this.log.console("received response",a);!this.searchId&&"searchId"in a&&"string"===typeof a.searchId&&this.setupNewlyCreatedSearch(a);d&&(b.events.publish("resultspage.streaming.firstResults"),this.firstResultsRendered(a));this.options.completed=a.completed;
if(a.error){c={type:"server",message:a.errorMessage,searchExpired:a.searchExpired};a.searchStartError&&(c={type:"query",userDisplayMessage:a.queryErrors.reduce(function(a,c){return a+"\x3c/br\x3e"+c})});this.handleError(c);return}var e="isCustomTicket"in a&&a.isCustomTicket;"isMultiAirport"in a&&b.events.publish("resultspage.multiAirport.changed",a.isMultiAirport);if("filtersData"in a){this.filtersData=a.filtersData;var f=function(){this.log.time("filterUpdate");b.events.publish("resultspage.filtersData.changed",
a.filtersData);b.events.publish("%s.resultspage.filtersData.changed.done".format(this.vertical),a.filtersData);this.log.timeEnd("filterUpdate")}.bind(this);c&&d&&b.config.getBoolean("ui.horizon.resultspage.delayFilterPaint",!0)?setTimeout(f,b.config.getInt("ui.horizon.resultspage.delayFilterPaint.time",100)):f()}"urlFilterState"in a&&!this.useUrlFilterState&&(this.urlFilterState=a.urlFilterState,this.options.useUrlFilterState&&!e&&this.updateUrlFilterState(a.urlFilterState));"quickLinkData"in a&&
b.events.publish("resultspage.quickLinkData.changed",a.quickLinkData);"sortMode"in a&&(this.options.useUrlSortMode&&!e&&this.updateUrlSortState(a.sortMode),b.events.publish("resultspage.sortMode.changed",{customTicket:e,sortCode:a.sortMode}));"taxesEstimated"in a&&b.events.publish("resultspage.taxesEstimated.changed",{taxesEstimated:a.taxesEstimated});"priceType"in a.viewState&&b.events.publish("resultspage.priceType.changed",{priceType:a.viewState.priceType});"warnDestinationCC"in a&&b.events.publish("resultspage.warnDestinationCC.changed",
{warnDestinationCC:a.warnDestinationCC});"swindle"in a&&b.Common&&b.Common.SwindlePublisher&&b.Common.SwindlePublisher.publish(a.swindle);a.ads&&(this.resultsReason=null,this.getAdsHelper().updateAds(a.ads));if(a.completed){if(0===a.totalCount&&0===a.filteredCount){this.handleError({type:"noresults",message:"Finished search but failed to find results",response:a});this.ariaResultMsgWidget.deactivateLoadMessage(this.options.ariaMsg.noResultsFound);return}this.endPolling("completed",null,a);c=this.options.poll&&
!this.poll.ended}if(this.checkFilteredCount(a)||a.error)this.removeTransitionClass(),a.allResultsWereFiltered&&!this.options.showFilteredButSimilar&&this.listBody.addClass("failed").attr("aria-hidden",!0);this.setFirstPhaseCompleted(a);(a.completed||0<a.filteredCount&&0<a.totalCount)&&b.events.publish("resultspage.results.count.changed",{filtered:a.filteredCount,total:a.totalCount});b.events.publish("paginator.update",{pageNumber:a.pageNumber,pageCount:a.pageCount});b.events.publish("resultspage.refreshed",
{streaming:!a.completed});this.didReceiveResults(a);this.poll.ended&&b.events.publish("paginator.getmoreresults.completed")}c&&this.setupNextPollRequest(a,d);this.updateCubaWarning(a);this.resultsList.removeClass("hidden")}},checkFilteredCount:function(a){return 0<a.filteredCount||a.allResultsWereFiltered},setupNextPollRequest:function(a,c){"totalCount"in a&&0<a.totalCount&&a.totalCount!==this.poll.lastPollTotalCount?(this.poll.consecutiveEmptyResponses=0,this.poll.lastPollTotalCount=a.totalCount):
this.poll.consecutiveEmptyResponses++;var b=this.options.pollDelay;!a.cached&&this.options.exponentialBackoffDelay&&(b=this.options.pollDelay+1E3*Math.log(this.poll.consecutiveEmptyResponses+1));a=Math.min(b,this.options.maxPollDelay);this.poll.firstPhaseCompleted&&0<=this.options.secondPhaseWait&&(a=this.options.secondPhaseWait);c&&(a=0);this.poll.reason="POLL";this.getResults(a)},setFirstPhaseCompleted:function(a){this.poll.firstPhaseCompleted!==a.firstPhaseCompleted&&(this.poll.firstPhaseCompleted=
a.firstPhaseCompleted,this.poll.firstPhaseCompleted&&(b.events.publish("resultspage.streaming.firstPhase.done"),this.startSecondPhaseTimeout(),b.utils.performance.mark("first_phase_complete")))},syncState:function(a,c){null===c.state?delete a[c.name]:c.name&&(a[c.name]=c.state)},syncFilterState:function(a){this.syncState(this.filterState,a);this.preserveFilters&&a.syncPreservedState&&this.syncPreservedFilters(a)},syncPreservedFilters:function(a){this.syncState(this.preservedFilters,a)},setPageNumber:function(a){this.options.pageNumber!==
a&&(this.options.pageNumber=a,b.events.publish("resultspage.pageNumber.changed",a),b.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:self.searchId,key:"pageNumber",value:a.toString()}))},onFilterStateChange:function(a){this.useUrlFilterState=!1;this.resultsList.removeClass("hidden");this.syncFilterState(a);this.preserveFilters&&!a.syncPreservedState&&this.syncPreservedFilters(a);a.name&&a.changeData&&(this.changingFilter=e.extend({name:a.name},a.changeData));
a.skipPageReset||this.setPageNumber(1);this.resultsReason="filters.changed";this.poll.reason="FILTER";a.reset&&(this.poll.reason+=".RESET");this.refreshResults(a)},onAllFilterStateChange:function(a){var c=this;this.useUrlFilterState=!1;this.resultsList.removeClass("hidden");Object.entries(a.allChanges).forEach(function(a){c.syncFilterState({name:a[0],state:a[1]})});a.changingFilter&&(this.changingFilter=e.extend({},a.changingFilter));this.resultsReason="filters.changed";this.poll.reason="FILTER";
this.refreshResults()},onPaginatorChange:function(a){a.append||e(window).scrollTop(0).trigger("scroll");b.Analytics.api.trackEvent("page/"+a.pageNumber);this.setPageNumber(a.pageNumber);this.resultsReason="paginator.change";this.poll.reason="PAGINATE";this.refreshResults({append:a.append})},onResultsListHeaderChange:function(a){a.rpIgnore||(void 0!==a.sort?(this.options.sortMode=a.sort.sortType,this.options.ascending=a.sort.ascending,this.poll.reason="SORT",b.Analytics.api.trackEvent(this.loggingPrefix+
"/sort/"+(a.sort.ascending?"":"-")+a.sort.sortType)):void 0!==a.priceType?(this.priceType=this.options.priceType=a.priceType,this.poll.reason="PRICETYPE",b.Analytics.api.trackEvent(this.loggingPrefix+"/priceType/"+a.priceType)):this.poll.reason="SORT",void 0!==a.reviewType&&(this.options.reviewType=a.reviewType,b.Analytics.api.trackEvent(this.loggingPrefix+"/reviewType/"+a.reviewType)),void 0!==a.quickLinkType&&(this.options.quickLinkType=a.quickLinkType,b.Analytics.api.trackEvent(this.loggingPrefix+
"/quickLinkType/"+a.quickLinkType)),this.updateFrenchWarning(),this.setPageNumber(1),this.resultsReason="resultsHeader.changed",this.refreshResults())},updateFrenchWarning:function(){this.frenchWarning&&this.frenchWarning.toggleClass("hidden",this.options.defaultSortType&&-1===this.options.defaultSortType.indexOf(this.options.sortMode))},updateCubaWarning:function(a){var c=this.getChildElement("cubaWarning"),b=this.getChildElement("cubaWarningWrapper");a.hasOwnProperty("cubanQuery")&&a.cubanQuery?
(c.addClass("visible"),b.addClass("visible").attr("aria-hidden",!1)):c.hasClass("visible")&&(b.removeClass("visible","aria-hidden",!0),c.addClass("visible"))},addTransitionClass:function(a){if(!this.options.forceLoadingTreatmentSkip||!this.skipLoadingTreatment()){var c=[];this.options.blurTransition&&(c.push("blur"),this.resultsList.addClass("blur"));this.options.spinnerTransition&&c.push("loading");this.options.fastCover?(this.resultsListCover.addClass(c.join(" ")),a&&a.overlayTop&&this.resultsListCover.css("top",
a.overlayTop-this.listBody.position().top)):this.listBody.addClass(c.join(" "))}},removeTransitionClass:function(){this.options.blurTransition&&this.resultsList.removeClass("blur");this.resultsListCover.removeClass("loading blur").css("top",null);this.listBody.removeClass("loading blur");this.loadingMessage.addClass("hidden")},refreshResults:function(a){if(this.searchRunner){!this.searchId&&b.config.getBoolean("horizon.resultspage.dontRefreshBeforeSearchStart",!0)&&this.searchStartParams&&(a=e.extend({},
a,this.searchStartParams));a&&a.customRequest&&(this.resultsReason=a.customRequest);this.ariaResultMsgWidget.activateLoadMessage(this.options.ariaMsg.resultsLoading);var c=this.poll.reason&&-1<this.poll.reason.indexOf("FILTER")?200:0,d=a&&a.afterUpdateFn;d&&delete a.afterUpdateFn;this.getResults(c,a,!0,d);"undefined"!==typeof a&&"undefined"!==typeof a.append&&a.append||(b.dom.schedule(this.addTransitionClass.bind(this,a)),this.listBody.removeClass("failed").attr("aria-hidden",!1))}},reloadExpiredResults:function(){this.addTransitionClass();
this.log.console("reloading expired results");this.options.showExpiredResultsMessage&&(this.options.msg.expired_search&&this.loadingMessage.text(this.options.msg.expired_search),this.resultsListCover.addClass("expired"),this.loadingMessage.removeClass("hidden"));b.Analytics.api.trackEvent(this.loggingPrefix+"/searchexpired");var a;if(b.config.getInt("ui.rp.limitExpiredReload",!0)){if(a=this.limitedReloadUrl(),!a)return}else a=this.mergeFilterStateWithUrl(this.urlFilterState);window.location.href=
a},stopSearch:function(a){e.get("/s/sparkle?action\x3dkillseeker\x26searchid\x3d%s\x26formtoken\x3d%s".format(a||this.searchId,b.globals.formtoken))},clientTimeout:function(){this.log.console("client timed out");if(b.config.getBoolean("ui.horizon.rp.streaming.timeout.reload",!0)){this.stopSearch();var a=this.limitedReloadUrl();a&&(this.handleError({type:"timeout",message:"Reached polling timeout without completing"}),window.location=this.mergeStateWithUrl("true","force",a))}},limitedReloadUrl:function(){var a=
l.exec(window.location.search),c=1;if(a&&1<a.length&&(c=parseInt(a[1])+1,!isNaN(c)&&c>b.config.getInt("ui.horizon.rp.streaming.timeout.reload.limit",3))){a=(a=m.exec(window.location.search))&&1<a.length?parseInt(a[1]):this.lastLimitedDateMs;if(!isNaN(a)&&0<a&&0<this.lastLimitedMinMS&&Date.now()-a>this.lastLimitedMinMS)return this.lastLimitedDateMs=null,this.mergeFilterStateWithUrl(this.urlFilterState).replace(l,"").replace(m,"");this.handleError({type:"limitreload",message:"Reached max consecutive poll timeouts",
attempts:c,last:a,searchExpired:!0,avoidReload:!0});return null}this.lastLimitedDateMs=Date.now();return this.mergeStateWithUrl(""+this.lastLimitedDateMs,"lastms",this.mergeStateWithUrl(""+c,"attempt"))},startSecondPhaseTimeout:function(){var a=this;b.config.getBoolean("ui.horizon.killSecondPhase",!1)&&(this.stopSecondPhaseTimeout(),this.secondPhaseTimeoutId=window.setTimeout(function(){a.poll.ended||(a.stopSearch(),window.setTimeout(function(){a.endPolling("2ftimeout")},5E3))},this.options.secondPhaseTimeout-
5E3))},stopSecondPhaseTimeout:function(){window.clearTimeout(this.secondPhaseTimeoutId);this.secondPhaseTimeoutId=null},startIdleTimeout:function(a){this.idleTimeoutId=window.setTimeout(function(){e(window).one("mousemove",function(){b.events.publish("results.expired")})},a)},stopIdleTimeout:function(){window.clearTimeout(this.idleTimeoutId);this.idleTimeoutId=null},startClientTimeout:function(a){var c=this;a+=5E3;var b=this.searchId;this.stopClientTimeout();this.clientTimeoutId=window.setTimeout(function(){b===
c.searchId&&c.clientTimeout()},a)},stopClientTimeout:function(){window.clearTimeout(this.clientTimeoutId);this.clientTimeoutId=null},startedStreaming:function(){this.options.enforceIdleTimeout&&this.startIdleTimeout(6E4*this.options.idleExpireMinutes);null===this.clientTimeoutId&&this.startClientTimeout(2*this.options.pollingTimeout);var a=b.storage.get("search_submit_pageId"),c="RP";a&&"results"!==a&&(c="FD",b.storage.remove("search_submit_pageId"));b.Analytics.api.trackEvent({category:"ResultsPage",
action:"search_started",label:c})},didReceiveResults:function(a){},updateDOM:function(a,c){try{this.log.time("updateDOM");for(c=0;c<a.children.length;c++)if(!b.dom.merge(this.element.find("#"+a.children[c].id).get(0),a.children[c]))return!1;return!0}catch(d){return!1}finally{this.log.timeEnd("updateDOM")}},checkFilteredCountForPreservedFilters:function(a){var c=this;if(this.preserveFilters){var d={};this.options.nonClearablePreservedFilters.forEach(function(a){c.preservedFilters.hasOwnProperty(a)&&
(d[a]=c.preservedFilters[a])});this.clearPreservedFilters();if(0===a.filtered||a.filtered<this.options.removeFiltersThreshold&&a.total>=this.options.removeFiltersThreshold)b.Widgets.Toaster.addToast(this.options.msg.filters_removed,{button:!0,escaped:!1,auto:!0,theme:"centered filters-cleared-toast"}),this.preservedFilters=0<Object.keys(d).length?d:null,this.filterState=0<Object.keys(d).length?d:{},this.refreshResults({resetFilters:!0})}},mergeStateWithUrl:function(a,c,b){if(c){var d=b||window.location.href.split("#")[0],
e="string"!==typeof a;b=d.split("?");if(1<b.length){for(var d=b[1].split("\x26"),g=!1,h=0;h<d.length;h++)d[h].startsWith(c)&&(g=e?null:c+"\x3d"+a,-1<d[h].indexOf(";map")&&(g=(g||"")+";"+d[h].split(";")[1]),d[h]=g,g=!0);g||e||d.push(c+"\x3d"+a);a=d.filter(function(a){return"string"===typeof a&&a.length});d=b[0]+(a.length?"?"+a.join("\x26"):"")}else e||(d+="?"+c+"\x3d"+a);return d}},mergeFilterStateWithUrl:function(a){return this.mergeStateWithUrl(a,"fs")},mergeSortStateWithUrl:function(a){return this.mergeStateWithUrl(a,
"sort")},updateUrlFilterState:function(a){window.history&&window.history.replaceState&&window.history.replaceState(null,null,this.mergeFilterStateWithUrl(a))},updateUrlSortState:function(a){window.history&&window.history.replaceState&&window.history.replaceState(null,null,this.mergeSortStateWithUrl(a))},toggleLeftRailCollapsed:function(){this.element.find(".col-left-rail").toggleClass("collapsed")},shouldTrackStreamingPerformance:function(a){return b.config.getBoolean("ui.horizon.resultspage.streamingPerformance.trackForAllSearches",
!0)},getAdsHelper:function(){this.adsHelper||(this.adsHelper=new b.base.results.AdsHelper);return this.adsHelper},skipLoadingTreatment:function(){return!1},destroy:function(){this.base();b.events.publish("resultspage.JavaScriptComponent.cleanup",this.vertical);e(window).off("scroll.searchAndScrollListener")},setColumnsVisible:function(a,c){var b=this,e=function(){a?(b.listCol.removeClass("hidden"),b.leftRail.removeClass("hidden"),b.rightRail.removeClass("hidden")):(b.listCol.addClass("hidden"),b.leftRail.addClass("hidden"),
b.rightRail.addClass("hidden"))};c?setTimeout(e.bind(b),c):e()},setPreservedFilterState:function(a){this.preservedFilters=e.extend({},this.filterState)},bounceResults:function(){var a=this.listCol.get(0),c=this.leftRail.get(0),b=this.rightRail.get(0);a.classList.remove("reload");a.classList.add("reload");c&&c.classList.add("reload");b&&b.classList.add("reload");setTimeout(function(){c&&c.classList.remove("reload");b&&b.classList.remove("reload");a&&a.classList.remove("reload")},2E3)},getPageContainerLeftMargin:function(){var a=
this.element.find(".pageContainer").first(),b=Number(a.css("padding-left").replace("px","")),b=0===b?this.options.defaultPaddingLeft:b;return Number(a.css("margin-left").replace("px",""))+b},enableSearchAndScrollEvent:function(a){if(a.changed)e(window).off("scroll.searchAndScrollListener").on("scroll.searchAndScrollListener",this.onScrollSearchEvent.bind(this))},onScrollSearchEvent:function(){b.dom.schedule(this.toggleSearchBanner)},toggleSearchBanner:function(){b.events.publish("toggle.scroll.search.banner")},
unbindScrollAndSearchListener:function(){e(window).off("scroll.searchAndScrollListener")}})})(R9,jq||jQuery);(function(d,e){d.createComponentClass("flights.results.FlightResultsPage","base.results.ResultsPage",{vertical:"flights",urlSearchStartSupported:!0,activeLeg:-1,chosenResultId:void 0,focusedResultId:void 0,renderPlusMinusThreeFlex:!1,renderAirlineStopsMatrix:!1,requestAlternateFlexDates:!1,renderCustomTicketHeader:!1,preserveCustomTicketHeader:!1,specificLegs:null,activeDestinationAirport:null,resultsListHeader:null,activeCabin:null,bundleHackerFares:!1,delimitedUnstackedResultStackIds:"",featuredPriceMap:null,
customTicketOpened:!1,bestFlightsParams:null,legsData:null,isOneWay:!1,isRoundTrip:!1,isMultiCity:!1,gtmUpdates:null,momondoGraphContainer:null,momondoBelowBarContainer:null,upsellNonLocale:!0,searchStartedWithFilters:!1,options:{legCount:2,activeLeg:-1,chosenResultId:null,focusedResultId:null,focusedResultType:null,currentview:"list",oneway:null,activeDestinationAirport:null,selectLegSwitchToSegmentView:!1,requestAlternateFlexDates:!1,resultsPlaceholderEnabled:!1,showStaticLoadingMessage:!1,retainOpenedResults:!1,
footerDisclaimersEnabled:!1,firstResultsUseFilteredCount:!1,bundleHackerFares:!1,unstackedResultStackIds:"",customTicketEnabled:!1,customTicketSort:"depart",datesGraphForEcoOnly:!1,noNonstopWarningEnabled:!1},init:function(){this.base();var a=this;this.specificLegState={};this.specificLegs={};this.gtmUpdates={};this.ajaxAppendTo=this.resultsList;this.requestAlternateFlexDates=this.options.requestAlternateFlexDates;this.resultsListHeader=this.element.find(".resultsListHeader");this.momondoGraphContainer=
this.element.find(".momondo-graph-container");this.momondoBelowBarContainer=this.element.find(".momondo-below-search-bar");this.options.resultsPlaceholderEnabled&&(this.resultsPlaceholder=this.getChildElement("placeholder"));this.formBlock=e(".pinnedContent",this.element);this.options.persistWindowScroll=!this.appendResults;this.setLegCount(this.options.legCount);if("number"===typeof this.options.activeLeg&&-1<this.options.activeLeg||"string"===typeof this.options.chosenResultId)this.options.currentview=
"customticket"!==this.options.currentview?"segment":"customticket";"number"===typeof this.options.activeLeg&&this.setActiveLeg(this.options.activeLeg,!0);"string"===typeof this.options.chosenResultId&&this.setChosenResultId(this.options.chosenResultId);"string"===typeof this.options.focusedResultId&&(this.focusedResultId=this.options.focusedResultId);"string"===typeof this.options.focusedResultType&&(this.focusedResultType=this.options.focusedResultType);"string"===typeof this.options.activeDestinationAirport&&
(this.activeDestinationAirport=this.options.activeDestinationAirport);this.options.bundledHackerFaresEnabled&&(this.bundleHackerFares=this.options.bundleHackerFares);this.delimitedUnstackedResultStackIds=this.options.unstackedResultStackIds;if(this.options.filtersData){var c=this.options.filtersData.flexdepart,b=this.options.filtersData.flexreturn;c&&c.isDirty&&(this.filterState.flexdepart={},Object.keys(c.valueMap).forEach(function(b){a.filterState.flexdepart[b]=c.valueMap[b].selected}));b&&b.isDirty&&
(this.filterState.flexreturn={},Object.keys(b.valueMap).forEach(function(c){a.filterState.flexreturn[c]=b.valueMap[c].selected}))}},addEventHandlers:function(){var a=this;this.base();this.setupSpecificLegEvents();this.setupDisclaimerEvents();this.subscribe("flights.resultspage.getairlinematrix",function(){a.renderAirlineStopsMatrix=!0;a.refreshResults()});this.subscribe("flights.resultspage.getflex",function(){a.renderPlusMinusThreeFlex=!0;a.requestAlternateFlexDates=!1;a.refreshResults()});this.subscribe("flights.resultspage.transition",
function(b){b.isLoading?a.addTransitionClass():a.removeTransitionClass()});this.options.pauseStreamingForDetails&&this.subscribe(["common.resultspage.detailsRequested","common.resultspage.modal.detailsOpen"],function(b){a.poll.ended||(a.poll.activeRequest&&a.poll.activeRequest.abort(),clearTimeout(a.poll.nextPollTimeoutId),b&&b.then?b.then(a.getResults.bind(a)):"function"===typeof b&&(a.endPolling("pausedetails"),b()))});this.subscribe("flights.resultspage.gtm.update",this.handleGTMUpdate.bind(this));
this.subscribe("flights.results.setActiveDestination",function(b){a.activeDestinationAirport=b.code;d.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:a.searchId,key:"activeDestinationAirport",value:a.activeDestinationAirport});a.setPageNumber(1);a.refreshResults()});this.subscribe("flights.results.details.rates.categoryChanged",function(b){a.viewState.activeRatesTables||(a.viewState.activeRatesTables={});a.viewState.activeRatesTables[b.resultId]=b.category;
d.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:a.searchId,key:"activeRatesTables",value:JSON.stringify(a.viewState.activeRatesTables)})});this.subscribe("flights.results.multibook.featured.recordPrice",function(b){a.poll.ended&&(null===a.featuredPriceMap&&(a.featuredPriceMap={lastPollId:"",prices:{}}),a.featuredPriceMap.lastPollId!==a.poll.pollingId&&(a.featuredPriceMap.lastPollId=a.poll.pollingId,a.featuredPriceMap.prices={}),a.featuredPriceMap.prices[b.resultId]=
b.price)});this.subscribe("flights.resultspage.bundleHackerFares.set",function(b){a.bundleHackerFares=b.bundleHackerFares;b.refresh&&a.refreshResults(b)});this.subscribe("flights.resultspage.stackedResults.unstack",function(b){-1===a.delimitedUnstackedResultStackIds.indexOf(b.stackId)&&(a.delimitedUnstackedResultStackIds+=0<a.delimitedUnstackedResultStackIds.length?","+b.stackId:b.stackId);b.refresh&&a.refreshResults({customUpdate:"unstack",pageNumber:1,append:!1})});this.subscribe("flights.resultspage.bestflights.setParams",
function(b){var c={};void 0===b.priceEmphasis||null===b.priceEmphasis||isNaN(b.priceEmphasis)||(c.priceEmphasis=b.priceEmphasis);void 0===b.durationEmphasis||null===b.durationEmphasis||isNaN(b.durationEmphasis)||(c.durationEmphasis=b.durationEmphasis);void 0!==b.limitSubEconomy&&(c.limitSubEconomy=b.limitSubEconomy);void 0!==b.preferredAirlines&&e.isArray(b.preferredAirlines)&&(c.preferredAirlines=b.preferredAirlines);a.bestFlightsParams=c;a.refreshResults()});this.subscribe("flights.results.toggleNonLocale",
function(b){a.upsellNonLocale&&"show"===b.action?(a.upsellNonLocale=!1,a.refreshResults({showNonLocale:!0})):d.events.publish("filters.providers.ONLY_LOCALE.setchecked.force",{selected:"show"!==b.action?1:0})});this.subscribe("flights.results.toggleMultiModal",function(b){a.refreshResults({showMultiModal:!0})});var c=function(){a.chosenResultId=null;a.specificLegs={}};c.priority=0;this.subscribe("filters.reset",c);this.subscribe("flights.search.rtow.form.displayCat",function(b){b.displayCat&&"roundtrip"!==
b.displayCat&&(a.options.currentview="list")});c=this.onQuickfilterStateChange.bind(this);this.subscribe("quickfilters.changed",c);this.answer("flights.resultspage.currentview",function(){return a.options.currentview});this.answer("flights.resultspage.oneway",function(){return a.options.oneway});this.answer("flights.resultspage.featuredprices",function(){if(null!==a.featuredPriceMap)return a.featuredPriceMap.prices});c=window["@r9/gdpr"];this.options.searchId&&c&&c.canShowConsentDialog()||this.subscribe("resultspage.searchId.changed",
function(b){!d.question.ask("account.dropdown.isopen")&&b.searchId&&b.searchId.length&&a.setupDriveByAlertRequest(b.searchId)});this.subscribe("search.startSearch",function(b){a.setMomondoGraphVisibility.call(a,b)})},inlineComponentsReady:function(){this.base();this.options.searchId&&d.events.ready("resultsPage.content.visible")},resetSortTypeForNewSearch:function(a){this.base(a);d.config.getBoolean("ui.resultspage.resetDefaultSortOrderOnSearch",!0)&&(this.options.ascending="_a"===this.options.defaultSortType.substr(-2))},
switchView:function(a,c,b){if(this.options.currentview!==a){if("list"===a)this.setActiveLeg(-1),this.element.find(".header-wrapper").removeClass("segment-view"),d.Analytics.api.trackEvent({category:"View",action:"roundtrip"});else if("segment"===a||"customticket"===a){var e=Object.keys(this.specificLegs);e.length<this.legCount||"undefined"!==typeof c?(c="undefined"!==typeof c?c:0<e.length?Math.max.apply(null,e.map(function(a){return parseInt(a)+1})):0,this.setActiveLeg(c)):this.chosenResultId=this.specificLegs["0"];
this.element.find(".header-wrapper").addClass("segment-view");d.Analytics.api.trackEvent({category:"View",action:a});this.renderAirlineStopsMatrix=!1}else return;this.options.pageNumber=1;this.options.currentview=a;d.events.publish("flights.results.header.setView",this.options.currentview);b||this.refreshResults({append:!1})}},resetCustomTicketView:function(){this.customTicketOpened=!1;this.specificLegs={};this.setChosenResultId(null);d.events.publish("filter.reset",{name:"specificleg"});this.switchView(this.beforeCustomTicket||
"list",void 0,!0)},startSearch:function(a){var c=this,b=!0;this.customTicketOpened&&this.options.defaultSortType&&(d.events.publish("flights.results.customTicket.header.remove",!0),this.resetCustomTicketView(),this.resetSortTypeForNewSearch(this.options.defaultSortType));this.base(a);a&&"openflex"===a.flex_category?this.element.addClass("OpenFlexView"):(this.element.removeClass("OpenFlexView"),this.options.resultsPlaceholderEnabled&&(this.options.placeholderDelay?(b=!1,setTimeout(function(){c.resultsPlaceholder.addClass("visible");
d.events.ready("resultsPage.content.visible")},this.options.placeholderDelay)):this.resultsPlaceholder.addClass("visible")));b&&d.events.ready("resultsPage.content.visible");this.toggleGrayBG(a.oneway)},handleError:function(a){this.base(a);a&&"object"===typeof a&&0===a.status||this.destroyOldResults()},destroyAboveContainers:function(){d.ComponentManager.remove(e("#aboveResultsContainer").find(".Flights-Results-FlightAboveResultsContent"),!1);d.ComponentManager.remove(e("#aboveHeaderContainer").find(".FlightAboveHeaderContent"),
!1)},destroyOldResults:function(a){this.destroyAboveContainers();var c=!1,b=!1;if(a&&a.length&&(a.children().each(function(a,d){"searchResultsList"==d.id&&(c=0===d.children.length,b=!0)}),(c=c||!b)&&d.config.getBoolean("ui.horizion.rp.skipEmptyList",!0)&&0<this.poll.lastPollTotalCount&&!this.poll.ended))return;this.base()},beforeAppendNewResults:function(){this.base();this.destroyAboveContainers()},onFilterStateChange:function(){var a=this.options.pageNumber;this.base.apply(this,arguments);1<a&&this.appendResults&&
e(window).scrollTop(0);this.warnNonStop=!1},onResultsListHeaderChange:function(a){a.rpIgnore||(this.options.customTicketEnabled&&a.customTicket&&!this.customTicketOpened?(this.beforeCustomTicket=this.options.currentview,"customTicket"===a.sort.sortType&&(a.sort.sortType=this.options.customTicketSort),this.switchView("customticket",void 0,!0)):this.options.customTicketEnabled&&!a.customTicket&&this.customTicketOpened&&this.resetCustomTicketView(),this.base(a))},updateCustomTicketPlaceholderVisibility:function(){var a=
!this.poll.ended,c=this.element.find(".custom-ticket-placeholder");this.element.find("#searchResultsList").toggleClass("invisible",a);c.toggleClass("visible",a)},onQuickfilterStateChange:function(a){var c=this.options.pageNumber;this.resultsList.removeClass("hidden");this.setPageNumber(1);this.resultsReason="filters.changed";this.poll.reason="FILTER";this.refreshResults({filterState:a});1<c&&this.appendResults&&e(window).scrollTop(0)},cleanupExistingSearch:function(){this.base();this.setChosenResultId(null);
this.setActiveLeg(-1,!0);this.renderAirlineStopsMatrix=this.renderPlusMinusThreeFlex=!1;this.requestAlternateFlexDates=this.options.requestAlternateFlexDates;this.activeDestinationAirport=null;this.specificLegs={};this.activeCabin=null;this.upsellNonLocale=!0;this.warnNonStop=this.searchStartedWithFilters=!1;this.options.customTicketEnabled&&d.events.publish("flights.results.customTicket.header.remove",!0);this.options.bundledHackerFaresEnabled&&(this.bundleHackerFares=!0)},getFetchResultsOpts:function(){var a=
this.base();a.activeLeg=this.activeLeg;this.chosenResultId&&(a.chosenResultId=this.chosenResultId);this.focusedResultId&&(a.focusedResultId=this.focusedResultId);this.focusedResultType&&(a.focusedResultType=this.focusedResultType);this.activeDestinationAirport&&(a.activeDestinationAirport=this.activeDestinationAirport);this.options.retainOpenedResults&&!this.poll.ended&&a.openDetails&&(a.retainOpenedResults=0<Object.keys(a.openDetails).length);this.options.bundledHackerFaresEnabled&&(a.bundleHackerFares=
this.bundleHackerFares);0<this.delimitedUnstackedResultStackIds.length&&(a.delimitedUnstackedResultStackIds=this.delimitedUnstackedResultStackIds);this.bestFlightsParams&&(a.bestFlightsParams=this.bestFlightsParams);a.view=this.options.currentview;a.renderPlusMinusThreeFlex=this.renderPlusMinusThreeFlex;a.renderAirlineStopsMatrix=this.renderAirlineStopsMatrix;a.requestAlternateFlexDates=this.requestAlternateFlexDates;this.options.customTicketEnabled&&"customticket"===this.options.currentview&&(a.renderCustomTicketHeader=
!this.customTicketOpened,a.preserveCustomTicketHeader=this.customTicketOpened,a.renderCustomTicketResult=this.customTicketOpened&&d.question.ask("customTicket.tabs.isLast"));return a},addTransitionClass:function(a){this.options.forceLoadingTreatmentSkip&&this.skipLoadingTreatment()||(this.options.showStaticLoadingMessage&&(0<=e.inArray(this.poll.reason,["FILTER","FILTER.RESET","SORT"])?(this.resultsListHeader.addClass("updating"),this.resultsListCover.addClass("updating"),this.getChildElement("loadingMessage").text(this.options.msg.updating_results).removeClass("hidden")):
this.resultsListHeader.addClass("loading")),(this.poll.ended||"POLL"!==this.poll.reason)&&this.resultsListCover.addClass("no-spin"),this.base(a))},removeTransitionClass:function(){this.base();this.resultsListCover.removeClass("no-spin");this.resultsListCover.removeAttr("style");this.options.showStaticLoadingMessage&&(this.resultsListCover.removeClass("updating"),this.resultsListHeader.removeClass("updating loading"))},setupDisclaimerEvents:function(){this.subscribe("disclaimer.togglewhy",function(){e("#whydisclaimer").toggle()})},
setupSpecificLegEvents:function(){this.specificLegs={};this.subscribe("flights.result.specificleg.change",this.handleListViewSpecificLegUpdate.bind(this));this.subscribe("flights.results.setView",this.switchView.bind(this));this.subscribe("flights.results.selectLeg",this.selectLeg.bind(this));this.subscribe("flights.results.removeLeg",this.removeLeg.bind(this));this.options.customTicketEnabled&&this.subscribe("flights.results.setLegView",this.selectedLegView.bind(this))},handleListViewSpecificLegUpdate:function(a){this.handleSpecificLegUpdate(a);
this.options.selectLegSwitchToSegmentView&&"list"===this.options.currentview&&a.checked&&this.segmentViewEnabled&&this.switchView("segment",this.determineNextActiveLeg(a.leg))},handleSpecificLegUpdate:function(a){a.checked?this.specificLegs[a.leg]=a.resultId:delete this.specificLegs[a.leg];var c=Object.keys(this.specificLegs);-1<this.activeLeg&&c.length>=this.legCount&&a.resultId&&(this.chosenResultId=a.resultId);d.events.publish("common.results.filters.specificleg.change",a)},syncFilterState:function(a){this.base(a);
this.filterState.specificleg?this.specificLegs=this.filterState.specificleg.legs:(this.chosenResultId=null,this.specificLegs={})},setLegCount:function(a){this.legCount=a;d.events.publish("common.results.filters.legCount.set",this.legCount)},setLegsData:function(a){this.legsData=a},setActiveLeg:function(a,c){this.customTicketOpened&&a>=this.legCount&&this.activeLeg!==a&&d.events.publish("customTicket.tabs.activeTab",this.legCount);a>=this.legCount||this.activeLeg===a||(this.activeLeg=a,d.events.publish("common.results.filters.activeLeg.changed",
a),c||d.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:"activeLeg",value:this.activeLeg}))},selectedLegView:function(a){this.setActiveLeg(parseInt(a),!0);this.resultsReason="filters.changed";this.poll.reason="FILTER";this.refreshResults()},setChosenResultId:function(a){(this.chosenResultId=a)?(!this.customTicketOpened&&this.element.addClass("ChosenResultView"),d.events.publish("paginator.hide"),d.events.publish("filters.disabled",!0)):
(!this.customTicketOpened&&this.element.removeClass("ChosenResultView"),d.events.publish("filters.disabled",!1))},determineNextActiveLeg:function(a){if(a===this.legCount-1)for(var c=0;c<a;c++)if(!this.specificLegs[c])return c;a+=1;if(this.customTicketOpened){for(;a<this.legCount;a++)if(!this.specificLegs[a])return a;return this.legCount}return a},selectLeg:function(a){if(a.id)this[a.customTicket?"animatePageToTop":"animateLegToTop"](e(document.getElementById(a.id)));a.leg<this.legCount&&this.setActiveLeg(this.determineNextActiveLeg(a.leg));
a.checked=!0;a.removeOld=a.customTicket;this.handleSpecificLegUpdate(a)},removeLeg:function(a){a.checked=!1;this.setActiveLeg(a.leg);(0===a.leg&&!this.customTicketOpened||this.customTicketOpened&&1===Object.keys(this.specificLegs).length)&&d.events.publish("filter.reset",{name:"specificleg"});this.customTicketOpened||this.element.find(".Flights-Results-SegmentViewHeader").addClass(0===a.leg?"removeDepart":"removeReturn");this.setChosenResultId(null);this.handleSpecificLegUpdate(a)},animateLegToTop:function(a){var c=
this,b=e("#aboveHeaderContainer").find(".sblHeader").eq(this.activeLeg);b.addClass("chosen");a.addClass("chosen animating");a.find(".Flights-Results-SegmentResultInfo").addClass("chosen");this.listBody.addClass("animatingSelectedLeg");e(window).scrollTop(0);a.css({transform:"translateY(%spx)".format(a.offset().top-b.offset().top)});a.detach().insertAfter(b);setTimeout(function(){a.css("transform","translateY(0)");setTimeout(function(){e(document).trigger("scroll");a.removeClass("animating");c.listBody.removeClass("animatingSelectedLeg")},
400)},50);this.activeLeg>=this.legCount&&this.element.addClass("ChosenResultView")},animatePageToTop:function(){e(window).scrollTop(this.listCol.offset().top-(this.formBlock.hasClass("R9-Sticky")?this.formBlock.height():0))},toggleGrayBG:function(a){this.element.hasClass("GrayBG")&&"m"===a&&!d.config.getBoolean("ui.flights.results.grayBG.multicity",!1)&&this.element.removeClass("GrayBG")},doCustomUpdate:function(a){return!a.append&&d.config.getBoolean("ui.horizon.flights.resultspage.mergeDOM",!0)},
preprocessResponse:function(a){a&&a.hasOwnProperty("showPriceAlerts")&&d.events.publish("flights.results.priceAlertEnabled",{visible:a.showPriceAlerts,enabled:a.priceAlertsEnabled});a&&a.hasOwnProperty("isCustomTicket")&&(this.customTicketOpened=a.isCustomTicket);a&&a.hasOwnProperty("flightSearchOperators")&&d.events.publish("flights.results.searchOperators",a.flightSearchOperators);a&&a.hasOwnProperty("bestExactAirportPrice")&&d.events.publish("flights.results.cheapest.exactAirport.price",a.bestExactAirportPrice);
this.customTicketOpened?d.events.publish("customTicket.sort.hidden",d.question.ask("customTicket.tabs.isLast")):this.options.customTicketEnabled&&d.events.publish("flights.results.customTicket.header.remove");this.base(a)},didReceiveResults:function(a){var c;a.hasOwnProperty("activeLeg")&&!isNaN(parseInt(a.activeLeg))&&(this.setActiveLeg(parseInt(a.activeLeg),!0),c={filtered:a.filteredCountForLeg,total:a.totalCountForLeg,product:a.product},d.events.publish("resultspage.results.count.changed",c));
this.options.resultsPlaceholderEnabled&&this.customTicketOpened&&this.updateCustomTicketPlaceholderVisibility();a.hasOwnProperty("legCount")&&this.setLegCount(a.legCount);a.hasOwnProperty("legsData")&&this.setLegsData(a.legsData);a.hasOwnProperty("chosenResultId")&&this.setChosenResultId(a.chosenResultId);a.hasOwnProperty("isFlex")&&d.events.publish("flights.results.flexmatrix.show");a.hasOwnProperty("isSegmentViewEnabled")&&(d.events.publish("flights.results.setSegmentLinkVisible",a.isSegmentViewEnabled),
this.segmentViewEnabled=a.isSegmentViewEnabled,!1!==a.isSegmentViewEnabled||this.customTicketOpened||(this.options.currentview="list",this.setActiveLeg(-1,!0)));a.hasOwnProperty("aboveHeaderClass")&&e("#aboveHeaderContainer").addClass(a.aboveHeaderClass);a.hasOwnProperty("existingAlertId")&&d.events.publish("flights.results.existingAlert",a.existingAlertId);a.hasOwnProperty("oneway")&&(this.options.oneway=a.oneway,this.toggleGrayBG(a.oneway));a.hasOwnProperty("isSegmentView")&&this.element.find(".header-wrapper").toggleClass("segment-view",
a.isSegmentView);a.hasOwnProperty("isOneWay")&&(this.isOneWay=a.isOneWay);a.hasOwnProperty("isRoundTrip")&&(this.isRoundTrip=a.isRoundTrip);a.hasOwnProperty("isMulticity")&&(this.isMultiCity=a.isMulticity);a.hasOwnProperty("sortMode")&&(c=this.getSortDataFromString(a.sortMode),this.options.sortMode=c.sortType,this.options.ascending=c.ascending,this.customTicketOpened||d.events.publish("resultsHeader.sortType.set.no.refresh",{sortCode:a.sortMode}));a.hasOwnProperty("activeCabin")&&a.activeCabin!==
this.activeCabin&&(this.activeCabin=a.activeCabin,d.events.publish("flights.results.activeCabin.changed",this.activeCabin));this.options.resultsPlaceholderEnabled&&0<a.filteredCount&&this.resultsPlaceholder.removeClass("visible");a.hasOwnProperty("insightsContainerData")&&d.events.publish("flights.results.insightsContainerData",e.extend({searchComplete:this.poll.ended},a.insightsContainerData));this.searchStartedWithFilters&&a.completed&&a.hasOwnProperty("cheapestResultHiddenByFilters")&&d.events.publish("flights.results.cheapestResultHiddenByFilters",
{hidden:a.cheapestResultHiddenByFilters,price:a.cheapestHiddenPrice});this.updateFooter(a.filtersData&&a.filtersData.quality&&a.filtersData.quality.valueMap.hasOwnProperty("split"))},getSortDataFromString:function(a){a=a.split("_");var c=a[1];return{sortType:a[0],ascending:c?"a"===c:null}},shouldTrackStreamingPerformance:function(){return this.searchStartParams.origincode&&this.searchStartParams.destinationcode&&-1<d.config.getString("ui.horizon.resultspage.flights.trackStreamingPerformance","").split(",").indexOf(this.searchStartParams.origincode+
this.searchStartParams.destinationcode)?!0:this.base()},updateFooter:function(a){this.options.footerDisclaimersEnabled&&d.events.publish("footer.update.rp.disclaimer",{message:a?this.options.msg.footerMessageHf:this.options.msg.footerMessage})},skipLoadingTreatment:function(){return this.options.resultsPlaceholderEnabled},adjustTimesFilterState:function(a,c){a.legs&&a.legs.forEach(function(a,e){if(0!==Object.keys(a).length){var b;b=moment(c.isMulticity?c["depart_date"+e]:0===e?c.depart_date:c.return_date,
d.globals.apiDateFormat).utc();["max","min"].forEach(function(c){if(a[c]){var d=moment(parseInt(a[c],10)).utc(),e=b.diff(d.clone().startOf("day"),"days");0!==e&&(a[c]=d.add(e,"days").toDate().getTime().toString())}})}})},setPreservedFilterState:function(a){this.base(a);this.preservedFilters.takeoff&&this.adjustTimesFilterState(this.preservedFilters.takeoff,a);this.preservedFilters.landing&&this.adjustTimesFilterState(this.preservedFilters.landing,a);!this.preservedFilters.flexdepart||a.depart_date===
this.searchStartParams.depart_date&&a.depart_date_flex===this.searchStartParams.depart_date_flex||delete this.preservedFilters.flexdepart;!this.preservedFilters.flexreturn||a.return_date===this.searchStartParams.return_date&&a.return_date_flex===this.searchStartParams.return_date_flex||delete this.preservedFilters.flexreturn},setupDriveByAlertRequest:function(a){d.ajax.execute("flights/results/FlightPriceAlertDriveBy",{data:{searchId:a},replace:!0})},handleGTMUpdate:function(a){this.gtmUpdates[a.resultId]&&
window.clearTimeout(this.gtmUpdates[a.resultId]);this.gtmUpdates[a.resultId]=setTimeout(function(){d.events.publish("gtm.update",a)},500)},endPolling:function(a,c,b){this.base(a,c,b);"completed"===a&&this.preserveFilters&&b&&this.poll.usingPreservedFilters&&this.checkFilteredCountForPreservedFilters(b);this.options.resultsPlaceholderEnabled&&this.resultsPlaceholder.removeClass("visible");this.options.noNonstopWarningEnabled&&this.warnNonStop&&this.checkNoNonstopFound()},checkNoNonstopFound:function(){d.question.ask("filters.stops.hasNonStop")||
(d.events.publish("resultspage.notify",{content:this.options.msg.nononstop_warning,openWhileIdle:!0}),d.events.publish("filter.reset",{name:"stops"}),this.warnNonStop=!1)},checkFilteredCountForPreservedFilters:function(a){var c=this.preservedFilters,b={};this.options.nonClearablePreservedFilters.forEach(function(a){c.hasOwnProperty(a)&&(b[a]=c[a])});this.clearPreservedFilters();a.filteredCount<=this.options.removeFiltersThreshold?(d.events.publish("resultspage.preservedFilters.removed"),d.events.publish("resultspage.notify",
{content:this.options.msg.preserved_filters_removed}),this.preservedFilters=0<Object.keys(b).length?b:null,this.filterState=0<Object.keys(b).length?b:{},this.refreshResults({resetFilters:!0})):this.options.messageAppliedPreservedFilters&&d.events.publish("resultspage.notify",{content:this.options.msg.preserved_filters_applied})},isFirstResults:function(a,c){return this.options.firstResultsUseFilteredCount?a&&c&&0<c.filteredCount&&0>this.poll.lastPollTotalCount:this.base(a,c)},setMomondoGraphVisibility:function(a){null!=
this.momondoGraphContainer&&this.momondoGraphContainer.toggleClass("hidden",this.options.datesGraphForEcoOnly&&"e"!=a.cabin)},startedStreaming:function(){this.searchStartedWithFilters=!!this.urlFilterState;this.warnNonStop=this.options.noNonstopWarningEnabled&&this.searchStartedWithFilters&&-1<this.urlFilterState.indexOf("stops\x3d");this.searchStartedWithFilters&&-1<this.urlFilterState.indexOf("cabin\x3d")&&d.events.publish("flights.filters.hoistCabin")}})})(R9,jQuery);(function(b){b.createComponentClass("flights.results.brands.momondo.FlightResultsPage","flights.results.FlightResultsPage",{preprocessResponse:function(a){this.base(a);a=!this.poll.ended;this.element.find("#searchResultsList").toggleClass("invisible",a);this.resultsPlaceholder.toggleClass("visible",a)}})})(R9);function ConsentHandler(c){this.consentExpires=c&&0<=c.consentExpires?c.consentExpires:15552E6;this.declinedExpires=6048E5;this.CONSENT_NAME="DATA_CONSENT"}ConsentHandler.prototype.setConsentToCookie=function(c,d){d="undefined"===typeof d?!0:d;var a=new Date;a.setTime(a.getTime()+this.consentExpires);document.cookie=this.CONSENT_NAME+"\x3d"+d+";path\x3d/;expires\x3d"+a;c&&c({dataConsent:d})};
ConsentHandler.prototype.setDeclinedConsentCookie=function(c){var d=new Date;d.setTime(d.getTime()+this.declinedExpires);document.cookie=this.CONSENT_NAME+"\x3dfalse;path\x3d/;expires\x3d"+d;c&&c({dataConsent:!1})};ConsentHandler.prototype.getConsentFromCookie=function(){if(document.cookie){var c=this.CONSENT_NAME+"\x3dtrue";return document.cookie.split(";").some(function(d){return d&&d.trim&&d.trim()===c})}return!1};
ConsentHandler.prototype.getConsentCookieValue=function(){var c=this;if(document.cookie){var d=document.cookie.split(";").filter(function(a){return a&&a.trim&&0===a.trim().indexOf(c.CONSENT_NAME)});if(d.length)return"true"===d[0].trim().split("\x3d")[1]?!0:!1}return null};
(function(c,d){c.createComponentClass("common.tags.DataLayer",{ENDUSER_CONSENT_NAME:"DATA_ENDUSER_CONSENT",consented:!1,ready:!1,consentHandler:null,consentEvents:null,gtmSourceSetup:!1,gtm:null,queue:null,options:{useConsentSetup:!1,consentExpires:0,noConsentDefersLoad:!1},affiliateDataLayerSchema:{common:"presentation placement locale vertical screenId eventName event dataConsent".split(" "),clickOut:["eventName","startDate","endDate","price"],expandDetails:["eventName","screenId","price"],flight:{results:"startDate endDate originAirportCode originCityName originCountryCode destinationAirportCode destinationCityName destinationCountryCode cabinClass roundTrip tripType totalTravelers adultTravelers youthTravelers childTravelers seatInfantTravelers lapInfantTravelers legs".split(" "),
clickOut:"originAirportCode originCityName originCountryCode destinationAirportCode destinationCityName destinationCountryCode roundTrip tripType totalTravelers seniorTravelers adultTravelers youthTravelers childTravelers seatInfantTravelers lapInfantTravelers airlineName cabinClass legs".split(" ")},hotel:{results:"rooms guests cityName countryCode hotelName adultTravelers childTravelers".split(" "),details:"hotelName starRating rooms guests cityName countryCode".split(" "),clickOut:"hotelName starRating rooms guests cityName countryCode".split(" ")},
car:{results:"pickupTime dropoffTime sameLocation pickupAirportCode pickupCityName pickupCountryCode dropoffAirportCode dropoffCityName dropoffCountryCode".split(" "),clickOut:["carClass"]},packagetour:{results:"originAirportCode originCityName originCountryCode destinationAirportCode destinationCityName destinationCountryCode totalTravelers seniorTravelers adultTravelers youthTravelers childTravelers infantTravelers".split(" "),clickOut:"originCityId originRegionName originRegionCode destinationCityId destinationRegionName destinationRegionCode hotelId brandName brandId parentBrandId".split(" ")},
unknown:{}},init:function(a){this.queue=[];this.options.useConsentSetup?(this.consentHandler=new ConsentHandler({consentExpires:this.options.consentExpires}),this.consented=this.consentHandler.getConsentFromCookie()):this.consented=!0;this.consentEvents=c.config.getString("ui.horizon.cookie.consent.events","").split(",");this.gtm=d(a)[0];d(this.gtm).on("load",d.proxy(this.onLoadIFrame,this))},inlineComponentsReady:function(){!this.consented&&this.options.noConsentDefersLoad||this.loadGtm();c.question.ask("tags.dataLayer.hasCustomHandler")||
this.updateDataLayer(this.getMainLayerParams())},addEventHandlers:function(){var a=this;this.options.useConsentSetup&&(this.subscribe(this.consentEvents,this.consentSuccess.bind(this)),this.subscribe("gdpr.cookie.declined",this.declinedConsent.bind(this)));c.events.subscribe("frontdoor.view.changed",function(){if(a.ready)try{var b=that.gtm.contentWindow;b.history&&b.history.replaceState&&b.history.replaceState("",document.title,location.href);b.document.title=document.title}catch(l){}});this.subscribe("tags.dataLayer.push",
function(b){b=b||{};b.attachMainParams&&(b=d.extend(a.getMainLayerParams(),b));b.hasOwnProperty("dataConsent")||(b.dataConsent=a.consented);delete b.attachMainParams;b.affiliateGoogleTagManagerId&&""!==b.affiliateGoogleTagManagerId&&(b.dataConsent=a.getEndUserConsentFromCookie(),b=a.getAffilaiteDataLayer(b));c.config.getBoolean("ui.gtm.force.datalyer.presentation",!0)&&(b.presentation=a.options.apPresentation);a.updateDataLayer(b)});this.subscribe("gtm.enduser.consent",function(b){b&&(a.setEndUserConsentCookie(),
a.loadGtm())});c.question.answer("horizon.cookie.consent.value",function(){return a.consentHandler.getConsentCookieValue()})},onLoadIFrame:function(){setTimeout(this.processQueue.bind(this),1)},processQueue:function(){this.ready=!0;for(var a=0,b;b=this.queue[a];a++)this.updateDataLayer(b)},cleanUndefinedVars:function(a){d.each(a,function(b,c){""!==c&&null!==c||delete a[b]})},updateDataLayer:function(a){a&&!a.hasOwnProperty("dataConsent")&&(a.dataConsent=this.consented);if(this.ready)try{this.log.console("updating data layer",
a);var b=this.gtm.contentWindow;b.unifiedDataLayer||(b.unifiedDataLayer=[]);this.cleanUndefinedVars(a);b.unifiedDataLayer.push(a)}catch(l){}else this.queue.push(a)},consentSuccess:function(){var a=this;!this.consented&&this.consentHandler&&this.consentHandler.setConsentToCookie(function(b){a.consented=!0;a.updateDataLayer(b);a.loadGtm()})},declinedConsent:function(){var a=this;this.consentHandler&&this.consentHandler.setDeclinedConsentCookie(function(b){a.consented=!1;a.updateDataLayer(b);a.loadGtm()},
!1)},isIframe:function(){try{return window.self!==window.top}catch(a){return!0}},getEndUserConsentFromCookie:function(){if(document.cookie){var a=this.ENDUSER_CONSENT_NAME+"\x3dtrue";return document.cookie.split(";").some(function(b){return b&&b.trim&&b.trim()===a})}return!1},setEndUserConsentCookie:function(){var a=new Date,b=0<=this.options.consentExpires?this.options.consentExpires:15552E6;a.setTime(a.getTime()+b);document.cookie=this.ENDUSER_CONSENT_NAME+"\x3dtrue;path\x3d/;expires\x3d"+a},isEndUserConsent:function(){var a=
this.getEndUserConsentFromCookie(),b=window;if(!a){var c=b.setInterval(function(){"parentIFrame"in b&&(b.clearInterval(c),c=null,b.parentIFrame.sendMessage({action:"getGTMEndUserConsent"}))},500);b.setTimeout(function(){c&&b.clearInterval(c)},15E3)}return a},loadGtm:function(){if(!this.gtmSourceSetup){this.gtmSourceSetup=!0;var a=window.location,b="",c="",d=this.options.affiliateGTMEndUserConsentFeature,e=this.options.affiliateGoogleTagManagerId;if(e&&(b=-1<a.search.indexOf("?")?"\x26":"?",c="gtmid\x3d"+
e,d&&this.isIframe()&&!this.isEndUserConsent())){this.gtmSourceSetup=!1;return}a="/ugtm{pathname}{search}{hash}{sign}{gtmid}".replace("{pathname}",a.pathname).replace("{search}",a.search).replace("{hash}",a.hash).replace("{sign}",b).replace("{gtmid}",c);this.gtm.src=a}},cloneDataLayer:function(a,b){var c={};a.forEach(function(a){b.hasOwnProperty(a)&&(c[a]=b[a])});return c},getAffilaiteDataLayer:function(a){var b=c.globals.analytics||{},d=b.screenId||b.pageId||"unknown",f=b.vertical||"unknown",b=a.eventName||
"screenView",e=this.affiliateDataLayerSchema,h=e.common||[],k="undefined"!==typeof e[f],d=k?e[f][d]:[],g={};k&&(h=h.concat(d),g=this.cloneDataLayer(h,a),a.hasOwnProperty("presentation")&&(g.presentation=this.options.apPresentation),"clickOut"==b&&(f=e[b].concat(e[f][b]),g=this.cloneDataLayer(f,a)),"expandDetails"==b&&(g=this.cloneDataLayer(e[b],a)));return g},getMainLayerParams:function(){var a=c.globals.analytics||{},b=d.extend({},this.options,{vertical:a.vertical||"unknown",screenId:a.screenId||
a.pageId||"unknown",subScreenId:a.subScreenId||a.subPageId,eventName:this.options.eventName||"screenView",dataConsent:this.consented,placement:c.globals.placement||"",presentation:this.options.apPresentation});["apPresentation","useConsentSetup","consentExpires","noConsentDefersLoad"].forEach(function(a){delete b[a]});return b}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.tracking.IFrameGoogleTagManager",{options:{clickTripz:!1,updateDelay:100,useConsentSetup:!1,consentExpires:0,noConsentDefersLoad:!1},searchId:null,queue:null,ready:!1,consented:!1,CONSENT_NAME:"DATA_CONSENT",gtmSourceSetup:!1,init:function(a){this.gdprEvents=b.config.getString("ui.horizon.cookie.consent.iframegtm.events","").split(",");this.queue=[];this.consented=!this.options.useConsentSetup||this.getConsentFromCookie();this.setUpInitialData();this.gtm=
d(a)[0];d(this.gtm).on("load",d.proxy(this.onLoadIFrame,this));!this.consented&&this.options.noConsentDefersLoad||this.setupGtmSource()},setupGtmSource:function(){this.gtmSourceSetup||(this.gtmSourceSetup=!0,this.gtm.src="/gtm"+location.pathname+location.search+location.hash)},getConsentFromCookie:function(){if(document.cookie){var a=this.CONSENT_NAME+"\x3dtrue";return document.cookie.split(";").some(function(c){return c&&c.trim&&c.trim()===a})}return!1},consentSuccess:function(){if(!this.consented){this.consented=
!0;if(this.options.useConsentSetup){var a=new Date,c=0<=this.options.consentExpires?this.options.consentExpires:15552E6;a.setTime(a.getTime()+c);document.cookie=this.CONSENT_NAME+"\x3dtrue;path\x3d/;expires\x3d"+a}this.updateDataLayer({dataConsent:!0});this.setupGtmSource()}},onLoadIFrame:function(){setTimeout(this.processQueue.bind(this),1)},setUpInitialData:function(){var a=b.globals.analytics||[],c=a.pixelContext||{};this.updateDataLayer({vertical:a.vertical||b.globals.vertical,locale:b.globals.locale.loc,
affiliate:b.globals.affiliate,affiliateskin:b.globals.brand,placement:b.globals.placement||"",geoIpCc:b.globals.geoIpCc,experiment:b.globals.experiment,pageId:a.pageId,subPageId:a.subPageId,presentation:a.presentation||b.globals.presentation,clickTripz:this.options.clickTripz,pixelContext:c,dataConsent:this.consented,event:"pageView"});this.searchId=c.searchId},processQueue:function(){this.ready=!0;for(var a=0,c;c=this.queue[a];a++)this.updateDataLayer(c)},updateDataLayer:function(a){a&&!a.hasOwnProperty("dataConsent")&&
(a.dataConsent=this.consented);if(this.ready)try{this.log.console("updating data layer",a);var c=this.gtm.contentWindow;c.dataLayer||(c.dataLayer=[]);c.dataLayer.push(a)}catch(e){}else this.queue.push(a)},addEventHandlers:function(){var a=this;b.events.subscribe("frontdoor.view.changed",function(){if(a.ready)try{var c=a.gtm.contentWindow;c.history&&c.history.replaceState&&c.history.replaceState("",document.title,location.href);c.document.title=document.title}catch(f){}});var c=this.options.updateDelay;
b.events.subscribe("search.poll.response",function(b){b.pixelContext&&a.searchId!==b.pixelContext.searchId&&(setTimeout(a.updateDataLayer.bind(a,{event:"pageView",vertical:b.vertical,pageId:"results",pixelContext:b.pixelContext}),c),a.searchId=b.pixelContext.searchId);b.completed&&setTimeout(a.updateDataLayer.bind(a,{event:"resultsLoaded"}),c)});this.options.useConsentSetup&&b.events.subscribe(this.gdprEvents,this.consentSuccess.bind(this));b.events.subscribe(["login.success","fbauth.login.success",
"googleauth.login.success"],function(){a.updateDataLayer({event:"login"})});b.events.subscribe("signup.success",function(){a.updateDataLayer({event:"signup"})});b.events.subscribe("gtm.update",function(b){a.updateDataLayer(b)})}})})(R9,jq||jQuery);(function(a,e){a.createComponentClass("common.privacy.StyleJamHeaderCookiesMessage",{options:{gdprEnabled:!1,ajaxComponent:"common/privacy/AjaxStyleJamHeaderCookiesMessage"},init:function(){var b=this.options.ajaxComponent||"common/privacy/AjaxStyleJamHeaderCookiesMessage",c={type:"GET",replace:!0,combinable:a.config.getBoolean("ui.horizon.common.header.cookieMessage.combinable",!1),cacheable:a.config.getBoolean("ui.horizon.common.header.cookieMessage.cacheable",!1)};if(this.options.gdprEnabled){var d=
window["@r9/gdpr"];d&&d.canShowConsentDialog()&&(b=a.config.getString("ui.horizon.common.gdpr.cookie.consent.dialog.url","common/gdpr/CookieConsent"),c={type:"GET",appendTo:e("body")})}a.ajax.execute(b,c)}})})(window.R9,window.jQuery);(function(b,a){b.createComponentClass("common.currency.StyleJamCurrencyMessage",{options:{displayLater:!1,displayImmediately:!1,cookieName:"hideCurrencyMessage"},isVisible:!1,closeBtn:void 0,init:function(b){this.closeBtn=a("#"+this.id("close"));this.options.displayImmediately?this.showMessage():this.options.displayLater&&(this.subscribe("resultspage.view.setvisible",a.proxy(this.showMessage,this)),this.subscribe("header.view.set",{view:"results"},a.proxy(this.showMessage,this)),this.subscribe("pageContainers.changed",
{state:"results"},a.proxy(this.showMessage,this)),this.subscribe("resultspage.routed",a.proxy(this.showMessage,this)))},addEventHandlers:function(){this.closeBtn.bind("click",a.proxy(this.close,this))},showMessage:function(){this.isVisible||(this.element.slideDown("slow"),window.setMetaCookie(this.options.cookieName,!0),this.isVisible=!0)},close:function(){this.element.slideUp("slow")}})})(window.R9,window.jQuery);(function(a){a.createComponentClass("common.layout.SiteWideMessage",$.extend({},a.Common.RedirectMessage.prototype,{redirectMessage:void 0,options:{redirectFromTo:void 0,redirectFromToAlt:void 0,upgradeBrowserEnabled:!1},upgradeId:void 0,init:function(){this.upgradeId=this.id("upgrade");this.containerId=this.id();this.redirectFromTo=this.options.redirectFromTo;this.redirectFromToAlt=this.options.redirectFromToAlt;this.updateRedirectUrl();this.bindRedirectAdt()},addEventHandlers:function(){this.subscribe("frontdoor.view.changed",
this.updateRedirectUrl.bind(this));null!==document.getElementById(this.upgradeId)&&a.ajax.execute("common/upgrade/UpgradeBrowser",{appendTo:this.upgradeId});this.registerEvent("click",this.element.find(".js-close"),function(){$(this).closest(".js-msgContainer").slideUp("slow");var a=$(this).attr("data-mc");setMetaCookie(a,!0)})}}))})(R9);(function(b,f){b.createComponentClass("common.layout.StyleJamNavLink",{loggingPrefix:"StyleJamNavLink",openedSwindleTab:!1,infoMarker:null,options:{url:null,active:!1,verticalName:null,preventNavigation:!1,pageStates:{default:{base:null,defaultState:null,activeState:null,infoMarker:null,viewTransition:null},results:{base:null,defaultState:null,activeState:null,infoMarker:null,viewTransition:null}},showFocusIndication:!1,focusedElement:""},view:null,init:function(){this.infoMarker=this.getChildElement("info-marker")},
addEventHandlers:function(){var a=this;a.element.on("click",function(d){var c=a.getStates();a.options.preventNavigation?(a.options.active||(b.events.publish("NavLink.clicked",{vertical:a.options.verticalName,url:a.options.url,active:a.options.active}),b.dom.swapClasses(a.element,c.defaultState,c.activeState),a.options.active=!0),d.preventDefault()):b.Analytics.api.trackEvent({category:a.loggingPrefix,action:"click",label:a.options.verticalName})});a.options.preventNavigation&&this.subscribe("NavLink.clicked",
this.onActiveNavChanged.bind(this));if(!b.config.getBoolean("ui.no.popup.enabled",!1)||"notloggedin"===b.globals.analytics.loginState){if(b.config.getBoolean("ui.search.swindle.enabled",!0)&&b.config.getBoolean("ui.search.swindle."+a.options.verticalName+".enabled",!0)&&(!b.config.getBoolean("ui.suppress.swindle",!1)||b.config.getBoolean("ui.suppress.swindle",!1)&&!b.storage.get("suppress_swindle")))a.element.on("click",function(d){var c=b.storage.get("lastSwindleClick"),e=b.config.getInt("ui.search.swindle.expiration",
864E5);if(("/"===document.location.pathname||"/hotels"===document.location.pathname)&&!a.options.active&&(!c||c+e<Date.now()))return b.storage.set("lastSwindleClick",Date.now()),b.events.publish("swindleTab.activated"),window.open(a.options.url,"_blank"),d.preventDefault(),!1});this.subscribe(["header.view.set","pageContainers.changed","sem.explore.form.change-state"],function(d){if(d.view||d.newstate){d=d.view||d.newstate;a.view="rp"===d?"results":d;var c=a.getStates();c&&(a.element.removeClass(),
a.infoMarker.removeClass(),a.element.addClass(c.viewTransition),window.setTimeout(function(){a.options.active?a.element.addClass(c.activeState):a.element.addClass(c.defaultState);a.infoMarker.length&&a.infoMarker.addClass(c.infoMarker);b.dom.schedule(function(){a.element.addClass(c.base);a.element.removeClass(c.viewTransition)})},0))}});this.subscribe("omni.vertical.changed",function(d){var c=a.getStates();a.options.verticalName!==d?(b.dom.swapClasses(a.element,c.activeState,c.defaultState),a.options.active=
!1):(b.dom.swapClasses(a.element,c.defaultState,c.activeState),a.options.active=!0)});this.options.showFocusIndication&&this.subscribe("body.accessibilityMode.enabled",function(d){d?b.dom.swapClasses(a.element,"",a.options.focusedElement):b.dom.swapClasses(a.element,a.options.focusedElement,"")})}},onActiveNavChanged:function(a){a.vertical!==this.options.verticalName&&this.options.active&&(a=this.getStates(),b.dom.swapClasses(this.element,a.activeState,a.defaultState),this.options.active=!1)},getStates:function(){return"results"===
this.view?this.options.pageStates.results:this.options.pageStates.default}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.layout.StyleJamNavigation",{options:{isAjaxableMoreNavLinkEnabled:!1,activeVertical:"",overflowVertical:"",showFocusIndication:!1},init:function(){this.options.isAjaxableMoreNavLinkEnabled&&this.loadValues()},loadValues:function(){var a=this.getData(this.options);b.ajax.execute("common/layout/StyleJamMoreNavLink",{data:d.extend({},a,{active:"more"===a.activeVertical,isTab:!0,currentVertical:a.activeVertical,underline:a.underlineLinks,hideBreakpoint:a.hideMoreBreakpoint,
styleJamPresentation:a.moreNavLinkPresentation,styleJamPresentationRP:a.moreNavLinkPresentationRP,activeStyleJamPresentation:a.activeMoreNavLinkPresentation,showFocusIndication:a.showFocusIndication,moreNavMenuOptions:JSON.stringify(a.moreNavMenuOptions),overrideLinks:JSON.stringify(a.overrideLinks),seo:b.globals.isSeo}),appendTo:this.element.find(".col.js-vertical-more"),replace:!0})},getData:function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&null!==a[c]&&(b[c]=a[c]);return b}})})(R9,$);(function(c,l){c.createWidgetClass("checkbox.Toggle",{widgetName:"checkbox",icon:null,input:null,label:null,onText:null,offText:null,clicking:!1,options:{keydown:l.noop,click:null,change:null,focus:null,blur:null},jQueryConstructorName:"toggleInput",isValidElement:function(){return"input"===this.input.get(0).nodeName&&"checkbox"===this.input.get(0).type},init:function(){this.input=this.getChildElement("input");this.label=this.getChildElement("label");this.icon=this.getChildElement("icon");this.onText=
this.getChildElement("text-on");this.offText=this.getChildElement("text-off")},addEventHandlers:function(){this.registerEvent("click.checkbox",this.input,this._handleElementClickEvent.bind(this));this.registerEvent("change.checkbox",this.input,this._handleElementChangeEvent.bind(this));this.registerEvent("keydown.checkbox",this.input,this._handleKeydownEvent.bind(this));this.registerEvent("focus.checkbox",this.input,this._handleElementFocusEvent.bind(this));this.registerEvent("blur.checkbox",this.input,
this._handleElementBlurEvent.bind(this))},_handleElementClickEvent:function(){this.options.click&&this.options.click.apply(this,arguments)},_handleElementChangeEvent:function(a){var b=this.input.prop("checked");this.styleChecked(b);this.input.attr("aria-checked",b);this.onText.length&&this.offText.length&&this.label.attr("aria-label",b?this.onText.html():this.offText.html());this.options.change&&this.options.change.apply(this,[b,a])},_handleKeydownEvent:function(a){if(a.which===c.globals.keyCodes.RETURN||
a.which===c.globals.keyCodes.SPACE)return this.input.prop("checked",!this.input.prop("checked")),this.input.change(),!1},_handleElementFocusEvent:function(a,b,c){a.disabled||(this.styleFocus(!0),this.options.focus&&this.options.focus.apply(this,arguments))},_handleElementBlurEvent:function(a,b,c){a.disabled||(this.styleFocus(!1),this.options.blur&&this.options.blur.apply(this,arguments))},setEnabled:function(a){a?this.input.removeAttr("disabled"):this.input.attr("disabled","disabled");this.input.attr("aria-disabled",
!a);this.input.attr("tabindex",a?0:-1);this.styleEnabled(a)},getValue:function(){return this.input.prop("checked")},setChecked:function(a){this.input.prop("checked",a)},setLabel:function(a){this.label.text(a)},styleChecked:function(a){var b=a?"on":"off";a=a?"off":"on";c.dom.swapClasses(this.icon,this.getStlBlock("Toggle__icon--"+a),this.getStlBlock("Toggle__icon--"+b));c.dom.swapClasses(this.icon.children("svg"),this.getStlBlock("Toggle__icon__svg--"+a),this.getStlBlock("Toggle__icon__svg--"+b));
c.dom.swapClasses(this.label,this.getStlBlock("Toggle__label--"+a),this.getStlBlock("Toggle__label--"+b));c.dom.swapClasses(this.onText,this.getStlBlock("Toggle__label__text--"+a),this.getStlBlock("Toggle__label__text--"+b));c.dom.swapClasses(this.offText,this.getStlBlock("Toggle__label__text--"+b),this.getStlBlock("Toggle__label__text--"+a));this.styleFocus(this.isInputFocused())},styleEnabled:function(a){var b=a?"enabled":"disabled";a=a?"disabled":"enabled";c.dom.swapClasses(this.element,this.getStlBlock("Toggle--"+
a),this.getStlBlock("Toggle--"+b));c.dom.swapClasses(this.input,this.getStlBlock("Toggle__input--"+a),this.getStlBlock("Toggle__input--"+b));c.dom.swapClasses(this.label,this.getStlBlock("Toggle__label--"+a),this.getStlBlock("Toggle__label--"+b))},styleFocus:function(a){var b=this.input.prop("checked"),e=b?"on":"off",g=this.getStlBlock("Toggle__icon--focused-on"),d=this.getStlBlock("Toggle__icon--focused-off"),f=this.getStlBlock("Toggle__icon--"+e),h=this.getStlBlock("Toggle__label--focused-on"),
k=this.getStlBlock("Toggle__label--focused-off"),e=this.getStlBlock("Toggle__label--"+e);a?(a=b?g:d,d=(b?d:g)+" "+f,f=b?h:k,b=(b?k:h)+" "+e):(a=f,d=g+" "+d,f=e,b=h+" "+k);g&&c.dom.swapClasses(this.icon,d,a);h&&c.dom.swapClasses(this.label,b,f)},isInputFocused:function(){return document.activeElement===this.input.get(0)}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.authentication.StyleJamLoginForm",{url:"/k/run/auth/login",loggingPrefix:"account-login",usernameEl:null,passwordEl:null,submitEl:null,stickyWidget:null,trackCategory:"LoginForm",options:{onSubmit:null,newDialog:!1,promoType:"",improvedMessaging:!1,unifiedLoginModalEnabled:!1,inline:!1,msg:{missingPassword:"",passwordTooShort:"",submitButton:"",submitButtonProcessing:""},useForgotDialog:!1,inputValidationEnabled:!1,reloadOnSuccess:!0,eventId:null},init:function(){this.usernameEl=
this.getChildElement("username");this.passwordEl=this.getChildElement("password");this.forgotEl=this.getChildElement("forgot");this.submitEl=this.getChildElement("submit");this.form=this.getChildElement("form")},addEventHandlers:function(){var a=this;this.form.submit(this.doLogin.bind(this));this.subscribe("authentication.viewChange",this.onViewChange.bind(this));this.options.inline||this.subscribe("authentication.showLogin",function(b){b&&a.hasEventIdMismatch(b.id)||b&&"login"===b.type&&a.focusEmptyInput()});
this.forgotEl.click(function(){c.Analytics.api.trackEvent({category:a.trackCategory,action:"click",value:"forgot-link"});c.events.publish("authentication.viewChange",{type:"forgot",id:a.options.eventId})});this.options.newDialog&&(this.getChildElement("cancel").click(function(){c.events.publish("authentication.setView",{type:"default",id:a.options.eventId})}),this.element.find(".footerGrid .signup").click(function(){c.events.publish("authentication.setView",{type:"signup",id:a.options.eventId})}));
this.answer(this.namespaceQuestionName("authentication.login.username"),function(){return a.usernameEl.val()})},inlineComponentsReady:function(){var a=this,b=this.getChildElement("remember");b.length&&(this.stickyWidget=b.getWidget(),this.stickyWidget.options.change=function(b){c.Analytics.api.trackEvent({category:a.trackCategory,action:"remember",value:b?"yes":"no"})})},namespaceQuestionName:function(a){var b=this.options.eventId;return b?a+"."+b:a},doLogin:function(){var a={};a.username=this.usernameEl.val();
a.passwd=this.passwordEl.val();if(8>a.passwd.length)return c.events.publish("login.error",{formToken:null,message:0===a.passwd.length?this.options.msg.missingPassword:this.options.msg.passwordTooShort,status:-1,uid:null,userInfo:null,element:this.passwordEl,id:this.options.eventId}),!1;this.stickyWidget&&(a.sticky=this.stickyWidget.getValue());this.toggleSubmittingState(!0);"function"===typeof this.options.onSubmit?this.options.onSubmit.call(this,a):d.ajax({method:"POST",url:this.url,headers:{"X-CSRF":c.globals.formtoken},
data:a}).done(this.success.bind(this)).fail(this.fail.bind(this));return!1},success:function(a){0<=a.status?(c.storage.set("R9ScrollY",window.document.documentElement.scrollTop||window.document.body.scrollTop),c.authentication.formToken=a.formToken,c.authentication.userInfo=a.userInfo,c.events.publish("login.success",{username:this.usernameEl.val(),id:this.options.eventId}),c.Analytics.api.trackEvent({category:this.loggingPrefix,action:"success"}),this.options.reloadOnSuccess||this.toggleSubmittingState(!1)):
(this.toggleSubmittingState(!1),a.id=this.options.eventId,this.options.improvedMessaging&&(a.element="p"===a.errorField?this.passwordEl:"u"===a.errorField?this.usernameEl:null),c.events.publish("login.error",a))},fail:function(){c.events.publish("login.fail",{id:this.options.eventId});this.toggleSubmittingState(!1)},toggleSubmittingState:function(a){var b=this.options.msg;a?this.submitEl.focus().text(b.submitButtonProcessing).prop("disabled",!0):this.submitEl.text(b.submitButton).prop("disabled",
!1)},focusEmptyInput:function(a){var b=this;a=a||0;window.setTimeout(function(){b.usernameEl.is(":visible")?b.usernameEl.val()?b.passwordEl.focus():b.usernameEl.focus():10>a&&(a+=1,b.focusEmptyInput(a))},50)},hasEventIdMismatch:function(a){return this.options.eventId&&a&&this.options.eventId!==a},onViewChange:function(a){if(!this.hasEventIdMismatch(a.id))if("login"===a.type)this.swapClasses(this.element,"Wrapper--hidden","Wrapper--visible"),this.element.attr("aria-hidden",!1).fadeIn("slow"),this.focusEmptyInput(),
c.Analytics.api.trackEvent({category:this.trackCategory,action:"visible"}),a.username?this.usernameEl.val(a.username):this.usernameEl.val()||(a=c.question.ask(this.namespaceQuestionName("authentication.register.username")))&&this.usernameEl.val(a);else if("signup"===a.type||this.options.unifiedLoginModalEnabled&&"forgot"===a.type)this.element.attr("aria-hidden",!0).css("display",""),this.swapClasses(this.element,"Wrapper--visible","Wrapper--hidden")}})})(R9,jq||jQuery);(function(b,d){b.createComponentClass("common.authentication.StyleJamSignupForm",{url:"/k/run/auth/register",loggingPrefix:"account-login",usernameEl:null,passwordEl:null,airportEl:null,airportCodeEl:null,hasAirport:!1,submitEl:null,optInWidget:null,form:null,legalCheckWidget:null,trackCategory:"SignupForm",options:{improvedMessaging:!1,unifiedLoginModalEnabled:!1,inline:!1,promo:null,promoType:null,redirectUrl:null,inputValidationEnabled:!1,legalAuthRequired:!1,reloadOnSuccess:!0,eventId:null,confirmed:"",
confcode:"",msg:{passwordTooShort:"",submitButton:"",submitButtonProcessing:""}},init:function(){this.usernameEl=this.getChildElement("username");this.passwordEl=this.getChildElement("password");this.airportEl=this.getChildElement("airport");this.airportCodeEl=this.element.find("input[name\x3dairportcode]");this.hasAirport=this.airportEl.length&&this.airportCodeEl.length;this.submitEl=this.getChildElement("submit");this.form=this.getChildElement("form")},bindAirportSmarty:function(){var a=this.airportCodeEl;
this.airportEl.flightSmarty({setItem:function(c,b){b&&setTimeout(function(){"ap"===b.type||"rail"===b.type?(c.elementNode.value=b.short_str||b.str,a.val(b.id)):"isl"===b.type&&(c.elementNode.value=b.str,a.val(""))},1)}})},addEventHandlers:function(){var a=this;this.hasAirport&&this.bindAirportSmarty();this.form.submit(this.doSignup.bind(this));this.options.inline||(this.subscribe("authentication.viewChange",this.onViewChange.bind(this)),this.subscribe("authentication.showLogin",function(b){b&&a.hasEventIdMismatch(b.id)||
b&&"signup"===b.type&&a.focusEmptyInput()}));this.answer(this.namespaceQuestionName("authentication.register.username"),function(){return a.usernameEl.val()})},inlineComponentsReady:function(){var a=this;this.optInWidget=this.getChildElement("email").getWidget();this.optInWidget.options.change=function(c){b.Analytics.api.trackEvent({category:a.trackCategory,action:"click",value:c?"opt-in":"opt-out"})};var c=this.getChildElement("legalcheck");c.length&&(this.legalCheckWidget=c.getWidget(),this.legalCheckWidget.options.change=
function(c){b.Analytics.api.trackEvent({category:a.trackCategory,action:"consent",value:c?"yes":"no"})})},namespaceQuestionName:function(a){var b=this.options.eventId;return b?a+"."+b:a},doSignup:function(){var a=d.extend({},this.options);a.username=this.usernameEl.val();a.passwd=this.passwordEl.val();if(this.options.improvedMessaging&&8>this.passwordEl.val().length)return b.events.publish("signup.error",{formToken:null,message:this.options.msg.passwordTooShort,status:-1,uid:null,userInfo:null,element:this.passwordEl,
id:this.options.eventId}),!1;this.hasAirport&&(a.airport=this.airportEl.val(),a.airportcode=this.airportCodeEl.val());a.username=this.usernameEl.val();a.optin=this.optInWidget.getValue();a.promo=this.options.promo;a.optin?b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"email-opt-in",label:this.options.promoType}):b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"email-opt-out",label:this.options.promoType});a.consent="";a.passwd=this.passwordEl.val();a.sub="";a.userInfo=
"";this.options.legalAuthRequired&&this.legalCheckWidget&&(a.consent=this.legalCheckWidget.getValue());this.toggleSubmittingState(!0);d.ajax({method:"POST",url:this.url,headers:{"X-CSRF":b.globals.formtoken},data:a}).done(this.success.bind(this)).fail(this.fail.bind(this));return!1},success:function(a){0<=a.status?(b.authentication.formToken=a.formToken,b.authentication.userInfo=a.userInfo,b.events.publish("signup.success"),b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"success"}),
this.options.reloadOnSuccess||this.toggleSubmittingState(!1)):(this.toggleSubmittingState(!1),"p"===a.errorField&&"login"===a.errorAction?(b.events.publish("authentication.viewChange",{type:"login",id:this.options.eventId}),b.events.publish("login.error",d.extend({},a,{id:this.options.eventId}))):this.options.improvedMessaging?b.events.publish("signup.error",{code:a.status,message:a.message,element:"p"===a.errorField?this.passwordEl:"u"===a.errorField?this.usernameEl:null,id:this.options.eventId}):
b.events.publish("signup.error",{code:a.status,message:a.message,id:this.options.eventId}))},fail:function(){b.events.publish("signup.fail",{id:this.options.eventId});this.toggleSubmittingState(!1)},toggleSubmittingState:function(a){var b=this.options.msg;a?this.submitEl.focus().text(b.submitButtonProcessing).prop("disabled",!0):this.submitEl.text(b.submitButton).prop("disabled",!1)},focusEmptyInput:function(a){var b=this;a=a||0;window.setTimeout(function(){b.usernameEl.is(":visible")?""===b.usernameEl.val()?
b.usernameEl.focus():b.passwordEl.focus():10>a&&(a+=1,b.focusEmptyInput(a))},50)},hasEventIdMismatch:function(a){return this.options.eventId&&a&&this.options.eventId!==a},onViewChange:function(a){if(!this.hasEventIdMismatch(a.id))if("signup"===a.type)this.swapClasses(this.element,"Wrapper--hidden","Wrapper--visible"),this.element.attr("aria-hidden",!1).fadeIn("slow"),this.focusEmptyInput(),b.Analytics.api.trackEvent({category:this.trackCategory,action:"visible"}),a.username?this.usernameEl.val(a.username):
this.usernameEl.val()||(a=b.question.ask(this.namespaceQuestionName("authentication.login.username")))&&this.usernameEl.val(a);else if("login"===a.type||this.options.unifiedLoginModalEnabled&&"forgot"===a.type)this.swapClasses(this.element,"Wrapper--visible","Wrapper--hidden"),this.element.attr("aria-hidden",!0).css("display","")}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.authentication.StyleJamForgotPasswordForm",{url:"/k/run/auth/forgot",formContainer:null,successContainer:null,emailInput:null,forgotForm:null,options:{eventId:null,msg:{submitButton:"",submitButtonProcessing:""}},init:function(){this.formContainer=this.getChildElement("formContainer");this.successContainer=this.getChildElement("successContainer");this.emailInput=this.getChildElement("email");this.submit=this.getChildElement("submit");this.cancelButton=
this.getChildElement("cancel");this.forgotForm=this.getChildElement("form");this.successLink=this.getChildElement("success-link")},addEventHandlers:function(){var a=this;this.subscribe("authentication.viewChange",this.handleViewChange.bind(this));this.forgotForm.submit(this.handleFormSubmit.bind(this));d(this.cancelButton).click(function(){c.events.publish("authentication.viewChange",{id:a.options.eventId,type:"login",username:a.emailInput.val()})});this.registerEvent("click",this.successLink,function(){c.events.publish("authentication.forgot.success")})},
hasEventIdMismatch:function(a){return this.options.eventId&&a&&this.options.eventId!==a},namespaceQuestionName:function(a){var b=this.options.eventId;return b?a+"."+b:a},handleViewChange:function(a){var b=this;this.hasEventIdMismatch(a.id)||("forgot"===a.type&&(this.showForm(),this.element.fadeIn("slow"),window.setTimeout(function(){b.emailInput.focus()},1)),a.username&&this.emailInput.val(a.username))},handleFormSubmit:function(a){var b=this.emailInput.val();a.preventDefault();this.disableInput();
d.ajax({method:"POST",url:this.url,headers:{"X-CSRF":c.globals.formtoken},data:{username:b}}).always(this.handleResponse.bind(this))},showForm:function(){this.swapClasses(this.successContainer,"Form__Success--visible","Form__Success--hidden");this.successContainer.attr("aria-hidden","true");this.swapClasses(this.formContainer,"Form--hidden","Form--visible");this.formContainer.attr("aria-hidden","false");if(!this.emailInput.val()){var a=c.question.ask(this.namespaceQuestionName("authentication.login.username"));
a&&this.emailInput.val(a)}},handleResponse:function(){this.showSuccessMessage();this.enableInput()},showSuccessMessage:function(){this.swapClasses(this.successContainer,"Form__Success--hidden","Form__Success--visible");this.successContainer.attr("aria-hidden","false");this.swapClasses(this.formContainer,"Form--visible","Form--hidden");this.formContainer.attr("aria-hidden","true");this.successLink.focus()},enableInput:function(){this.emailInput.focus();this.submit.text(this.options.msg.submitButton).removeClass("Button-Disabled").prop("disabled",
!1).attr("aria-busy",!1)},disableInput:function(){this.submit.text(this.options.msg.submitButtonProcessing).addClass("Button-Disabled").prop("disabled",!0).attr("aria-busy",!0)}})})(R9,$);(function(b,c){var d=b.config.getBoolean("ui.common.authentication.allowRedirect",!1);b.createComponentClass("common.authentication.OneStepSignin",{options:{usingCustomCallback:!1,socialApiErrorMessage:"",redirectUrl:null,inputValidationEnabled:!1,dropdown:!1,errorToolTip:!1,showFacebookLogin:!0,showGoogleLogin:!0,showNaverLogin:!1,strictNamespaceCheck:!1,msg:{loginHeaderWelcome:"",loginHeaderDesc:"",registerHeaderWelcome:"",registerHeaderDesc:""}},headerWelcome:null,headerDesc:null,trackCategory:"OneStepSignin",
dialog:null,loginContainer:null,signupContainer:null,errorContainer:null,errorMsgContainer:null,forgotDialogEl:null,forgotDialog:null,forgotSuccess:!1,linkToLogin:null,linkToRegister:null,googleConnectButton:null,fbConnectButton:null,init:function(){this.loginContainer=this.getChildElement("loginContainer");this.signupContainer=this.getChildElement("signupContainer");this.forgotDialogEl=this.getChildElement("forgotDialog");this.fbConnectButton=this.getChildElement("facebookLogin");this.googleConnectButton=
this.getChildElement("googleLogin");this.linkToLogin=this.getChildElement("linkToLogin");this.linkToRegister=this.getChildElement("linkToRegister");this.errorContainer=this.getChildElement("error");this.errorMsgContainer=this.getChildElement("error-message");this.headerWelcome=this.getChildElement("headerWelcome");this.headerDesc=this.getChildElement("headerDesc");this.disclaimer=this.getChildElement("disclaimer")},addEventHandlers:function(){var a=this;a.getChildElement("linkToRegister").click(function(){b.Analytics.api.trackEvent({category:a.trackCategory,
action:"click",value:"register-link"});b.events.publish("authentication.viewChange",{type:"signup",id:a.id()})});a.getChildElement("linkToLogin").click(function(){b.Analytics.api.trackEvent({category:a.trackCategory,action:"click",value:"login-link"});b.events.publish("authentication.viewChange",{type:"login",id:a.id()})});a.subscribe("authentication.viewChange",a.changeView.bind(this));a.subscribe("authentication.showLogin",a.onOpen.bind(this));a.subscribe(["social.error","login.error","signup.error"],
a.showError.bind(this));this.subscribe("login.success signup.success fbauth.login.success googleauth.login.success bdc.login.success naverauth.login.success".split(" "),this.handleAuthSuccess.bind(this));this.subscribe("authentication.forgot.success",function(){a.forgotSuccess=!0;a.forgotDialog.close()});this.registerEvent("click",this.getChildElement("bdcLogin"),this.handleBdcLoginClick.bind(this));this.options.showNaverLogin&&this.registerEvent("click",this.getChildElement("naverLogin"),this.handleNaverLoginClick.bind(this))},
inlineComponentsReady:function(){var a=this;this.options.showFacebookLogin&&b.Social.FB.ensureAPILoaded().then(this.setupFacebookLogin.bind(this)).catch(this.handleMissingFacebookLogin.bind(this));this.options.showGoogleLogin&&b.Social.Google.ensureAPILoaded().then(this.setupGoogleLogin.bind(this)).catch(this.handleMissingGoogleLogin.bind(this));var c={preventClosingClickBubble:!0};this.options.dropdown&&(c.onClose=function(){a.forgotSuccess?a.forgotSuccess=!1:b.events.publish("header.navMenu.dropdown.open",
{source:"forgot"})});this.forgotDialog=this.forgotDialogEl.dialog(c).getWidget()},setupFacebookLogin:function(){var a=this;this.fbConnectButton.click(function(){b.Analytics.api.trackEvent({category:a.trackCategory,action:"click",value:"facebook"});b.authentication.external.facebook.login(null,null,null,null,{id:a.id()})});window.FB.XFBML.parse()},handleMissingFacebookLogin:function(){this.googleConnectButton.length&&this.googleConnectButton.find(".googleOuterLarge").removeClass("googleOuterLarge");
this.handleMissingSocialAPI(this.fbConnectButton,"r9.facebook.api.loaded",this.setupFacebookLogin.bind(this))},setupGoogleLogin:function(){var a=this;this.googleConnectButton.click(function(){b.Analytics.api.trackEvent({category:a.trackCategory,action:"click",value:"google"});b.authentication.external.google.login(null,null,null,{id:a.id()})})},handleMissingGoogleLogin:function(){this.handleMissingSocialAPI(this.googleConnectButton,"r9.google.api.loaded",this.setupGoogleLogin.bind(this))},handleNaverLoginClick:function(){b.Analytics.api.trackEvent({category:this.trackCategory,
action:"click",value:"naver"});b.authentication.external.naver.login(null,{id:this.id()}).then(this.handleAuthSuccess.bind(this))},handleBdcLoginClick:function(){b.Analytics.api.trackEvent({category:this.trackCategory,action:"click",value:"bdc"});b.authentication.external.bdc.login(null,{id:this.id()}).then(this.handleAuthSuccess.bind(this))},handleMissingSocialAPI:function(a,b,c){var d=this,e=a.children(".js-social-button-content");this.swapClasses(e,"SocialButton__Content--active","SocialButton__Content--disabled");
a.attr({"aria-disabled":!0,"aria-label":this.options.socialApiErrorMessage});this.options.socialApiErrorMessage&&a.toolTip({content:this.options.socialApiErrorMessage,position:"top",extraClass:"modal-layer",showImmediately:!1,readContentOnOpen:!0});this.subscribe(b,function(){d.swapClasses(e,"SocialButton__Content--disabled","SocialButton__Content--active");a.attr("aria-disabled",!1).removeAttr("aria-label");a.data("toolTip")&&a.data("toolTip").removeWidget();"function"===typeof c&&c()})},onOpen:function(a){b.events.publish("authentication.viewChange",
c.extend({},a,{id:this.id()}))},changeView:function(a){!this.hasEventIdMismatch(a.id)&&a.type&&("login"===a.type?(this.swapClasses(this.linkToRegister,"SwitchLink--hidden","SwitchLink--visible"),this.swapClasses(this.linkToLogin,"SwitchLink--visible","SwitchLink--hidden"),this.swapClasses(this.disclaimer,"Privacy--visible","Privacy--hidden"),this.updateHeaderText(a.type),this.forgotDialog.close()):"signup"===a.type?(this.swapClasses(this.linkToRegister,"SwitchLink--visible","SwitchLink--hidden"),
this.swapClasses(this.linkToLogin,"SwitchLink--hidden","SwitchLink--visible"),this.swapClasses(this.disclaimer,"Privacy--hidden","Privacy--visible"),this.updateHeaderText(a.type),this.forgotDialog.close()):"forgot"===a.type&&this.forgotDialog.open(),this.hideError())},updateHeaderText:function(a){"login"===a?(this.headerWelcome.text(this.options.msg.loginHeaderWelcome),this.headerDesc.text(this.options.msg.loginHeaderDesc)):(this.headerWelcome.text(this.options.msg.registerHeaderWelcome),this.headerDesc.text(this.options.msg.registerHeaderDesc))},
showError:function(a){this.hasEventIdMismatch(a.id)||(this.options.errorToolTip?(c(".username, .pass, .auth-tooltip-hook").each(function(){c(this).data("toolTip")&&c(this).data("toolTip").removeWidget()}),(a.element||this.element.find(".auth-tooltip-hook:visible")).toolTip({content:a.message,baseClass:"loginDlgError",extraClass:"modal-layer",position:"top",showImmediately:!0,activation:"click",readContentOnOpen:!0})):(this.errorMsgContainer.html("").html(a.message),this.swapClasses(this.errorContainer,
"ErrorMessage--hidden","ErrorMessage--visible")))},hideError:function(){!this.options.errorToolTip&&this.errorContainer.length&&(this.errorMsgContainer.html(""),this.swapClasses(this.errorContainer,"ErrorMessage--visible","ErrorMessage--hidden"))},handleAuthSuccess:function(a){a&&(this.options.strictNamespaceCheck&&this.id()!==a.id||this.hasEventIdMismatch(a.id))||(b.authentication.needsRefresh=!0,this.hideError(),d&&this.options.redirectUrl?(b.storage.remove("R9ScrollY"),window.location=this.options.redirectUrl):
this.options.usingCustomCallback?b.events.publish("authentication.success",{id:this.id()}):setTimeout(function(){window.location.reload(!0)},300))},hasEventIdMismatch:function(a){return a&&this.id()!==a}})})(R9,jQuery);(function(b,e){b.createComponentClass("common.layout.AccountDropdown",{dropdown:null,isOpen:!1,options:{enableNotificationUpdates:!1,signoutRoot:"/k/ident/signout",confirmRoot:"/k/ident/resend",isLoggedInUser:!1,useFullUrlRedirection:!1},init:function(){this.dropdown=this.getChildElement("dropdown").getWidget()},addEventHandlers:function(){var a=this;this.subscribe("header.navMenu.dropdown.open",this.open.bind(this));this.subscribe("header.navMenu.dropdown.close",this.close.bind(this));this.subscribe("DropdownDialog.close",
{id:this.id("dropdown")},this.close.bind(this));this.subscribe("header.navMenu.dropdown.toggle",this.toggle.bind(this));this.subscribe("header.navMenu.login.modal.open",this.openUnifiedLogin.bind(this));this.getChildElement("more-logout").click(this.logout.bind(this));this.getChildElement("more-confirmation").click(this.confirmAccount.bind(this));this.options.enableNotificationUpdates&&this.subscribe(["trips.add","trips.remove","trips.move.event.finished"],this.updateNotificationCount.bind(this));
this.answer("account.dropdown.isopen",function(){return a.isOpen})},logout:function(){b.Social.WebCredentials.requireUserMediation();b.Analytics.api.trackEvent({action:"logout",label:"click"});this.redirect(this.options.signoutRoot)},confirmAccount:function(){this.redirect(this.options.confirmRoot)},setTripsCount:function(a){isNaN(a)||this.getChildElement("trips-counter").text(a)},updateNotificationCount:function(){var a=this;b.action.execute("common/authentication/UserStateAction").done(function(b){a.setTripsCount(b.tripsCount)})},
open:function(a){var c=this,d=function(){c.dropdown.open();c.isOpen=!0};b.events.publish("signin.open");a=a&&"forgot"===a.source;this.isLoggedInUser||a?d():b.Social.WebCredentials.trySignIn().then(function(){b.events.publish("login.success")}).catch(d)},openUnifiedLogin:function(){var a=function(){b.authentication.showLogin()};b.events.publish("signin.open");this.isLoggedInUser?a():b.Social.WebCredentials.trySignIn().then(function(){b.events.publish("login.success")}).catch(a)},close:function(){this.dropdown.close();
this.isOpen=!1},toggle:function(){this.isOpen?this.close():this.open()},redirect:function(a){window.location=a+"?redir\x3d"+encodeURIComponent(this.options.useFullUrlRedirection?window.location.href:window.location.pathname)}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.layout.NavMenu",{dropdown:null,messageTimeoutId:null,options:{isLoggedInUser:!1,signInOutLink:"",includeContent:!1,showEmailLogin:!1,isLogoutFullUrl:!1,messageDuration:3E3,activeVertical:null,accountDropdownLogin:!1},init:function(){var a=this;window.showAlertRegRedirect=function(d){a.options.isLoggedInUser?window.location="/alerts":b.authentication.showSignup({onclose:c.noop,success:function(){a.options.isLoggedInUser=!0;window.location="/alerts"}})};
this.options.includeContent||this.loadNavContent()},addEventHandlers:function(){var a=this;this.getChildElement("login").click(function(d){c("body").click();b.Social.WebCredentials.trySignIn(function(){a.options.accountDropdownLogin?b.events.publish("header.navMenu.dropdown.toggle"):b.authentication.showLogin()});d.preventDefault()});this.getChildElement("dropdown").click(function(d){a.options.isLoggedInUser||(d.preventDefault(),b.Social.WebCredentials.trySignIn(function(){b.authentication.showLogin()}))});
this.getChildElement("profileIcon").click(function(d){a.options.isLoggedInUser||(d.preventDefault(),b.Social.WebCredentials.trySignIn(function(){b.authentication.showLogin()}))});this.getChildElement("signup").click(function(a){c("body").click();b.authentication.showSignup({promoType:"all"});a.preventDefault()});this.getChildElement("login-icon").click(function(){b.Social.WebCredentials.trySignIn(function(){b.authentication.showLogin()})});this.getChildElement("more-logout").click(function(){b.Social.WebCredentials.requireUserMediation();
document.location="/k/ident/signout?redir\x3d"+encodeURIComponent(a.options.isLogoutFullUrl?window.location.href:window.location.pathname)});this.options.contentIncluded&&a.getChildElement("menuContent").find(".navmenu-more-login").click(function(){b.authentication.showLogin()});b.events.subscribe("DropdownDialog.open",a.handleDropdownEvent.bind(a,!0));b.events.subscribe("DropdownDialog.close",a.handleDropdownEvent.bind(a,!1));b.events.subscribe("NavMenu.showMessage",a.showMessage.bind(a))},handleDropdownEvent:function(a,
b){var d=this._id+"-dropdown";b.id&&b.id===d&&(a?c(this.element).addClass("active"):c(this.element).removeClass("active"))},loadNavContent:function(){b.ajax.execute("common/layout/NavMenuContent",{data:{signInOutLink:this.options.signInOutLink,loggedIn:this.options.isLoggedInUser,parentId:this.id(),activeVertical:this.options.activeVertical,isSEO:this.options.isSEO},appendTo:this.getChildElement("menuContent"),replace:!0})},showMessage:function(a){var b=this;if(a&&a.id&&a.text){var c=this.getChildElement(a.id);
if(c.length){this.removeMessage(c);clearTimeout(this.messageTimeoutId);var e={subNameSpace:"navMenu",content:a.text,position:"bottom",activation:"click",extraClass:"NavMenuTipAdjustTop",showImmediately:!0,closeOnBodyClick:!1,appendTo:"body"};a.color&&(e.color=a.color);c.toolTip(e);this.messageTimeoutId=setTimeout(function(){b.removeMessage(c)},this.options.messageDuration)}}},removeMessage:function(a){a.data("toolTip")&&a.data("toolTip").removeWidget()}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.layout.StyleJamHeader",{options:{focusHeaderMenuOnLoad:!1,navigationVisible:!0,fixedHeaderOnAlertSaved:!1,fixedHeaderOnAlertSavedToTrip:!1,statesClasses:{"default":{main:"",headerWrapper:"",headerContainer:"",caretBorder:""},hidden:{main:"",headerWrapper:"",headerContainer:"",caretBorder:""},results:{main:"",headerWrapper:"",headerContainer:"",caretBorder:""},navWrapper:{hidden:"",visible:""},activeState:""},swapInvertedLogoOnRp:!1,useCaret:!1,isHeaderSticky:!1,
fullWidthMap:!1},headerContainer:null,inlineComponentsReady:function(){var a=this;if(this.options.focusHeaderMenuOnLoad&&!this.isHashNavigation()&&!c.globals.isSeo){var b=this.element.find(".StyleJamNavLink")[0];b&&b.focus()}this.answer("header.height",function(){return a.element.outerHeight()});this.options.isHeaderSticky&&c.events.publish("pinnableBar.pinnedChange");this.headerContainer=this.getChildElement("headerContainer")},isHashNavigation:function(){return!!window.location.hash},addEventHandlers:function(){var a=
this;a.element.find("#myAccount").click(function(a){a.stopPropagation();c.events.publish("header.account.clicked",{})});c.events.subscribe(["header.view.set","pageContainers.changed","sem.explore.form.change-state"],function(b){if(b.view||b.newstate)b=b.view||b.newstate,a.changeView("rp"===b?"results":b)});this.options.useCaret&&c.events.subscribe("header.hideCaretBorder",function(){a.getChildElement("caretBorder").hide()});this.subscribe("hotels.results.dualViewMap.open",this.setDualViewMapOpen.bind(this,
!0));this.subscribe("hotels.results.dualViewMap.closed",this.setDualViewMapOpen.bind(this,!1));this.options.fixedHeaderOnAlertSaved&&(this.subscribe("alertsaved.success",this.slideDownHeaderForPriceAlert.bind(this)),this.subscribe("alertsaved.success.dismiss",this.resetHeaderStyleForPriceAlert.bind(this)),this.subscribe("resultItem.alert.tooltip.reset",this.resetTooltipSeen.bind(this)));this.options.fixedHeaderOnAlertSavedToTrip&&(this.subscribe("resultItem.alert.saved",this.slideDownHeaderForTrip.bind(this)),
this.subscribe("resultItem.alert.saved.dismiss",this.resetHeaderStyleForTrip.bind(this)),this.subscribe("resultItem.alert.tooltip.reset",this.resetTooltipSeen.bind(this)))},setDualViewMapOpen:function(a){this.element.toggleClass("map-open",a);this.element.toggleClass("map-closed",!a);this.options.fullWidthMap&&this.swapClassesToggle(this.headerContainer,"Header--fullWidth","Header--autoWidth",a)},changeView:function(a){var b=this.options.statesClasses[a],d=this.options.statesClasses.activeState,e=
this.options.statesClasses[d]||this.options.statesClasses.default;b||(b=this.options.statesClasses.default);b&&a!==d&&(c.dom.swapClasses(this.element,e.main,b.main),c.dom.swapClasses(this.getChildElement("headerWrapper"),e.headerWrapper,b.headerWrapper),c.dom.swapClasses(this.getChildElement("headerContainer"),e.headerContainer,b.headerContainer),e.caretBorder&&b.caretBorder&&c.dom.swapClasses(this.getChildElement("caretBorder"),e.caretBorder,b.caretBorder),this.options.statesClasses.activeState=
a,"results"!==a||this.options.navigationVisible||(this.options.navigationVisible=!0,this.getChildElement("verticals").attr("aria-hidden","false")));this.options.swapInvertedLogoOnRp&&"results"===a&&(this.toggleLogoVisibility(this.element.find(".js-logo")),this.toggleLogoVisibility(this.element.find(".js-logo-inverted")))},toggleLogoVisibility:function(a){var b=!a.hasClass(this.getStlBlock("Header__phoenixLogo--hidden"));this.swapClassesToggle(a,"Header__phoenixLogo--hidden","Header__phoenixLogo--visible",
b)},slideDownHeaderForTrip:function(a){if(sessionStorage.getItem("alertSavedToTripTooltipSeen"))c.events.publish("resultItem.alert.saved.dismiss",a);else{var b=function(){c.events.publish("resultItem.alert.saved.show-tooltip",a);this.element.off(c.Common.Utils.Browsers.ANIMATION_END)}.bind(this);d(window).scrollTop()>this.element.height()?this.slideDownHeader(b):c.events.publish("resultItem.alert.saved.show-tooltip",a)}},slideDownHeaderForPriceAlert:function(){if(sessionStorage.getItem("priceAlertTooltipSeen"))c.events.publish("alertsaved.success.show-tooltip");
else{var a=function(){c.events.publish("alertsaved.success.show-tooltip");this.element.off(c.Common.Utils.Browsers.ANIMATION_END)}.bind(this);d(window).scrollTop()>this.element.height()?this.slideDownHeader(a):c.events.publish("alertsaved.success.show-tooltip")}},resetHeaderStyleForTrip:function(){sessionStorage.getItem("alertSavedToTripTooltipSeen")||(this.resetHeaderStyle(),sessionStorage.setItem("alertSavedToTripTooltipSeen",!0))},resetHeaderStyleForPriceAlert:function(){sessionStorage.getItem("priceAlertTooltipSeen")||
(this.resetHeaderStyle(),sessionStorage.setItem("priceAlertTooltipSeen",!0))},slideDownHeader:function(a){d("body").css({"padding-top":this.element.height()});this.swapClasses(this.element,"","Header--fixed");this.element.removeClass("slideUp").addClass("slideDown");a&&this.element.on(c.Common.Utils.Browsers.ANIMATION_END,a)},resetHeaderStyle:function(){this.element.hasClass("slideDown")&&(this.element.on(c.Common.Utils.Browsers.ANIMATION_END,function(){d("body").css({"padding-top":0});this.swapClasses(this.element,
"Header--fixed","");this.element.off(c.Common.Utils.Browsers.ANIMATION_END)}.bind(this)),this.element.removeClass("slideDown").addClass("slideUp"))},resetTooltipSeen:function(){sessionStorage.removeItem("alertSavedToTripTooltipSeen");sessionStorage.removeItem("priceAlertTooltipSeen")}})})(R9,jQuery);(function(k,c){k.createComponentClass("common.layout.MomondoLocalePicker",{dialog:null,countryDialog:null,langugeDialog:null,currencyDialog:null,options:{currentCountryCode:"",currentLanguageCode:"",currentCurrencyCode:""},init:function(){this.dialog=this.getChildElement("momondoLocalePicker").dialog({}).getWidget();this.countryDialog=this.getChildElement("country-dropdown").dropdownDialog({}).getWidget();this.langugeDialog=this.getChildElement("language-dropdown").dropdownDialog({}).getWidget();
this.currencyDialog=this.getChildElement("currency-dropdown").dropdownDialog({}).getWidget()},addEventHandlers:function(){var a=this;c("a",a.element).on("click",function(){a.dialog.open()});c("li",a.countryDialog.content).on("click",function(b){var d=c(b.delegateTarget);a.options.currentCountryCode=d.data("countrycode");b=d.data("countryname");for(var d=d.data("languages").split("|"),g="",f=0;f<d.length;f++){var e=d[f].split(";"),h=e[0],e=e[1];0==f&&(a.langugeDialog.updateLabel(e),a.options.currentLanguageCode=
h);g=g+"\x3cli data-langcode\x3d"+h+" data-langname\x3d"+e+"\x3e"+e+"\x3c/li\x3e"}c("ul",a.langugeDialog.content).html(g);a.addLanguagesEventHandlers();a.countryDialog.updateLabel(a.formatCountryLabel(a.options.currentCountryCode,b));a.countryDialog.close()});a.addLanguagesEventHandlers();c("li",a.currencyDialog.content).on("click",function(b){b=c(b.delegateTarget);a.options.currentCurrencyCode=b.data("currencycode");a.currencyDialog.updateLabel(a.formatCurrencyLabel(b.data("currencycode"),b.data("currencyname")));
a.currencyDialog.close()});c(".cancel",a.dialog.content).on("click",function(){a.dialog.close()});c(".ok",a.dialog.content).on("click",function(){window.location="/in?cc\x3d"+a.options.currentCountryCode+"\x26lc\x3d"+a.options.currentLanguageCode+"\x26mc\x3d"+a.options.currentCurrencyCode})},addLanguagesEventHandlers:function(){var a=this;c("li",a.langugeDialog.content).on("click",function(b){b=c(b.delegateTarget);a.options.currentLanguageCode=b.data("langcode");a.langugeDialog.updateLabel(b.data("langname"));
a.langugeDialog.close()})},formatCurrencyLabel:function(a,b){return b+"\x3cspan class\x3d'currencyCode'\x3e"+a+"\x3c/span\x3e"},formatCountryLabel:function(a,b){return"\x3cspan class\x3d'flag "+a+"'\x3e\x26nbsp;\x3c/span\x3e "+b}})})(window.R9,window.jq||window.jQuery);(function(l,c){l.createComponentClass("common.layout.MomondoLocaleDropdownContent",{dialog:void 0,countryList:void 0,languageList:void 0,currencyList:void 0,countryLabel:void 0,languageLabel:void 0,currencyLabel:void 0,selectionContent:void 0,options:{currentCountryCode:"",currentCountryUrl:"",currentLanguageCode:"",currentCurrencyCode:"",placeholderText:""},previousCC:"",previousLC:"",previousCurr:"",init:function(){this.dialog=this.getChildElement("momondoLocaleDropdown").dropdownDialog({onClose:c.proxy(this.onDropdownClose,
this),onOpen:c.proxy(this.onDropdownOpen,this)}).getWidget();this.countryList=this.getChildElement("countries");this.languageList=this.getChildElement("languages");this.currencyList=this.getChildElement("currency");this.previousCC=this.options.currentCountryCode;this.previousLC=this.options.currentLanguageCode;this.previousCurr=this.options.currentCurrencyCode;this.countryLabel=this.getChildElement("localeCountry");this.languageLabel=this.getChildElement("localeLanguage");this.currencyLabel=this.getChildElement("localeCurrency");
this.selectionContent=this.getChildElement("selectionContent");this.dialog.updateLabel(this.options.placeholderText)},hasAnyChanges:function(){return this.options.currentCountryCode!==this.previousCC||this.options.currentLanguageCode!==this.previousLC||this.options.currentCurrencyCode!==this.previousCurr},onlyCurrencyChanged:function(){return this.options.currentCountryCode===this.previousCC&&this.options.currentLanguageCode===this.previousLC},onDropdownOpen:function(){var a=this;setTimeout(function(){a.dialog.content.addClass("rendered")},
100)},onDropdownClose:function(){this.dialog.content.removeClass("rendered");this.selectionContent.addClass("show");c(".js-locale-list-container",this.dialog.content).removeClass("show")},openList:function(a){a.addClass("show");this.selectionContent.removeClass("show")},closeList:function(a){a.removeClass("show");this.selectionContent.addClass("show")},addEventHandlers:function(){var a=this;c("a",a.element).on("click",function(){a.dialog.open()});c(".js-selection",a.dialog.content).click(function(b){a.openList(c("#"+
c(b.currentTarget).data("list")))});c(".js-locale-list-container \x3e .js-back",a.dialog.content).click(function(b){a.closeList(c(b.currentTarget).parent())});c("li",a.countryList).on("click",function(b){var d=c(b.delegateTarget);a.options.currentCountryCode=d.data("countrycode");a.options.currentCountryUrl=d.data("url");b=d.data("countryname");for(var d=d.data("languages").split("|"),h="",f=0;f<d.length;f++){var e=d[f].split(";"),k=e[0],g=e[1],e=e[2];0==f&&(a.languageLabel.html(g),a.options.currentLanguageCode=
k);h+="\x3cli data-langcode\x3d'"+k+"' data-langname\x3d'"+g+"' data-url\x3d'"+e+"'\x3e"+g+"\x3c/li\x3e"}c("ul",a.languageList).html(h);a.addLanguagesEventHandlers();a.countryLabel.html(a.formatCountryLabel(a.options.currentCountryCode,b));a.closeList(a.countryList)});a.addLanguagesEventHandlers();c("li",a.currencyList).on("click",function(b){b=c(b.delegateTarget);a.options.currentCurrencyCode=b.data("currencycode");a.currencyLabel.html(a.formatCurrencyLabel(b.data("currencycode"),b.data("currencyname")));
a.closeList(a.currencyList)});c(".cancel",a.dialog.content).on("click",function(){a.dialog.close()});c(".ok",a.dialog.content).on("click",function(){if(a.hasAnyChanges())if(a.onlyCurrencyChanged())a.saveCurrency();else{var b=a.options.currentCountryCode;"US"===a.options.currentCountryCode.toUpperCase()&&"es"===a.options.currentLanguageCode&&(b="uy");b="/in?cc\x3d"+b+"\x26lc\x3d"+a.options.currentLanguageCode+"\x26mc\x3d"+a.options.currentCurrencyCode;a.options.currentCountryUrl&&(b=a.options.currentCountryUrl,
-1<b.indexOf("/in?")&&(b+="\x26mc\x3d"+a.options.currentCurrencyCode));window.location=b}else a.dialog.close()})},saveCurrency:function(){c.ajax({type:"POST",url:"/k/ident/currency",data:{currency:this.options.currentCurrencyCode,posted:!0,save:!1},dataType:"text",success:function(){location.reload()},cache:!1})},addLanguagesEventHandlers:function(){var a=this;c("li",a.languageList).on("click",function(b){b=c(b.delegateTarget);a.options.currentLanguageCode=b.data("langcode");a.languageLabel.html(b.data("langname"));
if(b=b.data("url"))a.options.currentCountryUrl=b;a.closeList(a.languageList)})},formatCurrencyLabel:function(a,b){return b+"\x3cspan class\x3d'currencyCode'\x3e"+a+"\x3c/span\x3e"},formatCountryLabel:function(a,b){return"\x3cspan class\x3d'flag "+a+"'\x3e\x26nbsp;\x3c/span\x3e "+b}})})(window.R9,window.jq||window.jQuery);(function(a){a.createComponentClass("common.layout.Footer",{options:{isSeo:!1,loadContent:!1,needSeoFooter:!1},fdFooter:null,rpFooter:null,init:function(){this.fdFooter=jq("#footer-fd",this.element);this.rpFooter=jq("#footer-rp",this.element);this.options.loadContent&&a.ajax.execute("common/layout/AjaxFooterLinks",{type:"GET",data:{id:this.id(),isSeo:this.options.isSeo},replace:!0})},addEventHandlers:function(){var b=this;a.question.answer("footer.offset",function(){return b.element.position()});
a.events.subscribe("footer.show",function(){b.element.show()});a.events.subscribe("footer.hide",function(){b.element.hide()});a.events.publish("footer.init");a.events.subscribe("resultspage.view.setvisible",this.updateVisibility.bind(this));a.events.subscribe("footer.update.rp.disclaimer",this.updateText.bind(this))},updateVisibility:function(){this.options.needSeoFooter&&this.fdFooter&&this.rpFooter&&(this.fdFooter.addClass("hidden"),this.rpFooter.removeClass("hidden"))},updateText:function(a){this.options.needSeoFooter&&
this.rpFooter&&this.rpFooter.html(a.message)}})})(R9);(function(b,c){b.createComponentClass("common.errors.ErrorDialog",{dialog:null,dialogEl:null,title:null,messages:null,init:function(){this.dialogEl=this.getChildElement("dialog");this.dialog=this.dialogEl.dialog({}).getWidget();this.title=this.getChildElement("title");this.messages=this.getChildElement("messages")},addEventHandlers:function(){var a=this;this.subscribe("error.alert",this.show.bind(this));b.events.when("error.alert",this.show.bind(this));this.subscribe("error.dismiss",this.hide.bind(this));
this.getChildElement("close").on("click keydown",function(c){c.keyCode!==b.globals.keyCodes.TAB&&a.dialog.close()})},show:function(a){var b=this;a.title?(this.title.html(a.title),this.dialogEl.addClass("hasTitle")):(this.title.html(""),this.dialogEl.removeClass("hasTitle"));this.messages.html("");a.messages&&(c.isArray(a.messages)||(a.messages=[a.messages]),c.each(a.messages,function(a,d){a=c("\x3cli\x3e").html(d);b.messages.append(a)}));this.dialog.open()},hide:function(){this.dialog.close()}})})(R9,
jQuery);(function(a,b){a.createComponentClass("common.utils.admin.Tools",{options:{showExperimentSwitchTool:!1,showFeaturesSwitchTool:!1,showCookieControlTool:!1,showFindTemplateTool:!1,seoIndexDisabled:!1,currentExperiments:null,icon:null},legacyAdminToolsInstance:null,constructor:function(a,d,e){this._id=a;this.options=b.extend({},this.options,b.extend(d||{},e||{}));this.init()},init:function(){this.legacyAdminToolsInstance=a.Admin.AdminTools.getInstance({classNameMainContainer:"Common-Utils-Admin-Tools layer-sticky r9-admin-main"},
!0);this.options.showExperimentSwitchTool&&this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.ExperimentTool({currentExperiments:this.options.currentExperiments}));this.options.showFeaturesSwitchTool&&this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.FeatureTool);this.options.showCookieControlTool&&this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.CookieTool);this.options.showFindTemplateTool&&this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.FindTemplateTool);var c=this.getChildElement("chev").detach();
if(c){var d=this;c.click(function(a){a.stopPropagation();a.stopImmediatePropagation();d.legacyAdminToolsInstance.getMenuContainer().toggleClass("collapsed")});this.legacyAdminToolsInstance.getMenuContainer().children().eq(0).prepend(c)}this.options.seoIndexDisabled&&(0<b("link[rel\x3d'canonical'][href$\x3d'/seonox']").length&&b("body").addClass("seonox"),b("a[href$\x3d'/seonox']").addClass("seonox"))}})})(window.R9,window.jQuery);(function(a,b){a.createComponentClass("common.layout.StandardBody",{stateClasses:{results:"ResultsPageBody"},init:function(){},addEventHandlers:function(){}})})(R9,jQuery);(function(a,d){a.createComponentClass("common.layout.momondo.StandardBody",{stateClasses:{results:"ResultsPageBody"},modalOverlay:null,init:function(){this.modalOverlay=this.getChildElement("modalOverlay")},addEventHandlers:function(){var b=this;a.events.subscribe("modalOverlay.visible",function(c){b.modalOverlay.toggleClass("OverlayVisible",c.open);c.event&&b.modalOverlay.click(function(){a.events.publish(c.event)})});b.modalOverlay.click(function(){d(this).removeClass("OverlayVisible")})}})})(R9,
jQuery);(function(g,d){g.createWidgetClass("tip.StyleJamTooltip",{presentations:{wrapper:"Tooltip__Wrapper Tooltip__Wrapper--fixed Tooltip__Wrapper--hidden",visible:"Tooltip__Wrapper--visible",hidden:"Tooltip__Wrapper--hidden",content:"Tooltip__Content",pointer:"Tooltip__Pointer",above:"Tooltip__Pointer Tooltip__Pointer--down",right:"Tooltip__Pointer Tooltip__Pointer--left",below:"Tooltip__Pointer Tooltip__Pointer--up",left:"Tooltip__Pointer Tooltip__Pointer--right"},$targetElem:null,$triggerElem:null,$tooltipElem:null,
$tooltipPointerElem:null,state:null,options:{targetElem:null,triggerElem:null,triggerEvent:"hover",position:"above",positionOffsetX:50,positionOffsetY:50,showDelay:0,hideDelay:1E3,content:null,preRendered:!1},init:function(){this.base();this.state={afID:null,scrolling:!1,scrollTicker:null,visible:!1,showTimeout:0,hideTimeout:0,widthSet:!1};this.$targetElem=d("#"+this.options.targetElem);this.$triggerElem=null!==this.options.triggerElem?d("#"+this.options.triggerElem):this.$targetElem;this.$targetElem.length&&
this.$triggerElem.length?(this.options.preRendered?(this.$tooltipElem=d("#"+this.id()),this.$tooltipPointerElem=this.getChildElement("pointer")):(this.$tooltipElem=d(this.createTooltipElement()),this.$tooltipPointerElem=this.$tooltipElem.children("#"+this.id("pointer"))),this.options.preRendered&&this.$tooltipElem.appendTo(d("body"))):console.warn("StyleJamTooltip: Couldn't locate target element with id: %s",this.options.targetElem)},addEventHandlers:function(){var a=this;switch(this.options.triggerEvent){case "hover":this.$triggerElem.on("mouseenter",
function(){a.show()}).on("mouseleave",function(){a.hide()});this.$tooltipElem.on("mouseenter",function(){a.show()}).on("mouseleave",function(){a.hide()});break;case "click":this.options.hideDelay=0;this.$triggerElem.on("click",function(){a.show()});d(document).on("click",function(b){if(a.state.visible){var c=a.$targetElem[0],e=a.$tooltipElem[0],c=b.target===c||a.isDescendant(c,b.target);b=b.target===e||a.isDescendant(e,b.target);c||b||a.hide()}});break;case "focus":this.$triggerElem.on("focus",function(){a.show()}).on("blur",
function(){a.hide()})}this.setupOnScroll();this.subscribe("common.widgets.tooltip.closeAll",this.hide.bind(this))},createTooltipElement:function(){var a=document.createElement("div");a.setAttribute("id",this.id());a.setAttribute("class",this.getStlBlocks(this.presentations.wrapper));var b=document.createElement("div");b.setAttribute("class",this.getStlBlock(this.presentations.content));b.innerHTML=this.options.content;var c=document.createElement("div");c.setAttribute("id",this.id("pointer"));c.setAttribute("class",
this.getStlBlock(this.presentations.pointer));a.appendChild(b);a.appendChild(c);return a},setupOnScroll:function(){var a=this;this.registerEvent("scroll resize",d(window),function(){clearTimeout(a.state.scrollTicker);!a.state.scrolling&&a.state.visible&&(a.state.scrolling=!0,a.position());a.state.scrollTicker=setTimeout(function(){a.state.scrolling=!1;cancelAnimationFrame(a.state.afID)},150)})},show:function(){var a=this;this.state.visible=!0;this.options.preRendered||this.$tooltipElem.appendTo(d("body"));
this.state.widthSet||(this.$tooltipElem.width(this.$tooltipElem.width()),this.state.widthSet=!0);this.position();this.resetTimers();this.state.showTimeout=setTimeout(function(){a.swapClasses(a.$tooltipElem,a.presentations.hidden,a.presentations.visible)},this.options.showDelay)},hide:function(){var a=this;this.resetTimers();this.state.hideTimeout=setTimeout(function(){a.state.visible=!1;a.swapClasses(a.$tooltipElem,a.presentations.visible,a.presentations.hidden);a.options.preRendered||a.$tooltipElem.remove()},
this.options.hideDelay)},resetTimers:function(){clearTimeout(this.state.showTimeout);clearTimeout(this.state.hideTimeout)},position:function(){var a=this;this.state.scrolling&&(this.state.afID=requestAnimationFrame(function(){a.position()}));var b=this.$targetElem[0].getBoundingClientRect(),c=this.$tooltipElem[0].getBoundingClientRect(),e=this.$tooltipElem[0].currentStyle||window.getComputedStyle(this.$tooltipElem[0]);c.x-=parseFloat(e.marginLeft);c.width=c.width+parseFloat(e.marginLeft)+parseFloat(e.marginRight);
c.height=c.height+parseFloat(e.marginTop)+parseFloat(e.marginBottom);b=this.getRenderPosition(this.options.position,b,c);this.$tooltipElem.css({top:b.y+"px",left:b.x+"px"})},getRenderPosition:function(a,b,c){var e=b.x+this.options.positionOffsetX/100*b.width-c.width/2,d=b.y+this.options.positionOffsetY/100*b.height-c.height/2,f={left:[d,b.x-c.width,this.getInnerHeight()-(d+c.height)],below:[e,this.getInnerHeight()-(b.y+b.height+c.height),this.getInnerWidth()-(e+c.width)],right:[d,this.getInnerWidth()-
(b.x+b.width+c.width),this.getInnerHeight()-(d+c.height)],above:[e,b.y-c.height,this.getInnerWidth()-(e+c.width)]};a=f[a].every(function(a){return 0<=a})?a:Object.keys(f).reduce(function(a,b){return f[a].map(function(a){return 0<a?0:a}).reduce(function(a,b){return a+b})>f[b].map(function(a){return 0<a?0:a}).reduce(function(a,b){return a+b})?a:b});this.$tooltipPointerElem.attr("class","").addClass(this.getStlBlocks(this.presentations[a]));switch(a){case "above":return{x:e,y:b.y-c.height};case "right":return{x:b.x+
b.width,y:d};case "below":return{x:e,y:b.y+b.height};case "left":return{x:b.x-c.width,y:d}}},isDescendant:function(a,b){for(b=b.parentNode;null!=b;){if(b==a)return!0;b=b.parentNode}return!1},getInnerWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},getInnerHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}})})(R9,jQuery);(function(c,e){c.createComponentClass("common.seo.SeoMetaTags",{addEventHandlers:function(){this.checkForAdWordsSearch()},checkForAdWordsSearch:function(){c.globals.isSeo&&this.subscribe("cmp2.rendering.finished",function(a){if(a&&a.items&&a.items.length){if(a=window.location.search.substring(1)){a=a.split("\x26");var b=c.config.getString("ui.cmp2.dynamic.search.ads","");if(b)for(var b=b.split(","),d=0;d<b.length;d++)if(-1<a.indexOf("a\x3d"+b[d])){c.events.publish("cmp2.checkAll");break}}this.destroy()}}.bind(this))}})})(R9,
jQuery);(function(b,e){var f=function(a){if(a){a=a.charAt(0).toUpperCase()+a.slice(1);var b="s"===a.slice(-1)?a.slice(0,-1):a;return"."+a+"-Results-"+b+"ResultsPage"}},g=void 0!==window.history.pushState,h=[b.globals.keyCodes.UP,b.globals.keyCodes.DOWN,b.globals.keyCodes.LEFT,b.globals.keyCodes.RIGHT,b.globals.keyCodes.TAB];b.createComponentClass("base.search.SearchPage",{options:{msg:{resultPageTitle:""},isFD:!0,lazyLoadRP:!1,pageVertical:"",analyticsVertical:"",preloadResourcesForRP:!1,resultsPageComponentsMap:{}},
rpLoaded:!1,rpRequest:null,init:function(a){this.rpContainer=this.getChildElement("rp");this.options.isFD?this.options.lazyLoadRP?this.preloadComponents():this.options.preloadRP&&(this.rpLoaded=!0):this.rpLoaded=!0;""!==this.options.msg.resultPageTitle&&(document.title=this.options.msg.resultPageTitle)},addEventHandlers:function(a){var c=this;this.subscribe("pageContainer.contentBlur",function(a){c.element.toggleClass("Blur",a)});a=this.handleSearchSubmit.bind(this);a.priority=1;this.subscribe(["searchform.submit",
"multilocale.search.submit"],a);this.subscribe("omni.vertical.changed",function(a){c.cleanupResultsPage();c.abortActiveResultsPageRequest();b.config.getBoolean("ui.horizon.omni.loadRpOnVerticalChange",!0)&&c.options.resultsPageComponentsMap&&c.options.resultsPageComponentsMap.hasOwnProperty(a)&&c.loadResultsPageComponent(a)});b.question.answer("SearchPage.view",function(){return c.options.isFD?"FD":"RP"});b.config.getBoolean("ui.keyboard.show-focus",!0)&&this.bindAccessibilityHandlers();if(b.config.getBoolean("ui.horizon.modal.no-ad-click",
!0)){var d=this.element;this.subscribe(["InputModal.opened","Select.opened","DatePicker.opened","DropdownDialog.open"],function(){d.addClass("modalOpen")});this.subscribe(["InputModal.closed","Select.closed","DatePicker.closed","DropdownDialog.close"],function(){d.removeClass("modalOpen")})}},abortActiveResultsPageRequest:function(){this.rpTimerId&&clearTimeout(this.rpTimerId);this.rpRequest&&(this.rpRequest.abort(),delete this.rpRequest)},handleSearchSubmit:function(a){a.url&&a.url.startsWith("http")&&
(window.location=a.url);this.abortActiveResultsPageRequest();var b="/"+a.url;this.useSamePageTransition(a)?(window.history.pushState({view:"rp"},"",b),this.options.isFD&&this.switchToRP()):window.location.href=b},useSamePageTransition:function(a){return!a.navigateToResults&&g&&this.rpLoaded&&this.isCorrectRpLoaded(a.vertical)},getRPBodyClass:function(){return"wide"},switchToRP:function(a){b.Analytics.api.setVertical(this.options.analyticsVertical);b.Analytics.api.setPageId("results");"requestId"in
b.globals&&(b.globals.requestId=b.globals.requestId.replace("frontdoor","results").replace("main",b.globals.vertical||this.options.analyticsVertical));var c=this;window.setTimeout(function(){b.events.publish("frontdoor.view.changed",{view:"inline"});c.element.removeClass("vm-fd");c.element.addClass("vm-rp");b.events.publish("resultspage.view.setvisible",!0);b.events.publish("header.view.set",{view:"results"});b.events.publish("pageContainers.changed",{state:"results"});b.events.publish("body.setClass",
c.getRPBodyClass());b.events.publish("HorizontalFilterList.setClass");b.events.publish("resultspage.routed",!0);c.rpContainer.removeClass("hiddenFD");c.options.isFD=!1;c.cleanupFrontDoor()},10)},preloadComponents:function(){var a=this;if(this.options.lazyLoadRP){var c=function(){b.globals.vertical===a.options.pageVertical&&a.loadResultsPageComponent(a.options.pageVertical)};"complete"===document.readyState?c():b.events.when("page.initialized",c)}e(document).ready(function(){a.element.hasClass("vm-fd")&&
a.options.preloadResourcesForRP&&b.resources.preload("common.booking","styles")})},loadResultsPageComponent:function(a){var c=this.options.resultsPageComponentsMap[a];if(c&&c.component){this.abortActiveResultsPageRequest();this.cleanupResultsPage();var d=this;this.rpTimerId=setTimeout(function(){d.rpRequest=b.ajax.execute(c.component,{appendTo:d.rpContainer});d.rpRequest.then(function(){d.rpLoaded=!0;b.globals.vertical=a;d.options.analyticsVertical=c.analyticsVertical;delete d.rpRequest})},100)}},
cleanupResultsPage:function(){b.ComponentManager.remove(this.rpContainer,!1);this.rpContainer&&this.rpContainer.empty();this.rpLoaded=!1},cleanupFrontDoor:function(){var a=this;setTimeout(function(){b.ComponentManager.remove(a.id("fd"))},800)},isCorrectRpLoaded:function(a){return 1===this.getChildElement("rp").find(".Base-Results-ResultsPage").length&&1===this.getChildElement("rp").find(f(a)).length},bindAccessibilityHandlers:function(){this.toggleKeyboardFocus(!1);e(document).on("keydown.ada",function(a){!b.globals.keyboardNav&&
-1<h.indexOf(a.keyCode)&&this.toggleKeyboardFocus(!0)}.bind(this));e(document).on("mousemove.ada",this.toggleKeyboardFocus.bind(this,!1))},toggleKeyboardFocus:function(a){b.globals.keyboardNav=a?!0:!1}})})(R9,jq||jQuery);(function(a,b){a.createComponentClass("flights.search.FlightSearchPage","base.search.SearchPage",{options:{preloadResourcesForRP:a.config.getBoolean("ui.horizon.searchpage.flights.preloadStyles",!0)}})})(R9,jQuery);function validateEmail(a){if(!a||!a.match)return!1;a=a.match(/^[A-Z0-9._%+-]{1,63}@(?:[A-Z0-9-]+\.){1,125}[A-Z]{2,63}$/i);return!!(a&&a[0]&&a[0].length)}function replaceArgs(){for(var a=arguments[0],b=1;b<=arguments.length;b++)a=a.replace("{"+(b-1)+"}",arguments[b]);return a}R9.metacookie=R9.metacookie||{};R9.metacookie.saveQueue=R9.metacookie.saveQueue||[];
function saveQueuedMetaCookie(){if(0!=R9.metacookie.saveQueue.length){var a=R9.metacookie.saveQueue[0];jq.ajax({type:"POST",url:"/k/cookie",data:{action:"setmeta",metacookie:a.name,metavalue:a.value,formtoken:R9.globals.formtoken},complete:function(){R9.metacookie.saveQueue.shift();saveQueuedMetaCookie()},success:function(){a.callback()}})}}function setMetaCookie(a,b,c){R9.metacookie.saveQueue.push({name:a,value:b,callback:c||jq.noop});1==R9.metacookie.saveQueue.length&&saveQueuedMetaCookie()}
function deleteMetaCookie(a,b){"function"!==typeof b&&(b=$.noop);jq.ajax({type:"POST",url:"/k/cookie",data:{action:"deletemeta",metacookie:a,formtoken:R9.globals.formtoken},success:b})}jq.ajaxPrefilter("script",function(a){a.cache=!0});(function(c){c.createComponentClass("common.core.RealUserMeasurementsComponent",{options:{fullstoryEnabled:!1},trackedSubmit:!1,addEventHandlers:function(){this.base();this.subscribe("searchform.submit",this.onSearchSubmit.bind(this))},onSearchSubmit:function(a){if(!this.trackedSubmit&&this.options.fullstoryEnabled&&window&&"FS"in window&&a&&a.vertical){this.trackedSubmit=!0;a="did"+this.fixCase(a.vertical)+"Search_bool";var b={};b[a]=!0;FS.setUserVars(b)}},fixCase:function(a){return a.toLowerCase().replace(/(^| )(\w)/g,
function(a){return a.toUpperCase()})}})})(R9);(function(d,f,e,c){d.createComponentClass("common.core.FullyInvisibleCaptcha",{options:{enabled:!1},init:function(){var a=this;this.options.enabled&&(this.setupCaptchaCallback(),this.initAPI().then(function(){a.fireCaptcha()}))},setupCaptchaCallback:function(){var a=this;c.onReCaptchaSubmit=function(b){a.captchaResult(b)};c.onReCaptchaError=function(a){console.log(a)}},initAPI:function(){var a=f.Deferred();c.recaptchaReady=function(){a.resolve()};var b=e.createElement("script");b.type="text/javascript";
b.async=!0;b.src="https://www.google.com/recaptcha/api.js?onload\x3drecaptchaReady\x26render\x3dexplicit";e.getElementById("recaptcha-root").appendChild(b);return a},fireCaptcha:function(){"undefined"!==typeof grecaptcha&&(grecaptcha.render("captcha",{},!0),grecaptcha.execute())},captchaResult:function(a){d.action.execute("common.core.FullyInvisibleCaptchaAction",{data:a})}})})(R9,jQuery,document,window);(function(e,d){e.createComponentClass("common.core.FastlyTiming",{options:{runTest:!1,measurementUrl:"/fastly-timer",logUrl:"/s/run/fastlytimerlog"},init:function(){this.options.runTest&&this.runTimingRequest()},runTimingRequest:function(){d.ajax({type:"POST",url:this.options.measurementUrl,success:this.logResult.bind(this)})},logResult:function(c,a,b){b&&c&&c.cluster&&(a=b.getResponseHeader("x-served-by"),b=b.getResponseHeader("x-timer"),a&&b&&(a=a.split(" "),a=a[a.length-1].split("-"),d.ajax({type:"POST",
url:this.options.logUrl,data:{cluster:c.cluster,timer:b,fastlyNode:a[a.length-1]}})))}})})(R9,jQuery);(new R9.logger).timeEnd("combined");