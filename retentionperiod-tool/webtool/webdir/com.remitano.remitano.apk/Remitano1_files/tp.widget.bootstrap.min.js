!function o(r,a,u){function d(e,t){if(!a[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var s=a[e]={exports:{}};r[e][0].call(s.exports,function(t){return d(r[e][1][t]||t)},s,s.exports,o,r,a,u)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)d(u[t]);return d}({1:[function(t,e,n){"use strict";var c=t("./constants.js").OFF,s=t("./xhr.js"),o="https:"===document.location.protocol?"https:":"http:",r="TrustboxSplitTest",a=[];function i(t,e){var n="domain="+function(){for(var t="weird_get_top_level_domain=cookie",e=document.location.hostname.split("."),n=e.length-1;0<=n;n--){var i=e.slice(n).join(".");if(document.cookie=t+";domain=."+i+";",-1<document.cookie.indexOf(t))return document.cookie=t.split("=")[0]+"=;domain=."+i+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",i}}(),i="expires="+e;return document.cookie=[r+"="+t,"path=/",n,i].join("; "),i}function u(t){var e=void 0;try{e=function(){for(var t=r+"=",e=document.cookie.split(";"),n=0;n<e.length;n++){for(var i=e[n];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length,i.length)}}();var n=JSON.parse(decodeURIComponent(e));if(n.businessUnitId===t)return n}catch(t){if(e){var i="domain="+window.location.hostname.replace(/^.*\.([^.]+\.[^.]+)/,"$1");document.cookie=r+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/;"+i}}}function h(t,e){for(e=t="";t++<36;e+=51*t&52?(15^t?8^Math.random()*(20^t?16:4):4).toString(16):"-");return e}function d(t){for(var e=function(t){if(t){if(!t.expiry){t.expiry=new Date((new Date).getTime()+864e7).toUTCString()}return i(encodeURIComponent(JSON.stringify(t)),t.expiry)}}(t);a.length;){a.pop()(t,e)}}e.exports={getABSettingsAsync:function(n,t){var i=u(n);if(i&&(!i.sessionStart||+new Date<i.sessionStart+18e5)){var e="expires="+i.expiry;t(i,e)}else a.push(t),1<a.length||s.xhrGet({url:o+"//widget.trustpilot.com/v1/ratios/"+n,success:function(t){var e=function(t,e){if(!t||!t.groups)return null;for(var n=0,i=0,s=[],o=0;o<t.groups.length;o++)"number"==typeof t.groups[o].ratio&&(n+=t.groups[o].ratio,++i,s.push(t.groups[o]));if(0===i)return null;1===i&&n<1&&(s.push({name:c,ratio:1-n}),n=1);for(var r=0,a=Math.random()*n,u=s[0].name,d=[],l=0;l<s.length;l++)r<=a&&a<r+s[l].ratio&&(u=s[l].name),d.push(s[l].name),r+=s[l].ratio;return{allGroups:d,group:u,testId:t.testId,businessUnitId:e,session:h(),sessionStart:+new Date,anonymousId:h()}}(t,n);return i&&i.testId===e.testId?(i.session=h(),i.sessionStart=+new Date,d(i)):d(e)},error:function(){t(null)}})}}},{"./constants.js":2,"./xhr.js":8}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.EMPTY_WIDGET_ID="000000000000000000000000",n.LAZY_LOADED_WIDGETS=["54d39695764ea907c0f34825","577258fb31f02306e4e3aaf9"],n.OFF="OFF"},{}],3:[function(t,e,n){"use strict";var i=!1;function f(t){try{if(i)return;var e=document.createElement("script");e.setAttribute("type","application/ld+json"),e.innerHTML=JSON.stringify(t),document.head.appendChild(document.createComment("Added by Trustpilot")),document.head.appendChild(e),document.head.appendChild(document.createComment("/Added by Trustpilot")),i=!0}catch(t){}}var p=t("./xhr.js"),m="https:"===document.location.protocol?"https:":"http:";e.exports=function(t){return!i&&(t.schemaType?(function(t){var e=t.schemaType,n=t.businessunitId,i=t.location,s=t.locale,o=t.templateId,r=["type="+e,"url="+encodeURIComponent(window.location.href),"templateId="+o,"locale="+s].join("&"),a=m+"//widget.trustpilot.com"+(i?"/data/jsonld/business-unit/"+n+"/location/"+i:"/data/jsonld/business-unit/"+n)+"?"+r;p.xhrGet({url:a,success:function(t){t.url=document.location.href,f(t)},error:function(t){console.error(t)}})}(t),!0):!(!t.name||!t.sku)&&(function(t){var e=t.businessunitId,n=t.locale,i=t.templateId,s=t.name,o=t.sku,r=t.reviewnumber,a=t.price,u=t.priceCurrency,d=t.availability,l=n&&n.split("-")[0],c=m+"//widget.trustpilot.com"+("5763bccae0a06d08e809ecbb"===i?"/data/jsonld/business-unit/"+e+"/product-imported":"/data/jsonld/business-unit/"+e+"/product")+"?sku="+encodeURIComponent(o)+"&numberOfReviews="+(r||10)+"&productName="+s+"&language="+l+"&templateId="+i+"&url="+encodeURIComponent(window.location.origin+window.location.pathname),h=a&&u&&d?{"@type":"Offer",priceCurrency:u,price:a,availability:d}:null;p.xhrGet({url:c,success:function(t){h&&(t.offers=h),(t.offers||t.review||t.aggregateRating)&&f(t)},error:function(t){console.error(t)}})}(t),!0))}},{"./xhr.js":8}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t};function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var o=t("./constants"),r=d(t("./snippets")),a=t("./ab-settings"),u=d(t("./widget"));function d(t){return t&&t.__esModule?t:{default:t}}var l=(i(c,[{key:"initialize",value:function(){var n=this;this.hasABTestElements()?(0,a.getABSettingsAsync)(this.businessUnitId,function(t,e){n.abSettings=t,n.sessionExpiry=e,n.findAndApplyWidgets()}):this.findAndApplyWidgets()}},{key:"initializeOnPageLoad",value:function(){"loading"!==this.document.readyState?this.initialize():this.document.addEventListener("DOMContentLoaded",this.initialize.bind(this))}},{key:"applyWidgetFromDomElement",value:function(n,t){var i=this;n.firstChild&&"IFRAME"===n.firstChild.tagName&&!t||("group"in n.dataset?(0,a.getABSettingsAsync)(n.dataset.businessunitId,function(t,e){i.abSettings=t,i.sessionExpiry=e,i.createWidget(n)}):this.createWidget(n))}},{key:"findAndApplyWidgets",value:function(){var e=this;this.stats.findAndApplyCalls+=1;var t=this.widgetElements;t&&0!==t.length&&(this.stats.normalElements=t.filter(function(t){return!("group"in t.dataset)}).length,this.stats.abTestElements=t.filter(function(t){return"group"in t.dataset}).length,t.forEach(function(t){return e.createWidget(t)}))}},{key:"hasABTestElements",value:function(){return[].slice.call(this.widgetElements).some(function(t){return"group"in t.dataset})}},{key:"createWidget",value:function(t){if(this.removeWidget(t),this.checkWidgetDisplayAndUpdateDataset(t)){var e=t.dataset;(0,r.default)(e);var n="group"in e&&this.abSettings,i=n?{container:t,dataset:e,session:this.abSettings.session,anonymousId:this.abSettings.anonymousId,testId:this.abSettings.testId,sessionExpiry:this.sessionExpiry}:{container:t,dataset:e},s=new u.default(i);return s.initialize(),this.stats.applied+=1,this.stats[n?"abTestApplied":"normalApplied"]+=1,this.stats.applyFromDomCalls+=1,this.widgets.push(s),s}return null}},{key:"checkWidgetDisplayAndUpdateDataset",value:function(t){var e=t.dataset;return!(this.abSettings&&"group"in e)||this.abSettings.group===e.group||this.abSettings.group===o.OFF&&(e.templateId=o.EMPTY_WIDGET_ID,e.styleHeight="0",e.group=o.OFF,!0)}},{key:"removeWidget",value:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}},{key:"closePopups",value:function(){this.widgets.forEach(function(t){return t.closePopup()})}},{key:"businessUnitId",get:function(){return this.widgetElements[0].dataset.businessunitId}},{key:"widgetElements",get:function(){return[].slice.call(this.document.getElementsByClassName("trustpilot-widget"))}}]),c);function c(t,e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),this.window=t,this.document=e,this.widgets=[],this.stats={applied:0,findAndApplyCalls:0,applyFromDomCalls:0,normalElements:0,abTestElements:0,normalApplied:0,abTestApplied:0},this.version=n}n.default=l},{"./ab-settings":1,"./constants":2,"./snippets":3,"./widget":6}],5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},s=function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t};function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var r="https:"===document.location.protocol?"https:":"http:",a=r+"//widget.trustpilot.com",u=r+"//widget.trustpilot.com/trustboxes";function d(t){var e="";return t&&0<t.length&&(t=t.toLowerCase(),e=/(px|\%)/i.test(t)?t:t+"px"),e}var l=(s(c,[{key:"getIframeOptionsFromData",value:function(){var t=this.iframeData||{styles:{}};return i({},this.defaultIframeOptions,{position:t.styles.position||"",zindex:t.styles.zindex||"",margin:t.styles.margin||"",top:t.styles.top||"",bottom:t.styles.bottom||"",left:t.styles.left||"",right:t.styles.right||"",height:t.styles.height||"",width:t.styles.width||this.defaultIframeOptions.styles.width||"",display:t.show?"block":"none",src:this.baseUrl+t.source+this.queryString,borderStyle:this.defaultIframeOptions.styles.borderStyle,overflow:this.defaultIframeOptions.styles.overflow})}},{key:"initialize",value:function(t,e){this._iframe=function(t){var e=document.createElement("iframe");return e.style.position=t.position,e.style.zIndex=t.zindex,e.style.margin=t.margin,e.style.top=t.top,e.style.bottom=t.bottom,e.style.left=t.left,e.style.right=t.right,e.style.height=t.height,e.style.width=t.width,e.style.borderStyle=t.borderStyle,e.style.backgroundColor=t.backgroundColor,e.style.display=t.display,e.style.overflow=t.overflow,e.frameBorder=t.frameBorder,e.scrolling=t.scrolling,e.allowTransparency=t.allowTransparency,e.title="Customer reviews powered by Trustpilot",e.src=t.src,e}(this.getIframeOptionsFromData()),t.appendChild(this._iframe),this._iframe.addEventListener("load",e)}},{key:"sendMessage",value:function(t){this._iframe.contentWindow&&(t=JSON.stringify(t),this._iframe.contentWindow.postMessage(t,a))}},{key:"isInViewport",value:function(t){var e=this._iframe.getBoundingClientRect(),n=e.width||this._iframe.offsetWidth,i=e.height||this._iframe.offsetHeight;return 0<=e.top&&0<=e.left&&e.bottom-i*t<=(window.innerHeight||document.documentElement.clientHeight)&&e.right-n*t<=(window.innerWidth||document.documentElement.clientWidth)}},{key:"setWidgetId",value:function(t){this.sendMessage({command:"setId",widgetId:t})}},{key:"setStyle",value:function(n){var i=this;Object.keys(n).forEach(function(t){var e=n[t];i._iframe.style[t]=e})}},{key:"hide",value:function(){this.setStyle({display:"none"})}},{key:"resizeHeight",value:function(t){"number"==typeof t&&0!==t&&(this._iframe.style.height=t+"px")}},{key:"dimensions",get:function(){return{height:d(this.dataset.styleHeight),width:d(this.dataset.styleWidth)}}},{key:"queryString",get:function(){function e(t){return t+"="+encodeURIComponent(n.dataset[t])}function t(t){return Object.keys(n.dataset).filter(t).map(e)}var n=this,i=["businessunitId","templateId"],s=t(function(t){return-1!==i.indexOf(t)}),o=t(function(t){return-1===i.indexOf(t)});return"?"+s.join("&")+"#"+o.join("&")}},{key:"templateId",get:function(){return this.dataset.templateId}},{key:"baseUrl",get:function(){return u+"/"+this.templateId+"/"}},{key:"defaultIframeOptions",get:function(){return{source:"index.html",frameBorder:0,allowTransparency:"true",scrolling:"no",styles:{borderStyle:"none",backgroundColor:"transparent",display:"block",overflow:"hidden",height:this.dimensions.height,width:this.dimensions.width,position:"relative"},show:!0}}}]),c);function c(t,e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),this.name=t,this.dataset=e,this.iframeData=n||this.defaultIframeOptions}n.default=l},{}],6:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t};function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var d=r(t("./tracking")),o=r(t("./iframe")),l=t("./../constants");function r(t){return t&&t.__esModule?t:{default:t}}var a=(i(c,null,[{key:"generateId",value:function(){for(var t=this.usedIds,e=void 0;e=Math.random(),-1!==t.indexOf(e););return this.usedIds.push(e)}}]),i(c,[{key:"isContainerInViewport",value:function(t){var e=0<arguments.length&&void 0!==t?t:200,n=this.container.getBoundingClientRect(),i=n.width||this.container.offsetWidth,s=n.height||this.container.offsetHeight;return 0<=n.top&&0<=n.left&&n.bottom-s-e<=(window.innerHeight||document.documentElement.clientHeight)&&n.right-i-e<=(window.innerWidth||document.documentElement.clientWidth)}},{key:"initialize",value:function(){if(!this.isLazyLoaded||this.isContainerInViewport()){var t="https:"===document.location.protocol?"https:":"http:";this._widgetIFrameOrigin=t+"//widget.trustpilot.com",this.createIFrame("main"),this.attachMessageListener()}else setTimeout(this.initialize,200)}},{key:"handleCommand",value:function(t){var e=t.data,n=t.origin;try{var i="string"==typeof e?JSON.parse(e):e;return(-1!==["activate-old-brand","activate-new-brand"].indexOf(i.command)||n===this._widgetIFrameOrigin&&i.widgetId===this.id)&&this.widgetIframeMessageHandler(i)}catch(t){return!1}}},{key:"attachMessageListener",value:function(){window.addEventListener("message",this.handleCommand.bind(this),!1)}},{key:"widgetIframeMessageHandler",value:function(t,e){var n=this,i=1<arguments.length&&void 0!==e?e:function(){};this.stats.events[t.command]=(this.stats.events[t.command]||0)+1;var s=t.name,o=t.style,r=t.height,a=this.iframes[s],u={createIFrame:function(){return n.createIFrame(s,t)},setStyle:function(){return a.setStyle(o)},loaded:function(){return n.iframes.main.sendMessage("loaded")},message:function(){return a.sendMessage(t)},"resize-height":function(){return n.getIframeOrMain(s).resizeHeight(r)},impression:function(){return n.tracking.initialize()},"activate-old-brand":function(){return n.switchBrand("old")},"activate-new-brand":function(){return n.switchBrand("new")}}[t.command];return u?(u(),!0):(i(),!1)}},{key:"switchBrand",value:function(t){var e=this,n="new"===t?"activate-new-brand":"activate-old-brand";Object.keys(this.iframes).forEach(function(t){e.iframes[t].sendMessage({command:n})})}},{key:"createIFrame",value:function(t,e){var n=this,i=new o.default(t,this.dataset,e);this.iframes[t]=i,this.stats.createIFrameCalls+=1,i.initialize(this.container,function(){i.setWidgetId(n.id),n.stats.iframeLoadEvents+=1})}},{key:"getIframeOrMain",value:function(t){return this.iframes[t]||this.iframes.main}},{key:"isInViewport",value:function(t){return this.iframes.main.isInViewport(t)}},{key:"closePopup",value:function(){"popup"in this.iframes&&(this.iframes.main.sendMessage({name:"main",command:"message",message:"popup toggled",visible:!1}),this.iframes.popup.hide())}},{key:"id",get:function(){return this._id||(this._id=this.constructor.generateId()),this._id}}]),c);function c(t){var e=this,n=t.container,i=t.dataset,s=t.session,o=t.anonymousId,r=t.testId,a=t.sessionExpiry;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c);var u={container:n,dataset:i,templateId:i.templateId,businessUnitId:i.businessunitId,locale:i.locale};Object.keys(u).forEach(function(t){if(!u[t])throw"No "+t+" supplied for TrustBox"}),this.container=n,this.container.style.position="relative",this.dataset=i,this.iframes={},this.tracking=new d.default(function(t){return e.iframes.main.sendMessage(t)},function(){return e.isInViewport(.5)},{session:s,group:i.group,sessionExpiry:a,anonymousId:o,testId:r,templateId:i.templateId}),this.isLazyLoaded=-1<l.LAZY_LOADED_WIDGETS.indexOf(i.templateId),this.stats={createIFrameCalls:0,iframeLoadEvents:0,events:{}},this.initialize=this.initialize.bind(this)}a.usedIds=[],n.default=a},{"./../constants":2,"./iframe":5,"./tracking":7}],7:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t};function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var d=t("../constants");var o=(i(l,[{key:"initialize",value:function(){this.sendImpressionData(),this.attachListener(),this.shouldDetachListener()}},{key:"getTrackingData",value:function(t){var e={command:t,url:window.document.URL,referrer:window.document.referrer,userAgent:window.navigator.userAgent,language:window.navigator.userLanguage||window.navigator.language,platform:window.navigator.platform};return this.session&&this.group&&(e.session=this.session,e.sessionExpiry=this.sessionExpiry),this.anonymousId&&(e.anonymousId=this.anonymousId),this.testId&&(e.testId=this.testId),e}},{key:"sendImpressionData",value:function(){if(!this.hasSentImpression){this.hasSentImpression=!0;var t=this.getTrackingData("impression-received");this.sendMessage(t)}}},{key:"sendVisibilityData",value:function(){if(!this.hasSentViewTracking){this.hasSentViewTracking=!0;var t=this.getTrackingData("trustbox-in-viewport");this.sendMessage(t)}}},{key:"attachListener",value:function(){var e,n,i,s=arguments,t=this,o=(e=function(){t.templateId!==d.EMPTY_WIDGET_ID&&!t.shouldDetachListener()||(window.removeEventListener("scroll",a,r),window.removeEventListener("resize",u,r))},n=100,i=void 0,function(){var t=s;clearTimeout(i),i=setTimeout(function(){i=null,e(t)},n)}),r={passive:!0,capture:!1},a=window.addEventListener("scroll",o,r),u=window.addEventListener("resize",o,r);o()}},{key:"shouldDetachListener",value:function(){return!!this.hasSentViewTracking||(this.hasBeenVisible?(this.hasSentImpression&&this.sendVisibilityData(),!0):!!this.isTrustBoxVisible()&&(this.hasSentImpression?(this.sendVisibilityData(),!0):this.hasBeenVisible=!0))}}]),l);function l(t,e,n){var i=n.session,s=n.sessionExpiry,o=n.group,r=n.anonymousId,a=n.testId,u=n.templateId;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),this.hasSentImpression=!1,this.hasSentViewTracking=!1,this.sendMessage=t,this.isTrustBoxVisible=e,this.session=i,this.group=o,this.sessionExpiry=s,this.anonymousId=r,this.testId=a,this.templateId=u}n.default=o},{"../constants":2}],8:[function(t,e,n){"use strict";function i(e){try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}e.exports={xhrGet:function(t){var e=new window.XMLHttpRequest;e.open("GET",t.url,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4===e.readyState&&(200<=e.status&&e.status<300?t.success(i(e)):t.error&&t.error(i(e)))},e.send()}}},{}],9:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n){try{t=e("./lib/widget-management.js").default,window.Trustpilot=window.Trustpilot||{loadFromElement:function(t,e){return this.Modules.WidgetManagement&&this.Modules.WidgetManagement.applyWidgetFromDomElement(t,e)}},window.Trustpilot.Modules=window.Trustpilot.Modules||{},window.Trustpilot.Modules.WidgetManagement?window.Trustpilot.Modules.WidgetManagement.version!==n&&console.log("Detected legacy TrustBox bootstrap with version:",window.Trustpilot.Modules.WidgetManagement.version,", current:",n):(window.Trustpilot.Modules.WidgetManagement=new t(window,document,n),window.Trustpilot.Modules.WidgetManagement.initializeOnPageLoad()),window.addEventListener("click",function(){window.Trustpilot.Modules.WidgetManagement.closePopups()})}catch(e){!function(){function t(t){console.error("Error on bootstrap:"+t);var e=["error="+encodeURIComponent(t),"uri="+encodeURIComponent(document.URL),"bootstrapVersion="+n].join("&");document.createElement("img").src="//widget.trustpilot.com/feedback/report-error?"+e}try{"object"===(void 0===e?"undefined":i(e))?t(e.message):t(e)}catch(t){console.error("Error on error reporting method:"+t)}}()}var t}("1.283.1")},{"./lib/widget-management.js":4}]},{},[9]);
//# sourceMappingURL=tp.widget.bootstrap.min.js.map
