embedded_svc.defineFeature("Invite",function(n){var e=!1,o={},s={},i={},r=0,a="embeddedServiceAvatar",l="snapins_invite",h=new function(){var e="snapinsPc",i="snapinsStart",n="snapinsPage_",o="snapinsPageTime_";this.init=function(){var t=parseInt(window.localStorage.getItem(e),10)||0;window.localStorage.getItem(i)||window.localStorage.setItem(i,(new Date).getTime().toString()),window.localStorage.setItem(e,(t+1).toString()),window.localStorage.setItem(n+t.toString(),window.location.href),window.localStorage.setItem(o+t.toString(),(new Date).getTime())},this.getPageCount=function(){return parseInt(window.localStorage.getItem(e),10)},this.getSessionStart=function(){return window.localStorage.getItem(i)},this.getCurrentPage=function(){return window.localStorage.getItem(n+(this.getPageCount()-1).toString())}};function c(e){var i;return void 0!==e.style.animationName?"":(["Webkit","Moz","O","ms","Khtml"].forEach(function(t){void 0!==e.style[t+"AnimationName"]&&(i=t.toLowerCase())}),i)}function u(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else{if(!t.attachEvent)throw new Error("Could not add event listener");t.attachEvent("on"+e,i,!1)}}function f(){}function p(){}function m(){}function d(t){this.ruleId=t,p.prototype.init.call(this,null,null)}function y(t,e){p.prototype.init.call(this,t,e)}function P(t,e){p.prototype.init.call(this,t,e)}function g(t){p.prototype.init.call(this,t,null)}function v(t){return x(t)?x(t).getTracker():null}function O(){}function t(t,e,i,n){O.prototype.init.call(this,t,e,i,n)}function T(t,e,i,n){O.prototype.init.call(this,t,e,null,n)}function E(t,e,i,n){O.prototype.init.call(this,t,e,null,n)}function I(t){f.prototype.init.call(this,t,f.TYPE.INVITE),this.active=!1,this.filterLogic=null,this.rules={},this.ruleTree=null,this.inviteDelay=null,this.inviteTimeout=null,this.autoRejectTimeout=null}function x(t){return i[t]||(i[t]=new I(t)),i[t]}function R(t,e,i,n,o){m.prototype.init.call(this,t,e,i,n,o)}function A(t,e,i,n,o){m.prototype.init.call(this,t,e,i,n,o)}function S(t,e,i,n,o){m.prototype.init.call(this,t,e,i,n,o)}function w(t,e,i,n,o,s,r,a){this.buttonId=t,this.element=e,this.hasInviteAfterAccept=s,this.hasInviteAfterReject=r,this.rejectTime=a,null===c(e)?this.renderer=new I.RENDERER.Appear.RenderClass(t,e,I.START_POSITION[n],I.END_POSITION[o]):this.renderer=new I.RENDERER[i].RenderClass(t,e,I.START_POSITION[n],I.END_POSITION[o])}f.TYPE={STANDARD:"STANDARD",INVITE:"INVITE",AGENT:"AGENT"},f.prototype.init=function(t,e){this.buttonId=t,this.type=e,this.onlineState=void 0,this.trackers=[]},f.prototype.getType=function(){return this.type},f.prototype.getOnlineState=function(){return this.onlineState},f.prototype.setOnlineState=function(e){this.onlineState=e,this.trackers.forEach(function(t){t.setState(e)})},p.prototype.init=function(t,e){this.left=t,this.right=e},p.prototype.evaluate=function(t){return!1},m.TYPE={NUMBER_OF_PAGE_VIEWS:"NUMBER_OF_PAGE_VIEWS",URL_MATCH:"URL_MATCH",SECONDS_ON_PAGE:"SECONDS_ON_PAGE",SECONDS_ON_SITE:"SECONDS_ON_SITE",CUSTOM_VARIABLE:"CUSTOM_VARIABLE"},m.OPERATOR={EQUALS:"EQUALS",NOT_EQUAL:"NOT_EQUAL",START_WITH:"START_WITH",CONTAINS:"CONTAINS",NOT_CONTAIN:"NOT_CONTAIN",LESS_THAN:"LESS_THAN",GREATER_THAN:"GREATER_THAN",LESS_OR_EQUAL:"LESS_OR_EQUAL",GREATER_OR_EQUAL:"GREATER_OR_EQUAL"},m.prototype.init=function(t,e,i,n,o){this.ruleId=t,this.buttonId=e,this.compareFrom=i,this.operator=n,this.compareTo=o},m.prototype.getId=function(){return this.ruleId},m.prototype.evaluate=function(t,e){switch(this.operator){case m.OPERATOR.EQUALS:return n.log("Evaluate: "+t+" == "+e),t===e;case m.OPERATOR.NOT_EQUAL:return n.log("Evaluate: "+t+" != "+e),t!==e;case m.OPERATOR.START_WITH:return n.log("Evaluate: "+t+" indexOf "+e+" == 0"),0===t.indexOf(e);case m.OPERATOR.CONTAINS:return n.log("Evaluate: "+t+" indexOf "+e+" != -1"),-1!==t.indexOf(e);case m.OPERATOR.NOT_CONTAIN:return n.log("Evaluate: "+t+" indexOf "+e+" == -1"),-1===t.indexOf(e);case m.OPERATOR.LESS_THAN:return n.log("Evaluate: "+parseFloat(t)+" < "+parseFloat(e)),parseFloat(t)<parseFloat(e);case m.OPERATOR.GREATER_THAN:return n.log("Evaluate: "+parseFloat(t)+" > "+parseFloat(e)),parseFloat(t)>parseFloat(e);case m.OPERATOR.LESS_OR_EQUAL:return n.log("Evaluate: "+parseFloat(t)+" <= "+parseFloat(e)),parseFloat(t)<=parseFloat(e);case m.OPERATOR.GREATER_OR_EQUAL:return n.log("Evaluate: "+parseFloat(t)+" >= "+parseFloat(e)),parseFloat(t)>=parseFloat(e);default:return}},(d.prototype=new p).evaluate=function(t){return n.log("Evaluating Atom Node: "+this.ruleId),t.getRule(this.ruleId).evaluate()},(y.prototype=new p).evaluate=function(t){return n.log("Evaluating And Node"),this.left.evaluate(t)&&this.right.evaluate(t)},(P.prototype=new p).evaluate=function(t){var e=this.left.evaluate(t)||this.right.evaluate(t);return n.log("Evaluating Or Node"),e},(g.prototype=new p).evaluate=function(t){var e=!this.left.evaluate(t);return n.log("Evaluating Not Node"),e},O.prototype.init=function(t,e,i,n){window.innerWidth?this.realWidth=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?this.realWidth=document.documentElement.clientWidth:document.body&&(this.realWidth=document.body.clientWidth),window.innerHeight?this.realHeight=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?this.realHeight=document.documentElement.clientHeight:document.body&&(this.realHeight=document.body.clientHeight),this.offset=25,this.buttonId=t,this.animationPrefix=c(e),this.element=e,this.element.style.position=this.animationPrefix?"fixed":"absolute",this.element.style.left="-1000px",this.element.style.top="-1000px",this.element.style.zIndex="10000",this.element.style.display="",this.element.style.visibility="visible",this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,this.startPosition=i,this.endPosition=n},O.prototype.render=function(){this.element.style.display=""},O.prototype.renderFinish=function(){},O.prototype.remove=function(t){this.element.style.left="-1000px",this.element.style.top="-1000px"},O.prototype.addRenderListeners=function(){var t=this.buttonId,e="AnimationIteration",i="AnimationEnd";i=""===this.animationPrefix?(e=e.toLowerCase(),i.toLowerCase()):(e=this.animationPrefix+e,this.animationPrefix+i),u(this.element,e,function(){v(t).renderFinish()}),u(this.element,i,function(){v(t).removeFinish()})},(t.prototype=new O).render=function(){var t=this.width*this.startPosition.xPosition+this.offset*this.startPosition.xOffset,e=this.height*this.startPosition.yPosition+this.offset*this.startPosition.yOffset,i=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset,n=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset,o=document.createElement("style"),s="";O.prototype.addRenderListeners.call(this),""!==this.animationPrefix&&(s="-"+this.animationPrefix+"-"),o.innerHTML="@"+s+"keyframes slide"+this.buttonId+"{from { margin-left: "+t+"px; margin-top: "+e+"px; left: "+100*this.startPosition.xPercent+"%; top: "+100*this.startPosition.yPercent+"%; }to { margin-left: "+i+"px; margin-top: "+n+"px; left: "+100*this.endPosition.xPercent+"%; top: "+100*this.endPosition.yPercent+"%; }}",document.getElementsByTagName("head")[0].appendChild(o),this.element.style[s+"animation-name"]="slide"+this.buttonId,this.element.style[s+"animation-duration"]="1s",this.element.style[s+"animation-iteration-count"]="2",this.element.style[s+"animation-direction"]="alternate",this.element.style[s+"animation-timing-function"]="ease-in-out",this.element.style.setProperty(s+"animation-name","slide"+this.buttonId,""),this.element.style.setProperty(s+"animation-duration","1s",""),this.element.style.setProperty(s+"animation-iteration-count","2",""),this.element.style.setProperty(s+"animation-direction","alternate",""),this.element.style.setProperty(s+"animation-timing-function","ease-in-out",""),O.prototype.render.call(this)},t.prototype.renderFinish=function(){var t="";""!==this.animationPrefix&&(t="-"+this.animationPrefix+"-"),this.element.style[t+"animation-play-state"]="paused",this.element.style.setProperty(t+"animation-play-state","paused","")},t.prototype.remove=function(t){var e="";""!==this.animationPrefix&&(e="-"+this.animationPrefix+"-"),t?(this.element.style[e+"animation-play-state"]="running",this.element.style.setProperty(e+"animation-play-state","running","")):(this.element.style[e+"animation-name"]="",this.element.style.setProperty(e+"animation-name","",""),O.prototype.remove.call(this,t))},(T.prototype=new O).render=function(){var t="",e=document.createElement("style"),i=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset,n=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;O.prototype.addRenderListeners.call(this),""!==this.animationPrefix&&(t="-"+this.animationPrefix+"-"),e.innerHTML="@"+t+"keyframes fade"+this.buttonId+"{from { opacity: 0; }to { opacity: 1; }}",document.getElementsByTagName("head")[0].appendChild(e),this.element.style[t+"animation-name"]="fade"+this.buttonId,this.element.style[t+"animation-duration"]="1s",this.element.style[t+"animation-iteration-count"]="2",this.element.style[t+"animation-direction"]="alternate",this.element.style[t+"animation-timing-function"]="ease-in-out",this.element.style.setProperty(t+"animation-name","fade"+this.buttonId,""),this.element.style.setProperty(t+"animation-duration","1s",""),this.element.style.setProperty(t+"animation-iteration-count","2",""),this.element.style.setProperty(t+"animation-direction","alternate",""),this.element.style.setProperty(t+"animation-timing-function","ease-in-out",""),this.element.style.marginLeft=i+"px",this.element.style.left=100*this.endPosition.xPercent+"%",this.element.style.marginTop=n+"px",this.element.style.top=100*this.endPosition.yPercent+"%",O.prototype.render.call(this)},T.prototype.renderFinish=function(){var t="";""!==this.animationPrefix&&(t="-"+this.animationPrefix+"-"),this.element.style[t+"animation-name"]="",this.element.style.setProperty(t+"animation-name","","")},T.prototype.remove=function(t){var e="";""!==this.animationPrefix&&(e="-"+this.animationPrefix+"-"),t?(this.element.style[e+"animation-play-state"]="running",this.element.style.setProperty(e+"animation-play-state","running",""),this.element.style.opacity=0):(this.element.style[e+"animation-name"]="",this.element.style.setProperty(e+"animation-name","",""),O.prototype.remove.call(this,t))},(E.prototype=new O).render=function(){var t=this.width*this.endPosition.xPercent*-1+this.offset*this.endPosition.xOffset,e=this.height*this.endPosition.yPercent*-1+this.offset*this.endPosition.yOffset;this.element.style.marginLeft=t+"px",this.element.style.left=100*this.endPosition.xPercent+"%",this.element.style.marginTop=e+"px",this.element.style.top=100*this.endPosition.yPercent+"%",O.prototype.render.call(this),v(this.buttonId).renderFinish()},E.prototype.remove=function(t){t?v(this.buttonId).removeFinish():O.prototype.remove.call(this,t)},I.prototype=new f,I.RENDERER={Slide:{RenderClass:t},Fade:{RenderClass:T},Appear:{RenderClass:E}},I.START_POSITION={TopLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopLeftTop:{xPercent:0,xPosition:0,xOffset:1,yPercent:0,yPosition:-1,yOffset:-1},Top:{xPercent:.5,xPosition:-.5,xOffset:0,yPercent:0,yPosition:-1,yOffset:-1},TopRightTop:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:0,yPosition:-1,yOffset:-1},TopRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:-1,yOffset:-1},TopRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:0,yPosition:0,yOffset:1},Right:{xPercent:1,xPosition:0,xOffset:1,yPercent:.5,yPosition:-.5,yOffset:0},BottomRightRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:-1,yOffset:-1},BottomRight:{xPercent:1,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomRightBottom:{xPercent:1,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},Bottom:{xPercent:.5,xPosition:-.5,xOffset:0,yPercent:1,yPosition:0,yOffset:1},BottomLeftBottom:{xPercent:0,xPosition:0,xOffset:1,yPercent:1,yPosition:0,yOffset:1},BottomLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:0,yOffset:1},BottomLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:1,yPosition:-1,yOffset:-1},Left:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:.5,yPosition:-.5,yOffset:0},TopLeftLeft:{xPercent:0,xPosition:-1,xOffset:-1,yPercent:0,yPosition:0,yOffset:1}},I.END_POSITION={TopLeft:{xPercent:0,xOffset:1,yPercent:0,yOffset:1},Top:{xPercent:.5,xOffset:0,yPercent:0,yOffset:1},TopRight:{xPercent:1,xOffset:-1,yPercent:0,yOffset:1},Left:{xPercent:0,xOffset:1,yPercent:.5,yOffset:0},Center:{xPercent:.5,xOffset:0,yPercent:.5,yOffset:0},Right:{xPercent:1,xOffset:-1,yPercent:.5,yOffset:0},BottomLeft:{xPercent:0,xOffset:1,yPercent:1,yOffset:-1},Bottom:{xPercent:.5,xOffset:0,yPercent:1,yOffset:-1},BottomRight:{xPercent:1,xOffset:-1,yPercent:1,yOffset:-3}},(R.prototype=new m).evaluate=function(){return n.log("Evaluating StandardInviteRule"),m.prototype.evaluate.call(this,this.compareFrom,this.compareTo)},(A.prototype=new m).evaluate=function(){var t,e=(new Date).getTime()-this.compareFrom,i=m.prototype.evaluate.call(this,e,this.compareTo);return n.log("Evaluating TimerInviteRule"),!i&&e<=this.compareTo&&(t=this.compareTo-e,(null===x(this.buttonId).getInviteDelay()||t<x(this.buttonId).getInviteDelay())&&x(this.buttonId).setInviteDelay(t)),i},(S.prototype=new m).evaluate=function(){return o.hasOwnProperty(this.compareFrom)?(n.log("Evaluating CustomInviteRule"),m.prototype.evaluate.call(this,o[this.compareFrom].toString(),this.compareTo)):(n.log("CustomInviteRule evaluation failed due to missing custom variable"),!1)},w.prototype.setState=function(t){t&&!e&&x(this.buttonId).trigger()?(e=!0,this.renderer.render()):!t&&x(this.buttonId).isActive()&&(e=!1,this.remove(!0))},w.prototype.renderFinish=function(){var t=this.buttonId;x(this.buttonId).setActive(!0),-1!==this.rejectTime&&x(this.buttonId).setAutoRejectTimeout(window.setTimeout(function(){x(t).rejectInvite()},1e3*this.rejectTime)),this.renderer.renderFinish()},w.prototype.accept=function(){this.hasInviteAfterAccept||n.setCookie("liveagent_invite_rejected_"+this.buttonId,!0,!1),this.remove(!1)},w.prototype.reject=function(){this.hasInviteAfterReject||n.setCookie("liveagent_invite_rejected_"+this.buttonId,!0,!1),this.remove(!0)},w.prototype.remove=function(t){x(this.buttonId).setActive(!1),this.renderer.remove(t)},w.prototype.removeFinish=function(){this.renderer.remove(!1)},I.prototype.setRules=function(t,e){var i,n,o;if(t&&e){for(i in t)if(t.hasOwnProperty(i)){switch(o=null,(n=t[i]).type){case m.TYPE.NUMBER_OF_PAGE_VIEWS:o=new R(n.order,this.buttonId,h.getPageCount(),n.operator,parseInt(n.value,10));break;case m.TYPE.URL_MATCH:o=new R(n.order,this.buttonId,h.getCurrentPage(),n.operator,n.value);break;case m.TYPE.SECONDS_ON_PAGE:o=new A(n.order,this.buttonId,(new Date).getTime(),n.operator,1e3*parseInt(n.value,10));break;case m.TYPE.SECONDS_ON_SITE:o=new A(n.order,this.buttonId,parseInt(h.getSessionStart(),10),n.operator,1e3*parseInt(n.value,10));break;case m.TYPE.CUSTOM_VARIABLE:o=new S(n.order,this.buttonId,n.name,n.operator,n.value),s.hasOwnProperty(n.name)||(s[n.name]=[]),s[n.name].push(this.buttonId)}null!==o&&this.addRule(o)}this.filterLogic=e,this.ruleTree=function t(e){var i,n=0,o=0;if(1e3<(r+=1))throw new Error("Error processing rule filter logic, preventing recursion");for(i=0;i<e.length;i+=1)"("===e.charAt(i)?o+=1:")"===e.charAt(i)&&(o-=1),","===e.charAt(i)&&1===o&&(n=i);if(0===e.indexOf("AND("))return new y(t(e.substring(4,n)),t(e.substring(n+1,e.length-1)));if(0===e.indexOf("OR("))return new P(t(e.substring(3,n)),t(e.substring(n+1,e.length-1)));if(0===e.indexOf("NOT("))return new g(t(e.substring(4,e.length-1)));if(!isNaN(parseInt(e,10)))return new d(parseInt(e,10));throw new Error("Encountered unexpected character in filter logic")}(e)}},I.prototype.setOnlineState=function(t){t||null===this.inviteTimeout||(clearTimeout(this.inviteTimeout),this.inviteTimeout=null),t||null===this.autoRejectTimeout||(clearTimeout(this.autoRejectTimeout),this.autoRejectTimeout=null),f.prototype.setOnlineState.call(this,t)},I.prototype.isActive=function(){return this.active},I.prototype.setActive=function(t){document.getElementById(l)&&(document.getElementById(l).inert=!t),this.active=t},I.prototype.addTracker=function(t,e){var i;i=/Mobi/.test(navigator.userAgent)?new w(e.id,t,"Fade",void 0,"BottomRight",e.hasInviteAfterAccept,e.hasInviteAfterReject,e.inviteRejectTime):new w(e.id,t,e.inviteRenderer,e.inviteStartPosition,e.inviteEndPosition,e.hasInviteAfterAccept,e.hasInviteAfterReject,e.inviteRejectTime),this.trackers=[],this.trackers.push(i)},I.prototype.getTracker=function(){if(1<this.trackers.length)throw new Error("InviteButtons should have less than 1 tracker");return this.trackers[0]},I.prototype.acceptInvite=function(){n.onHelpButtonClick(),this.getTracker().accept(),embedded_svc.fireEvent("onInviteAccepted")},I.prototype.rejectInvite=function(){this.getTracker().reject(),embedded_svc.fireEvent("onInviteRejected")},I.prototype.setCustomVariable=function(t,e){var i;o[t]=e,s.hasOwnProperty(t)&&s[t].forEach(function(t){(i=x(t)).getOnlineState()&&i.setOnlineState(!0)})},I.prototype.trigger=function(){var t=!0,e=this,i=n.componentInitInProgress||0<document.getElementsByClassName("embeddedServiceSidebar").length;return!n.getCookie("liveagent_invite_rejected_"+this.buttonId)&&!i&&(null!==this.ruleTree&&(n.log("Invite "+this.buttonId+" Rule Evaluation"),n.log("Filter Logic: "+this.filterLogic),t=this.ruleTree.evaluate(this)),t||null===this.inviteDelay||(this.inviteTimeout=window.setTimeout(function(){e.setOnlineState(!0)},this.inviteDelay),this.inviteDelay=null),t)},I.prototype.addRule=function(t){this.rules[t.getId()]=t},I.prototype.getRule=function(t){return this.rules[t]},I.prototype.getInviteDelay=function(){return this.inviteDelay},I.prototype.setInviteDelay=function(t){n.log("Setting invite delay to: "+t),this.inviteDelay=t},I.prototype.setAutoRejectTimeout=function(t){this.autoRejectTimeout=t},n.inviteAPI=new function(){var t;this.inviteButton=x(n.settings.buttonId),h.init(),document.getElementById(a)&&(embedded_svc.settings.avatarImgURL?document.getElementById(a).src=embedded_svc.settings.avatarImgURL:(t=document.getElementById(a)).parentNode.removeChild(t))}});