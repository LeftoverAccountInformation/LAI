"use strict";function privacyConcernLinkClicked(){sendTracking("deletion reasons : privacy concerns : privacy statement")}function warningModalOpen(){removeLoadingState(document.getElementById("warningModalBtn"));var e=document.getElementById("warningModalBtn");e.removeEventListener("click",handleWarningModalBtnClick),e.addEventListener("click",handleWarningModalBtnClick),sendTracking("warningModal")}function deleteModalOpen(){deleteFormValidator=ui.validator(document.getElementById("deleteForm"),{fields:{accountDeletionToken:{minLength:8,required:!0,when:"submit"}},onSubmit:function(e){return sendTracking("deleteBtn"),e.valid&&(sendNewCodeSuccessAlert.close(),addLoadingState(document.getElementById("deleteBtn")),document.getElementById("deleteError").classList.add("noDisplay"),deleteAccount()),!1}});var e=document.getElementById("sendNewCodeBtn");e.removeEventListener("click",handleSendNewCodeBtnClick),e.addEventListener("click",handleSendNewCodeBtnClick),$accountDeletionTokenInput.focus(),$accountDeletionTokenInput.value="",sendTracking("deleteModal")}function sendReasonTrackingAndComment(){for(var e="no selection",t=document.getElementsByName("deleteReason"),n=0;n<t.length;n++)t[n].checked&&(e=t[n].value);var a=document.getElementById("comment").value;sendTracking("deletion reasons : reasons : "+e),sendTracking("comments : "+a)}function sendTracking(e){if(window.utag&&window.utag.link){var t=utag.data.page_name+" : "+e;utag.link({link_name:t,action:t})}}function deleteAccount(){var e=new XMLHttpRequest;e.open("POST",document.body.getAttribute("data-secure-domain")+"/api/account/delete"),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onload=function(){if(200===e.status){switch(JSON.parse(e.responseText).Status){case"Ok":sendReasonTrackingAndComment(),window.location=document.getElementById("logoutUrl").value;break;case"ExpiredToken":deleteFormValidator.updateValidationMessage("accountDeletionToken",!1,deleteFormValidator.fields.accountDeletionToken.label.getAttribute("data-error-expired")),deleteFormValidator.fields.accountDeletionToken.field.focus(),removeLoadingState(document.getElementById("deleteBtn"));break;case"InvalidPassword":ui.modal.close(),document.getElementById("deletePage_password").classList.remove("noDisplay"),document.getElementById("deletePage").classList.add("noDisplay"),document.querySelector(".pageHeader").classList.add("noDisplay"),reAuthenticationFormValidator.updateValidationMessage("password",!1,reAuthenticationFormValidator.fields.password.label.getAttribute("data-error")),reAuthenticationFormValidator.fields.password.field.focus(),removeLoadingState(document.getElementById("reAuthenticationBtn"));break;case"NotLoggedIn":window.location.reload();break;case"InvalidToken":deleteFormValidator.updateValidationMessage("accountDeletionToken",!1,deleteFormValidator.fields.accountDeletionToken.label.getAttribute("data-error")),deleteFormValidator.fields.accountDeletionToken.field.focus(),removeLoadingState(document.getElementById("deleteBtn"));break;case"Error":default:removeLoadingState(document.getElementById("deleteBtn")),document.getElementById("deleteError").classList.remove("noDisplay")}}else removeLoadingState(document.getElementById("deleteBtn")),document.getElementById("deleteError").classList.remove("noDisplay")},e.send("userId="+document.getElementById("deletePage").getAttribute("data-user-id")+"&password="+$passwordInput.value+"&accountDeletionToken="+$accountDeletionTokenInput.value)}function handleConsentBtnClick(e){warningModalInstance.open()}function handleRequiredCheckboxClick(e){for(var t=document.getElementsByClassName("requiredCheckbox"),n=0;n<t.length;n++)if(!t[n].checked)return void $consentBtn.classList.add("disabled");$consentBtn.classList.remove("disabled")}function handleSendNewCodeBtnClick(e){sendTracking("sendNewCodeBtn"),$accountDeletionTokenInput.value="",deleteFormValidator.updateValidationMessage("accountDeletionToken",null,deleteFormValidator.fields.accountDeletionToken.label.getAttribute("data-error")),$accountDeletionTokenInput.focus(),triggerAccountDeletionTokenEmail(function(){sendNewCodeSuccessAlert.open()})}function handleWarningModalBtnClick(e){sendTracking("warningModalBtn"),addLoadingState(e.currentTarget),triggerAccountDeletionTokenEmail(function(){ui.modal.close(),deleteModalInstance.open()})}function reAuthenticate(){var e=new XMLHttpRequest;e.open("POST",document.querySelector("body").getAttribute("data-secure-domain")+"/api/account/reAuthenticate"),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onload=function(){if(200===e.status){switch(JSON.parse(e.responseText).Status){case"Ok":document.getElementById("deletePage_password").classList.add("noDisplay"),document.getElementById("deletePage").classList.remove("noDisplay"),document.querySelector(".pageHeader").classList.remove("noDisplay");break;case"NotLoggedIn":window.location.reload();break;case"InvalidCredentials":case"Error":default:reAuthenticationFormValidator.updateValidationMessage("password",!1,reAuthenticationFormValidator.fields.password.label.getAttribute("data-error")),reAuthenticationFormValidator.fields.password.field.focus(),removeLoadingState(document.getElementById("reAuthenticationBtn"))}}else reAuthenticationFormValidator.updateValidationMessage("password",!1,reAuthenticationFormValidator.fields.password.label.getAttribute("data-error")),reAuthenticationFormValidator.fields.password.field.focus(),removeLoadingState(document.getElementById("reAuthenticationBtn"))},e.send("userId="+document.getElementById("deletePage").getAttribute("data-user-id")+"&password="+$passwordInput.value)}function triggerAccountDeletionTokenEmail(e){var t=new XMLHttpRequest;t.open("POST",document.querySelector("body").getAttribute("data-secure-domain")+"/api/account/triggerAccountDeletionTokenEmail"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onload=function(){if(200===t.status){switch(JSON.parse(t.responseText).Status){case"Ok":"function"==typeof e&&e();break;case"InvalidPassword":ui.modal.close(),document.getElementById("deletePage_password").classList.remove("noDisplay"),document.getElementById("deletePage").classList.add("noDisplay"),document.querySelector(".pageHeader").classList.add("noDisplay"),reAuthenticationFormValidator.updateValidationMessage("password",!1,reAuthenticationFormValidator.fields.password.label.getAttribute("data-error")),reAuthenticationFormValidator.fields.password.field.focus(),removeLoadingState(document.getElementById("reAuthenticationBtn"));break;case"NotLoggedIn":window.location.reload();break;case"Error":default:removeLoadingState(document.getElementById("warningModalBtn"))}}else removeLoadingState(document.getElementById("warningModalBtn"))},t.send("userId="+document.getElementById("deletePage").getAttribute("data-user-id")+"&password="+$passwordInput.value)}function addLoadingState(e){e.classList.add("disabled","loading"),e.hasAttribute("data-loading-text")&&(e.innerHTML=e.getAttribute("data-loading-text"))}function removeLoadingState(e){e.classList.remove("disabled","loading"),e.hasAttribute("data-default-text")&&(e.innerHTML=e.getAttribute("data-default-text"))}var $passwordInput=document.getElementById("password"),$accountDeletionTokenInput=document.getElementById("accountDeletionToken"),$consentBtn=document.getElementById("consentBtn");null!==document.getElementById("subscriptionsCon")&&ui.callout(document.getElementById("thirdPartySubscriptionCalloutTrigger"),{content:"#thirdPartySubscriptionCallout",calloutStyle:"dark"}),null!==document.getElementById("treesCon")&&ui.callout(document.getElementById("treeContentCalloutTrigger"),{content:"#treeContentCallout",calloutStyle:"dark"}),null!==document.getElementById("dnaTestsCon")&&ui.callout(document.getElementById("dnaResultsCalloutTrigger"),{content:"#dnaResultsCallout",calloutStyle:"dark"}),null!==document.getElementById("privacyConcernBtn")&&ui.callout(document.getElementById("privacyConcernBtn"),{content:"#privacyCallout"});var sendNewCodeSuccessAlert=ui.alert(document.getElementById("sendNewCodeSuccessAlert"),{open:!1,type:"info"}),deleteFormValidator,reAuthenticationFormValidator=ui.validator(document.getElementById("reAuthenticationForm"),{fields:{password:{minLength:1,required:!0,when:"submit"}},onSubmit:function(e){return e.valid&&(addLoadingState(document.getElementById("reAuthenticationBtn")),reAuthenticate()),!1}}),warningModalInstance=ui.modal("#warningModal",{closeOnBkgClick:!1,onOpen:warningModalOpen,open:!1}),deleteModalInstance=ui.modal("#deleteModal",{closeOnBkgClick:!1,onOpen:deleteModalOpen,open:!1});domReady(function(){$passwordInput.focus(),0===document.getElementsByClassName("requiredCheckbox").length?$consentBtn.classList.remove("disabled"):plainJS.addEventToClassElements("requiredCheckbox","click",handleRequiredCheckboxClick),$consentBtn.addEventListener("click",handleConsentBtnClick)});
//# sourceMappingURL=delete-e501635b.min.js.map